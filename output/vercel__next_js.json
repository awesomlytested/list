{"repo":"vercel/next.js","url":"https://github.com/vercel/next.js","branch":"canary","configs":[{"lang":"js","dir":"examples/with-jest-babel/__tests__","framework":"jest","pattern":"**/*.{js,ts}"},{"lang":"js","dir":"examples/with-mocha/test","framework":"mocha","pattern":"**/*[._-]{test,spec,unittest,unit}.{ts,js}"},{"package":"nextjs-project","lang":"ts","dir":"test","framework":"jest","pattern":"**/*[._-]{test,spec,unittest,unit}.{ts,js}"}],"tests":[{"name":"App shows \"Hello world!\"","suites":["With Enzyme"],"updatePoint":{"line":7,"column":30,"index":219},"line":7,"code":"  it('App shows \"Hello world!\"', () => {\n    const app = shallow( /*#__PURE__*/React.createElement(App, null));\n    expect(app.find('p').text()).to.equal('Hello World!');\n  });","file":"index.test.js","skipped":false,"dir":"examples/with-mocha/test"},{"name":"can edit a component without losing state","suites":["ReactRefresh"],"updatePoint":{"line":17,"column":49},"line":17,"code":"  test('can edit a component without losing state', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.patch(\n      'index.js',\n      `\n        import { useCallback, useState } from 'react'\n\n        export default function Index() {\n          const [count, setCount] = useState(0)\n          const increment = useCallback(() => setCount(c => c + 1), [setCount])\n          return (\n            <main>\n              <p>{count}</p>\n              <button onClick={increment}>Increment</button>\n            </main>\n          )\n        }\n      `\n    )\n\n    await session.evaluate(() => document.querySelector('button').click())\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('1')\n\n    await session.patch(\n      'index.js',\n      `\n        import { useCallback, useState } from 'react'\n\n        export default function Index() {\n          const [count, setCount] = useState(0)\n          const increment = useCallback(() => setCount(c => c + 1), [setCount])\n          return (\n            <main>\n              <p>Count: {count}</p>\n              <button onClick={increment}>Increment</button>\n            </main>\n          )\n        }\n      `\n    )\n\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('Count: 1')\n    await session.evaluate(() => document.querySelector('button').click())\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('Count: 2')\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefresh.test.ts","skipped":false,"dir":"test"},{"name":"cyclic dependencies","suites":["ReactRefresh"],"updatePoint":{"line":72,"column":27},"line":72,"code":"  test('cyclic dependencies', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.write(\n      'NudgeOverview.js',\n      `\n        import * as React from 'react';\n\n        import { foo } from './routes';\n\n        const NudgeOverview = () => {\n          return <span />;\n          foo;\n        };\n\n        export default NudgeOverview;\n      `\n    )\n\n    await session.write(\n      'SurveyOverview.js',\n      `\n        const SurveyOverview = () => {\n          return 100;\n        };\n\n        export default SurveyOverview;\n      `\n    )\n\n    await session.write(\n      'Milestones.js',\n      `\n        import React from 'react';\n\n        import { fragment } from './DashboardPage';\n\n        const Milestones = props => {\n          return <span />;\n          fragment;\n        };\n\n        export default Milestones;\n      `\n    )\n\n    await session.write(\n      'DashboardPage.js',\n      `\n        import React from 'react';\n\n        import Milestones from './Milestones';\n        import SurveyOverview from './SurveyOverview';\n        import NudgeOverview from './NudgeOverview';\n\n        export const fragment = {};\n\n        const DashboardPage = () => {\n          return (\n            <>\n              <Milestones />\n              <SurveyOverview />\n              <NudgeOverview />\n            </>\n          );\n        };\n\n        export default DashboardPage;\n      `\n    )\n\n    await session.write(\n      'routes.js',\n      `\n        import DashboardPage from './DashboardPage';\n\n        export const foo = {};\n\n        console.warn('DashboardPage at import time:', DashboardPage);\n        setTimeout(() => console.warn('DashboardPage after:', DashboardPage), 0);\n\n        export default DashboardPage;\n      `\n    )\n\n    await session.patch(\n      'index.js',\n      `\n        import * as React from 'react';\n\n        import DashboardPage from './routes';\n\n        const HeroApp = (props) => {\n          return <p>Hello. {DashboardPage ? <DashboardPage /> : null}</p>;\n        };\n\n        export default HeroApp;\n      `\n    )\n\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('Hello. 100')\n\n    let didFullRefresh = !(await session.patch(\n      'SurveyOverview.js',\n      `\n        const SurveyOverview = () => {\n          return 200;\n        };\n\n        export default SurveyOverview;\n      `\n    ))\n\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('Hello. 200')\n    expect(didFullRefresh).toBe(false)\n\n    didFullRefresh = !(await session.patch(\n      'index.js',\n      `\n        import * as React from 'react';\n\n        import DashboardPage from './routes';\n\n        const HeroApp = (props) => {\n          return <p>Hello: {DashboardPage ? <DashboardPage /> : null}</p>;\n        };\n\n        export default HeroApp;\n      `\n    ))\n\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('Hello: 200')\n    expect(didFullRefresh).toBe(false)\n\n    didFullRefresh = !(await session.patch(\n      'SurveyOverview.js',\n      `\n        const SurveyOverview = () => {\n          return 300;\n        };\n\n        export default SurveyOverview;\n      `\n    ))\n\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('Hello: 300')\n    expect(didFullRefresh).toBe(false)\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefresh.test.ts","skipped":false,"dir":"test"},{"name":"empty _app shows logbox","suites":["ReactRefreshLogBox"],"updatePoint":{"line":16,"column":31},"line":16,"code":"  test('empty _app shows logbox', async () => {\n    const { session, cleanup } = await sandbox(\n      next,\n      new Map([\n        [\n          'pages/_app.js',\n          `\n            \n          `,\n        ],\n      ])\n    )\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxDescription()).toMatchInlineSnapshot(\n      `\"Error: The default export is not a React Component in page: \\\\\"/_app\\\\\"\"`\n    )\n\n    await session.patch(\n      'pages/_app.js',\n      `\n        function MyApp({ Component, pageProps }) {\n          return <Component {...pageProps} />;\n        }\n        export default MyApp\n      `\n    )\n    expect(await session.hasRedbox()).toBe(false)\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox-app-doc.test.ts","skipped":false,"dir":"test"},{"name":"empty _document shows logbox","suites":["ReactRefreshLogBox"],"updatePoint":{"line":46,"column":36},"line":46,"code":"  test('empty _document shows logbox', async () => {\n    const { session, cleanup } = await sandbox(\n      next,\n      new Map([\n        [\n          'pages/_document.js',\n          `\n            \n          `,\n        ],\n      ])\n    )\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxDescription()).toMatchInlineSnapshot(\n      `\"Error: The default export is not a React Component in page: \\\\\"/_document\\\\\"\"`\n    )\n\n    await session.patch(\n      'pages/_document.js',\n      `\n        import Document, { Html, Head, Main, NextScript } from 'next/document'\n\n        class MyDocument extends Document {\n          static async getInitialProps(ctx) {\n            const initialProps = await Document.getInitialProps(ctx)\n            return { ...initialProps }\n          }\n\n          render() {\n            return (\n              <Html>\n                <Head />\n                <body>\n                  <Main />\n                  <NextScript />\n                </body>\n              </Html>\n            )\n          }\n        }\n\n        export default MyDocument\n      `\n    )\n    expect(await session.hasRedbox()).toBe(false)\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox-app-doc.test.ts","skipped":false,"dir":"test"},{"name":"_app syntax error shows logbox","suites":["ReactRefreshLogBox"],"updatePoint":{"line":94,"column":38},"line":94,"code":"  test('_app syntax error shows logbox', async () => {\n    const { session, cleanup } = await sandbox(\n      next,\n      new Map([\n        [\n          'pages/_app.js',\n          `\n            function MyApp({ Component, pageProps }) {\n              return <<Component {...pageProps} />;\n            }\n            export default MyApp\n          `,\n        ],\n      ])\n    )\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxSource()).toMatchSnapshot()\n\n    await session.patch(\n      'pages/_app.js',\n      `\n        function MyApp({ Component, pageProps }) {\n          return <Component {...pageProps} />;\n        }\n        export default MyApp\n      `\n    )\n    expect(await session.hasRedbox()).toBe(false)\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox-app-doc.test.ts","skipped":false,"dir":"test"},{"name":"_document syntax error shows logbox","suites":["ReactRefreshLogBox"],"updatePoint":{"line":125,"column":43},"line":125,"code":"  test('_document syntax error shows logbox', async () => {\n    const { session, cleanup } = await sandbox(\n      next,\n      new Map([\n        [\n          'pages/_document.js',\n          `\n            import Document, { Html, Head, Main, NextScript } from 'next/document'\n\n            class MyDocument extends Document {{\n              static async getInitialProps(ctx) {\n                const initialProps = await Document.getInitialProps(ctx)\n                return { ...initialProps }\n              }\n\n              render() {\n                return (\n                  <Html>\n                    <Head />\n                    <body>\n                      <Main />\n                      <NextScript />\n                    </body>\n                  </Html>\n                )\n              }\n            }\n\n            export default MyDocument\n          `,\n        ],\n      ])\n    )\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxSource()).toMatchSnapshot()\n\n    await session.patch(\n      'pages/_document.js',\n      `\n        import Document, { Html, Head, Main, NextScript } from 'next/document'\n\n        class MyDocument extends Document {\n          static async getInitialProps(ctx) {\n            const initialProps = await Document.getInitialProps(ctx)\n            return { ...initialProps }\n          }\n\n          render() {\n            return (\n              <Html>\n                <Head />\n                <body>\n                  <Main />\n                  <NextScript />\n                </body>\n              </Html>\n            )\n          }\n        }\n\n        export default MyDocument\n      `\n    )\n    expect(await session.hasRedbox()).toBe(false)\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox-app-doc.test.ts","skipped":false,"dir":"test"},{"name":"Node.js builtins","suites":["ReactRefreshLogBox"],"updatePoint":{"line":17,"column":24},"line":17,"code":"  test('Node.js builtins', async () => {\n    const { session, cleanup } = await sandbox(\n      next,\n      new Map([\n        [\n          'node_modules/my-package/index.js',\n          `\n          const dns = require('dns')\n          module.exports = dns\n        `,\n        ],\n        [\n          'node_modules/my-package/package.json',\n          `\n          {\n            \"name\": \"my-package\",\n            \"version\": \"0.0.1\"\n          }\n        `,\n        ],\n      ])\n    )\n\n    await session.patch(\n      'index.js',\n      `\n      import pkg from 'my-package'\n\n      export default function Hello() {\n        return (pkg ? <h1>Package loaded</h1> : <h1>Package did not load</h1>)\n      }\n    `\n    )\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxSource()).toMatchSnapshot()\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox-builtins.test.ts","skipped":false,"dir":"test"},{"name":"Module not found","suites":["ReactRefreshLogBox"],"updatePoint":{"line":56,"column":24},"line":56,"code":"  test('Module not found', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.patch(\n      'index.js',\n      `import Comp from 'b'\n      export default function Oops() {\n        return (\n          <div>\n            <Comp>lol</Comp>\n          </div>\n        )\n      }\n    `\n    )\n\n    expect(await session.hasRedbox(true)).toBe(true)\n\n    const source = await session.getRedboxSource()\n    expect(source).toMatchSnapshot()\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox-builtins.test.ts","skipped":false,"dir":"test"},{"name":"Module not found (empty import trace)","suites":["ReactRefreshLogBox"],"updatePoint":{"line":80,"column":45},"line":80,"code":"  test('Module not found (empty import trace)', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.patch(\n      'pages/index.js',\n      `import Comp from 'b'\n      export default function Oops() {\n        return (\n          <div>\n            <Comp>lol</Comp>\n          </div>\n        )\n      }\n    `\n    )\n\n    expect(await session.hasRedbox(true)).toBe(true)\n\n    const source = await session.getRedboxSource()\n    expect(source).toMatchSnapshot()\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox-builtins.test.ts","skipped":false,"dir":"test"},{"name":"Module not found (missing global CSS)","suites":["ReactRefreshLogBox"],"updatePoint":{"line":104,"column":45},"line":104,"code":"  test('Module not found (missing global CSS)', async () => {\n    const { session, cleanup } = await sandbox(\n      next,\n      new Map([\n        [\n          'pages/_app.js',\n          `\n        import './non-existent.css'\n        \n        export default function App({ Component, pageProps }) {\n          return <Component {...pageProps} />\n        }\n      `,\n        ],\n        [\n          'pages/index.js',\n          `\n        export default function Page(props) {\n          return <p>index page</p>\n        }\n      `,\n        ],\n      ])\n    )\n    expect(await session.hasRedbox(true)).toBe(true)\n\n    const source = await session.getRedboxSource()\n    expect(source).toMatchSnapshot()\n\n    await session.patch(\n      'pages/_app.js',\n      `\n      export default function App({ Component, pageProps }) {\n        return <Component {...pageProps} />\n      }\n    `\n    )\n    expect(await session.hasRedbox(false)).toBe(false)\n    expect(\n      await session.evaluate(() => document.documentElement.innerHTML)\n    ).toContain('index page')\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox-builtins.test.ts","skipped":false,"dir":"test"},{"name":"scss syntax errors","suites":["ReactRefreshLogBox"],"updatePoint":{"line":22,"column":26},"line":22,"code":"  test('scss syntax errors', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.write('index.module.scss', `.button { font-size: 5px; }`)\n    await session.patch(\n      'index.js',\n      `\n        import './index.module.scss';\n        export default () => {\n          return (\n            <div>\n              <p>lol</p>\n            </div>\n          )\n        }\n      `\n    )\n\n    expect(await session.hasRedbox()).toBe(false)\n\n    // Syntax error\n    await session.patch('index.module.scss', `.button { font-size: :5px; }`)\n    expect(await session.hasRedbox(true)).toBe(true)\n    const source = await session.getRedboxSource()\n    expect(source).toMatchSnapshot()\n\n    // Not local error\n    await session.patch('index.module.scss', `button { font-size: 5px; }`)\n    expect(await session.hasRedbox(true)).toBe(true)\n    const source2 = await session.getRedboxSource()\n    expect(source2).toMatchSnapshot()\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox-scss.test.ts","skipped":true,"dir":"test"},{"name":"should strip whitespace correctly with newline","suites":["ReactRefreshLogBox"],"updatePoint":{"line":18,"column":54},"line":18,"code":"  test('should strip whitespace correctly with newline', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.patch(\n      'index.js',\n      `\n        export default function Page() {\n          return (\n            <>\n            \n                          <p>index page</p>\n\n                          <a onClick={() => {\n                            throw new Error('idk')\n                          }}>\n                            click me\n                          </a>\n            </>\n          )\n        }\n      `\n    )\n    await session.evaluate(() => document.querySelector('a').click())\n\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxSource()).toMatchSnapshot()\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox.test.ts","skipped":false,"dir":"test"},{"name":"logbox: can recover from a syntax error without losing state","suites":["ReactRefreshLogBox"],"updatePoint":{"line":48,"column":68},"line":48,"code":"  test('logbox: can recover from a syntax error without losing state', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.patch(\n      'index.js',\n      `\n        import { useCallback, useState } from 'react'\n\n        export default function Index() {\n          const [count, setCount] = useState(0)\n          const increment = useCallback(() => setCount(c => c + 1), [setCount])\n          return (\n            <main>\n              <p>{count}</p>\n              <button onClick={increment}>Increment</button>\n            </main>\n          )\n        }\n      `\n    )\n\n    await session.evaluate(() => document.querySelector('button').click())\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('1')\n\n    await session.patch('index.js', `export default () => <div/`)\n\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxSource()).toMatchSnapshot()\n\n    await session.patch(\n      'index.js',\n      `\n        import { useCallback, useState } from 'react'\n\n        export default function Index() {\n          const [count, setCount] = useState(0)\n          const increment = useCallback(() => setCount(c => c + 1), [setCount])\n          return (\n            <main>\n              <p>Count: {count}</p>\n              <button onClick={increment}>Increment</button>\n            </main>\n          )\n        }\n      `\n    )\n\n    await check(\n      () => session.evaluate(() => document.querySelector('p').textContent),\n      /Count: 1/\n    )\n\n    expect(await session.hasRedbox()).toBe(false)\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox.test.ts","skipped":false,"dir":"test"},{"name":"logbox: can recover from a event handler error","suites":["ReactRefreshLogBox"],"updatePoint":{"line":107,"column":54},"line":107,"code":"  test('logbox: can recover from a event handler error', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.patch(\n      'index.js',\n      `\n        import { useCallback, useState } from 'react'\n\n        export default function Index() {\n          const [count, setCount] = useState(0)\n          const increment = useCallback(() => {\n            setCount(c => c + 1)\n            throw new Error('oops')\n          }, [setCount])\n          return (\n            <main>\n              <p>{count}</p>\n              <button onClick={increment}>Increment</button>\n            </main>\n          )\n        }\n      `\n    )\n\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('0')\n    await session.evaluate(() => document.querySelector('button').click())\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('1')\n\n    expect(await session.hasRedbox(true)).toBe(true)\n    if (process.platform === 'win32') {\n      expect(await session.getRedboxSource()).toMatchSnapshot()\n    } else {\n      expect(await session.getRedboxSource()).toMatchSnapshot()\n    }\n\n    await session.patch(\n      'index.js',\n      `\n        import { useCallback, useState } from 'react'\n\n        export default function Index() {\n          const [count, setCount] = useState(0)\n          const increment = useCallback(() => setCount(c => c + 1), [setCount])\n          return (\n            <main>\n              <p>Count: {count}</p>\n              <button onClick={increment}>Increment</button>\n            </main>\n          )\n        }\n      `\n    )\n\n    expect(await session.hasRedbox()).toBe(false)\n\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('Count: 1')\n    await session.evaluate(() => document.querySelector('button').click())\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('Count: 2')\n\n    expect(await session.hasRedbox()).toBe(false)\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox.test.ts","skipped":false,"dir":"test"},{"name":"logbox: can recover from a component error","suites":["ReactRefreshLogBox"],"updatePoint":{"line":179,"column":50},"line":179,"code":"  test('logbox: can recover from a component error', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.write(\n      'child.js',\n      `\n        export default function Child() {\n          return <p>Hello</p>;\n        }\n      `\n    )\n\n    await session.patch(\n      'index.js',\n      `\n        import Child from './child'\n\n        export default function Index() {\n          return (\n            <main>\n              <Child />\n            </main>\n          )\n        }\n      `\n    )\n\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('Hello')\n\n    await session.patch(\n      'child.js',\n      `\n        // hello\n        export default function Child() {\n          throw new Error('oops')\n        }\n      `\n    )\n\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxSource()).toMatchSnapshot()\n\n    const didNotReload = await session.patch(\n      'child.js',\n      `\n        export default function Child() {\n          return <p>Hello</p>;\n        }\n      `\n    )\n\n    expect(didNotReload).toBe(true)\n    expect(await session.hasRedbox()).toBe(false)\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('Hello')\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox.test.ts","skipped":false,"dir":"test"},{"name":"render error not shown right after syntax error","suites":["ReactRefreshLogBox"],"updatePoint":{"line":242,"column":55},"line":242,"code":"  test('render error not shown right after syntax error', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    // Starting here:\n    await session.patch(\n      'index.js',\n      `\n        import * as React from 'react';\n        class ClassDefault extends React.Component {\n          render() {\n            return <h1>Default Export</h1>;\n          }\n        }\n\n        export default ClassDefault;\n      `\n    )\n\n    expect(\n      await session.evaluate(() => document.querySelector('h1').textContent)\n    ).toBe('Default Export')\n\n    // Break it with a syntax error:\n    await session.patch(\n      'index.js',\n      `\n        import * as React from 'react';\n\n        class ClassDefault extends React.Component {\n          render()\n            return <h1>Default Export</h1>;\n          }\n        }\n\n        export default ClassDefault;\n      `\n    )\n    expect(await session.hasRedbox(true)).toBe(true)\n\n    // Now change the code to introduce a runtime error without fixing the syntax error:\n    await session.patch(\n      'index.js',\n      `\n        import * as React from 'react';\n\n        class ClassDefault extends React.Component {\n          render()\n            throw new Error('nooo');\n            return <h1>Default Export</h1>;\n          }\n        }\n\n        export default ClassDefault;\n      `\n    )\n    expect(await session.hasRedbox(true)).toBe(true)\n\n    // Now fix the syntax error:\n    await session.patch(\n      'index.js',\n      `\n        import * as React from 'react';\n\n        class ClassDefault extends React.Component {\n          render() {\n            throw new Error('nooo');\n            return <h1>Default Export</h1>;\n          }\n        }\n\n        export default ClassDefault;\n      `\n    )\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxSource()).toMatchSnapshot()\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox.test.ts","skipped":false,"dir":"test"},{"name":"module init error not shown","suites":["ReactRefreshLogBox"],"updatePoint":{"line":322,"column":35},"line":322,"code":"  test('module init error not shown', async () => {\n    // Start here:\n    const { session, cleanup } = await sandbox(next)\n\n    // We start here.\n    await session.patch(\n      'index.js',\n      `\n        import * as React from 'react';\n        class ClassDefault extends React.Component {\n          render() {\n            return <h1>Default Export</h1>;\n          }\n        }\n        export default ClassDefault;\n      `\n    )\n\n    expect(\n      await session.evaluate(() => document.querySelector('h1').textContent)\n    ).toBe('Default Export')\n\n    // Add a throw in module init phase:\n    await session.patch(\n      'index.js',\n      `\n        // top offset for snapshot\n        import * as React from 'react';\n        throw new Error('no')\n        class ClassDefault extends React.Component {\n          render() {\n            return <h1>Default Export</h1>;\n          }\n        }\n        export default ClassDefault;\n      `\n    )\n\n    expect(await session.hasRedbox(true)).toBe(true)\n    if (process.platform === 'win32') {\n      expect(await session.getRedboxSource()).toMatchSnapshot()\n    } else {\n      expect(await session.getRedboxSource()).toMatchSnapshot()\n    }\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox.test.ts","skipped":false,"dir":"test"},{"name":"stuck error","suites":["ReactRefreshLogBox"],"updatePoint":{"line":371,"column":19},"line":371,"code":"  test('stuck error', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    // We start here.\n    await session.patch(\n      'index.js',\n      `\n        import * as React from 'react';\n\n        function FunctionDefault() {\n          return <h1>Default Export Function</h1>;\n        }\n\n        export default FunctionDefault;\n      `\n    )\n\n    // We add a new file. Let's call it Foo.js.\n    await session.write(\n      'Foo.js',\n      `\n        // intentionally skips export\n        export default function Foo() {\n          return React.createElement('h1', null, 'Foo');\n        }\n      `\n    )\n\n    // We edit our first file to use it.\n    await session.patch(\n      'index.js',\n      `\n        import * as React from 'react';\n        import Foo from './Foo';\n        function FunctionDefault() {\n          return <Foo />;\n        }\n        export default FunctionDefault;\n      `\n    )\n\n    // We get an error because Foo didn't import React. Fair.\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxSource()).toMatchSnapshot()\n\n    // Let's add that to Foo.\n    await session.patch(\n      'Foo.js',\n      `\n        import * as React from 'react';\n        export default function Foo() {\n          return React.createElement('h1', null, 'Foo');\n        }\n      `\n    )\n\n    // Expected: this fixes the problem\n    expect(await session.hasRedbox()).toBe(false)\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox.test.ts","skipped":false,"dir":"test"},{"name":"syntax > runtime error","suites":["ReactRefreshLogBox"],"updatePoint":{"line":434,"column":30},"line":434,"code":"  test('syntax > runtime error', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    // Start here.\n    await session.patch(\n      'index.js',\n      `\n        import * as React from 'react';\n\n        export default function FunctionNamed() {\n          return <div />\n        }\n      `\n    )\n    // TODO: this acts weird without above step\n    await session.patch(\n      'index.js',\n      `\n        import * as React from 'react';\n        let i = 0\n        setInterval(() => {\n          i++\n          throw Error('no ' + i)\n        }, 1000)\n        export default function FunctionNamed() {\n          return <div />\n        }\n      `\n    )\n\n    await new Promise((resolve) => setTimeout(resolve, 1000))\n    expect(await session.hasRedbox(true)).toBe(true)\n    if (process.platform === 'win32') {\n      expect(await session.getRedboxSource()).toMatchSnapshot()\n    } else {\n      expect(await session.getRedboxSource()).toMatchSnapshot()\n    }\n\n    // Make a syntax error.\n    await session.patch(\n      'index.js',\n      `\n        import * as React from 'react';\n        let i = 0\n        setInterval(() => {\n          i++\n          throw Error('no ' + i)\n        }, 1000)\n        export default function FunctionNamed() {`\n    )\n\n    await new Promise((resolve) => setTimeout(resolve, 1000))\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxSource()).toMatchSnapshot()\n\n    // Test that runtime error does not take over:\n    await new Promise((resolve) => setTimeout(resolve, 2000))\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxSource()).toMatchSnapshot()\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox.test.ts","skipped":false,"dir":"test"},{"name":"boundaries","suites":["ReactRefreshLogBox"],"updatePoint":{"line":498,"column":18},"line":498,"code":"  test('boundaries', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.write(\n      'FunctionDefault.js',\n      `\n        export default function FunctionDefault() {\n          return <h2>hello</h2>\n        }\n      `\n    )\n    await session.patch(\n      'index.js',\n      `\n        import FunctionDefault from './FunctionDefault.js'\n        import * as React from 'react'\n        class ErrorBoundary extends React.Component {\n          constructor() {\n            super()\n            this.state = { hasError: false, error: null };\n          }\n          static getDerivedStateFromError(error) {\n            return {\n              hasError: true,\n              error\n            };\n          }\n          render() {\n            if (this.state.hasError) {\n              return this.props.fallback;\n            }\n            return this.props.children;\n          }\n        }\n        function App() {\n          return (\n            <ErrorBoundary fallback={<h2>error</h2>}>\n              <FunctionDefault />\n            </ErrorBoundary>\n          );\n        }\n        export default App;\n      `\n    )\n\n    expect(\n      await session.evaluate(() => document.querySelector('h2').textContent)\n    ).toBe('hello')\n\n    await session.write(\n      'FunctionDefault.js',\n      `export default function FunctionDefault() { throw new Error('no'); }`\n    )\n\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxSource()).toMatchSnapshot()\n    expect(\n      await session.evaluate(() => document.querySelector('h2').textContent)\n    ).toBe('error')\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox.test.ts","skipped":false,"dir":"test"},{"name":"internal package errors","suites":["ReactRefreshLogBox"],"line":564,"code":"  test.skip('internal package errors', async () => {","file":"development/acceptance/ReactRefreshLogBox.test.ts","skipped":true,"dir":"test"},{"name":"unterminated JSX","suites":["ReactRefreshLogBox"],"updatePoint":{"line":587,"column":24},"line":587,"code":"  test('unterminated JSX', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.patch(\n      'index.js',\n      `\n        export default () => {\n          return (\n            <div>\n              <p>lol</p>\n            </div>\n          )\n        }\n      `\n    )\n\n    expect(await session.hasRedbox()).toBe(false)\n\n    await session.patch(\n      'index.js',\n      `\n        export default () => {\n          return (\n            <div>\n              <p>lol</p>\n            div\n          )\n        }\n      `\n    )\n\n    expect(await session.hasRedbox(true)).toBe(true)\n\n    const source = await session.getRedboxSource()\n    expect(source).toMatchSnapshot()\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox.test.ts","skipped":false,"dir":"test"},{"name":"conversion to class component (1)","suites":["ReactRefreshLogBox"],"updatePoint":{"line":627,"column":41},"line":627,"code":"  test('conversion to class component (1)', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.write(\n      'Child.js',\n      `\n        export default function ClickCount() {\n          return <p>hello</p>\n        }\n      `\n    )\n\n    await session.patch(\n      'index.js',\n      `\n        import Child from './Child';\n\n        export default function Home() {\n          return (\n            <div>\n              <Child />\n            </div>\n          )\n        }\n      `\n    )\n\n    expect(await session.hasRedbox()).toBe(false)\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('hello')\n\n    await session.patch(\n      'Child.js',\n      `\n        import { Component } from 'react';\n        export default class ClickCount extends Component {\n          render() {\n            throw new Error()\n          }\n        }\n      `\n    )\n\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxSource()).toMatchSnapshot()\n\n    await session.patch(\n      'Child.js',\n      `\n      import { Component } from 'react';\n        export default class ClickCount extends Component {\n          render() {\n            return <p>hello new</p>\n          }\n        }\n      `\n    )\n\n    expect(await session.hasRedbox()).toBe(false)\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('hello new')\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox.test.ts","skipped":false,"dir":"test"},{"name":"css syntax errors","suites":["ReactRefreshLogBox"],"updatePoint":{"line":694,"column":25},"line":694,"code":"  test('css syntax errors', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.write('index.module.css', `.button {}`)\n    await session.patch(\n      'index.js',\n      `\n        import './index.module.css';\n        export default () => {\n          return (\n            <div>\n              <p>lol</p>\n            </div>\n          )\n        }\n      `\n    )\n\n    expect(await session.hasRedbox()).toBe(false)\n\n    // Syntax error\n    await session.patch('index.module.css', `.button {`)\n    expect(await session.hasRedbox(true)).toBe(true)\n    const source = await session.getRedboxSource()\n    expect(source).toMatch('./index.module.css:1:1')\n    expect(source).toMatch('Syntax error: ')\n    expect(source).toMatch('Unclosed block')\n    expect(source).toMatch('> 1 | .button {')\n    expect(source).toMatch('    | ^')\n\n    // Not local error\n    await session.patch('index.module.css', `button {}`)\n    expect(await session.hasRedbox(true)).toBe(true)\n    const source2 = await session.getRedboxSource()\n    expect(source2).toMatchSnapshot()\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox.test.ts","skipped":false,"dir":"test"},{"name":"logbox: anchors links in error messages","suites":["ReactRefreshLogBox"],"updatePoint":{"line":733,"column":47},"line":733,"code":"  test('logbox: anchors links in error messages', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.patch(\n      'index.js',\n      `\n        import { useCallback } from 'react'\n\n        export default function Index() {\n          const boom = useCallback(() => {\n            throw new Error('end http://nextjs.org')\n          }, [])\n          return (\n            <main>\n              <button onClick={boom}>Boom!</button>\n            </main>\n          )\n        }\n      `\n    )\n\n    expect(await session.hasRedbox()).toBe(false)\n    await session.evaluate(() => document.querySelector('button').click())\n    expect(await session.hasRedbox(true)).toBe(true)\n\n    const header = await session.getRedboxDescription()\n    expect(header).toMatchSnapshot()\n    expect(\n      await session.evaluate(\n        () =>\n          document\n            .querySelector('body > nextjs-portal')\n            .shadowRoot.querySelectorAll('#nextjs__container_errors_desc a')\n            .length\n      )\n    ).toBe(1)\n    expect(\n      await session.evaluate(\n        () =>\n          (\n            document\n              .querySelector('body > nextjs-portal')\n              .shadowRoot.querySelector(\n                '#nextjs__container_errors_desc a:nth-of-type(1)'\n              ) as any\n          ).href\n      )\n    ).toMatchSnapshot()\n\n    await session.patch(\n      'index.js',\n      `\n        import { useCallback } from 'react'\n\n        export default function Index() {\n          const boom = useCallback(() => {\n            throw new Error('http://nextjs.org start')\n          }, [])\n          return (\n            <main>\n              <button onClick={boom}>Boom!</button>\n            </main>\n          )\n        }\n      `\n    )\n\n    expect(await session.hasRedbox()).toBe(false)\n    await session.evaluate(() => document.querySelector('button').click())\n    expect(await session.hasRedbox(true)).toBe(true)\n\n    const header2 = await session.getRedboxDescription()\n    expect(header2).toMatchSnapshot()\n    expect(\n      await session.evaluate(\n        () =>\n          document\n            .querySelector('body > nextjs-portal')\n            .shadowRoot.querySelectorAll('#nextjs__container_errors_desc a')\n            .length\n      )\n    ).toBe(1)\n    expect(\n      await session.evaluate(\n        () =>\n          (\n            document\n              .querySelector('body > nextjs-portal')\n              .shadowRoot.querySelector(\n                '#nextjs__container_errors_desc a:nth-of-type(1)'\n              ) as any\n          ).href\n      )\n    ).toMatchSnapshot()\n\n    await session.patch(\n      'index.js',\n      `\n        import { useCallback } from 'react'\n\n        export default function Index() {\n          const boom = useCallback(() => {\n            throw new Error('middle http://nextjs.org end')\n          }, [])\n          return (\n            <main>\n              <button onClick={boom}>Boom!</button>\n            </main>\n          )\n        }\n      `\n    )\n\n    expect(await session.hasRedbox()).toBe(false)\n    await session.evaluate(() => document.querySelector('button').click())\n    expect(await session.hasRedbox(true)).toBe(true)\n\n    const header3 = await session.getRedboxDescription()\n    expect(header3).toMatchSnapshot()\n    expect(\n      await session.evaluate(\n        () =>\n          document\n            .querySelector('body > nextjs-portal')\n            .shadowRoot.querySelectorAll('#nextjs__container_errors_desc a')\n            .length\n      )\n    ).toBe(1)\n    expect(\n      await session.evaluate(\n        () =>\n          (\n            document\n              .querySelector('body > nextjs-portal')\n              .shadowRoot.querySelector(\n                '#nextjs__container_errors_desc a:nth-of-type(1)'\n              ) as any\n          ).href\n      )\n    ).toMatchSnapshot()\n\n    await session.patch(\n      'index.js',\n      `\n        import { useCallback } from 'react'\n\n        export default function Index() {\n          const boom = useCallback(() => {\n            throw new Error('multiple http://nextjs.org links http://example.com')\n          }, [])\n          return (\n            <main>\n              <button onClick={boom}>Boom!</button>\n            </main>\n          )\n        }\n      `\n    )\n\n    expect(await session.hasRedbox()).toBe(false)\n    await session.evaluate(() => document.querySelector('button').click())\n    expect(await session.hasRedbox(true)).toBe(true)\n\n    const header4 = await session.getRedboxDescription()\n    expect(header4).toMatchInlineSnapshot(\n      `\"Error: multiple http://nextjs.org links http://example.com\"`\n    )\n    expect(\n      await session.evaluate(\n        () =>\n          document\n            .querySelector('body > nextjs-portal')\n            .shadowRoot.querySelectorAll('#nextjs__container_errors_desc a')\n            .length\n      )\n    ).toBe(2)\n    expect(\n      await session.evaluate(\n        () =>\n          (\n            document\n              .querySelector('body > nextjs-portal')\n              .shadowRoot.querySelector(\n                '#nextjs__container_errors_desc a:nth-of-type(1)'\n              ) as any\n          ).href\n      )\n    ).toMatchSnapshot()\n    expect(\n      await session.evaluate(\n        () =>\n          (\n            document\n              .querySelector('body > nextjs-portal')\n              .shadowRoot.querySelector(\n                '#nextjs__container_errors_desc a:nth-of-type(2)'\n              ) as any\n          ).href\n      )\n    ).toMatchSnapshot()\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox.test.ts","skipped":false,"dir":"test"},{"name":"non-Error errors are handled properly","suites":["ReactRefreshLogBox"],"updatePoint":{"line":937,"column":45},"line":937,"code":"  test('non-Error errors are handled properly', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.patch(\n      'index.js',\n      `\n        export default () => {\n          throw {'a': 1, 'b': 'x'};\n          return (\n            <div>hello</div>\n          )\n        }\n      `\n    )\n\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxDescription()).toMatchInlineSnapshot(\n      `\"Error: {\\\\\"a\\\\\":1,\\\\\"b\\\\\":\\\\\"x\\\\\"}\"`\n    )\n\n    // fix previous error\n    await session.patch(\n      'index.js',\n      `\n        export default () => {\n          return (\n            <div>hello</div>\n          )\n        }\n      `\n    )\n    expect(await session.hasRedbox(false)).toBe(false)\n    await session.patch(\n      'index.js',\n      `\n        class Hello {}\n        \n        export default () => {\n          throw Hello\n          return (\n            <div>hello</div>\n          )\n        }\n      `\n    )\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxDescription()).toContain(\n      `Error: class Hello {`\n    )\n\n    // fix previous error\n    await session.patch(\n      'index.js',\n      `\n        export default () => {\n          return (\n            <div>hello</div>\n          )\n        }\n      `\n    )\n    expect(await session.hasRedbox(false)).toBe(false)\n    await session.patch(\n      'index.js',\n      `\n        export default () => {\n          throw \"string error\"\n          return (\n            <div>hello</div>\n          )\n        }\n      `\n    )\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxDescription()).toMatchInlineSnapshot(\n      `\"Error: string error\"`\n    )\n\n    // fix previous error\n    await session.patch(\n      'index.js',\n      `\n        export default () => {\n          return (\n            <div>hello</div>\n          )\n        }\n      `\n    )\n    expect(await session.hasRedbox(false)).toBe(false)\n    await session.patch(\n      'index.js',\n      `\n        export default () => {\n          throw null\n          return (\n            <div>hello</div>\n          )\n        }\n      `\n    )\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxDescription()).toContain(\n      `Error: A null error was thrown`\n    )\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBox.test.ts","skipped":false,"dir":"test"},{"name":"<Link> with multiple children","suites":["ReactRefreshLogBox"],"updatePoint":{"line":18,"column":37},"line":18,"code":"  test('<Link> with multiple children', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.patch(\n      'index.js',\n      `\n        import Link from 'next/link'\n\n        export default function Index() {\n          return (\n            <Link href=\"/\">\n              <p>One</p>\n              <p>Two</p>\n            </Link>\n          )\n        }\n      `\n    )\n\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxDescription()).toMatchInlineSnapshot(\n      `\"Error: Multiple children were passed to <Link> with \\`href\\` of \\`/\\` but only one child is supported https://nextjs.org/docs/messages/link-multiple-children\"`\n    )\n    expect(\n      await session.evaluate(\n        () =>\n          (\n            document\n              .querySelector('body > nextjs-portal')\n              .shadowRoot.querySelector(\n                '#nextjs__container_errors_desc a:nth-of-type(1)'\n              ) as any\n          ).href\n      )\n    ).toMatch('https://nextjs.org/docs/messages/link-multiple-children')\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBoxMisc.test.ts","skipped":true,"dir":"test"},{"name":"<Link> component props errors","suites":["ReactRefreshLogBox"],"updatePoint":{"line":57,"column":37},"line":57,"code":"  test('<Link> component props errors', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.patch(\n      'index.js',\n      `\n        import Link from 'next/link'\n\n        export default function Hello() {\n          return <Link />\n        }\n      `\n    )\n\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxDescription()).toMatchInlineSnapshot(\n      `\"Error: Failed prop type: The prop \\`href\\` expects a \\`string\\` or \\`object\\` in \\`<Link>\\`, but got \\`undefined\\` instead.\"`\n    )\n\n    await session.patch(\n      'index.js',\n      `\n        import Link from 'next/link'\n\n        export default function Hello() {\n          return <Link href=\"/\">Abc</Link>\n        }\n      `\n    )\n    expect(await session.hasRedbox()).toBe(false)\n\n    await session.patch(\n      'index.js',\n      `\n        import Link from 'next/link'\n\n        export default function Hello() {\n          return (\n            <Link\n              href=\"/\"\n              as=\"/\"\n              replace={false}\n              scroll={false}\n              shallow={false}\n              passHref={false}\n              prefetch={false}\n            >\n              Abc\n            </Link>\n          )\n        }\n      `\n    )\n    expect(await session.hasRedbox()).toBe(false)\n\n    await session.patch(\n      'index.js',\n      `\n        import Link from 'next/link'\n\n        export default function Hello() {\n          return (\n            <Link\n              href=\"/\"\n              as=\"/\"\n              replace={true}\n              scroll={true}\n              shallow={true}\n              passHref={true}\n              prefetch={true}\n            >\n              Abc\n            </Link>\n          )\n        }\n      `\n    )\n    expect(await session.hasRedbox()).toBe(false)\n\n    await session.patch(\n      'index.js',\n      `\n        import Link from 'next/link'\n\n        export default function Hello() {\n          return (\n            <Link\n              href=\"/\"\n              as=\"/\"\n              replace={undefined}\n              scroll={undefined}\n              shallow={undefined}\n              passHref={undefined}\n              prefetch={undefined}\n            >\n              Abc\n            </Link>\n          )\n        }\n      `\n    )\n    expect(await session.hasRedbox()).toBe(false)\n\n    await session.patch(\n      'index.js',\n      `\n        import Link from 'next/link'\n\n        export default function Hello() {\n          return (\n            <Link\n              href=\"/\"\n              as=\"/\"\n              replace={undefined}\n              scroll={'oops'}\n              shallow={undefined}\n              passHref={undefined}\n              prefetch={undefined}\n            >\n              Abc\n            </Link>\n          )\n        }\n      `\n    )\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxDescription()).toMatchSnapshot()\n\n    await session.patch(\n      'index.js',\n      `\n        import Link from 'next/link'\n\n        export default function Hello() {\n          return (\n            <Link\n              href={false}\n              as=\"/\"\n              replace={undefined}\n              scroll={'oops'}\n              shallow={undefined}\n              passHref={undefined}\n              prefetch={undefined}\n            >\n              Abc\n            </Link>\n          )\n        }\n      `\n    )\n    expect(await session.hasRedbox(true)).toBe(true)\n    expect(await session.getRedboxDescription()).toMatchSnapshot()\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBoxMisc.test.ts","skipped":true,"dir":"test"},{"name":"server-side only compilation errors","suites":["ReactRefreshLogBox"],"updatePoint":{"line":213,"column":43},"line":213,"code":"  test('server-side only compilation errors', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.patch(\n      'pages/index.js',\n      `\n        import myLibrary from 'my-non-existent-library'\n        export async function getStaticProps() {\n          return {\n            props: {\n              result: myLibrary()\n            }\n          }\n        }\n        export default function Hello(props) {\n          return <h1>{props.result}</h1>\n        }\n      `\n    )\n\n    expect(await session.hasRedbox(true)).toBe(true)\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshLogBoxMisc.test.ts","skipped":true,"dir":"test"},{"name":"should allow any variable names","suites":["ReactRefreshModule"],"updatePoint":{"line":16,"column":37},"line":16,"code":"  it('should allow any variable names', async () => {\n    const { session, cleanup } = await sandbox(next, new Map([]))\n    expect(await session.hasRedbox()).toBe(false)\n\n    const variables = [\n      '_a',\n      '_b',\n      'currentExports',\n      'prevExports',\n      'isNoLongerABoundary',\n    ]\n\n    for await (const variable of variables) {\n      await session.patch(\n        'pages/index.js',\n        `import { default as ${variable} } from 'next/link'\n        export default function Page() {\n          return null\n        }`\n      )\n      expect(await session.hasRedbox()).toBe(false)\n      expect(next.cliOutput).not.toContain(\n        `'${variable}' has already been declared`\n      )\n    }\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshModule.test.ts","skipped":false,"dir":"test"},{"name":"styled-components hydration mismatch","suites":["ReactRefreshRegression"],"updatePoint":{"line":23,"column":44},"line":23,"code":"  test('styled-components hydration mismatch', async () => {\n    const files = new Map()\n    files.set(\n      'pages/_document.js',\n      `\n        import Document from 'next/document'\n        import { ServerStyleSheet } from 'styled-components'\n\n        export default class MyDocument extends Document {\n          static async getInitialProps(ctx) {\n            const sheet = new ServerStyleSheet()\n            const originalRenderPage = ctx.renderPage\n\n            try {\n              ctx.renderPage = () =>\n                originalRenderPage({\n                  enhanceApp: App => props => sheet.collectStyles(<App {...props} />),\n                })\n\n              const initialProps = await Document.getInitialProps(ctx)\n              return {\n                ...initialProps,\n                styles: (\n                  <>\n                    {initialProps.styles}\n                    {sheet.getStyleElement()}\n                  </>\n                ),\n              }\n            } finally {\n              sheet.seal()\n            }\n          }\n        }\n      `\n    )\n\n    const { session, cleanup } = await sandbox(next, files)\n\n    // We start here.\n    await session.patch(\n      'index.js',\n      `\n        import React from 'react'\n        import styled from 'styled-components'\n\n        const Title = styled.h1\\`\n          color: red;\n          font-size: 50px;\n        \\`\n\n        export default () => <Title>My page</Title>\n      `\n    )\n\n    // Verify no hydration mismatch:\n    expect(await session.hasRedbox()).toBe(false)\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshRegression.test.ts","skipped":false,"dir":"test"},{"name":"can fast refresh a page with getStaticProps","suites":["ReactRefreshRegression"],"updatePoint":{"line":85,"column":51},"line":85,"code":"  test('can fast refresh a page with getStaticProps', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.patch(\n      'pages/index.js',\n      `\n        import { useCallback, useState } from 'react'\n\n        export function getStaticProps() {\n          return { props: { } }\n        }\n\n        export default function Index() {\n          const [count, setCount] = useState(0)\n          const increment = useCallback(() => setCount(c => c + 1), [setCount])\n          return (\n            <main>\n              <p>{count}</p>\n              <button onClick={increment}>Increment</button>\n            </main>\n          )\n        }\n      `\n    )\n\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('0')\n    await session.evaluate(() => document.querySelector('button').click())\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('1')\n\n    await session.patch(\n      'pages/index.js',\n      `\n        import { useCallback, useState } from 'react'\n\n        export default function Index() {\n          const [count, setCount] = useState(0)\n          const increment = useCallback(() => setCount(c => c + 1), [setCount])\n          return (\n            <main>\n              <p>Count: {count}</p>\n              <button onClick={increment}>Increment</button>\n            </main>\n          )\n        }\n      `\n    )\n\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('Count: 1')\n    await session.evaluate(() => document.querySelector('button').click())\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('Count: 2')\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshRegression.test.ts","skipped":false,"dir":"test"},{"name":"can fast refresh a page with getServerSideProps","suites":["ReactRefreshRegression"],"updatePoint":{"line":148,"column":55},"line":148,"code":"  test('can fast refresh a page with getServerSideProps', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.patch(\n      'pages/index.js',\n      `\n        import { useCallback, useState } from 'react'\n\n        export function getServerSideProps() {\n          return { props: { } }\n        }\n\n        export default function Index() {\n          const [count, setCount] = useState(0)\n          const increment = useCallback(() => setCount(c => c + 1), [setCount])\n          return (\n            <main>\n              <p>{count}</p>\n              <button onClick={increment}>Increment</button>\n            </main>\n          )\n        }\n      `\n    )\n\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('0')\n    await session.evaluate(() => document.querySelector('button').click())\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('1')\n\n    await session.patch(\n      'pages/index.js',\n      `\n        import { useCallback, useState } from 'react'\n\n        export default function Index() {\n          const [count, setCount] = useState(0)\n          const increment = useCallback(() => setCount(c => c + 1), [setCount])\n          return (\n            <main>\n              <p>Count: {count}</p>\n              <button onClick={increment}>Increment</button>\n            </main>\n          )\n        }\n      `\n    )\n\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('Count: 1')\n    await session.evaluate(() => document.querySelector('button').click())\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('Count: 2')\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshRegression.test.ts","skipped":false,"dir":"test"},{"name":"can fast refresh a page with config","suites":["ReactRefreshRegression"],"updatePoint":{"line":211,"column":43},"line":211,"code":"  test('can fast refresh a page with config', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.patch(\n      'pages/index.js',\n      `\n        import { useCallback, useState } from 'react'\n\n        export const config = {}\n\n        export default function Index() {\n          const [count, setCount] = useState(0)\n          const increment = useCallback(() => setCount(c => c + 1), [setCount])\n          return (\n            <main>\n              <p>{count}</p>\n              <button onClick={increment}>Increment</button>\n            </main>\n          )\n        }\n      `\n    )\n\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('0')\n    await session.evaluate(() => document.querySelector('button').click())\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('1')\n\n    await session.patch(\n      'pages/index.js',\n      `\n        import { useCallback, useState } from 'react'\n\n        export default function Index() {\n          const [count, setCount] = useState(0)\n          const increment = useCallback(() => setCount(c => c + 1), [setCount])\n          return (\n            <main>\n              <p>Count: {count}</p>\n              <button onClick={increment}>Increment</button>\n            </main>\n          )\n        }\n      `\n    )\n\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('Count: 1')\n    await session.evaluate(() => document.querySelector('button').click())\n    expect(\n      await session.evaluate(() => document.querySelector('p').textContent)\n    ).toBe('Count: 2')\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshRegression.test.ts","skipped":false,"dir":"test"},{"name":"shows an overlay for a server-side error","suites":["ReactRefreshRegression"],"updatePoint":{"line":272,"column":48},"line":272,"code":"  test('shows an overlay for a server-side error', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.patch(\n      'pages/index.js',\n      `export default function () { throw new Error('pre boom'); }`\n    )\n\n    const didNotReload = await session.patch(\n      'pages/index.js',\n      `export default function () { throw new Error('boom'); }`\n    )\n    expect(didNotReload).toBe(false)\n\n    expect(await session.hasRedbox(true)).toBe(true)\n\n    const source = await session.getRedboxSource()\n    expect(source.split(/\\r?\\n/g).slice(2).join('\\n')).toMatchInlineSnapshot(`\n      \"> 1 | export default function () { throw new Error('boom'); }\n          |                                   ^\"\n    `)\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshRegression.test.ts","skipped":false,"dir":"test"},{"name":"custom loader (mdx) should have Fast Refresh enabled","suites":["ReactRefreshRegression"],"updatePoint":{"line":298,"column":60},"line":298,"code":"  test('custom loader (mdx) should have Fast Refresh enabled', async () => {\n    const files = new Map()\n    files.set(\n      'next.config.js',\n      `\n        const withMDX = require(\"@next/mdx\")({\n          extension: /\\\\.mdx?$/,\n        });\n        module.exports = withMDX({\n          pageExtensions: [\"js\", \"mdx\"],\n        });\n      `\n    )\n    files.set('pages/index.mdx', `Hello World!`)\n\n    const { session, cleanup } = await sandbox(next, files, false)\n    expect(\n      await session.evaluate(\n        () => document.querySelector('#__next').textContent\n      )\n    ).toBe('Hello World!')\n\n    let didNotReload = await session.patch('pages/index.mdx', `Hello Foo!`)\n    expect(didNotReload).toBe(true)\n    expect(await session.hasRedbox()).toBe(false)\n    expect(\n      await session.evaluate(\n        () => document.querySelector('#__next').textContent\n      )\n    ).toBe('Hello Foo!')\n\n    didNotReload = await session.patch('pages/index.mdx', `Hello Bar!`)\n    expect(didNotReload).toBe(true)\n    expect(await session.hasRedbox()).toBe(false)\n    expect(\n      await session.evaluate(\n        () => document.querySelector('#__next').textContent\n      )\n    ).toBe('Hello Bar!')\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshRegression.test.ts","skipped":false,"dir":"test"},{"name":"re-runs accepted modules","suites":["ReactRefreshRequire"],"updatePoint":{"line":18,"column":32},"line":18,"code":"  test('re-runs accepted modules', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.patch(\n      'index.js',\n      `export default function Noop() { return null; };`\n    )\n\n    await session.write(\n      './foo.js',\n      `window.log.push('init FooV1'); require('./bar');`\n    )\n    await session.write(\n      './bar.js',\n      `window.log.push('init BarV1'); export default function Bar() { return null; };`\n    )\n\n    await session.evaluate(() => ((window as any).log = []))\n    await session.patch(\n      'index.js',\n      `require('./foo'); export default function Noop() { return null; };`\n    )\n    expect(await session.evaluate(() => (window as any).log)).toEqual([\n      'init FooV1',\n      'init BarV1',\n    ])\n\n    // We only edited Bar, and it accepted.\n    // So we expect it to re-run alone.\n    await session.evaluate(() => ((window as any).log = []))\n    await session.patch(\n      './bar.js',\n      `window.log.push('init BarV2'); export default function Bar() { return null; };`\n    )\n    expect(await session.evaluate(() => (window as any).log)).toEqual([\n      'init BarV2',\n    ])\n\n    // We only edited Bar, and it accepted.\n    // So we expect it to re-run alone.\n    await session.evaluate(() => ((window as any).log = []))\n    await session.patch(\n      './bar.js',\n      `window.log.push('init BarV3'); export default function Bar() { return null; };`\n    )\n    expect(await session.evaluate(() => (window as any).log)).toEqual([\n      'init BarV3',\n    ])\n\n    // TODO:\n    // expect(Refresh.performReactRefresh).toHaveBeenCalled();\n    // expect(Refresh.performFullRefresh).not.toHaveBeenCalled();\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshRequire.test.ts","skipped":false,"dir":"test"},{"name":"propagates a hot update to closest accepted module","suites":["ReactRefreshRequire"],"updatePoint":{"line":75,"column":58},"line":75,"code":"  test('propagates a hot update to closest accepted module', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.patch(\n      'index.js',\n      `export default function Noop() { return null; };`\n    )\n\n    await session.write(\n      './foo.js',\n      `\n      window.log.push('init FooV1');\n      require('./bar');\n\n      // Exporting a component marks it as auto-accepting.\n      export default function Foo() {};\n      `\n    )\n\n    await session.write('./bar.js', `window.log.push('init BarV1');`)\n\n    await session.evaluate(() => ((window as any).log = []))\n    await session.patch(\n      'index.js',\n      `require('./foo'); export default function Noop() { return null; };`\n    )\n\n    expect(await session.evaluate(() => (window as any).log)).toEqual([\n      'init FooV1',\n      'init BarV1',\n    ])\n\n    // We edited Bar, but it doesn't accept.\n    // So we expect it to re-run together with Foo which does.\n    await session.evaluate(() => ((window as any).log = []))\n    await session.patch('./bar.js', `window.log.push('init BarV2');`)\n    expect(await session.evaluate(() => (window as any).log)).toEqual([\n      // // FIXME: Metro order:\n      // 'init BarV2',\n      // 'init FooV1',\n      'init FooV1',\n      'init BarV2',\n      // Webpack runs in this order because it evaluates modules parent down, not\n      // child up. Parents will re-run child modules in the order that they're\n      // imported from the parent.\n    ])\n\n    // We edited Bar, but it doesn't accept.\n    // So we expect it to re-run together with Foo which does.\n    await session.evaluate(() => ((window as any).log = []))\n    await session.patch('./bar.js', `window.log.push('init BarV3');`)\n    expect(await session.evaluate(() => (window as any).log)).toEqual([\n      // // FIXME: Metro order:\n      // 'init BarV3',\n      // 'init FooV1',\n      'init FooV1',\n      'init BarV3',\n      // Webpack runs in this order because it evaluates modules parent down, not\n      // child up. Parents will re-run child modules in the order that they're\n      // imported from the parent.\n    ])\n\n    // We edited Bar so that it accepts itself.\n    // We still re-run Foo because the exports of Bar changed.\n    await session.evaluate(() => ((window as any).log = []))\n    await session.patch(\n      './bar.js',\n      `\n      window.log.push('init BarV3');\n      // Exporting a component marks it as auto-accepting.\n      export default function Bar() {};\n      `\n    )\n    expect(await session.evaluate(() => (window as any).log)).toEqual([\n      // // FIXME: Metro order:\n      // 'init BarV3',\n      // 'init FooV1',\n      'init FooV1',\n      'init BarV3',\n      // Webpack runs in this order because it evaluates modules parent down, not\n      // child up. Parents will re-run child modules in the order that they're\n      // imported from the parent.\n    ])\n\n    // Further edits to Bar don't re-run Foo.\n    await session.evaluate(() => ((window as any).log = []))\n    await session.patch(\n      './bar.js',\n      `\n      window.log.push('init BarV4');\n      export default function Bar() {};\n      `\n    )\n    expect(await session.evaluate(() => (window as any).log)).toEqual([\n      'init BarV4',\n    ])\n\n    // TODO:\n    // expect(Refresh.performReactRefresh).toHaveBeenCalled();\n    // expect(Refresh.performFullRefresh).not.toHaveBeenCalled();\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshRequire.test.ts","skipped":false,"dir":"test"},{"name":"propagates hot update to all inverse dependencies","suites":["ReactRefreshRequire"],"updatePoint":{"line":179,"column":57},"line":179,"code":"  test('propagates hot update to all inverse dependencies', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    await session.patch(\n      'index.js',\n      `export default function Noop() { return null; };`\n    )\n\n    // This is the module graph:\n    //        MiddleA*\n    //     /            \\\n    // Root* - MiddleB*  - Leaf\n    //     \\\n    //        MiddleC\n    //\n    // * - accepts update\n    //\n    // We expect that editing Leaf will propagate to\n    // MiddleA and MiddleB both of which can handle updates.\n\n    await session.write(\n      'root.js',\n      `\n      window.log.push('init RootV1');\n\n      import './middleA';\n      import './middleB';\n      import './middleC';\n\n      export default function Root() {};\n      `\n    )\n    await session.write(\n      'middleA.js',\n      `\n      log.push('init MiddleAV1');\n\n      import './leaf';\n\n      export default function MiddleA() {};\n      `\n    )\n    await session.write(\n      'middleB.js',\n      `\n      log.push('init MiddleBV1');\n\n      import './leaf';\n\n      export default function MiddleB() {};\n      `\n    )\n    // This one doesn't import leaf and also doesn't export a component (so it\n    // doesn't accept updates).\n    await session.write(\n      'middleC.js',\n      `log.push('init MiddleCV1'); export default {};`\n    )\n\n    // Doesn't accept its own updates; they will propagate.\n    await session.write(\n      'leaf.js',\n      `log.push('init LeafV1'); export default {};`\n    )\n\n    // Bootstrap:\n    await session.evaluate(() => ((window as any).log = []))\n    await session.patch(\n      'index.js',\n      `require('./root'); export default function Noop() { return null; };`\n    )\n\n    expect(await session.evaluate(() => (window as any).log)).toEqual([\n      'init LeafV1',\n      'init MiddleAV1',\n      'init MiddleBV1',\n      'init MiddleCV1',\n      'init RootV1',\n    ])\n\n    // We edited Leaf, but it doesn't accept.\n    // So we expect it to re-run together with MiddleA and MiddleB which do.\n    await session.evaluate(() => ((window as any).log = []))\n    await session.patch(\n      'leaf.js',\n      `log.push('init LeafV2'); export default {};`\n    )\n    expect(await session.evaluate(() => (window as any).log)).toEqual([\n      'init LeafV2',\n      'init MiddleAV1',\n      'init MiddleBV1',\n    ])\n\n    // Let's try the same one more time.\n    await session.evaluate(() => ((window as any).log = []))\n    await session.patch(\n      'leaf.js',\n      `log.push('init LeafV3'); export default {};`\n    )\n    expect(await session.evaluate(() => (window as any).log)).toEqual([\n      'init LeafV3',\n      'init MiddleAV1',\n      'init MiddleBV1',\n    ])\n\n    // Now edit MiddleB. It should accept and re-run alone.\n    await session.evaluate(() => ((window as any).log = []))\n    await session.patch(\n      'middleB.js',\n      `\n      log.push('init MiddleBV2');\n\n      import './leaf';\n\n      export default function MiddleB() {};\n      `\n    )\n    expect(await session.evaluate(() => (window as any).log)).toEqual([\n      'init MiddleBV2',\n    ])\n\n    // Finally, edit MiddleC. It didn't accept so it should bubble to Root.\n    await session.evaluate(() => ((window as any).log = []))\n\n    await session.patch(\n      'middleC.js',\n      `log.push('init MiddleCV2'); export default {};`\n    )\n    expect(await session.evaluate(() => (window as any).log)).toEqual([\n      'init MiddleCV2',\n      'init RootV1',\n    ])\n\n    // TODO:\n    // expect(Refresh.performReactRefresh).toHaveBeenCalled()\n    // expect(Refresh.performFullRefresh).not.toHaveBeenCalled()\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshRequire.test.ts","skipped":false,"dir":"test"},{"name":"runs dependencies before dependents","suites":["ReactRefreshRequire"],"updatePoint":{"line":320,"column":43},"line":320,"code":"  test('runs dependencies before dependents', async () => {\n    // TODO:\n  })","file":"development/acceptance/ReactRefreshRequire.test.ts","skipped":false,"dir":"test"},{"name":"provides fresh value for module.exports in parents","suites":["ReactRefreshRequire"],"updatePoint":{"line":325,"column":58},"line":325,"code":"  test('provides fresh value for module.exports in parents', async () => {\n    // TODO:\n  })","file":"development/acceptance/ReactRefreshRequire.test.ts","skipped":false,"dir":"test"},{"name":"provides fresh value for exports.* in parents","suites":["ReactRefreshRequire"],"updatePoint":{"line":330,"column":53},"line":330,"code":"  test('provides fresh value for exports.* in parents', async () => {\n    // TODO:\n  })","file":"development/acceptance/ReactRefreshRequire.test.ts","skipped":false,"dir":"test"},{"name":"provides fresh value for ES6 named import in parents","suites":["ReactRefreshRequire"],"updatePoint":{"line":335,"column":60},"line":335,"code":"  test('provides fresh value for ES6 named import in parents', async () => {\n    // TODO:\n  })","file":"development/acceptance/ReactRefreshRequire.test.ts","skipped":false,"dir":"test"},{"name":"provides fresh value for ES6 default import in parents","suites":["ReactRefreshRequire"],"updatePoint":{"line":340,"column":62},"line":340,"code":"  test('provides fresh value for ES6 default import in parents', async () => {\n    // TODO:\n  })","file":"development/acceptance/ReactRefreshRequire.test.ts","skipped":false,"dir":"test"},{"name":"stops update propagation after module-level errors","suites":["ReactRefreshRequire"],"updatePoint":{"line":345,"column":58},"line":345,"code":"  test('stops update propagation after module-level errors', async () => {\n    // TODO:\n  })","file":"development/acceptance/ReactRefreshRequire.test.ts","skipped":false,"dir":"test"},{"name":"can continue hot updates after module-level errors with module.exports","suites":["ReactRefreshRequire"],"updatePoint":{"line":350,"column":78},"line":350,"code":"  test('can continue hot updates after module-level errors with module.exports', async () => {\n    // TODO:\n  })","file":"development/acceptance/ReactRefreshRequire.test.ts","skipped":false,"dir":"test"},{"name":"can continue hot updates after module-level errors with ES6 exports","suites":["ReactRefreshRequire"],"updatePoint":{"line":355,"column":75},"line":355,"code":"  test('can continue hot updates after module-level errors with ES6 exports', async () => {\n    // TODO:\n  })","file":"development/acceptance/ReactRefreshRequire.test.ts","skipped":false,"dir":"test"},{"name":"does not accumulate stale exports over time","suites":["ReactRefreshRequire"],"updatePoint":{"line":360,"column":51},"line":360,"code":"  test('does not accumulate stale exports over time', async () => {\n    // TODO:\n  })","file":"development/acceptance/ReactRefreshRequire.test.ts","skipped":false,"dir":"test"},{"name":"bails out if update bubbles to the root via the only path","suites":["ReactRefreshRequire"],"updatePoint":{"line":365,"column":65},"line":365,"code":"  test('bails out if update bubbles to the root via the only path', async () => {\n    // TODO:\n  })","file":"development/acceptance/ReactRefreshRequire.test.ts","skipped":false,"dir":"test"},{"name":"bails out if the update bubbles to the root via one of the paths","suites":["ReactRefreshRequire"],"updatePoint":{"line":370,"column":72},"line":370,"code":"  test('bails out if the update bubbles to the root via one of the paths', async () => {\n    // TODO:\n  })","file":"development/acceptance/ReactRefreshRequire.test.ts","skipped":false,"dir":"test"},{"name":"propagates a module that stops accepting in next version","suites":["ReactRefreshRequire"],"updatePoint":{"line":375,"column":64},"line":375,"code":"  test('propagates a module that stops accepting in next version', async () => {\n    const { session, cleanup } = await sandbox(next)\n\n    // Accept in parent\n    await session.write(\n      './foo.js',\n      `;(typeof global !== 'undefined' ? global : window).log.push('init FooV1'); import './bar'; export default function Foo() {};`\n    )\n    // Accept in child\n    await session.write(\n      './bar.js',\n      `;(typeof global !== 'undefined' ? global : window).log.push('init BarV1'); export default function Bar() {};`\n    )\n\n    // Bootstrap:\n    await session.patch(\n      'index.js',\n      `;(typeof global !== 'undefined' ? global : window).log = []; require('./foo'); export default () => null;`\n    )\n    expect(await session.evaluate(() => (window as any).log)).toEqual([\n      'init BarV1',\n      'init FooV1',\n    ])\n\n    let didFullRefresh = false\n    // Verify the child can accept itself:\n    await session.evaluate(() => ((window as any).log = []))\n    didFullRefresh =\n      didFullRefresh ||\n      !(await session.patch(\n        './bar.js',\n        `window.log.push('init BarV1.1'); export default function Bar() {};`\n      ))\n    expect(await session.evaluate(() => (window as any).log)).toEqual([\n      'init BarV1.1',\n    ])\n\n    // Now let's change the child to *not* accept itself.\n    // We'll expect that now the parent will handle the evaluation.\n    await session.evaluate(() => ((window as any).log = []))\n    didFullRefresh =\n      didFullRefresh ||\n      !(await session.patch(\n        './bar.js',\n        // It's important we still export _something_, otherwise webpack will\n        // also emit an extra update to the parent module. This happens because\n        // webpack converts the module from ESM to CJS, which means the parent\n        // module must update how it \"imports\" the module (drops interop code).\n        // TODO: propose that webpack interrupts the current update phase when\n        // `module.hot.invalidate()` is called.\n        `window.log.push('init BarV2'); export {};`\n      ))\n    // We re-run Bar and expect to stop there. However,\n    // it didn't export a component, so we go higher.\n    // We stop at Foo which currently _does_ export a component.\n    expect(await session.evaluate(() => (window as any).log)).toEqual([\n      // Bar evaluates twice:\n      // 1. To invalidate itself once it realizes it's no longer acceptable.\n      // 2. As a child of Foo re-evaluating.\n      'init BarV2',\n      'init BarV2',\n      'init FooV1',\n    ])\n\n    // Change it back so that the child accepts itself.\n    await session.evaluate(() => ((window as any).log = []))\n    didFullRefresh =\n      didFullRefresh ||\n      !(await session.patch(\n        './bar.js',\n        `window.log.push('init BarV2'); export default function Bar() {};`\n      ))\n    // Since the export list changed, we have to re-run both the parent\n    // and the child.\n    expect(await session.evaluate(() => (window as any).log)).toEqual([\n      'init BarV2',\n      'init FooV1',\n    ])\n\n    // TODO:\n    // expect(Refresh.performReactRefresh).toHaveBeenCalled();\n\n    // expect(Refresh.performFullRefresh).not.toHaveBeenCalled();\n    expect(didFullRefresh).toBe(false)\n\n    // But editing the child alone now doesn't reevaluate the parent.\n    await session.evaluate(() => ((window as any).log = []))\n    didFullRefresh =\n      didFullRefresh ||\n      !(await session.patch(\n        './bar.js',\n        `window.log.push('init BarV3'); export default function Bar() {};`\n      ))\n    expect(await session.evaluate(() => (window as any).log)).toEqual([\n      'init BarV3',\n    ])\n\n    // Finally, edit the parent in a way that changes the export.\n    // It would still be accepted on its own -- but it's incompatible\n    // with the past version which didn't have two exports.\n    await session.evaluate(() => window.localStorage.setItem('init', ''))\n    didFullRefresh =\n      didFullRefresh ||\n      !(await session.patch(\n        './foo.js',\n        `\n        if (typeof window !== 'undefined' && window.localStorage) {\n          window.localStorage.setItem('init', 'init FooV2')\n        }\n        export function Foo() {};\n        export function FooFoo() {};`\n      ))\n\n    // Check that we attempted to evaluate, but had to fall back to full refresh.\n    expect(\n      await session.evaluate(() => window.localStorage.getItem('init'))\n    ).toEqual('init FooV2')\n\n    // expect(Refresh.performFullRefresh).toHaveBeenCalled();\n    expect(didFullRefresh).toBe(true)\n\n    await cleanup()\n  })","file":"development/acceptance/ReactRefreshRequire.test.ts","skipped":false,"dir":"test"},{"name":"can replace a module before it is loaded","suites":["ReactRefreshRequire"],"updatePoint":{"line":500,"column":48},"line":500,"code":"  test('can replace a module before it is loaded', async () => {\n    // TODO:\n  })","file":"development/acceptance/ReactRefreshRequire.test.ts","skipped":false,"dir":"test"},{"name":"should pass OPTIONS requests to the api function","suites":["Rewritten API Requests should pass OPTIONS requests to the api function"],"updatePoint":{"line":36,"column":54},"line":36,"code":"  it('should pass OPTIONS requests to the api function', async () => {\n    const res = await fetchViaHTTP(next.url, '/some-endpoint', null, {\n      method: 'OPTIONS',\n      headers: {\n        Origin: 'http://localhost:3000',\n      },\n    })\n    expect(await res.text()).toContain('successfully hit some-endpoint!')\n  })","file":"development/api-cors-with-rewrite/index.test.ts","skipped":false,"dir":"test"},{"name":"error","suites":["api-route-errors cli output"],"updatePoint":{"line":20,"column":13},"line":20,"code":"  test('error', async () => {\n    const outputIndex = next.cliOutput.length\n    await renderViaHTTP(next.url, '/api/error')\n    await check(() => next.cliOutput.slice(outputIndex), /pages\\/api/)\n\n    const output = stripAnsi(next.cliOutput.slice(outputIndex))\n    // Location\n    expect(output).toContain('error - (api)/pages/api/error.js (2:8) @ error')\n    // Stack\n    expect(output).toContain('pages/api/error.js:6:11')\n    // Source code\n    expect(output).toContain('1 | export default function error(req, res) {')\n  })","file":"development/api-route-errors/index.test.ts","skipped":false,"dir":"test"},{"name":"uncaught exception","suites":["api-route-errors cli output"],"updatePoint":{"line":34,"column":26},"line":34,"code":"  test('uncaught exception', async () => {\n    const outputIndex = next.cliOutput.length\n    await renderViaHTTP(next.url, '/api/uncaught-exception')\n    await check(() => next.cliOutput.slice(outputIndex), /pages\\/api/)\n\n    const output = stripAnsi(next.cliOutput.slice(outputIndex))\n    // Location\n    expect(output).toContain(\n      'error - (api)/pages/api/uncaught-exception.js (3:10) @ Timeout'\n    )\n    // Stack\n    expect(output).toContain('pages/api/uncaught-exception.js:7:15')\n    // Source code\n    expect(output).toContain(\n      '1 | export default function uncaughtException(req, res) {'\n    )\n  })","file":"development/api-route-errors/index.test.ts","skipped":false,"dir":"test"},{"name":"unhandled rejection","suites":["api-route-errors cli output"],"updatePoint":{"line":52,"column":27},"line":52,"code":"  test('unhandled rejection', async () => {\n    const outputIndex = next.cliOutput.length\n    await renderViaHTTP(next.url, '/api/unhandled-rejection')\n    await check(() => next.cliOutput.slice(outputIndex), /pages\\/api/)\n\n    const output = stripAnsi(next.cliOutput.slice(outputIndex))\n    // Location\n    expect(output).toContain(\n      'error - (api)/pages/api/unhandled-rejection.js (2:17) @ unhandledRejection'\n    )\n    // Stack\n    expect(output).toContain('pages/api/unhandled-rejection.js:6:20')\n    // Source code\n    expect(output).toContain(\n      '1 | export default function unhandledRejection(req, res) '\n    )\n  })","file":"development/api-route-errors/index.test.ts","skipped":false,"dir":"test"},{"name":"should load the page properly","suites":["basic HMR","Hot Module Reloading","delete a page and add it back"],"updatePoint":{"line":34,"column":39},"line":34,"code":"      it('should load the page properly', async () => {\n        const contactPagePath = join('pages', 'hmr', 'contact.js')\n        const newContactPagePath = join('pages', 'hmr', '_contact.js')\n        let browser\n        try {\n          browser = await webdriver(next.appPort, '/docs/hmr/contact')\n          const text = await browser.elementByCss('p').text()\n          expect(text).toBe('This is the contact page.')\n\n          // Rename the file to mimic a deleted page\n          await next.renameFile(contactPagePath, newContactPagePath)\n\n          await check(\n            () => getBrowserBodyText(browser),\n            /This page could not be found/\n          )\n\n          // Rename the file back to the original filename\n          await next.renameFile(newContactPagePath, contactPagePath)\n\n          // wait until the page comes back\n          await check(\n            () => getBrowserBodyText(browser),\n            /This is the contact page/\n          )\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n          await next\n            .renameFile(newContactPagePath, contactPagePath)\n            .catch(() => {})\n        }\n      })","file":"development/basic-basepath/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should detect the changes and display it","suites":["basic HMR","Hot Module Reloading","editing a page"],"updatePoint":{"line":71,"column":50},"line":71,"code":"      it('should detect the changes and display it', async () => {\n        let browser\n        try {\n          browser = await webdriver(next.appPort, '/docs/hmr/about')\n          const text = await browser.elementByCss('p').text()\n          expect(text).toBe('This is the about page.')\n\n          const aboutPagePath = join('pages', 'hmr', 'about.js')\n\n          const originalContent = await next.readFile(aboutPagePath)\n          const editedContent = originalContent.replace(\n            'This is the about page',\n            'COOL page'\n          )\n\n          // change the content\n          try {\n            await next.patchFile(aboutPagePath, editedContent)\n            await check(() => getBrowserBodyText(browser), /COOL page/)\n          } finally {\n            // add the original content\n            await next.patchFile(aboutPagePath, originalContent)\n          }\n\n          await check(\n            () => getBrowserBodyText(browser),\n            /This is the about page/\n          )\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic-basepath/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should not reload unrelated pages","suites":["basic HMR","Hot Module Reloading","editing a page"],"updatePoint":{"line":106,"column":43},"line":106,"code":"      it('should not reload unrelated pages', async () => {\n        let browser\n        try {\n          browser = await webdriver(next.appPort, '/docs/hmr/counter')\n          const text = await browser\n            .elementByCss('button')\n            .click()\n            .elementByCss('button')\n            .click()\n            .elementByCss('p')\n            .text()\n          expect(text).toBe('COUNT: 2')\n\n          const aboutPagePath = join('pages', 'hmr', 'about.js')\n\n          const originalContent = await next.readFile(aboutPagePath)\n          const editedContent = originalContent.replace(\n            'This is the about page',\n            'COOL page'\n          )\n\n          try {\n            // Change the about.js page\n            await next.patchFile(aboutPagePath, editedContent)\n\n            // Check whether the this page has reloaded or not.\n            await check(() => browser.elementByCss('p').text(), /COUNT: 2/)\n          } finally {\n            // restore the about page content.\n            await next.patchFile(aboutPagePath, originalContent)\n          }\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic-basepath/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should update styles correctly","suites":["basic HMR","Hot Module Reloading","editing a page"],"updatePoint":{"line":146,"column":40},"line":146,"code":"      it('should update styles correctly', async () => {\n        let browser\n        try {\n          browser = await webdriver(next.appPort, '/docs/hmr/style')\n          const pTag = await browser.elementByCss('.hmr-style-page p')\n          const initialFontSize = await pTag.getComputedCss('font-size')\n\n          expect(initialFontSize).toBe('100px')\n\n          const pagePath = join('pages', 'hmr', 'style.js')\n\n          const originalContent = await next.readFile(pagePath)\n          const editedContent = originalContent.replace('100px', '200px')\n\n          // Change the page\n          await next.patchFile(pagePath, editedContent)\n\n          try {\n            // Check whether the this page has reloaded or not.\n            await check(async () => {\n              const editedPTag = await browser.elementByCss('.hmr-style-page p')\n              return editedPTag.getComputedCss('font-size')\n            }, /200px/)\n          } finally {\n            // Finally is used so that we revert the content back to the original regardless of the test outcome\n            // restore the about page content.\n            await next.patchFile(pagePath, originalContent)\n          }\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic-basepath/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should update styles in a stateful component correctly","suites":["basic HMR","Hot Module Reloading","editing a page"],"updatePoint":{"line":183,"column":64},"line":183,"code":"      it('should update styles in a stateful component correctly', async () => {\n        let browser\n        const pagePath = join('pages', 'hmr', 'style-stateful-component.js')\n        const originalContent = await next.readFile(pagePath)\n        try {\n          browser = await webdriver(\n            next.appPort,\n            '/docs/hmr/style-stateful-component'\n          )\n          const pTag = await browser.elementByCss('.hmr-style-page p')\n          const initialFontSize = await pTag.getComputedCss('font-size')\n\n          expect(initialFontSize).toBe('100px')\n          const editedContent = originalContent.replace('100px', '200px')\n\n          // Change the page\n          await next.patchFile(pagePath, editedContent)\n\n          // Check whether the this page has reloaded or not.\n          await check(async () => {\n            const editedPTag = await browser.elementByCss('.hmr-style-page p')\n            return editedPTag.getComputedCss('font-size')\n          }, /200px/)\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n          await next.patchFile(pagePath, originalContent)\n        }\n      })","file":"development/basic-basepath/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should update styles in a dynamic component correctly","suites":["basic HMR","Hot Module Reloading","editing a page"],"updatePoint":{"line":216,"column":63},"line":216,"code":"      it('should update styles in a dynamic component correctly', async () => {\n        let browser = null\n        let secondBrowser = null\n        const pagePath = join('components', 'hmr', 'dynamic.js')\n        const originalContent = await next.readFile(pagePath)\n        try {\n          browser = await webdriver(\n            next.appPort,\n            '/docs/hmr/style-dynamic-component'\n          )\n          const div = await browser.elementByCss('#dynamic-component')\n          const initialClientClassName = await div.getAttribute('class')\n          const initialFontSize = await div.getComputedCss('font-size')\n\n          expect(initialFontSize).toBe('100px')\n\n          const initialHtml = await renderViaHTTP(\n            next.appPort,\n            '/docs/hmr/style-dynamic-component'\n          )\n          expect(initialHtml.includes('100px')).toBeTruthy()\n\n          const $initialHtml = cheerio.load(initialHtml)\n          const initialServerClassName =\n            $initialHtml('#dynamic-component').attr('class')\n\n          expect(initialClientClassName === initialServerClassName).toBeTruthy()\n\n          const editedContent = originalContent.replace('100px', '200px')\n\n          // Change the page\n          await next.patchFile(pagePath, editedContent)\n\n          // wait for 5 seconds\n          await waitFor(5000)\n\n          secondBrowser = await webdriver(\n            next.appPort,\n            '/docs/hmr/style-dynamic-component'\n          )\n          // Check whether the this page has reloaded or not.\n          const editedDiv = await secondBrowser.elementByCss(\n            '#dynamic-component'\n          )\n          const editedClientClassName = await editedDiv.getAttribute('class')\n          const editedFontSize = await editedDiv.getComputedCss('font-size')\n          const browserHtml = await secondBrowser.eval(\n            'document.documentElement.innerHTML'\n          )\n\n          expect(editedFontSize).toBe('200px')\n          expect(browserHtml.includes('font-size:200px')).toBe(true)\n          expect(browserHtml.includes('font-size:100px')).toBe(false)\n\n          const editedHtml = await renderViaHTTP(\n            next.appPort,\n            '/docs/hmr/style-dynamic-component'\n          )\n          expect(editedHtml.includes('200px')).toBeTruthy()\n          const $editedHtml = cheerio.load(editedHtml)\n          const editedServerClassName =\n            $editedHtml('#dynamic-component').attr('class')\n\n          expect(editedClientClassName === editedServerClassName).toBe(true)\n        } finally {\n          // Finally is used so that we revert the content back to the original regardless of the test outcome\n          // restore the about page content.\n          await next.patchFile(pagePath, originalContent)\n\n          if (browser) {\n            await browser.close()\n          }\n\n          if (secondBrowser) {\n            secondBrowser.close()\n          }\n        }\n      })","file":"development/basic-basepath/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should recover from 404 after a page has been added","suites":["basic HMR","Error Recovery"],"updatePoint":{"line":298,"column":59},"line":298,"code":"    it('should recover from 404 after a page has been added', async () => {\n      let browser\n      const newPage = join('pages', 'hmr', 'new-page.js')\n\n      try {\n        browser = await webdriver(next.appPort, '/docs/hmr/new-page')\n\n        expect(await browser.elementByCss('body').text()).toMatch(\n          /This page could not be found/\n        )\n\n        // Add the page\n        await next.patchFile(\n          newPage,\n          'export default () => (<div id=\"new-page\">the-new-page</div>)'\n        )\n\n        await check(() => getBrowserBodyText(browser), /the-new-page/)\n\n        await next.deleteFile(newPage)\n\n        await check(\n          () => getBrowserBodyText(browser),\n          /This page could not be found/\n        )\n      } catch (err) {\n        await next.deleteFile(newPage)\n        throw err\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"development/basic-basepath/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should detect syntax errors and recover","suites":["basic HMR","Error Recovery"],"updatePoint":{"line":333,"column":47},"line":333,"code":"    it('should detect syntax errors and recover', async () => {\n      let browser\n      const aboutPage = join('pages', 'hmr', 'about2.js')\n      const aboutContent = await next.readFile(aboutPage)\n      try {\n        browser = await webdriver(next.appPort, '/docs/hmr/about2')\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n\n        await next.patchFile(aboutPage, aboutContent.replace('</div>', 'div'))\n\n        expect(await hasRedbox(browser)).toBe(true)\n        expect(await getRedboxSource(browser)).toMatch(/Unexpected eof/)\n\n        await next.patchFile(aboutPage, aboutContent)\n\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n      } catch (err) {\n        await next.patchFile(aboutPage, aboutContent)\n        if (browser) {\n          await check(\n            () => getBrowserBodyText(browser),\n            /This is the about page/\n          )\n        }\n\n        throw err\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"development/basic-basepath/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should show the error on all pages","suites":["basic HMR","Error Recovery"],"updatePoint":{"line":366,"column":42},"line":366,"code":"    it('should show the error on all pages', async () => {\n      const aboutPage = join('pages', 'hmr', 'about2.js')\n      const aboutContent = await next.readFile(aboutPage)\n      let browser\n      try {\n        await renderViaHTTP(next.appPort, '/docs/hmr/about2')\n\n        await next.patchFile(aboutPage, aboutContent.replace('</div>', 'div'))\n\n        // Ensure dev server has time to break:\n        await new Promise((resolve) => setTimeout(resolve, 2000))\n\n        browser = await webdriver(next.appPort, '/docs/hmr/contact')\n\n        expect(await hasRedbox(browser)).toBe(true)\n        expect(await getRedboxSource(browser)).toMatch(/Unexpected eof/)\n\n        await next.patchFile(aboutPage, aboutContent)\n\n        await check(\n          () => getBrowserBodyText(browser),\n          /This is the contact page/\n        )\n      } catch (err) {\n        await next.patchFile(aboutPage, aboutContent)\n        if (browser) {\n          await check(\n            () => getBrowserBodyText(browser),\n            /This is the contact page/\n          )\n        }\n\n        throw err\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"development/basic-basepath/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should detect runtime errors on the module scope","suites":["basic HMR","Error Recovery"],"updatePoint":{"line":406,"column":56},"line":406,"code":"    it('should detect runtime errors on the module scope', async () => {\n      let browser\n      const aboutPage = join('pages', 'hmr', 'about3.js')\n      const aboutContent = await next.readFile(aboutPage)\n      try {\n        browser = await webdriver(next.appPort, '/docs/hmr/about3')\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n\n        await next.patchFile(\n          aboutPage,\n          aboutContent.replace('export', 'aa=20;\\nexport')\n        )\n\n        expect(await hasRedbox(browser)).toBe(true)\n        expect(await getRedboxHeader(browser)).toMatch(/aa is not defined/)\n\n        await next.patchFile(aboutPage, aboutContent)\n\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n      } finally {\n        await next.patchFile(aboutPage, aboutContent)\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"development/basic-basepath/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should recover from errors in the render function","suites":["basic HMR","Error Recovery"],"updatePoint":{"line":433,"column":57},"line":433,"code":"    it('should recover from errors in the render function', async () => {\n      let browser\n      const aboutPage = join('pages', 'hmr', 'about4.js')\n      const aboutContent = await next.readFile(aboutPage)\n      try {\n        browser = await webdriver(next.appPort, '/docs/hmr/about4')\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n\n        await next.patchFile(\n          aboutPage,\n          aboutContent.replace(\n            'return',\n            'throw new Error(\"an-expected-error\");\\nreturn'\n          )\n        )\n\n        expect(await hasRedbox(browser)).toBe(true)\n        expect(await getRedboxSource(browser)).toMatch(/an-expected-error/)\n\n        await next.patchFile(aboutPage, aboutContent)\n\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n      } catch (err) {\n        await next.patchFile(aboutPage, aboutContent)\n        if (browser) {\n          await check(\n            () => getBrowserBodyText(browser),\n            /This is the about page/\n          )\n        }\n\n        throw err\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"development/basic-basepath/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should recover after exporting an invalid page","suites":["basic HMR","Error Recovery"],"updatePoint":{"line":472,"column":54},"line":472,"code":"    it('should recover after exporting an invalid page', async () => {\n      let browser\n      const aboutPage = join('pages', 'hmr', 'about5.js')\n      const aboutContent = await next.readFile(aboutPage)\n      try {\n        browser = await webdriver(next.appPort, '/docs/hmr/about5')\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n\n        await next.patchFile(\n          aboutPage,\n          aboutContent.replace(\n            'export default',\n            'export default {};\\nexport const fn ='\n          )\n        )\n\n        expect(await hasRedbox(browser)).toBe(true)\n        expect(await getRedboxHeader(browser)).toMatchInlineSnapshot(`\n          \" 1 of 1 unhandled error\n          Server Error\n\n          Error: The default export is not a React Component in page: \\\\\"/hmr/about5\\\\\"\n\n          This error happened while generating the page. Any console logs will be displayed in the terminal window.\"\n        `)\n\n        await next.patchFile(aboutPage, aboutContent)\n\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n      } catch (err) {\n        await next.patchFile(aboutPage, aboutContent)\n\n        if (browser) {\n          await check(\n            () => getBrowserBodyText(browser),\n            /This is the about page/\n          )\n        }\n\n        throw err\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"development/basic-basepath/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should recover after a bad return from the render function","suites":["basic HMR","Error Recovery"],"updatePoint":{"line":519,"column":66},"line":519,"code":"    it('should recover after a bad return from the render function', async () => {\n      let browser\n      const aboutPage = join('pages', 'hmr', 'about6.js')\n      const aboutContent = await next.readFile(aboutPage)\n      try {\n        browser = await webdriver(next.appPort, '/docs/hmr/about6')\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n\n        await next.patchFile(\n          aboutPage,\n          aboutContent.replace(\n            'export default',\n            'export default () => /search/;\\nexport const fn ='\n          )\n        )\n\n        const isReact17 = process.env.NEXT_TEST_REACT_VERSION === '^17'\n\n        expect(await hasRedbox(browser)).toBe(true)\n        // TODO: Replace this when webpack 5 is the default\n        expect(\n          (await getRedboxHeader(browser)).replace(\n            '__WEBPACK_DEFAULT_EXPORT__',\n            'Unknown'\n          )\n        ).toMatch(\n          `Objects are not valid as a React child (found: ${\n            isReact17 ? '/search/' : '[object RegExp]'\n          }). If you meant to render a collection of children, use an array instead.`\n        )\n\n        await next.patchFile(aboutPage, aboutContent)\n\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n      } catch (err) {\n        await next.patchFile(aboutPage, aboutContent)\n\n        if (browser) {\n          await check(\n            () => getBrowserBodyText(browser),\n            /This is the about page/\n          )\n        }\n\n        throw err\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"development/basic-basepath/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should recover after undefined exported as default","suites":["basic HMR","Error Recovery"],"updatePoint":{"line":571,"column":58},"line":571,"code":"    it('should recover after undefined exported as default', async () => {\n      let browser\n      const aboutPage = join('pages', 'hmr', 'about7.js')\n\n      const aboutContent = await next.readFile(aboutPage)\n      try {\n        browser = await webdriver(next.appPort, '/docs/hmr/about7')\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n\n        await next.patchFile(\n          aboutPage,\n          aboutContent.replace(\n            'export default',\n            'export default undefined;\\nexport const fn ='\n          )\n        )\n\n        expect(await hasRedbox(browser)).toBe(true)\n        expect(await getRedboxHeader(browser)).toMatchInlineSnapshot(`\n          \" 1 of 1 unhandled error\n          Server Error\n\n          Error: The default export is not a React Component in page: \\\\\"/hmr/about7\\\\\"\n\n          This error happened while generating the page. Any console logs will be displayed in the terminal window.\"\n        `)\n\n        await next.patchFile(aboutPage, aboutContent)\n\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n        expect(await hasRedbox(browser, false)).toBe(false)\n      } catch (err) {\n        await next.patchFile(aboutPage, aboutContent)\n\n        if (browser) {\n          await check(\n            () => getBrowserBodyText(browser),\n            /This is the about page/\n          )\n        }\n\n        throw err\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"development/basic-basepath/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should recover from errors in getInitialProps in client","suites":["basic HMR","Error Recovery"],"updatePoint":{"line":620,"column":63},"line":620,"code":"    it('should recover from errors in getInitialProps in client', async () => {\n      let browser\n      const erroredPage = join('pages', 'hmr', 'error-in-gip.js')\n      const errorContent = await next.readFile(erroredPage)\n      try {\n        browser = await webdriver(next.appPort, '/docs/hmr')\n        await browser.elementByCss('#error-in-gip-link').click()\n\n        expect(await hasRedbox(browser)).toBe(true)\n        expect(await getRedboxHeader(browser)).toMatchInlineSnapshot(`\n          \" 1 of 1 unhandled error\n          Unhandled Runtime Error\n\n          Error: an-expected-error-in-gip\"\n        `)\n\n        await next.patchFile(\n          erroredPage,\n          errorContent.replace('throw error', 'return {}')\n        )\n\n        await check(() => getBrowserBodyText(browser), /Hello/)\n\n        await next.patchFile(erroredPage, errorContent)\n\n        await check(async () => {\n          await browser.refresh()\n          await waitFor(2000)\n          const text = await browser.elementByCss('body').text()\n          if (text.includes('Hello')) {\n            throw new Error('waiting')\n          }\n          return getRedboxSource(browser)\n        }, /an-expected-error-in-gip/)\n      } catch (err) {\n        await next.patchFile(erroredPage, errorContent)\n\n        throw err\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"development/basic-basepath/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should recover after an error reported via SSR","suites":["basic HMR","Error Recovery"],"updatePoint":{"line":665,"column":54},"line":665,"code":"    it('should recover after an error reported via SSR', async () => {\n      let browser\n      const erroredPage = join('pages', 'hmr', 'error-in-gip.js')\n      const errorContent = await next.readFile(erroredPage)\n      try {\n        browser = await webdriver(next.appPort, '/docs/hmr/error-in-gip')\n\n        expect(await hasRedbox(browser)).toBe(true)\n        expect(await getRedboxHeader(browser)).toMatchInlineSnapshot(`\n          \" 1 of 1 unhandled error\n          Server Error\n\n          Error: an-expected-error-in-gip\n\n          This error happened while generating the page. Any console logs will be displayed in the terminal window.\"\n        `)\n\n        const erroredPage = join('pages', 'hmr', 'error-in-gip.js')\n\n        await next.patchFile(\n          erroredPage,\n          errorContent.replace('throw error', 'return {}')\n        )\n\n        await check(() => getBrowserBodyText(browser), /Hello/)\n\n        await next.patchFile(erroredPage, errorContent)\n\n        await check(async () => {\n          await browser.refresh()\n          await waitFor(2000)\n          const text = await getBrowserBodyText(browser)\n          if (text.includes('Hello')) {\n            throw new Error('waiting')\n          }\n          return getRedboxSource(browser)\n        }, /an-expected-error-in-gip/)\n      } catch (err) {\n        await next.patchFile(erroredPage, errorContent)\n\n        throw err\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"development/basic-basepath/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should set process.env.NODE_ENV in development","suites":["misc basic dev tests"],"updatePoint":{"line":24,"column":52},"line":24,"code":"  it('should set process.env.NODE_ENV in development', async () => {\n    const browser = await webdriver(next.appPort, '/docs/process-env')\n    const nodeEnv = await browser.elementByCss('#node-env').text()\n    expect(nodeEnv).toBe('development')\n    await browser.close()\n  })","file":"development/basic-basepath/misc.test.ts","skipped":false,"dir":"test"},{"name":"should allow access to public files","suites":["misc basic dev tests"],"updatePoint":{"line":31,"column":41},"line":31,"code":"  it('should allow access to public files', async () => {\n    const data = await renderViaHTTP(next.appPort, '/docs/data/data.txt')\n    expect(data).toBe('data')\n\n    const legacy = await renderViaHTTP(next.appPort, '/docs/static/legacy.txt')\n    expect(legacy).toMatch(`new static folder`)\n  })","file":"development/basic-basepath/misc.test.ts","skipped":false,"dir":"test"},{"name":"should not allow accessing files outside .next/static and .next/server directory","suites":["misc basic dev tests","With Security Related Issues"],"updatePoint":{"line":40,"column":88},"line":40,"code":"    it('should not allow accessing files outside .next/static and .next/server directory', async () => {\n      const pathsToCheck = [\n        `/docs/_next/static/../BUILD_ID`,\n        `/docs/_next/static/../routes-manifest.json`,\n      ]\n      for (const path of pathsToCheck) {\n        const res = await fetchViaHTTP(next.appPort, path)\n        const text = await res.text()\n        try {\n          expect(res.status).toBe(404)\n          expect(text).toMatch(/This page could not be found/)\n        } catch (err) {\n          throw new Error(`Path ${path} accessible from the browser`)\n        }\n      }\n    })","file":"development/basic-basepath/misc.test.ts","skipped":false,"dir":"test"},{"name":"should handle encoded / value for trailing slash correctly","suites":["misc basic dev tests","With Security Related Issues"],"updatePoint":{"line":57,"column":66},"line":57,"code":"    it('should handle encoded / value for trailing slash correctly', async () => {\n      const res = await fetchViaHTTP(\n        next.appPort,\n        '/docs/%2fexample.com/',\n        undefined,\n        { redirect: 'manual' }\n      )\n\n      const { pathname, hostname } = url.parse(\n        res.headers.get('location') || ''\n      )\n      expect(res.status).toBe(308)\n      expect(pathname).toBe('/docs/%2fexample.com')\n      expect(hostname).not.toBe('example.com')\n      const text = await res.text()\n      expect(text).toEqual('/docs/%2fexample.com')\n    })","file":"development/basic-basepath/misc.test.ts","skipped":false,"dir":"test"},{"name":"should warn when prefetch is true","suites":["misc basic dev tests","Development Logs"],"updatePoint":{"line":96,"column":41},"line":96,"code":"    it('should warn when prefetch is true', async () => {\n      const foundLog = await getLogs$('/docs/development-logs')\n      expect(foundLog).toBe(true)\n    })","file":"development/basic-basepath/misc.test.ts","skipped":false,"dir":"test"},{"name":"should not warn when prefetch is false","suites":["misc basic dev tests","Development Logs"],"updatePoint":{"line":100,"column":46},"line":100,"code":"    it('should not warn when prefetch is false', async () => {\n      const foundLog = await getLogs$(\n        '/docs/development-logs/link-with-prefetch-false'\n      )\n      expect(foundLog).toBe(false)\n    })","file":"development/basic-basepath/misc.test.ts","skipped":false,"dir":"test"},{"name":"should not warn when prefetch is not specified","suites":["misc basic dev tests","Development Logs"],"updatePoint":{"line":106,"column":54},"line":106,"code":"    it('should not warn when prefetch is not specified', async () => {\n      const foundLog = await getLogs$(\n        '/docs/development-logs/link-with-no-prefetch'\n      )\n      expect(foundLog).toBe(false)\n    })","file":"development/basic-basepath/misc.test.ts","skipped":false,"dir":"test"},{"name":"should render dynamic import components","suites":["basic next/dynamic usage","Dynamic import","default behavior"],"updatePoint":{"line":31,"column":49},"line":31,"code":"      it('should render dynamic import components', async () => {\n        const $ = await get$('/docs/dynamic/ssr')\n        // Make sure the client side knows it has to wait for the bundle\n        expect(JSON.parse($('#__NEXT_DATA__').html()).dynamicIds).toContain(\n          'dynamic/ssr.js -> ../../components/hello1'\n        )\n        expect($('body').text()).toMatch(/Hello World 1/)\n      })","file":"development/basic-basepath/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should render dynamic import components using a function as first parameter","suites":["basic next/dynamic usage","Dynamic import","default behavior"],"updatePoint":{"line":40,"column":85},"line":40,"code":"      it('should render dynamic import components using a function as first parameter', async () => {\n        const $ = await get$('/docs/dynamic/function')\n        // Make sure the client side knows it has to wait for the bundle\n        expect(JSON.parse($('#__NEXT_DATA__').html()).dynamicIds).toContain(\n          'dynamic/function.js -> ../../components/hello1'\n        )\n        expect($('body').text()).toMatch(/Hello World 1/)\n      })","file":"development/basic-basepath/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should render even there are no physical chunk exists","suites":["basic next/dynamic usage","Dynamic import","default behavior"],"updatePoint":{"line":49,"column":63},"line":49,"code":"      it('should render even there are no physical chunk exists', async () => {\n        let browser\n        try {\n          browser = await webdriver(next.appPort, '/docs/dynamic/no-chunk')\n          await check(\n            () => browser.elementByCss('body').text(),\n            /Welcome, normal/\n          )\n          await check(\n            () => browser.elementByCss('body').text(),\n            /Welcome, dynamic/\n          )\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic-basepath/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should hydrate nested chunks","suites":["basic next/dynamic usage","Dynamic import","default behavior"],"updatePoint":{"line":68,"column":38},"line":68,"code":"      it('should hydrate nested chunks', async () => {\n        let browser\n        try {\n          browser = await webdriver(next.appPort, '/docs/dynamic/nested')\n          await check(() => browser.elementByCss('body').text(), /Nested 1/)\n          await check(() => browser.elementByCss('body').text(), /Nested 2/)\n          await check(\n            () => browser.elementByCss('body').text(),\n            /Browser hydrated/\n          )\n\n          if ((global as any).browserName === 'chrome') {\n            const logs = await browser.log('browser')\n\n            logs.forEach((logItem) => {\n              expect(logItem.message).not.toMatch(\n                /Expected server HTML to contain/\n              )\n            })\n          }\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic-basepath/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should render the component Head content","suites":["basic next/dynamic usage","Dynamic import","default behavior"],"updatePoint":{"line":95,"column":50},"line":95,"code":"      it('should render the component Head content', async () => {\n        let browser\n        try {\n          browser = await webdriver(next.appPort, '/docs/dynamic/head')\n          await check(() => browser.elementByCss('body').text(), /test/)\n          const backgroundColor = await browser\n            .elementByCss('.dynamic-style')\n            .getComputedCss('background-color')\n          const height = await browser\n            .elementByCss('.dynamic-style')\n            .getComputedCss('height')\n          expect(height).toBe('200px')\n          expect(backgroundColor).toMatch(/rgba?\\(0, 128, 0/)\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic-basepath/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should not render loading on the server side","suites":["basic next/dynamic usage","Dynamic import","ssr:false option"],"updatePoint":{"line":116,"column":54},"line":116,"code":"      it('should not render loading on the server side', async () => {\n        const $ = await get$('/docs/dynamic/no-ssr')\n        expect($('body').html()).not.toContain('\"dynamicIds\"')\n        expect($('body').text()).not.toMatch('loading...')\n      })","file":"development/basic-basepath/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should render the component on client side","suites":["basic next/dynamic usage","Dynamic import","ssr:false option"],"updatePoint":{"line":122,"column":52},"line":122,"code":"      it('should render the component on client side', async () => {\n        let browser\n        try {\n          browser = await webdriver(next.appPort, '/docs/dynamic/no-ssr')\n          await check(\n            () => browser.elementByCss('body').text(),\n            /Hello World 1/\n          )\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic-basepath/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"Should render the component on the server side","suites":["basic next/dynamic usage","Dynamic import","ssr:true option"],"updatePoint":{"line":139,"column":56},"line":139,"code":"      it('Should render the component on the server side', async () => {\n        const $ = await get$('/docs/dynamic/ssr-true')\n        expect($('body').html()).toContain('\"dynamicIds\"')\n        expect($('p').text()).toBe('Hello World 1')\n      })","file":"development/basic-basepath/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should render the component on client side","suites":["basic next/dynamic usage","Dynamic import","ssr:true option"],"updatePoint":{"line":145,"column":52},"line":145,"code":"      it('should render the component on client side', async () => {\n        let browser\n        try {\n          browser = await webdriver(next.appPort, '/docs/dynamic/ssr-true')\n          await check(\n            () => browser.elementByCss('body').text(),\n            /Hello World 1/\n          )\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic-basepath/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should render the correct filename","suites":["basic next/dynamic usage","Dynamic import","custom chunkfilename"],"updatePoint":{"line":162,"column":44},"line":162,"code":"      it('should render the correct filename', async () => {\n        const $ = await get$('/docs/dynamic/chunkfilename')\n        expect($('body').text()).toMatch(/test chunkfilename/)\n        expect($('html').html()).toMatch(/hello-world\\.js/)\n      })","file":"development/basic-basepath/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should render the component on client side","suites":["basic next/dynamic usage","Dynamic import","custom chunkfilename"],"updatePoint":{"line":168,"column":52},"line":168,"code":"      it('should render the component on client side', async () => {\n        let browser\n        try {\n          browser = await webdriver(next.appPort, '/docs/dynamic/chunkfilename')\n          await check(\n            () => browser.elementByCss('body').text(),\n            /test chunkfilename/\n          )\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic-basepath/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should render custom loading on the server side when `ssr:false` and `loading` is provided","suites":["basic next/dynamic usage","Dynamic import","custom loading"],"updatePoint":{"line":185,"column":100},"line":185,"code":"      it('should render custom loading on the server side when `ssr:false` and `loading` is provided', async () => {\n        const $ = await get$('/docs/dynamic/no-ssr-custom-loading')\n        expect($('p').text()).toBe('LOADING')\n      })","file":"development/basic-basepath/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should render the component on client side","suites":["basic next/dynamic usage","Dynamic import","custom loading"],"updatePoint":{"line":190,"column":52},"line":190,"code":"      it('should render the component on client side', async () => {\n        let browser\n        try {\n          browser = await webdriver(\n            next.appPort,\n            '/docs/dynamic/no-ssr-custom-loading'\n          )\n          await check(\n            () => browser.elementByCss('body').text(),\n            /Hello World 1/\n          )\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic-basepath/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should only include the rendered module script tag","suites":["basic next/dynamic usage","Dynamic import","Multiple modules"],"updatePoint":{"line":210,"column":60},"line":210,"code":"      it('should only include the rendered module script tag', async () => {\n        const $ = await get$('/docs/dynamic/multiple-modules')\n        const html = $('html').html()\n        expect(html).toMatch(/hello1\\.js/)\n        expect(html).not.toMatch(/hello2\\.js/)\n      })","file":"development/basic-basepath/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should only load the rendered module in the browser","suites":["basic next/dynamic usage","Dynamic import","Multiple modules"],"updatePoint":{"line":217,"column":61},"line":217,"code":"      it('should only load the rendered module in the browser', async () => {\n        let browser\n        try {\n          browser = await webdriver(\n            next.appPort,\n            '/docs/dynamic/multiple-modules'\n          )\n          const html = await browser.eval('document.documentElement.innerHTML')\n          expect(html).toMatch(/hello1\\.js/)\n          expect(html).not.toMatch(/hello2\\.js/)\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic-basepath/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should only render one bundle if component is used multiple times","suites":["basic next/dynamic usage","Dynamic import","Multiple modules"],"updatePoint":{"line":234,"column":75},"line":234,"code":"      it('should only render one bundle if component is used multiple times', async () => {\n        const $ = await get$('/docs/dynamic/multiple-modules')\n        const html = $('html').html()\n        try {\n          expect(html.match(/chunks[\\\\/]hello1\\.js/g).length).toBe(1)\n          expect(html).not.toMatch(/hello2\\.js/)\n        } catch (err) {\n          console.error(html)\n          throw err\n        }\n      })","file":"development/basic-basepath/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"tsx should compile with useDefineForClassFields enabled","suites":["useDefineForClassFields SWC option"],"updatePoint":{"line":30,"column":61},"line":30,"code":"  it('tsx should compile with useDefineForClassFields enabled', async () => {\n    let browser\n    try {\n      browser = await webdriver(next.appPort, '/')\n      await browser.elementByCss('#action').click()\n      await check(\n        () => browser.elementByCss('#name').text(),\n        /this is my name: next/\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"development/basic/define-class-fields.test.ts","skipped":false,"dir":"test"},{"name":"Initializes resident to undefined after the call to 'super()' when with useDefineForClassFields enabled","suites":["useDefineForClassFields SWC option"],"updatePoint":{"line":46,"column":109},"line":46,"code":"  it(\"Initializes resident to undefined after the call to 'super()' when with useDefineForClassFields enabled\", async () => {\n    let browser\n    try {\n      browser = await webdriver(next.appPort, '/animal')\n      expect(await browser.elementByCss('#dog').text()).toBe('')\n      expect(await browser.elementByCss('#dogDecl').text()).toBe('dog')\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"development/basic/define-class-fields.test.ts","skipped":false,"dir":"test"},{"name":"set accessors from base classes won’t get triggered with useDefineForClassFields enabled","suites":["useDefineForClassFields SWC option"],"updatePoint":{"line":76,"column":94},"line":76,"code":"  it('set accessors from base classes won’t get triggered with useDefineForClassFields enabled', async () => {\n    let browser\n    try {\n      browser = await webdriver(next.appPort, '/derived')\n      await matchLogs$(browser).then(([data_foundLog, name_foundLog]) => {\n        expect(data_foundLog).toBe(true)\n        expect(name_foundLog).toBe(false)\n      })\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"development/basic/define-class-fields.test.ts","skipped":false,"dir":"test"},{"name":"should have styling from the css prop","suites":["emotion SWC option"],"updatePoint":{"line":29,"column":43},"line":29,"code":"  it('should have styling from the css prop', async () => {\n    let browser\n    try {\n      browser = await webdriver(next.appPort, '/')\n      const color = await browser\n        .elementByCss('#test-element')\n        .getComputedCss('background-color')\n      expect(color).toBe('rgb(255, 192, 203)')\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"development/basic/emotion-swc.test.ts","skipped":false,"dir":"test"},{"name":"should not reload page when client-side is changed too GSP","suites":["GS(S)P Server-Side Change Reloading"],"updatePoint":{"line":35,"column":64},"line":35,"code":"  it('should not reload page when client-side is changed too GSP', async () => {\n    const browser = await webdriver(next.url, '/gsp-blog/first')\n    await check(() => browser.elementByCss('#change').text(), 'change me')\n    await browser.eval(`window.beforeChange = 'hi'`)\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n\n    const page = 'pages/gsp-blog/[post].js'\n    const originalContent = await next.readFile(page)\n    await next.patchFile(page, originalContent.replace('change me', 'changed'))\n\n    await check(() => browser.elementByCss('#change').text(), 'changed')\n    expect(await browser.eval(`window.beforeChange`)).toBe('hi')\n\n    const props2 = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props).toEqual(props2)\n\n    await next.patchFile(page, originalContent)\n    await check(() => browser.elementByCss('#change').text(), 'change me')\n  })","file":"development/basic/gssp-ssr-change-reloading/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should update page when getStaticProps is changed only","suites":["GS(S)P Server-Side Change Reloading"],"updatePoint":{"line":56,"column":60},"line":56,"code":"  it('should update page when getStaticProps is changed only', async () => {\n    const browser = await webdriver(next.url, '/gsp-blog/first')\n    await browser.eval(`window.beforeChange = 'hi'`)\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props.count).toBe(1)\n\n    const page = 'pages/gsp-blog/[post].js'\n    const originalContent = await next.readFile(page)\n    await next.patchFile(\n      page,\n      originalContent.replace('count = 1', 'count = 2')\n    )\n\n    await check(\n      async () =>\n        JSON.parse(await browser.elementByCss('#props').text()).count + '',\n      '2'\n    )\n    expect(await browser.eval(`window.beforeChange`)).toBe('hi')\n    await next.patchFile(page, originalContent)\n\n    await check(\n      async () =>\n        JSON.parse(await browser.elementByCss('#props').text()).count + '',\n      '1'\n    )\n  })","file":"development/basic/gssp-ssr-change-reloading/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show indicator when re-fetching data","suites":["GS(S)P Server-Side Change Reloading"],"updatePoint":{"line":85,"column":49},"line":85,"code":"  it('should show indicator when re-fetching data', async () => {\n    const browser = await webdriver(next.url, '/gsp-blog/second')\n    await installCheckVisible(browser)\n    await browser.eval(`window.beforeChange = 'hi'`)\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props.count).toBe(1)\n\n    const page = 'pages/gsp-blog/[post].js'\n    const originalContent = await next.readFile(page)\n    await next.patchFile(\n      page,\n      originalContent.replace('count = 1', 'count = 2')\n    )\n\n    await check(\n      async () =>\n        JSON.parse(await browser.elementByCss('#props').text()).count + '',\n      '2'\n    )\n    expect(await browser.eval(`window.beforeChange`)).toBe('hi')\n    expect(await browser.eval(`window.showedBuilder`)).toBe(true)\n\n    await next.patchFile(page, originalContent)\n    await check(\n      async () =>\n        JSON.parse(await browser.elementByCss('#props').text()).count + '',\n      '1'\n    )\n  })","file":"development/basic/gssp-ssr-change-reloading/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should update page when getStaticPaths is changed only","suites":["GS(S)P Server-Side Change Reloading"],"updatePoint":{"line":116,"column":60},"line":116,"code":"  it('should update page when getStaticPaths is changed only', async () => {\n    const browser = await webdriver(next.url, '/gsp-blog/first')\n    await browser.eval(`window.beforeChange = 'hi'`)\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props.count).toBe(1)\n\n    const page = 'pages/gsp-blog/[post].js'\n    const originalContent = await next.readFile(page)\n    await next.patchFile(\n      page,\n      originalContent.replace('paths = 1', 'paths = 2')\n    )\n\n    expect(await browser.eval('window.beforeChange')).toBe('hi')\n    await next.patchFile(page, originalContent)\n  })","file":"development/basic/gssp-ssr-change-reloading/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should update page when getStaticProps is changed only for /index","suites":["GS(S)P Server-Side Change Reloading"],"updatePoint":{"line":134,"column":71},"line":134,"code":"  it('should update page when getStaticProps is changed only for /index', async () => {\n    const browser = await webdriver(next.url, '/')\n    await browser.eval(`window.beforeChange = 'hi'`)\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props.count).toBe(1)\n\n    const page = 'pages/index.js'\n    const originalContent = await next.readFile(page)\n    await next.patchFile(\n      page,\n      originalContent.replace('count = 1', 'count = 2')\n    )\n\n    expect(await browser.eval('window.beforeChange')).toBe('hi')\n    await next.patchFile(page, originalContent)\n  })","file":"development/basic/gssp-ssr-change-reloading/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should update page when getStaticProps is changed only for /another/index","suites":["GS(S)P Server-Side Change Reloading"],"updatePoint":{"line":152,"column":79},"line":152,"code":"  it('should update page when getStaticProps is changed only for /another/index', async () => {\n    const browser = await webdriver(next.url, '/another')\n    await browser.eval(`window.beforeChange = 'hi'`)\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props.count).toBe(1)\n\n    const page = 'pages/another/index.js'\n    const originalContent = await next.readFile(page)\n    await next.patchFile(\n      page,\n      originalContent.replace('count = 1', 'count = 2')\n    )\n\n    await check(\n      async () =>\n        JSON.parse(await browser.elementByCss('#props').text()).count + '',\n      '2'\n    )\n    expect(await browser.eval('window.beforeChange')).toBe('hi')\n    await next.patchFile(page, originalContent)\n  })","file":"development/basic/gssp-ssr-change-reloading/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should keep scroll position when updating from change in getStaticProps","suites":["GS(S)P Server-Side Change Reloading"],"updatePoint":{"line":175,"column":77},"line":175,"code":"  it('should keep scroll position when updating from change in getStaticProps', async () => {\n    const browser = await webdriver(next.url, '/another')\n    await browser.eval(\n      'document.getElementById(\"scroll-target\").scrollIntoView()'\n    )\n    const scrollPosition = await browser.eval(\n      'document.documentElement.scrollTop'\n    )\n    await browser.eval(`window.beforeChange = 'hi'`)\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props.count).toBe(1)\n\n    const page = 'pages/another/index.js'\n    const originalContent = await next.readFile(page)\n    await next.patchFile(\n      page,\n      originalContent.replace('count = 1', 'count = 2')\n    )\n\n    await check(\n      async () =>\n        JSON.parse(await browser.elementByCss('#props').text()).count + '',\n      '2'\n    )\n    expect(await browser.eval('window.beforeChange')).toBe('hi')\n    expect(await browser.eval('document.documentElement.scrollTop')).toBe(\n      scrollPosition\n    )\n    await next.patchFile(page, originalContent)\n  })","file":"development/basic/gssp-ssr-change-reloading/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not reload page when client-side is changed too GSSP","suites":["GS(S)P Server-Side Change Reloading"],"updatePoint":{"line":207,"column":65},"line":207,"code":"  it('should not reload page when client-side is changed too GSSP', async () => {\n    const browser = await webdriver(next.url, '/gssp-blog/first')\n    await check(() => browser.elementByCss('#change').text(), 'change me')\n    await browser.eval(`window.beforeChange = 'hi'`)\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n\n    const page = 'pages/gssp-blog/[post].js'\n    const originalContent = await next.readFile(page)\n    await next.patchFile(page, originalContent.replace('change me', 'changed'))\n\n    await check(() => browser.elementByCss('#change').text(), 'changed')\n    expect(await browser.eval(`window.beforeChange`)).toBe('hi')\n\n    const props2 = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props).toEqual(props2)\n\n    await next.patchFile(page, originalContent)\n    await check(() => browser.elementByCss('#change').text(), 'change me')\n  })","file":"development/basic/gssp-ssr-change-reloading/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should update page when getServerSideProps is changed only","suites":["GS(S)P Server-Side Change Reloading"],"updatePoint":{"line":228,"column":64},"line":228,"code":"  it('should update page when getServerSideProps is changed only', async () => {\n    const browser = await webdriver(next.url, '/gssp-blog/first')\n    await check(\n      async () =>\n        JSON.parse(await browser.elementByCss('#props').text()).count + '',\n      '1'\n    )\n    await browser.eval(`window.beforeChange = 'hi'`)\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props.count).toBe(1)\n\n    const page = 'pages/gssp-blog/[post].js'\n    const originalContent = await next.readFile(page)\n    await next.patchFile(\n      page,\n      originalContent.replace('count = 1', 'count = 2')\n    )\n\n    await check(\n      async () =>\n        JSON.parse(await browser.elementByCss('#props').text()).count + '',\n      '2'\n    )\n    expect(await browser.eval(`window.beforeChange`)).toBe('hi')\n    await next.patchFile(page, originalContent)\n\n    await check(\n      async () =>\n        JSON.parse(await browser.elementByCss('#props').text()).count + '',\n      '1'\n    )\n  })","file":"development/basic/gssp-ssr-change-reloading/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should update on props error in getStaticProps","suites":["GS(S)P Server-Side Change Reloading"],"updatePoint":{"line":262,"column":52},"line":262,"code":"  it('should update on props error in getStaticProps', async () => {\n    const browser = await webdriver(next.url, '/')\n    await browser.eval(`window.beforeChange = 'hi'`)\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props.count).toBe(1)\n\n    const page = 'pages/index.js'\n    const originalContent = await next.readFile(page)\n\n    try {\n      await next.patchFile(page, originalContent.replace('props:', 'propss:'))\n      expect(await hasRedbox(browser, true)).toBe(true)\n      expect(await getRedboxHeader(browser)).toContain(\n        'Additional keys were returned from'\n      )\n\n      await next.patchFile(page, originalContent)\n      expect(await hasRedbox(browser, false)).toBe(false)\n    } finally {\n      await next.patchFile(page, originalContent)\n    }\n  })","file":"development/basic/gssp-ssr-change-reloading/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should update on thrown error in getStaticProps","suites":["GS(S)P Server-Side Change Reloading"],"updatePoint":{"line":286,"column":53},"line":286,"code":"  it('should update on thrown error in getStaticProps', async () => {\n    const browser = await webdriver(next.url, '/')\n    await browser.eval(`window.beforeChange = 'hi'`)\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props.count).toBe(1)\n\n    const page = 'pages/index.js'\n    const originalContent = await next.readFile(page)\n\n    try {\n      await next.patchFile(\n        page,\n        originalContent.replace(\n          'const count',\n          'throw new Error(\"custom oops\"); const count'\n        )\n      )\n      expect(await hasRedbox(browser, true)).toBe(true)\n      expect(await getRedboxHeader(browser)).toContain('custom oops')\n\n      await next.patchFile(page, originalContent)\n      expect(await hasRedbox(browser, false)).toBe(false)\n    } finally {\n      await next.patchFile(page, originalContent)\n    }\n  })","file":"development/basic/gssp-ssr-change-reloading/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should refresh data when server import is updated","suites":["GS(S)P Server-Side Change Reloading"],"updatePoint":{"line":314,"column":55},"line":314,"code":"  it('should refresh data when server import is updated', async () => {\n    const browser = await webdriver(next.url, '/')\n    await browser.eval(`window.beforeChange = 'hi'`)\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props.count).toBe(1)\n    expect(props.data).toEqual({ hello: 'world' })\n\n    // wait longer than the max inactive age for on-demand entries\n    // to ensure we aren't incorrectly disposing the active entry\n    await waitFor(20 * 1000)\n\n    const page = 'lib/data.json'\n    const originalContent = await next.readFile(page)\n\n    try {\n      await next.patchFile(page, JSON.stringify({ hello: 'replaced!!' }))\n      await check(async () => {\n        const props = JSON.parse(await browser.elementByCss('#props').text())\n        return props.count === 1 && props.data.hello === 'replaced!!'\n          ? 'success'\n          : JSON.stringify(props)\n      }, 'success')\n      expect(await browser.eval('window.beforeChange')).toBe('hi')\n\n      await next.patchFile(page, originalContent)\n      await check(async () => {\n        const props = JSON.parse(await browser.elementByCss('#props').text())\n        return props.count === 1 && props.data.hello === 'world'\n          ? 'success'\n          : JSON.stringify(props)\n      }, 'success')\n    } finally {\n      await next.patchFile(page, originalContent)\n    }\n  })","file":"development/basic/gssp-ssr-change-reloading/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show hydration error correctly","suites":["basic HMR"],"updatePoint":{"line":29,"column":43},"line":29,"code":"  it('should show hydration error correctly', async () => {\n    const browser = await webdriver(next.url, '/hydration-error')\n    await check(async () => {\n      const logs = await browser.log()\n      return logs.some((log) =>\n        log.message.includes('messages/react-hydration-error')\n      )\n        ? 'success'\n        : JSON.stringify(logs, null, 2)\n    }, 'success')\n  })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should have correct router.isReady for auto-export page","suites":["basic HMR"],"updatePoint":{"line":41,"column":61},"line":41,"code":"  it('should have correct router.isReady for auto-export page', async () => {\n    let browser = await webdriver(next.url, '/auto-export-is-ready')\n\n    expect(await browser.elementByCss('#ready').text()).toBe('yes')\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({})\n\n    browser = await webdriver(next.url, '/auto-export-is-ready?hello=world')\n\n    await check(async () => {\n      return browser.elementByCss('#ready').text()\n    }, 'yes')\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      hello: 'world',\n    })\n  })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should have correct router.isReady for getStaticProps page","suites":["basic HMR"],"updatePoint":{"line":57,"column":64},"line":57,"code":"  it('should have correct router.isReady for getStaticProps page', async () => {\n    let browser = await webdriver(next.url, '/gsp-is-ready')\n\n    expect(await browser.elementByCss('#ready').text()).toBe('yes')\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({})\n\n    browser = await webdriver(next.url, '/gsp-is-ready?hello=world')\n\n    await check(async () => {\n      return browser.elementByCss('#ready').text()\n    }, 'yes')\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      hello: 'world',\n    })\n  })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should load the page properly","suites":["basic HMR","Hot Module Reloading","delete a page and add it back"],"updatePoint":{"line":75,"column":39},"line":75,"code":"      it('should load the page properly', async () => {\n        const contactPagePath = join('pages', 'hmr', 'contact.js')\n        const newContactPagePath = join('pages', 'hmr', '_contact.js')\n        let browser\n        try {\n          const start = next.cliOutput.length\n          browser = await webdriver(next.appPort, '/hmr/contact')\n          const text = await browser.elementByCss('p').text()\n          expect(text).toBe('This is the contact page.')\n\n          // Rename the file to mimic a deleted page\n          await next.renameFile(contactPagePath, newContactPagePath)\n\n          await check(\n            () => getBrowserBodyText(browser),\n            /This page could not be found/\n          )\n\n          // Rename the file back to the original filename\n          await next.renameFile(newContactPagePath, contactPagePath)\n\n          // wait until the page comes back\n          await check(\n            () => getBrowserBodyText(browser),\n            /This is the contact page/\n          )\n\n          expect(next.cliOutput.slice(start)).toContain('compiling...')\n          expect(next.cliOutput.slice(start)).toContain(\n            'compiling /hmr/contact (client and server)...'\n          )\n          expect(next.cliOutput).toContain(\n            'compiling /_error (client and server)...'\n          )\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n          await next\n            .renameFile(newContactPagePath, contactPagePath)\n            .catch(() => {})\n        }\n      })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should detect the changes and display it","suites":["basic HMR","Hot Module Reloading","editing a page"],"updatePoint":{"line":121,"column":50},"line":121,"code":"      it('should detect the changes and display it', async () => {\n        let browser\n        try {\n          browser = await webdriver(next.appPort, '/hmr/about')\n          const text = await browser.elementByCss('p').text()\n          expect(text).toBe('This is the about page.')\n\n          const aboutPagePath = join('pages', 'hmr', 'about.js')\n\n          const originalContent = await next.readFile(aboutPagePath)\n          const editedContent = originalContent.replace(\n            'This is the about page',\n            'COOL page'\n          )\n\n          // change the content\n          try {\n            await next.patchFile(aboutPagePath, editedContent)\n            await check(() => getBrowserBodyText(browser), /COOL page/)\n          } finally {\n            // add the original content\n            await next.patchFile(aboutPagePath, originalContent)\n          }\n\n          await check(\n            () => getBrowserBodyText(browser),\n            /This is the about page/\n          )\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should not reload unrelated pages","suites":["basic HMR","Hot Module Reloading","editing a page"],"updatePoint":{"line":156,"column":43},"line":156,"code":"      it('should not reload unrelated pages', async () => {\n        let browser\n        try {\n          browser = await webdriver(next.appPort, '/hmr/counter')\n          const text = await browser\n            .elementByCss('button')\n            .click()\n            .elementByCss('button')\n            .click()\n            .elementByCss('p')\n            .text()\n          expect(text).toBe('COUNT: 2')\n\n          const aboutPagePath = join('pages', 'hmr', 'about.js')\n\n          const originalContent = await next.readFile(aboutPagePath)\n          const editedContent = originalContent.replace(\n            'This is the about page',\n            'COOL page'\n          )\n\n          try {\n            // Change the about.js page\n            await next.patchFile(aboutPagePath, editedContent)\n\n            // Check whether the this page has reloaded or not.\n            await check(() => browser.elementByCss('p').text(), /COUNT: 2/)\n          } finally {\n            // restore the about page content.\n            await next.patchFile(aboutPagePath, originalContent)\n          }\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should update styles correctly","suites":["basic HMR","Hot Module Reloading","editing a page"],"updatePoint":{"line":196,"column":40},"line":196,"code":"      it('should update styles correctly', async () => {\n        let browser\n        try {\n          browser = await webdriver(next.appPort, '/hmr/style')\n          const pTag = await browser.elementByCss('.hmr-style-page p')\n          const initialFontSize = await pTag.getComputedCss('font-size')\n\n          expect(initialFontSize).toBe('100px')\n\n          const pagePath = join('pages', 'hmr', 'style.js')\n\n          const originalContent = await next.readFile(pagePath)\n          const editedContent = originalContent.replace('100px', '200px')\n\n          // Change the page\n          await next.patchFile(pagePath, editedContent)\n\n          try {\n            // Check whether the this page has reloaded or not.\n            await check(async () => {\n              const editedPTag = await browser.elementByCss('.hmr-style-page p')\n              return editedPTag.getComputedCss('font-size')\n            }, /200px/)\n          } finally {\n            // Finally is used so that we revert the content back to the original regardless of the test outcome\n            // restore the about page content.\n            await next.patchFile(pagePath, originalContent)\n          }\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should update styles in a stateful component correctly","suites":["basic HMR","Hot Module Reloading","editing a page"],"updatePoint":{"line":233,"column":64},"line":233,"code":"      it('should update styles in a stateful component correctly', async () => {\n        let browser\n        const pagePath = join('pages', 'hmr', 'style-stateful-component.js')\n        const originalContent = await next.readFile(pagePath)\n        try {\n          browser = await webdriver(\n            next.appPort,\n            '/hmr/style-stateful-component'\n          )\n          const pTag = await browser.elementByCss('.hmr-style-page p')\n          const initialFontSize = await pTag.getComputedCss('font-size')\n\n          expect(initialFontSize).toBe('100px')\n          const editedContent = originalContent.replace('100px', '200px')\n\n          // Change the page\n          await next.patchFile(pagePath, editedContent)\n\n          // Check whether the this page has reloaded or not.\n          await check(async () => {\n            const editedPTag = await browser.elementByCss('.hmr-style-page p')\n            return editedPTag.getComputedCss('font-size')\n          }, /200px/)\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n          await next.patchFile(pagePath, originalContent)\n        }\n      })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should update styles in a dynamic component correctly","suites":["basic HMR","Hot Module Reloading","editing a page"],"updatePoint":{"line":266,"column":63},"line":266,"code":"      it('should update styles in a dynamic component correctly', async () => {\n        let browser = null\n        let secondBrowser = null\n        const pagePath = join('components', 'hmr', 'dynamic.js')\n        const originalContent = await next.readFile(pagePath)\n        try {\n          browser = await webdriver(\n            next.appPort,\n            '/hmr/style-dynamic-component'\n          )\n          const div = await browser.elementByCss('#dynamic-component')\n          const initialClientClassName = await div.getAttribute('class')\n          const initialFontSize = await div.getComputedCss('font-size')\n\n          expect(initialFontSize).toBe('100px')\n\n          const initialHtml = await renderViaHTTP(\n            next.appPort,\n            '/hmr/style-dynamic-component'\n          )\n          expect(initialHtml.includes('100px')).toBeTruthy()\n\n          const $initialHtml = cheerio.load(initialHtml)\n          const initialServerClassName =\n            $initialHtml('#dynamic-component').attr('class')\n\n          expect(initialClientClassName === initialServerClassName).toBeTruthy()\n\n          const editedContent = originalContent.replace('100px', '200px')\n\n          // Change the page\n          await next.patchFile(pagePath, editedContent)\n\n          // wait for 5 seconds\n          await waitFor(5000)\n\n          secondBrowser = await webdriver(\n            next.appPort,\n            '/hmr/style-dynamic-component'\n          )\n          // Check whether the this page has reloaded or not.\n          const editedDiv = await secondBrowser.elementByCss(\n            '#dynamic-component'\n          )\n          const editedClientClassName = await editedDiv.getAttribute('class')\n          const editedFontSize = await editedDiv.getComputedCss('font-size')\n          const browserHtml = await secondBrowser.eval(\n            'document.documentElement.innerHTML'\n          )\n\n          expect(editedFontSize).toBe('200px')\n          expect(browserHtml.includes('font-size:200px')).toBe(true)\n          expect(browserHtml.includes('font-size:100px')).toBe(false)\n\n          const editedHtml = await renderViaHTTP(\n            next.appPort,\n            '/hmr/style-dynamic-component'\n          )\n          expect(editedHtml.includes('200px')).toBeTruthy()\n          const $editedHtml = cheerio.load(editedHtml)\n          const editedServerClassName =\n            $editedHtml('#dynamic-component').attr('class')\n\n          expect(editedClientClassName === editedServerClassName).toBe(true)\n        } finally {\n          // Finally is used so that we revert the content back to the original regardless of the test outcome\n          // restore the about page content.\n          await next.patchFile(pagePath, originalContent)\n\n          if (browser) {\n            await browser.close()\n          }\n\n          if (secondBrowser) {\n            secondBrowser.close()\n          }\n        }\n      })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should recover from 404 after a page has been added","suites":["basic HMR","Error Recovery"],"updatePoint":{"line":348,"column":59},"line":348,"code":"    it('should recover from 404 after a page has been added', async () => {\n      let browser\n      const newPage = join('pages', 'hmr', 'new-page.js')\n\n      try {\n        const start = next.cliOutput.length\n        browser = await webdriver(next.appPort, '/hmr/new-page')\n\n        expect(await browser.elementByCss('body').text()).toMatch(\n          /This page could not be found/\n        )\n\n        // Add the page\n        await next.patchFile(\n          newPage,\n          'export default () => (<div id=\"new-page\">the-new-page</div>)'\n        )\n\n        await check(() => getBrowserBodyText(browser), /the-new-page/)\n\n        await next.deleteFile(newPage)\n\n        await check(\n          () => getBrowserBodyText(browser),\n          /This page could not be found/\n        )\n\n        expect(next.cliOutput.slice(start)).toContain(\n          'compiling /hmr/new-page (client and server)...'\n        )\n        expect(next.cliOutput).toContain(\n          'compiling /_error (client and server)...'\n        )\n      } catch (err) {\n        await next.deleteFile(newPage)\n        throw err\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should detect syntax errors and recover","suites":["basic HMR","Error Recovery"],"updatePoint":{"line":391,"column":47},"line":391,"code":"    it('should detect syntax errors and recover', async () => {\n      let browser\n      const aboutPage = join('pages', 'hmr', 'about2.js')\n      const aboutContent = await next.readFile(aboutPage)\n      try {\n        const start = next.cliOutput.length\n        browser = await webdriver(next.appPort, '/hmr/about2')\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n\n        await next.patchFile(aboutPage, aboutContent.replace('</div>', 'div'))\n\n        expect(await hasRedbox(browser)).toBe(true)\n        expect(await getRedboxSource(browser)).toMatch(/Unexpected eof/)\n\n        await next.patchFile(aboutPage, aboutContent)\n\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n        expect(next.cliOutput.slice(start)).toContain(\n          'compiling /hmr/about2 (client and server)...'\n        )\n        expect(next.cliOutput).toContain(\n          'compiling /_error (client and server)...'\n        )\n      } catch (err) {\n        await next.patchFile(aboutPage, aboutContent)\n        if (browser) {\n          await check(\n            () => getBrowserBodyText(browser),\n            /This is the about page/\n          )\n        }\n\n        throw err\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should show the error on all pages","suites":["basic HMR","Error Recovery"],"updatePoint":{"line":431,"column":42},"line":431,"code":"    it('should show the error on all pages', async () => {\n      const aboutPage = join('pages', 'hmr', 'about2.js')\n      const aboutContent = await next.readFile(aboutPage)\n      let browser\n      try {\n        await renderViaHTTP(next.appPort, '/hmr/about2')\n\n        await next.patchFile(aboutPage, aboutContent.replace('</div>', 'div'))\n\n        // Ensure dev server has time to break:\n        await new Promise((resolve) => setTimeout(resolve, 2000))\n\n        browser = await webdriver(next.appPort, '/hmr/contact')\n\n        expect(await hasRedbox(browser)).toBe(true)\n        expect(await getRedboxSource(browser)).toMatch(/Unexpected eof/)\n\n        await next.patchFile(aboutPage, aboutContent)\n\n        await check(\n          () => getBrowserBodyText(browser),\n          /This is the contact page/\n        )\n      } catch (err) {\n        await next.patchFile(aboutPage, aboutContent)\n        if (browser) {\n          await check(\n            () => getBrowserBodyText(browser),\n            /This is the contact page/\n          )\n        }\n\n        throw err\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should detect runtime errors on the module scope","suites":["basic HMR","Error Recovery"],"updatePoint":{"line":471,"column":56},"line":471,"code":"    it('should detect runtime errors on the module scope', async () => {\n      let browser\n      const aboutPage = join('pages', 'hmr', 'about3.js')\n      const aboutContent = await next.readFile(aboutPage)\n      try {\n        browser = await webdriver(next.appPort, '/hmr/about3')\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n\n        await next.patchFile(\n          aboutPage,\n          aboutContent.replace('export', 'aa=20;\\nexport')\n        )\n\n        expect(await hasRedbox(browser)).toBe(true)\n        expect(await getRedboxHeader(browser)).toMatch(/aa is not defined/)\n\n        await next.patchFile(aboutPage, aboutContent)\n\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n      } finally {\n        await next.patchFile(aboutPage, aboutContent)\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should recover from errors in the render function","suites":["basic HMR","Error Recovery"],"updatePoint":{"line":498,"column":57},"line":498,"code":"    it('should recover from errors in the render function', async () => {\n      let browser\n      const aboutPage = join('pages', 'hmr', 'about4.js')\n      const aboutContent = await next.readFile(aboutPage)\n      try {\n        browser = await webdriver(next.appPort, '/hmr/about4')\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n\n        await next.patchFile(\n          aboutPage,\n          aboutContent.replace(\n            'return',\n            'throw new Error(\"an-expected-error\");\\nreturn'\n          )\n        )\n\n        expect(await hasRedbox(browser)).toBe(true)\n        expect(await getRedboxSource(browser)).toMatch(/an-expected-error/)\n\n        await next.patchFile(aboutPage, aboutContent)\n\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n      } catch (err) {\n        await next.patchFile(aboutPage, aboutContent)\n        if (browser) {\n          await check(\n            () => getBrowserBodyText(browser),\n            /This is the about page/\n          )\n        }\n\n        throw err\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should recover after exporting an invalid page","suites":["basic HMR","Error Recovery"],"updatePoint":{"line":537,"column":54},"line":537,"code":"    it('should recover after exporting an invalid page', async () => {\n      let browser\n      const aboutPage = join('pages', 'hmr', 'about5.js')\n      const aboutContent = await next.readFile(aboutPage)\n      try {\n        browser = await webdriver(next.appPort, '/hmr/about5')\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n\n        await next.patchFile(\n          aboutPage,\n          aboutContent.replace(\n            'export default',\n            'export default {};\\nexport const fn ='\n          )\n        )\n\n        expect(await hasRedbox(browser)).toBe(true)\n        expect(await getRedboxHeader(browser)).toMatchInlineSnapshot(`\n          \" 1 of 1 unhandled error\n          Server Error\n\n          Error: The default export is not a React Component in page: \\\\\"/hmr/about5\\\\\"\n\n          This error happened while generating the page. Any console logs will be displayed in the terminal window.\"\n        `)\n\n        await next.patchFile(aboutPage, aboutContent)\n\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n      } catch (err) {\n        await next.patchFile(aboutPage, aboutContent)\n\n        if (browser) {\n          await check(\n            () => getBrowserBodyText(browser),\n            /This is the about page/\n          )\n        }\n\n        throw err\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should recover after a bad return from the render function","suites":["basic HMR","Error Recovery"],"updatePoint":{"line":584,"column":66},"line":584,"code":"    it('should recover after a bad return from the render function', async () => {\n      let browser\n      const aboutPage = join('pages', 'hmr', 'about6.js')\n      const aboutContent = await next.readFile(aboutPage)\n      try {\n        browser = await webdriver(next.appPort, '/hmr/about6')\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n\n        await next.patchFile(\n          aboutPage,\n          aboutContent.replace(\n            'export default',\n            'export default () => /search/;\\nexport const fn ='\n          )\n        )\n\n        const isReact17 = process.env.NEXT_TEST_REACT_VERSION === '^17'\n\n        expect(await hasRedbox(browser)).toBe(true)\n        // TODO: Replace this when webpack 5 is the default\n        expect(\n          (await getRedboxHeader(browser)).replace(\n            '__WEBPACK_DEFAULT_EXPORT__',\n            'Unknown'\n          )\n        ).toMatch(\n          `Objects are not valid as a React child (found: ${\n            isReact17 ? '/search/' : '[object RegExp]'\n          }). If you meant to render a collection of children, use an array instead.`\n        )\n\n        await next.patchFile(aboutPage, aboutContent)\n\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n      } catch (err) {\n        await next.patchFile(aboutPage, aboutContent)\n\n        if (browser) {\n          await check(\n            () => getBrowserBodyText(browser),\n            /This is the about page/\n          )\n        }\n\n        throw err\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should recover after undefined exported as default","suites":["basic HMR","Error Recovery"],"updatePoint":{"line":636,"column":58},"line":636,"code":"    it('should recover after undefined exported as default', async () => {\n      let browser\n      const aboutPage = join('pages', 'hmr', 'about7.js')\n\n      const aboutContent = await next.readFile(aboutPage)\n      try {\n        browser = await webdriver(next.appPort, '/hmr/about7')\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n\n        await next.patchFile(\n          aboutPage,\n          aboutContent.replace(\n            'export default',\n            'export default undefined;\\nexport const fn ='\n          )\n        )\n\n        expect(await hasRedbox(browser)).toBe(true)\n        expect(await getRedboxHeader(browser)).toMatchInlineSnapshot(`\n          \" 1 of 1 unhandled error\n          Server Error\n\n          Error: The default export is not a React Component in page: \\\\\"/hmr/about7\\\\\"\n\n          This error happened while generating the page. Any console logs will be displayed in the terminal window.\"\n        `)\n\n        await next.patchFile(aboutPage, aboutContent)\n\n        await check(() => getBrowserBodyText(browser), /This is the about page/)\n        expect(await hasRedbox(browser, false)).toBe(false)\n      } catch (err) {\n        await next.patchFile(aboutPage, aboutContent)\n\n        if (browser) {\n          await check(\n            () => getBrowserBodyText(browser),\n            /This is the about page/\n          )\n        }\n\n        throw err\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should recover from errors in getInitialProps in client","suites":["basic HMR","Error Recovery"],"updatePoint":{"line":685,"column":63},"line":685,"code":"    it('should recover from errors in getInitialProps in client', async () => {\n      let browser\n      const erroredPage = join('pages', 'hmr', 'error-in-gip.js')\n      const errorContent = await next.readFile(erroredPage)\n      try {\n        browser = await webdriver(next.appPort, '/hmr')\n        await browser.elementByCss('#error-in-gip-link').click()\n\n        expect(await hasRedbox(browser)).toBe(true)\n        expect(await getRedboxHeader(browser)).toMatchInlineSnapshot(`\n          \" 1 of 1 unhandled error\n          Unhandled Runtime Error\n\n          Error: an-expected-error-in-gip\"\n        `)\n\n        await next.patchFile(\n          erroredPage,\n          errorContent.replace('throw error', 'return {}')\n        )\n\n        await check(() => getBrowserBodyText(browser), /Hello/)\n\n        await next.patchFile(erroredPage, errorContent)\n\n        await check(async () => {\n          await browser.refresh()\n          await waitFor(2000)\n          const text = await getBrowserBodyText(browser)\n          if (text.includes('Hello')) {\n            throw new Error('waiting')\n          }\n          return getRedboxSource(browser)\n        }, /an-expected-error-in-gip/)\n      } catch (err) {\n        await next.patchFile(erroredPage, errorContent)\n\n        throw err\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should recover after an error reported via SSR","suites":["basic HMR","Error Recovery"],"updatePoint":{"line":730,"column":54},"line":730,"code":"    it('should recover after an error reported via SSR', async () => {\n      let browser\n      const erroredPage = join('pages', 'hmr', 'error-in-gip.js')\n      const errorContent = await next.readFile(erroredPage)\n      try {\n        browser = await webdriver(next.appPort, '/hmr/error-in-gip')\n\n        expect(await hasRedbox(browser)).toBe(true)\n        expect(await getRedboxHeader(browser)).toMatchInlineSnapshot(`\n          \" 1 of 1 unhandled error\n          Server Error\n\n          Error: an-expected-error-in-gip\n\n          This error happened while generating the page. Any console logs will be displayed in the terminal window.\"\n        `)\n\n        const erroredPage = join('pages', 'hmr', 'error-in-gip.js')\n\n        await next.patchFile(\n          erroredPage,\n          errorContent.replace('throw error', 'return {}')\n        )\n\n        await check(() => getBrowserBodyText(browser), /Hello/)\n\n        await next.patchFile(erroredPage, errorContent)\n\n        await check(async () => {\n          await browser.refresh()\n          await waitFor(2000)\n          const text = await getBrowserBodyText(browser)\n          if (text.includes('Hello')) {\n            throw new Error('waiting')\n          }\n          return getRedboxSource(browser)\n        }, /an-expected-error-in-gip/)\n      } catch (err) {\n        await next.patchFile(erroredPage, errorContent)\n\n        throw err\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should warn about full reload in cli output - anonymous page function","suites":["basic HMR","Full reload"],"updatePoint":{"line":780,"column":77},"line":780,"code":"    it('should warn about full reload in cli output - anonymous page function', async () => {\n      const start = next.cliOutput.length\n      const browser = await webdriver(\n        next.appPort,\n        `/hmr/anonymous-page-function`\n      )\n      expect(await browser.elementByCss('p').text()).toBe('hello world')\n      expect(next.cliOutput.slice(start)).not.toContain(\n        'Fast Refresh had to perform a full reload. Read more: https://nextjs.org/docs/basic-features/fast-refresh#how-it-works'\n      )\n\n      const currentFileContent = await next.readFile(\n        './pages/hmr/anonymous-page-function.js'\n      )\n      const newFileContent = currentFileContent.replace(\n        '<p>hello world</p>',\n        '<p>hello world!!!</p>'\n      )\n      await next.patchFile(\n        './pages/hmr/anonymous-page-function.js',\n        newFileContent\n      )\n      await check(() => browser.elementByCss('p').text(), 'hello world!!!')\n\n      // CLI warning and stacktrace\n      expect(next.cliOutput.slice(start)).toContain(\n        'Fast Refresh had to perform a full reload. Read more: https://nextjs.org/docs/basic-features/fast-refresh#how-it-works'\n      )\n      expect(next.cliOutput.slice(start)).toContain(\n        'Error: Aborted because ./pages/hmr/anonymous-page-function.js is not accepted'\n      )\n\n      // Browser warning\n      const browserLogs = await browser.log()\n      expect(\n        browserLogs.some(({ message }) =>\n          message.includes(\n            \"Fast Refresh will perform a full reload when you edit a file that's imported by modules outside of the React rendering tree.\"\n          )\n        )\n      ).toBeTruthy()\n    })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should warn about full reload in cli output - runtime-error","suites":["basic HMR","Full reload"],"updatePoint":{"line":823,"column":67},"line":823,"code":"    it('should warn about full reload in cli output - runtime-error', async () => {\n      const start = next.cliOutput.length\n      const browser = await webdriver(next.appPort, `/hmr/runtime-error`)\n      await check(\n        () => getRedboxHeader(browser),\n        /ReferenceError: whoops is not defined/\n      )\n      expect(next.cliOutput.slice(start)).not.toContain(\n        'Fast Refresh had to perform a full reload. Read more: https://nextjs.org/docs/basic-features/fast-refresh#how-it-works'\n      )\n\n      const currentFileContent = await next.readFile(\n        './pages/hmr/runtime-error.js'\n      )\n      const newFileContent = currentFileContent.replace('whoops', '\"whoops\"')\n      await next.patchFile('./pages/hmr/runtime-error.js', newFileContent)\n      await check(() => browser.elementByCss('body').text(), 'whoops')\n\n      // CLI warning and stacktrace\n      expect(next.cliOutput.slice(start)).toContain(\n        'Fast Refresh had to perform a full reload. Read more: https://nextjs.org/docs/basic-features/fast-refresh#how-it-works'\n      )\n      expect(next.cliOutput.slice(start)).not.toContain(\n        'Error: Aborted because ./pages/runtime-error.js is not accepted'\n      )\n\n      // Browser warning\n      const browserLogs = await browser.log()\n      expect(\n        browserLogs.some(({ message }) =>\n          message.includes(\n            '[Fast Refresh] performing full reload because your application had an unrecoverable error'\n          )\n        )\n      ).toBeTruthy()\n    })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should have client HMR events in trace file","suites":["basic HMR","Full reload"],"updatePoint":{"line":861,"column":49},"line":861,"code":"  it('should have client HMR events in trace file', async () => {\n    const traceData = await next.readFile('.next/trace')\n    expect(traceData).toContain('client-hmr-latency')\n    expect(traceData).toContain('client-error')\n    expect(traceData).toContain('client-success')\n    expect(traceData).toContain('client-full-reload')\n  })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should have correct compile timing after fixing error","suites":["basic HMR","Full reload"],"updatePoint":{"line":869,"column":59},"line":869,"code":"  it('should have correct compile timing after fixing error', async () => {\n    const pageName = 'pages/auto-export-is-ready.js'\n    const originalContent = await next.readFile(pageName)\n\n    try {\n      const browser = await webdriver(next.url, '/auto-export-is-ready')\n      const outputLength = next.cliOutput.length\n      await next.patchFile(\n        pageName,\n        `import hello from 'non-existent'\\n` + originalContent\n      )\n      expect(await hasRedbox(browser, true)).toBe(true)\n      await waitFor(3000)\n      await next.patchFile(pageName, originalContent)\n      await check(\n        () => next.cliOutput.substring(outputLength),\n        /compiled.*?successfully/i\n      )\n      const compileTime = next.cliOutput\n        .substring(outputLength)\n        .match(/compiled.*?successfully in ([\\d.]{1,})\\s?(?:s|ms)/i)\n\n      let compileTimeMs = parseFloat(compileTime[1])\n      if (\n        next.cliOutput\n          .substring(outputLength)\n          .match(/compiled.*?successfully in ([\\d.]{1,})\\s?s/)\n      ) {\n        compileTimeMs = compileTimeMs * 1000\n      }\n      expect(compileTimeMs).toBeLessThan(3000)\n    } finally {\n      await next.patchFile(pageName, originalContent)\n    }\n  })","file":"development/basic/hmr.test.ts","skipped":false,"dir":"test"},{"name":"should compile with legacy decorators enabled","suites":["Legacy decorators SWC option"],"updatePoint":{"line":26,"column":51},"line":26,"code":"  it('should compile with legacy decorators enabled', async () => {\n    let browser\n    try {\n      browser = await webdriver(next.appPort, '/')\n      const text = await browser.elementByCss('#count').text()\n      expect(text).toBe('Current number: 0')\n      await browser.elementByCss('#increase').click()\n      await check(\n        () => browser.elementByCss('#count').text(),\n        /Current number: 1/\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"development/basic/legacy-decorators.test.ts","skipped":false,"dir":"test"},{"name":"should set process.env.NODE_ENV in development","suites":["misc basic dev tests"],"updatePoint":{"line":21,"column":52},"line":21,"code":"  it('should set process.env.NODE_ENV in development', async () => {\n    const browser = await webdriver(next.appPort, '/process-env')\n    const nodeEnv = await browser.elementByCss('#node-env').text()\n    expect(nodeEnv).toBe('development')\n    await browser.close()\n  })","file":"development/basic/misc.test.ts","skipped":false,"dir":"test"},{"name":"should allow access to public files","suites":["misc basic dev tests"],"updatePoint":{"line":28,"column":41},"line":28,"code":"  it('should allow access to public files', async () => {\n    const data = await renderViaHTTP(next.appPort, '/data/data.txt')\n    expect(data).toBe('data')\n\n    const legacy = await renderViaHTTP(next.appPort, '/static/legacy.txt')\n    expect(legacy).toMatch(`new static folder`)\n  })","file":"development/basic/misc.test.ts","skipped":false,"dir":"test"},{"name":"should not allow accessing files outside .next/static and .next/server directory","suites":["misc basic dev tests","With Security Related Issues"],"updatePoint":{"line":37,"column":88},"line":37,"code":"    it('should not allow accessing files outside .next/static and .next/server directory', async () => {\n      const pathsToCheck = [\n        `/_next/static/../BUILD_ID`,\n        `/_next/static/../routes-manifest.json`,\n      ]\n      for (const path of pathsToCheck) {\n        const res = await fetchViaHTTP(next.appPort, path)\n        const text = await res.text()\n        try {\n          expect(res.status).toBe(404)\n          expect(text).toMatch(/This page could not be found/)\n        } catch (err) {\n          throw new Error(`Path ${path} accessible from the browser`)\n        }\n      }\n    })","file":"development/basic/misc.test.ts","skipped":false,"dir":"test"},{"name":"should handle encoded / value for trailing slash correctly","suites":["misc basic dev tests","With Security Related Issues"],"updatePoint":{"line":54,"column":66},"line":54,"code":"    it('should handle encoded / value for trailing slash correctly', async () => {\n      const res = await fetchViaHTTP(\n        next.appPort,\n        '/%2fexample.com/',\n        undefined,\n        { redirect: 'manual' }\n      )\n\n      const { pathname, hostname } = url.parse(\n        res.headers.get('location') || ''\n      )\n      expect(res.status).toBe(308)\n      expect(pathname).toBe('/%2fexample.com')\n      expect(hostname).not.toBe('example.com')\n      const text = await res.text()\n      expect(text).toEqual('/%2fexample.com')\n    })","file":"development/basic/misc.test.ts","skipped":false,"dir":"test"},{"name":"should warn when prefetch is true","suites":["misc basic dev tests","Development Logs"],"updatePoint":{"line":93,"column":41},"line":93,"code":"    it('should warn when prefetch is true', async () => {\n      const foundLog = await getLogs$('/development-logs')\n      expect(foundLog).toBe(true)\n    })","file":"development/basic/misc.test.ts","skipped":false,"dir":"test"},{"name":"should not warn when prefetch is false","suites":["misc basic dev tests","Development Logs"],"updatePoint":{"line":97,"column":46},"line":97,"code":"    it('should not warn when prefetch is false', async () => {\n      const foundLog = await getLogs$(\n        '/development-logs/link-with-prefetch-false'\n      )\n      expect(foundLog).toBe(false)\n    })","file":"development/basic/misc.test.ts","skipped":false,"dir":"test"},{"name":"should not warn when prefetch is not specified","suites":["misc basic dev tests","Development Logs"],"updatePoint":{"line":103,"column":54},"line":103,"code":"    it('should not warn when prefetch is not specified', async () => {\n      const foundLog = await getLogs$('/development-logs/link-with-no-prefetch')\n      expect(foundLog).toBe(false)\n    })","file":"development/basic/misc.test.ts","skipped":false,"dir":"test"},{"name":"should render dynamic import components","suites":["basic next/dynamic usage","Dynamic import","default behavior"],"updatePoint":{"line":28,"column":49},"line":28,"code":"      it('should render dynamic import components', async () => {\n        const $ = await get$('/dynamic/ssr')\n        // Make sure the client side knows it has to wait for the bundle\n        expect(JSON.parse($('#__NEXT_DATA__').html()).dynamicIds).toContain(\n          'dynamic/ssr.js -> ../../components/hello1'\n        )\n        expect($('body').text()).toMatch(/Hello World 1/)\n      })","file":"development/basic/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should render dynamic import components using a function as first parameter","suites":["basic next/dynamic usage","Dynamic import","default behavior"],"updatePoint":{"line":37,"column":85},"line":37,"code":"      it('should render dynamic import components using a function as first parameter', async () => {\n        const $ = await get$('/dynamic/function')\n        // Make sure the client side knows it has to wait for the bundle\n        expect(JSON.parse($('#__NEXT_DATA__').html()).dynamicIds).toContain(\n          'dynamic/function.js -> ../../components/hello1'\n        )\n        expect($('body').text()).toMatch(/Hello World 1/)\n      })","file":"development/basic/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should render even there are no physical chunk exists","suites":["basic next/dynamic usage","Dynamic import","default behavior"],"updatePoint":{"line":46,"column":63},"line":46,"code":"      it('should render even there are no physical chunk exists', async () => {\n        let browser\n        try {\n          browser = await webdriver(next.appPort, '/dynamic/no-chunk')\n          await check(\n            () => browser.elementByCss('body').text(),\n            /Welcome, normal/\n          )\n          await check(\n            () => browser.elementByCss('body').text(),\n            /Welcome, dynamic/\n          )\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should hydrate nested chunks","suites":["basic next/dynamic usage","Dynamic import","default behavior"],"updatePoint":{"line":65,"column":38},"line":65,"code":"      it('should hydrate nested chunks', async () => {\n        let browser\n        try {\n          browser = await webdriver(next.appPort, '/dynamic/nested')\n          await check(() => browser.elementByCss('body').text(), /Nested 1/)\n          await check(() => browser.elementByCss('body').text(), /Nested 2/)\n          await check(\n            () => browser.elementByCss('body').text(),\n            /Browser hydrated/\n          )\n\n          if ((global as any).browserName === 'chrome') {\n            const logs = await browser.log('browser')\n\n            logs.forEach((logItem) => {\n              expect(logItem.message).not.toMatch(\n                /Expected server HTML to contain/\n              )\n            })\n          }\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should render the component Head content","suites":["basic next/dynamic usage","Dynamic import","default behavior"],"updatePoint":{"line":92,"column":50},"line":92,"code":"      it('should render the component Head content', async () => {\n        let browser\n        try {\n          browser = await webdriver(next.appPort, '/dynamic/head')\n          await check(() => browser.elementByCss('body').text(), /test/)\n          const backgroundColor = await browser\n            .elementByCss('.dynamic-style')\n            .getComputedCss('background-color')\n          const height = await browser\n            .elementByCss('.dynamic-style')\n            .getComputedCss('height')\n          expect(height).toBe('200px')\n          expect(backgroundColor).toMatch(/rgba?\\(0, 128, 0/)\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should not render loading on the server side","suites":["basic next/dynamic usage","Dynamic import","ssr:false option"],"updatePoint":{"line":113,"column":54},"line":113,"code":"      it('should not render loading on the server side', async () => {\n        const $ = await get$('/dynamic/no-ssr')\n        expect($('body').html()).not.toContain('\"dynamicIds\"')\n        expect($('body').text()).not.toMatch('loading...')\n      })","file":"development/basic/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should render the component on client side","suites":["basic next/dynamic usage","Dynamic import","ssr:false option"],"updatePoint":{"line":119,"column":52},"line":119,"code":"      it('should render the component on client side', async () => {\n        let browser\n        try {\n          browser = await webdriver(next.appPort, '/dynamic/no-ssr')\n          await check(\n            () => browser.elementByCss('body').text(),\n            /Hello World 1/\n          )\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"Should render the component on the server side","suites":["basic next/dynamic usage","Dynamic import","ssr:true option"],"updatePoint":{"line":136,"column":56},"line":136,"code":"      it('Should render the component on the server side', async () => {\n        const $ = await get$('/dynamic/ssr-true')\n        expect($('body').html()).toContain('\"dynamicIds\"')\n        expect($('p').text()).toBe('Hello World 1')\n      })","file":"development/basic/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should render the component on client side","suites":["basic next/dynamic usage","Dynamic import","ssr:true option"],"updatePoint":{"line":142,"column":52},"line":142,"code":"      it('should render the component on client side', async () => {\n        let browser\n        try {\n          browser = await webdriver(next.appPort, '/dynamic/ssr-true')\n          await check(\n            () => browser.elementByCss('body').text(),\n            /Hello World 1/\n          )\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should render the correct filename","suites":["basic next/dynamic usage","Dynamic import","custom chunkfilename"],"updatePoint":{"line":159,"column":44},"line":159,"code":"      it('should render the correct filename', async () => {\n        const $ = await get$('/dynamic/chunkfilename')\n        expect($('body').text()).toMatch(/test chunkfilename/)\n        expect($('html').html()).toMatch(/hello-world\\.js/)\n      })","file":"development/basic/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should render the component on client side","suites":["basic next/dynamic usage","Dynamic import","custom chunkfilename"],"updatePoint":{"line":165,"column":52},"line":165,"code":"      it('should render the component on client side', async () => {\n        let browser\n        try {\n          browser = await webdriver(next.appPort, '/dynamic/chunkfilename')\n          await check(\n            () => browser.elementByCss('body').text(),\n            /test chunkfilename/\n          )\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should render custom loading on the server side when `ssr:false` and `loading` is provided","suites":["basic next/dynamic usage","Dynamic import","custom loading"],"updatePoint":{"line":182,"column":100},"line":182,"code":"      it('should render custom loading on the server side when `ssr:false` and `loading` is provided', async () => {\n        const $ = await get$('/dynamic/no-ssr-custom-loading')\n        expect($('p').text()).toBe('LOADING')\n      })","file":"development/basic/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should render the component on client side","suites":["basic next/dynamic usage","Dynamic import","custom loading"],"updatePoint":{"line":187,"column":52},"line":187,"code":"      it('should render the component on client side', async () => {\n        let browser\n        try {\n          browser = await webdriver(\n            next.appPort,\n            '/dynamic/no-ssr-custom-loading'\n          )\n          await check(\n            () => browser.elementByCss('body').text(),\n            /Hello World 1/\n          )\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should only include the rendered module script tag","suites":["basic next/dynamic usage","Dynamic import","Multiple modules"],"updatePoint":{"line":207,"column":60},"line":207,"code":"      it('should only include the rendered module script tag', async () => {\n        const $ = await get$('/dynamic/multiple-modules')\n        const html = $('html').html()\n        expect(html).toMatch(/hello1\\.js/)\n        expect(html).not.toMatch(/hello2\\.js/)\n      })","file":"development/basic/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should only load the rendered module in the browser","suites":["basic next/dynamic usage","Dynamic import","Multiple modules"],"updatePoint":{"line":214,"column":61},"line":214,"code":"      it('should only load the rendered module in the browser', async () => {\n        let browser\n        try {\n          browser = await webdriver(next.appPort, '/dynamic/multiple-modules')\n          const html = await browser.eval('document.documentElement.innerHTML')\n          expect(html).toMatch(/hello1\\.js/)\n          expect(html).not.toMatch(/hello2\\.js/)\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"development/basic/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should only render one bundle if component is used multiple times","suites":["basic next/dynamic usage","Dynamic import","Multiple modules"],"updatePoint":{"line":228,"column":75},"line":228,"code":"      it('should only render one bundle if component is used multiple times', async () => {\n        const $ = await get$('/dynamic/multiple-modules')\n        const html = $('html').html()\n        try {\n          expect(html.match(/chunks[\\\\/]hello1\\.js/g).length).toBe(1)\n          expect(html).not.toMatch(/hello2\\.js/)\n        } catch (err) {\n          console.error(html)\n          throw err\n        }\n      })","file":"development/basic/next-dynamic.test.ts","skipped":false,"dir":"test"},{"name":"should have polyfilled correctly","suites":["theme-ui SWC option"],"updatePoint":{"line":18,"column":38},"line":18,"code":"  it('should have polyfilled correctly', async () => {\n    const browser = await webdriver(next.url, '/')\n\n    await browser.waitForCondition('window.didRender')\n\n    const data = await browser\n      .waitForElementByCss('#node-browser-polyfills')\n      .text()\n    const parsedData = JSON.parse(data)\n\n    expect(parsedData.vm).toBe(105)\n    expect(parsedData.hash).toBe(\n      'b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9'\n    )\n    expect(parsedData.buffer).toBe('hello world')\n    expect(parsedData.stream).toBe(true)\n    expect(parsedData.assert).toBe(true)\n    expect(parsedData.constants).toBe(7)\n    expect(parsedData.domain).toBe(true)\n    expect(parsedData.http).toBe(true)\n    expect(parsedData.https).toBe(true)\n    expect(parsedData.os).toBe('\\n')\n    expect(parsedData.path).toBe('/hello/world/test.txt')\n    expect(parsedData.process).toBe('browser')\n    expect(parsedData.querystring).toBe('a=b')\n    expect(parsedData.stringDecoder).toBe(true)\n    expect(parsedData.sys).toBe(true)\n    expect(parsedData.timers).toBe(true)\n  })","file":"development/basic/node-browser-polyfills.test.ts","skipped":false,"dir":"test"},{"name":"should have hydration mismatch with styled-components transform disabled","suites":["styled-components SWC transform"],"updatePoint":{"line":37,"column":78},"line":37,"code":"  it('should have hydration mismatch with styled-components transform disabled', async () => {\n    let browser\n    try {\n      browser = await webdriver(next.appPort, '/')\n\n      // Compile /_error\n      await fetchViaHTTP(next.appPort, '/404')\n\n      try {\n        // Try 4 times to be sure there is no mismatch\n        expect(await matchLogs$(browser)).toBe(false)\n        await browser.refresh()\n        expect(await matchLogs$(browser)).toBe(false)\n        await browser.refresh()\n        expect(await matchLogs$(browser)).toBe(false)\n        await browser.refresh()\n        expect(await matchLogs$(browser)).toBe(false)\n        throw new Error('did not find mismatch')\n      } catch (err) {\n        // Verify that it really has the logs\n        // eslint-disable-next-line jest/no-try-expect\n        expect(await matchLogs$(browser)).toBe(true)\n      }\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"development/basic/styled-components-disabled.test.ts","skipped":false,"dir":"test"},{"name":"should not have hydration mismatch with styled-components transform enabled","suites":["styled-components SWC transform"],"updatePoint":{"line":38,"column":81},"line":38,"code":"  it('should not have hydration mismatch with styled-components transform enabled', async () => {\n    let browser\n    try {\n      browser = await webdriver(next.appPort, '/')\n\n      // Compile /_error\n      await fetchViaHTTP(next.appPort, '/404')\n\n      // Try 4 times to be sure there is no mismatch\n      expect(await matchLogs$(browser)).toBe(false)\n      await browser.refresh()\n      expect(await matchLogs$(browser)).toBe(false)\n      await browser.refresh()\n      expect(await matchLogs$(browser)).toBe(false)\n      await browser.refresh()\n      expect(await matchLogs$(browser)).toBe(false)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"development/basic/styled-components.test.ts","skipped":false,"dir":"test"},{"name":"should render the page with correct styles","suites":["styled-components SWC transform"],"updatePoint":{"line":61,"column":48},"line":61,"code":"  it('should render the page with correct styles', async () => {\n    const browser = await webdriver(next.appPort, '/')\n\n    expect(\n      await browser.eval(\n        `window.getComputedStyle(document.querySelector('#btn')).color`\n      )\n    ).toBe('rgb(255, 255, 255)')\n    expect(\n      await browser.eval(\n        `window.getComputedStyle(document.querySelector('#wrap-div')).color`\n      )\n    ).toBe('rgb(0, 0, 0)')\n  })","file":"development/basic/styled-components.test.ts","skipped":false,"dir":"test"},{"name":"should enable the display name transform by default","suites":["styled-components SWC transform"],"updatePoint":{"line":76,"column":57},"line":76,"code":"  it('should enable the display name transform by default', async () => {\n    // make sure the index chunk gets generated\n    await webdriver(next.appPort, '/')\n\n    const chunk = await next.readFile('.next/static/chunks/pages/index.js')\n    expect(chunk).toContain('displayName: \\\\\"pages__Button\\\\\"')\n  })","file":"development/basic/styled-components.test.ts","skipped":false,"dir":"test"},{"name":"should contain styles in initial HTML","suites":["styled-components SWC transform"],"updatePoint":{"line":84,"column":43},"line":84,"code":"  it('should contain styles in initial HTML', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toContain('background:transparent')\n    expect(html).toContain('color:white')\n  })","file":"development/basic/styled-components.test.ts","skipped":false,"dir":"test"},{"name":"should only render once on the server per request","suites":["styled-components SWC transform"],"updatePoint":{"line":90,"column":55},"line":90,"code":"  it('should only render once on the server per request', async () => {\n    const outputs = []\n    next.on('stdout', (args) => {\n      outputs.push(args)\n    })\n    await renderViaHTTP(next.url, '/')\n    expect(\n      outputs.filter((output) => output.trim() === '__render__').length\n    ).toBe(1)\n  })","file":"development/basic/styled-components.test.ts","skipped":false,"dir":"test"},{"name":"works with JIT enabled","suites":["TailwindCSS JIT"],"updatePoint":{"line":29,"column":28},"line":29,"code":"  it('works with JIT enabled', async () => {\n    let browser\n    try {\n      browser = await webdriver(next.appPort, '/')\n      const text = await browser.elementByCss('.text-6xl').text()\n      expect(text).toMatch(/Welcome to/)\n      const cssBlue = await browser\n        .elementByCss('#test-link')\n        .getComputedCss('color')\n      expect(cssBlue).toBe('rgb(37, 99, 235)')\n\n      const aboutPagePath = join('pages', 'index.js')\n\n      const originalContent = await next.readFile(aboutPagePath)\n      const editedContent = originalContent.replace(\n        '<a className=\"text-blue-600\" href=\"https://nextjs.org\" id=\"test-link\">',\n        '<a className=\"text-red-600\" href=\"https://nextjs.org\" id=\"test-link\">'\n      )\n\n      // change the content\n      try {\n        await next.patchFile(aboutPagePath, editedContent)\n        await check(\n          () => browser.elementByCss('#test-link').getComputedCss('color'),\n          /rgb\\(220, 38, 38\\)/\n        )\n      } finally {\n        // add the original content\n        await next.patchFile(aboutPagePath, originalContent)\n      }\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"development/basic/tailwind-jit.test.ts","skipped":false,"dir":"test"},{"name":"should have theme provided styling","suites":["theme-ui SWC option"],"updatePoint":{"line":23,"column":40},"line":23,"code":"  it('should have theme provided styling', async () => {\n    let browser\n    try {\n      browser = await webdriver(next.appPort, '/')\n      const color = await browser.elementByCss('#hello').getComputedCss('color')\n      expect(color).toBe('rgb(51, 51, 238)')\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"development/basic/theme-ui.test.ts","skipped":false,"dir":"test"},{"name":"should be able to fullscreen the minimized overlay","suites":["client-dev-overlay"],"updatePoint":{"line":46,"column":56},"line":46,"code":"  it('should be able to fullscreen the minimized overlay', async () => {\n    await getMinimizeButton().click()\n    await getToast().click()\n\n    await check(async () => {\n      return (await elementExistsInNextJSPortalShadowDOM(\n        selectors.fullScreenDialog\n      ))\n        ? 'success'\n        : 'missing'\n    }, 'success')\n  })","file":"development/client-dev-overlay/index.test.ts","skipped":false,"dir":"test"},{"name":"should be able to minimize the fullscreen overlay","suites":["client-dev-overlay"],"updatePoint":{"line":59,"column":55},"line":59,"code":"  it('should be able to minimize the fullscreen overlay', async () => {\n    await getMinimizeButton().click()\n    expect(await elementExistsInNextJSPortalShadowDOM(selectors.toast)).toBe(\n      true\n    )\n  })","file":"development/client-dev-overlay/index.test.ts","skipped":false,"dir":"test"},{"name":"should be able to hide the minimized overlay","suites":["client-dev-overlay"],"updatePoint":{"line":66,"column":50},"line":66,"code":"  it('should be able to hide the minimized overlay', async () => {\n    await getMinimizeButton().click()\n    await getHideButton().click()\n\n    await check(async () => {\n      const exists = await elementExistsInNextJSPortalShadowDOM('div')\n      return exists ? 'found' : 'success'\n    }, 'success')\n  })","file":"development/client-dev-overlay/index.test.ts","skipped":false,"dir":"test"},{"name":"should add `moduleResolution` when generating tsconfig.json in dev","suites":["correct tsconfig.json defaults"],"updatePoint":{"line":23,"column":72},"line":23,"code":"  it('should add `moduleResolution` when generating tsconfig.json in dev', async () => {\n    try {\n      expect(\n        await next.readFile('tsconfig.json').catch(() => false)\n      ).toBeFalse()\n\n      await next.start()\n\n      // wait for tsconfig to be written\n      await check(async () => {\n        await next.readFile('tsconfig.json')\n        return 'success'\n      }, 'success')\n\n      const tsconfig = JSON.parse(await next.readFile('tsconfig.json'))\n      expect(next.cliOutput).not.toContain('moduleResolution')\n\n      expect(tsconfig.compilerOptions).toEqual(\n        expect.objectContaining({ moduleResolution: 'node' })\n      )\n    } finally {\n      await next.stop()\n    }\n  })","file":"development/correct-tsconfig-defaults/index.test.ts","skipped":false,"dir":"test"},{"name":"should not warn for `moduleResolution` when already present and valid","suites":["correct tsconfig.json defaults"],"updatePoint":{"line":48,"column":75},"line":48,"code":"  it('should not warn for `moduleResolution` when already present and valid', async () => {\n    try {\n      expect(\n        await next.readFile('tsconfig.json').catch(() => false)\n      ).toBeTruthy()\n\n      await next.start()\n\n      const tsconfig = JSON.parse(await next.readFile('tsconfig.json'))\n\n      expect(tsconfig.compilerOptions).toEqual(\n        expect.objectContaining({ moduleResolution: 'node' })\n      )\n      expect(next.cliOutput).not.toContain('moduleResolution')\n    } finally {\n      await next.stop()\n    }\n  })","file":"development/correct-tsconfig-defaults/index.test.ts","skipped":false,"dir":"test"},{"name":"should work","suites":["Dotenv default expansion"],"updatePoint":{"line":25,"column":17},"line":25,"code":"  it('should work', async () => {\n    const browser = await webdriver(next.appPort, '/')\n    const text = await browser.elementByCss('p').text()\n    expect(text).toBe('default')\n\n    await browser.close()\n  })","file":"development/dotenv-default-expansion/index.test.ts","skipped":false,"dir":"test"},{"name":"should not poll indefinitely","suites":["getServerSideProps returns notFound: true"],"updatePoint":{"line":27,"column":34},"line":27,"code":"  it('should not poll indefinitely', async () => {\n    const browser = await webdriver(next.appPort, '/')\n    await waitFor(3000)\n    await browser.close()\n    const logOccurrences = next.cliOutput.split('gssp called').length - 1\n    expect(logOccurrences).toBe(1)\n  })","file":"development/gssp-notfound/index.test.ts","skipped":false,"dir":"test"},{"name":"should load with initial paths config correctly","suites":["jsconfig-path-reloading"],"updatePoint":{"line":50,"column":55},"line":50,"code":"    it('should load with initial paths config correctly', async () => {\n      const html = await renderViaHTTP(next.url, '/')\n      const $ = cheerio.load(html)\n      expect(html).toContain('first button')\n      expect(html).toContain('second button')\n      expect($('#first-data').text()).toContain(\n        JSON.stringify({\n          hello: 'world',\n        })\n      )\n    })","file":"development/jsconfig-path-reloading/index.test.ts","skipped":false,"dir":"test"},{"name":"should recover from module not found when paths is updated","suites":["jsconfig-path-reloading"],"updatePoint":{"line":62,"column":66},"line":62,"code":"    it('should recover from module not found when paths is updated', async () => {\n      const indexContent = await next.readFile(indexPage)\n      const tsconfigContent = await next.readFile(tsConfigFile)\n      const parsedTsConfig = JSON.parse(tsconfigContent)\n\n      const browser = await webdriver(next.url, '/')\n\n      try {\n        const html = await browser.eval('document.documentElement.innerHTML')\n        expect(html).toContain('first button')\n        expect(html).toContain('second button')\n        expect(html).toContain('first-data')\n        expect(html).not.toContain('second-data')\n\n        await next.patchFile(\n          indexPage,\n          `import {secondData} from \"@lib/second-data\"\\n${indexContent.replace(\n            '</p>',\n            `</p><p id=\"second-data\">{JSON.stringify(secondData)}</p>`\n          )}`\n        )\n\n        expect(await hasRedbox(browser, true)).toBe(true)\n        expect(await getRedboxSource(browser)).toContain('\"@lib/second-data\"')\n\n        await next.patchFile(\n          tsConfigFile,\n          JSON.stringify(\n            {\n              ...parsedTsConfig,\n              compilerOptions: {\n                ...parsedTsConfig.compilerOptions,\n                paths: {\n                  ...parsedTsConfig.compilerOptions.paths,\n                  '@lib/*': ['lib/first-lib/*', 'lib/second-lib/*'],\n                },\n              },\n            },\n            null,\n            2\n          )\n        )\n\n        expect(await hasRedbox(browser, false)).toBe(false)\n\n        const html2 = await browser.eval('document.documentElement.innerHTML')\n        expect(html2).toContain('first button')\n        expect(html2).toContain('second button')\n        expect(html2).toContain('first-data')\n        expect(html2).toContain('second-data')\n      } finally {\n        await next.patchFile(indexPage, indexContent)\n        await next.patchFile(tsConfigFile, tsconfigContent)\n        await check(async () => {\n          const html3 = await browser.eval('document.documentElement.innerHTML')\n          return html3.includes('first-data') && !html3.includes('second-data')\n            ? 'success'\n            : html3\n        }, 'success')\n      }\n    })","file":"development/jsconfig-path-reloading/index.test.ts","skipped":false,"dir":"test"},{"name":"should automatically fast refresh content when path is added without error","suites":["jsconfig-path-reloading"],"updatePoint":{"line":124,"column":82},"line":124,"code":"    it('should automatically fast refresh content when path is added without error', async () => {\n      const indexContent = await next.readFile(indexPage)\n      const tsconfigContent = await next.readFile(tsConfigFile)\n      const parsedTsConfig = JSON.parse(tsconfigContent)\n\n      const browser = await webdriver(next.url, '/')\n\n      try {\n        const html = await browser.eval('document.documentElement.innerHTML')\n        expect(html).toContain('first button')\n        expect(html).toContain('second button')\n        expect(html).toContain('first-data')\n\n        await next.patchFile(\n          tsConfigFile,\n          JSON.stringify(\n            {\n              ...parsedTsConfig,\n              compilerOptions: {\n                ...parsedTsConfig.compilerOptions,\n                paths: {\n                  ...parsedTsConfig.compilerOptions.paths,\n                  '@myotherbutton': ['components/button-3.js'],\n                },\n              },\n            },\n            null,\n            2\n          )\n        )\n        await next.patchFile(\n          indexPage,\n          indexContent.replace('@mybutton', '@myotherbutton')\n        )\n\n        expect(await hasRedbox(browser, false)).toBe(false)\n\n        await check(async () => {\n          const html2 = await browser.eval('document.documentElement.innerHTML')\n          expect(html2).toContain('first button')\n          expect(html2).not.toContain('second button')\n          expect(html2).toContain('third button')\n          expect(html2).toContain('first-data')\n          return 'success'\n        }, 'success')\n      } finally {\n        await next.patchFile(indexPage, indexContent)\n        await next.patchFile(tsConfigFile, tsconfigContent)\n        await check(async () => {\n          const html3 = await browser.eval('document.documentElement.innerHTML')\n          return html3.includes('first button') &&\n            !html3.includes('third button')\n            ? 'success'\n            : html3\n        }, 'success')\n      }\n    })","file":"development/jsconfig-path-reloading/index.test.ts","skipped":false,"dir":"test"},{"name":"warns when $title","suites":["middlewares"],"line":23,"code":"  it.each([\n    {\n      title: 'returning response with literal string',\n      code: `export default function middleware() {\n              return new Response('this is not allowed');\n            }`,\n    },\n    {\n      title: 'returning response with literal number',\n      code: `export default function middleware() {\n              return new Response(10);\n            }`,\n    },\n    {\n      title: 'returning response with JSON.stringify',\n      code: `export default function middleware() {\n              return new Response(JSON.stringify({ foo: 'this is not allowed' }));\n            }`,\n    },\n    {\n      title: 'populating response with a value',\n      code: `export default function middleware(request) {\n              const body = JSON.stringify({ foo: 'this should not be allowed, but hard to detect with AST' })\n              return new Response(body);\n            }`,\n    },\n    {\n      title: 'populating response with a function call',\n      code: `function buildBody() {\n              return 'this should not be allowed, but hard to detect with AST'\n            }\n            export default function middleware(request) {\n              return new Response(buildBody());\n            }`,\n    },\n    {\n      title: 'populating response with an async function call',\n      code: `export default async function middleware(request) {\n              return new Response(await fetch('https://example.vercel.sh'));\n            }`,\n    },\n  ])('warns when $title', async ({ code }) => {\n    ;({ cleanup } = await sandbox(next, new Map([[middlewarePath, code]])))\n    expect(next.cliOutput).toMatch(middlewareWarning)\n  })","file":"development/middleware-warnings/index.test.ts","skipped":false,"dir":"test"},{"name":"does not warn when $title","suites":["middlewares"],"line":69,"code":"  it.each([\n    {\n      title: 'returning null reponse body',\n      code: `export default function middleware() {\n              return new Response(null);\n            }`,\n    },\n    {\n      title: 'returning undefined response body',\n      code: `export default function middleware() {\n              return new Response(undefined);\n            }`,\n    },\n  ])('does not warn when $title', async ({ code }) => {\n    ;({ cleanup } = await sandbox(next, new Map([[middlewarePath, code]])))\n    expect(next.cliOutput).not.toMatch(middlewareWarning)\n  })","file":"development/middleware-warnings/index.test.ts","skipped":false,"dir":"test"},{"name":"should load with initial paths config correctly","suites":["tsconfig-path-reloading"],"updatePoint":{"line":50,"column":55},"line":50,"code":"    it('should load with initial paths config correctly', async () => {\n      const html = await renderViaHTTP(next.url, '/')\n      const $ = cheerio.load(html)\n      expect(html).toContain('first button')\n      expect(html).toContain('second button')\n      expect($('#first-data').text()).toContain(\n        JSON.stringify({\n          hello: 'world',\n        })\n      )\n    })","file":"development/tsconfig-path-reloading/index.test.ts","skipped":false,"dir":"test"},{"name":"should recover from module not found when paths is updated","suites":["tsconfig-path-reloading"],"updatePoint":{"line":62,"column":66},"line":62,"code":"    it('should recover from module not found when paths is updated', async () => {\n      const indexContent = await next.readFile(indexPage)\n      const tsconfigContent = await next.readFile(tsConfigFile)\n      const parsedTsConfig = JSON.parse(tsconfigContent)\n\n      const browser = await webdriver(next.url, '/')\n\n      try {\n        const html = await browser.eval('document.documentElement.innerHTML')\n        expect(html).toContain('first button')\n        expect(html).toContain('second button')\n        expect(html).toContain('first-data')\n        expect(html).not.toContain('second-data')\n\n        await next.patchFile(\n          indexPage,\n          `import {secondData} from \"@lib/second-data\"\\n${indexContent.replace(\n            '</p>',\n            `</p><p id=\"second-data\">{JSON.stringify(secondData)}</p>`\n          )}`\n        )\n\n        expect(await hasRedbox(browser, true)).toBe(true)\n        expect(await getRedboxSource(browser)).toContain('\"@lib/second-data\"')\n\n        await next.patchFile(\n          tsConfigFile,\n          JSON.stringify(\n            {\n              ...parsedTsConfig,\n              compilerOptions: {\n                ...parsedTsConfig.compilerOptions,\n                paths: {\n                  ...parsedTsConfig.compilerOptions.paths,\n                  '@lib/*': ['lib/first-lib/*', 'lib/second-lib/*'],\n                },\n              },\n            },\n            null,\n            2\n          )\n        )\n\n        expect(await hasRedbox(browser, false)).toBe(false)\n\n        const html2 = await browser.eval('document.documentElement.innerHTML')\n        expect(html2).toContain('first button')\n        expect(html2).toContain('second button')\n        expect(html2).toContain('first-data')\n        expect(html2).toContain('second-data')\n      } finally {\n        await next.patchFile(indexPage, indexContent)\n        await next.patchFile(tsConfigFile, tsconfigContent)\n        await check(async () => {\n          const html3 = await browser.eval('document.documentElement.innerHTML')\n          return html3.includes('first-data') && !html3.includes('second-data')\n            ? 'success'\n            : html3\n        }, 'success')\n      }\n    })","file":"development/tsconfig-path-reloading/index.test.ts","skipped":false,"dir":"test"},{"name":"should automatically fast refresh content when path is added without error","suites":["tsconfig-path-reloading"],"updatePoint":{"line":124,"column":82},"line":124,"code":"    it('should automatically fast refresh content when path is added without error', async () => {\n      const indexContent = await next.readFile(indexPage)\n      const tsconfigContent = await next.readFile(tsConfigFile)\n      const parsedTsConfig = JSON.parse(tsconfigContent)\n\n      const browser = await webdriver(next.url, '/')\n\n      try {\n        const html = await browser.eval('document.documentElement.innerHTML')\n        expect(html).toContain('first button')\n        expect(html).toContain('second button')\n        expect(html).toContain('first-data')\n\n        await next.patchFile(\n          tsConfigFile,\n          JSON.stringify(\n            {\n              ...parsedTsConfig,\n              compilerOptions: {\n                ...parsedTsConfig.compilerOptions,\n                paths: {\n                  ...parsedTsConfig.compilerOptions.paths,\n                  '@myotherbutton': ['components/button-3.tsx'],\n                },\n              },\n            },\n            null,\n            2\n          )\n        )\n        await next.patchFile(\n          indexPage,\n          indexContent.replace('@mybutton', '@myotherbutton')\n        )\n\n        expect(await hasRedbox(browser, false)).toBe(false)\n\n        await check(async () => {\n          const html2 = await browser.eval('document.documentElement.innerHTML')\n          expect(html2).toContain('first button')\n          expect(html2).not.toContain('second button')\n          expect(html2).toContain('third button')\n          expect(html2).toContain('first-data')\n          return 'success'\n        }, 'success')\n      } finally {\n        await next.patchFile(indexPage, indexContent)\n        await next.patchFile(tsConfigFile, tsconfigContent)\n        await check(async () => {\n          const html3 = await browser.eval('document.documentElement.innerHTML')\n          return html3.includes('first button') &&\n            !html3.includes('third button')\n            ? 'success'\n            : html3\n        }, 'success')\n      }\n    })","file":"development/tsconfig-path-reloading/index.test.ts","skipped":false,"dir":"test"},{"name":"should work","suites":["typescript-auto-install"],"updatePoint":{"line":37,"column":17},"line":37,"code":"  it('should work', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toContain('hello world')\n  })","file":"development/typescript-auto-install/index.test.ts","skipped":false,"dir":"test"},{"name":"should detect TypeScript being added and auto setup","suites":["typescript-auto-install"],"updatePoint":{"line":42,"column":57},"line":42,"code":"  it('should detect TypeScript being added and auto setup', async () => {\n    const browser = await webdriver(next.url, '/')\n    const pageContent = await next.readFile('pages/index.js')\n\n    await check(\n      () => browser.eval('document.documentElement.innerHTML'),\n      /hello world/\n    )\n    await next.renameFile('pages/index.js', 'pages/index.tsx')\n\n    await check(\n      () => stripAnsi(next.cliOutput),\n      /We detected TypeScript in your project and created a tsconfig\\.json file for you/i\n    )\n\n    await check(\n      () => browser.eval('document.documentElement.innerHTML'),\n      /hello world/\n    )\n    await next.patchFile(\n      'pages/index.tsx',\n      pageContent.replace('hello world', 'hello again')\n    )\n\n    await check(\n      () => browser.eval('document.documentElement.innerHTML'),\n      /hello again/\n    )\n  })","file":"development/typescript-auto-install/index.test.ts","skipped":false,"dir":"test"},{"name":"should output config file change","suites":["watch-config-file"],"updatePoint":{"line":30,"column":38},"line":30,"code":"  it('should output config file change', async () => {\n    // next dev test-dir\n    await next.start(true)\n    let i = 1\n\n    await check(async () => {\n      await next.patchFile(\n        'next.config.js',\n        `\n          /** changed - ${i} **/  \n          const nextConfig = {\n            reactStrictMode: true,\n          }\n          module.exports = nextConfig`\n      )\n      return next.cliOutput\n    }, /Found a change in next.config.js. Restart the server to see the changes in effect./)\n  })","file":"development/watch-config-file/index.test.ts","skipped":false,"dir":"test"},{"name":"should not appear deprecation warning about webpack module issuer","suites":["webpack-issuer-deprecation-warning"],"updatePoint":{"line":22,"column":71},"line":22,"code":"  it('should not appear deprecation warning about webpack module issuer', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toContain('Syntax Error')\n    expect(next.cliOutput).not.toContain(\n      '[DEP_WEBPACK_MODULE_ISSUER] DeprecationWarning: Module.issuer: Use new ModuleGraph API'\n    )\n  })","file":"development/webpack-issuer-deprecation-warning/index.test.ts","skipped":false,"dir":"test"},{"name":"should skip next deploy for now","suites":["app dir"],"updatePoint":{"line":13,"column":39},"line":13,"code":"    it('should skip next deploy for now', () => {})","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should skip for react v17","suites":["app dir"],"updatePoint":{"line":18,"column":33},"line":18,"code":"    it('should skip for react v17', () => {})","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should pass props from getServerSideProps in root layout","suites":["app dir"],"updatePoint":{"line":55,"column":64},"line":55,"code":"    it('should pass props from getServerSideProps in root layout', async () => {\n      const html = await renderViaHTTP(next.url, '/dashboard')\n      const $ = cheerio.load(html)\n      expect($('title').text()).toBe('hello world')\n    })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should serve from pages","suites":["app dir"],"updatePoint":{"line":61,"column":31},"line":61,"code":"    it('should serve from pages', async () => {\n      const html = await renderViaHTTP(next.url, '/')\n      expect(html).toContain('hello from pages/index')\n    })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should serve dynamic route from pages","suites":["app dir"],"updatePoint":{"line":66,"column":45},"line":66,"code":"    it('should serve dynamic route from pages', async () => {\n      const html = await renderViaHTTP(next.url, '/blog/first')\n      expect(html).toContain('hello from pages/blog/[slug]')\n    })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should serve from public","suites":["app dir"],"updatePoint":{"line":71,"column":32},"line":71,"code":"    it('should serve from public', async () => {\n      const html = await renderViaHTTP(next.url, '/hello.txt')\n      expect(html).toContain('hello world')\n    })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should serve from app","suites":["app dir"],"updatePoint":{"line":76,"column":29},"line":76,"code":"    it('should serve from app', async () => {\n      const html = await renderViaHTTP(next.url, '/dashboard')\n      expect(html).toContain('hello from app/dashboard')\n    })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should serve /index as separate page","suites":["app dir"],"updatePoint":{"line":81,"column":44},"line":81,"code":"    it('should serve /index as separate page', async () => {\n      const html = await renderViaHTTP(next.url, '/dashboard/index')\n      expect(html).toContain('hello from app/dashboard/index')\n      // should load chunks generated via async import correctly with React.lazy\n      expect(html).toContain('hello from lazy')\n      // should support `dynamic` in both server and client components\n      expect(html).toContain('hello from dynamic on server')\n      expect(html).toContain('hello from dynamic on client')\n    })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should handle css imports in next/dynamic correctly","suites":["app dir"],"line":92,"code":"    it.skip('should handle css imports in next/dynamic correctly', async () => {","file":"e2e/app-dir/index.test.ts","skipped":true,"dir":"test"},{"name":"should include layouts when no direct parent layout","suites":["app dir"],"updatePoint":{"line":107,"column":59},"line":107,"code":"    it('should include layouts when no direct parent layout', async () => {\n      const html = await renderViaHTTP(next.url, '/dashboard/integrations')\n      const $ = cheerio.load(html)\n      // Should not be nested in dashboard\n      expect($('h1').text()).toBe('Dashboard')\n      // Should include the page text\n      expect($('p').text()).toBe('hello from app/dashboard/integrations')\n    })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should not include parent when not in parent directory with route in directory","suites":["app dir"],"line":117,"code":"    it.skip('should not include parent when not in parent directory with route in directory', async () => {","file":"e2e/app-dir/index.test.ts","skipped":true,"dir":"test"},{"name":"should use new root layout when provided","suites":["app dir"],"updatePoint":{"line":135,"column":48},"line":135,"code":"    it('should use new root layout when provided', async () => {\n      const html = await renderViaHTTP(next.url, '/dashboard/another')\n      const $ = cheerio.load(html)\n\n      // new root has to provide it's own custom root layout or the default\n      // is used instead\n      expect($('html').hasClass('this-is-another-document-html')).toBeTruthy()\n      expect($('body').hasClass('this-is-another-document-body')).toBeTruthy()\n\n      // Should not be nested in dashboard\n      expect($('h1').text()).toBeFalsy()\n\n      // Should render the page text\n      expect($('p').text()).toBe('hello from newroot/dashboard/another')\n    })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should not create new root layout when nested (optional)","suites":["app dir"],"updatePoint":{"line":151,"column":64},"line":151,"code":"    it('should not create new root layout when nested (optional)', async () => {\n      const html = await renderViaHTTP(\n        next.url,\n        '/dashboard/deployments/breakdown'\n      )\n      const $ = cheerio.load(html)\n\n      // new root has to provide it's own custom root layout or the default\n      // is used instead\n      expect($('html').hasClass('this-is-the-document-html')).toBeTruthy()\n      expect($('body').hasClass('this-is-the-document-body')).toBeTruthy()\n\n      // Should be nested in dashboard\n      expect($('h1').text()).toBe('Dashboard')\n      expect($('h2').text()).toBe('Custom dashboard')\n\n      // Should render the page text\n      expect($('p').text()).toBe(\n        'hello from app/dashboard/(custom)/deployments/breakdown'\n      )\n    })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should include parent document when no direct parent layout","suites":["app dir"],"updatePoint":{"line":173,"column":67},"line":173,"code":"    it('should include parent document when no direct parent layout', async () => {\n      const html = await renderViaHTTP(next.url, '/dashboard/integrations')\n      const $ = cheerio.load(html)\n\n      expect($('html').hasClass('this-is-the-document-html')).toBeTruthy()\n      expect($('body').hasClass('this-is-the-document-body')).toBeTruthy()\n    })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should not include parent when not in parent directory","suites":["app dir"],"updatePoint":{"line":181,"column":62},"line":181,"code":"    it('should not include parent when not in parent directory', async () => {\n      const html = await renderViaHTTP(next.url, '/dashboard/changelog')\n      const $ = cheerio.load(html)\n      // Should not be nested in dashboard\n      expect($('h1').text()).toBeFalsy()\n      // Should include the page text\n      expect($('p').text()).toBe('hello from app/dashboard/changelog')\n    })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should serve nested parent","suites":["app dir"],"updatePoint":{"line":190,"column":34},"line":190,"code":"    it('should serve nested parent', async () => {\n      const html = await renderViaHTTP(next.url, '/dashboard/deployments/123')\n      const $ = cheerio.load(html)\n      // Should be nested in dashboard\n      expect($('h1').text()).toBe('Dashboard')\n      // Should be nested in deployments\n      expect($('h2').text()).toBe('Deployments hello')\n    })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should serve dynamic parameter","suites":["app dir"],"updatePoint":{"line":199,"column":38},"line":199,"code":"    it('should serve dynamic parameter', async () => {\n      const html = await renderViaHTTP(next.url, '/dashboard/deployments/123')\n      const $ = cheerio.load(html)\n      // Should include the page text with the parameter\n      expect($('p').text()).toBe(\n        'hello from app/dashboard/deployments/[id]. ID is: 123'\n      )\n    })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should include document html and body","suites":["app dir"],"updatePoint":{"line":208,"column":45},"line":208,"code":"    it('should include document html and body', async () => {\n      const html = await renderViaHTTP(next.url, '/dashboard')\n      const $ = cheerio.load(html)\n\n      expect($('html').hasClass('this-is-the-document-html')).toBeTruthy()\n      expect($('body').hasClass('this-is-the-document-body')).toBeTruthy()\n    })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should not serve when layout is provided but no folder index","suites":["app dir"],"updatePoint":{"line":216,"column":68},"line":216,"code":"    it('should not serve when layout is provided but no folder index', async () => {\n      const res = await fetchViaHTTP(next.url, '/dashboard/deployments')\n      expect(res.status).toBe(404)\n      expect(await res.text()).toContain('This page could not be found')\n    })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should match partial parameters","suites":["app dir"],"line":224,"code":"    it.skip('should match partial parameters', async () => {","file":"e2e/app-dir/index.test.ts","skipped":true,"dir":"test"},{"name":"should support rewrites","suites":["app dir"],"updatePoint":{"line":229,"column":31},"line":229,"code":"    it('should support rewrites', async () => {\n      const html = await renderViaHTTP(next.url, '/rewritten-to-dashboard')\n      expect(html).toContain('hello from app/dashboard')\n    })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should handle hash in initial url","suites":["app dir"],"updatePoint":{"line":263,"column":41},"line":263,"code":"    it('should handle hash in initial url', async () => {\n      const browser = await webdriver(next.url, '/dashboard#abc')\n\n      try {\n        // Check if hash is preserved\n        expect(await browser.eval('window.location.hash')).toBe('#abc')\n        await waitFor(1000)\n        // Check again to be sure as it might be timed different\n        expect(await browser.eval('window.location.hash')).toBe('#abc')\n      } finally {\n        await browser.close()\n      }\n    })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should match parallel routes","suites":["app dir"],"updatePoint":{"line":277,"column":36},"line":277,"code":"    it('should match parallel routes', async () => {\n      const html = await renderViaHTTP(next.url, '/parallel/nested')\n      expect(html).toContain('parallel/layout')\n      expect(html).toContain('parallel/@foo/nested/layout')\n      expect(html).toContain('parallel/@foo/nested/@a/page')\n      expect(html).toContain('parallel/@foo/nested/@b/page')\n      expect(html).toContain('parallel/@bar/nested/layout')\n      expect(html).toContain('parallel/@bar/nested/@a/page')\n      expect(html).toContain('parallel/@bar/nested/@b/page')\n      expect(html).toContain('parallel/nested/page')\n    })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should match parallel routes in route groups","suites":["app dir"],"updatePoint":{"line":289,"column":52},"line":289,"code":"    it('should match parallel routes in route groups', async () => {\n      const html = await renderViaHTTP(next.url, '/parallel/nested-2')\n      expect(html).toContain('parallel/layout')\n      expect(html).toContain('parallel/(new)/layout')\n      expect(html).toContain('parallel/(new)/@baz/nested/page')\n    })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should hard push","suites":["app dir","<Link />"],"updatePoint":{"line":297,"column":26},"line":297,"code":"      it('should hard push', async () => {\n        const browser = await webdriver(next.url, '/link-hard-push/123')\n\n        try {\n          // Click the link on the page, and verify that the history entry was\n          // added.\n          expect(await browser.eval('window.history.length')).toBe(2)\n          await browser.elementById('link').click()\n          await browser.waitForElementByCss('#render-id-456')\n          expect(await browser.eval('window.history.length')).toBe(3)\n\n          // Get the id on the rendered page.\n          const firstID = await browser.elementById('render-id-456').text()\n\n          // Go back, and redo the navigation by clicking the link.\n          await browser.back()\n          await browser.elementById('link').click()\n          await browser.waitForElementByCss('#render-id-456')\n\n          // Get the id again, and compare, they should not be the same.\n          const secondID = await browser.elementById('render-id-456').text()\n          expect(secondID).not.toBe(firstID)\n        } finally {\n          await browser.close()\n        }\n      })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should hard replace","suites":["app dir","<Link />"],"updatePoint":{"line":324,"column":29},"line":324,"code":"      it('should hard replace', async () => {\n        const browser = await webdriver(next.url, '/link-hard-replace/123')\n\n        try {\n          // Click the link on the page, and verify that the history entry was NOT\n          // added.\n          expect(await browser.eval('window.history.length')).toBe(2)\n          await browser.elementById('link').click()\n          await browser.waitForElementByCss('#render-id-456')\n          expect(await browser.eval('window.history.length')).toBe(2)\n\n          // Get the date again, and compare, they should not be the same.\n          const firstId = await browser.elementById('render-id-456').text()\n\n          // Navigate to the subpage, verify that the history entry was NOT added.\n          await browser.elementById('link').click()\n          await browser.waitForElementByCss('#render-id-123')\n          expect(await browser.eval('window.history.length')).toBe(2)\n\n          // Navigate back again, verify that the history entry was NOT added.\n          await browser.elementById('link').click()\n          await browser.waitForElementByCss('#render-id-456')\n          expect(await browser.eval('window.history.length')).toBe(2)\n\n          // Get the date again, and compare, they should not be the same.\n          const secondId = await browser.elementById('render-id-456').text()\n          expect(firstId).not.toBe(secondId)\n        } finally {\n          await browser.close()\n        }\n      })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should soft push","suites":["app dir","<Link />"],"updatePoint":{"line":356,"column":26},"line":356,"code":"      it('should soft push', async () => {\n        const browser = await webdriver(next.url, '/link-soft-push')\n\n        try {\n          // Click the link on the page, and verify that the history entry was\n          // added.\n          expect(await browser.eval('window.history.length')).toBe(2)\n          await browser.elementById('link').click()\n          await browser.waitForElementByCss('#render-id')\n          expect(await browser.eval('window.history.length')).toBe(3)\n\n          // Get the id on the rendered page.\n          const firstID = await browser.elementById('render-id').text()\n\n          // Go back, and redo the navigation by clicking the link.\n          await browser.back()\n          await browser.elementById('link').click()\n\n          // Get the date again, and compare, they should be the same.\n          const secondID = await browser.elementById('render-id').text()\n          expect(firstID).toBe(secondID)\n        } finally {\n          await browser.close()\n        }\n      })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should soft replace","suites":["app dir","<Link />"],"line":383,"code":"      it.skip('should soft replace', async () => {","file":"e2e/app-dir/index.test.ts","skipped":true,"dir":"test"},{"name":"should be soft for back navigation","suites":["app dir","<Link />"],"updatePoint":{"line":419,"column":44},"line":419,"code":"      it('should be soft for back navigation', async () => {\n        const browser = await webdriver(next.url, '/with-id')\n\n        try {\n          // Get the id on the rendered page.\n          const firstID = await browser.elementById('render-id').text()\n\n          // Click the link, and go back.\n          await browser.elementById('link').click()\n          await browser.waitForElementByCss('#from-navigation')\n          await browser.back()\n\n          // Get the date again, and compare, they should be the same.\n          const secondID = await browser.elementById('render-id').text()\n          expect(firstID).toBe(secondID)\n        } finally {\n          await browser.close()\n        }\n      })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should be soft for forward navigation","suites":["app dir","<Link />"],"updatePoint":{"line":439,"column":47},"line":439,"code":"      it('should be soft for forward navigation', async () => {\n        const browser = await webdriver(next.url, '/with-id')\n\n        try {\n          // Click the link.\n          await browser.elementById('link').click()\n          await browser.waitForElementByCss('#from-navigation')\n\n          // Get the id on the rendered page.\n          const firstID = await browser.elementById('render-id').text()\n\n          // Go back, then forward.\n          await browser.back()\n          await browser.forward()\n\n          // Get the date again, and compare, they should be the same.\n          const secondID = await browser.elementById('render-id').text()\n          expect(firstID).toBe(secondID)\n        } finally {\n          await browser.close()\n        }\n      })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should respect rewrites","suites":["app dir","<Link />"],"updatePoint":{"line":462,"column":33},"line":462,"code":"      it('should respect rewrites', async () => {\n        const browser = await webdriver(next.url, '/rewrites')\n\n        try {\n          // Click the link.\n          await browser.elementById('link').click()\n          await browser.waitForElementByCss('#from-dashboard')\n\n          // Check to see that we were rewritten and not redirected.\n          const pathname = await browser.eval('window.location.pathname')\n          expect(pathname).toBe('/rewritten-to-dashboard')\n\n          // Check to see that the page we navigated to is in fact the dashboard.\n          const html = await browser.eval(\n            'window.document.documentElement.innerText'\n          )\n          expect(html).toContain('hello from app/dashboard')\n        } finally {\n          await browser.close()\n        }\n      })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should allow linking from app page to pages page","suites":["app dir","<Link />"],"line":485,"code":"      it.skip('should allow linking from app page to pages page', async () => {","file":"e2e/app-dir/index.test.ts","skipped":true,"dir":"test"},{"name":"should not serve .server.js as a path","suites":["app dir","server components"],"updatePoint":{"line":505,"column":47},"line":505,"code":"      it('should not serve .server.js as a path', async () => {\n        // Without .server.js should serve\n        const html = await renderViaHTTP(next.url, '/should-not-serve-server')\n        expect(html).toContain('hello from app/should-not-serve-server')\n\n        // Should not serve `.server`\n        const res = await fetchViaHTTP(\n          next.url,\n          '/should-not-serve-server.server'\n        )\n        expect(res.status).toBe(404)\n        expect(await res.text()).toContain('This page could not be found')\n\n        // Should not serve `.server.js`\n        const res2 = await fetchViaHTTP(\n          next.url,\n          '/should-not-serve-server.server.js'\n        )\n        expect(res2.status).toBe(404)\n        expect(await res2.text()).toContain('This page could not be found')\n      })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should not serve .client.js as a path","suites":["app dir","server components"],"updatePoint":{"line":527,"column":47},"line":527,"code":"      it('should not serve .client.js as a path', async () => {\n        // Without .client.js should serve\n        const html = await renderViaHTTP(next.url, '/should-not-serve-client')\n        expect(html).toContain('hello from app/should-not-serve-client')\n\n        // Should not serve `.client`\n        const res = await fetchViaHTTP(\n          next.url,\n          '/should-not-serve-client.client'\n        )\n        expect(res.status).toBe(404)\n        expect(await res.text()).toContain('This page could not be found')\n\n        // Should not serve `.client.js`\n        const res2 = await fetchViaHTTP(\n          next.url,\n          '/should-not-serve-client.client.js'\n        )\n        expect(res2.status).toBe(404)\n        expect(await res2.text()).toContain('This page could not be found')\n      })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should serve shared component","suites":["app dir","server components"],"updatePoint":{"line":549,"column":39},"line":549,"code":"      it('should serve shared component', async () => {\n        // Without .client.js should serve\n        const html = await renderViaHTTP(next.url, '/shared-component-route')\n        expect(html).toContain('hello from app/shared-component-route')\n      })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should only pass params that apply to the layout","suites":["app dir","server components","dynamic routes"],"updatePoint":{"line":556,"column":60},"line":556,"code":"        it('should only pass params that apply to the layout', async () => {\n          const html = await renderViaHTTP(\n            next.url,\n            '/dynamic/books/hello-world'\n          )\n          const $ = cheerio.load(html)\n\n          expect($('#dynamic-layout-params').text()).toBe('{}')\n          expect($('#category-layout-params').text()).toBe(\n            '{\"category\":\"books\"}'\n          )\n          expect($('#id-layout-params').text()).toBe(\n            '{\"category\":\"books\",\"id\":\"hello-world\"}'\n          )\n          expect($('#id-page-params').text()).toBe(\n            '{\"category\":\"books\",\"id\":\"hello-world\"}'\n          )\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should handle optional segments","suites":["app dir","server components","catch-all routes"],"updatePoint":{"line":577,"column":43},"line":577,"code":"        it('should handle optional segments', async () => {\n          const params = ['this', 'is', 'a', 'test']\n          const route = params.join('/')\n          const html = await renderViaHTTP(\n            next.url,\n            `/optional-catch-all/${route}`\n          )\n          const $ = cheerio.load(html)\n          expect($('#text').attr('data-params')).toBe(route)\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should handle optional segments root","suites":["app dir","server components","catch-all routes"],"updatePoint":{"line":588,"column":48},"line":588,"code":"        it('should handle optional segments root', async () => {\n          const html = await renderViaHTTP(next.url, `/optional-catch-all`)\n          const $ = cheerio.load(html)\n          expect($('#text').attr('data-params')).toBe('')\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should handle required segments","suites":["app dir","server components","catch-all routes"],"updatePoint":{"line":594,"column":43},"line":594,"code":"        it('should handle required segments', async () => {\n          const params = ['this', 'is', 'a', 'test']\n          const route = params.join('/')\n          const html = await renderViaHTTP(next.url, `/catch-all/${route}`)\n          const $ = cheerio.load(html)\n          expect($('#text').attr('data-params')).toBe(route)\n\n          // Components under catch-all should not be treated as route that errors during build.\n          // They should be rendered properly when imported in page route.\n          expect($('#widget').text()).toBe('widget')\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should handle required segments root as not found","suites":["app dir","server components","catch-all routes"],"updatePoint":{"line":606,"column":61},"line":606,"code":"        it('should handle required segments root as not found', async () => {\n          const res = await fetchViaHTTP(next.url, `/catch-all`)\n          expect(res.status).toBe(404)\n          expect(await res.text()).toContain('This page could not be found')\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should serve server-side","suites":["app dir","server components","should serve client component"],"updatePoint":{"line":614,"column":36},"line":614,"code":"        it('should serve server-side', async () => {\n          const html = await renderViaHTTP(next.url, '/client-component-route')\n          const $ = cheerio.load(html)\n          expect($('p').text()).toBe(\n            'hello from app/client-component-route. count: 0'\n          )\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should serve client-side","suites":["app dir","server components","should serve client component"],"line":623,"code":"        it.skip('should serve client-side', async () => {","file":"e2e/app-dir/index.test.ts","skipped":true,"dir":"test"},{"name":"should include it server-side","suites":["app dir","server components","should include client component layout with server component route"],"updatePoint":{"line":634,"column":41},"line":634,"code":"        it('should include it server-side', async () => {\n          const html = await renderViaHTTP(next.url, '/client-nested')\n          const $ = cheerio.load(html)\n          // Should not be nested in dashboard\n          expect($('h1').text()).toBe('Client Nested. Count: 0')\n          // Should include the page text\n          expect($('p').text()).toBe('hello from app/client-nested')\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should include it client-side","suites":["app dir","server components","should include client component layout with server component route"],"line":644,"code":"        it.skip('should include it client-side', async () => {","file":"e2e/app-dir/index.test.ts","skipped":true,"dir":"test"},{"name":"should render loading.js in initial html for slow page","suites":["app dir","server components","Loading"],"updatePoint":{"line":660,"column":66},"line":660,"code":"        it('should render loading.js in initial html for slow page', async () => {\n          const html = await renderViaHTTP(next.url, '/slow-page-with-loading')\n          const $ = cheerio.load(html)\n\n          expect($('#loading').text()).toBe('Loading...')\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should render loading.js in browser for slow page","suites":["app dir","server components","Loading"],"updatePoint":{"line":667,"column":61},"line":667,"code":"        it('should render loading.js in browser for slow page', async () => {\n          const browser = await webdriver(next.url, '/slow-page-with-loading', {\n            waitHydration: false,\n          })\n          // TODO: `await webdriver()` causes waiting for the full page to complete streaming. At that point \"Loading...\" is replaced by the actual content\n          // expect(await browser.elementByCss('#loading').text()).toBe('Loading...')\n\n          expect(await browser.elementByCss('#slow-page-message').text()).toBe(\n            'hello from slow page'\n          )\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should render loading.js in initial html for slow layout","suites":["app dir","server components","Loading"],"updatePoint":{"line":679,"column":68},"line":679,"code":"        it('should render loading.js in initial html for slow layout', async () => {\n          const html = await renderViaHTTP(\n            next.url,\n            '/slow-layout-with-loading/slow'\n          )\n          const $ = cheerio.load(html)\n\n          expect($('#loading').text()).toBe('Loading...')\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should render loading.js in browser for slow layout","suites":["app dir","server components","Loading"],"updatePoint":{"line":689,"column":63},"line":689,"code":"        it('should render loading.js in browser for slow layout', async () => {\n          const browser = await webdriver(\n            next.url,\n            '/slow-layout-with-loading/slow',\n            {\n              waitHydration: false,\n            }\n          )\n          // TODO: `await webdriver()` causes waiting for the full page to complete streaming. At that point \"Loading...\" is replaced by the actual content\n          // expect(await browser.elementByCss('#loading').text()).toBe('Loading...')\n\n          expect(\n            await browser.elementByCss('#slow-layout-message').text()\n          ).toBe('hello from slow layout')\n\n          expect(await browser.elementByCss('#page-message').text()).toBe(\n            'Hello World'\n          )\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should render loading.js in initial html for slow layout and page","suites":["app dir","server components","Loading"],"updatePoint":{"line":709,"column":77},"line":709,"code":"        it('should render loading.js in initial html for slow layout and page', async () => {\n          const html = await renderViaHTTP(\n            next.url,\n            '/slow-layout-and-page-with-loading/slow'\n          )\n          const $ = cheerio.load(html)\n\n          expect($('#loading-layout').text()).toBe('Loading layout...')\n          expect($('#loading-page').text()).toBe('Loading page...')\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should render loading.js in browser for slow layout and page","suites":["app dir","server components","Loading"],"updatePoint":{"line":720,"column":72},"line":720,"code":"        it('should render loading.js in browser for slow layout and page', async () => {\n          const browser = await webdriver(\n            next.url,\n            '/slow-layout-and-page-with-loading/slow',\n            {\n              waitHydration: false,\n            }\n          )\n          // TODO: `await webdriver()` causes waiting for the full page to complete streaming. At that point \"Loading...\" is replaced by the actual content\n          // expect(await browser.elementByCss('#loading-layout').text()).toBe('Loading...')\n          // expect(await browser.elementByCss('#loading-page').text()).toBe('Loading...')\n\n          expect(\n            await browser.elementByCss('#slow-layout-message').text()\n          ).toBe('hello from slow layout')\n\n          expect(await browser.elementByCss('#slow-page-message').text()).toBe(\n            'hello from slow page'\n          )\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should always return null when accessed from /app","suites":["app dir","server components","next/router"],"updatePoint":{"line":743,"column":61},"line":743,"code":"        it('should always return null when accessed from /app', async () => {\n          const browser = await webdriver(next.url, '/old-router')\n\n          try {\n            await browser.waitForElementByCss('#old-router')\n\n            const notNull = await browser.elementsByCss('.was-not-null')\n            expect(notNull.length).toBe(0)\n\n            const wasNull = await browser.elementsByCss('.was-null')\n            expect(wasNull.length).toBe(6)\n          } finally {\n            await browser.close()\n          }\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should retrive cookies in a server component","suites":["app dir","server components","hooks","useCookies"],"updatePoint":{"line":762,"column":58},"line":762,"code":"          it('should retrive cookies in a server component', async () => {\n            const browser = await webdriver(next.url, '/hooks/use-cookies')\n\n            try {\n              await browser.waitForElementByCss('#does-not-have-cookie')\n              browser.addCookie({ name: 'use-cookies', value: 'value' })\n              browser.refresh()\n\n              await browser.waitForElementByCss('#has-cookie')\n              browser.deleteCookies()\n              browser.refresh()\n\n              await browser.waitForElementByCss('#does-not-have-cookie')\n            } finally {\n              await browser.close()\n            }\n          })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should access cookies on <Link /> navigation","suites":["app dir","server components","hooks","useCookies"],"updatePoint":{"line":780,"column":58},"line":780,"code":"          it('should access cookies on <Link /> navigation', async () => {\n            const browser = await webdriver(next.url, '/navigation')\n\n            try {\n              // Click the cookies link to verify it can't see the cookie that's\n              // not there.\n              await browser.elementById('use-cookies').click()\n              await browser.waitForElementByCss('#does-not-have-cookie')\n\n              // Go back and add the cookies.\n              await browser.back()\n              await browser.waitForElementByCss('#from-navigation')\n              browser.addCookie({ name: 'use-cookies', value: 'value' })\n\n              // Click the cookies link again to see that the cookie can be picked\n              // up again.\n              await browser.elementById('use-cookies').click()\n              await browser.waitForElementByCss('#has-cookie')\n\n              // Go back and remove the cookies.\n              await browser.back()\n              await browser.waitForElementByCss('#from-navigation')\n              browser.deleteCookies()\n\n              // Verify for the last time that after clicking the cookie link\n              // again, there are no cookies.\n              await browser.elementById('use-cookies').click()\n              await browser.waitForElementByCss('#does-not-have-cookie')\n            } finally {\n              await browser.close()\n            }\n          })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should have access to incoming headers in a server component","suites":["app dir","server components","hooks","useHeaders"],"updatePoint":{"line":815,"column":74},"line":815,"code":"          it('should have access to incoming headers in a server component', async () => {\n            // Check to see that we can't see the header when it's not present.\n            let html = await renderViaHTTP(\n              next.url,\n              '/hooks/use-headers',\n              {},\n              { headers: {} }\n            )\n            let $ = cheerio.load(html)\n            expect($('#does-not-have-header').length).toBe(1)\n            expect($('#has-header').length).toBe(0)\n\n            // Check to see that we can see the header when it's present.\n            html = await renderViaHTTP(\n              next.url,\n              '/hooks/use-headers',\n              {},\n              { headers: { 'x-use-headers': 'value' } }\n            )\n            $ = cheerio.load(html)\n            expect($('#has-header').length).toBe(1)\n            expect($('#does-not-have-header').length).toBe(0)\n          })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should access headers on <Link /> navigation","suites":["app dir","server components","hooks","useHeaders"],"updatePoint":{"line":839,"column":58},"line":839,"code":"          it('should access headers on <Link /> navigation', async () => {\n            const browser = await webdriver(next.url, '/navigation')\n\n            try {\n              await browser.elementById('use-headers').click()\n              await browser.waitForElementByCss('#has-referer')\n            } finally {\n              await browser.close()\n            }\n          })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should return no preview data when there is none","suites":["app dir","server components","hooks","usePreviewData"],"updatePoint":{"line":852,"column":62},"line":852,"code":"          it('should return no preview data when there is none', async () => {\n            const browser = await webdriver(next.url, '/hooks/use-preview-data')\n\n            try {\n              await browser.waitForElementByCss('#does-not-have-preview-data')\n            } finally {\n              await browser.close()\n            }\n          })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should return preview data when there is some","suites":["app dir","server components","hooks","usePreviewData"],"updatePoint":{"line":862,"column":59},"line":862,"code":"          it('should return preview data when there is some', async () => {\n            const browser = await webdriver(next.url, '/api/preview')\n\n            try {\n              await browser.loadPage(next.url + '/hooks/use-preview-data', {\n                disableCache: false,\n                beforePageLoad: null,\n              })\n              await browser.waitForElementByCss('#has-preview-data')\n            } finally {\n              await browser.close()\n            }\n          })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should throw an error when imported","suites":["app dir","server components","hooks","useRouter"],"line":879,"code":"          it.skip('should throw an error when imported', async () => {","file":"e2e/app-dir/index.test.ts","skipped":true,"dir":"test"},{"name":"should throw an error when imported","suites":["app dir","server components","hooks","useParams"],"line":888,"code":"          it.skip('should throw an error when imported', async () => {","file":"e2e/app-dir/index.test.ts","skipped":true,"dir":"test"},{"name":"should throw an error when imported","suites":["app dir","server components","hooks","useSearchParams"],"line":897,"code":"          it.skip('should throw an error when imported', async () => {","file":"e2e/app-dir/index.test.ts","skipped":true,"dir":"test"},{"name":"should throw an error when imported","suites":["app dir","server components","hooks","usePathname"],"line":909,"code":"          it.skip('should throw an error when imported', async () => {","file":"e2e/app-dir/index.test.ts","skipped":true,"dir":"test"},{"name":"should throw an error when imported","suites":["app dir","server components","hooks","useLayoutSegments"],"line":921,"code":"          it.skip('should throw an error when imported', async () => {","file":"e2e/app-dir/index.test.ts","skipped":true,"dir":"test"},{"name":"should throw an error when imported","suites":["app dir","server components","hooks","useSelectedLayoutSegment"],"line":933,"code":"          it.skip('should throw an error when imported', async () => {","file":"e2e/app-dir/index.test.ts","skipped":true,"dir":"test"},{"name":"should throw an error when imported","suites":["app dir","client components","hooks","useCookies"],"line":949,"code":"          it.skip('should throw an error when imported', async () => {","file":"e2e/app-dir/index.test.ts","skipped":true,"dir":"test"},{"name":"should throw an error when imported","suites":["app dir","client components","hooks","usePreviewData"],"line":961,"code":"          it.skip('should throw an error when imported', async () => {","file":"e2e/app-dir/index.test.ts","skipped":true,"dir":"test"},{"name":"should throw an error when imported","suites":["app dir","client components","hooks","useHeaders"],"line":973,"code":"          it.skip('should throw an error when imported', async () => {","file":"e2e/app-dir/index.test.ts","skipped":true,"dir":"test"},{"name":"should have the correct pathname","suites":["app dir","client components","hooks","usePathname"],"updatePoint":{"line":984,"column":46},"line":984,"code":"          it('should have the correct pathname', async () => {\n            const html = await renderViaHTTP(next.url, '/hooks/use-pathname')\n            const $ = cheerio.load(html)\n            expect($('#pathname').attr('data-pathname')).toBe(\n              '/hooks/use-pathname'\n            )\n          })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should have the correct search params","suites":["app dir","client components","hooks","useSearchParams"],"updatePoint":{"line":994,"column":51},"line":994,"code":"          it('should have the correct search params', async () => {\n            const html = await renderViaHTTP(\n              next.url,\n              '/hooks/use-search-params?first=value&second=other%20value&third'\n            )\n            const $ = cheerio.load(html)\n            const el = $('#params')\n            expect(el.attr('data-param-first')).toBe('value')\n            expect(el.attr('data-param-second')).toBe('other value')\n            expect(el.attr('data-param-third')).toBe('')\n            expect(el.attr('data-param-not-real')).toBe('N/A')\n          })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should allow access to the router","suites":["app dir","client components","hooks","useRouter"],"updatePoint":{"line":1009,"column":47},"line":1009,"code":"          it('should allow access to the router', async () => {\n            const browser = await webdriver(next.url, '/hooks/use-router')\n\n            try {\n              // Wait for the page to load, click the button (which uses a method\n              // on the router) and then wait for the correct page to load.\n              await browser.waitForElementByCss('#router')\n              await browser.elementById('button-push').click()\n              await browser.waitForElementByCss('#router-sub-page')\n\n              // Go back (confirming we did do a hard push), and wait for the\n              // correct previous page.\n              await browser.back()\n              await browser.waitForElementByCss('#router')\n            } finally {\n              await browser.close()\n            }\n          })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should have consistent query and params handling","suites":["app dir","client components","hooks","useRouter"],"updatePoint":{"line":1028,"column":62},"line":1028,"code":"          it('should have consistent query and params handling', async () => {\n            const html = await renderViaHTTP(\n              next.url,\n              '/param-and-query/params?slug=query'\n            )\n            const $ = cheerio.load(html)\n            const el = $('#params-and-query')\n            expect(el.attr('data-params')).toBe('params')\n            expect(el.attr('data-query')).toBe('query')\n          })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should throw an error when getServerSideProps is used","suites":["app dir","client components","hooks","useRouter"],"updatePoint":{"line":1042,"column":65},"line":1042,"code":"        it('should throw an error when getServerSideProps is used', async () => {\n          const pageFile =\n            'app/client-with-errors/get-server-side-props/page.client.js'\n          const content = await next.readFile(pageFile)\n          const uncomment = content.replace(\n            '// export function getServerSideProps',\n            'export function getServerSideProps'\n          )\n          await next.patchFile(pageFile, uncomment)\n          const res = await fetchViaHTTP(\n            next.url,\n            '/client-with-errors/get-server-side-props'\n          )\n          await next.patchFile(pageFile, content)\n\n          await check(async () => {\n            const { status } = await fetchViaHTTP(\n              next.url,\n              '/client-with-errors/get-server-side-props'\n            )\n            return status\n          }, /200/)\n\n          expect(res.status).toBe(500)\n          expect(await res.text()).toContain(\n            'getServerSideProps is not supported in client components'\n          )\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should throw an error when getStaticProps is used","suites":["app dir","client components","hooks","useRouter"],"updatePoint":{"line":1071,"column":61},"line":1071,"code":"        it('should throw an error when getStaticProps is used', async () => {\n          const pageFile =\n            'app/client-with-errors/get-static-props/page.client.js'\n          const content = await next.readFile(pageFile)\n          const uncomment = content.replace(\n            '// export function getStaticProps',\n            'export function getStaticProps'\n          )\n          await next.patchFile(pageFile, uncomment)\n          const res = await fetchViaHTTP(\n            next.url,\n            '/client-with-errors/get-static-props'\n          )\n          await next.patchFile(pageFile, content)\n          await check(async () => {\n            const { status } = await fetchViaHTTP(\n              next.url,\n              '/client-with-errors/get-static-props'\n            )\n            return status\n          }, /200/)\n\n          expect(res.status).toBe(500)\n          expect(await res.text()).toContain(\n            'getStaticProps is not supported in client components'\n          )\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should support global css inside server layouts","suites":["app dir","css support","server layouts"],"updatePoint":{"line":1103,"column":59},"line":1103,"code":"        it('should support global css inside server layouts', async () => {\n          const browser = await webdriver(next.url, '/dashboard')\n\n          // Should body text in red\n          expect(\n            await browser.eval(\n              `window.getComputedStyle(document.querySelector('.p')).color`\n            )\n          ).toBe('rgb(255, 0, 0)')\n\n          // Should inject global css for .green selectors\n          expect(\n            await browser.eval(\n              `window.getComputedStyle(document.querySelector('.green')).color`\n            )\n          ).toBe('rgb(0, 128, 0)')\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should support css modules inside server layouts","suites":["app dir","css support","server layouts"],"updatePoint":{"line":1121,"column":60},"line":1121,"code":"        it('should support css modules inside server layouts', async () => {\n          const browser = await webdriver(next.url, '/css/css-nested')\n          expect(\n            await browser.eval(\n              `window.getComputedStyle(document.querySelector('#server-cssm')).color`\n            )\n          ).toBe('rgb(0, 128, 0)')\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should support global css inside server pages","suites":["app dir","css support","server pages"],"updatePoint":{"line":1132,"column":57},"line":1132,"code":"        it('should support global css inside server pages', async () => {\n          const browser = await webdriver(next.url, '/css/css-page')\n          expect(\n            await browser.eval(\n              `window.getComputedStyle(document.querySelector('h1')).color`\n            )\n          ).toBe('rgb(255, 0, 0)')\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should support css modules inside server pages","suites":["app dir","css support","server pages"],"updatePoint":{"line":1141,"column":58},"line":1141,"code":"        it('should support css modules inside server pages', async () => {\n          const browser = await webdriver(next.url, '/css/css-page')\n          expect(\n            await browser.eval(\n              `window.getComputedStyle(document.querySelector('#cssm')).color`\n            )\n          ).toBe('rgb(0, 0, 255)')\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should support css modules inside client layouts","suites":["app dir","css support","client layouts"],"updatePoint":{"line":1152,"column":60},"line":1152,"code":"        it('should support css modules inside client layouts', async () => {\n          const browser = await webdriver(next.url, '/client-nested')\n\n          // Should render h1 in red\n          expect(\n            await browser.eval(\n              `window.getComputedStyle(document.querySelector('h1')).color`\n            )\n          ).toBe('rgb(255, 0, 0)')\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should support global css inside client layouts","suites":["app dir","css support","client layouts"],"updatePoint":{"line":1163,"column":59},"line":1163,"code":"        it('should support global css inside client layouts', async () => {\n          const browser = await webdriver(next.url, '/client-nested')\n\n          // Should render button in red\n          expect(\n            await browser.eval(\n              `window.getComputedStyle(document.querySelector('button')).color`\n            )\n          ).toBe('rgb(255, 0, 0)')\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should support css modules inside client pages","suites":["app dir","css support","client pages"],"updatePoint":{"line":1176,"column":58},"line":1176,"code":"        it('should support css modules inside client pages', async () => {\n          const browser = await webdriver(next.url, '/client-component-route')\n\n          // Should render p in red\n          expect(\n            await browser.eval(\n              `window.getComputedStyle(document.querySelector('p')).color`\n            )\n          ).toBe('rgb(255, 0, 0)')\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should support global css inside client pages","suites":["app dir","css support","client pages"],"updatePoint":{"line":1187,"column":57},"line":1187,"code":"        it('should support global css inside client pages', async () => {\n          const browser = await webdriver(next.url, '/client-component-route')\n\n          // Should render `b` in blue\n          expect(\n            await browser.eval(\n              `window.getComputedStyle(document.querySelector('b')).color`\n            )\n          ).toBe('rgb(0, 0, 255)')\n        })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"does not include nonce when not enabled","suites":["app dir","css support","client pages"],"updatePoint":{"line":1220,"column":49},"line":1220,"code":"      it('does not include nonce when not enabled', async () => {\n        const policies = [\n          `script-src 'nonce-'`, // invalid nonce\n          'style-src \"nonce-cmFuZG9tCg==\"', // no script or default src\n          '', // empty string\n        ]\n\n        for (const policy of policies) {\n          const $ = await renderWithPolicy(policy)\n\n          // Find all the script tags without src attributes and with nonce\n          // attributes.\n          const elements = $('script[nonce]:not([src])')\n\n          // Expect there to be none.\n          expect(elements.length).toBe(0)\n        }\n      })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"includes a nonce value with inline scripts when Content-Security-Policy header is defined","suites":["app dir","css support","client pages"],"updatePoint":{"line":1239,"column":99},"line":1239,"code":"      it('includes a nonce value with inline scripts when Content-Security-Policy header is defined', async () => {\n        // A random nonce value, base64 encoded.\n        const nonce = 'cmFuZG9tCg=='\n\n        // Validate all the cases where we could parse the nonce.\n        const policies = [\n          `script-src 'nonce-${nonce}'`, // base case\n          `   script-src   'nonce-${nonce}' `, // extra space added around sources and directive\n          `style-src 'self'; script-src 'nonce-${nonce}'`, // extra directives\n          `script-src 'self' 'nonce-${nonce}' 'nonce-othernonce'`, // extra nonces\n          `default-src 'nonce-othernonce'; script-src 'nonce-${nonce}';`, // script and then fallback case\n          `default-src 'nonce-${nonce}'`, // fallback case\n        ]\n\n        for (const policy of policies) {\n          const $ = await renderWithPolicy(policy)\n\n          // Find all the script tags without src attributes.\n          const elements = $('script:not([src])')\n\n          // Expect there to be at least 1 script tag without a src attribute.\n          expect(elements.length).toBeGreaterThan(0)\n\n          // Expect all inline scripts to have the nonce value.\n          elements.each((i, el) => {\n            expect(el.attribs['nonce']).toBe(nonce)\n          })\n        }\n      })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"includes an integrity attribute on scripts","suites":["app dir","css support","client pages"],"updatePoint":{"line":1269,"column":52},"line":1269,"code":"      it('includes an integrity attribute on scripts', async () => {\n        const html = await renderViaHTTP(next.url, '/dashboard')\n\n        const $ = cheerio.load(html)\n\n        // Find all the script tags with src attributes.\n        const elements = $('script[src]')\n\n        // Expect there to be at least 1 script tag with a src attribute.\n        expect(elements.length).toBeGreaterThan(0)\n\n        // Collect all the scripts with integrity hashes so we can verify them.\n        const files: [string, string][] = []\n\n        // For each of these attributes, ensure that there's an integrity\n        // attribute and starts with the correct integrity hash prefix.\n        elements.each((i, el) => {\n          const integrity = el.attribs['integrity']\n          expect(integrity).toBeDefined()\n          expect(integrity).toStartWith('sha256-')\n\n          const src = el.attribs['src']\n          expect(src).toBeDefined()\n\n          files.push([src, integrity])\n        })\n\n        // For each script tag, ensure that the integrity attribute is the\n        // correct hash of the script tag.\n        for (const [src, integrity] of files) {\n          const res = await fetchViaHTTP(next.url, src)\n          expect(res.status).toBe(200)\n          const content = await res.text()\n\n          const hash = crypto\n            .createHash('sha256')\n            .update(content)\n            .digest()\n            .toString('base64')\n\n          expect(integrity).toEndWith(hash)\n        }\n      })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"throws when escape characters are included in nonce","suites":["app dir","css support","client pages"],"updatePoint":{"line":1313,"column":61},"line":1313,"code":"      it('throws when escape characters are included in nonce', async () => {\n        const res = await fetchWithPolicy(\n          `script-src 'nonce-\"><script></script>\"'`\n        )\n\n        expect(res.status).toBe(500)\n      })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should render the template that holds state in a client component and reset on navigation","suites":["app dir","template component"],"updatePoint":{"line":1323,"column":99},"line":1323,"code":"      it('should render the template that holds state in a client component and reset on navigation', async () => {\n        const browser = await webdriver(next.url, '/template/clientcomponent')\n        expect(await browser.elementByCss('h1').text()).toBe('Template 0')\n        await browser.elementByCss('button').click()\n        expect(await browser.elementByCss('h1').text()).toBe('Template 1')\n\n        await browser.elementByCss('#link').click()\n        await browser.waitForElementByCss('#other-page')\n\n        expect(await browser.elementByCss('h1').text()).toBe('Template 0')\n        await browser.elementByCss('button').click()\n        expect(await browser.elementByCss('h1').text()).toBe('Template 1')\n\n        await browser.elementByCss('#link').click()\n        await browser.waitForElementByCss('#page')\n\n        expect(await browser.elementByCss('h1').text()).toBe('Template 0')\n      })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should render the template that is a server component and rerender on navigation","suites":["app dir","template component"],"line":1343,"code":"      it.skip('should render the template that is a server component and rerender on navigation', async () => {","file":"e2e/app-dir/index.test.ts","skipped":true,"dir":"test"},{"name":"should trigger error component when an error happens during rendering","suites":["app dir","template component"],"updatePoint":{"line":1372,"column":79},"line":1372,"code":"      it('should trigger error component when an error happens during rendering', async () => {\n        const browser = await webdriver(next.url, '/error/clientcomponent')\n        await browser\n          .elementByCss('#error-trigger-button')\n          .click()\n          .waitForElementByCss('#error-boundary-message')\n\n        expect(\n          await browser.elementByCss('#error-boundary-message').text()\n        ).toBe('An error occurred: this is a test')\n      })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should allow resetting error boundary","suites":["app dir","template component"],"updatePoint":{"line":1384,"column":47},"line":1384,"code":"      it('should allow resetting error boundary', async () => {\n        const browser = await webdriver(next.url, '/error/clientcomponent')\n\n        // Try triggering and resetting a few times in a row\n        for (let i = 0; i < 5; i++) {\n          await browser\n            .elementByCss('#error-trigger-button')\n            .click()\n            .waitForElementByCss('#error-boundary-message')\n\n          expect(\n            await browser.elementByCss('#error-boundary-message').text()\n          ).toBe('An error occurred: this is a test')\n\n          await browser\n            .elementByCss('#reset')\n            .click()\n            .waitForElementByCss('#error-trigger-button')\n\n          expect(\n            await browser.elementByCss('#error-trigger-button').text()\n          ).toBe('Trigger Error!')\n        }\n      })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should hydrate empty shell to handle server-side rendering errors","suites":["app dir","template component"],"updatePoint":{"line":1409,"column":75},"line":1409,"code":"      it('should hydrate empty shell to handle server-side rendering errors', async () => {\n        const browser = await webdriver(\n          next.url,\n          '/error/ssr-error-client-component'\n        )\n        const logs = await browser.log()\n        const errors = logs\n          .filter((x) => x.source === 'error')\n          .map((x) => x.message)\n          .join('\\n')\n        expect(errors).toInclude('Error during SSR')\n      })","file":"e2e/app-dir/index.test.ts","skipped":false,"dir":"test"},{"name":"should skip for react v17","suites":["app dir rendering"],"updatePoint":{"line":9,"column":33},"line":9,"code":"    it('should skip for react v17', () => {})","file":"e2e/app-dir/rendering.test.ts","skipped":false,"dir":"test"},{"name":"should skip next deploy for now","suites":["app dir rendering"],"updatePoint":{"line":14,"column":39},"line":14,"code":"    it('should skip next deploy for now', () => {})","file":"e2e/app-dir/rendering.test.ts","skipped":false,"dir":"test"},{"name":"should serve app/page.server.js at /","suites":["app dir rendering"],"updatePoint":{"line":37,"column":42},"line":37,"code":"  it('should serve app/page.server.js at /', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toContain('app/page.server.js')\n  })","file":"e2e/app-dir/rendering.test.ts","skipped":false,"dir":"test"},{"name":"should run getServerSideProps in layout and page","suites":["app dir rendering","getServerSideProps only"],"updatePoint":{"line":43,"column":56},"line":43,"code":"    it('should run getServerSideProps in layout and page', async () => {\n      const html = await renderViaHTTP(\n        next.url,\n        '/getserversideprops-only/nested'\n      )\n      const $ = cheerio.load(html)\n      expect($('#layout-message').text()).toBe('hello from layout')\n      expect($('#page-message').text()).toBe('hello from page')\n    })","file":"e2e/app-dir/rendering.test.ts","skipped":false,"dir":"test"},{"name":"should run getServerSideProps in parallel","suites":["app dir rendering","getServerSideProps only"],"updatePoint":{"line":53,"column":49},"line":53,"code":"    it('should run getServerSideProps in parallel', async () => {\n      const startTime = Date.now()\n      const html = await renderViaHTTP(\n        next.url,\n        '/getserversideprops-only/slow'\n      )\n      const endTime = Date.now()\n      const duration = endTime - startTime\n      // Each part takes 5 seconds so it should be below 10 seconds\n      // Using 7 seconds to ensure external factors causing slight slowness don't fail the tests\n      expect(duration < 7000).toBe(true)\n      const $ = cheerio.load(html)\n      expect($('#slow-layout-message').text()).toBe('hello from slow layout')\n      expect($('#slow-page-message').text()).toBe('hello from slow page')\n    })","file":"e2e/app-dir/rendering.test.ts","skipped":false,"dir":"test"},{"name":"should run getStaticProps in layout and page","suites":["app dir rendering","getStaticProps only"],"updatePoint":{"line":71,"column":52},"line":71,"code":"    it('should run getStaticProps in layout and page', async () => {\n      const html = await renderViaHTTP(next.url, '/getstaticprops-only/nested')\n      const $ = cheerio.load(html)\n      expect($('#layout-message').text()).toBe('hello from layout')\n      expect($('#page-message').text()).toBe('hello from page')\n    })","file":"e2e/app-dir/rendering.test.ts","skipped":false,"dir":"test"},{"name":"should run getStaticProps in parallel ","suites":["app dir rendering","getStaticProps only"],"updatePoint":{"line":80,"column":5},"line":78,"code":"    it(`should run getStaticProps in parallel ${\n      isDev ? 'during development' : 'and use cached version for production'\n    }`, async () => {\n      const startTime = Date.now()\n      const html = await renderViaHTTP(next.url, '/getstaticprops-only/slow')\n      const endTime = Date.now()\n      const duration = endTime - startTime\n      // Each part takes 5 seconds so it should be below 10 seconds\n      // Using 7 seconds to ensure external factors causing slight slowness don't fail the tests\n      // TODO: cache static props in prod\n      // expect(duration < (isDev ? 7000 : 2000)).toBe(true)\n      expect(duration < 7000).toBe(true)\n      const $ = cheerio.load(html)\n      expect($('#slow-layout-message').text()).toBe('hello from slow layout')\n      expect($('#slow-page-message').text()).toBe('hello from slow page')\n    })","file":"e2e/app-dir/rendering.test.ts","skipped":false,"dir":"test"},{"name":"should revalidate the page when getStaticProps return revalidate","suites":["app dir rendering","getStaticProps ISR"],"updatePoint":{"line":97,"column":72},"line":97,"code":"    it('should revalidate the page when getStaticProps return revalidate', async () => {\n      const getPage = async () => {\n        const res = await fetchViaHTTP(\n          next.url,\n          'getstaticprops-isr-multiple/nested'\n        )\n        const html = await res.text()\n\n        return {\n          $: cheerio.load(html),\n          cacheHeader: res.headers['x-nextjs-cache'],\n        }\n      }\n      const { $ } = await getPage()\n      expect($('#layout-message').text()).toBe('hello from layout')\n      expect($('#page-message').text()).toBe('hello from page')\n\n      const layoutNow = $('#layout-now').text()\n      const pageNow = $('#page-now').text()\n\n      await waitFor(2000)\n\n      // TODO: implement\n      // Trigger revalidate\n      // const { cacheHeader: revalidateCacheHeader } = await getPage()\n      // expect(revalidateCacheHeader).toBe('STALE')\n\n      // TODO: implement\n      const { $: $revalidated /* cacheHeader: revalidatedCacheHeader */ } =\n        await getPage()\n      // expect(revalidatedCacheHeader).toBe('REVALIDATED')\n\n      const layoutNowRevalidated = $revalidated('#layout-now').text()\n      const pageNowRevalidated = $revalidated('#page-now').text()\n\n      // Expect that the `Date.now()` is different as the page have been regenerated\n      expect(layoutNow).not.toBe(layoutNowRevalidated)\n      expect(pageNow).not.toBe(pageNowRevalidated)\n    })","file":"e2e/app-dir/rendering.test.ts","skipped":false,"dir":"test"},{"name":"should generate getStaticProps data during build an use it","suites":["app dir rendering","getStaticProps and getServerSideProps without ISR"],"updatePoint":{"line":140,"column":66},"line":140,"code":"    it('should generate getStaticProps data during build an use it', async () => {\n      const getPage = async () => {\n        const html = await renderViaHTTP(\n          next.url,\n          'getstaticprops-getserversideprops-combined/nested'\n        )\n\n        return {\n          $: cheerio.load(html),\n        }\n      }\n      const { $ } = await getPage()\n      expect($('#layout-message').text()).toBe('hello from layout')\n      expect($('#page-message').text()).toBe('hello from page')\n\n      const layoutNow = $('#layout-now').text()\n      const pageNow = $('#page-now').text()\n\n      const { $: $second } = await getPage()\n\n      const layoutNowSecond = $second('#layout-now').text()\n      const pageNowSecond = $second('#page-now').text()\n\n      // Expect that the `Date.now()` is different as it came from getServerSideProps\n      expect(layoutNow).not.toBe(layoutNowSecond)\n      // Expect that the `Date.now()` is the same as it came from getStaticProps\n      expect(pageNow).toBe(pageNowSecond)\n    })","file":"e2e/app-dir/rendering.test.ts","skipped":true,"dir":"test"},{"name":"should skip for deploy mode for now","suites":["app dir - react server components"],"updatePoint":{"line":33,"column":43},"line":33,"code":"    it('should skip for deploy mode for now', () => {})","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should skip tests for next-deploy and react 17","suites":["app dir - react server components"],"updatePoint":{"line":71,"column":54},"line":71,"code":"    it('should skip tests for next-deploy and react 17', () => {})","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should render server components correctly","suites":["app dir - react server components"],"updatePoint":{"line":75,"column":47},"line":75,"code":"  it('should render server components correctly', async () => {\n    const homeHTML = await renderViaHTTP(next.url, '/', null, {\n      headers: {\n        'x-next-test-client': 'test-util',\n      },\n    })\n\n    // should have only 1 DOCTYPE\n    expect(homeHTML).toMatch(/^<!DOCTYPE html><html/)\n    // TODO: support next/head\n    // expect(homeHTML).toMatch('<meta name=\"rsc-title\" content=\"index\"/>')\n    expect(homeHTML).toContain('component:index.server')\n    // TODO: support env\n    // expect(homeHTML).toContain('env:env_var_test')\n    expect(homeHTML).toContain('header:test-util')\n\n    const inlineFlightContents = []\n    const $ = cheerio.load(homeHTML)\n    $('script').each((index, tag) => {\n      const content = $(tag).text()\n      if (content) inlineFlightContents.push(content)\n    })\n\n    const internalQueries = [\n      '__nextFallback',\n      '__nextLocale',\n      '__nextDefaultLocale',\n      '__nextIsNotFound',\n      '__flight__',\n      '__props__',\n      '__flight_router_path__',\n    ]\n\n    const hasNextInternalQuery = inlineFlightContents.some((content) =>\n      internalQueries.some((query) => content.includes(query))\n    )\n    expect(hasNextInternalQuery).toBe(false)\n  })","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should reuse the inline flight response without sending extra requests","suites":["app dir - react server components"],"updatePoint":{"line":114,"column":76},"line":114,"code":"  it('should reuse the inline flight response without sending extra requests', async () => {\n    let hasFlightRequest = false\n    let requestsCount = 0\n    await webdriver(next.url, '/root', {\n      beforePageLoad(page) {\n        page.on('request', (request) => {\n          requestsCount++\n          const url = request.url()\n          if (\n            url.includes('__flight__=1') &&\n            // Prefetches also include `__flight__`\n            !url.includes('__flight_prefetch__=1')\n          ) {\n            hasFlightRequest = true\n          }\n        })\n      },\n    })\n\n    expect(requestsCount).toBeGreaterThan(0)\n    expect(hasFlightRequest).toBe(false)\n  })","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should support multi-level server component imports","suites":["app dir - react server components"],"updatePoint":{"line":137,"column":57},"line":137,"code":"  it('should support multi-level server component imports', async () => {\n    const html = await renderViaHTTP(next.url, '/multi')\n    expect(html).toContain('bar.server.js:')\n    expect(html).toContain('foo.client')\n  })","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should resolve different kinds of components correctly","suites":["app dir - react server components"],"updatePoint":{"line":143,"column":60},"line":143,"code":"  it('should resolve different kinds of components correctly', async () => {\n    const html = await renderViaHTTP(next.url, '/shared')\n    const main = getNodeBySelector(html, '#main').html()\n\n    // Should have 5 occurrences of \"client_component\".\n    expect(Array.from(main.matchAll(/client_component/g)).length).toBe(5)\n\n    // Should have 2 occurrences of \"shared:server\", and 2 occurrences of\n    // \"shared:client\".\n    const sharedServerModule = Array.from(main.matchAll(/shared:server:(\\d+)/g))\n    const sharedClientModule = Array.from(main.matchAll(/shared:client:(\\d+)/g))\n    expect(sharedServerModule.length).toBe(2)\n    expect(sharedClientModule.length).toBe(2)\n\n    // Should have 2 modules created for the shared component.\n    expect(sharedServerModule[0][1]).toBe(sharedServerModule[1][1])\n    expect(sharedClientModule[0][1]).toBe(sharedClientModule[1][1])\n    expect(sharedServerModule[0][1]).not.toBe(sharedClientModule[0][1])\n\n    // Note: This is currently unsupported because packages from another layer\n    // will not be re-initialized by webpack.\n    // Should import 2 module instances for node_modules too.\n    // const modFromClient = main.match(\n    //   /node_modules instance from \\.client\\.js:(\\d+)/\n    // )\n    // const modFromServer = main.match(\n    //   /node_modules instance from \\.server\\.js:(\\d+)/\n    // )\n    // expect(modFromClient[1]).not.toBe(modFromServer[1])\n  })","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should be able to navigate between rsc routes","suites":["app dir - react server components"],"updatePoint":{"line":174,"column":51},"line":174,"code":"  it('should be able to navigate between rsc routes', async () => {\n    const browser = await webdriver(next.url, '/root')\n\n    await browser.waitForElementByCss('#goto-next-link').click()\n    await new Promise((res) => setTimeout(res, 1000))\n    await check(() => browser.url(), `${next.url}/next-api/link`)\n    await browser.waitForElementByCss('#goto-home').click()\n    await new Promise((res) => setTimeout(res, 1000))\n    await check(() => browser.url(), `${next.url}/root`)\n    const content = await browser.elementByCss('body').text()\n    expect(content).toContain('component:root.server')\n\n    await browser.waitForElementByCss('#goto-streaming-rsc').click()\n\n    // Wait for navigation and streaming to finish.\n    await check(\n      () => browser.elementByCss('#content').text(),\n      'next_streaming_data'\n    )\n    expect(await browser.url()).toBe(`${next.url}/streaming-rsc`)\n  })","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should handle streaming server components correctly","suites":["app dir - react server components"],"updatePoint":{"line":196,"column":57},"line":196,"code":"  it('should handle streaming server components correctly', async () => {\n    const browser = await webdriver(next.url, '/streaming-rsc')\n    const content = await browser.eval(\n      `document.querySelector('#content').innerText`\n    )\n    expect(content).toMatchInlineSnapshot('\"next_streaming_data\"')\n  })","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should support next/link in server components","suites":["app dir - react server components"],"updatePoint":{"line":204,"column":51},"line":204,"code":"  it('should support next/link in server components', async () => {\n    const linkHTML = await renderViaHTTP(next.url, '/next-api/link')\n    const linkText = getNodeBySelector(linkHTML, 'body a[href=\"/root\"]').text()\n\n    expect(linkText).toContain('home')\n\n    const browser = await webdriver(next.url, '/next-api/link')\n\n    // We need to make sure the app is fully hydrated before clicking, otherwise\n    // it will be a full redirection instead of being taken over by the next\n    // router. This timeout prevents it being flaky caused by fast refresh's\n    // rebuilding event.\n    await new Promise((res) => setTimeout(res, 1000))\n    await browser.eval('window.beforeNav = 1')\n\n    await browser.waitForElementByCss('#next_id').click()\n    await check(() => browser.elementByCss('#query').text(), 'query:1')\n\n    await browser.waitForElementByCss('#next_id').click()\n    await check(() => browser.elementByCss('#query').text(), 'query:2')\n\n    if (isNextDev) {\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n    }\n  })","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should refresh correctly with next/link","suites":["app dir - react server components"],"updatePoint":{"line":230,"column":45},"line":230,"code":"  it('should refresh correctly with next/link', async () => {\n    // Select the button which is not hidden but rendered\n    const selector = '#goto-next-link'\n    let hasFlightRequest = false\n    const browser = await webdriver(next.url, '/root', {\n      beforePageLoad(page) {\n        page.on('request', (request) => {\n          const url = request.url()\n          if (\n            url.includes('__flight__=1') &&\n            // Prefetches also include `__flight__`\n            !url.includes('__flight_prefetch__=1')\n          ) {\n            hasFlightRequest = true\n          }\n        })\n      },\n    })\n\n    // wait for hydration\n    await new Promise((res) => setTimeout(res, 1000))\n    if (isNextDev) {\n      expect(hasFlightRequest).toBe(false)\n    }\n    await browser.elementByCss(selector).click()\n\n    // wait for re-hydration\n    if (isNextDev) {\n      await check(\n        () => (hasFlightRequest ? 'success' : hasFlightRequest),\n        'success'\n      )\n    }\n    const refreshText = await browser.elementByCss(selector).text()\n    expect(refreshText).toBe('next link')\n  })","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should escape streaming data correctly","suites":["app dir - react server components"],"updatePoint":{"line":267,"column":44},"line":267,"code":"  it('should escape streaming data correctly', async () => {\n    const browser = await webdriver(next.url, '/escaping-rsc')\n    const manipulated = await browser.eval(`window.__manipulated_by_injection`)\n    expect(manipulated).toBe(undefined)\n  })","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should render built-in 404 page for missing route if pagesDir is not presented","suites":["app dir - react server components"],"updatePoint":{"line":273,"column":84},"line":273,"code":"  it('should render built-in 404 page for missing route if pagesDir is not presented', async () => {\n    const res = await fetchViaHTTP(next.url, '/does-not-exist')\n\n    expect(res.status).toBe(404)\n    const html = await res.text()\n    expect(html).toContain('This page could not be found')\n  })","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should suspense next/image in server components","suites":["app dir - react server components"],"updatePoint":{"line":281,"column":53},"line":281,"code":"  it('should suspense next/image in server components', async () => {\n    const imageHTML = await renderViaHTTP(next.url, '/next-api/image')\n    const imageTag = getNodeBySelector(imageHTML, '#myimg')\n\n    expect(imageTag.attr('src')).toContain('data:image')\n  })","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should handle external async module libraries correctly","suites":["app dir - react server components"],"updatePoint":{"line":288,"column":61},"line":288,"code":"  it('should handle external async module libraries correctly', async () => {\n    const html = await renderViaHTTP(next.url, '/external-imports')\n    expect(html).toContain('module type:esm-export')\n    expect(html).toContain('export named:named')\n    expect(html).toContain('export value:123')\n    expect(html).toContain('export array:4,5,6')\n    expect(html).toContain('export object:{x:1}')\n  })","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should handle various kinds of exports correctly","suites":["app dir - react server components"],"updatePoint":{"line":297,"column":54},"line":297,"code":"  it('should handle various kinds of exports correctly', async () => {\n    const html = await renderViaHTTP(next.url, '/various-exports')\n    const content = getNodeBySelector(html, 'body').text()\n\n    expect(content).toContain('abcde')\n    expect(content).toContain('default-export-arrow.client')\n    expect(content).toContain('named.client')\n\n    const browser = await webdriver(next.url, '/various-exports')\n    const hydratedContent = await browser.waitForElementByCss('body').text()\n\n    expect(hydratedContent).toContain('abcde')\n    expect(hydratedContent).toContain('default-export-arrow.client')\n    expect(hydratedContent).toContain('named.client')\n    expect(hydratedContent).toContain('cjs-shared')\n    expect(hydratedContent).toContain('cjs-client')\n    expect(hydratedContent).toContain('Export All: one, two, two')\n  })","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should support native modules in server component","suites":["app dir - react server components"],"updatePoint":{"line":316,"column":55},"line":316,"code":"  it('should support native modules in server component', async () => {\n    const html = await renderViaHTTP(next.url, '/native-module')\n    const content = getNodeBySelector(html, 'body').text()\n\n    expect(content).toContain('fs: function')\n    expect(content).toContain('foo.client')\n  })","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should support the re-export syntax in server component","suites":["app dir - react server components"],"updatePoint":{"line":324,"column":61},"line":324,"code":"  it('should support the re-export syntax in server component', async () => {\n    const html = await renderViaHTTP(next.url, '/shared')\n    const content = getNodeBySelector(html, '#bar').text()\n\n    expect(content).toContain('bar.server.js:')\n  })","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should render initial styles of css-in-js in SSR correctly","suites":["app dir - react server components"],"updatePoint":{"line":331,"column":64},"line":331,"code":"  it('should render initial styles of css-in-js in SSR correctly', async () => {\n    const html = await renderViaHTTP(next.url, '/css-in-js')\n    const head = getNodeBySelector(html, 'head').html()\n\n    // from styled-jsx\n    expect(head).toMatch(/{color:(\\s*)purple;?}/) // styled-jsx/style\n    expect(head).toMatch(/{color:(\\s*)hotpink;?}/) // styled-jsx/css\n\n    // from styled-components\n    expect(head).toMatch(/{color:(\\s*)blue;?}/)\n  })","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should stick to the url without trailing /page suffix","suites":["app dir - react server components"],"updatePoint":{"line":343,"column":59},"line":343,"code":"  it('should stick to the url without trailing /page suffix', async () => {\n    const browser = await webdriver(next.url, '/edge/dynamic')\n    const indexUrl = await browser.url()\n\n    await browser.loadPage(`${next.url}/edge/dynamic/123`, {\n      disableCache: false,\n      beforePageLoad: null,\n    })\n\n    const dynamicRouteUrl = await browser.url()\n    expect(indexUrl).toBe(`${next.url}/edge/dynamic`)\n    expect(dynamicRouteUrl).toBe(`${next.url}/edge/dynamic/123`)\n  })","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should support streaming for flight response","suites":["app dir - react server components"],"updatePoint":{"line":357,"column":50},"line":357,"code":"  it('should support streaming for flight response', async () => {\n    await fetchViaHTTP(next.url, '/?__flight__=1').then(async (response) => {\n      const result = await resolveStreamResponse(response)\n      expect(result).toContain('component:index.server')\n    })\n  })","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should support partial hydration with inlined server data","suites":["app dir - react server components"],"updatePoint":{"line":364,"column":63},"line":364,"code":"  it('should support partial hydration with inlined server data', async () => {\n    await fetchViaHTTP(next.url, '/partial-hydration', null, {}).then(\n      async (response) => {\n        let gotFallback = false\n        let gotData = false\n        let gotInlinedData = false\n\n        await resolveStreamResponse(response, (_, result) => {\n          gotInlinedData = result.includes('self.__next_s=')\n          gotData = result.includes('next_streaming_data')\n          if (!gotFallback) {\n            gotFallback = result.includes('next_streaming_fallback')\n            if (gotFallback) {\n              expect(gotData).toBe(false)\n              expect(gotInlinedData).toBe(false)\n            }\n          }\n        })\n\n        expect(gotFallback).toBe(true)\n        expect(gotData).toBe(true)\n        expect(gotInlinedData).toBe(true)\n      }\n    )\n  })","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should support partial hydration with inlined server data in browser","suites":["app dir - react server components"],"line":391,"code":"  it.skip('should support partial hydration with inlined server data in browser', async () => {","file":"e2e/app-dir/rsc-basic.test.ts","skipped":true,"dir":"test"},{"name":"should generate edge SSR manifests for Node.js","suites":["app dir - react server components"],"updatePoint":{"line":410,"column":54},"line":410,"code":"    it('should generate edge SSR manifests for Node.js', async () => {\n      const distServerDir = path.join(distDir, 'server')\n\n      const requiredServerFiles = (\n        await fs.readJSON(path.join(distDir, 'required-server-files.json'))\n      ).files\n\n      const files = [\n        'middleware-build-manifest.js',\n        'middleware-manifest.json',\n        'flight-manifest.json',\n      ]\n\n      files.forEach((file) => {\n        const filepath = path.join(distServerDir, file)\n        expect(fs.existsSync(filepath)).toBe(true)\n      })\n\n      requiredServerFiles.forEach((file) => {\n        const requiredFilePath = path.join(next.testDir, file)\n        expect(fs.existsSync(requiredFilePath)).toBe(true)\n      })\n    })","file":"e2e/app-dir/rsc-basic.test.ts","skipped":false,"dir":"test"},{"name":"should allow URL query strings without refresh","suites":["basePath + trailingSlash"],"updatePoint":{"line":31,"column":54},"line":31,"code":"    it('should allow URL query strings without refresh', async () => {\n      const browser = await webdriver(next.url, `${basePath}/hello/?query=true`)\n      try {\n        await browser.eval('window.itdidnotrefresh = \"hello\"')\n        await new Promise((resolve, reject) => {\n          // Timeout of EventSource created in setupPing()\n          // (on-demand-entries-utils.js) is 5000 ms (see #13132, #13560)\n          setTimeout(resolve, dev ? 10000 : 1000)\n        })\n        expect(await browser.eval('window.itdidnotrefresh')).toBe('hello')\n\n        const pathname = await browser.elementByCss('#pathname').text()\n        expect(pathname).toBe('/hello')\n        expect(await browser.eval('window.location.pathname')).toBe(\n          `${basePath}/hello/`\n        )\n        expect(await browser.eval('window.location.search')).toBe('?query=true')\n\n        if (dev) {\n          expect(await hasRedbox(browser, false)).toBe(false)\n        }\n      } finally {\n        await browser.close()\n      }\n    })","file":"e2e/basepath-trailing-slash.test.ts","skipped":false,"dir":"test"},{"name":"should allow URL query strings on index without refresh","suites":["basePath + trailingSlash"],"updatePoint":{"line":57,"column":63},"line":57,"code":"    it('should allow URL query strings on index without refresh', async () => {\n      const browser = await webdriver(next.url, `${basePath}/?query=true`)\n      try {\n        await browser.eval('window.itdidnotrefresh = \"hello\"')\n        await new Promise((resolve, reject) => {\n          // Timeout of EventSource created in setupPing()\n          // (on-demand-entries-utils.js) is 5000 ms (see #13132, #13560)\n          setTimeout(resolve, dev ? 10000 : 1000)\n        })\n        expect(await browser.eval('window.itdidnotrefresh')).toBe('hello')\n\n        const pathname = await browser.elementByCss('#pathname').text()\n        expect(pathname).toBe('/')\n        expect(await browser.eval('window.location.pathname')).toBe(\n          basePath + '/'\n        )\n        expect(await browser.eval('window.location.search')).toBe('?query=true')\n\n        if (dev) {\n          expect(await hasRedbox(browser, false)).toBe(false)\n        }\n      } finally {\n        await browser.close()\n      }\n    })","file":"e2e/basepath-trailing-slash.test.ts","skipped":false,"dir":"test"},{"name":"should correctly replace state when same asPath but different url","suites":["basePath + trailingSlash"],"updatePoint":{"line":83,"column":73},"line":83,"code":"    it('should correctly replace state when same asPath but different url', async () => {\n      const browser = await webdriver(next.url, `${basePath}/`)\n      try {\n        await browser.elementByCss('#hello-link').click()\n        await browser.waitForElementByCss('#something-else-link')\n        await browser.elementByCss('#something-else-link').click()\n        await browser.waitForElementByCss('#something-else-page')\n        await browser.back()\n        await browser.waitForElementByCss('#index-page')\n        await browser.forward()\n        await browser.waitForElementByCss('#something-else-page')\n      } finally {\n        await browser.close()\n      }\n    })","file":"e2e/basepath-trailing-slash.test.ts","skipped":false,"dir":"test"},{"name":"should navigate to external site and back","suites":["basePath"],"updatePoint":{"line":100,"column":49},"line":100,"code":"    it('should navigate to external site and back', async () => {\n      const browser = await webdriver(next.url, `${basePath}/external-and-back`)\n      const initialText = await browser.elementByCss('p').text()\n      expect(initialText).toBe('server')\n\n      await browser\n        .elementByCss('a')\n        .click()\n        .waitForElementByCss('input')\n        .back()\n        .waitForElementByCss('p')\n\n      await waitFor(1000)\n      const newText = await browser.elementByCss('p').text()\n      expect(newText).toBe('server')\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should handle query/hash correctly during query updating $hash $search","suites":["basePath"],"line":123,"code":"    it.each([\n      { hash: '#hello?' },\n      { hash: '#?' },\n      { hash: '##' },\n      { hash: '##?' },\n      { hash: '##hello?' },\n      { hash: '##hello' },\n      { hash: '#hello?world' },\n      { search: '?hello=world', hash: '#a', query: { hello: 'world' } },\n      { search: '?hello', hash: '#a', query: { hello: '' } },\n      { search: '?hello=', hash: '#a', query: { hello: '' } },\n    ])(\n      'should handle query/hash correctly during query updating $hash $search',\n      async ({ hash, search, query }) => {\n        const browser = await webdriver(\n          next.url,\n          `${basePath}${search || ''}${hash || ''}`\n        )\n\n        await check(\n          () =>\n            browser.eval('window.next.router.isReady ? \"ready\" : \"not ready\"'),\n          'ready'\n        )\n        expect(await browser.eval('window.location.pathname')).toBe(basePath)\n        expect(await browser.eval('window.location.search')).toBe(search || '')\n        expect(await browser.eval('window.location.hash')).toBe(hash || '')\n        expect(await browser.eval('next.router.pathname')).toBe('/')\n        expect(\n          JSON.parse(await browser.eval('JSON.stringify(next.router.query)'))\n        ).toEqual(query || {})\n      }\n    )","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should navigate back correctly to a dynamic route","suites":["basePath"],"updatePoint":{"line":157,"column":57},"line":157,"code":"    it('should navigate back correctly to a dynamic route', async () => {\n      const browser = await webdriver(next.url, `${basePath}`)\n\n      expect(await browser.elementByCss('#index-page').text()).toContain(\n        'index page'\n      )\n\n      await browser.eval('window.beforeNav = 1')\n\n      await browser.eval('window.next.router.push(\"/catchall/first\")')\n\n      await check(() => browser.elementByCss('p').text(), /first/)\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n\n      await browser.eval('window.next.router.push(\"/catchall/second\")')\n      await check(() => browser.elementByCss('p').text(), /second/)\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n\n      await browser.eval('window.next.router.back()')\n      await check(() => browser.elementByCss('p').text(), /first/)\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n\n      await browser.eval('window.history.forward()')\n      await check(() => browser.elementByCss('p').text(), /second/)\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should respect basePath in amphtml link rel","suites":["basePath"],"updatePoint":{"line":184,"column":51},"line":184,"code":"    it('should respect basePath in amphtml link rel', async () => {\n      const html = await renderViaHTTP(next.url, `${basePath}/amp-hybrid`)\n      const $ = cheerio.load(html)\n      const expectedAmpHtmlUrl = isDev\n        ? `${basePath}/amp-hybrid?amp=1`\n        : `${basePath}/amp-hybrid.amp`\n      expect($('link[rel=amphtml]').first().attr('href')).toBe(\n        expectedAmpHtmlUrl\n      )\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should add basePath to routes-manifest","suites":["basePath"],"updatePoint":{"line":197,"column":50},"line":197,"code":"        it('should add basePath to routes-manifest', async () => {\n          const routesManifest = JSON.parse(\n            await next.readFile('.next/routes-manifest.json')\n          )\n          expect(routesManifest.basePath).toBe(basePath)\n        })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should prefetch pages correctly when manually called","suites":["basePath"],"updatePoint":{"line":205,"column":62},"line":205,"code":"      it('should prefetch pages correctly when manually called', async () => {\n        const browser = await webdriver(next.url, `${basePath}/other-page`)\n        await browser.eval('window.next.router.prefetch(\"/gssp\")')\n\n        await check(\n          async () => {\n            const links = await browser.elementsByCss('link[rel=prefetch]')\n\n            for (const link of links) {\n              const href = await link.getAttribute('href')\n              if (href.includes('gssp')) {\n                return true\n              }\n            }\n\n            const scripts = await browser.elementsByCss('script')\n\n            for (const script of scripts) {\n              const src = await script.getAttribute('src')\n              if (src.includes('gssp')) {\n                return true\n              }\n            }\n            return false\n          },\n          {\n            test(result) {\n              return result === true\n            },\n          }\n        )\n      })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should prefetch pages correctly in viewport with <Link>","suites":["basePath"],"updatePoint":{"line":238,"column":65},"line":238,"code":"      it('should prefetch pages correctly in viewport with <Link>', async () => {\n        const browser = await webdriver(next.url, `${basePath}/hello`)\n        await browser.eval('window.next.router.prefetch(\"/gssp\")')\n\n        await check(async () => {\n          const hrefs = await browser.eval(\n            `Object.keys(window.next.router.sdc)`\n          )\n          hrefs.sort()\n\n          assert.deepEqual(\n            hrefs.map((href) =>\n              new URL(href).pathname.replace(/\\/_next\\/data\\/[^/]+/, '')\n            ),\n            [\n              `${basePath}/gsp.json`,\n              `${basePath}/index.json`,\n              // `${basePath}/index/index.json`,\n            ]\n          )\n\n          const prefetches = await browser.eval(\n            `[].slice.call(document.querySelectorAll(\"link[rel=prefetch]\")).map((e) => new URL(e.href).pathname)`\n          )\n          expect(prefetches).toContainEqual(\n            expect.stringMatching(/\\/gsp-[^./]+\\.js/)\n          )\n          expect(prefetches).toContainEqual(\n            expect.stringMatching(/\\/gssp-[^./]+\\.js/)\n          )\n          expect(prefetches).toContainEqual(\n            expect.stringMatching(/\\/other-page-[^./]+\\.js/)\n          )\n          return 'yes'\n        }, 'yes')\n      })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should 404 for public file without basePath","suites":["basePath"],"updatePoint":{"line":276,"column":51},"line":276,"code":"    it('should 404 for public file without basePath', async () => {\n      const res = await fetchViaHTTP(next.url, '/data.txt')\n      expect(res.status).toBe(404)\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should serve public file with basePath correctly","suites":["basePath"],"updatePoint":{"line":281,"column":56},"line":281,"code":"    it('should serve public file with basePath correctly', async () => {\n      const res = await fetchViaHTTP(next.url, `${basePath}/data.txt`)\n      expect(res.status).toBe(200)\n      expect(await res.text()).toBe('hello world')\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should rewrite with basePath by default","suites":["basePath"],"updatePoint":{"line":287,"column":47},"line":287,"code":"    it('should rewrite with basePath by default', async () => {\n      const html = await renderViaHTTP(next.url, `${basePath}/rewrite-1`)\n      expect(html).toContain('getServerSideProps')\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should not rewrite without basePath without disabling","suites":["basePath"],"updatePoint":{"line":292,"column":61},"line":292,"code":"    it('should not rewrite without basePath without disabling', async () => {\n      const res = await fetchViaHTTP(next.url, '/rewrite-1')\n      expect(res.status).toBe(404)\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should not rewrite with basePath when set to false","suites":["basePath"],"updatePoint":{"line":297,"column":58},"line":297,"code":"    it('should not rewrite with basePath when set to false', async () => {\n      // won't 404 as it matches the dynamic [slug] route\n      const html = await renderViaHTTP(\n        next.url,\n        `${basePath}/rewrite-no-basePath`\n      )\n      expect(html).toContain('slug')\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should rewrite without basePath when set to false","suites":["basePath"],"updatePoint":{"line":306,"column":57},"line":306,"code":"    it('should rewrite without basePath when set to false', async () => {\n      const html = await renderViaHTTP(next.url, '/rewrite-no-basePath')\n      expect(html).toContain('Example Domain')\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should redirect with basePath by default","suites":["basePath"],"updatePoint":{"line":311,"column":48},"line":311,"code":"    it('should redirect with basePath by default', async () => {\n      const res = await fetchViaHTTP(\n        next.url,\n        `${basePath}/redirect-1`,\n        undefined,\n        {\n          redirect: 'manual',\n        }\n      )\n      const { pathname } = url.parse(res.headers.get('location') || '')\n      expect(pathname).toBe(`${basePath}/somewhere-else`)\n      expect(res.status).toBe(307)\n      const text = await res.text()\n      expect(text).toContain(`${basePath}/somewhere-else`)\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should not redirect without basePath without disabling","suites":["basePath"],"updatePoint":{"line":327,"column":62},"line":327,"code":"    it('should not redirect without basePath without disabling', async () => {\n      const res = await fetchViaHTTP(next.url, '/redirect-1', undefined, {\n        redirect: 'manual',\n      })\n      expect(res.status).toBe(404)\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should not redirect with basePath when set to false","suites":["basePath"],"updatePoint":{"line":334,"column":59},"line":334,"code":"    it('should not redirect with basePath when set to false', async () => {\n      // won't 404 as it matches the dynamic [slug] route\n      const html = await renderViaHTTP(\n        next.url,\n        `${basePath}/rewrite-no-basePath`\n      )\n      expect(html).toContain('slug')\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should redirect without basePath when set to false","suites":["basePath"],"updatePoint":{"line":343,"column":58},"line":343,"code":"    it('should redirect without basePath when set to false', async () => {\n      const res = await fetchViaHTTP(\n        next.url,\n        '/redirect-no-basepath',\n        undefined,\n        {\n          redirect: 'manual',\n        }\n      )\n      const { pathname } = url.parse(res.headers.get('location') || '')\n      expect(pathname).toBe('/another-destination')\n      expect(res.status).toBe(307)\n      const text = await res.text()\n      expect(text).toContain('/another-destination')\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should add header with basePath by default","suites":["basePath"],"updatePoint":{"line":360,"column":50},"line":360,"code":"    it('should add header with basePath by default', async () => {\n      const res = await fetchViaHTTP(next.url, `${basePath}/add-header`)\n      expect(res.headers.get('x-hello')).toBe('world')\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should not add header without basePath without disabling","suites":["basePath"],"updatePoint":{"line":365,"column":64},"line":365,"code":"    it('should not add header without basePath without disabling', async () => {\n      const res = await fetchViaHTTP(next.url, '/add-header')\n      expect(res.headers.get('x-hello')).toBe(null)\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should not add header with basePath when set to false","suites":["basePath"],"updatePoint":{"line":370,"column":61},"line":370,"code":"    it('should not add header with basePath when set to false', async () => {\n      const res = await fetchViaHTTP(\n        next.url,\n        `${basePath}/add-header-no-basepath`\n      )\n      expect(res.headers.get('x-hello')).toBe(null)\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should add header without basePath when set to false","suites":["basePath"],"updatePoint":{"line":378,"column":60},"line":378,"code":"    it('should add header without basePath when set to false', async () => {\n      const res = await fetchViaHTTP(next.url, '/add-header-no-basepath')\n      expect(res.headers.get('x-hello')).toBe('world')\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should not update URL for a 404","suites":["basePath"],"updatePoint":{"line":383,"column":39},"line":383,"code":"    it('should not update URL for a 404', async () => {\n      const browser = await webdriver(next.url, '/missing')\n\n      if (isDeploy) {\n        // the custom 404 only shows inside of the basePath so this\n        // will be the Vercel default 404 page\n        expect(\n          await browser.eval('document.documentElement.innerHTML')\n        ).toContain('NOT_FOUND')\n      } else {\n        const pathname = await browser.eval(() => window.location.pathname)\n        expect(\n          await browser.eval(() => (window as any).next.router.asPath)\n        ).toBe('/missing')\n        expect(pathname).toBe('/missing')\n      }\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should handle 404 urls that start with basePath","suites":["basePath"],"updatePoint":{"line":401,"column":55},"line":401,"code":"    it('should handle 404 urls that start with basePath', async () => {\n      const browser = await webdriver(next.url, `${basePath}hello`)\n\n      if (isDeploy) {\n        // the custom 404 only shows inside of the basePath so this\n        // will be the Vercel default 404 page\n        expect(\n          await browser.eval('document.documentElement.innerHTML')\n        ).toContain('NOT_FOUND')\n      } else {\n        expect(\n          await browser.eval(() => (window as any).next.router.asPath)\n        ).toBe(`${basePath}hello`)\n        expect(await browser.eval(() => window.location.pathname)).toBe(\n          `${basePath}hello`\n        )\n      }\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should navigate back to a non-basepath 404 that starts with basepath","suites":["basePath"],"line":423,"code":"    it.skip('should navigate back to a non-basepath 404 that starts with basepath', async () => {","file":"e2e/basepath.test.ts","skipped":true,"dir":"test"},{"name":"should update dynamic params after mount correctly","suites":["basePath"],"updatePoint":{"line":441,"column":58},"line":441,"code":"    it('should update dynamic params after mount correctly', async () => {\n      const browser = await webdriver(next.url, `${basePath}/hello-dynamic`)\n      await check(\n        () => browser.elementByCss('#slug').text(),\n        /slug: hello-dynamic/\n      )\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should navigate to index page with getStaticProps","suites":["basePath"],"updatePoint":{"line":449,"column":57},"line":449,"code":"    it('should navigate to index page with getStaticProps', async () => {\n      const browser = await webdriver(next.url, `${basePath}/hello`)\n      await browser.eval('window.beforeNavigate = \"hi\"')\n\n      await browser.elementByCss('#index-gsp').click()\n      await browser.waitForElementByCss('#prop')\n\n      expect(await browser.eval('window.beforeNavigate')).toBe('hi')\n      expect(await browser.elementByCss('#prop').text()).toBe('hello world')\n      expect(await browser.elementByCss('#nested').text()).toBe('no')\n      expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual(\n        {}\n      )\n      expect(await browser.elementByCss('#pathname').text()).toBe('/')\n\n      if (!isDev) {\n        const hrefs = await browser.eval(`Object.keys(window.next.router.sdc)`)\n        hrefs.sort()\n\n        expect(\n          hrefs.map((href) =>\n            new URL(href).pathname.replace(/\\/_next\\/data\\/[^/]+/, '')\n          )\n        ).toEqual([\n          `${basePath}/gsp.json`,\n          `${basePath}/index.json`,\n          // `${basePath}/index/index.json`,\n        ])\n      }\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should navigate to nested index page with getStaticProps","suites":["basePath"],"line":482,"code":"    it.skip('should navigate to nested index page with getStaticProps', async () => {","file":"e2e/basepath.test.ts","skipped":true,"dir":"test"},{"name":"should work with nested folder with same name as basePath","suites":["basePath"],"updatePoint":{"line":513,"column":65},"line":513,"code":"    it('should work with nested folder with same name as basePath', async () => {\n      const html = await renderViaHTTP(next.url, `${basePath}/docs/another`)\n      expect(html).toContain('hello from another')\n\n      const browser = await webdriver(next.url, `${basePath}/hello`)\n      await browser.eval('window.next.router.push(\"/docs/another\")')\n\n      await check(() => browser.elementByCss('p').text(), /hello from another/)\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should work with normal dynamic page","suites":["basePath"],"updatePoint":{"line":523,"column":44},"line":523,"code":"    it('should work with normal dynamic page', async () => {\n      const browser = await webdriver(next.url, `${basePath}/hello`)\n      await browser.elementByCss('#dynamic-link').click()\n      await check(\n        () => browser.eval(() => document.documentElement.innerHTML),\n        /slug: first/\n      )\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should work with hash links","suites":["basePath"],"updatePoint":{"line":532,"column":35},"line":532,"code":"    it('should work with hash links', async () => {\n      const browser = await webdriver(next.url, `${basePath}/hello`)\n      await browser.elementByCss('#hashlink').click()\n      const url = new URL(await browser.eval(() => window.location.href))\n      expect(url.pathname).toBe(`${basePath}/hello`)\n      expect(url.hash).toBe('#hashlink')\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should work with catch-all page","suites":["basePath"],"updatePoint":{"line":540,"column":39},"line":540,"code":"    it('should work with catch-all page', async () => {\n      const browser = await webdriver(next.url, `${basePath}/hello`)\n      await browser.elementByCss('#catchall-link').click()\n      await check(\n        () => browser.eval(() => document.documentElement.innerHTML),\n        /parts: hello\\/world/\n      )\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should redirect trailing slash correctly","suites":["basePath"],"updatePoint":{"line":549,"column":48},"line":549,"code":"    it('should redirect trailing slash correctly', async () => {\n      const res = await fetchViaHTTP(\n        next.url,\n        `${basePath}/hello/`,\n        {},\n        { redirect: 'manual' }\n      )\n      expect(res.status).toBe(308)\n      const { pathname } = new URL(res.headers.get('location'))\n      expect(pathname).toBe(`${basePath}/hello`)\n      const text = await res.text()\n      expect(text).toContain(`${basePath}/hello`)\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should redirect trailing slash on root correctly","suites":["basePath"],"updatePoint":{"line":563,"column":56},"line":563,"code":"    it('should redirect trailing slash on root correctly', async () => {\n      const res = await fetchViaHTTP(\n        next.url,\n        `${basePath}/`,\n        {},\n        { redirect: 'manual' }\n      )\n      expect(res.status).toBe(308)\n      const { pathname } = new URL(res.headers.get('location'))\n      expect(pathname).toBe(`${basePath}`)\n      const text = await res.text()\n      expect(text).toContain(`${basePath}`)\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should navigate an absolute url","suites":["basePath"],"updatePoint":{"line":577,"column":39},"line":577,"code":"    it('should navigate an absolute url', async () => {\n      const browser = await webdriver(next.url, `${basePath}/absolute-url`)\n      await browser.waitForElementByCss('#absolute-link').click()\n      await check(\n        () => browser.eval(() => window.location.origin),\n        'https://vercel.com'\n      )\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should navigate an absolute local url with basePath","suites":["basePath"],"updatePoint":{"line":587,"column":61},"line":587,"code":"      it('should navigate an absolute local url with basePath', async () => {\n        const browser = await webdriver(\n          next.url,\n          `${basePath}/absolute-url-basepath?port=${next.appPort}`\n        )\n        await browser.eval('window._didNotNavigate = true')\n        await browser.waitForElementByCss('#absolute-link').click()\n        const text = await browser\n          .waitForElementByCss('#something-else-page')\n          .text()\n\n        expect(text).toBe('something else')\n        expect(await browser.eval('window._didNotNavigate')).toBe(true)\n      })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should navigate an absolute local url without basePath","suites":["basePath"],"updatePoint":{"line":602,"column":64},"line":602,"code":"      it('should navigate an absolute local url without basePath', async () => {\n        const browser = await webdriver(\n          next.url,\n          `${basePath}/absolute-url-no-basepath?port=${next.appPort}`\n        )\n        await browser.waitForElementByCss('#absolute-link').click()\n        await check(\n          () => browser.eval(() => location.pathname),\n          '/rewrite-no-basepath'\n        )\n        const text = await browser.elementByCss('body').text()\n\n        expect(text).toContain('Example Domain')\n      })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should 404 when manually adding basePath with <Link>","suites":["basePath"],"updatePoint":{"line":618,"column":60},"line":618,"code":"    it('should 404 when manually adding basePath with <Link>', async () => {\n      const browser = await webdriver(\n        next.url,\n        `${basePath}/invalid-manual-basepath`\n      )\n      await browser.eval('window.beforeNav = \"hi\"')\n      await browser.elementByCss('#other-page-link').click()\n\n      await check(() => browser.eval('window.beforeNav'), {\n        test(content) {\n          return content !== 'hi'\n        },\n      })\n\n      const html = await browser.eval('document.documentElement.innerHTML')\n      expect(html).toContain('This page could not be found')\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should 404 when manually adding basePath with router.push","suites":["basePath"],"updatePoint":{"line":636,"column":65},"line":636,"code":"    it('should 404 when manually adding basePath with router.push', async () => {\n      const browser = await webdriver(next.url, `${basePath}/hello`)\n      await browser.eval('window.beforeNav = \"hi\"')\n      await browser.eval(`window.next.router.push(\"${basePath}/other-page\")`)\n\n      await check(() => browser.eval('window.beforeNav'), {\n        test(content) {\n          return content !== 'hi'\n        },\n      })\n\n      const html = await browser.eval('document.documentElement.innerHTML')\n      expect(html).toContain('This page could not be found')\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should 404 when manually adding basePath with router.replace","suites":["basePath"],"updatePoint":{"line":651,"column":68},"line":651,"code":"    it('should 404 when manually adding basePath with router.replace', async () => {\n      const browser = await webdriver(next.url, `${basePath}/hello`)\n      await browser.eval('window.beforeNav = \"hi\"')\n      await browser.eval(`window.next.router.replace(\"${basePath}/other-page\")`)\n\n      await check(() => browser.eval('window.beforeNav'), {\n        test(content) {\n          return content !== 'hi'\n        },\n      })\n\n      const html = await browser.eval('document.documentElement.innerHTML')\n      expect(html).toContain('This page could not be found')\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should show the hello page under the /docs prefix","suites":["basePath"],"updatePoint":{"line":666,"column":57},"line":666,"code":"    it('should show the hello page under the /docs prefix', async () => {\n      const browser = await webdriver(next.url, `${basePath}/hello`)\n      try {\n        const text = await browser.elementByCss('h1').text()\n        expect(text).toBe('Hello World')\n      } finally {\n        await browser.close()\n      }\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should have correct router paths on first load of /","suites":["basePath"],"updatePoint":{"line":676,"column":59},"line":676,"code":"    it('should have correct router paths on first load of /', async () => {\n      const browser = await webdriver(next.url, `${basePath}`)\n      await browser.waitForElementByCss('#pathname')\n      const pathname = await browser.elementByCss('#pathname').text()\n      expect(pathname).toBe('/')\n      const asPath = await browser.elementByCss('#as-path').text()\n      expect(asPath).toBe('/')\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should have correct router paths on first load of /hello","suites":["basePath"],"updatePoint":{"line":685,"column":64},"line":685,"code":"    it('should have correct router paths on first load of /hello', async () => {\n      const browser = await webdriver(next.url, `${basePath}/hello`)\n      await browser.waitForElementByCss('#pathname')\n      const pathname = await browser.elementByCss('#pathname').text()\n      expect(pathname).toBe('/hello')\n      const asPath = await browser.elementByCss('#as-path').text()\n      expect(asPath).toBe('/hello')\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should fetch data for getStaticProps without reloading","suites":["basePath"],"updatePoint":{"line":694,"column":62},"line":694,"code":"    it('should fetch data for getStaticProps without reloading', async () => {\n      const browser = await webdriver(next.url, `${basePath}/hello`)\n      await browser.eval('window.beforeNavigate = true')\n      await browser.elementByCss('#gsp-link').click()\n      await browser.waitForElementByCss('#gsp')\n      expect(await browser.eval('window.beforeNavigate')).toBe(true)\n\n      const props = JSON.parse(await browser.elementByCss('#props').text())\n      expect(props.hello).toBe('world')\n\n      const pathname = await browser.elementByCss('#pathname').text()\n      expect(pathname).toBe('/gsp')\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should fetch data for getServerSideProps without reloading","suites":["basePath"],"updatePoint":{"line":708,"column":66},"line":708,"code":"    it('should fetch data for getServerSideProps without reloading', async () => {\n      const browser = await webdriver(next.url, `${basePath}/hello`)\n      await browser.eval('window.beforeNavigate = true')\n      await browser.elementByCss('#gssp-link').click()\n      await browser.waitForElementByCss('#gssp')\n      expect(await browser.eval('window.beforeNavigate')).toBe(true)\n\n      const props = JSON.parse(await browser.elementByCss('#props').text())\n      expect(props.hello).toBe('world')\n\n      const pathname = await browser.elementByCss('#pathname').text()\n      const asPath = await browser.elementByCss('#asPath').text()\n      expect(pathname).toBe('/gssp')\n      expect(asPath).toBe('/gssp')\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should have correct href for a link","suites":["basePath"],"updatePoint":{"line":724,"column":43},"line":724,"code":"    it('should have correct href for a link', async () => {\n      const browser = await webdriver(next.url, `${basePath}/hello`)\n      const href = await browser.elementByCss('a').getAttribute('href')\n      const { pathname } = url.parse(href)\n      expect(pathname).toBe(`${basePath}/other-page`)\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should have correct href for a link to /","suites":["basePath"],"updatePoint":{"line":731,"column":48},"line":731,"code":"    it('should have correct href for a link to /', async () => {\n      const browser = await webdriver(next.url, `${basePath}/link-to-root`)\n      const href = await browser.elementByCss('#link-back').getAttribute('href')\n      const { pathname } = url.parse(href)\n      expect(pathname).toBe(`${basePath}`)\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should show 404 for page not under the /docs prefix","suites":["basePath"],"updatePoint":{"line":738,"column":59},"line":738,"code":"    it('should show 404 for page not under the /docs prefix', async () => {\n      const text = await renderViaHTTP(next.url, '/hello')\n      expect(text).not.toContain('Hello World')\n      expect(text).toContain(\n        isDeploy ? 'NOT_FOUND' : 'This page could not be found'\n      )\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should show the other-page page under the /docs prefix","suites":["basePath"],"updatePoint":{"line":746,"column":62},"line":746,"code":"    it('should show the other-page page under the /docs prefix', async () => {\n      const browser = await webdriver(next.url, `${basePath}/other-page`)\n      try {\n        const text = await browser.elementByCss('h1').text()\n        expect(text).toBe('Hello Other')\n      } finally {\n        await browser.close()\n      }\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should have basePath field on Router","suites":["basePath"],"updatePoint":{"line":756,"column":44},"line":756,"code":"    it('should have basePath field on Router', async () => {\n      const html = await renderViaHTTP(next.url, `${basePath}/hello`)\n      const $ = cheerio.load(html)\n      expect($('#base-path').text()).toBe(`${basePath}`)\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should navigate to the page without refresh","suites":["basePath"],"updatePoint":{"line":762,"column":51},"line":762,"code":"    it('should navigate to the page without refresh', async () => {\n      const browser = await webdriver(next.url, `${basePath}/hello`)\n      try {\n        await browser.eval('window.itdidnotrefresh = \"hello\"')\n        const text = await browser\n          .elementByCss('#other-page-link')\n          .click()\n          .waitForElementByCss('#other-page-title')\n          .elementByCss('h1')\n          .text()\n\n        expect(text).toBe('Hello Other')\n        expect(await browser.eval('window.itdidnotrefresh')).toBe('hello')\n      } finally {\n        await browser.close()\n      }\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should use urls with basepath in router events","suites":["basePath"],"updatePoint":{"line":780,"column":54},"line":780,"code":"    it('should use urls with basepath in router events', async () => {\n      const browser = await webdriver(next.url, `${basePath}/hello`)\n      try {\n        await check(\n          () => browser.eval('window.next.router.isReady ? \"ready\" : \"no\"'),\n          'ready'\n        )\n        await browser.eval('window._clearEventLog()')\n        await browser\n          .elementByCss('#other-page-link')\n          .click()\n          .waitForElementByCss('#other-page-title')\n\n        const eventLog = await browser.eval('window._getEventLog()')\n        expect(\n          eventLog.filter((item) => item[1]?.endsWith('/other-page'))\n        ).toEqual([\n          ['routeChangeStart', `${basePath}/other-page`, { shallow: false }],\n          ['beforeHistoryChange', `${basePath}/other-page`, { shallow: false }],\n          ['routeChangeComplete', `${basePath}/other-page`, { shallow: false }],\n        ])\n      } finally {\n        await browser.close()\n      }\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should use urls with basepath in router events for hash changes","suites":["basePath"],"updatePoint":{"line":806,"column":71},"line":806,"code":"    it('should use urls with basepath in router events for hash changes', async () => {\n      const browser = await webdriver(next.url, `${basePath}/hello`)\n      try {\n        await check(\n          () => browser.eval('window.next.router.isReady ? \"ready\" : \"no\"'),\n          'ready'\n        )\n        await browser.eval('window._clearEventLog()')\n        await browser.elementByCss('#hash-change').click()\n\n        const eventLog = await browser.eval('window._getEventLog()')\n        expect(eventLog).toEqual([\n          [\n            'hashChangeStart',\n            `${basePath}/hello#some-hash`,\n            { shallow: false },\n          ],\n          [\n            'hashChangeComplete',\n            `${basePath}/hello#some-hash`,\n            { shallow: false },\n          ],\n        ])\n      } finally {\n        await browser.close()\n      }\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should use urls with basepath in router events for cancelled routes","suites":["basePath"],"updatePoint":{"line":834,"column":75},"line":834,"code":"    it('should use urls with basepath in router events for cancelled routes', async () => {\n      const browser = await webdriver(next.url, `${basePath}/hello`)\n      try {\n        await check(\n          () => browser.eval('window.next.router.isReady ? \"ready\" : \"no\"'),\n          'ready'\n        )\n        await browser.eval('window._clearEventLog()')\n\n        await browser\n          .elementByCss('#slow-route')\n          .click()\n          .elementByCss('#other-page-link')\n          .click()\n          .waitForElementByCss('#other-page-title')\n\n        const eventLog = await browser.eval('window._getEventLog()')\n        expect(eventLog).toEqual([\n          ['routeChangeStart', `${basePath}/slow-route`, { shallow: false }],\n          [\n            'routeChangeError',\n            'Route Cancelled',\n            true,\n            `${basePath}/slow-route`,\n            { shallow: false },\n          ],\n          ['routeChangeStart', `${basePath}/other-page`, { shallow: false }],\n          ['beforeHistoryChange', `${basePath}/other-page`, { shallow: false }],\n          ['routeChangeComplete', `${basePath}/other-page`, { shallow: false }],\n        ])\n      } finally {\n        await browser.close()\n      }\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should use urls with basepath in router events for failed route change","suites":["basePath"],"updatePoint":{"line":869,"column":78},"line":869,"code":"    it('should use urls with basepath in router events for failed route change', async () => {\n      const browser = await webdriver(next.url, `${basePath}/hello`)\n      try {\n        await check(\n          () => browser.eval('window.next.router.isReady ? \"ready\" : \"no\"'),\n          'ready'\n        )\n        await browser.eval('window._clearEventLog()')\n        await browser.elementByCss('#error-route').click()\n\n        await check(async () => {\n          const eventLog = await browser.eval('window._getEventLog()')\n          assert.deepEqual(eventLog, [\n            ['routeChangeStart', `${basePath}/error-route`, { shallow: false }],\n            [\n              'routeChangeError',\n              'Failed to load static props',\n              null,\n              `${basePath}/error-route`,\n              { shallow: false },\n            ],\n          ])\n          return 'success'\n        }, 'success')\n      } finally {\n        await browser.close()\n      }\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should allow URL query strings without refresh","suites":["basePath"],"updatePoint":{"line":898,"column":54},"line":898,"code":"    it('should allow URL query strings without refresh', async () => {\n      const browser = await webdriver(next.url, `${basePath}/hello?query=true`)\n      try {\n        await browser.eval('window.itdidnotrefresh = \"hello\"')\n        await new Promise((resolve, reject) => {\n          // Timeout of EventSource created in setupPing()\n          // (on-demand-entries-utils.js) is 5000 ms (see #13132, #13560)\n          setTimeout(resolve, isDev ? 10000 : 1000)\n        })\n        expect(await browser.eval('window.itdidnotrefresh')).toBe('hello')\n\n        const pathname = await browser.elementByCss('#pathname').text()\n        expect(pathname).toBe('/hello')\n        expect(await browser.eval('window.location.pathname')).toBe(\n          `${basePath}/hello`\n        )\n        expect(await browser.eval('window.location.search')).toBe('?query=true')\n\n        if (isDev) {\n          expect(await hasRedbox(browser, false)).toBe(false)\n        }\n      } finally {\n        await browser.close()\n      }\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should allow URL query strings on index without refresh","suites":["basePath"],"updatePoint":{"line":924,"column":63},"line":924,"code":"    it('should allow URL query strings on index without refresh', async () => {\n      const browser = await webdriver(next.url, `${basePath}?query=true`)\n      try {\n        await browser.eval('window.itdidnotrefresh = \"hello\"')\n        await new Promise((resolve, reject) => {\n          // Timeout of EventSource created in setupPing()\n          // (on-demand-entries-utils.js) is 5000 ms (see #13132, #13560)\n          setTimeout(resolve, isDev ? 10000 : 1000)\n        })\n        expect(await browser.eval('window.itdidnotrefresh')).toBe('hello')\n\n        const pathname = await browser.elementByCss('#pathname').text()\n        expect(pathname).toBe('/')\n        expect(await browser.eval('window.location.pathname')).toBe(basePath)\n        expect(await browser.eval('window.location.search')).toBe('?query=true')\n\n        if (isDev) {\n          expect(await hasRedbox(browser, false)).toBe(false)\n        }\n      } finally {\n        await browser.close()\n      }\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should correctly replace state when same asPath but different url","suites":["basePath"],"updatePoint":{"line":948,"column":73},"line":948,"code":"    it('should correctly replace state when same asPath but different url', async () => {\n      const browser = await webdriver(next.url, `${basePath}`)\n      try {\n        await browser.elementByCss('#hello-link').click()\n        await browser.waitForElementByCss('#something-else-link')\n        await browser.elementByCss('#something-else-link').click()\n        await browser.waitForElementByCss('#something-else-page')\n        await browser.back()\n        await browser.waitForElementByCss('#index-page')\n        await browser.forward()\n        await browser.waitForElementByCss('#something-else-page')\n      } finally {\n        await browser.close()\n      }\n    })","file":"e2e/basepath.test.ts","skipped":false,"dir":"test"},{"name":"should work","suites":["browserslist-extends"],"updatePoint":{"line":34,"column":17},"line":34,"code":"  it('should work', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toContain('hello world')\n  })","file":"e2e/browserslist-extends/index.test.ts","skipped":false,"dir":"test"},{"name":"should apply browserslist target","suites":["Browserslist"],"updatePoint":{"line":27,"column":38},"line":27,"code":"  it('should apply browserslist target', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    const $ = cheerio.load(html)\n\n    let finished = false\n    await Promise.all(\n      $('script')\n        .toArray()\n        .map(async (el) => {\n          const src = $(el).attr('src')\n          if (!src) return\n          if (src.includes('/index')) {\n            const code = await fetchViaHTTP(next.url, src).then((res) =>\n              res.text()\n            )\n\n            const isDev = (global as any).isNextDev\n            expect(\n              code.includes(isDev ? 'async ()=>{' : 'async()=>{console.log(')\n            ).toBe(true)\n            finished = true\n          }\n        })\n    )\n    expect(finished).toBe(true)\n  })","file":"e2e/browserslist/browserslist.test.ts","skipped":false,"dir":"test"},{"name":"should apply with legacyBrowsers: false correctly","suites":["legacyBrowsers: false"],"updatePoint":{"line":27,"column":55},"line":27,"code":"  it('should apply with legacyBrowsers: false correctly', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    const $ = cheerio.load(html)\n\n    let finished = false\n    await Promise.all(\n      $('script')\n        .toArray()\n        .map(async (el) => {\n          const src = $(el).attr('src')\n          if (!src) return\n          if (src.includes('/index')) {\n            const code = await fetchViaHTTP(next.url, src).then((res) =>\n              res.text()\n            )\n\n            const isDev = (global as any).isNextDev\n            expect(\n              code.includes(isDev ? 'async ()=>{' : 'async()=>{console.log(')\n            ).toBe(true)\n            finished = true\n          }\n        })\n    )\n    expect(finished).toBe(true)\n  })","file":"e2e/browserslist/legacybrowsers-false.test.ts","skipped":false,"dir":"test"},{"name":"should apply legacyBrowsers: true by default","suites":["legacyBrowsers: true"],"updatePoint":{"line":26,"column":50},"line":26,"code":"  it('should apply legacyBrowsers: true by default', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    const $ = cheerio.load(html)\n\n    let finished = false\n    await Promise.all(\n      $('script')\n        .toArray()\n        .map(async (el) => {\n          const src = $(el).attr('src')\n          if (!src) return\n          if (src.includes('/index')) {\n            const code = await fetchViaHTTP(next.url, src).then((res) =>\n              res.text()\n            )\n\n            const isDev = (global as any).isNextDev\n            expect(\n              code.includes(isDev ? 'async ()=>{' : 'async()=>{console.log(')\n            ).toBe(false)\n            finished = true\n          }\n        })\n    )\n    expect(finished).toBe(true)\n  })","file":"e2e/browserslist/legacybrowsers-true.test.ts","skipped":false,"dir":"test"},{"name":"should work","suites":["async export"],"updatePoint":{"line":29,"column":17},"line":29,"code":"  it('should work', async () => {\n    const html = await renderViaHTTP(next.url, '/docs')\n    expect(html).toContain('hello world')\n  })","file":"e2e/config-promise-export/async-function.test.ts","skipped":false,"dir":"test"},{"name":"should work","suites":["promise export"],"updatePoint":{"line":29,"column":17},"line":29,"code":"  it('should work', async () => {\n    const html = await renderViaHTTP(next.url, '/docs')\n    expect(html).toContain('hello world')\n  })","file":"e2e/config-promise-export/promise.test.ts","skipped":false,"dir":"test"},{"name":"should work","suites":["Dynamic Route Interpolation"],"updatePoint":{"line":46,"column":17},"line":46,"code":"  it('should work', async () => {\n    const html = await renderViaHTTP(next.url, '/blog/a')\n    const $ = cheerio.load(html)\n    expect($('#slug').text()).toBe('a')\n  })","file":"e2e/dynamic-route-interpolation/index.test.ts","skipped":false,"dir":"test"},{"name":"should work with parameter itself","suites":["Dynamic Route Interpolation"],"updatePoint":{"line":52,"column":39},"line":52,"code":"  it('should work with parameter itself', async () => {\n    const html = await renderViaHTTP(next.url, '/blog/[slug]')\n    const $ = cheerio.load(html)\n    expect($('#slug').text()).toBe('[slug]')\n  })","file":"e2e/dynamic-route-interpolation/index.test.ts","skipped":false,"dir":"test"},{"name":"should work with brackets","suites":["Dynamic Route Interpolation"],"updatePoint":{"line":58,"column":31},"line":58,"code":"  it('should work with brackets', async () => {\n    const html = await renderViaHTTP(next.url, '/blog/[abc]')\n    const $ = cheerio.load(html)\n    expect($('#slug').text()).toBe('[abc]')\n  })","file":"e2e/dynamic-route-interpolation/index.test.ts","skipped":false,"dir":"test"},{"name":"should work with parameter itself in API routes","suites":["Dynamic Route Interpolation"],"updatePoint":{"line":64,"column":53},"line":64,"code":"  it('should work with parameter itself in API routes', async () => {\n    const text = await renderViaHTTP(next.url, '/api/dynamic/[slug]')\n    expect(text).toBe('slug: [slug]')\n  })","file":"e2e/dynamic-route-interpolation/index.test.ts","skipped":false,"dir":"test"},{"name":"should work with brackets in API routes","suites":["Dynamic Route Interpolation"],"updatePoint":{"line":69,"column":45},"line":69,"code":"  it('should work with brackets in API routes', async () => {\n    const text = await renderViaHTTP(next.url, '/api/dynamic/[abc]')\n    expect(text).toBe('slug: [abc]')\n  })","file":"e2e/dynamic-route-interpolation/index.test.ts","skipped":false,"dir":"test"},{"name":"should bust data cache","suites":["Dynamic Route Interpolation"],"updatePoint":{"line":74,"column":28},"line":74,"code":"  it('should bust data cache', async () => {\n    const browser = await webdriver(next.url, '/blog/login')\n    await browser.elementById('now').click() // fetch data once\n    const text = await browser.elementById('now').text()\n    await browser.elementById('now').click() // fetch data again\n    await browser.waitForElementByCss(`#now:not(:text(\"${text}\"))`)\n    await browser.close()\n  })","file":"e2e/dynamic-route-interpolation/index.test.ts","skipped":false,"dir":"test"},{"name":"should bust data cache with symbol","suites":["Dynamic Route Interpolation"],"updatePoint":{"line":83,"column":40},"line":83,"code":"  it('should bust data cache with symbol', async () => {\n    const browser = await webdriver(next.url, '/blog/@login')\n    await browser.elementById('now').click() // fetch data once\n    const text = await browser.elementById('now').text()\n    await browser.elementById('now').click() // fetch data again\n    await browser.waitForElementByCss(`#now:not(:text(\"${text}\"))`)\n    await browser.close()\n  })","file":"e2e/dynamic-route-interpolation/index.test.ts","skipped":false,"dir":"test"},{"name":"reads the body as text","suites":["Edge API endpoints can receive body"],"updatePoint":{"line":24,"column":28},"line":24,"code":"  it('reads the body as text', async () => {\n    const res = await fetchViaHTTP(\n      next.url,\n      '/api/edge',\n      {},\n      {\n        body: 'hello, world.',\n        method: 'POST',\n      }\n    )\n\n    expect(res.status).toBe(200)\n    expect(await res.text()).toBe('got: hello, world.')\n  })","file":"e2e/edge-api-endpoints-can-receive-body/index.test.ts","skipped":false,"dir":"test"},{"name":"reads the body from index","suites":["Edge API endpoints can receive body"],"updatePoint":{"line":39,"column":31},"line":39,"code":"  it('reads the body from index', async () => {\n    const res = await fetchViaHTTP(\n      next.url,\n      '/api',\n      {},\n      {\n        body: 'hello, world.',\n        method: 'POST',\n      }\n    )\n\n    expect(res.status).toBe(200)\n    expect(await res.text()).toBe('got: hello, world.')\n  })","file":"e2e/edge-api-endpoints-can-receive-body/index.test.ts","skipped":false,"dir":"test"},{"name":"uses the wasm file","suites":["edge api endpoints can use wasm files"],"updatePoint":{"line":68,"column":24},"line":68,"code":"  it('uses the wasm file', async () => {\n    const response = await fetchViaHTTP(next.url, '/api/add', { input: 10 })\n    expect(extractJSON(response)).toEqual({\n      input: 10,\n      value: 11,\n    })\n  })","file":"e2e/edge-can-use-wasm-files/index.test.ts","skipped":false,"dir":"test"},{"name":"uses the wasm file","suites":["middleware can use wasm files"],"updatePoint":{"line":86,"column":24},"line":86,"code":"  it('uses the wasm file', async () => {\n    const response = await fetchViaHTTP(next.url, '/')\n    expect(extractJSON(response)).toEqual({\n      input: 1,\n      value: 2,\n    })\n  })","file":"e2e/edge-can-use-wasm-files/index.test.ts","skipped":false,"dir":"test"},{"name":"can be called twice","suites":["middleware can use wasm files"],"updatePoint":{"line":94,"column":25},"line":94,"code":"  it('can be called twice', async () => {\n    const response = await fetchViaHTTP(next.url, '/', { input: 2 })\n    expect(extractJSON(response)).toEqual({\n      input: 2,\n      value: 3,\n    })\n  })","file":"e2e/edge-can-use-wasm-files/index.test.ts","skipped":false,"dir":"test"},{"name":"lists the necessary wasm bindings in the manifest","suites":["middleware can use wasm files"],"updatePoint":{"line":103,"column":57},"line":103,"code":"    it('lists the necessary wasm bindings in the manifest', async () => {\n      const manifestPath = path.join(\n        next.testDir,\n        '.next/server/middleware-manifest.json'\n      )\n      const manifest = await fs.readJSON(manifestPath)\n      expect(manifest.middleware['/']).toMatchObject({\n        wasm: [\n          {\n            filePath:\n              'server/edge-chunks/wasm_58ccff8b2b94b5dac6ef8957082ecd8f6d34186d.wasm',\n            name: 'wasm_58ccff8b2b94b5dac6ef8957082ecd8f6d34186d',\n          },\n        ],\n      })\n    })","file":"e2e/edge-can-use-wasm-files/index.test.ts","skipped":false,"dir":"test"},{"name":"uses the wasm file","suites":["middleware can use wasm files with the experimental modes on"],"updatePoint":{"line":143,"column":24},"line":143,"code":"  it('uses the wasm file', async () => {\n    const response = await fetchViaHTTP(next.url, '/')\n    expect(extractJSON(response)).toEqual({\n      input: 1,\n      value: 2,\n    })\n  })","file":"e2e/edge-can-use-wasm-files/index.test.ts","skipped":false,"dir":"test"},{"name":"should skip for deploy for now","suites":["Edge Compiler can import asset assets"],"updatePoint":{"line":14,"column":38},"line":14,"code":"    it('should skip for deploy for now', () => {})","file":"e2e/edge-compiler-can-import-blob-assets/index.test.ts","skipped":false,"dir":"test"},{"name":"allows to fetch a remote URL","suites":["Edge Compiler can import asset assets"],"updatePoint":{"line":25,"column":34},"line":25,"code":"  it('allows to fetch a remote URL', async () => {\n    const response = await fetchViaHTTP(next.url, '/api/edge', {\n      handler: 'remote-full',\n    })\n    expect(await response.text()).toContain('Example Domain')\n  })","file":"e2e/edge-compiler-can-import-blob-assets/index.test.ts","skipped":false,"dir":"test"},{"name":"allows to fetch a remote URL with a path and basename","suites":["Edge Compiler can import asset assets"],"updatePoint":{"line":32,"column":59},"line":32,"code":"  it('allows to fetch a remote URL with a path and basename', async () => {\n    const response = await fetchViaHTTP(\n      next.url,\n      '/api/edge',\n      {\n        handler: 'remote-with-base',\n      },\n      {\n        compress: true,\n      }\n    )\n    expect(await response.text()).toContain('Example Domain')\n  })","file":"e2e/edge-compiler-can-import-blob-assets/index.test.ts","skipped":false,"dir":"test"},{"name":"allows to fetch text assets","suites":["Edge Compiler can import asset assets"],"updatePoint":{"line":46,"column":33},"line":46,"code":"  it('allows to fetch text assets', async () => {\n    const html = await renderViaHTTP(next.url, '/api/edge', {\n      handler: 'text-file',\n    })\n    expect(html).toContain('Hello, from text-file.txt!')\n  })","file":"e2e/edge-compiler-can-import-blob-assets/index.test.ts","skipped":false,"dir":"test"},{"name":"allows to fetch image assets","suites":["Edge Compiler can import asset assets"],"updatePoint":{"line":53,"column":34},"line":53,"code":"  it('allows to fetch image assets', async () => {\n    const response = await fetchViaHTTP(next.url, '/api/edge', {\n      handler: 'image-file',\n    })\n    const buffer: Buffer = await response.buffer()\n    const image = await fs.readFile(\n      path.join(__dirname, './app/src/vercel.png')\n    )\n    expect(buffer.equals(image)).toBeTrue()\n  })","file":"e2e/edge-compiler-can-import-blob-assets/index.test.ts","skipped":false,"dir":"test"},{"name":"allows to assets from node_modules","suites":["Edge Compiler can import asset assets"],"updatePoint":{"line":64,"column":40},"line":64,"code":"  it('allows to assets from node_modules', async () => {\n    const response = await fetchViaHTTP(next.url, '/api/edge', {\n      handler: 'from-node-module',\n    })\n    const json = await response.json()\n    expect(json).toEqual({\n      'i am': 'a node dependency',\n    })\n  })","file":"e2e/edge-compiler-can-import-blob-assets/index.test.ts","skipped":false,"dir":"test"},{"name":"extracts all the assets from the bundle","suites":["Edge Compiler can import asset assets"],"updatePoint":{"line":74,"column":45},"line":74,"code":"  it('extracts all the assets from the bundle', async () => {\n    const manifestPath = path.join(\n      next.testDir,\n      '.next/server/middleware-manifest.json'\n    )\n    const manifest: MiddlewareManifest = await readJson(manifestPath)\n    const orderedAssets = manifest.functions['/api/edge'].assets.sort(\n      (a, z) => {\n        return String(a.name).localeCompare(z.name)\n      }\n    )\n\n    expect(orderedAssets).toMatchObject([\n      {\n        name: expect.stringMatching(/^text-file\\.[0-9a-f]{16}\\.txt$/),\n        filePath: expect.stringMatching(\n          /^server\\/edge-chunks\\/asset_text-file/\n        ),\n      },\n      {\n        name: expect.stringMatching(/^vercel\\.[0-9a-f]{16}\\.png$/),\n        filePath: expect.stringMatching(/^server\\/edge-chunks\\/asset_vercel/),\n      },\n      {\n        name: expect.stringMatching(/^world\\.[0-9a-f]{16}\\.json/),\n        filePath: expect.stringMatching(/^server\\/edge-chunks\\/asset_world/),\n      },\n    ])\n  })","file":"e2e/edge-compiler-can-import-blob-assets/index.test.ts","skipped":false,"dir":"test"},{"name":"favors the browser export","suites":["Edge compiler module exports preference"],"updatePoint":{"line":52,"column":31},"line":52,"code":"  it('favors the browser export', async () => {\n    const response = await fetchViaHTTP(next.url, '/')\n    expect(Object.fromEntries(response.headers)).toMatchObject({\n      'x-imported': 'Browser',\n    })\n  })","file":"e2e/edge-compiler-module-exports-preference/index.test.ts","skipped":false,"dir":"test"},{"name":"should skip for react v17","suites":["edge-render-getserversideprops"],"updatePoint":{"line":12,"column":33},"line":12,"code":"    it('should skip for react v17', () => {})","file":"e2e/edge-render-getserversideprops/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct query/params on index","suites":["edge-render-getserversideprops"],"updatePoint":{"line":24,"column":47},"line":24,"code":"  it('should have correct query/params on index', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    const $ = cheerio.load(html)\n    expect($('#page').text()).toBe('/index')\n    const props = JSON.parse($('#props').text())\n    expect(props.query).toEqual({})\n    expect(props.params).toBe(null)\n  })","file":"e2e/edge-render-getserversideprops/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct query/params on /[id]","suites":["edge-render-getserversideprops"],"updatePoint":{"line":33,"column":47},"line":33,"code":"  it('should have correct query/params on /[id]', async () => {\n    const html = await renderViaHTTP(next.url, '/123', { hello: 'world' })\n    const $ = cheerio.load(html)\n    expect($('#page').text()).toBe('/[id]')\n    const props = JSON.parse($('#props').text())\n    expect(props.query).toEqual({ id: '123', hello: 'world' })\n    expect(props.params).toEqual({ id: '123' })\n  })","file":"e2e/edge-render-getserversideprops/index.test.ts","skipped":false,"dir":"test"},{"name":"should respond to _next/data for index correctly","suites":["edge-render-getserversideprops"],"updatePoint":{"line":42,"column":54},"line":42,"code":"  it('should respond to _next/data for index correctly', async () => {\n    const res = await fetchViaHTTP(\n      next.url,\n      `/_next/data/${next.buildId}/index.json`,\n      undefined,\n      {\n        headers: {\n          'x-nextjs-data': '1',\n        },\n      }\n    )\n    expect(res.status).toBe(200)\n    const { pageProps: props } = await res.json()\n    expect(props.query).toEqual({})\n    expect(props.params).toBe(null)\n  })","file":"e2e/edge-render-getserversideprops/index.test.ts","skipped":false,"dir":"test"},{"name":"should respond to _next/data for [id] correctly","suites":["edge-render-getserversideprops"],"updatePoint":{"line":59,"column":53},"line":59,"code":"  it('should respond to _next/data for [id] correctly', async () => {\n    const res = await fetchViaHTTP(\n      next.url,\n      `/_next/data/${next.buildId}/321.json`,\n      { hello: 'world' },\n      {\n        headers: {\n          'x-nextjs-data': '1',\n        },\n      }\n    )\n    expect(res.status).toBe(200)\n    const { pageProps: props } = await res.json()\n    expect(props.query).toEqual({ id: '321', hello: 'world' })\n    expect(props.params).toEqual({ id: '321' })\n  })","file":"e2e/edge-render-getserversideprops/index.test.ts","skipped":false,"dir":"test"},{"name":"should have data routes in routes-manifest","suites":["edge-render-getserversideprops"],"updatePoint":{"line":77,"column":50},"line":77,"code":"    it('should have data routes in routes-manifest', async () => {\n      const manifest = JSON.parse(\n        await next.readFile('.next/routes-manifest.json')\n      )\n\n      for (const route of manifest.dataRoutes) {\n        route.dataRouteRegex = normalizeRegEx(route.dataRouteRegex)\n      }\n\n      expect(manifest.dataRoutes).toEqual([\n        {\n          dataRouteRegex: normalizeRegEx(\n            `^/_next/data/${escapeStringRegexp(next.buildId)}/index.json$`\n          ),\n          page: '/',\n        },\n        {\n          dataRouteRegex: normalizeRegEx(\n            `^/_next/data/${escapeStringRegexp(next.buildId)}/([^/]+?)\\\\.json$`\n          ),\n          namedDataRouteRegex: `^/_next/data/${escapeStringRegexp(\n            next.buildId\n          )}/(?<id>[^/]+?)\\\\.json$`,\n          page: '/[id]',\n          routeKeys: {\n            id: 'id',\n          },\n        },\n      ])\n    })","file":"e2e/edge-render-getserversideprops/index.test.ts","skipped":false,"dir":"test"},{"name":"should navigate between pages successfully","suites":[],"updatePoint":{"line":199,"column":48},"line":199,"code":"  it('should navigate between pages successfully', async () => {\n    const toBuild = [\n      '/',\n      '/another',\n      '/something',\n      '/normal',\n      '/blog/post-1',\n      '/blog/post-1/comment-1',\n    ]\n\n    await Promise.all(toBuild.map((pg) => renderViaHTTP(next.url, pg)))\n\n    const browser = await webdriver(next.url, '/')\n    let text = await browser.elementByCss('p').text()\n    expect(text).toMatch(/hello.*?world/)\n\n    // hydration\n    await waitFor(2500)\n\n    // go to /another\n    async function goFromHomeToAnother() {\n      await browser.elementByCss('#another').click()\n      await browser.waitForElementByCss('#home')\n      text = await browser.elementByCss('p').text()\n      expect(text).toMatch(/hello.*?world/)\n    }\n    await goFromHomeToAnother()\n\n    // go to /\n    async function goFromAnotherToHome() {\n      await browser.eval('window.didTransition = 1')\n      await browser.elementByCss('#home').click()\n      await browser.waitForElementByCss('#another')\n      text = await browser.elementByCss('p').text()\n      expect(text).toMatch(/hello.*?world/)\n      expect(await browser.eval('window.didTransition')).toBe(1)\n    }\n    await goFromAnotherToHome()\n\n    await goFromHomeToAnother()\n    const snapTime = await browser.elementByCss('#anotherTime').text()\n\n    // Re-visit page\n    await goFromAnotherToHome()\n    await goFromHomeToAnother()\n\n    const nextTime = await browser.elementByCss('#anotherTime').text()\n    expect(snapTime).not.toMatch(nextTime)\n\n    // Reset to Home for next test\n    await goFromAnotherToHome()\n\n    // go to /something\n    await browser.elementByCss('#something').click()\n    await browser.waitForElementByCss('#home')\n    text = await browser.elementByCss('p').text()\n    expect(text).toMatch(/hello.*?world/)\n    expect(await browser.eval('window.didTransition')).toBe(1)\n\n    // go to /\n    await browser.elementByCss('#home').click()\n    await browser.waitForElementByCss('#post-1')\n\n    // go to /blog/post-1\n    await browser.elementByCss('#post-1').click()\n    await browser.waitForElementByCss('#home')\n    text = await browser.elementByCss('p').text()\n    expect(text).toMatch(/Post:.*?post-1/)\n    expect(await browser.eval('window.didTransition')).toBe(1)\n\n    // go to /\n    await browser.elementByCss('#home').click()\n    await browser.waitForElementByCss('#comment-1')\n\n    // go to /blog/post-1/comment-1\n    await browser.elementByCss('#comment-1').click()\n    await browser.waitForElementByCss('#home')\n    text = await browser.elementByCss('p:nth-child(2)').text()\n    expect(text).toMatch(/Comment:.*?comment-1/)\n    expect(await browser.eval('window.didTransition')).toBe(1)\n\n    await browser.close()\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should work with early request ending","suites":[],"updatePoint":{"line":287,"column":43},"line":287,"code":"  it('should work with early request ending', async () => {\n    const res = await fetchViaHTTP(next.url, '/early-request-end')\n    expect(res.status).toBe(200)\n    expect(await res.text()).toBe('hello from gssp')\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should allow POST request for getServerSideProps page","suites":[],"updatePoint":{"line":293,"column":59},"line":293,"code":"  it('should allow POST request for getServerSideProps page', async () => {\n    const res = await fetchViaHTTP(next.url, '/', undefined, {\n      method: 'POST',\n    })\n    expect(res.status).toBe(200)\n    expect(await res.text()).toMatch(/hello.*?world/)\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should render correctly when notFound is false (non-dynamic)","suites":[],"updatePoint":{"line":301,"column":66},"line":301,"code":"  it('should render correctly when notFound is false (non-dynamic)', async () => {\n    const res = await fetchViaHTTP(next.url, '/not-found')\n\n    expect(res.status).toBe(200)\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should render 404 correctly when notFound is returned (non-dynamic)","suites":[],"updatePoint":{"line":307,"column":73},"line":307,"code":"  it('should render 404 correctly when notFound is returned (non-dynamic)', async () => {\n    const res = await fetchViaHTTP(next.url, '/not-found', { hiding: true })\n\n    expect(res.status).toBe(404)\n    expect(await res.text()).toContain('This page could not be found')\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should render 404 correctly when notFound is returned client-transition (non-dynamic)","suites":[],"updatePoint":{"line":314,"column":91},"line":314,"code":"  it('should render 404 correctly when notFound is returned client-transition (non-dynamic)', async () => {\n    const browser = await webdriver(next.url, '/')\n    await browser.eval(`(function() {\n      window.beforeNav = 1\n      window.next.router.push('/not-found?hiding=true')\n    })()`)\n\n    await browser.waitForElementByCss('h1')\n    expect(await browser.elementByCss('html').text()).toContain(\n      'This page could not be found'\n    )\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should render correctly when notFound is false (dynamic)","suites":[],"updatePoint":{"line":328,"column":62},"line":328,"code":"  it('should render correctly when notFound is false (dynamic)', async () => {\n    const res = await fetchViaHTTP(next.url, '/not-found/first')\n\n    expect(res.status).toBe(200)\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should render 404 correctly when notFound is returned (dynamic)","suites":[],"updatePoint":{"line":334,"column":69},"line":334,"code":"  it('should render 404 correctly when notFound is returned (dynamic)', async () => {\n    const res = await fetchViaHTTP(next.url, '/not-found/first', {\n      hiding: true,\n    })\n\n    expect(res.status).toBe(404)\n    expect(await res.text()).toContain('This page could not be found')\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should render 404 correctly when notFound is returned client-transition (dynamic)","suites":[],"updatePoint":{"line":343,"column":87},"line":343,"code":"  it('should render 404 correctly when notFound is returned client-transition (dynamic)', async () => {\n    const browser = await webdriver(next.url, '/')\n    await browser.eval(`(function() {\n      window.beforeNav = 1\n      window.next.router.push('/not-found/first?hiding=true')\n    })()`)\n\n    await browser.waitForElementByCss('h1')\n    expect(await browser.elementByCss('html').text()).toContain(\n      'This page could not be found'\n    )\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should SSR normal page correctly","suites":[],"updatePoint":{"line":357,"column":38},"line":357,"code":"  it('should SSR normal page correctly', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toMatch(/hello.*?world/)\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should SSR getServerSideProps page correctly","suites":[],"updatePoint":{"line":362,"column":50},"line":362,"code":"  it('should SSR getServerSideProps page correctly', async () => {\n    const html = await renderViaHTTP(next.url, '/blog/post-1')\n    expect(html).toMatch(/Post:.*?post-1/)\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should handle throw ENOENT correctly","suites":[],"updatePoint":{"line":367,"column":42},"line":367,"code":"  it('should handle throw ENOENT correctly', async () => {\n    const res = await fetchViaHTTP(next.url, '/enoent')\n    const html = await res.text()\n\n    if (isDev) {\n      expect(html).toContain('oof')\n    } else {\n      expect(res.status).toBe(500)\n      expect(html).toContain('custom pages/500')\n      expect(html).not.toContain('This page could not be found')\n    }\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have gssp in __NEXT_DATA__","suites":[],"updatePoint":{"line":380,"column":39},"line":380,"code":"  it('should have gssp in __NEXT_DATA__', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    const $ = cheerio.load(html)\n    expect(JSON.parse($('#__NEXT_DATA__').text()).gssp).toBe(true)\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not have gssp in __NEXT_DATA__ for non-GSSP page","suites":[],"updatePoint":{"line":386,"column":61},"line":386,"code":"  it('should not have gssp in __NEXT_DATA__ for non-GSSP page', async () => {\n    const html = await renderViaHTTP(next.url, '/normal')\n    const $ = cheerio.load(html)\n    expect('gssp' in JSON.parse($('#__NEXT_DATA__').text())).toBe(false)\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should supply query values SSR","suites":[],"updatePoint":{"line":392,"column":36},"line":392,"code":"  it('should supply query values SSR', async () => {\n    const html = await renderViaHTTP(next.url, '/blog/post-1?hello=world')\n    const $ = cheerio.load(html)\n    const params = $('#params').text()\n    expect(JSON.parse(params)).toEqual({ post: 'post-1' })\n    const query = $('#query').text()\n    expect(JSON.parse(query)).toEqual({ hello: 'world', post: 'post-1' })\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should supply params values for catchall correctly","suites":[],"updatePoint":{"line":401,"column":56},"line":401,"code":"  it('should supply params values for catchall correctly', async () => {\n    const html = await renderViaHTTP(next.url, '/catchall/first')\n    const $ = cheerio.load(html)\n    const params = $('#params').text()\n    expect(JSON.parse(params)).toEqual({ path: ['first'] })\n    const query = $('#query').text()\n    expect(JSON.parse(query)).toEqual({ path: ['first'] })\n\n    const data = JSON.parse(\n      await renderViaHTTP(\n        next.url,\n        `/_next/data/${buildId}/catchall/first.json`\n      )\n    )\n\n    expect(data.pageProps.params).toEqual({ path: ['first'] })\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have original req.url for /_next/data request dynamic page","suites":[],"updatePoint":{"line":419,"column":71},"line":419,"code":"  it('should have original req.url for /_next/data request dynamic page', async () => {\n    const curUrl = `/_next/data/${buildId}/blog/post-1.json`\n    const data = await renderViaHTTP(next.url, curUrl)\n    const { appProps, pageProps } = JSON.parse(data)\n\n    expect(pageProps.resolvedUrl).toEqual('/blog/post-1')\n\n    expect(appProps).toEqual({\n      url: curUrl,\n      query: { post: 'post-1' },\n      asPath: '/blog/post-1',\n      pathname: '/blog/[post]',\n    })\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have original req.url for /_next/data request dynamic page with query","suites":[],"updatePoint":{"line":434,"column":82},"line":434,"code":"  it('should have original req.url for /_next/data request dynamic page with query', async () => {\n    const curUrl = `/_next/data/${buildId}/blog/post-1.json`\n    const data = await renderViaHTTP(next.url, curUrl, { hello: 'world' })\n    const { appProps, pageProps } = JSON.parse(data)\n\n    expect(pageProps.resolvedUrl).toEqual('/blog/post-1?hello=world')\n\n    expect(appProps).toEqual({\n      url: curUrl + '?hello=world',\n      query: { post: 'post-1', hello: 'world' },\n      asPath: '/blog/post-1?hello=world',\n      pathname: '/blog/[post]',\n    })\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have original req.url for /_next/data request","suites":[],"updatePoint":{"line":449,"column":58},"line":449,"code":"  it('should have original req.url for /_next/data request', async () => {\n    const curUrl = `/_next/data/${buildId}/something.json`\n    const data = await renderViaHTTP(next.url, curUrl)\n    const { appProps, pageProps } = JSON.parse(data)\n\n    expect(pageProps.resolvedUrl).toEqual('/something')\n\n    expect(appProps).toEqual({\n      url: curUrl,\n      query: {},\n      asPath: '/something',\n      pathname: '/something',\n    })\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have original req.url for /_next/data request with query","suites":[],"updatePoint":{"line":464,"column":69},"line":464,"code":"  it('should have original req.url for /_next/data request with query', async () => {\n    const curUrl = `/_next/data/${buildId}/something.json`\n    const data = await renderViaHTTP(next.url, curUrl, { hello: 'world' })\n    const { appProps, pageProps } = JSON.parse(data)\n\n    expect(pageProps.resolvedUrl).toEqual('/something?hello=world')\n\n    expect(appProps).toEqual({\n      url: curUrl + '?hello=world',\n      query: { hello: 'world' },\n      asPath: '/something?hello=world',\n      pathname: '/something',\n    })\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct req.url and query for direct visit dynamic page","suites":[],"updatePoint":{"line":479,"column":73},"line":479,"code":"  it('should have correct req.url and query for direct visit dynamic page', async () => {\n    const html = await renderViaHTTP(next.url, '/blog/post-1')\n    const $ = cheerio.load(html)\n    expect($('#app-url').text()).toContain('/blog/post-1')\n    expect(JSON.parse($('#app-query').text())).toEqual({ post: 'post-1' })\n    expect($('#resolved-url').text()).toBe('/blog/post-1')\n    expect($('#as-path').text()).toBe('/blog/post-1')\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct req.url and query for direct visit dynamic page rewrite direct","suites":[],"updatePoint":{"line":488,"column":88},"line":488,"code":"  it('should have correct req.url and query for direct visit dynamic page rewrite direct', async () => {\n    const html = await renderViaHTTP(next.url, '/blog-post-1')\n    const $ = cheerio.load(html)\n    expect($('#app-url').text()).toContain('/blog-post-1')\n    expect(JSON.parse($('#app-query').text())).toEqual({ post: 'post-1' })\n    expect($('#resolved-url').text()).toBe('/blog/post-1')\n    expect($('#as-path').text()).toBe('/blog-post-1')\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct req.url and query for direct visit dynamic page rewrite direct with internal query","suites":[],"updatePoint":{"line":497,"column":108},"line":497,"code":"  it('should have correct req.url and query for direct visit dynamic page rewrite direct with internal query', async () => {\n    const html = await renderViaHTTP(next.url, '/blog-post-2')\n    const $ = cheerio.load(html)\n    expect($('#app-url').text()).toContain('/blog-post-2')\n    expect(JSON.parse($('#app-query').text())).toEqual({\n      post: 'post-2',\n      hello: 'world',\n    })\n    expect($('#resolved-url').text()).toBe('/blog/post-2')\n    expect($('#as-path').text()).toBe('/blog-post-2')\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct req.url and query for direct visit dynamic page rewrite param","suites":[],"updatePoint":{"line":509,"column":87},"line":509,"code":"  it('should have correct req.url and query for direct visit dynamic page rewrite param', async () => {\n    const html = await renderViaHTTP(next.url, '/blog-post-3')\n    const $ = cheerio.load(html)\n    expect($('#app-url').text()).toContain('/blog-post-3')\n    expect(JSON.parse($('#app-query').text())).toEqual({\n      post: 'post-3',\n      param: 'post-3',\n    })\n    expect($('#resolved-url').text()).toBe('/blog/post-3')\n    expect($('#as-path').text()).toBe('/blog-post-3')\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct req.url and query for direct visit dynamic page with query","suites":[],"updatePoint":{"line":521,"column":84},"line":521,"code":"  it('should have correct req.url and query for direct visit dynamic page with query', async () => {\n    const html = await renderViaHTTP(next.url, '/blog/post-1', {\n      hello: 'world',\n    })\n    const $ = cheerio.load(html)\n    expect($('#app-url').text()).toContain('/blog/post-1?hello=world')\n    expect(JSON.parse($('#app-query').text())).toEqual({\n      post: 'post-1',\n      hello: 'world',\n    })\n    expect($('#resolved-url').text()).toBe('/blog/post-1?hello=world')\n    expect($('#as-path').text()).toBe('/blog/post-1?hello=world')\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct req.url and query for direct visit","suites":[],"updatePoint":{"line":535,"column":60},"line":535,"code":"  it('should have correct req.url and query for direct visit', async () => {\n    const html = await renderViaHTTP(next.url, '/something')\n    const $ = cheerio.load(html)\n    expect($('#app-url').text()).toContain('/something')\n    expect(JSON.parse($('#app-query').text())).toEqual({})\n    expect($('#resolved-url').text()).toBe('/something')\n    expect($('#as-path').text()).toBe('/something')\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should return data correctly","suites":[],"updatePoint":{"line":544,"column":34},"line":544,"code":"  it('should return data correctly', async () => {\n    const data = JSON.parse(\n      await renderViaHTTP(next.url, `/_next/data/${buildId}/something.json`)\n    )\n    expect(data.pageProps.world).toBe('world')\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should pass query for data request","suites":[],"updatePoint":{"line":551,"column":40},"line":551,"code":"  it('should pass query for data request', async () => {\n    const data = JSON.parse(\n      await renderViaHTTP(\n        next.url,\n        `/_next/data/${buildId}/something.json?another=thing`\n      )\n    )\n    expect(data.pageProps.query.another).toBe('thing')\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should return data correctly for dynamic page","suites":[],"updatePoint":{"line":561,"column":51},"line":561,"code":"  it('should return data correctly for dynamic page', async () => {\n    const data = JSON.parse(\n      await renderViaHTTP(next.url, `/_next/data/${buildId}/blog/post-1.json`)\n    )\n    expect(data.pageProps.post).toBe('post-1')\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should return data correctly when props is a promise","suites":[],"updatePoint":{"line":568,"column":58},"line":568,"code":"  it('should return data correctly when props is a promise', async () => {\n    const html = await renderViaHTTP(next.url, `/promise`)\n    expect(html).toMatch(/hello.*?promise/)\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should navigate to a normal page and back","suites":[],"updatePoint":{"line":573,"column":47},"line":573,"code":"  it('should navigate to a normal page and back', async () => {\n    const browser = await webdriver(next.url, '/')\n    let text = await browser.elementByCss('p').text()\n    expect(text).toMatch(/hello.*?world/)\n\n    await browser.elementByCss('#normal').click()\n    await browser.waitForElementByCss('#normal-text')\n    text = await browser.elementByCss('#normal-text').text()\n    expect(text).toMatch(/a normal page/)\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should load a fast refresh page","suites":[],"updatePoint":{"line":584,"column":37},"line":584,"code":"  it('should load a fast refresh page', async () => {\n    const browser = await webdriver(next.url, '/refresh')\n    expect(\n      await check(\n        () => browser.elementByCss('p').text(),\n        /client loaded/,\n        false\n      )\n    ).toBe(true)\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should provide correct query value for dynamic page","suites":[],"updatePoint":{"line":595,"column":57},"line":595,"code":"  it('should provide correct query value for dynamic page', async () => {\n    const html = await renderViaHTTP(\n      next.url,\n      '/blog/post-1?post=something-else'\n    )\n    const $ = cheerio.load(html)\n    const query = JSON.parse($('#query').text())\n    expect(query.post).toBe('post-1')\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should parse query values on mount correctly","suites":[],"updatePoint":{"line":605,"column":50},"line":605,"code":"  it('should parse query values on mount correctly', async () => {\n    const browser = await webdriver(next.url, '/blog/post-1?another=value')\n    await waitFor(2000)\n    const text = await browser.elementByCss('#query').text()\n    expect(text).toMatch(/another.*?value/)\n    expect(text).toMatch(/post.*?post-1/)\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should pass query for data request on navigation","suites":[],"updatePoint":{"line":613,"column":54},"line":613,"code":"  it('should pass query for data request on navigation', async () => {\n    const browser = await webdriver(next.url, '/')\n    await browser.eval('window.beforeNav = true')\n    await browser.elementByCss('#something-query').click()\n    await browser.waitForElementByCss('#initial-query')\n    const query = JSON.parse(\n      await browser.elementByCss('#initial-query').text()\n    )\n    expect(await browser.eval('window.beforeNav')).toBe(true)\n    expect(query.another).toBe('thing')\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should reload page on failed data request","suites":[],"updatePoint":{"line":625,"column":47},"line":625,"code":"  it('should reload page on failed data request', async () => {\n    const browser = await webdriver(next.url, '/')\n    await waitFor(500)\n    await browser.eval('window.beforeClick = \"abc\"')\n    await browser.elementByCss('#broken-post').click()\n    expect(\n      await check(() => browser.eval('window.beforeClick'), {\n        test(v) {\n          return v !== 'abc'\n        },\n      })\n    ).toBe(true)\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should always call getServerSideProps without caching","suites":[],"updatePoint":{"line":639,"column":59},"line":639,"code":"  it('should always call getServerSideProps without caching', async () => {\n    const initialRes = await fetchViaHTTP(next.url, '/something')\n    const initialHtml = await initialRes.text()\n    expect(initialHtml).toMatch(/hello.*?world/)\n\n    const newRes = await fetchViaHTTP(next.url, '/something')\n    const newHtml = await newRes.text()\n    expect(newHtml).toMatch(/hello.*?world/)\n    expect(initialHtml !== newHtml).toBe(true)\n\n    const newerRes = await fetchViaHTTP(next.url, '/something')\n    const newerHtml = await newerRes.text()\n    expect(newerHtml).toMatch(/hello.*?world/)\n    expect(newHtml !== newerHtml).toBe(true)\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not re-call getServerSideProps when updating query","suites":[],"updatePoint":{"line":655,"column":63},"line":655,"code":"  it('should not re-call getServerSideProps when updating query', async () => {\n    const browser = await webdriver(next.url, '/something?hello=world')\n    await waitFor(2000)\n\n    const query = await browser.elementByCss('#query').text()\n    expect(JSON.parse(query)).toEqual({ hello: 'world' })\n\n    const {\n      props: {\n        pageProps: { random: initialRandom },\n      },\n    } = await browser.eval('window.__NEXT_DATA__')\n\n    const curRandom = await browser.elementByCss('#random').text()\n    expect(curRandom).toBe(initialRandom + '')\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should dedupe server data requests","suites":[],"updatePoint":{"line":672,"column":40},"line":672,"code":"  it('should dedupe server data requests', async () => {\n    const browser = await webdriver(next.url, '/')\n    await waitFor(2000)\n\n    // Keep clicking on the link\n    await browser.elementByCss('#slow').click()\n    await browser.elementByCss('#slow').click()\n    await browser.elementByCss('#slow').click()\n    await browser.elementByCss('#slow').click()\n\n    await check(() => getBrowserBodyText(browser), /a slow page/)\n\n    // Requests should be deduped\n    const hitCount = await browser.elementByCss('#hit').text()\n    expect(hitCount).toBe('hit: 1')\n\n    // Should send request again\n    await browser.elementByCss('#home').click()\n    await browser.waitForElementByCss('#slow')\n    await browser.elementByCss('#slow').click()\n    await check(() => getBrowserBodyText(browser), /a slow page/)\n\n    const newHitCount = await browser.elementByCss('#hit').text()\n    expect(newHitCount).toBe('hit: 2')\n  })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not show warning from url prop being returned","suites":[],"updatePoint":{"line":699,"column":60},"line":699,"code":"    it('should not show warning from url prop being returned', async () => {\n      const urlPropPage = 'pages/url-prop.js'\n      await next.patchFile(\n        urlPropPage,\n        `\n        export async function getServerSideProps() {\n          return {\n            props: {\n              url: 'something'\n            }\n          }\n        }\n\n        export default ({ url }) => <p>url: {url}</p>\n      `\n      )\n\n      const html = await renderViaHTTP(next.url, '/url-prop')\n      await next.deleteFile(urlPropPage)\n      expect(next.cliOutput).not.toMatch(\n        /The prop `url` is a reserved prop in Next.js for legacy reasons and will be overridden on page \\/url-prop/\n      )\n      expect(html).toMatch(/url:.*?something/)\n    })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show error for extra keys returned from getServerSideProps","suites":[],"updatePoint":{"line":724,"column":73},"line":724,"code":"    it('should show error for extra keys returned from getServerSideProps', async () => {\n      const html = await renderViaHTTP(next.url, '/invalid-keys')\n      expect(html).toContain(\n        `Additional keys were returned from \\`getServerSideProps\\`. Properties intended for your component must be nested under the \\`props\\` key, e.g.:`\n      )\n      expect(html).toContain(\n        `Keys that need to be moved: world, query, params, time, random`\n      )\n    })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show error for invalid JSON returned from getServerSideProps","suites":[],"updatePoint":{"line":734,"column":75},"line":734,"code":"    it('should show error for invalid JSON returned from getServerSideProps', async () => {\n      const html = await renderViaHTTP(next.url, '/non-json')\n      expect(html).toContain(\n        'Error serializing `.time` returned from `getServerSideProps`'\n      )\n    })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show error for invalid JSON returned from getStaticProps on CST","suites":[],"updatePoint":{"line":741,"column":78},"line":741,"code":"    it('should show error for invalid JSON returned from getStaticProps on CST', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.elementByCss('#non-json').click()\n\n      await check(\n        () => getRedboxHeader(browser),\n        /Error serializing `.time` returned from `getServerSideProps`/\n      )\n    })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show error for accessing res after gssp returns","suites":[],"updatePoint":{"line":751,"column":62},"line":751,"code":"    it('should show error for accessing res after gssp returns', async () => {\n      const html = await renderViaHTTP(next.url, '/promise/mutate-res')\n      expect(html).toContain(\n        `You should not access 'res' after getServerSideProps resolves`\n      )\n    })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show error for accessing res through props promise after gssp returns","suites":[],"updatePoint":{"line":758,"column":84},"line":758,"code":"    it('should show error for accessing res through props promise after gssp returns', async () => {\n      const html = await renderViaHTTP(next.url, '/promise/mutate-res-props')\n      expect(html).toContain(\n        `You should not access 'res' after getServerSideProps resolves`\n      )\n    })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should only warn for accessing res if not streaming","suites":[],"updatePoint":{"line":765,"column":59},"line":765,"code":"    it('should only warn for accessing res if not streaming', async () => {\n      const html = await renderViaHTTP(\n        next.url,\n        '/promise/mutate-res-no-streaming'\n      )\n      expect(html).not.toContain(\n        `You should not access 'res' after getServerSideProps resolves`\n      )\n      expect(next.cliOutput).toContain(\n        `You should not access 'res' after getServerSideProps resolves`\n      )\n    })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not fetch data on mount","suites":[],"updatePoint":{"line":778,"column":38},"line":778,"code":"    it('should not fetch data on mount', async () => {\n      const browser = await webdriver(next.url, '/blog/post-100')\n      await browser.eval('window.thisShouldStay = true')\n      await waitFor(2 * 1000)\n      const val = await browser.eval('window.thisShouldStay')\n      expect(val).toBe(true)\n    })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should output routes-manifest correctly","suites":[],"updatePoint":{"line":787,"column":49},"line":787,"code":"      it('should output routes-manifest correctly', async () => {\n        const { dataRoutes } = JSON.parse(\n          await next.readFile('.next/routes-manifest.json')\n        )\n        for (const route of dataRoutes) {\n          route.dataRouteRegex = normalizeRegEx(route.dataRouteRegex)\n        }\n\n        expect(dataRoutes).toEqual(expectedManifestRoutes())\n      })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should set default caching header","suites":[],"updatePoint":{"line":799,"column":41},"line":799,"code":"    it('should set default caching header', async () => {\n      const resPage = await fetchViaHTTP(next.url, `/something`)\n      expect(resPage.headers.get('cache-control')).toBe(\n        'private, no-cache, no-store, max-age=0, must-revalidate'\n      )\n\n      const resData = await fetchViaHTTP(\n        next.url,\n        `/_next/data/${buildId}/something.json`\n      )\n      expect(resData.headers.get('cache-control')).toBe(\n        'private, no-cache, no-store, max-age=0, must-revalidate'\n      )\n    })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should respect custom caching header","suites":[],"updatePoint":{"line":814,"column":44},"line":814,"code":"    it('should respect custom caching header', async () => {\n      const resPage = await fetchViaHTTP(next.url, `/custom-cache`)\n      expect(resPage.headers.get('cache-control')).toBe('public, max-age=3600')\n\n      const resData = await fetchViaHTTP(\n        next.url,\n        `/_next/data/${buildId}/custom-cache.json`\n      )\n      expect(resData.headers.get('cache-control')).toBe('public, max-age=3600')\n    })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not show error for invalid JSON returned from getServerSideProps","suites":[],"updatePoint":{"line":825,"column":79},"line":825,"code":"    it('should not show error for invalid JSON returned from getServerSideProps', async () => {\n      const html = await renderViaHTTP(next.url, '/non-json')\n      expect(html).not.toContain('Error serializing')\n      expect(html).toContain('hello ')\n    })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not show error for invalid JSON returned from getStaticProps on CST","suites":[],"updatePoint":{"line":831,"column":82},"line":831,"code":"    it('should not show error for invalid JSON returned from getStaticProps on CST', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.elementByCss('#non-json').click()\n      await check(() => getBrowserBodyText(browser), /hello /)\n    })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not show error for accessing res after gssp returns","suites":[],"updatePoint":{"line":837,"column":66},"line":837,"code":"    it('should not show error for accessing res after gssp returns', async () => {\n      const html = await renderViaHTTP(next.url, '/promise/mutate-res')\n      expect(html).toMatch(/hello.*?res/)\n    })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not warn for accessing res after gssp returns","suites":[],"updatePoint":{"line":842,"column":60},"line":842,"code":"    it('should not warn for accessing res after gssp returns', async () => {\n      const html = await renderViaHTTP(next.url, '/promise/mutate-res')\n      expect(html).toMatch(/hello.*?res/)\n    })","file":"e2e/getserversideprops/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should work","suites":["handle-non-hoisted-swc-helpers"],"updatePoint":{"line":34,"column":17},"line":34,"code":"  it('should work', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toContain('hello world')\n  })","file":"e2e/handle-non-hoisted-swc-helpers/index.test.ts","skipped":false,"dir":"test"},{"name":"should respond to normal API request","suites":["i18n API support"],"updatePoint":{"line":45,"column":42},"line":45,"code":"  it('should respond to normal API request', async () => {\n    const res = await fetchViaHTTP(next.url, '/api/hello')\n    expect(res.status).toBe(200)\n    expect(await res.text()).toBe('hello world')\n  })","file":"e2e/i18n-api-support/index.test.ts","skipped":false,"dir":"test"},{"name":"should respond to normal dynamic API request","suites":["i18n API support"],"updatePoint":{"line":51,"column":50},"line":51,"code":"  it('should respond to normal dynamic API request', async () => {\n    const res = await fetchViaHTTP(next.url, '/api/blog/first')\n    expect(res.status).toBe(200)\n    expect(await res.text()).toBe('blog/[slug]')\n  })","file":"e2e/i18n-api-support/index.test.ts","skipped":false,"dir":"test"},{"name":"should fallback rewrite non-matching API request","suites":["i18n API support"],"updatePoint":{"line":59,"column":56},"line":59,"code":"    it('should fallback rewrite non-matching API request', async () => {\n      const paths = [\n        '/fr/api/hello',\n        '/en/api/blog/first',\n        '/en/api/non-existent',\n        '/api/non-existent',\n      ]\n\n      for (const path of paths) {\n        const res = await fetchViaHTTP(next.url, path)\n        expect(res.status).toBe(200)\n        expect(await res.text()).toContain('Example Domain')\n      }\n    })","file":"e2e/i18n-api-support/index.test.ts","skipped":false,"dir":"test"},{"name":"should skip temporarily","suites":["i18n-data-fetching-redirect"],"updatePoint":{"line":12,"column":31},"line":12,"code":"    it('should skip temporarily', () => {})","file":"e2e/i18n-data-fetching-redirect/index.test.ts","skipped":false,"dir":"test"},{"name":"$path $fromLocale -> $toLocale","suites":["i18n-data-fetching-redirect","Redirect to another locale"],"line":28,"code":"    test.each`\n      path                       | fromLocale | toLocale\n      ${'gssp-redirect'}         | ${'en'}    | ${'sv'}\n      ${'gssp-redirect'}         | ${'sv'}    | ${'en'}\n      ${'gsp-blocking-redirect'} | ${'en'}    | ${'sv'}\n      ${'gsp-blocking-redirect'} | ${'sv'}    | ${'en'}\n      ${'gsp-fallback-redirect'} | ${'en'}    | ${'sv'}\n      ${'gsp-fallback-redirect'} | ${'sv'}    | ${'en'}\n    `(\n      '$path $fromLocale -> $toLocale',\n      async ({ path, fromLocale, toLocale }) => {\n        const browser = await webdriver(\n          next.url,\n          `/${fromLocale}/${path}/${toLocale}`\n        )\n\n        await check(\n          () => browser.eval('window.location.pathname'),\n          `/${toLocale}/home`\n        )\n        expect(await browser.elementByCss('#router-locale').text()).toBe(\n          toLocale\n        )\n        expect(await browser.elementByCss('#router-pathname').text()).toBe(\n          '/home'\n        )\n        expect(await browser.elementByCss('#router-as-path').text()).toBe(\n          '/home'\n        )\n      }\n    )","file":"e2e/i18n-data-fetching-redirect/index.test.ts","skipped":false,"dir":"test"},{"name":"next/link $path $fromLocale -> $toLocale","suites":["i18n-data-fetching-redirect","Redirect to another locale"],"line":60,"code":"    test.each`\n      path                       | fromLocale | toLocale\n      ${'gssp-redirect'}         | ${'en'}    | ${'sv'}\n      ${'gssp-redirect'}         | ${'sv'}    | ${'en'}\n      ${'gsp-blocking-redirect'} | ${'en'}    | ${'sv'}\n      ${'gsp-blocking-redirect'} | ${'sv'}    | ${'en'}\n      ${'gsp-fallback-redirect'} | ${'en'}    | ${'sv'}\n      ${'gsp-fallback-redirect'} | ${'sv'}    | ${'en'}\n    `(\n      'next/link $path $fromLocale -> $toLocale',\n      async ({ path, fromLocale, toLocale }) => {\n        const browser = await webdriver(next.url, `/${fromLocale}`)\n        await browser.eval('window.beforeNav = 1')\n\n        await browser.elementByCss(`#to-${path}-${toLocale}`).click()\n\n        await check(\n          () => browser.eval('window.location.pathname'),\n          `/${toLocale}/home`\n        )\n\n        expect(await browser.eval('window.beforeNav')).toBe(1)\n        expect(await browser.elementByCss('#router-locale').text()).toBe(\n          toLocale\n        )\n        expect(await browser.elementByCss('#router-pathname').text()).toBe(\n          '/home'\n        )\n        expect(await browser.elementByCss('#router-as-path').text()).toBe(\n          '/home'\n        )\n      }\n    )","file":"e2e/i18n-data-fetching-redirect/index.test.ts","skipped":false,"dir":"test"},{"name":"$path $locale","suites":["i18n-data-fetching-redirect","Redirect to locale from context"],"line":96,"code":"    test.each`\n      path                       | locale\n      ${'gssp-redirect'}         | ${'en'}\n      ${'gssp-redirect'}         | ${'sv'}\n      ${'gsp-blocking-redirect'} | ${'en'}\n      ${'gsp-blocking-redirect'} | ${'sv'}\n      ${'gsp-fallback-redirect'} | ${'en'}\n      ${'gsp-fallback-redirect'} | ${'sv'}\n    `('$path $locale', async ({ path, locale }) => {\n      const browser = await webdriver(next.url, `/${locale}/${path}/from-ctx`)\n\n      await check(\n        () => browser.eval('window.location.pathname'),\n        `/${locale}/home`\n      )\n      expect(await browser.elementByCss('#router-locale').text()).toBe(locale)\n      expect(await browser.elementByCss('#router-pathname').text()).toBe(\n        '/home'\n      )\n      expect(await browser.elementByCss('#router-as-path').text()).toBe('/home')\n    })","file":"e2e/i18n-data-fetching-redirect/index.test.ts","skipped":false,"dir":"test"},{"name":"next/link $path $locale","suites":["i18n-data-fetching-redirect","Redirect to locale from context"],"line":118,"code":"    test.each`\n      path                       | locale\n      ${'gssp-redirect'}         | ${'en'}\n      ${'gssp-redirect'}         | ${'sv'}\n      ${'gsp-blocking-redirect'} | ${'en'}\n      ${'gsp-blocking-redirect'} | ${'sv'}\n      ${'gsp-fallback-redirect'} | ${'en'}\n      ${'gsp-fallback-redirect'} | ${'sv'}\n    `('next/link $path $locale', async ({ path, locale }) => {\n      const browser = await webdriver(next.url, `/${locale}`)\n      await browser.eval('window.beforeNav = 1')\n\n      await browser.elementByCss(`#to-${path}-from-ctx`).click()\n\n      await check(\n        () => browser.eval('window.location.pathname'),\n        `/${locale}/home`\n      )\n\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n      expect(await browser.elementByCss('#router-locale').text()).toBe(locale)\n      expect(await browser.elementByCss('#router-pathname').text()).toBe(\n        '/home'\n      )\n      expect(await browser.elementByCss('#router-as-path').text()).toBe('/home')\n    })","file":"e2e/i18n-data-fetching-redirect/index.test.ts","skipped":false,"dir":"test"},{"name":"get redirected to the new page, from: %s to: sv","suites":["i18n-ignore-redirect-source-locale with basepath"],"line":57,"code":"  test.each(locales)(\n    'get redirected to the new page, from: %s to: sv',\n    async (locale) => {\n      const browser = await webdriver(next.url, `basepath/${locale}/to-sv`)\n      await check(() => browser.elementById('current-locale').text(), 'sv')\n    }\n  )","file":"e2e/i18n-ignore-redirect-source-locale/redirects-with-basepath.test.ts","skipped":false,"dir":"test"},{"name":"get redirected to the new page, from: %s to: en","suites":["i18n-ignore-redirect-source-locale with basepath"],"line":65,"code":"  test.each(locales)(\n    'get redirected to the new page, from: %s to: en',\n    async (locale) => {\n      const browser = await webdriver(next.url, `basepath/${locale}/to-en`)\n      await check(() => browser.elementById('current-locale').text(), 'en')\n    }\n  )","file":"e2e/i18n-ignore-redirect-source-locale/redirects-with-basepath.test.ts","skipped":false,"dir":"test"},{"name":"get redirected to the new page, from: %s to: /","suites":["i18n-ignore-redirect-source-locale with basepath"],"line":73,"code":"  test.each(locales)(\n    'get redirected to the new page, from: %s to: /',\n    async (locale) => {\n      const browser = await webdriver(next.url, `basepath/${locale}/to-slash`)\n      await check(() => browser.elementById('current-locale').text(), 'en')\n    }\n  )","file":"e2e/i18n-ignore-redirect-source-locale/redirects-with-basepath.test.ts","skipped":false,"dir":"test"},{"name":"get redirected to the new page, from and to: %s","suites":["i18n-ignore-redirect-source-locale with basepath"],"line":81,"code":"  test.each(locales)(\n    'get redirected to the new page, from and to: %s',\n    async (locale) => {\n      const browser = await webdriver(next.url, `basepath/${locale}/to-same`)\n      await check(\n        () => browser.elementById('current-locale').text(),\n        locale === '' ? 'en' : locale.slice(1)\n      )\n    }\n  )","file":"e2e/i18n-ignore-redirect-source-locale/redirects-with-basepath.test.ts","skipped":false,"dir":"test"},{"name":"get redirected to the new page, from: %s to: sv","suites":["i18n-ignore-redirect-source-locale"],"line":56,"code":"  test.each(locales)(\n    'get redirected to the new page, from: %s to: sv',\n    async (locale) => {\n      const browser = await webdriver(next.url, `${locale}/to-sv`)\n      await check(() => browser.elementById('current-locale').text(), 'sv')\n    }\n  )","file":"e2e/i18n-ignore-redirect-source-locale/redirects.test.ts","skipped":false,"dir":"test"},{"name":"get redirected to the new page, from: %s to: en","suites":["i18n-ignore-redirect-source-locale"],"line":64,"code":"  test.each(locales)(\n    'get redirected to the new page, from: %s to: en',\n    async (locale) => {\n      const browser = await webdriver(next.url, `${locale}/to-en`)\n      await check(() => browser.elementById('current-locale').text(), 'en')\n    }\n  )","file":"e2e/i18n-ignore-redirect-source-locale/redirects.test.ts","skipped":false,"dir":"test"},{"name":"get redirected to the new page, from: %s to: /","suites":["i18n-ignore-redirect-source-locale"],"line":72,"code":"  test.each(locales)(\n    'get redirected to the new page, from: %s to: /',\n    async (locale) => {\n      const browser = await webdriver(next.url, `${locale}/to-slash`)\n      await check(() => browser.elementById('current-locale').text(), 'en')\n    }\n  )","file":"e2e/i18n-ignore-redirect-source-locale/redirects.test.ts","skipped":false,"dir":"test"},{"name":"get redirected to the new page, from and to: %s","suites":["i18n-ignore-redirect-source-locale"],"line":80,"code":"  test.each(locales)(\n    'get redirected to the new page, from and to: %s',\n    async (locale) => {\n      const browser = await webdriver(next.url, `${locale}/to-same`)\n      await check(\n        () => browser.elementById('current-locale').text(),\n        locale === '' ? 'en' : locale.slice(1)\n      )\n    }\n  )","file":"e2e/i18n-ignore-redirect-source-locale/redirects.test.ts","skipped":false,"dir":"test"},{"name":"get public file by skipping locale in rewrite, locale: %s","suites":["i18n-ignore-rewrite-source-locale with basepath"],"line":51,"code":"  test.each(locales)(\n    'get public file by skipping locale in rewrite, locale: %s',\n    async (locale) => {\n      const res = await renderViaHTTP(\n        next.url,\n        `/basepath${locale}/rewrite-files/file.txt`\n      )\n      expect(res).toContain('hello from file.txt')\n    }\n  )","file":"e2e/i18n-ignore-rewrite-source-locale/rewrites-with-basepath.test.ts","skipped":false,"dir":"test"},{"name":"call api by skipping locale in rewrite, locale: %s","suites":["i18n-ignore-rewrite-source-locale with basepath"],"line":62,"code":"  test.each(locales)(\n    'call api by skipping locale in rewrite, locale: %s',\n    async (locale) => {\n      const res = await renderViaHTTP(\n        next.url,\n        `/basepath${locale}/rewrite-api/hello`\n      )\n      expect(res).toContain('hello from api')\n    }\n  )","file":"e2e/i18n-ignore-rewrite-source-locale/rewrites-with-basepath.test.ts","skipped":false,"dir":"test"},{"name":"get _next/static/ files by skipping locale in rewrite, locale: %s","suites":["i18n-ignore-rewrite-source-locale with basepath"],"line":75,"code":"    test.each(locales)(\n      'get _next/static/ files by skipping locale in rewrite, locale: %s',\n      async (locale) => {\n        const chunks = (\n          await fs.readdir(path.join(next.testDir, '.next', 'static', 'chunks'))\n        ).filter((f) => f.endsWith('.js'))\n\n        await Promise.all(\n          chunks.map(async (file) => {\n            const res = await fetchViaHTTP(\n              next.url,\n              `/basepath${locale}/rewrite-files/_next/static/chunks/${file}`\n            )\n            expect(res.status).toBe(200)\n          })\n        )\n      }\n    )","file":"e2e/i18n-ignore-rewrite-source-locale/rewrites-with-basepath.test.ts","skipped":false,"dir":"test"},{"name":"get public file by skipping locale in rewrite, locale: %s","suites":["i18n-ignore-rewrite-source-locale"],"line":50,"code":"  test.each(locales)(\n    'get public file by skipping locale in rewrite, locale: %s',\n    async (locale) => {\n      const res = await renderViaHTTP(\n        next.url,\n        `${locale}/rewrite-files/file.txt`\n      )\n      expect(res).toContain('hello from file.txt')\n    }\n  )","file":"e2e/i18n-ignore-rewrite-source-locale/rewrites.test.ts","skipped":false,"dir":"test"},{"name":"call api by skipping locale in rewrite, locale: %s","suites":["i18n-ignore-rewrite-source-locale"],"line":61,"code":"  test.each(locales)(\n    'call api by skipping locale in rewrite, locale: %s',\n    async (locale) => {\n      const res = await renderViaHTTP(next.url, `${locale}/rewrite-api/hello`)\n      expect(res).toContain('hello from api')\n    }\n  )","file":"e2e/i18n-ignore-rewrite-source-locale/rewrites.test.ts","skipped":false,"dir":"test"},{"name":"get _next/static/ files by skipping locale in rewrite, locale: %s","suites":["i18n-ignore-rewrite-source-locale"],"line":71,"code":"    test.each(locales)(\n      'get _next/static/ files by skipping locale in rewrite, locale: %s',\n      async (locale) => {\n        const chunks = (\n          await fs.readdir(path.join(next.testDir, '.next', 'static', 'chunks'))\n        ).filter((f) => f.endsWith('.js'))\n\n        await Promise.all(\n          chunks.map(async (file) => {\n            const res = await fetchViaHTTP(\n              next.url,\n              `${locale}/rewrite-files/_next/static/chunks/${file}`\n            )\n            expect(res.status).toBe(200)\n          })\n        )\n      }\n    )","file":"e2e/i18n-ignore-rewrite-source-locale/rewrites.test.ts","skipped":false,"dir":"test"},{"name":"Ignore event without query param","suites":["i18n: Event with stale state - static route previously was dynamic"],"updatePoint":{"line":31,"column":40},"line":31,"code":"  test('Ignore event without query param', async () => {\n    const browser = await webdriver(next.url, '/sv/static')\n    browser.close()\n\n    const state: HistoryState = {\n      url: '/[dynamic]?',\n      as: '/static',\n      options: { locale: 'sv' },\n      __N: true,\n      key: '',\n    }\n\n    expect(await browser.elementByCss('#page-type').text()).toBe('static')\n\n    // 1st event is ignored\n    await emitPopsStateEvent(browser, state)\n    await waitFor(1000)\n    expect(await browser.elementByCss('#page-type').text()).toBe('static')\n\n    // 2nd event isn't ignored\n    await emitPopsStateEvent(browser, state)\n    await check(() => browser.elementByCss('#page-type').text(), 'dynamic')\n  })","file":"e2e/ignore-invalid-popstateevent/with-i18n.test.ts","skipped":false,"dir":"test"},{"name":"Ignore event with query param","suites":["i18n: Event with stale state - static route previously was dynamic"],"updatePoint":{"line":55,"column":37},"line":55,"code":"  test('Ignore event with query param', async () => {\n    const browser = await webdriver(next.url, '/sv/static?param=1')\n\n    const state: HistoryState = {\n      url: '/[dynamic]?param=1',\n      as: '/static?param=1',\n      options: { locale: 'sv' },\n      __N: true,\n      key: '',\n    }\n\n    expect(await browser.elementByCss('#page-type').text()).toBe('static')\n\n    // 1st event is ignored\n    await emitPopsStateEvent(browser, state)\n    await waitFor(1000)\n    expect(await browser.elementByCss('#page-type').text()).toBe('static')\n\n    // 2nd event isn't ignored\n    await emitPopsStateEvent(browser, state)\n    await check(() => browser.elementByCss('#page-type').text(), 'dynamic')\n  })","file":"e2e/ignore-invalid-popstateevent/with-i18n.test.ts","skipped":false,"dir":"test"},{"name":"Don't ignore event with different locale","suites":["i18n: Event with stale state - static route previously was dynamic"],"updatePoint":{"line":78,"column":48},"line":78,"code":"  test(\"Don't ignore event with different locale\", async () => {\n    const browser = await webdriver(next.url, '/sv/static?param=1')\n\n    const state: HistoryState = {\n      url: '/[dynamic]?param=1',\n      as: '/static?param=1',\n      options: { locale: 'en' },\n      __N: true,\n      key: '',\n    }\n\n    expect(await browser.elementByCss('#page-type').text()).toBe('static')\n\n    await emitPopsStateEvent(browser, state)\n    await check(() => browser.elementByCss('#page-type').text(), 'dynamic')\n  })","file":"e2e/ignore-invalid-popstateevent/with-i18n.test.ts","skipped":false,"dir":"test"},{"name":"Ignore event without query param","suites":["Event with stale state - static route previously was dynamic"],"updatePoint":{"line":31,"column":40},"line":31,"code":"  test('Ignore event without query param', async () => {\n    const browser = await webdriver(next.url, '/static')\n    browser.close()\n\n    const state: HistoryState = {\n      url: '/[dynamic]?',\n      as: '/static',\n      options: {},\n      __N: true,\n      key: '',\n    }\n\n    expect(await browser.elementByCss('#page-type').text()).toBe('static')\n\n    // 1st event is ignored\n    await emitPopsStateEvent(browser, state)\n    await waitFor(1000)\n    expect(await browser.elementByCss('#page-type').text()).toBe('static')\n\n    // 2nd event isn't ignored\n    await emitPopsStateEvent(browser, state)\n    await check(() => browser.elementByCss('#page-type').text(), 'dynamic')\n  })","file":"e2e/ignore-invalid-popstateevent/without-i18n.test.ts","skipped":false,"dir":"test"},{"name":"Ignore event with query param","suites":["Event with stale state - static route previously was dynamic"],"updatePoint":{"line":55,"column":37},"line":55,"code":"  test('Ignore event with query param', async () => {\n    const browser = await webdriver(next.url, '/static?param=1')\n\n    const state: HistoryState = {\n      url: '/[dynamic]?param=1',\n      as: '/static?param=1',\n      options: {},\n      __N: true,\n      key: '',\n    }\n\n    expect(await browser.elementByCss('#page-type').text()).toBe('static')\n\n    // 1st event is ignored\n    await emitPopsStateEvent(browser, state)\n    await waitFor(1000)\n    expect(await browser.elementByCss('#page-type').text()).toBe('static')\n\n    // 2nd event isn't ignored\n    await emitPopsStateEvent(browser, state)\n    await check(() => browser.elementByCss('#page-type').text(), 'dynamic')\n  })","file":"e2e/ignore-invalid-popstateevent/without-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should perform hard navigation for rewritten urls","suites":["link-with-api-rewrite"],"updatePoint":{"line":21,"column":55},"line":21,"code":"  it('should perform hard navigation for rewritten urls', async () => {\n    const browser = await webdriver(next.url, '/')\n\n    try {\n      // Click the link on the page, we expect that there will be a hard\n      // navigation later (we do this be checking that the window global is\n      // unset).\n      await browser.eval('window.beforeNav = \"hi\"')\n      await browser.elementById('rewrite').click()\n      await check(() => browser.eval('window.beforeNav'), {\n        test: (content) => content !== 'hi',\n      })\n\n      // Check to see that we were in fact navigated to the correct page.\n      const pathname = await browser.eval('window.location.pathname')\n      expect(pathname).toBe('/some/route/for')\n\n      // Check to see that the resulting data is coming from the right endpoint.\n      const text = await browser.eval(\n        'window.document.documentElement.innerText'\n      )\n      expect(text).toBe('{\"from\":\"/some/route/for\"}')\n    } finally {\n      await browser.close()\n    }\n  })","file":"e2e/link-with-api-rewrite/index.test.ts","skipped":false,"dir":"test"},{"name":"should perform hard navigation for direct urls","suites":["link-with-api-rewrite"],"updatePoint":{"line":48,"column":52},"line":48,"code":"  it('should perform hard navigation for direct urls', async () => {\n    const browser = await webdriver(next.url, '/')\n\n    try {\n      // Click the link on the page, we expect that there will be a hard\n      // navigation later (we do this be checking that the window global is\n      // unset).\n      await browser.eval('window.beforeNav = \"hi\"')\n      await browser.elementById('direct').click()\n      await check(() => browser.eval('window.beforeNav'), {\n        test: (content) => content !== 'hi',\n      })\n\n      // Check to see that we were in fact navigated to the correct page.\n      const pathname = await browser.eval('window.location.pathname')\n      expect(pathname).toBe('/api/json')\n\n      // Check to see that the resulting data is coming from the right endpoint.\n      const text = await browser.eval(\n        'window.document.documentElement.innerText'\n      )\n      expect(text).toBe('{\"from\":\"\"}')\n    } finally {\n      await browser.close()\n    }\n  })","file":"e2e/link-with-api-rewrite/index.test.ts","skipped":false,"dir":"test"},{"name":"should skip deploy","suites":["manual-client-base-path"],"updatePoint":{"line":12,"column":26},"line":12,"code":"    it('should skip deploy', () => {})","file":"e2e/manual-client-base-path/index.test.ts","skipped":false,"dir":"test"},{"name":"should not warn for flag in output","suites":["manual-client-base-path"],"updatePoint":{"line":101,"column":40},"line":101,"code":"  it('should not warn for flag in output', async () => {\n    await renderViaHTTP(next.url, '/')\n    expect(next.cliOutput).not.toContain('exist in this version of Next.js')\n  })","file":"e2e/manual-client-base-path/index.test.ts","skipped":false,"dir":"test"},{"name":"should not update with basePath on mount ","suites":["manual-client-base-path"],"updatePoint":{"line":113,"column":58},"line":113,"code":"    it(`should not update with basePath on mount ${asPath}`, async () => {\n      const fullAsPath = (asPath as string) + '?update=1'\n      const browser = await webdriver(appPort, fullAsPath)\n      await browser.eval('window.beforeNav = 1')\n\n      expect(await browser.eval('window.location.pathname')).toBe(asPath)\n      expect(await browser.eval('window.location.search')).toBe('?update=1')\n\n      await check(async () => {\n        assert.deepEqual(\n          JSON.parse(await browser.elementByCss('#router').text()),\n          {\n            asPath: fullAsPath,\n            pathname: pathname || asPath,\n            query: {\n              update: '1',\n              ...((query as any) || {}),\n            },\n            basePath,\n          }\n        )\n        return 'success'\n      }, 'success')\n\n      await waitFor(5 * 1000)\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n    })","file":"e2e/manual-client-base-path/index.test.ts","skipped":false,"dir":"test"},{"name":"should navigate correctly from index","suites":["manual-client-base-path"],"updatePoint":{"line":142,"column":42},"line":142,"code":"  it('should navigate correctly from index', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.eval('window.beforeNav = 1')\n\n    await browser.elementByCss('#to-another').click()\n    await check(() => browser.elementByCss('#page').text(), 'another page')\n    expect(await browser.eval('window.location.pathname')).toBe('/another')\n\n    await browser.back()\n    await check(() => browser.elementByCss('#page').text(), 'index page')\n    expect(await browser.eval('window.location.pathname')).toBe('/')\n\n    await browser.forward()\n    await check(() => browser.elementByCss('#page').text(), 'another page')\n    expect(await browser.eval('window.location.pathname')).toBe('/another')\n\n    await browser.back()\n    await check(() => browser.elementByCss('#page').text(), 'index page')\n    expect(await browser.eval('window.location.pathname')).toBe('/')\n\n    await browser.elementByCss('#to-dynamic').click()\n    await check(() => browser.elementByCss('#page').text(), 'dynamic page')\n    expect(await browser.eval('window.location.pathname')).toBe(\n      '/dynamic/first'\n    )\n\n    await browser.back()\n    await check(() => browser.elementByCss('#page').text(), 'index page')\n    expect(await browser.eval('window.location.pathname')).toBe('/')\n\n    await browser.forward()\n    await check(() => browser.elementByCss('#page').text(), 'dynamic page')\n    expect(await browser.eval('window.location.pathname')).toBe(\n      '/dynamic/first'\n    )\n\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n  })","file":"e2e/manual-client-base-path/index.test.ts","skipped":false,"dir":"test"},{"name":"should navigate correctly from another","suites":["manual-client-base-path"],"updatePoint":{"line":181,"column":44},"line":181,"code":"  it('should navigate correctly from another', async () => {\n    const browser = await webdriver(appPort, '/another')\n    await browser.eval('window.beforeNav = 1')\n\n    await browser.elementByCss('#to-index').click()\n    await check(() => browser.elementByCss('#page').text(), 'index page')\n    expect(await browser.eval('window.location.pathname')).toBe('/')\n\n    await browser.elementByCss('#to-dynamic').click()\n    await check(() => browser.elementByCss('#page').text(), 'dynamic page')\n    expect(await browser.eval('window.location.pathname')).toBe(\n      '/dynamic/first'\n    )\n\n    await browser.elementByCss('#to-dynamic').click()\n    await check(\n      () => browser.eval('window.location.pathname'),\n      '/dynamic/second'\n    )\n\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n  })","file":"e2e/manual-client-base-path/index.test.ts","skipped":false,"dir":"test"},{"name":"should execute from absolute paths","suites":["Middleware base tests"],"updatePoint":{"line":23,"column":40},"line":23,"code":"  it('should execute from absolute paths', async () => {\n    const browser = await webdriver(next.url, '/redirect-with-basepath')\n    try {\n      expect(await browser.eval(`window.location.pathname`)).toBe(\n        '/root/redirect-with-basepath'\n      )\n    } finally {\n      await browser.close()\n    }\n\n    const res = await fetchViaHTTP(next.url, '/root/redirect-with-basepath')\n    const html = await res.text()\n    const $ = cheerio.load(html)\n    expect($('.title').text()).toBe('About Page')\n  })","file":"e2e/middleware-base-path/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not match","suites":["Middleware custom matchers basePath"],"line":37,"code":"  it.each(['/hello', '/invalid/docs/hello'])(\n    'should not match',\n    async (path) => {\n      const res = await fetchViaHTTP(next.url, path)\n      expect(res.status).toBe(404)\n    }\n  )","file":"e2e/middleware-custom-matchers-basepath/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should match","suites":["Middleware custom matchers i18n"],"line":24,"code":"  it.each(['/hello', '/en/hello', '/nl-NL/hello', '/nl-NL/about'])(\n    'should match',\n    async (path) => {\n      const res = await fetchViaHTTP(next.url, path)\n      expect(res.status).toBe(200)\n      expect(res.headers.get('x-from-middleware')).toBeDefined()\n    }\n  )","file":"e2e/middleware-custom-matchers-i18n/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not match","suites":["Middleware custom matchers i18n"],"line":33,"code":"  it.each(['/invalid/hello', '/hello/invalid', '/about', '/en/about'])(\n    'should not match',\n    async (path) => {\n      const res = await fetchViaHTTP(next.url, path)\n      expect(res.status).toBe(404)\n    }\n  )","file":"e2e/middleware-custom-matchers-i18n/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should match has query on client routing","suites":["Middleware custom matchers i18n"],"line":43,"code":"  itif(!isModeDeploy).each(['hello', 'en_hello', 'nl-NL_hello', 'nl-NL_about'])(\n    'should match has query on client routing',\n    async (id) => {\n      const browser = await webdriver(next.url, '/routes')\n      await browser.eval('window.__TEST_NO_RELOAD = true')\n      await browser.elementById(id).click()\n      const fromMiddleware = await browser.elementById('from-middleware').text()\n      expect(fromMiddleware).toBe('true')\n      const noReload = await browser.eval('window.__TEST_NO_RELOAD')\n      expect(noReload).toBe(true)\n    }\n  )","file":"e2e/middleware-custom-matchers-i18n/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should match source path","suites":["Middleware custom matchers"],"updatePoint":{"line":24,"column":32},"line":24,"code":"    it('should match source path', async () => {\n      const res = await fetchViaHTTP(next.url, '/source-match')\n      expect(res.status).toBe(200)\n      expect(res.headers.get('x-from-middleware')).toBeDefined()\n    })","file":"e2e/middleware-custom-matchers/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should match has header","suites":["Middleware custom matchers"],"updatePoint":{"line":30,"column":31},"line":30,"code":"    it('should match has header', async () => {\n      const res = await fetchViaHTTP(next.url, '/has-match-1', undefined, {\n        headers: {\n          'x-my-header': 'hello world!!',\n        },\n      })\n      expect(res.status).toBe(200)\n      expect(res.headers.get('x-from-middleware')).toBeDefined()\n\n      const res2 = await fetchViaHTTP(next.url, '/has-match-1')\n      expect(res2.status).toBe(404)\n    })","file":"e2e/middleware-custom-matchers/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should match has query","suites":["Middleware custom matchers"],"updatePoint":{"line":43,"column":30},"line":43,"code":"    it('should match has query', async () => {\n      const res = await fetchViaHTTP(next.url, '/has-match-2', {\n        'my-query': 'hellooo',\n      })\n      expect(res.status).toBe(200)\n      expect(res.headers.get('x-from-middleware')).toBeDefined()\n\n      const res2 = await fetchViaHTTP(next.url, '/has-match-2')\n      expect(res2.status).toBe(404)\n    })","file":"e2e/middleware-custom-matchers/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should match has cookie","suites":["Middleware custom matchers"],"updatePoint":{"line":54,"column":31},"line":54,"code":"    it('should match has cookie', async () => {\n      const res = await fetchViaHTTP(next.url, '/has-match-3', undefined, {\n        headers: {\n          cookie: 'loggedIn=true',\n        },\n      })\n      expect(res.status).toBe(200)\n      expect(res.headers.get('x-from-middleware')).toBeDefined()\n\n      const res2 = await fetchViaHTTP(next.url, '/has-match-3', undefined, {\n        headers: {\n          cookie: 'loggedIn=false',\n        },\n      })\n      expect(res2.status).toBe(404)\n    })","file":"e2e/middleware-custom-matchers/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should match has header value","suites":["Middleware custom matchers"],"updatePoint":{"line":93,"column":37},"line":93,"code":"    it('should match has header value', async () => {\n      const res = await fetchViaHTTP(next.url, '/has-match-5', undefined, {\n        headers: {\n          hasParam: 'with-params',\n        },\n      })\n      expect(res.status).toBe(200)\n      expect(res.headers.get('x-from-middleware')).toBeDefined()\n\n      const res2 = await fetchViaHTTP(next.url, '/has-match-5', undefined, {\n        headers: {\n          hasParam: 'without-params',\n        },\n      })\n      expect(res2.status).toBe(404)\n    })","file":"e2e/middleware-custom-matchers/test/index.test.ts","skipped":false,"dir":"test"},{"name":"passes the method on a direct fetch request","suites":["Middleware fetches with any HTTP method"],"updatePoint":{"line":50,"column":49},"line":50,"code":"  it('passes the method on a direct fetch request', async () => {\n    const response = await fetchViaHTTP(\n      next.url,\n      '/api/ping',\n      {},\n      { method: 'POST' }\n    )\n    const json = await response.json()\n    expect(json).toMatchObject({\n      method: 'POST',\n    })\n\n    const headerJson = JSON.parse(response.headers.get('x-resolved'))\n    expect(headerJson).toMatchObject({\n      method: 'POST',\n      headers: {\n        'x-kind': 'normal-fetch',\n      },\n    })\n  })","file":"e2e/middleware-fetches-with-any-http-method/index.test.ts","skipped":false,"dir":"test"},{"name":"passes the method when providing a Request object","suites":["Middleware fetches with any HTTP method"],"updatePoint":{"line":71,"column":55},"line":71,"code":"  it('passes the method when providing a Request object', async () => {\n    const response = await fetchViaHTTP(\n      next.url,\n      '/api/ping',\n      { kind: 'new-request' },\n      { method: 'POST' }\n    )\n    const json = await response.json()\n    expect(json).toMatchObject({\n      method: 'POST',\n    })\n\n    const headerJson = JSON.parse(response.headers.get('x-resolved'))\n    expect(headerJson).toMatchObject({\n      method: 'POST',\n      headers: {\n        'x-kind': 'new-request',\n      },\n    })\n  })","file":"e2e/middleware-fetches-with-any-http-method/index.test.ts","skipped":false,"dir":"test"},{"name":"refreshes the page when middleware changes ","suites":["Middleware Runtime"],"updatePoint":{"line":75,"column":53},"line":75,"code":"      it('refreshes the page when middleware changes ', async () => {\n        const browser = await webdriver(next.url, `/about`)\n        await browser.eval('window.didrefresh = \"hello\"')\n        const text = await browser.elementByCss('h1').text()\n        expect(text).toEqual('AboutA')\n\n        const middlewarePath = join(next.testDir, '/middleware.js')\n        const originalContent = fs.readFileSync(middlewarePath, 'utf-8')\n        const editedContent = originalContent.replace('/about/a', '/about/b')\n\n        try {\n          fs.writeFileSync(middlewarePath, editedContent)\n          await waitFor(1000)\n          const textb = await browser.elementByCss('h1').text()\n          expect(await browser.eval('window.itdidnotrefresh')).not.toBe('hello')\n          expect(textb).toEqual('AboutB')\n        } finally {\n          fs.writeFileSync(middlewarePath, originalContent)\n          await browser.close()\n        }\n      })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should only contain middleware route in dev middleware manifest","suites":["Middleware Runtime"],"updatePoint":{"line":97,"column":73},"line":97,"code":"      it('should only contain middleware route in dev middleware manifest', async () => {\n        const res = await fetchViaHTTP(\n          next.url,\n          `/_next/static/${next.buildId}/_devMiddlewareManifest.json`\n        )\n        const matchers = await res.json()\n        expect(matchers).toEqual([{ regexp: '.*' }])\n      })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have valid middleware field in manifest","suites":["Middleware Runtime"],"updatePoint":{"line":108,"column":56},"line":108,"code":"      it('should have valid middleware field in manifest', async () => {\n        const manifest = await fs.readJSON(\n          join(next.testDir, '.next/server/middleware-manifest.json')\n        )\n        expect(manifest.middleware).toEqual({\n          '/': {\n            env: [\n              'MIDDLEWARE_TEST',\n              'ANOTHER_MIDDLEWARE_TEST',\n              'STRING_ENV_VAR',\n            ],\n            files: expect.arrayContaining([\n              'server/edge-runtime-webpack.js',\n              'server/middleware.js',\n            ]),\n            name: 'middleware',\n            page: '/',\n            matchers: [{ regexp: '^/.*$' }],\n            wasm: [],\n            assets: [],\n          },\n        })\n      })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct files in manifest","suites":["Middleware Runtime"],"updatePoint":{"line":132,"column":47},"line":132,"code":"      it('should have correct files in manifest', async () => {\n        const manifest = await fs.readJSON(\n          join(next.testDir, '.next/server/middleware-manifest.json')\n        )\n        for (const key of Object.keys(manifest.middleware)) {\n          const middleware = manifest.middleware[key]\n          expect(middleware.files).toContainEqual(\n            expect.stringContaining('server/edge-runtime-webpack')\n          )\n          expect(middleware.files).not.toContainEqual(\n            expect.stringContaining('static/chunks/')\n          )\n        }\n      })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not run middleware for on-demand revalidate","suites":["Middleware Runtime"],"updatePoint":{"line":147,"column":60},"line":147,"code":"      it('should not run middleware for on-demand revalidate', async () => {\n        const bypassToken = (\n          await fs.readJSON(join(next.testDir, '.next/prerender-manifest.json'))\n        ).preview.previewModeId\n\n        const res = await fetchViaHTTP(next.url, '/ssg/first', undefined, {\n          headers: {\n            'x-prerender-revalidate': bypassToken,\n          },\n        })\n        expect(res.status).toBe(200)\n        expect(res.headers.get('x-middleware')).toBeFalsy()\n        expect(res.headers.get('x-nextjs-cache')).toBe('REVALIDATED')\n      })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"passes search params with rewrites","suites":["Middleware Runtime"],"updatePoint":{"line":163,"column":42},"line":163,"code":"    it('passes search params with rewrites', async () => {\n      const response = await fetchViaHTTP(next.url, `/api/edge-search-params`, {\n        a: 'b',\n      })\n      await expect(response.json()).resolves.toMatchObject({\n        a: 'b',\n        // included from middleware\n        foo: 'bar',\n      })\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have init header for NextResponse.redirect","suites":["Middleware Runtime"],"updatePoint":{"line":174,"column":57},"line":174,"code":"    it('should have init header for NextResponse.redirect', async () => {\n      const res = await fetchViaHTTP(\n        next.url,\n        '/redirect-to-somewhere',\n        undefined,\n        {\n          redirect: 'manual',\n        }\n      )\n      expect(res.status).toBe(307)\n      expect(new URL(res.headers.get('location'), 'http://n').pathname).toBe(\n        '/somewhere'\n      )\n      expect(res.headers.get('x-redirect-header')).toBe('hi')\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct query values for rewrite to ssg page","suites":["Middleware Runtime"],"updatePoint":{"line":190,"column":64},"line":190,"code":"    it('should have correct query values for rewrite to ssg page', async () => {\n      const browser = await webdriver(next.url, '/to-ssg')\n      await browser.eval('window.beforeNav = 1')\n\n      await check(() => browser.elementByCss('body').text(), /\\/to-ssg/)\n\n      expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n        slug: 'hello',\n        from: 'middleware',\n      })\n      expect(\n        JSON.parse(await browser.elementByCss('#props').text()).params\n      ).toEqual({\n        slug: 'hello',\n      })\n      expect(await browser.elementByCss('#pathname').text()).toBe('/ssg/[slug]')\n      expect(await browser.elementByCss('#as-path').text()).toBe('/to-ssg')\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct dynamic route params on client-transition to dynamic route","suites":["Middleware Runtime"],"updatePoint":{"line":209,"column":86},"line":209,"code":"    it('should have correct dynamic route params on client-transition to dynamic route', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.eval('window.beforeNav = 1')\n      await browser.eval('window.next.router.push(\"/blog/first\")')\n      await browser.waitForElementByCss('#blog')\n\n      expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n        slug: 'first',\n      })\n      expect(\n        JSON.parse(await browser.elementByCss('#props').text()).params\n      ).toEqual({\n        slug: 'first',\n      })\n      expect(await browser.elementByCss('#pathname').text()).toBe(\n        '/blog/[slug]'\n      )\n      expect(await browser.elementByCss('#as-path').text()).toBe('/blog/first')\n\n      await browser.eval('window.next.router.push(\"/blog/second\")')\n      await check(() => browser.elementByCss('body').text(), /\"slug\":\"second\"/)\n\n      expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n        slug: 'second',\n      })\n      expect(\n        JSON.parse(await browser.elementByCss('#props').text()).params\n      ).toEqual({\n        slug: 'second',\n      })\n      expect(await browser.elementByCss('#pathname').text()).toBe(\n        '/blog/[slug]'\n      )\n      expect(await browser.elementByCss('#as-path').text()).toBe('/blog/second')\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct dynamic route params for middleware rewrite to dynamic route","suites":["Middleware Runtime"],"updatePoint":{"line":245,"column":88},"line":245,"code":"    it('should have correct dynamic route params for middleware rewrite to dynamic route', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.eval('window.beforeNav = 1')\n      await browser.eval('window.next.router.push(\"/rewrite-to-dynamic\")')\n      await browser.waitForElementByCss('#blog')\n\n      expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n        slug: 'from-middleware',\n        some: 'middleware',\n      })\n      expect(\n        JSON.parse(await browser.elementByCss('#props').text()).params\n      ).toEqual({\n        slug: 'from-middleware',\n      })\n      expect(await browser.elementByCss('#pathname').text()).toBe(\n        '/blog/[slug]'\n      )\n      expect(await browser.elementByCss('#as-path').text()).toBe(\n        '/rewrite-to-dynamic'\n      )\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct route params for chained rewrite from middleware to config rewrite","suites":["Middleware Runtime"],"updatePoint":{"line":268,"column":94},"line":268,"code":"    it('should have correct route params for chained rewrite from middleware to config rewrite', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.eval('window.beforeNav = 1')\n      await browser.eval(\n        'window.next.router.push(\"/rewrite-to-config-rewrite\")'\n      )\n      await browser.waitForElementByCss('#blog')\n\n      expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n        slug: 'middleware-rewrite',\n        hello: 'config',\n        some: 'middleware',\n      })\n      expect(\n        JSON.parse(await browser.elementByCss('#props').text()).params\n      ).toEqual({\n        slug: 'middleware-rewrite',\n      })\n      expect(await browser.elementByCss('#pathname').text()).toBe(\n        '/blog/[slug]'\n      )\n      expect(await browser.elementByCss('#as-path').text()).toBe(\n        '/rewrite-to-config-rewrite'\n      )\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct route params for rewrite from config dynamic route","suites":["Middleware Runtime"],"updatePoint":{"line":294,"column":78},"line":294,"code":"    it('should have correct route params for rewrite from config dynamic route', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.eval('window.beforeNav = 1')\n      await browser.eval('window.next.router.push(\"/rewrite-3\")')\n      await browser.waitForElementByCss('#blog')\n\n      expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n        slug: 'middleware-rewrite',\n        hello: 'config',\n      })\n      expect(\n        JSON.parse(await browser.elementByCss('#props').text()).params\n      ).toEqual({\n        slug: 'middleware-rewrite',\n      })\n      expect(await browser.elementByCss('#pathname').text()).toBe(\n        '/blog/[slug]'\n      )\n      expect(await browser.elementByCss('#as-path').text()).toBe('/rewrite-3')\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct route params for rewrite from config non-dynamic route","suites":["Middleware Runtime"],"updatePoint":{"line":315,"column":82},"line":315,"code":"    it('should have correct route params for rewrite from config non-dynamic route', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.eval('window.beforeNav = 1')\n      await browser.eval('window.next.router.push(\"/rewrite-1\")')\n\n      await check(\n        () => browser.eval('document.documentElement.innerHTML'),\n        /Hello World/\n      )\n\n      expect(await browser.eval('window.next.router.query')).toEqual({\n        from: 'config',\n      })\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should redirect the same for direct visit and client-transition","suites":["Middleware Runtime"],"updatePoint":{"line":330,"column":71},"line":330,"code":"    it('should redirect the same for direct visit and client-transition', async () => {\n      const res = await fetchViaHTTP(next.url, `/redirect-1`, undefined, {\n        redirect: 'manual',\n      })\n      expect(res.status).toBe(307)\n      expect(new URL(res.headers.get('location'), 'http://n').pathname).toBe(\n        '/somewhere/else'\n      )\n\n      const browser = await webdriver(next.url, `/`)\n      await browser.eval(`next.router.push('/redirect-1')`)\n      await check(async () => {\n        const pathname = await browser.eval('location.pathname')\n        return pathname === '/somewhere/else' ? 'success' : pathname\n      }, 'success')\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should rewrite the same for direct visit and client-transition","suites":["Middleware Runtime"],"updatePoint":{"line":347,"column":70},"line":347,"code":"    it('should rewrite the same for direct visit and client-transition', async () => {\n      const res = await fetchViaHTTP(next.url, `/rewrite-1`)\n      expect(res.status).toBe(200)\n      expect(await res.text()).toContain('Hello World')\n\n      const browser = await webdriver(next.url, `/`)\n      await browser.eval('window.beforeNav = 1')\n      await browser.eval(`next.router.push('/rewrite-1')`)\n      await check(async () => {\n        const content = await browser.eval('document.documentElement.innerHTML')\n        return content.includes('Hello World') ? 'success' : content\n      }, 'success')\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should rewrite correctly for non-SSG/SSP page","suites":["Middleware Runtime"],"updatePoint":{"line":362,"column":53},"line":362,"code":"    it('should rewrite correctly for non-SSG/SSP page', async () => {\n      const res = await fetchViaHTTP(next.url, `/rewrite-2`)\n      expect(res.status).toBe(200)\n      expect(await res.text()).toContain('AboutA')\n\n      const browser = await webdriver(next.url, `/`)\n      await browser.eval(`next.router.push('/rewrite-2')`)\n      await check(async () => {\n        const content = await browser.eval('document.documentElement.innerHTML')\n        return content.includes('AboutA') ? 'success' : content\n      }, 'success')\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should respond with 400 on decode failure","suites":["Middleware Runtime"],"updatePoint":{"line":375,"column":49},"line":375,"code":"    it('should respond with 400 on decode failure', async () => {\n      const res = await fetchViaHTTP(next.url, `/%2`)\n      expect(res.status).toBe(400)\n\n      if ((global as any).isNextStart) {\n        expect(await res.text()).toContain('Bad Request')\n      }\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should set fetch user agent correctly","suites":["Middleware Runtime"],"updatePoint":{"line":386,"column":47},"line":386,"code":"      it('should set fetch user agent correctly', async () => {\n        const res = await fetchViaHTTP(next.url, `/fetch-user-agent-default`)\n\n        expect(readMiddlewareJSON(res).headers['user-agent']).toBe(\n          'Next.js Middleware'\n        )\n\n        const res2 = await fetchViaHTTP(next.url, `/fetch-user-agent-crypto`)\n        expect(readMiddlewareJSON(res2).headers['user-agent']).toBe(\n          'custom-agent'\n        )\n      })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should contain process polyfill","suites":["Middleware Runtime"],"updatePoint":{"line":400,"column":39},"line":400,"code":"    it('should contain process polyfill', async () => {\n      const res = await fetchViaHTTP(next.url, `/global`)\n      expect(readMiddlewareJSON(res)).toEqual({\n        process: {\n          env: {\n            ANOTHER_MIDDLEWARE_TEST: 'asdf2',\n            STRING_ENV_VAR: 'asdf3',\n            MIDDLEWARE_TEST: 'asdf',\n            ...((global as any).isNextDeploy\n              ? {}\n              : {\n                  NEXT_RUNTIME: 'edge',\n                }),\n          },\n        },\n      })\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should contain \\`globalThis\\`","suites":["Middleware Runtime"],"updatePoint":{"line":418,"column":37},"line":418,"code":"    it(`should contain \\`globalThis\\``, async () => {\n      const res = await fetchViaHTTP(next.url, '/globalthis')\n      expect(readMiddlewareJSON(res).length > 0).toBe(true)\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should contain crypto APIs","suites":["Middleware Runtime"],"updatePoint":{"line":423,"column":34},"line":423,"code":"    it(`should contain crypto APIs`, async () => {\n      const res = await fetchViaHTTP(next.url, '/webcrypto')\n      expect('error' in readMiddlewareJSON(res)).toBe(false)\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should accept a URL instance for fetch","suites":["Middleware Runtime"],"updatePoint":{"line":429,"column":48},"line":429,"code":"      it(`should accept a URL instance for fetch`, async () => {\n        const response = await fetchViaHTTP(next.url, '/fetch-url')\n        // TODO: why is an error expected here if it should work?\n        const { error } = readMiddlewareJSON(response)\n        expect(error).toBeTruthy()\n        expect(error.message).not.toContain(\"Failed to construct 'URL'\")\n      })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should allow to abort a fetch request","suites":["Middleware Runtime"],"updatePoint":{"line":438,"column":45},"line":438,"code":"    it(`should allow to abort a fetch request`, async () => {\n      const response = await fetchViaHTTP(next.url, '/abort-controller')\n      const payload = readMiddlewareJSON(response)\n      expect('error' in payload).toBe(true)\n      expect(payload.error.name).toBe('AbortError')\n      expect(payload.error.message).toBe('The operation was aborted')\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should validate & parse request url from any route","suites":["Middleware Runtime"],"updatePoint":{"line":446,"column":58},"line":446,"code":"    it(`should validate & parse request url from any route`, async () => {\n      const res = await fetchViaHTTP(next.url, `/static`)\n\n      expect(res.headers.get('req-url-basepath')).toBeFalsy()\n      expect(res.headers.get('req-url-pathname')).toBe('/static')\n\n      const { pathname, params } = JSON.parse(res.headers.get('req-url-params'))\n      expect(pathname).toBe(undefined)\n      expect(params).toEqual(undefined)\n\n      expect(res.headers.get('req-url-query')).not.toBe('bar')\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should validate & parse request url from a dynamic route with params","suites":["Middleware Runtime"],"updatePoint":{"line":460,"column":78},"line":460,"code":"      it(`should validate & parse request url from a dynamic route with params`, async () => {\n        const res = await fetchViaHTTP(next.url, `/fr/1`)\n\n        expect(res.headers.get('req-url-basepath')).toBeFalsy()\n        expect(res.headers.get('req-url-pathname')).toBe('/1')\n\n        const { pathname, params } = JSON.parse(\n          res.headers.get('req-url-params')\n        )\n        expect(pathname).toBe('/:locale/:id')\n        expect(params).toEqual({ locale: 'fr', id: '1' })\n\n        expect(res.headers.get('req-url-query')).not.toBe('bar')\n        expect(res.headers.get('req-url-locale')).toBe('fr')\n      })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should validate & parse request url from a dynamic route with params and no query","suites":["Middleware Runtime"],"updatePoint":{"line":476,"column":91},"line":476,"code":"      it(`should validate & parse request url from a dynamic route with params and no query`, async () => {\n        const res = await fetchViaHTTP(next.url, `/fr/abc123`)\n        expect(res.headers.get('req-url-basepath')).toBeFalsy()\n\n        const { pathname, params } = JSON.parse(\n          res.headers.get('req-url-params')\n        )\n        expect(pathname).toBe('/:locale/:id')\n        expect(params).toEqual({ locale: 'fr', id: 'abc123' })\n\n        expect(res.headers.get('req-url-query')).not.toBe('bar')\n        expect(res.headers.get('req-url-locale')).toBe('fr')\n      })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should validate & parse request url from a dynamic route with params and query","suites":["Middleware Runtime"],"updatePoint":{"line":491,"column":86},"line":491,"code":"    it(`should validate & parse request url from a dynamic route with params and query`, async () => {\n      const res = await fetchViaHTTP(next.url, `/abc123?foo=bar`)\n      expect(res.headers.get('req-url-basepath')).toBeFalsy()\n\n      const { pathname, params } = JSON.parse(res.headers.get('req-url-params'))\n\n      expect(pathname).toBe('/:id')\n      expect(params).toEqual({ id: 'abc123' })\n\n      expect(res.headers.get('req-url-query')).toBe('bar')\n\n      if (i18n) {\n        expect(res.headers.get('req-url-locale')).toBe('en')\n      }\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should throw when using URL with a relative URL","suites":["Middleware Runtime"],"updatePoint":{"line":507,"column":55},"line":507,"code":"    it('should throw when using URL with a relative URL', async () => {\n      const res = await fetchViaHTTP(next.url, `/url/relative-url`)\n      expect(readMiddlewareError(res)).toContain('Invalid URL')\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should throw when using NextRequest with a relative URL","suites":["Middleware Runtime"],"updatePoint":{"line":512,"column":63},"line":512,"code":"    it('should throw when using NextRequest with a relative URL', async () => {\n      const response = await fetchViaHTTP(\n        next.url,\n        `/url/relative-next-request`\n      )\n      expect(readMiddlewareError(response)).toContain(urlsError)\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should throw when using Request with a relative URL","suites":["Middleware Runtime"],"updatePoint":{"line":522,"column":61},"line":522,"code":"      it('should throw when using Request with a relative URL', async () => {\n        const response = await fetchViaHTTP(next.url, `/url/relative-request`)\n        expect(readMiddlewareError(response)).toContain(urlsError)\n      })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should warn when using Response.redirect with a relative URL","suites":["Middleware Runtime"],"updatePoint":{"line":527,"column":70},"line":527,"code":"      it('should warn when using Response.redirect with a relative URL', async () => {\n        const response = await fetchViaHTTP(next.url, `/url/relative-redirect`)\n        expect(readMiddlewareError(response)).toContain(urlsError)\n      })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should warn when using NextResponse.redirect with a relative URL","suites":["Middleware Runtime"],"updatePoint":{"line":533,"column":72},"line":533,"code":"    it('should warn when using NextResponse.redirect with a relative URL', async () => {\n      const response = await fetchViaHTTP(\n        next.url,\n        `/url/relative-next-redirect`\n      )\n      expect(readMiddlewareError(response)).toContain(urlsError)\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should throw when using NextResponse.rewrite with a relative URL","suites":["Middleware Runtime"],"updatePoint":{"line":541,"column":72},"line":541,"code":"    it('should throw when using NextResponse.rewrite with a relative URL', async () => {\n      const response = await fetchViaHTTP(\n        next.url,\n        `/url/relative-next-rewrite`\n      )\n      expect(readMiddlewareError(response)).toContain(urlsError)\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should trigger middleware for data requests","suites":["Middleware Runtime"],"updatePoint":{"line":549,"column":51},"line":549,"code":"    it('should trigger middleware for data requests', async () => {\n      const browser = await webdriver(next.url, `/ssr-page`)\n      const text = await browser.elementByCss('h1').text()\n      expect(text).toEqual('Bye Cruel World')\n      const res = await fetchViaHTTP(\n        next.url,\n        `/_next/data/${next.buildId}${i18n ? '/en' : ''}/ssr-page.json`\n      )\n      const json = await res.json()\n      expect(json.pageProps.message).toEqual('Bye Cruel World')\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should normalize data requests into page requests","suites":["Middleware Runtime"],"updatePoint":{"line":561,"column":57},"line":561,"code":"    it('should normalize data requests into page requests', async () => {\n      const res = await fetchViaHTTP(\n        next.url,\n        `/_next/data/${next.buildId}${i18n ? '/en' : ''}/send-url.json`\n      )\n      expect(res.headers.get('req-url-path')).toEqual('/send-url')\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should keep non data requests in their original shape","suites":["Middleware Runtime"],"updatePoint":{"line":569,"column":61},"line":569,"code":"    it('should keep non data requests in their original shape', async () => {\n      const res = await fetchViaHTTP(\n        next.url,\n        `/_next/static/${next.buildId}/_devMiddlewareManifest.json?foo=1`\n      )\n      expect(res.headers.get('req-url-path')).toEqual(\n        `/_next/static/${next.buildId}/_devMiddlewareManifest.json?foo=1`\n      )\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should add a rewrite header on data requests for rewrites","suites":["Middleware Runtime"],"updatePoint":{"line":579,"column":65},"line":579,"code":"    it('should add a rewrite header on data requests for rewrites', async () => {\n      const res = await fetchViaHTTP(next.url, `/ssr-page`)\n      const dataRes = await fetchViaHTTP(\n        next.url,\n        `/_next/data/${next.buildId}${i18n ? '/en' : ''}/ssr-page.json`,\n        undefined,\n        { headers: { 'x-nextjs-data': '1' } }\n      )\n      const json = await dataRes.json()\n      expect(json.pageProps.message).toEqual('Bye Cruel World')\n      expect(res.headers.get('x-nextjs-matched-path')).toBeNull()\n      expect(dataRes.headers.get('x-nextjs-matched-path')).toEqual(\n        `${i18n ? '/en' : ''}/ssr-page-2`\n      )\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"hard-navigates when the data request failed","suites":["Middleware Runtime"],"updatePoint":{"line":595,"column":51},"line":595,"code":"    it(`hard-navigates when the data request failed`, async () => {\n      const browser = await webdriver(next.url, `/error`)\n      await browser.eval('window.__SAME_PAGE = true')\n      await browser.elementByCss('#throw-on-data').click()\n      await browser.waitForElementByCss('.refreshed')\n      expect(await browser.eval('window.__SAME_PAGE')).toBeUndefined()\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"allows shallow linking with middleware","suites":["Middleware Runtime"],"updatePoint":{"line":603,"column":46},"line":603,"code":"    it('allows shallow linking with middleware', async () => {\n      const browser = await webdriver(next.url, '/sha')\n      const getMessageContents = () =>\n        browser.elementById('message-contents').text()\n      const ssrMessage = await getMessageContents()\n      const requests: string[] = []\n\n      browser.on('request', (x) => {\n        requests.push(x.url())\n      })\n\n      browser.elementById('deep-link').click()\n      browser.waitForElementByCss('[data-query-hello=\"goodbye\"]')\n      const deepLinkMessage = await getMessageContents()\n      expect(deepLinkMessage).not.toEqual(ssrMessage)\n\n      // Changing the route with a shallow link should not cause a server request\n      browser.elementById('shallow-link').click()\n      browser.waitForElementByCss('[data-query-hello=\"world\"]')\n      expect(await getMessageContents()).toEqual(deepLinkMessage)\n\n      // Check that no server requests were made to ?hello=world,\n      // as it's a shallow request.\n      expect(requests).toEqual([\n        `${next.url}/_next/data/${next.buildId}${\n          i18n ? '/en' : ''\n        }/sha.json?hello=goodbye`,\n      ])\n    })","file":"e2e/middleware-general/test/index.test.ts","skipped":false,"dir":"test"},{"name":"does add the header for root request","suites":["Middleware can set the matcher in its config"],"updatePoint":{"line":19,"column":42},"line":19,"code":"  it('does add the header for root request', async () => {\n    const response = await fetchViaHTTP(next.url, '/')\n    expect(response.headers.get('X-From-Middleware')).toBe('true')\n    expect(await response.text()).toContain('root page')\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"adds the header for a matched path","suites":["Middleware can set the matcher in its config"],"updatePoint":{"line":25,"column":40},"line":25,"code":"  it('adds the header for a matched path', async () => {\n    const response = await fetchViaHTTP(next.url, '/with-middleware')\n    expect(response.headers.get('X-From-Middleware')).toBe('true')\n    expect(await response.text()).toContain('This should run the middleware')\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"adds the header for a matched data path (with header)","suites":["Middleware can set the matcher in its config"],"updatePoint":{"line":31,"column":59},"line":31,"code":"  it('adds the header for a matched data path (with header)', async () => {\n    const response = await fetchViaHTTP(\n      next.url,\n      `/_next/data/${next.buildId}/with-middleware.json`,\n      undefined,\n      { headers: { 'x-nextjs-data': '1' } }\n    )\n    expect(await response.json()).toMatchObject({\n      pageProps: {\n        message: 'Hello, cruel world.',\n      },\n    })\n    expect(response.headers.get('X-From-Middleware')).toBe('true')\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"adds the header for a matched data path (without header)","suites":["Middleware can set the matcher in its config"],"updatePoint":{"line":46,"column":62},"line":46,"code":"  it('adds the header for a matched data path (without header)', async () => {\n    const response = await fetchViaHTTP(\n      next.url,\n      `/_next/data/${next.buildId}/with-middleware.json`\n    )\n    expect(await response.json()).toMatchObject({\n      pageProps: {\n        message: 'Hello, cruel world.',\n      },\n    })\n    expect(response.headers.get('X-From-Middleware')).toBe('true')\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"adds the header for another matched path","suites":["Middleware can set the matcher in its config"],"updatePoint":{"line":59,"column":46},"line":59,"code":"  it('adds the header for another matched path', async () => {\n    const response = await fetchViaHTTP(next.url, '/another-middleware')\n    expect(response.headers.get('X-From-Middleware')).toBe('true')\n    expect(await response.text()).toContain(\n      'This should also run the middleware'\n    )\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"adds the header for another matched data path","suites":["Middleware can set the matcher in its config"],"updatePoint":{"line":67,"column":51},"line":67,"code":"  it('adds the header for another matched data path', async () => {\n    const response = await fetchViaHTTP(\n      next.url,\n      `/_next/data/${next.buildId}/another-middleware.json`,\n      undefined,\n      { headers: { 'x-nextjs-data': '1' } }\n    )\n    expect(await response.json()).toMatchObject({\n      pageProps: {\n        message: 'Hello, magnificent world.',\n      },\n    })\n    expect(response.headers.get('X-From-Middleware')).toBe('true')\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"does add the header for root data request","suites":["Middleware can set the matcher in its config"],"updatePoint":{"line":82,"column":47},"line":82,"code":"  it('does add the header for root data request', async () => {\n    const response = await fetchViaHTTP(\n      next.url,\n      `/_next/data/${next.buildId}/index.json`,\n      undefined,\n      { headers: { 'x-nextjs-data': '1' } }\n    )\n    expect(await response.json()).toMatchObject({\n      pageProps: {\n        message: 'Hello, world.',\n      },\n    })\n    expect(response.headers.get('X-From-Middleware')).toBe('true')\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"should load matches in client matchers correctly","suites":["Middleware can set the matcher in its config"],"updatePoint":{"line":97,"column":54},"line":97,"code":"  it('should load matches in client matchers correctly', async () => {\n    const browser = await webdriver(next.url, '/')\n\n    await check(async () => {\n      const matchers = await browser.eval(\n        (global as any).isNextDev\n          ? 'window.__DEV_MIDDLEWARE_MATCHERS'\n          : 'window.__MIDDLEWARE_MATCHERS'\n      )\n\n      return matchers &&\n        matchers.some((m) => m.regexp.includes('with-middleware')) &&\n        matchers.some((m) => m.regexp.includes('another-middleware'))\n        ? 'success'\n        : 'failed'\n    }, 'success')\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"should navigate correctly with matchers","suites":["Middleware can set the matcher in its config"],"updatePoint":{"line":115,"column":45},"line":115,"code":"  it('should navigate correctly with matchers', async () => {\n    const browser = await webdriver(next.url, '/')\n    await browser.eval('window.beforeNav = 1')\n\n    await browser.elementByCss('#to-another-middleware').click()\n    await browser.waitForElementByCss('#another-middleware')\n\n    expect(JSON.parse(await browser.elementByCss('#props').text())).toEqual({\n      message: 'Hello, magnificent world.',\n    })\n\n    await browser.elementByCss('#to-index').click()\n    await browser.waitForElementByCss('#index')\n\n    await browser.elementByCss('#to-blog-slug-1').click()\n    await browser.waitForElementByCss('#blog')\n    expect(JSON.parse(await browser.elementByCss('#props').text())).toEqual({\n      message: 'Hello, magnificent world.',\n      params: {\n        slug: 'slug-1',\n      },\n    })\n\n    await browser.elementByCss('#to-blog-slug-2').click()\n    await check(\n      () => browser.eval('document.documentElement.innerHTML'),\n      /\"slug\":\"slug-2\"/\n    )\n    expect(JSON.parse(await browser.elementByCss('#props').text())).toEqual({\n      message: 'Hello, magnificent world.',\n      params: {\n        slug: 'slug-2',\n      },\n    })\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"does not add the header for root request","suites":["using a single matcher"],"updatePoint":{"line":190,"column":46},"line":190,"code":"  it('does not add the header for root request', async () => {\n    const response = await fetchViaHTTP(next.url, '/')\n    expect(response.headers.get('X-From-Middleware')).toBeFalsy()\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"does not add the header for root data request","suites":["using a single matcher"],"updatePoint":{"line":195,"column":51},"line":195,"code":"  it('does not add the header for root data request', async () => {\n    const response = await fetchViaHTTP(\n      next.url,\n      `/_next/data/${next.buildId}/index.json`,\n      undefined,\n      { headers: { 'x-nextjs-data': '1' } }\n    )\n    expect(response.headers.get('X-From-Middleware')).toBeFalsy()\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"adds the header for a matched path","suites":["using a single matcher"],"updatePoint":{"line":205,"column":40},"line":205,"code":"  it('adds the header for a matched path', async () => {\n    const response = await fetchViaHTTP(next.url, '/middleware/works')\n    expect(await response.text()).toContain('Hello from /middleware/works')\n    expect(response.headers.get('X-From-Middleware')).toBe('true')\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"adds the headers for a matched data path (with header)","suites":["using a single matcher"],"updatePoint":{"line":211,"column":60},"line":211,"code":"  it('adds the headers for a matched data path (with header)', async () => {\n    const response = await fetchViaHTTP(\n      next.url,\n      `/_next/data/${next.buildId}/middleware/works.json`,\n      undefined,\n      { headers: { 'x-nextjs-data': '1' } }\n    )\n    expect(await response.json()).toMatchObject({\n      pageProps: {\n        message: 'Hello from /middleware/works',\n      },\n    })\n    expect(response.headers.get('X-From-Middleware')).toBe('true')\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"adds the header for a matched data path (without header)","suites":["using a single matcher"],"updatePoint":{"line":226,"column":62},"line":226,"code":"  it('adds the header for a matched data path (without header)', async () => {\n    const response = await fetchViaHTTP(\n      next.url,\n      `/_next/data/${next.buildId}/middleware/works.json`\n    )\n    expect(await response.json()).toMatchObject({\n      pageProps: {\n        message: 'Hello from /middleware/works',\n      },\n    })\n    expect(response.headers.get('X-From-Middleware')).toBe('true')\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"does not add the header for an unmatched path","suites":["using a single matcher"],"updatePoint":{"line":239,"column":51},"line":239,"code":"  it('does not add the header for an unmatched path', async () => {\n    const response = await fetchViaHTTP(next.url, '/about/me')\n    expect(await response.text()).toContain('Hello from /about/me')\n    expect(response.headers.get('X-From-Middleware')).toBeNull()\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"adds the header to the /","suites":["using root matcher"],"updatePoint":{"line":280,"column":30},"line":280,"code":"  it('adds the header to the /', async () => {\n    const response = await fetchViaHTTP(next.url, '/')\n    expect(response.status).toBe(200)\n    expect(Object.fromEntries(response.headers)).toMatchObject({\n      'x-from-middleware': 'true',\n    })\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"adds the header to the /index","suites":["using root matcher"],"updatePoint":{"line":288,"column":35},"line":288,"code":"  it('adds the header to the /index', async () => {\n    const response = await fetchViaHTTP(next.url, '/index')\n    expect(Object.fromEntries(response.headers)).toMatchObject({\n      'x-from-middleware': 'true',\n    })\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"adds the header for a matched data path (with header)","suites":["using root matcher"],"updatePoint":{"line":295,"column":59},"line":295,"code":"  it('adds the header for a matched data path (with header)', async () => {\n    const response = await fetchViaHTTP(\n      next.url,\n      `/_next/data/${next.buildId}/index.json`,\n      undefined,\n      { headers: { 'x-nextjs-data': '1' } }\n    )\n    expect(await response.json()).toMatchObject({\n      pageProps: {\n        message: 'hello world',\n      },\n    })\n    expect(response.headers.get('X-From-Middleware')).toBe('true')\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"adds the header for a matched data path (without header)","suites":["using root matcher"],"updatePoint":{"line":310,"column":62},"line":310,"code":"  it('adds the header for a matched data path (without header)', async () => {\n    const response = await fetchViaHTTP(\n      next.url,\n      `/_next/data/${next.buildId}/index.json`\n    )\n    expect(await response.json()).toMatchObject({\n      pageProps: {\n        message: 'hello world',\n      },\n    })\n    expect(response.headers.get('X-From-Middleware')).toBe('true')\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"using a single matcher with i18n$title","suites":["using root matcher"],"line":324,"code":"describe.each([\n  { title: '' },\n  { title: ' and trailingSlash', trailingSlash: true },\n])('using a single matcher with i18n$title', ({ trailingSlash }) => {\n  let next: NextInstance\n  beforeAll(async () => {\n    next = await createNext({\n      files: {\n        'pages/index.js': `\n          export default function Page({ message }) {\n            return <div>\n              <p>{message}</p>\n            </div>\n          }\n          export const getServerSideProps = ({ params, locale }) => ({\n            props: { message: \\`(\\${locale}) Hello from /\\` }\n          })\n        `,\n        'pages/[...route].js': `\n          export default function Page({ message }) {\n            return <div>\n              <p>catchall page</p>\n              <p>{message}</p>\n            </div>\n          }\n          export const getServerSideProps = ({ params, locale }) => ({\n            props: { message: \\`(\\${locale}) Hello from /\\` + params.route.join(\"/\") }\n          })\n        `,\n        'middleware.js': `\n          import { NextResponse } from 'next/server'\n          export const config = { matcher: '/' };\n          export default (req) => {\n            const res = NextResponse.next();\n            res.headers.set('X-From-Middleware', 'true');\n            return res;\n          }\n        `,\n        'next.config.js': `\n          module.exports = {\n            ${trailingSlash ? 'trailingSlash: true,' : ''}\n            i18n: {\n              localeDetection: false,\n              locales: ['es', 'en'],\n              defaultLocale: 'en',\n            }\n          }\n        `,\n      },\n      dependencies: {},\n    })\n  })\n  afterAll(() => next.destroy())\n\n  it(`adds the header for a matched path`, async () => {\n    const res1 = await fetchViaHTTP(next.url, `/`)\n    expect(await res1.text()).toContain(`(en) Hello from /`)\n    expect(res1.headers.get('X-From-Middleware')).toBe('true')\n    const res2 = await fetchViaHTTP(next.url, `/es`)\n    expect(await res2.text()).toContain(`(es) Hello from /`)\n    expect(res2.headers.get('X-From-Middleware')).toBe('true')\n  })\n\n  it('adds the header for a mathed root path with /index', async () => {\n    const res1 = await fetchViaHTTP(next.url, `/index`)\n    expect(await res1.text()).toContain(`(en) Hello from /`)\n    expect(res1.headers.get('X-From-Middleware')).toBe('true')\n    const res2 = await fetchViaHTTP(next.url, `/es/index`)\n    expect(await res2.text()).toContain(`(es) Hello from /`)\n    expect(res2.headers.get('X-From-Middleware')).toBe('true')\n  })\n\n  it(`adds the headers for a matched data path`, async () => {\n    const res1 = await fetchViaHTTP(\n      next.url,\n      `/_next/data/${next.buildId}/en.json`,\n      undefined,\n      { headers: { 'x-nextjs-data': '1' } }\n    )\n    expect(await res1.json()).toMatchObject({\n      pageProps: { message: `(en) Hello from /` },\n    })\n    expect(res1.headers.get('X-From-Middleware')).toBe('true')\n    const res2 = await fetchViaHTTP(\n      next.url,\n      `/_next/data/${next.buildId}/es.json`,\n      undefined\n    )\n    expect(await res2.json()).toMatchObject({\n      pageProps: { message: `(es) Hello from /` },\n    })\n    expect(res2.headers.get('X-From-Middleware')).toBe('true')\n  })\n\n  it(`does not add the header for an unmatched path`, async () => {\n    const response = await fetchViaHTTP(next.url, `/about/me`)\n    expect(await response.text()).toContain('Hello from /about/me')\n    expect(response.headers.get('X-From-Middleware')).toBeNull()\n  })\n})","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"adds the header for a matched path","suites":["using root matcher"],"updatePoint":{"line":378,"column":40},"line":378,"code":"  it(`adds the header for a matched path`, async () => {\n    const res1 = await fetchViaHTTP(next.url, `/`)\n    expect(await res1.text()).toContain(`(en) Hello from /`)\n    expect(res1.headers.get('X-From-Middleware')).toBe('true')\n    const res2 = await fetchViaHTTP(next.url, `/es`)\n    expect(await res2.text()).toContain(`(es) Hello from /`)\n    expect(res2.headers.get('X-From-Middleware')).toBe('true')\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"adds the header for a mathed root path with /index","suites":["using root matcher"],"updatePoint":{"line":387,"column":56},"line":387,"code":"  it('adds the header for a mathed root path with /index', async () => {\n    const res1 = await fetchViaHTTP(next.url, `/index`)\n    expect(await res1.text()).toContain(`(en) Hello from /`)\n    expect(res1.headers.get('X-From-Middleware')).toBe('true')\n    const res2 = await fetchViaHTTP(next.url, `/es/index`)\n    expect(await res2.text()).toContain(`(es) Hello from /`)\n    expect(res2.headers.get('X-From-Middleware')).toBe('true')\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"adds the headers for a matched data path","suites":["using root matcher"],"updatePoint":{"line":396,"column":46},"line":396,"code":"  it(`adds the headers for a matched data path`, async () => {\n    const res1 = await fetchViaHTTP(\n      next.url,\n      `/_next/data/${next.buildId}/en.json`,\n      undefined,\n      { headers: { 'x-nextjs-data': '1' } }\n    )\n    expect(await res1.json()).toMatchObject({\n      pageProps: { message: `(en) Hello from /` },\n    })\n    expect(res1.headers.get('X-From-Middleware')).toBe('true')\n    const res2 = await fetchViaHTTP(\n      next.url,\n      `/_next/data/${next.buildId}/es.json`,\n      undefined\n    )\n    expect(await res2.json()).toMatchObject({\n      pageProps: { message: `(es) Hello from /` },\n    })\n    expect(res2.headers.get('X-From-Middleware')).toBe('true')\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"does not add the header for an unmatched path","suites":["using root matcher"],"updatePoint":{"line":418,"column":51},"line":418,"code":"  it(`does not add the header for an unmatched path`, async () => {\n    const response = await fetchViaHTTP(next.url, `/about/me`)\n    expect(await response.text()).toContain('Hello from /about/me')\n    expect(response.headers.get('X-From-Middleware')).toBeNull()\n  })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"using a single matcher with i18n and basePath$title","suites":["using root matcher"],"line":425,"code":"describe.each([\n  { title: '' },\n  { title: ' and trailingSlash', trailingSlash: true },\n])(\n  'using a single matcher with i18n and basePath$title',\n  ({ trailingSlash }) => {\n    let next: NextInstance\n    beforeAll(async () => {\n      next = await createNext({\n        files: {\n          'pages/index.js': `\n          export default function Page({ message }) {\n            return <div>\n              <p>root page</p>\n              <p>{message}</p>\n            </div>\n          }\n          export const getServerSideProps = ({ params, locale }) => ({\n            props: { message: \\`(\\${locale}) Hello from /\\` }\n          })\n        `,\n          'pages/[...route].js': `\n          export default function Page({ message }) {\n            return <div>\n              <p>catchall page</p>\n              <p>{message}</p>\n            </div>\n          }\n          export const getServerSideProps = ({ params, locale }) => ({\n            props: { message: \\`(\\${locale}) Hello from /\\` + params.route.join(\"/\") }\n          })\n        `,\n          'middleware.js': `\n          import { NextResponse } from 'next/server'\n          export const config = { matcher: '/' };\n          export default (req) => {\n            const res = NextResponse.next();\n            res.headers.set('X-From-Middleware', 'true');\n            return res;\n          }\n        `,\n          'next.config.js': `\n          module.exports = {\n            ${trailingSlash ? 'trailingSlash: true,' : ''}\n            basePath: '/root',\n            i18n: {\n              localeDetection: false,\n              locales: ['es', 'en'],\n              defaultLocale: 'en',\n            }\n          }\n        `,\n        },\n        dependencies: {},\n      })\n    })\n    afterAll(() => next.destroy())\n\n    it(`adds the header for a matched path`, async () => {\n      const res1 = await fetchViaHTTP(next.url, `/root`)\n      expect(await res1.text()).toContain(`(en) Hello from /`)\n      expect(res1.headers.get('X-From-Middleware')).toBe('true')\n      const res2 = await fetchViaHTTP(next.url, `/root/es`)\n      expect(await res2.text()).toContain(`(es) Hello from /`)\n      expect(res2.headers.get('X-From-Middleware')).toBe('true')\n    })\n\n    it('adds the header for a mathed root path with /index', async () => {\n      const res1 = await fetchViaHTTP(next.url, `/root/index`)\n      expect(await res1.text()).toContain(`(en) Hello from /`)\n      expect(res1.headers.get('X-From-Middleware')).toBe('true')\n      const res2 = await fetchViaHTTP(next.url, `/root/es/index`)\n      expect(await res2.text()).toContain(`(es) Hello from /`)\n      expect(res2.headers.get('X-From-Middleware')).toBe('true')\n    })\n\n    it(`adds the headers for a matched data path`, async () => {\n      const res1 = await fetchViaHTTP(\n        next.url,\n        `/root/_next/data/${next.buildId}/en.json`,\n        undefined,\n        { headers: { 'x-nextjs-data': '1' } }\n      )\n      expect(await res1.json()).toMatchObject({\n        pageProps: { message: `(en) Hello from /` },\n      })\n      expect(res1.headers.get('X-From-Middleware')).toBe('true')\n      const res2 = await fetchViaHTTP(\n        next.url,\n        `/root/_next/data/${next.buildId}/es.json`,\n        undefined,\n        { headers: { 'x-nextjs-data': '1' } }\n      )\n      expect(await res2.json()).toMatchObject({\n        pageProps: { message: `(es) Hello from /` },\n      })\n      expect(res2.headers.get('X-From-Middleware')).toBe('true')\n    })\n\n    it(`does not add the header for an unmatched path`, async () => {\n      const response = await fetchViaHTTP(next.url, `/root/about/me`)\n      expect(await response.text()).toContain('Hello from /about/me')\n      expect(response.headers.get('X-From-Middleware')).toBeNull()\n    })\n  }\n)","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"adds the header for a matched path","suites":["using root matcher"],"updatePoint":{"line":483,"column":42},"line":483,"code":"    it(`adds the header for a matched path`, async () => {\n      const res1 = await fetchViaHTTP(next.url, `/root`)\n      expect(await res1.text()).toContain(`(en) Hello from /`)\n      expect(res1.headers.get('X-From-Middleware')).toBe('true')\n      const res2 = await fetchViaHTTP(next.url, `/root/es`)\n      expect(await res2.text()).toContain(`(es) Hello from /`)\n      expect(res2.headers.get('X-From-Middleware')).toBe('true')\n    })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"adds the header for a mathed root path with /index","suites":["using root matcher"],"updatePoint":{"line":492,"column":58},"line":492,"code":"    it('adds the header for a mathed root path with /index', async () => {\n      const res1 = await fetchViaHTTP(next.url, `/root/index`)\n      expect(await res1.text()).toContain(`(en) Hello from /`)\n      expect(res1.headers.get('X-From-Middleware')).toBe('true')\n      const res2 = await fetchViaHTTP(next.url, `/root/es/index`)\n      expect(await res2.text()).toContain(`(es) Hello from /`)\n      expect(res2.headers.get('X-From-Middleware')).toBe('true')\n    })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"adds the headers for a matched data path","suites":["using root matcher"],"updatePoint":{"line":501,"column":48},"line":501,"code":"    it(`adds the headers for a matched data path`, async () => {\n      const res1 = await fetchViaHTTP(\n        next.url,\n        `/root/_next/data/${next.buildId}/en.json`,\n        undefined,\n        { headers: { 'x-nextjs-data': '1' } }\n      )\n      expect(await res1.json()).toMatchObject({\n        pageProps: { message: `(en) Hello from /` },\n      })\n      expect(res1.headers.get('X-From-Middleware')).toBe('true')\n      const res2 = await fetchViaHTTP(\n        next.url,\n        `/root/_next/data/${next.buildId}/es.json`,\n        undefined,\n        { headers: { 'x-nextjs-data': '1' } }\n      )\n      expect(await res2.json()).toMatchObject({\n        pageProps: { message: `(es) Hello from /` },\n      })\n      expect(res2.headers.get('X-From-Middleware')).toBe('true')\n    })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"does not add the header for an unmatched path","suites":["using root matcher"],"updatePoint":{"line":524,"column":53},"line":524,"code":"    it(`does not add the header for an unmatched path`, async () => {\n      const response = await fetchViaHTTP(next.url, `/root/about/me`)\n      expect(await response.text()).toContain('Hello from /about/me')\n      expect(response.headers.get('X-From-Middleware')).toBeNull()\n    })","file":"e2e/middleware-matcher/index.test.ts","skipped":false,"dir":"test"},{"name":"should redirect correctly with redirect in next.config.js","suites":["Middleware Redirect"],"updatePoint":{"line":24,"column":65},"line":24,"code":"    it('should redirect correctly with redirect in next.config.js', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.eval('window.beforeNav = 1')\n      await browser.eval('window.next.router.push(\"/to-new\")')\n      await browser.waitForElementByCss('#dynamic')\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n    })","file":"e2e/middleware-redirects/test/index.test.ts","skipped":false,"dir":"test"},{"name":"does not include the locale in redirects by default","suites":["Middleware Redirect"],"updatePoint":{"line":32,"column":59},"line":32,"code":"    it('does not include the locale in redirects by default', async () => {\n      const res = await fetchViaHTTP(next.url, `/old-home`, undefined, {\n        redirect: 'manual',\n      })\n      expect(res.headers.get('location')?.endsWith('/default/about')).toEqual(\n        false\n      )\n    })","file":"e2e/middleware-redirects/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should redirect to data urls with data requests and internal redirects","suites":["Middleware Redirect"],"updatePoint":{"line":41,"column":78},"line":41,"code":"    it(`should redirect to data urls with data requests and internal redirects`, async () => {\n      const res = await fetchViaHTTP(\n        next.url,\n        `/_next/data/${next.buildId}/es/old-home.json`,\n        { override: 'internal' },\n        { redirect: 'manual', headers: { 'x-nextjs-data': '1' } }\n      )\n\n      expect(\n        res.headers\n          .get('x-nextjs-redirect')\n          ?.endsWith(`/es/new-home?override=internal`)\n      ).toEqual(true)\n      expect(res.headers.get('location')).toEqual(null)\n    })","file":"e2e/middleware-redirects/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should redirect to external urls with data requests and external redirects","suites":["Middleware Redirect"],"updatePoint":{"line":57,"column":82},"line":57,"code":"    it(`should redirect to external urls with data requests and external redirects`, async () => {\n      const res = await fetchViaHTTP(\n        next.url,\n        `/_next/data/${next.buildId}/es/old-home.json`,\n        { override: 'external' },\n        { redirect: 'manual', headers: { 'x-nextjs-data': '1' } }\n      )\n\n      expect(res.headers.get('x-nextjs-redirect')).toEqual(\n        'https://example.vercel.sh/'\n      )\n      expect(res.headers.get('location')).toEqual(null)\n\n      const browser = await webdriver(next.url, '/')\n      await browser.elementByCss('#old-home-external').click()\n      await check(async () => {\n        expect(await browser.elementByCss('h1').text()).toEqual(\n          'Example Domain'\n        )\n        return 'yes'\n      }, 'yes')\n    })","file":"e2e/middleware-redirects/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should redirect","suites":["Middleware Redirect"],"updatePoint":{"line":84,"column":31},"line":84,"code":"    it(`${label}should redirect`, async () => {\n      const res = await fetchViaHTTP(next.url, `${locale}/old-home`)\n      const html = await res.text()\n      const $ = cheerio.load(html)\n      const browser = await webdriver(next.url, `${locale}/old-home`)\n      try {\n        expect(await browser.eval(`window.location.pathname`)).toBe(\n          `${locale}/new-home`\n        )\n      } finally {\n        await browser.close()\n      }\n      expect($('.title').text()).toBe('Welcome to a new page')\n    })","file":"e2e/middleware-redirects/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should implement internal redirects","suites":["Middleware Redirect"],"updatePoint":{"line":99,"column":51},"line":99,"code":"    it(`${label}should implement internal redirects`, async () => {\n      const browser = await webdriver(next.url, `${locale}`)\n      await browser.eval('window.__SAME_PAGE = true')\n      await browser.elementByCss('#old-home').click()\n      await browser.waitForElementByCss('#new-home-title')\n      expect(await browser.eval('window.__SAME_PAGE')).toBe(true)\n      try {\n        expect(await browser.eval(`window.location.pathname`)).toBe(\n          `${locale}/new-home`\n        )\n      } finally {\n        await browser.close()\n      }\n    })","file":"e2e/middleware-redirects/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should redirect cleanly with the original url param","suites":["Middleware Redirect"],"updatePoint":{"line":114,"column":67},"line":114,"code":"    it(`${label}should redirect cleanly with the original url param`, async () => {\n      const browser = await webdriver(next.url, `${locale}/blank-page?foo=bar`)\n      try {\n        expect(\n          await browser.eval(\n            `window.location.href.replace(window.location.origin, '')`\n          )\n        ).toBe(`${locale}/new-home`)\n      } finally {\n        await browser.close()\n      }\n    })","file":"e2e/middleware-redirects/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should redirect multiple times","suites":["Middleware Redirect"],"updatePoint":{"line":127,"column":46},"line":127,"code":"    it(`${label}should redirect multiple times`, async () => {\n      const res = await fetchViaHTTP(next.url, `${locale}/redirect-me-alot`)\n      const browser = await webdriver(next.url, `${locale}/redirect-me-alot`)\n      try {\n        expect(await browser.eval(`window.location.pathname`)).toBe(\n          `${locale}/new-home`\n        )\n      } finally {\n        await browser.close()\n      }\n      const html = await res.text()\n      const $ = cheerio.load(html)\n      expect($('.title').text()).toBe('Welcome to a new page')\n    })","file":"e2e/middleware-redirects/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should redirect (infinite-loop)","suites":["Middleware Redirect"],"updatePoint":{"line":142,"column":47},"line":142,"code":"    it(`${label}should redirect (infinite-loop)`, async () => {\n      await expect(\n        fetchViaHTTP(next.url, `${locale}/infinite-loop`)\n      ).rejects.toThrow()\n    })","file":"e2e/middleware-redirects/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should redirect to api route with locale","suites":["Middleware Redirect"],"updatePoint":{"line":148,"column":56},"line":148,"code":"    it(`${label}should redirect to api route with locale`, async () => {\n      const browser = await webdriver(next.url, `${locale}`)\n      await browser.elementByCss('#link-to-api-with-locale').click()\n      await browser.waitForCondition('window.location.pathname === \"/api/ok\"')\n      await check(() => browser.elementByCss('body').text(), 'ok')\n      const logs = await browser.log()\n      const errors = logs\n        .filter((x) => x.source === 'error')\n        .map((x) => x.message)\n        .join('\\n')\n      expect(errors).not.toContain('Failed to lookup route')\n    })","file":"e2e/middleware-redirects/test/index.test.ts","skipped":false,"dir":"test"},{"name":"responds with multiple cookies","suites":["Middleware Responses"],"updatePoint":{"line":24,"column":46},"line":24,"code":"    it(`${label}responds with multiple cookies`, async () => {\n      const res = await fetchViaHTTP(next.url, `${locale}/two-cookies`)\n      expect(res.headers.raw()['set-cookie']).toEqual([\n        'foo=chocochip',\n        'bar=chocochip',\n      ])\n    })","file":"e2e/middleware-responses/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should fail when returning a stream","suites":["Middleware Responses"],"updatePoint":{"line":32,"column":51},"line":32,"code":"    it(`${label}should fail when returning a stream`, async () => {\n      const res = await fetchViaHTTP(next.url, `${locale}/stream-a-response`)\n      expect(res.status).toBe(500)\n\n      if ((global as any).isNextDeploy) {\n        expect(await res.text()).toContain('EDGE_FUNCTION_INVOCATION_FAILED')\n      } else {\n        expect(await res.text()).toEqual('Internal Server Error')\n        expect(next.cliOutput).toContain(\n          `A middleware can not alter response's body. Learn more: https://nextjs.org/docs/messages/returning-response-body-in-middleware`\n        )\n      }\n    })","file":"e2e/middleware-responses/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should fail when returning a text body","suites":["Middleware Responses"],"updatePoint":{"line":46,"column":54},"line":46,"code":"    it(`${label}should fail when returning a text body`, async () => {\n      const res = await fetchViaHTTP(next.url, `${locale}/send-response`)\n      expect(res.status).toBe(500)\n\n      if ((global as any).isNextDeploy) {\n        expect(await res.text()).toContain('EDGE_FUNCTION_INVOCATION_FAILED')\n      } else {\n        expect(await res.text()).toEqual('Internal Server Error')\n        expect(next.cliOutput).toContain(\n          `A middleware can not alter response's body. Learn more: https://nextjs.org/docs/messages/returning-response-body-in-middleware`\n        )\n      }\n    })","file":"e2e/middleware-responses/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should respond with a 401 status code","suites":["Middleware Responses"],"updatePoint":{"line":60,"column":53},"line":60,"code":"    it(`${label}should respond with a 401 status code`, async () => {\n      const res = await fetchViaHTTP(next.url, `${locale}/bad-status`)\n      const html = await res.text()\n      expect(res.status).toBe(401)\n      expect(html).toBe('')\n    })","file":"e2e/middleware-responses/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should respond with one header","suites":["Middleware Responses"],"updatePoint":{"line":67,"column":46},"line":67,"code":"    it(`${label}should respond with one header`, async () => {\n      const res = await fetchViaHTTP(next.url, `${locale}/header`)\n      expect(res.headers.get('x-first-header')).toBe('valid')\n    })","file":"e2e/middleware-responses/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should respond with two headers","suites":["Middleware Responses"],"updatePoint":{"line":72,"column":47},"line":72,"code":"    it(`${label}should respond with two headers`, async () => {\n      const res = await fetchViaHTTP(\n        next.url,\n        `${locale}/header?nested-header=true`\n      )\n      expect(res.headers.get('x-first-header')).toBe('valid')\n      expect(res.headers.get('x-nested-header')).toBe('valid')\n    })","file":"e2e/middleware-responses/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should respond appending headers headers","suites":["Middleware Responses"],"updatePoint":{"line":81,"column":56},"line":81,"code":"    it(`${label}should respond appending headers headers`, async () => {\n      const res = await fetchViaHTTP(\n        next.url,\n        `${locale}/?nested-header=true&append-me=true&cookie-me=true`\n      )\n      expect(res.headers.get('x-nested-header')).toBe('valid')\n      expect(res.headers.get('x-append-me')).toBe('top')\n      expect(res.headers.raw()['set-cookie']).toEqual(['bar=chocochip'])\n    })","file":"e2e/middleware-responses/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not have un-necessary data request on rewrite","suites":["Middleware Rewrite"],"updatePoint":{"line":26,"column":60},"line":26,"code":"    it('should not have un-necessary data request on rewrite', async () => {\n      const browser = await webdriver(next.url, '/to-blog/first', {\n        waitHydration: false,\n      })\n      let requests = []\n\n      browser.on('request', (req) => {\n        requests.push(new URL(req.url()).pathname)\n      })\n\n      await check(\n        () => browser.eval(`next.router.isReady ? \"yup\" : \"nope\"`),\n        'yup'\n      )\n\n      expect(\n        requests.filter((url) => url === '/fallback-true-blog/first.json')\n          .length\n      ).toBeLessThan(2)\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not mix component cache when navigating between dynamic routes","suites":["Middleware Rewrite"],"updatePoint":{"line":47,"column":77},"line":47,"code":"    it('should not mix component cache when navigating between dynamic routes', async () => {\n      const browser = await webdriver(next.url, '/param-1')\n\n      expect(await browser.eval('next.router.pathname')).toBe('/[param]')\n      expect(await browser.eval('next.router.query.param')).toBe('param-1')\n\n      await browser.eval(`next.router.push(\"/fallback-true-blog/first\")`)\n      await check(\n        () => browser.eval('next.router.pathname'),\n        '/fallback-true-blog/[slug]'\n      )\n      expect(await browser.eval('next.router.query.slug')).toBe('first')\n      expect(await browser.eval('next.router.asPath')).toBe(\n        '/fallback-true-blog/first'\n      )\n\n      await browser.back()\n      await check(() => browser.eval('next.router.pathname'), '/[param]')\n      expect(await browser.eval('next.router.query.param')).toBe('param-1')\n      expect(await browser.eval('next.router.asPath')).toBe('/param-1')\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have props for afterFiles rewrite to SSG page","suites":["Middleware Rewrite"],"updatePoint":{"line":69,"column":60},"line":69,"code":"    it('should have props for afterFiles rewrite to SSG page', async () => {\n      let browser = await webdriver(next.url, '/')\n      await browser.eval(`next.router.push(\"/afterfiles-rewrite-ssg\")`)\n\n      await check(\n        () => browser.eval('next.router.isReady ? \"yup\": \"nope\"'),\n        'yup'\n      )\n      await check(\n        () => browser.eval('document.documentElement.innerHTML'),\n        /\"slug\":\"first\"/\n      )\n\n      browser = await webdriver(next.url, '/afterfiles-rewrite-ssg')\n      await check(\n        () => browser.eval('next.router.isReady ? \"yup\": \"nope\"'),\n        'yup'\n      )\n      await check(\n        () => browser.eval('document.documentElement.innerHTML'),\n        /\"slug\":\"first\"/\n      )\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should hard navigate on 404 for data request","suites":["Middleware Rewrite"],"updatePoint":{"line":93,"column":52},"line":93,"code":"    it('should hard navigate on 404 for data request', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.eval('window.beforeNav = 1')\n      await browser.eval(`next.router.push(\"/to/some/404/path\")`)\n      await check(\n        () => browser.eval('document.documentElement.innerHTML'),\n        /custom 404 page/\n      )\n      expect(await browser.eval('location.pathname')).toBe('/to/some/404/path')\n      expect(await browser.eval('window.beforeNav')).not.toBe(1)\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"includes the locale in rewrites by default","suites":["Middleware Rewrite"],"line":106,"code":"    it.skip('includes the locale in rewrites by default', async () => {","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":true,"dir":"test"},{"name":"should rewrite correctly when navigating via history","suites":["Middleware Rewrite"],"updatePoint":{"line":113,"column":60},"line":113,"code":"    it('should rewrite correctly when navigating via history', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.elementByCss('#override-with-internal-rewrite').click()\n      await check(() => {\n        return browser.eval('document.documentElement.innerHTML')\n      }, /Welcome Page A/)\n\n      await browser.refresh()\n      await browser.back()\n      await browser.waitForElementByCss('#override-with-internal-rewrite')\n      await browser.forward()\n      await check(() => {\n        return browser.eval('document.documentElement.innerHTML')\n      }, /Welcome Page A/)\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should rewrite correctly when navigating via history after query update","suites":["Middleware Rewrite"],"updatePoint":{"line":129,"column":79},"line":129,"code":"    it('should rewrite correctly when navigating via history after query update', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.elementByCss('#override-with-internal-rewrite').click()\n      await check(() => {\n        return browser.eval('document.documentElement.innerHTML')\n      }, /Welcome Page A/)\n\n      await browser.refresh()\n      await browser.waitForCondition(`!!window.next.router.isReady`)\n      await browser.back()\n      await browser.waitForElementByCss('#override-with-internal-rewrite')\n      await browser.forward()\n      await check(() => {\n        return browser.eval('document.documentElement.innerHTML')\n      }, /Welcome Page A/)\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should return HTML/data correctly for pre-rendered page","suites":["Middleware Rewrite"],"updatePoint":{"line":146,"column":63},"line":146,"code":"    it('should return HTML/data correctly for pre-rendered page', async () => {\n      for (const slug of [\n        'first',\n        'build-time-1',\n        'build-time-2',\n        'build-time-3',\n      ]) {\n        const res = await fetchViaHTTP(next.url, `/fallback-true-blog/${slug}`)\n        expect(res.status).toBe(200)\n\n        const $ = cheerio.load(await res.text())\n        expect(JSON.parse($('#props').text())?.params).toEqual({\n          slug,\n        })\n\n        const dataRes = await fetchViaHTTP(\n          next.url,\n          `/_next/data/${next.buildId}/en/fallback-true-blog/${slug}.json`,\n          undefined,\n          {\n            headers: {\n              'x-nextjs-data': '1',\n            },\n          }\n        )\n        expect(dataRes.status).toBe(200)\n        expect((await dataRes.json())?.pageProps?.params).toEqual({\n          slug,\n        })\n      }\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should override with rewrite internally correctly","suites":["Middleware Rewrite"],"updatePoint":{"line":178,"column":57},"line":178,"code":"    it('should override with rewrite internally correctly', async () => {\n      const res = await fetchViaHTTP(\n        next.url,\n        `/about`,\n        { override: 'internal' },\n        { redirect: 'manual' }\n      )\n\n      expect(res.status).toBe(200)\n      expect(await res.text()).toContain('Welcome Page A')\n\n      const browser = await webdriver(next.url, ``)\n      await browser.elementByCss('#override-with-internal-rewrite').click()\n      await check(\n        () => browser.eval('document.documentElement.innerHTML'),\n        /Welcome Page A/\n      )\n      expect(await browser.eval('window.location.pathname')).toBe(`/about`)\n      expect(await browser.eval('window.location.search')).toBe(\n        '?override=internal'\n      )\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should rewrite to data urls for incoming data request internally rewritten","suites":["Middleware Rewrite"],"updatePoint":{"line":201,"column":82},"line":201,"code":"    it(`should rewrite to data urls for incoming data request internally rewritten`, async () => {\n      const res = await fetchViaHTTP(\n        next.url,\n        `/_next/data/${next.buildId}/es/about.json`,\n        { override: 'internal' },\n        { redirect: 'manual', headers: { 'x-nextjs-data': '1' } }\n      )\n      const json = await res.json()\n      expect(json.pageProps).toEqual({ abtest: true })\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should override with rewrite externally correctly","suites":["Middleware Rewrite"],"updatePoint":{"line":212,"column":57},"line":212,"code":"    it('should override with rewrite externally correctly', async () => {\n      const res = await fetchViaHTTP(\n        next.url,\n        `/about`,\n        { override: 'external' },\n        { redirect: 'manual' }\n      )\n\n      expect(res.status).toBe(200)\n      expect(await res.text()).toContain('Example Domain')\n\n      const browser = await webdriver(next.url, ``)\n      await browser.elementByCss('#override-with-external-rewrite').click()\n      await check(\n        () => browser.eval('document.documentElement.innerHTML'),\n        /Example Domain/\n      )\n      await check(() => browser.eval('window.location.pathname'), `/about`)\n      await check(\n        () => browser.eval('window.location.search'),\n        '?override=external'\n      )\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should rewrite to the external url for incoming data request externally rewritten","suites":["Middleware Rewrite"],"updatePoint":{"line":236,"column":89},"line":236,"code":"    it(`should rewrite to the external url for incoming data request externally rewritten`, async () => {\n      const browser = await webdriver(\n        next.url,\n        `/_next/data/${next.buildId}/es/about.json?override=external`,\n        undefined\n      )\n      await check(\n        () => browser.eval('document.documentElement.innerHTML'),\n        /Example Domain/\n      )\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should rewrite to fallback: true page successfully","suites":["Middleware Rewrite"],"updatePoint":{"line":248,"column":58},"line":248,"code":"    it('should rewrite to fallback: true page successfully', async () => {\n      const randomSlug = `another-${Date.now()}`\n      const res2 = await fetchViaHTTP(next.url, `/to-blog/${randomSlug}`)\n      expect(res2.status).toBe(200)\n      expect(await res2.text()).toContain('Loading...')\n\n      const randomSlug2 = `another-${Date.now()}`\n      const browser = await webdriver(next.url, `/to-blog/${randomSlug2}`)\n\n      await check(async () => {\n        const props = JSON.parse(await browser.elementByCss('#props').text())\n        return props.params.slug === randomSlug2\n          ? 'success'\n          : JSON.stringify(props)\n      }, 'success')\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should allow to opt-out prefetch caching","suites":["Middleware Rewrite"],"updatePoint":{"line":265,"column":48},"line":265,"code":"    it('should allow to opt-out prefetch caching', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.addCookie({ name: 'about-bypass', value: '1' })\n      await browser.refresh()\n      await browser.eval('window.__SAME_PAGE = true')\n      await browser.elementByCss('#link-with-rewritten-url').click()\n      await browser.waitForElementByCss('.refreshed')\n      await browser.deleteCookies()\n      expect(await browser.eval('window.__SAME_PAGE')).toBe(true)\n      const element = await browser.elementByCss('.title')\n      expect(await element.text()).toEqual('About Bypassed Page')\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not prefetch non-SSG routes","suites":["Middleware Rewrite"],"updatePoint":{"line":279,"column":44},"line":279,"code":"      it('should not prefetch non-SSG routes', async () => {\n        const browser = await webdriver(next.url, '/')\n\n        await check(async () => {\n          const hrefs = await browser.eval(\n            `Object.keys(window.next.router.sdc)`\n          )\n          for (const url of ['/en/ssg.json']) {\n            if (!hrefs.some((href) => href.includes(url))) {\n              return JSON.stringify(hrefs, null, 2)\n            }\n          }\n          return 'yes'\n        }, 'yes')\n      })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should allow to rewrite keeping the locale in pathname","suites":["Middleware Rewrite"],"updatePoint":{"line":296,"column":62},"line":296,"code":"    it(`should allow to rewrite keeping the locale in pathname`, async () => {\n      const res = await fetchViaHTTP(next.url, '/fr/country', {\n        country: 'spain',\n      })\n      const html = await res.text()\n      const $ = cheerio.load(html)\n      expect($('#locale').text()).toBe('fr')\n      expect($('#country').text()).toBe('spain')\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should allow to rewrite to a different locale","suites":["Middleware Rewrite"],"updatePoint":{"line":306,"column":53},"line":306,"code":"    it(`should allow to rewrite to a different locale`, async () => {\n      const res = await fetchViaHTTP(next.url, '/country', {\n        'my-locale': 'es',\n      })\n      const html = await res.text()\n      const $ = cheerio.load(html)\n      expect($('#locale').text()).toBe('es')\n      expect($('#country').text()).toBe('us')\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should behave consistently on recursive rewrites","suites":["Middleware Rewrite"],"updatePoint":{"line":316,"column":56},"line":316,"code":"    it(`should behave consistently on recursive rewrites`, async () => {\n      const res = await fetchViaHTTP(next.url, `/rewrite-me-to-about`, {\n        override: 'internal',\n      })\n      const html = await res.text()\n      const $ = cheerio.load(html)\n      expect($('.title').text()).toBe('About Page')\n\n      const browser = await webdriver(next.url, `/`)\n      await browser.elementByCss('#rewrite-me-to-about').click()\n      await check(\n        () => browser.eval(`window.location.pathname`),\n        `/rewrite-me-to-about`\n      )\n      const element = await browser.elementByCss('.title')\n      expect(await element.text()).toEqual('About Page')\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should allow to switch locales","suites":["Middleware Rewrite"],"updatePoint":{"line":334,"column":38},"line":334,"code":"    it(`should allow to switch locales`, async () => {\n      const browser = await webdriver(next.url, '/i18n')\n      await browser.waitForElementByCss('.en')\n      await browser.elementByCss('#link-ja').click()\n      await browser.waitForElementByCss('.ja')\n      await browser.elementByCss('#link-en').click()\n      await browser.waitForElementByCss('.en')\n      await browser.elementByCss('#link-fr').click()\n      await browser.waitForElementByCss('.fr')\n      await browser.elementByCss('#link-ja2').click()\n      await browser.waitForElementByCss('.ja')\n      await browser.elementByCss('#link-en2').click()\n      await browser.waitForElementByCss('.en')\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should allow to rewrite to a `beforeFiles` rewrite config","suites":["Middleware Rewrite"],"updatePoint":{"line":349,"column":65},"line":349,"code":"    it('should allow to rewrite to a `beforeFiles` rewrite config', async () => {\n      const res = await fetchViaHTTP(\n        next.url,\n        `/rewrite-to-beforefiles-rewrite`\n      )\n      expect(res.status).toBe(200)\n      expect(await res.text()).toContain('Welcome Page A')\n\n      const browser = await webdriver(next.url, '/')\n      await browser.elementByCss('#rewrite-to-beforefiles-rewrite').click()\n      await check(\n        () => browser.eval('document.documentElement.innerHTML'),\n        /Welcome Page A/\n      )\n      expect(await browser.eval('window.location.pathname')).toBe(\n        `/rewrite-to-beforefiles-rewrite`\n      )\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should allow to rewrite to a `afterFiles` rewrite config","suites":["Middleware Rewrite"],"updatePoint":{"line":368,"column":64},"line":368,"code":"    it('should allow to rewrite to a `afterFiles` rewrite config', async () => {\n      const res = await fetchViaHTTP(next.url, `/rewrite-to-afterfiles-rewrite`)\n      expect(res.status).toBe(200)\n      expect(await res.text()).toContain('Welcome Page B')\n\n      const browser = await webdriver(next.url, '/')\n      await browser.elementByCss('#rewrite-to-afterfiles-rewrite').click()\n      await check(\n        () => browser.eval('document.documentElement.innerHTML'),\n        /Welcome Page B/\n      )\n      expect(await browser.eval('window.location.pathname')).toBe(\n        `/rewrite-to-afterfiles-rewrite`\n      )\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should handle shallow navigation correctly (non-dynamic page)","suites":["Middleware Rewrite"],"updatePoint":{"line":384,"column":69},"line":384,"code":"    it('should handle shallow navigation correctly (non-dynamic page)', async () => {\n      const browser = await webdriver(next.url, '/about')\n      const requests = []\n\n      browser.on('request', (req) => {\n        const url = req.url()\n        if (url.includes('_next/data')) requests.push(url)\n      })\n\n      await browser.eval(\n        `next.router.push('/about?hello=world', undefined, { shallow: true })`\n      )\n      await check(() => browser.eval(`next.router.query.hello`), 'world')\n\n      expect(await browser.eval(`next.router.pathname`)).toBe('/about')\n      expect(\n        JSON.parse(await browser.eval(`JSON.stringify(next.router.query)`))\n      ).toEqual({ hello: 'world' })\n      expect(await browser.eval('location.pathname')).toBe('/about')\n      expect(await browser.eval('location.search')).toBe('?hello=world')\n      expect(requests).toEqual([])\n\n      await browser.eval(\n        `next.router.push('/about', undefined, { shallow: true })`\n      )\n      await check(\n        () => browser.eval(`next.router.query.hello || 'empty'`),\n        'empty'\n      )\n\n      expect(await browser.eval(`next.router.pathname`)).toBe('/about')\n      expect(\n        JSON.parse(await browser.eval(`JSON.stringify(next.router.query)`))\n      ).toEqual({})\n      expect(await browser.eval('location.pathname')).toBe('/about')\n      expect(await browser.eval('location.search')).toBe('')\n      expect(requests).toEqual([])\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should handle shallow navigation correctly (dynamic page)","suites":["Middleware Rewrite"],"updatePoint":{"line":423,"column":65},"line":423,"code":"    it('should handle shallow navigation correctly (dynamic page)', async () => {\n      const browser = await webdriver(next.url, '/fallback-true-blog/first', {\n        waitHydration: false,\n      })\n      let requests = []\n\n      browser.on('request', (req) => {\n        const url = req.url()\n        if (url.includes('_next/data')) requests.push(url)\n      })\n\n      // wait for initial query update request\n      await check(() => {\n        if (requests.length > 0) {\n          requests = []\n          return 'yup'\n        }\n      }, 'yup')\n\n      await browser.eval(\n        `next.router.push('/fallback-true-blog/first?hello=world', undefined, { shallow: true })`\n      )\n      await check(() => browser.eval(`next.router.query.hello`), 'world')\n\n      expect(await browser.eval(`next.router.pathname`)).toBe(\n        '/fallback-true-blog/[slug]'\n      )\n      expect(\n        JSON.parse(await browser.eval(`JSON.stringify(next.router.query)`))\n      ).toEqual({ hello: 'world', slug: 'first' })\n      expect(await browser.eval('location.pathname')).toBe(\n        '/fallback-true-blog/first'\n      )\n      expect(await browser.eval('location.search')).toBe('?hello=world')\n      expect(requests).toEqual([])\n\n      await browser.eval(\n        `next.router.push('/fallback-true-blog/second', undefined, { shallow: true })`\n      )\n      await check(() => browser.eval(`next.router.query.slug`), 'second')\n\n      expect(await browser.eval(`next.router.pathname`)).toBe(\n        '/fallback-true-blog/[slug]'\n      )\n      expect(\n        JSON.parse(await browser.eval(`JSON.stringify(next.router.query)`))\n      ).toEqual({\n        slug: 'second',\n      })\n      expect(await browser.eval('location.pathname')).toBe(\n        '/fallback-true-blog/second'\n      )\n      expect(await browser.eval('location.search')).toBe('')\n      expect(requests).toEqual([])\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should resolve dynamic route after rewrite correctly","suites":["Middleware Rewrite"],"updatePoint":{"line":479,"column":60},"line":479,"code":"    it('should resolve dynamic route after rewrite correctly', async () => {\n      const browser = await webdriver(next.url, '/fallback-true-blog/first', {\n        waitHydration: false,\n      })\n      let requests = []\n\n      browser.on('request', (req) => {\n        const url = new URL(\n          req\n            .url()\n            .replace(new RegExp(escapeStringRegexp(next.buildId)), 'BUILD_ID')\n        ).pathname\n\n        if (url.includes('_next/data')) requests.push(url)\n      })\n\n      // wait for initial query update request\n      await check(() => {\n        if (requests.length > 0) {\n          requests = []\n          return 'yup'\n        }\n      }, 'yup')\n\n      expect(await browser.eval(`next.router.pathname`)).toBe(\n        '/fallback-true-blog/[slug]'\n      )\n      expect(\n        JSON.parse(await browser.eval(`JSON.stringify(next.router.query)`))\n      ).toEqual({\n        slug: 'first',\n      })\n      expect(await browser.eval('location.pathname')).toBe(\n        '/fallback-true-blog/first'\n      )\n      expect(await browser.eval('location.search')).toBe('')\n      expect(requests).toEqual([])\n\n      await browser.eval(`next.router.push('/fallback-true-blog/rewritten')`)\n      await check(\n        () => browser.eval('document.documentElement.innerHTML'),\n        /About Page/\n      )\n\n      expect(await browser.eval(`next.router.pathname`)).toBe('/about')\n      expect(\n        JSON.parse(await browser.eval(`JSON.stringify(next.router.query)`))\n      ).toEqual({})\n      expect(await browser.eval('location.pathname')).toBe(\n        '/fallback-true-blog/rewritten'\n      )\n      expect(await browser.eval('location.search')).toBe('')\n      expect(requests).toEqual([\n        `/_next/data/BUILD_ID/en/fallback-true-blog/rewritten.json`,\n      ])\n\n      await browser.eval(`next.router.push('/fallback-true-blog/second')`)\n      await check(\n        () => browser.eval(`next.router.pathname`),\n        '/fallback-true-blog/[slug]'\n      )\n\n      expect(await browser.eval(`next.router.pathname`)).toBe(\n        '/fallback-true-blog/[slug]'\n      )\n      expect(\n        JSON.parse(await browser.eval(`JSON.stringify(next.router.query)`))\n      ).toEqual({\n        slug: 'second',\n      })\n      expect(await browser.eval('location.pathname')).toBe(\n        '/fallback-true-blog/second'\n      )\n      expect(await browser.eval('location.search')).toBe('')\n      expect(\n        requests.filter(\n          (req) =>\n            ![\n              `/_next/data/BUILD_ID/en/fallback-true-blog/rewritten.json`,\n              `/_next/data/BUILD_ID/en/fallback-true-blog/second.json`,\n            ].includes(req)\n        )\n      ).toEqual([])\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should add a cookie and rewrite to a/b test","suites":["Middleware Rewrite"],"updatePoint":{"line":581,"column":59},"line":581,"code":"    it(`${label}should add a cookie and rewrite to a/b test`, async () => {\n      const res = await fetchViaHTTP(next.url, `${locale}/rewrite-to-ab-test`)\n      const html = await res.text()\n      const $ = cheerio.load(html)\n      // Set-Cookie header with Expires should not be split into two\n      expect(res.headers.raw()['set-cookie']).toHaveLength(1)\n      const bucket = getCookieFromResponse(res, 'bucket')\n      const expectedText = bucket === 'a' ? 'Welcome Page A' : 'Welcome Page B'\n      const browser = await webdriver(next.url, `${locale}/rewrite-to-ab-test`)\n      try {\n        expect(await browser.eval(`window.location.pathname`)).toBe(\n          `${locale}/rewrite-to-ab-test`\n        )\n      } finally {\n        await browser.close()\n      }\n      // -1 is returned if bucket was not found in func getCookieFromResponse\n      expect(bucket).not.toBe(-1)\n      expect($('.title').text()).toBe(expectedText)\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should clear query parameters","suites":["Middleware Rewrite"],"updatePoint":{"line":602,"column":45},"line":602,"code":"    it(`${label}should clear query parameters`, async () => {\n      const res = await fetchViaHTTP(next.url, `${locale}/clear-query-params`, {\n        a: '1',\n        b: '2',\n        foo: 'bar',\n        allowed: 'kept',\n      })\n      const html = await res.text()\n      const $ = cheerio.load(html)\n      expect(JSON.parse($('#my-query-params').text())).toEqual({\n        allowed: 'kept',\n      })\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should rewrite to about page","suites":["Middleware Rewrite"],"updatePoint":{"line":616,"column":44},"line":616,"code":"    it(`${label}should rewrite to about page`, async () => {\n      const res = await fetchViaHTTP(next.url, `${locale}/rewrite-me-to-about`)\n      const html = await res.text()\n      const $ = cheerio.load(html)\n      const browser = await webdriver(next.url, `${locale}/rewrite-me-to-about`)\n      try {\n        expect(await browser.eval(`window.location.pathname`)).toBe(\n          `${locale}/rewrite-me-to-about`\n        )\n      } finally {\n        await browser.close()\n      }\n      expect($('.title').text()).toBe('About Page')\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"support colons in path","suites":["Middleware Rewrite"],"updatePoint":{"line":631,"column":38},"line":631,"code":"    it(`${label}support colons in path`, async () => {\n      const path = `${locale}/not:param`\n      const res = await fetchViaHTTP(next.url, path)\n      const html = await res.text()\n      const $ = cheerio.load(html)\n      expect($('#props').text()).toBe('not:param')\n      const browser = await webdriver(next.url, path)\n      try {\n        expect(await browser.eval(`window.location.pathname`)).toBe(path)\n      } finally {\n        await browser.close()\n      }\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"can rewrite to path with colon","suites":["Middleware Rewrite"],"updatePoint":{"line":645,"column":46},"line":645,"code":"    it(`${label}can rewrite to path with colon`, async () => {\n      const path = `${locale}/rewrite-me-with-a-colon`\n      const res = await fetchViaHTTP(next.url, path)\n      const html = await res.text()\n      const $ = cheerio.load(html)\n      expect($('#props').text()).toBe('with:colon')\n      const browser = await webdriver(next.url, path)\n      try {\n        expect(await browser.eval(`window.location.pathname`)).toBe(path)\n      } finally {\n        await browser.close()\n      }\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"can rewrite from path with colon","suites":["Middleware Rewrite"],"updatePoint":{"line":659,"column":48},"line":659,"code":"    it(`${label}can rewrite from path with colon`, async () => {\n      const path = `${locale}/colon:here`\n      const res = await fetchViaHTTP(next.url, path)\n      const html = await res.text()\n      const $ = cheerio.load(html)\n      expect($('#props').text()).toBe('no-colon-here')\n      const browser = await webdriver(next.url, path)\n      try {\n        expect(await browser.eval(`window.location.pathname`)).toBe(path)\n      } finally {\n        await browser.close()\n      }\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"can rewrite from path with colon and retain query parameter","suites":["Middleware Rewrite"],"updatePoint":{"line":673,"column":75},"line":673,"code":"    it(`${label}can rewrite from path with colon and retain query parameter`, async () => {\n      const path = `${locale}/colon:here?qp=arg`\n      const res = await fetchViaHTTP(next.url, path)\n      const html = await res.text()\n      const $ = cheerio.load(html)\n      expect($('#props').text()).toBe('no-colon-here')\n      expect($('#qp').text()).toBe('arg')\n      const browser = await webdriver(next.url, path)\n      try {\n        expect(\n          await browser.eval(\n            `window.location.href.replace(window.location.origin, '')`\n          )\n        ).toBe(path)\n      } finally {\n        await browser.close()\n      }\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"can rewrite to path with colon and retain query parameter","suites":["Middleware Rewrite"],"updatePoint":{"line":692,"column":73},"line":692,"code":"    it(`${label}can rewrite to path with colon and retain query parameter`, async () => {\n      const path = `${locale}/rewrite-me-with-a-colon?qp=arg`\n      const res = await fetchViaHTTP(next.url, path)\n      const html = await res.text()\n      const $ = cheerio.load(html)\n      expect($('#props').text()).toBe('with:colon')\n      expect($('#qp').text()).toBe('arg')\n      const browser = await webdriver(next.url, path)\n      try {\n        expect(\n          await browser.eval(\n            `window.location.href.replace(window.location.origin, '')`\n          )\n        ).toBe(path)\n      } finally {\n        await browser.close()\n      }\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should rewrite when not using localhost","suites":["Middleware Rewrite"],"updatePoint":{"line":712,"column":57},"line":712,"code":"      it(`${label}should rewrite when not using localhost`, async () => {\n        const customUrl = new URL(next.url)\n        customUrl.hostname = 'localtest.me'\n\n        const res = await fetchViaHTTP(\n          customUrl.toString(),\n          `${locale}/rewrite-me-without-hard-navigation`\n        )\n        const html = await res.text()\n        const $ = cheerio.load(html)\n        expect($('.title').text()).toBe('About Page')\n      })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should rewrite to Vercel","suites":["Middleware Rewrite"],"updatePoint":{"line":726,"column":40},"line":726,"code":"    it(`${label}should rewrite to Vercel`, async () => {\n      const res = await fetchViaHTTP(next.url, `${locale}/rewrite-me-to-vercel`)\n      const html = await res.text()\n      // const browser = await webdriver(next.url, '/rewrite-me-to-vercel')\n      // TODO: running this to chech the window.location.pathname hangs for some reason;\n      expect(html).toContain('Example Domain')\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should rewrite without hard navigation","suites":["Middleware Rewrite"],"updatePoint":{"line":734,"column":54},"line":734,"code":"    it(`${label}should rewrite without hard navigation`, async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.eval('window.__SAME_PAGE = true')\n      await browser.elementByCss('#link-with-rewritten-url').click()\n      await browser.waitForElementByCss('.refreshed')\n      expect(await browser.eval('window.__SAME_PAGE')).toBe(true)\n      const element = await browser.elementByCss('.middleware')\n      expect(await element.text()).toEqual('foo')\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not call middleware with shallow push","suites":["Middleware Rewrite"],"updatePoint":{"line":744,"column":60},"line":744,"code":"    it(`${label}should not call middleware with shallow push`, async () => {\n      const browser = await webdriver(next.url, '')\n      await browser.elementByCss('#link-to-shallow-push').click()\n      await browser.waitForCondition(\n        'new URL(window.location.href).searchParams.get(\"path\") === \"rewrite-me-without-hard-navigation\"'\n      )\n      await expect(async () => {\n        await browser.waitForElementByCss('.refreshed', 500)\n      }).rejects.toThrow()\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should correctly rewriting to a different dynamic path","suites":["Middleware Rewrite"],"updatePoint":{"line":755,"column":70},"line":755,"code":"    it(`${label}should correctly rewriting to a different dynamic path`, async () => {\n      const browser = await webdriver(next.url, '/dynamic-replace')\n      const element = await browser.elementByCss('.title')\n      expect(await element.text()).toEqual('Parts page')\n      const logs = await browser.log()\n      expect(\n        logs.every((log) => log.source === 'log' || log.source === 'info')\n      ).toEqual(true)\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not have unexpected errors","suites":["Middleware Rewrite"],"updatePoint":{"line":765,"column":41},"line":765,"code":"    it('should not have unexpected errors', async () => {\n      expect(next.cliOutput).not.toContain('unhandledRejection')\n      expect(next.cliOutput).not.toContain('ECONNRESET')\n    })","file":"e2e/middleware-rewrites/test/index.test.ts","skipped":false,"dir":"test"},{"name":"refreshes the page when middleware changes ","suites":["Middleware Runtime trailing slash"],"updatePoint":{"line":28,"column":53},"line":28,"code":"      it('refreshes the page when middleware changes ', async () => {\n        const browser = await webdriver(next.url, `/about/`)\n        await browser.eval('window.didrefresh = \"hello\"')\n        const text = await browser.elementByCss('h1').text()\n        expect(text).toEqual('AboutA')\n\n        const middlewarePath = join(next.testDir, '/middleware.js')\n        const originalContent = fs.readFileSync(middlewarePath, 'utf-8')\n        const editedContent = originalContent.replace('/about/a', '/about/b')\n\n        try {\n          fs.writeFileSync(middlewarePath, editedContent)\n          await waitFor(1000)\n          const textb = await browser.elementByCss('h1').text()\n          expect(await browser.eval('window.itdidnotrefresh')).not.toBe('hello')\n          expect(textb).toEqual('AboutB')\n        } finally {\n          fs.writeFileSync(middlewarePath, originalContent)\n          await browser.close()\n        }\n      })","file":"e2e/middleware-trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have valid middleware field in manifest","suites":["Middleware Runtime trailing slash"],"updatePoint":{"line":52,"column":56},"line":52,"code":"      it('should have valid middleware field in manifest', async () => {\n        const manifest = await fs.readJSON(\n          join(next.testDir, '.next/server/middleware-manifest.json')\n        )\n        expect(manifest.middleware).toEqual({\n          '/': {\n            files: ['server/edge-runtime-webpack.js', 'server/middleware.js'],\n            name: 'middleware',\n            env: [],\n            page: '/',\n            matchers: [{ regexp: '^/.*$' }],\n            wasm: [],\n            assets: [],\n          },\n        })\n      })","file":"e2e/middleware-trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct files in manifest","suites":["Middleware Runtime trailing slash"],"updatePoint":{"line":69,"column":47},"line":69,"code":"      it('should have correct files in manifest', async () => {\n        const manifest = await fs.readJSON(\n          join(next.testDir, '.next/server/middleware-manifest.json')\n        )\n        for (const key of Object.keys(manifest.middleware)) {\n          const middleware = manifest.middleware[key]\n          expect(middleware.files).toContainEqual(\n            expect.stringContaining('server/edge-runtime-webpack')\n          )\n          expect(middleware.files).not.toContainEqual(\n            expect.stringContaining('static/chunks/')\n          )\n        }\n      })","file":"e2e/middleware-trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not run middleware for on-demand revalidate","suites":["Middleware Runtime trailing slash"],"updatePoint":{"line":84,"column":60},"line":84,"code":"      it('should not run middleware for on-demand revalidate', async () => {\n        const bypassToken = (\n          await fs.readJSON(join(next.testDir, '.next/prerender-manifest.json'))\n        ).preview.previewModeId\n\n        const res = await fetchViaHTTP(next.url, '/ssg/first/', undefined, {\n          headers: {\n            'x-prerender-revalidate': bypassToken,\n          },\n        })\n        expect(res.status).toBe(200)\n        expect(res.headers.get('x-middleware')).toBeFalsy()\n        expect(res.headers.get('x-nextjs-cache')).toBe('REVALIDATED')\n      })","file":"e2e/middleware-trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have init header for NextResponse.redirect","suites":["Middleware Runtime trailing slash"],"updatePoint":{"line":100,"column":57},"line":100,"code":"    it('should have init header for NextResponse.redirect', async () => {\n      const res = await fetchViaHTTP(\n        next.url,\n        '/redirect-to-somewhere/',\n        undefined,\n        {\n          redirect: 'manual',\n        }\n      )\n      expect(res.status).toBe(307)\n      expect(new URL(res.headers.get('location'), 'http://n').pathname).toBe(\n        '/somewhere/'\n      )\n      expect(res.headers.get('x-redirect-header')).toBe('hi')\n    })","file":"e2e/middleware-trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct query values for rewrite to ssg page","suites":["Middleware Runtime trailing slash"],"updatePoint":{"line":116,"column":64},"line":116,"code":"    it('should have correct query values for rewrite to ssg page', async () => {\n      const browser = await webdriver(next.url, '/to-ssg/')\n      await browser.eval('window.beforeNav = 1')\n\n      await check(() => browser.elementByCss('body').text(), /\\/to-ssg/)\n\n      expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n        slug: 'hello',\n        from: 'middleware',\n      })\n      expect(\n        JSON.parse(await browser.elementByCss('#props').text()).params\n      ).toEqual({\n        slug: 'hello',\n      })\n      expect(await browser.elementByCss('#pathname').text()).toBe('/ssg/[slug]')\n      expect(await browser.elementByCss('#as-path').text()).toBe('/to-ssg/')\n    })","file":"e2e/middleware-trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct dynamic route params on client-transition to dynamic route","suites":["Middleware Runtime trailing slash"],"updatePoint":{"line":135,"column":86},"line":135,"code":"    it('should have correct dynamic route params on client-transition to dynamic route', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.eval('window.beforeNav = 1')\n      await browser.eval('window.next.router.push(\"/blog/first\")')\n      await browser.waitForElementByCss('#blog')\n\n      expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n        slug: 'first',\n      })\n      expect(\n        JSON.parse(await browser.elementByCss('#props').text()).params\n      ).toEqual({\n        slug: 'first',\n      })\n      expect(await browser.elementByCss('#pathname').text()).toBe(\n        '/blog/[slug]'\n      )\n      expect(await browser.elementByCss('#as-path').text()).toBe('/blog/first/')\n\n      await browser.eval('window.next.router.push(\"/blog/second\")')\n      await check(() => browser.elementByCss('body').text(), /\"slug\":\"second\"/)\n\n      expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n        slug: 'second',\n      })\n      expect(\n        JSON.parse(await browser.elementByCss('#props').text()).params\n      ).toEqual({\n        slug: 'second',\n      })\n      expect(await browser.elementByCss('#pathname').text()).toBe(\n        '/blog/[slug]'\n      )\n      expect(await browser.elementByCss('#as-path').text()).toBe(\n        '/blog/second/'\n      )\n    })","file":"e2e/middleware-trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct dynamic route params for middleware rewrite to dynamic route","suites":["Middleware Runtime trailing slash"],"updatePoint":{"line":173,"column":88},"line":173,"code":"    it('should have correct dynamic route params for middleware rewrite to dynamic route', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.eval('window.beforeNav = 1')\n      await browser.eval('window.next.router.push(\"/rewrite-to-dynamic\")')\n      await browser.waitForElementByCss('#blog')\n\n      expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n        slug: 'from-middleware',\n        some: 'middleware',\n      })\n      expect(\n        JSON.parse(await browser.elementByCss('#props').text()).params\n      ).toEqual({\n        slug: 'from-middleware',\n      })\n      expect(await browser.elementByCss('#pathname').text()).toBe(\n        '/blog/[slug]'\n      )\n      expect(await browser.elementByCss('#as-path').text()).toBe(\n        '/rewrite-to-dynamic/'\n      )\n    })","file":"e2e/middleware-trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct route params for chained rewrite from middleware to config rewrite","suites":["Middleware Runtime trailing slash"],"updatePoint":{"line":196,"column":94},"line":196,"code":"    it('should have correct route params for chained rewrite from middleware to config rewrite', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.eval('window.beforeNav = 1')\n      await browser.eval(\n        'window.next.router.push(\"/rewrite-to-config-rewrite\")'\n      )\n      await browser.waitForElementByCss('#blog')\n\n      expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n        slug: 'middleware-rewrite',\n        hello: 'config',\n        some: 'middleware',\n      })\n      expect(\n        JSON.parse(await browser.elementByCss('#props').text()).params\n      ).toEqual({\n        slug: 'middleware-rewrite',\n      })\n      expect(await browser.elementByCss('#pathname').text()).toBe(\n        '/blog/[slug]'\n      )\n      expect(await browser.elementByCss('#as-path').text()).toBe(\n        '/rewrite-to-config-rewrite/'\n      )\n    })","file":"e2e/middleware-trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct route params for rewrite from config dynamic route","suites":["Middleware Runtime trailing slash"],"updatePoint":{"line":222,"column":78},"line":222,"code":"    it('should have correct route params for rewrite from config dynamic route', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.eval('window.beforeNav = 1')\n      await browser.eval('window.next.router.push(\"/rewrite-3\")')\n      await browser.waitForElementByCss('#blog')\n\n      expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n        slug: 'middleware-rewrite',\n        hello: 'config',\n      })\n      expect(\n        JSON.parse(await browser.elementByCss('#props').text()).params\n      ).toEqual({\n        slug: 'middleware-rewrite',\n      })\n      expect(await browser.elementByCss('#pathname').text()).toBe(\n        '/blog/[slug]'\n      )\n      expect(await browser.elementByCss('#as-path').text()).toBe('/rewrite-3/')\n    })","file":"e2e/middleware-trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct route params for rewrite from config non-dynamic route","suites":["Middleware Runtime trailing slash"],"updatePoint":{"line":243,"column":82},"line":243,"code":"    it('should have correct route params for rewrite from config non-dynamic route', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.eval('window.beforeNav = 1')\n      await browser.eval('window.next.router.push(\"/rewrite-1\")')\n\n      await check(\n        () => browser.eval('document.documentElement.innerHTML'),\n        /Hello World/\n      )\n\n      expect(await browser.eval('window.next.router.query')).toEqual({\n        from: 'config',\n      })\n    })","file":"e2e/middleware-trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should redirect the same for direct visit and client-transition","suites":["Middleware Runtime trailing slash"],"updatePoint":{"line":258,"column":71},"line":258,"code":"    it('should redirect the same for direct visit and client-transition', async () => {\n      const res = await fetchViaHTTP(next.url, `/redirect-1/`, undefined, {\n        redirect: 'manual',\n      })\n      expect(res.status).toBe(307)\n      expect(new URL(res.headers.get('location'), 'http://n').pathname).toBe(\n        '/somewhere/else/'\n      )\n\n      const browser = await webdriver(next.url, `/`)\n      await browser.eval(`next.router.push('/redirect-1')`)\n      await check(async () => {\n        const pathname = await browser.eval('location.pathname')\n        return pathname === '/somewhere/else/' ? 'success' : pathname\n      }, 'success')\n    })","file":"e2e/middleware-trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should rewrite the same for direct visit and client-transition","suites":["Middleware Runtime trailing slash"],"updatePoint":{"line":275,"column":70},"line":275,"code":"    it('should rewrite the same for direct visit and client-transition', async () => {\n      const res = await fetchViaHTTP(next.url, `/rewrite-1/`)\n      expect(res.status).toBe(200)\n      expect(await res.text()).toContain('Hello World')\n\n      const browser = await webdriver(next.url, `/`)\n      await browser.eval('window.beforeNav = 1')\n      await browser.eval(`next.router.push('/rewrite-1')`)\n      await check(async () => {\n        const content = await browser.eval('document.documentElement.innerHTML')\n        return content.includes('Hello World') ? 'success' : content\n      }, 'success')\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n    })","file":"e2e/middleware-trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should rewrite correctly for non-SSG/SSP page","suites":["Middleware Runtime trailing slash"],"updatePoint":{"line":290,"column":53},"line":290,"code":"    it('should rewrite correctly for non-SSG/SSP page', async () => {\n      const res = await fetchViaHTTP(next.url, `/rewrite-2/`)\n      expect(res.status).toBe(200)\n      expect(await res.text()).toContain('AboutA')\n\n      const browser = await webdriver(next.url, `/`)\n      await browser.eval(`next.router.push('/rewrite-2')`)\n      await check(async () => {\n        const content = await browser.eval('document.documentElement.innerHTML')\n        return content.includes('AboutA') ? 'success' : content\n      }, 'success')\n    })","file":"e2e/middleware-trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should respond with 400 on decode failure","suites":["Middleware Runtime trailing slash"],"updatePoint":{"line":303,"column":49},"line":303,"code":"    it('should respond with 400 on decode failure', async () => {\n      const res = await fetchViaHTTP(next.url, `/%2/`)\n      expect(res.status).toBe(400)\n\n      if ((global as any).isNextStart) {\n        expect(await res.text()).toContain('Bad Request')\n      }\n    })","file":"e2e/middleware-trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should validate & parse request url from any route","suites":["Middleware Runtime trailing slash"],"updatePoint":{"line":312,"column":58},"line":312,"code":"    it(`should validate & parse request url from any route`, async () => {\n      const res = await fetchViaHTTP(next.url, `/static/`)\n\n      expect(res.headers.get('req-url-basepath')).toBeFalsy()\n      expect(res.headers.get('req-url-pathname')).toBe('/static/')\n\n      const { pathname, params } = JSON.parse(res.headers.get('req-url-params'))\n      expect(pathname).toBe(undefined)\n      expect(params).toEqual(undefined)\n\n      expect(res.headers.get('req-url-query')).not.toBe('bar')\n    })","file":"e2e/middleware-trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should trigger middleware for data requests","suites":["Middleware Runtime trailing slash"],"updatePoint":{"line":325,"column":51},"line":325,"code":"    it('should trigger middleware for data requests', async () => {\n      const browser = await webdriver(next.url, `/ssr-page`)\n      const text = await browser.elementByCss('h1').text()\n      expect(text).toEqual('Bye Cruel World')\n      const res = await fetchViaHTTP(\n        next.url,\n        `/_next/data/${next.buildId}/ssr-page.json`,\n        undefined,\n        {\n          headers: {\n            'x-nextjs-data': '1',\n          },\n        }\n      )\n      const json = await res.json()\n      expect(json.pageProps.message).toEqual('Bye Cruel World')\n    })","file":"e2e/middleware-trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should normalize data requests into page requests","suites":["Middleware Runtime trailing slash"],"updatePoint":{"line":343,"column":57},"line":343,"code":"    it('should normalize data requests into page requests', async () => {\n      const res = await fetchViaHTTP(\n        next.url,\n        `/_next/data/${next.buildId}/send-url.json`,\n        undefined,\n        {\n          headers: {\n            'x-nextjs-data': '1',\n          },\n        }\n      )\n      expect(res.headers.get('req-url-path')).toEqual('/send-url/')\n    })","file":"e2e/middleware-trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should keep non data requests in their original shape","suites":["Middleware Runtime trailing slash"],"updatePoint":{"line":357,"column":61},"line":357,"code":"    it('should keep non data requests in their original shape', async () => {\n      const res = await fetchViaHTTP(\n        next.url,\n        `/_next/static/${next.buildId}/_devMiddlewareManifest.json?foo=1`\n      )\n      expect(res.headers.get('req-url-path')).toEqual(\n        `/_next/static/${next.buildId}/_devMiddlewareManifest.json?foo=1`\n      )\n    })","file":"e2e/middleware-trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should add a rewrite header on data requests for rewrites","suites":["Middleware Runtime trailing slash"],"updatePoint":{"line":367,"column":65},"line":367,"code":"    it('should add a rewrite header on data requests for rewrites', async () => {\n      const res = await fetchViaHTTP(next.url, `/ssr-page/`)\n      const dataRes = await fetchViaHTTP(\n        next.url,\n        `/_next/data/${next.buildId}/ssr-page.json`,\n        undefined,\n        { headers: { 'x-nextjs-data': '1' } }\n      )\n      const json = await dataRes.json()\n      expect(json.pageProps.message).toEqual('Bye Cruel World')\n      expect(res.headers.get('x-nextjs-matched-path')).toBeNull()\n      expect(dataRes.headers.get('x-nextjs-matched-path')).toEqual(\n        `/ssr-page-2`\n      )\n    })","file":"e2e/middleware-trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"allows shallow linking with middleware","suites":["Middleware Runtime trailing slash"],"updatePoint":{"line":383,"column":46},"line":383,"code":"    it('allows shallow linking with middleware', async () => {\n      const browser = await webdriver(next.url, '/sha/')\n      const getMessageContents = () =>\n        browser.elementById('message-contents').text()\n      const ssrMessage = await getMessageContents()\n      const requests: string[] = []\n\n      browser.on('request', (x) => {\n        requests.push(x.url())\n      })\n\n      browser.elementById('deep-link').click()\n      browser.waitForElementByCss('[data-query-hello=\"goodbye\"]')\n      const deepLinkMessage = await getMessageContents()\n      expect(deepLinkMessage).not.toEqual(ssrMessage)\n\n      // Changing the route with a shallow link should not cause a server request\n      browser.elementById('shallow-link').click()\n      browser.waitForElementByCss('[data-query-hello=\"world\"]')\n      expect(await getMessageContents()).toEqual(deepLinkMessage)\n\n      // Check that no server requests were made to ?hello=world,\n      // as it's a shallow request.\n      expect(requests.filter((req) => req.includes('_next/data'))).toEqual([\n        `${next.url}/_next/data/${next.buildId}/sha.json?hello=goodbye`,\n      ])\n    })","file":"e2e/middleware-trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should render link with <a>","suites":["New Link Behavior"],"updatePoint":{"line":37,"column":33},"line":37,"code":"  it('should render link with <a>', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    const $ = cheerio.load(html)\n    const $a = $('a')\n    expect($a.text()).toBe('About')\n    expect($a.attr('href')).toBe('/about')\n  })","file":"e2e/new-link-behavior/index.test.ts","skipped":false,"dir":"test"},{"name":"should navigate to /about","suites":["New Link Behavior"],"updatePoint":{"line":45,"column":31},"line":45,"code":"  it('should navigate to /about', async () => {\n    const browser = await webdriver(next.url, `/`)\n    await browser.elementByCss('a').click().waitForElementByCss('#about-page')\n    const text = await browser.elementByCss('h1').text()\n    expect(text).toBe('About Page')\n  })","file":"e2e/new-link-behavior/index.test.ts","skipped":false,"dir":"test"},{"name":"should handle onclick","suites":["New Link Behavior"],"updatePoint":{"line":52,"column":27},"line":52,"code":"  it('should handle onclick', async () => {\n    const browser = await webdriver(next.url, `/onclick`)\n    await browser.elementByCss('a').click().waitForElementByCss('h1')\n    const text = await browser.elementByCss('h1').text()\n    expect(text).toBe('Home Page')\n\n    expect(await matchLogs(browser, 'link to home clicked')).toBe(true)\n  })","file":"e2e/new-link-behavior/index.test.ts","skipped":false,"dir":"test"},{"name":"should handle preventdefault","suites":["New Link Behavior"],"updatePoint":{"line":61,"column":34},"line":61,"code":"  it('should handle preventdefault', async () => {\n    const browser = await webdriver(next.url, `/onclick-prevent-default`)\n    await browser.elementByCss('a').click()\n    const text = await browser.elementByCss('h1').text()\n    expect(text).toBe('Onclick prevent default')\n\n    expect(await matchLogs(browser, 'link to home clicked but prevented')).toBe(\n      true\n    )\n  })","file":"e2e/new-link-behavior/index.test.ts","skipped":false,"dir":"test"},{"name":"should render link with id","suites":["New Link Behavior"],"updatePoint":{"line":72,"column":32},"line":72,"code":"  it('should render link with id', async () => {\n    const html = await renderViaHTTP(next.url, '/id-pass-through')\n    const $ = cheerio.load(html)\n    const $a = $('a')\n    expect($a.attr('id')).toBe('home-link')\n  })","file":"e2e/new-link-behavior/index.test.ts","skipped":false,"dir":"test"},{"name":"should render link with classname","suites":["New Link Behavior"],"updatePoint":{"line":79,"column":39},"line":79,"code":"  it('should render link with classname', async () => {\n    const html = await renderViaHTTP(next.url, '/classname-pass-through')\n    const $ = cheerio.load(html)\n    const $a = $('a')\n    expect($a.attr('class')).toBe('home-link')\n  })","file":"e2e/new-link-behavior/index.test.ts","skipped":false,"dir":"test"},{"name":"should render link with multiple children","suites":["New Link Behavior"],"updatePoint":{"line":86,"column":47},"line":86,"code":"  it('should render link with multiple children', async () => {\n    const html = await renderViaHTTP(next.url, '/multiple-children')\n    const $ = cheerio.load(html)\n    const $a = $('a')\n    expect($a.text()).toBe('About Additional Children')\n    expect($a.find('strong').text()).toBe('Additional Children')\n  })","file":"e2e/new-link-behavior/index.test.ts","skipped":false,"dir":"test"},{"name":"should render MuiLink with <a>","suites":["New Link Behavior with material-ui"],"updatePoint":{"line":36,"column":36},"line":36,"code":"  it('should render MuiLink with <a>', async () => {\n    const browser = await webdriver(next.url, `/`)\n    const element = await browser.elementByCss('a[href=\"/about\"]')\n\n    const color = await element.getComputedCss('color')\n    expect(color).toBe('rgb(25, 133, 123)')\n\n    const text = await element.text()\n    expect(text).toBe('Go to the about page')\n  })","file":"e2e/new-link-behavior/material-ui.test.ts","skipped":false,"dir":"test"},{"name":"should render <a>","suites":["New Link Behavior with stitches"],"updatePoint":{"line":31,"column":23},"line":31,"code":"  it('should render <a>', async () => {\n    const browser = await webdriver(next.url, `/`)\n    const element = await browser.elementByCss('a[href=\"/about\"]')\n\n    const color = await element.getComputedCss('color')\n    expect(color).toBe('rgb(78, 39, 231)')\n\n    const text = await element.text()\n    expect(text).toBe('Visit About')\n  })","file":"e2e/new-link-behavior/stitches.test.ts","skipped":false,"dir":"test"},{"name":"should render link with <a>","suites":["New Link Behavior"],"updatePoint":{"line":29,"column":33},"line":29,"code":"  it('should render link with <a>', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    const $ = cheerio.load(html)\n    const $a = $('a')\n    expect($a.text()).toBe('Visit')\n    expect($a.attr('href')).toBe('/test')\n  })","file":"e2e/new-link-behavior/typescript.test.ts","skipped":false,"dir":"test"},{"name":"should apply ref on link","suites":["New Link Behavior"],"updatePoint":{"line":37,"column":30},"line":37,"code":"  it('should apply ref on link', async () => {\n    const browser = await webdriver(next.url, `/ref`)\n    const text = await browser.elementByCss('#anchor-text').text()\n    expect(text).toBe('AnchorText: About')\n  })","file":"e2e/new-link-behavior/typescript.test.ts","skipped":false,"dir":"test"},{"name":"should place charset element at the top of <head>","suites":["should set-up next"],"updatePoint":{"line":21,"column":55},"line":21,"code":"  it(`should place charset element at the top of <head>`, async () => {\n    const browser = await webdriver(next.url, '/')\n\n    const html = await browser.eval(() => {\n      const head = document.querySelector('head')\n      return head.innerHTML\n    })\n\n    expect(html).toContain(\n      `<meta charset=\"utf-8\"><meta name=\"viewport\" content=\"width=device-width\"><meta name=\"test-head-1\" content=\"hello\">`\n    )\n  })","file":"e2e/next-head/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct head tags in initial document","suites":["should set-up next"],"updatePoint":{"line":34,"column":55},"line":34,"code":"  it('should have correct head tags in initial document', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    const $ = cheerio.load(html)\n\n    for (let i = 1; i < 5; i++) {\n      expect($(`meta[name=\"test-head-${i}\"]`).attr()['content']).toBe('hello')\n    }\n  })","file":"e2e/next-head/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct head tags from a fragment","suites":["should set-up next"],"updatePoint":{"line":43,"column":51},"line":43,"code":"  it('should have correct head tags from a fragment', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    const $ = cheerio.load(html)\n\n    expect($(`meta[name=\"test-in-fragment\"]`).attr()['content']).toBe('hello')\n  })","file":"e2e/next-head/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct head tags after hydration","suites":["should set-up next"],"updatePoint":{"line":50,"column":51},"line":50,"code":"  it('should have correct head tags after hydration', async () => {\n    const browser = await webdriver(next.url, '/')\n\n    for (let i = 1; i < 5; i++) {\n      expect(\n        await browser\n          .elementByCss(`meta[name=\"test-head-${i}\"]`)\n          .getAttribute('content')\n      ).toBe('hello')\n    }\n  })","file":"e2e/next-head/index.test.ts","skipped":false,"dir":"test"},{"name":"should have current head tags from a _document getInitialProps","suites":["should set-up next"],"updatePoint":{"line":62,"column":68},"line":62,"code":"  it('should have current head tags from a _document getInitialProps', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    const $ = cheerio.load(html)\n\n    expect($(`meta[name=\"test-head-initial-props\"]`).attr()['content']).toBe(\n      'hello'\n    )\n  })","file":"e2e/next-head/index.test.ts","skipped":false,"dir":"test"},{"name":"Script is injected server-side","suites":["beforeInteractive in document Head"],"updatePoint":{"line":52,"column":36},"line":52,"code":"  it('Script is injected server-side', async () => {\n    let browser: BrowserInterface\n\n    try {\n      browser = await webdriver(next.url, '/')\n\n      const script = await browser.eval(\n        `document.querySelector('script[data-nscript=\"beforeInteractive\"]')`\n      )\n      expect(script).not.toBeNull()\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"e2e/next-script/index.test.ts","skipped":false,"dir":"test"},{"name":"Script is injected server-side","suites":["beforeInteractive in document body"],"updatePoint":{"line":112,"column":36},"line":112,"code":"  it('Script is injected server-side', async () => {\n    let browser: BrowserInterface\n\n    try {\n      browser = await webdriver(next.url, '/')\n\n      const script = await browser.eval(\n        `document.querySelector('script[data-nscript=\"beforeInteractive\"]')`\n      )\n\n      expect(script).not.toBeNull()\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"e2e/next-script/index.test.ts","skipped":false,"dir":"test"},{"name":"Partytown snippet is not injected to head if not enabled in configuration","suites":["experimental.nextScriptWorkers: false with no Partytown dependency"],"updatePoint":{"line":159,"column":79},"line":159,"code":"  it('Partytown snippet is not injected to head if not enabled in configuration', async () => {\n    let browser: BrowserInterface\n\n    try {\n      browser = await webdriver(next.url, '/')\n\n      const snippetScript = await browser.eval(\n        `document.querySelector('script[data-partytown]')`\n      )\n\n      expect(snippetScript).toEqual(null)\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"e2e/next-script/index.test.ts","skipped":false,"dir":"test"},{"name":"Partytown snippets are injected to head if enabled in configuration","suites":["experimental.nextScriptWorkers: true with required Partytown dependency for external script"],"updatePoint":{"line":213,"column":73},"line":213,"code":"  it('Partytown snippets are injected to head if enabled in configuration', async () => {\n    let browser: BrowserInterface\n\n    try {\n      browser = await webdriver(next.url, '/')\n\n      const snippetScript = await browser.eval(\n        `document.querySelector('script[data-partytown]').innerHTML`\n      )\n      const configScript = await browser.eval(\n        `document.querySelector('script[data-partytown-config]').innerHTML`\n      )\n\n      expect(snippetScript).not.toEqual(null)\n\n      // A default config is included that points to the correct folder that hosts partytown's static files\n      expect(configScript).not.toEqual(null)\n      expect(configScript.replace(/(?: *[\\n\\r])+ */g, '')).toEqual(\n        'partytown = {lib: \"/_next/static/~partytown/\"};'\n      )\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"e2e/next-script/index.test.ts","skipped":false,"dir":"test"},{"name":"Worker scripts are modified by Partytown to execute on a worker thread","suites":["experimental.nextScriptWorkers: true with required Partytown dependency for external script"],"updatePoint":{"line":238,"column":76},"line":238,"code":"  it('Worker scripts are modified by Partytown to execute on a worker thread', async () => {\n    let browser: BrowserInterface\n\n    try {\n      browser = await webdriver(next.url, '/')\n\n      // Partytown modifies type to \"text/partytown-x\" after it has been executed in the web worker\n      await check(async () => {\n        const processedWorkerScripts = await browser.eval(\n          `document.querySelectorAll('script[type=\"text/partytown-x\"]').length`\n        )\n        return processedWorkerScripts > 0 ? 'success' : processedWorkerScripts\n      }, 'success')\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"e2e/next-script/index.test.ts","skipped":false,"dir":"test"},{"name":"Inline worker script through children is modified by Partytown to execute on a worker thread","suites":["experimental.nextScriptWorkers: true with required Partytown dependency for inline script"],"updatePoint":{"line":288,"column":98},"line":288,"code":"  it('Inline worker script through children is modified by Partytown to execute on a worker thread', async () => {\n    let next: NextInstance\n    let browser: BrowserInterface\n\n    next = await createNextApp(\n      `<Script id=\"inline-script\" strategy=\"worker\">{\"document.getElementById('text').textContent += 'abc'\"}</Script>`\n    )\n\n    try {\n      browser = await webdriver(next.url, '/')\n\n      // Partytown modifies type to \"text/partytown-x\" after it has been executed in the web worker\n      await check(async () => {\n        const processedWorkerScripts = await browser.eval(\n          `document.querySelectorAll('script[type=\"text/partytown-x\"]').length`\n        )\n        return processedWorkerScripts + ''\n      }, '1')\n\n      const text = await browser.elementById('text').text()\n      expect(text).toBe('abc')\n    } finally {\n      if (browser) await browser.close()\n      await next.destroy()\n    }\n  })","file":"e2e/next-script/index.test.ts","skipped":false,"dir":"test"},{"name":"Inline worker script through dangerouslySetInnerHtml is modified by Partytown to execute on a worker thread","suites":["experimental.nextScriptWorkers: true with required Partytown dependency for inline script"],"updatePoint":{"line":315,"column":113},"line":315,"code":"  it('Inline worker script through dangerouslySetInnerHtml is modified by Partytown to execute on a worker thread', async () => {\n    let next: NextInstance\n    let browser: BrowserInterface\n\n    next = await createNextApp(\n      `<Script id=\"inline-script\" strategy=\"worker\" dangerouslySetInnerHTML={{__html: \"document.getElementById('text').textContent += 'abcd'\"}}/>`\n    )\n\n    try {\n      browser = await webdriver(next.url, '/')\n\n      // Partytown modifies type to \"text/partytown-x\" after it has been executed in the web worker\n      await check(async () => {\n        const processedWorkerScripts = await browser.eval(\n          `document.querySelectorAll('script[type=\"text/partytown-x\"]').length`\n        )\n        return processedWorkerScripts + ''\n      }, '1')\n\n      const text = await browser.elementById('text').text()\n      expect(text).toBe('abcd')\n    } finally {\n      if (browser) await browser.close()\n      await next.destroy()\n    }\n  })","file":"e2e/next-script/index.test.ts","skipped":false,"dir":"test"},{"name":"Partytown config script is overwritten","suites":["experimental.nextScriptWorkers: true with config override"],"updatePoint":{"line":409,"column":44},"line":409,"code":"  it('Partytown config script is overwritten', async () => {\n    let browser: BrowserInterface\n\n    try {\n      browser = await webdriver(next.url, '/')\n\n      const configScript = await browser.eval(\n        `document.querySelector('script[data-partytown-config]').innerHTML`\n      )\n\n      expect(configScript).not.toEqual(null)\n      expect(configScript.replace(/(?: *[\\n\\r])+ */g, '')).toEqual(\n        'partytown = {lib: \"/_next/static/~partytown/\",debug: true};'\n      )\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"e2e/next-script/index.test.ts","skipped":false,"dir":"test"},{"name":"should skip for deploy","suites":["no-eslint-warn-with-no-eslint-config"],"updatePoint":{"line":9,"column":30},"line":9,"code":"    it('should skip for deploy', () => {})","file":"e2e/no-eslint-warn-with-no-eslint-config/index.test.ts","skipped":false,"dir":"test"},{"name":"should render","suites":["no-eslint-warn-with-no-eslint-config"],"updatePoint":{"line":27,"column":19},"line":27,"code":"  it('should render', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toContain('hello world')\n  })","file":"e2e/no-eslint-warn-with-no-eslint-config/index.test.ts","skipped":false,"dir":"test"},{"name":"should not have eslint warnings when no eslint config","suites":["no-eslint-warn-with-no-eslint-config"],"updatePoint":{"line":32,"column":59},"line":32,"code":"  it('should not have eslint warnings when no eslint config', async () => {\n    expect(next.cliOutput).not.toContain(\n      'No ESLint configuration detected. Run next lint to begin setup'\n    )\n    expect(next.cliOutput).not.toBe('warn')\n  })","file":"e2e/no-eslint-warn-with-no-eslint-config/index.test.ts","skipped":false,"dir":"test"},{"name":"should warn with empty eslintrc","suites":["no-eslint-warn-with-no-eslint-config"],"updatePoint":{"line":40,"column":39},"line":40,"code":"    it('should warn with empty eslintrc', async () => {\n      await next.stop()\n      await next.patchFile('.eslintrc.json', '{}')\n      await next.start()\n\n      expect(next.cliOutput).toContain(\n        'No ESLint configuration detected. Run next lint to begin setup'\n      )\n    })","file":"e2e/no-eslint-warn-with-no-eslint-config/index.test.ts","skipped":false,"dir":"test"},{"name":"should warn with empty eslint config in package.json","suites":["no-eslint-warn-with-no-eslint-config"],"updatePoint":{"line":50,"column":60},"line":50,"code":"    it('should warn with empty eslint config in package.json', async () => {\n      await next.stop()\n      await next.deleteFile('.eslintrc.json')\n      const origPkgJson = await next.readFile('package.json')\n      const pkgJson = JSON.parse(origPkgJson)\n      pkgJson.eslintConfig = {}\n\n      try {\n        await next.patchFile('package.json', JSON.stringify(pkgJson))\n        await next.start()\n\n        expect(next.cliOutput).toContain(\n          'No ESLint configuration detected. Run next lint to begin setup'\n        )\n      } finally {\n        await next.patchFile('package.json', origPkgJson)\n      }\n    })","file":"e2e/no-eslint-warn-with-no-eslint-config/index.test.ts","skipped":false,"dir":"test"},{"name":"should not warn with eslint config in package.json","suites":["no-eslint-warn-with-no-eslint-config"],"updatePoint":{"line":69,"column":58},"line":69,"code":"    it('should not warn with eslint config in package.json', async () => {\n      await next.stop()\n      const origPkgJson = await next.readFile('package.json')\n      const pkgJson = JSON.parse(origPkgJson)\n      pkgJson.eslintConfig = { rules: { semi: 'off' } }\n\n      try {\n        await next.patchFile('package.json', JSON.stringify(pkgJson))\n        await next.start()\n\n        expect(next.cliOutput).not.toContain(\n          'No ESLint configuration detected. Run next lint to begin setup'\n        )\n      } finally {\n        await next.patchFile('package.json', origPkgJson)\n      }\n    })","file":"e2e/no-eslint-warn-with-no-eslint-config/index.test.ts","skipped":false,"dir":"test"},{"name":"should not re-execute the script when re-rendering","suites":["should set-up next"],"updatePoint":{"line":49,"column":56},"line":49,"code":"  it('should not re-execute the script when re-rendering', async () => {\n    await runTests('/')\n  })","file":"e2e/nonce-head-manager/index.test.ts","skipped":false,"dir":"test"},{"name":"should not re-execute the script when re-rendering with CSP header","suites":["should set-up next"],"updatePoint":{"line":53,"column":72},"line":53,"code":"  it('should not re-execute the script when re-rendering with CSP header', async () => {\n    await runTests('/csp')\n  })","file":"e2e/nonce-head-manager/index.test.ts","skipped":false,"dir":"test"},{"name":"works with postcss.config.cjs files","suites":["postcss-config-cjs"],"updatePoint":{"line":28,"column":41},"line":28,"code":"  it('works with postcss.config.cjs files', async () => {\n    let browser\n    try {\n      browser = await webdriver(next.url, '/')\n      const text = await browser.elementByCss('.text-6xl').text()\n      expect(text).toMatch(/Welcome to/)\n      const cssBlue = await browser\n        .elementByCss('#test-link')\n        .getComputedCss('color')\n      expect(cssBlue).toBe('rgb(37, 99, 235)')\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"e2e/postcss-config-cjs/index.test.ts","skipped":false,"dir":"test"},{"name":"should return prerendered page for correctly","suites":["Prerender crawler handling"],"updatePoint":{"line":54,"column":50},"line":54,"code":"  it('should return prerendered page for correctly', async () => {\n    const html = await renderViaHTTP(next.url, '/blog/first')\n    expect(html).not.toContain('Loading...')\n    expect(html).toContain('first')\n    expect(html).toContain('slug page')\n  })","file":"e2e/prerender-crawler.test.ts","skipped":false,"dir":"test"},{"name":"should return fallback for non-crawler correctly","suites":["Prerender crawler handling"],"updatePoint":{"line":61,"column":54},"line":61,"code":"  it('should return fallback for non-crawler correctly', async () => {\n    const html = await renderViaHTTP(next.url, '/blog/test-1', undefined, {\n      headers: {\n        'user-agent':\n          'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.82 Safari/537.36',\n      },\n    })\n    expect(html).toContain('Loading...')\n  })","file":"e2e/prerender-crawler.test.ts","skipped":false,"dir":"test"},{"name":"should block for crawler correctly","suites":["Prerender crawler handling"],"updatePoint":{"line":71,"column":40},"line":71,"code":"  it('should block for crawler correctly', async () => {\n    const userAgents = [\n      'Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)',\n      'Mozilla/5.0 (compatible; Bingbot/2.0; +http://www.bing.com/bingbot.htm)',\n      'Mozilla/5.0 (compatible; Yahoo! Slurp; http://help.yahoo.com/help/us/ysearch/slurp)',\n      'DuckDuckBot/1.0; (+http://duckduckgo.com/duckduckbot.html)',\n      'Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)',\n      'Mozilla/5.0 (compatible; YandexBot/3.0; +http://yandex.com/bots)',\n      'facebookexternalhit/1.0 (+http://www.facebook.com/externalhit_uatext.php)',\n      'ia_archiver (+http://www.alexa.com/site/help/webmasters; crawler@alexa.com)',\n    ]\n\n    for (const userAgent of userAgents) {\n      console.log('checking', { userAgent })\n      const uniqueSlug = `test-${Date.now()}${Math.random()}`\n\n      const html = await renderViaHTTP(\n        next.url,\n        `/blog/${uniqueSlug}`,\n        undefined,\n        {\n          headers: {\n            'user-agent': userAgent,\n          },\n        }\n      )\n      expect(html).not.toContain('Loading...')\n      expect(html).toContain(uniqueSlug)\n      expect(html).toContain('slug page')\n    }\n  })","file":"e2e/prerender-crawler.test.ts","skipped":false,"dir":"test"},{"name":"should render index correctly","suites":["prerender native module"],"updatePoint":{"line":27,"column":35},"line":27,"code":"  it('should render index correctly', async () => {\n    const browser = await webdriver(next.url, '/')\n    expect(await browser.elementByCss('#index').text()).toBe('index page')\n    expect(JSON.parse(await browser.elementByCss('#props').text())).toEqual({\n      index: true,\n    })\n  })","file":"e2e/prerender-native-module.test.ts","skipped":false,"dir":"test"},{"name":"should render /blog/first correctly","suites":["prerender native module"],"updatePoint":{"line":35,"column":41},"line":35,"code":"  it('should render /blog/first correctly', async () => {\n    const browser = await webdriver(next.url, '/blog/first')\n\n    expect(await browser.elementByCss('#blog').text()).toBe('blog page')\n    expect(JSON.parse(await browser.elementByCss('#props').text())).toEqual({\n      params: { slug: 'first' },\n      blog: true,\n      users: [\n        { id: 1, first_name: 'john', last_name: 'deux' },\n        { id: 2, first_name: 'zeit', last_name: 'geist' },\n      ],\n    })\n  })","file":"e2e/prerender-native-module.test.ts","skipped":false,"dir":"test"},{"name":"should render /blog/second correctly","suites":["prerender native module"],"updatePoint":{"line":49,"column":42},"line":49,"code":"  it('should render /blog/second correctly', async () => {\n    const browser = await webdriver(next.url, '/blog/second')\n    await browser.waitForElementByCss('#blog')\n\n    expect(await browser.elementByCss('#blog').text()).toBe('blog page')\n    expect(JSON.parse(await browser.elementByCss('#props').text())).toEqual({\n      params: { slug: 'second' },\n      blog: true,\n      users: [\n        { id: 1, first_name: 'john', last_name: 'deux' },\n        { id: 2, first_name: 'zeit', last_name: 'geist' },\n      ],\n    })\n  })","file":"e2e/prerender-native-module.test.ts","skipped":false,"dir":"test"},{"name":"should output traces","suites":["prerender native module"],"updatePoint":{"line":65,"column":28},"line":65,"code":"    it('should output traces', async () => {\n      const checks = [\n        {\n          page: '/_app',\n          tests: [\n            /webpack-runtime\\.js/,\n            /node_modules\\/react\\/index\\.js/,\n            /node_modules\\/react\\/package\\.json/,\n            /node_modules\\/react\\/cjs\\/react\\.production\\.min\\.js/,\n          ],\n          notTests: [],\n        },\n        {\n          page: '/blog/[slug]',\n          tests: [\n            /webpack-runtime\\.js/,\n            /node_modules\\/react\\/index\\.js/,\n            /node_modules\\/react\\/package\\.json/,\n            /node_modules\\/react\\/cjs\\/react\\.production\\.min\\.js/,\n            /node_modules\\/sqlite3\\/.*?\\.js/,\n            /node_modules\\/sqlite3\\/.*?\\.node/,\n            /node_modules\\/sqlite\\/.*?\\.js/,\n            /node_modules\\/next/,\n            /next\\/router\\.js/,\n            /next\\/dist\\/client\\/router\\.js/,\n            /\\/data\\.sqlite/,\n          ],\n          notTests: [],\n        },\n      ]\n\n      for (const check of checks) {\n        const contents = await next.readFile(\n          path.join('.next/server/pages/', check.page + '.js.nft.json')\n        )\n        const { version, files } = JSON.parse(contents)\n        expect(version).toBe(1)\n\n        expect(\n          check.tests.every((item) => files.some((file) => item.test(file)))\n        ).toBe(true)\n\n        if (path.sep === '/') {\n          expect(\n            check.notTests.some((item) => files.some((file) => item.test(file)))\n          ).toBe(false)\n        }\n      }\n    })","file":"e2e/prerender-native-module.test.ts","skipped":false,"dir":"test"},{"name":"should navigate between pages successfully","suites":["Prerender"],"updatePoint":{"line":291,"column":50},"line":291,"code":"    it('should navigate between pages successfully', async () => {\n      const toBuild = [\n        '/',\n        '/another',\n        '/something',\n        '/normal',\n        '/blog/post-1',\n        '/blog/post-1/comment-1',\n        '/catchall/first',\n      ]\n\n      await waitFor(2500)\n\n      await Promise.all(toBuild.map((pg) => renderViaHTTP(next.url, pg)))\n\n      const browser = await webdriver(next.url, '/')\n      let text = await browser.elementByCss('p').text()\n      expect(text).toMatch(/hello.*?world/)\n\n      // go to /another\n      async function goFromHomeToAnother() {\n        await browser.eval('window.beforeAnother = true')\n        await browser.elementByCss('#another').click()\n        await browser.waitForElementByCss('#home')\n        text = await browser.elementByCss('p').text()\n        expect(await browser.eval('window.beforeAnother')).toBe(true)\n        expect(text).toMatch(/hello.*?world/)\n      }\n      await goFromHomeToAnother()\n\n      // go to /\n      async function goFromAnotherToHome() {\n        await browser.eval('window.didTransition = 1')\n        await browser.elementByCss('#home').click()\n        await browser.waitForElementByCss('#another')\n        text = await browser.elementByCss('p').text()\n        expect(text).toMatch(/hello.*?world/)\n        expect(await browser.eval('window.didTransition')).toBe(1)\n      }\n      await goFromAnotherToHome()\n\n      // Client-side SSG data caching test\n      // eslint-disable-next-line no-lone-blocks\n      {\n        // Let revalidation period lapse\n        await waitFor(2000)\n\n        // Trigger revalidation (visit page)\n        await goFromHomeToAnother()\n        const snapTime = await browser.elementByCss('#anotherTime').text()\n\n        // Wait for revalidation to finish\n        await waitFor(2000)\n\n        // Re-visit page\n        await goFromAnotherToHome()\n        await goFromHomeToAnother()\n\n        const nextTime = await browser.elementByCss('#anotherTime').text()\n        // in dev the time should always differ as we don't cache\n        // in production the time may differ or may not depending\n        // on if fresh content beat the stale content\n        if (isDev) {\n          expect(snapTime).not.toMatch(nextTime)\n        }\n        // Reset to Home for next test\n        await goFromAnotherToHome()\n      }\n\n      // go to /something\n      await browser.elementByCss('#something').click()\n      await browser.waitForElementByCss('#home')\n      text = await browser.elementByCss('p').text()\n      expect(text).toMatch(/hello.*?world/)\n      expect(await browser.eval('window.didTransition')).toBe(1)\n\n      // go to /\n      await browser.elementByCss('#home').click()\n      await browser.waitForElementByCss('#post-1')\n\n      // go to /blog/post-1\n      await browser.elementByCss('#post-1').click()\n      await browser.waitForElementByCss('#home')\n      text = await browser.elementByCss('p').text()\n      expect(text).toMatch(/Post:.*?post-1/)\n      expect(await browser.eval('window.didTransition')).toBe(1)\n\n      // go to /\n      await browser.elementByCss('#home').click()\n      await browser.waitForElementByCss('#comment-1')\n\n      // TODO: investigate index/index\n      // go to /index\n      // await browser.elementByCss('#to-nested-index').click()\n      // await browser.waitForElementByCss('#home')\n      // text = await browser.elementByCss('p').text()\n      // expect(text).toMatch(/hello nested index/)\n\n      // go to /\n      // await browser.elementByCss('#home').click()\n      // await browser.waitForElementByCss('#comment-1')\n\n      // go to /catchall-optional\n      await browser.elementByCss('#catchall-optional-root').click()\n      await browser.waitForElementByCss('#home')\n      text = await browser.elementByCss('p').text()\n      expect(text).toMatch(/Catch all: \\[\\]/)\n      expect(await browser.eval('window.didTransition')).toBe(1)\n\n      // go to /\n      await browser.elementByCss('#home').click()\n      await browser.waitForElementByCss('#comment-1')\n\n      // go to /dynamic/[first]\n      await browser.elementByCss('#dynamic-first').click()\n      await browser.waitForElementByCss('#home')\n      text = await browser.elementByCss('#param').text()\n      expect(text).toMatch(/Hi \\[first\\]!/)\n      expect(await browser.eval('window.didTransition')).toBe(1)\n\n      // go to /\n      await browser.elementByCss('#home').click()\n      await browser.waitForElementByCss('#comment-1')\n\n      // go to /dynamic/[second]\n      await browser.elementByCss('#dynamic-second').click()\n      await browser.waitForElementByCss('#home')\n      text = await browser.elementByCss('#param').text()\n      expect(text).toMatch(/Hi \\[second\\]!/)\n      expect(await browser.eval('window.didTransition')).toBe(1)\n\n      // go to /\n      await browser.elementByCss('#home').click()\n      await browser.waitForElementByCss('#comment-1')\n\n      // go to /catchall-explicit/[first]/[second]\n      await browser.elementByCss('#catchall-explicit-string').click()\n      await browser.waitForElementByCss('#home')\n      text = await browser.elementByCss('#catchall').text()\n      expect(text).toMatch(/Hi \\[first\\] \\[second\\]/)\n      expect(await browser.eval('window.didTransition')).toBe(1)\n\n      // go to /\n      await browser.elementByCss('#home').click()\n      await browser.waitForElementByCss('#comment-1')\n\n      // go to /catchall-explicit/[first]/[second]\n      await browser.elementByCss('#catchall-explicit-object').click()\n      await browser.waitForElementByCss('#home')\n      text = await browser.elementByCss('#catchall').text()\n      expect(text).toMatch(/Hi \\[third\\] \\[fourth\\]/)\n      expect(await browser.eval('window.didTransition')).toBe(1)\n\n      // go to /\n      await browser.elementByCss('#home').click()\n      await browser.waitForElementByCss('#comment-1')\n\n      // go to /catchall-optional/value\n      await browser.elementByCss('#catchall-optional-value').click()\n      await browser.waitForElementByCss('#home')\n      text = await browser.elementByCss('p').text()\n      expect(text).toMatch(/Catch all: \\[value\\]/)\n      expect(await browser.eval('window.didTransition')).toBe(1)\n\n      // go to /\n      await browser.elementByCss('#home').click()\n      await browser.waitForElementByCss('#comment-1')\n\n      // go to /blog/post-1/comment-1\n      await browser.elementByCss('#comment-1').click()\n      await browser.waitForElementByCss('#home')\n      text = await browser.elementByCss('p:nth-child(2)').text()\n      expect(text).toMatch(/Comment:.*?comment-1/)\n      expect(await browser.eval('window.didTransition')).toBe(1)\n\n      // go to /catchall/first\n      await browser.elementByCss('#home').click()\n      await browser.waitForElementByCss('#to-catchall')\n      await browser.elementByCss('#to-catchall').click()\n      await browser.waitForElementByCss('#catchall')\n      text = await browser.elementByCss('#catchall').text()\n      expect(text).toMatch(/Hi.*?first/)\n      expect(await browser.eval('window.didTransition')).toBe(1)\n\n      await browser.close()\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should respond with 405 for POST to static page","suites":["Prerender"],"updatePoint":{"line":482,"column":55},"line":482,"code":"    it('should respond with 405 for POST to static page', async () => {\n      const res = await fetchViaHTTP(next.url, '/', undefined, {\n        method: 'POST',\n      })\n      expect(res.status).toBe(405)\n\n      if (!isDeploy) {\n        expect(await res.text()).toContain('Method Not Allowed')\n      }\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should SSR normal page correctly","suites":["Prerender"],"updatePoint":{"line":493,"column":40},"line":493,"code":"    it('should SSR normal page correctly', async () => {\n      const html = await renderViaHTTP(next.url, '/')\n      expect(html).toMatch(/hello.*?world/)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should SSR incremental page correctly","suites":["Prerender"],"updatePoint":{"line":498,"column":45},"line":498,"code":"    it('should SSR incremental page correctly', async () => {\n      const html = await renderViaHTTP(next.url, '/blog/post-1')\n\n      const $ = cheerio.load(html)\n      expect(JSON.parse($('#__NEXT_DATA__').text()).isFallback).toBe(false)\n      expect(html).toMatch(/Post:.*?post-1/)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should SSR blocking path correctly (blocking)","suites":["Prerender"],"updatePoint":{"line":506,"column":53},"line":506,"code":"    it('should SSR blocking path correctly (blocking)', async () => {\n      const html = await renderViaHTTP(\n        next.url,\n        '/blocking-fallback/random-path'\n      )\n      const $ = cheerio.load(html)\n      expect(JSON.parse($('#__NEXT_DATA__').text()).isFallback).toBe(false)\n      expect($('p').text()).toBe('Post: random-path')\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should SSR blocking path correctly (pre-rendered)","suites":["Prerender"],"updatePoint":{"line":516,"column":57},"line":516,"code":"    it('should SSR blocking path correctly (pre-rendered)', async () => {\n      const html = await renderViaHTTP(next.url, '/blocking-fallback-some/a')\n      const $ = cheerio.load(html)\n      expect(JSON.parse($('#__NEXT_DATA__').text()).isFallback).toBe(false)\n      expect($('p').text()).toBe('Post: a')\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should have gsp in __NEXT_DATA__","suites":["Prerender"],"updatePoint":{"line":523,"column":40},"line":523,"code":"    it('should have gsp in __NEXT_DATA__', async () => {\n      const html = await renderViaHTTP(next.url, '/')\n      const $ = cheerio.load(html)\n      expect(JSON.parse($('#__NEXT_DATA__').text()).gsp).toBe(true)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should not have gsp in __NEXT_DATA__ for non-GSP page","suites":["Prerender"],"updatePoint":{"line":529,"column":61},"line":529,"code":"    it('should not have gsp in __NEXT_DATA__ for non-GSP page', async () => {\n      const html = await renderViaHTTP(next.url, '/normal')\n      const $ = cheerio.load(html)\n      expect('gsp' in JSON.parse($('#__NEXT_DATA__').text())).toBe(false)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should not supply query values to params or useRouter non-dynamic page SSR","suites":["Prerender"],"updatePoint":{"line":535,"column":82},"line":535,"code":"    it('should not supply query values to params or useRouter non-dynamic page SSR', async () => {\n      const html = await renderViaHTTP(next.url, '/something?hello=world')\n      const $ = cheerio.load(html)\n      const query = $('#query').text()\n      expect(JSON.parse(query)).toEqual({})\n      const params = $('#params').text()\n      expect(JSON.parse(params)).toEqual({})\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should not supply query values to params in /_next/data request","suites":["Prerender"],"updatePoint":{"line":544,"column":71},"line":544,"code":"    it('should not supply query values to params in /_next/data request', async () => {\n      const data = JSON.parse(\n        await renderViaHTTP(\n          next.url,\n          `/_next/data/${next.buildId}/something.json?hello=world`\n        )\n      )\n      expect(data.pageProps.params).toEqual({})\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should not supply query values to params or useRouter dynamic page SSR","suites":["Prerender"],"updatePoint":{"line":554,"column":78},"line":554,"code":"    it('should not supply query values to params or useRouter dynamic page SSR', async () => {\n      const html = await renderViaHTTP(next.url, '/blog/post-1?hello=world')\n      const $ = cheerio.load(html)\n\n      const params = $('#params').text()\n      expect(JSON.parse(params)).toEqual({ post: 'post-1' })\n\n      const query = $('#query').text()\n      expect(JSON.parse(query)).toEqual({ post: 'post-1' })\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should return data correctly","suites":["Prerender"],"updatePoint":{"line":565,"column":36},"line":565,"code":"    it('should return data correctly', async () => {\n      const data = JSON.parse(\n        await renderViaHTTP(\n          next.url,\n          `/_next/data/${next.buildId}/something.json`\n        )\n      )\n      expect(data.pageProps.world).toBe('world')\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should return data correctly for dynamic page","suites":["Prerender"],"updatePoint":{"line":575,"column":53},"line":575,"code":"    it('should return data correctly for dynamic page', async () => {\n      const data = JSON.parse(\n        await renderViaHTTP(\n          next.url,\n          `/_next/data/${next.buildId}/blog/post-1.json`\n        )\n      )\n      expect(data.pageProps.post).toBe('post-1')\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should return data correctly for dynamic page (non-seeded)","suites":["Prerender"],"updatePoint":{"line":585,"column":66},"line":585,"code":"    it('should return data correctly for dynamic page (non-seeded)', async () => {\n      const data = JSON.parse(\n        await renderViaHTTP(\n          next.url,\n          `/_next/data/${next.buildId}/blog/post-3.json`\n        )\n      )\n      expect(data.pageProps.post).toBe('post-3')\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should use correct caching headers for a revalidate page","suites":["Prerender"],"updatePoint":{"line":596,"column":66},"line":596,"code":"      it('should use correct caching headers for a revalidate page', async () => {\n        const initialRes = await fetchViaHTTP(next.url, '/')\n        expect(initialRes.headers.get('cache-control')).toBe(\n          isDeploy\n            ? 'public, max-age=0, must-revalidate'\n            : 's-maxage=2, stale-while-revalidate'\n        )\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should navigate to a normal page and back","suites":["Prerender"],"updatePoint":{"line":606,"column":49},"line":606,"code":"    it('should navigate to a normal page and back', async () => {\n      const browser = await webdriver(next.url, '/')\n      let text = await browser.elementByCss('p').text()\n      expect(text).toMatch(/hello.*?world/)\n\n      await browser.elementByCss('#normal').click()\n      await browser.waitForElementByCss('#normal-text')\n      text = await browser.elementByCss('#normal-text').text()\n      expect(text).toMatch(/a normal page/)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should parse query values on mount correctly","suites":["Prerender"],"updatePoint":{"line":617,"column":52},"line":617,"code":"    it('should parse query values on mount correctly', async () => {\n      const browser = await webdriver(next.url, '/blog/post-1?another=value')\n      const text = await browser.elementByCss('#query').text()\n      expect(text).toMatch(/another.*?value/)\n      expect(text).toMatch(/post.*?post-1/)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should reload page on failed data request","suites":["Prerender"],"updatePoint":{"line":624,"column":49},"line":624,"code":"    it('should reload page on failed data request', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.eval('window.beforeClick = \"abc\"')\n      await browser.elementByCss('#broken-post').click()\n      expect(\n        await check(() => browser.eval('window.beforeClick'), {\n          test(v) {\n            return v !== 'abc'\n          },\n        })\n      ).toBe(true)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should SSR dynamic page with brackets in param as object","suites":["Prerender"],"updatePoint":{"line":637,"column":64},"line":637,"code":"    it('should SSR dynamic page with brackets in param as object', async () => {\n      const html = await renderViaHTTP(next.url, '/dynamic/[first]')\n      const $ = cheerio.load(html)\n      expect($('#param').text()).toMatch(/Hi \\[first\\]!/)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should navigate to dynamic page with brackets in param as object","suites":["Prerender"],"updatePoint":{"line":643,"column":72},"line":643,"code":"    it('should navigate to dynamic page with brackets in param as object', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.elementByCss('#dynamic-first').click()\n      await browser.waitForElementByCss('#param')\n      const value = await browser.elementByCss('#param').text()\n      expect(value).toMatch(/Hi \\[first\\]!/)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should SSR dynamic page with brackets in param as string","suites":["Prerender"],"updatePoint":{"line":651,"column":64},"line":651,"code":"    it('should SSR dynamic page with brackets in param as string', async () => {\n      const html = await renderViaHTTP(next.url, '/dynamic/[second]')\n      const $ = cheerio.load(html)\n      expect($('#param').text()).toMatch(/Hi \\[second\\]!/)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should navigate to dynamic page with brackets in param as string","suites":["Prerender"],"updatePoint":{"line":657,"column":72},"line":657,"code":"    it('should navigate to dynamic page with brackets in param as string', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.elementByCss('#dynamic-second').click()\n      await browser.waitForElementByCss('#param')\n      const value = await browser.elementByCss('#param').text()\n      expect(value).toMatch(/Hi \\[second\\]!/)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should not return data for fallback: false and missing dynamic page","suites":["Prerender"],"updatePoint":{"line":665,"column":75},"line":665,"code":"    it('should not return data for fallback: false and missing dynamic page', async () => {\n      const res1 = await fetchViaHTTP(\n        next.url,\n        `/_next/data/${next.buildId}/dynamic/oopsie.json`\n      )\n      expect(res1.status).toBe(404)\n\n      await waitFor(500)\n\n      const res2 = await fetchViaHTTP(\n        next.url,\n        `/_next/data/${next.buildId}/dynamic/oopsie.json`\n      )\n      expect(res2.status).toBe(404)\n\n      await waitFor(500)\n\n      const res3 = await fetchViaHTTP(\n        next.url,\n        `/_next/data/${next.buildId}/dynamic/oopsie.json`\n      )\n      expect(res3.status).toBe(404)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should server prerendered path correctly for SSG pages that starts with api-docs","suites":["Prerender"],"updatePoint":{"line":689,"column":88},"line":689,"code":"    it('should server prerendered path correctly for SSG pages that starts with api-docs', async () => {\n      const html = await renderViaHTTP(next.url, '/api-docs/first')\n      const $ = cheerio.load(html)\n\n      expect($('#api-docs').text()).toBe('API Docs')\n      expect(JSON.parse($('#props').text())).toEqual({\n        hello: 'world',\n      })\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should render correctly for SSG pages that starts with api-docs","suites":["Prerender"],"updatePoint":{"line":699,"column":71},"line":699,"code":"    it('should render correctly for SSG pages that starts with api-docs', async () => {\n      const browser = await webdriver(next.url, '/api-docs/second')\n      await browser.waitForElementByCss('#api-docs')\n\n      expect(await browser.elementByCss('#api-docs').text()).toBe('API Docs')\n      expect(JSON.parse(await browser.elementByCss('#props').text())).toEqual({\n        hello: 'world',\n      })\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should return data correctly for SSG pages that starts with api-docs","suites":["Prerender"],"updatePoint":{"line":709,"column":76},"line":709,"code":"    it('should return data correctly for SSG pages that starts with api-docs', async () => {\n      const data = await renderViaHTTP(\n        next.url,\n        `/_next/data/${next.buildId}/api-docs/first.json`\n      )\n      const { pageProps } = JSON.parse(data)\n\n      expect(pageProps).toEqual({\n        hello: 'world',\n      })\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should SSR catch-all page with brackets in param as string","suites":["Prerender"],"updatePoint":{"line":721,"column":66},"line":721,"code":"    it('should SSR catch-all page with brackets in param as string', async () => {\n      const html = await renderViaHTTP(\n        next.url,\n        '/catchall-explicit/[first]/[second]'\n      )\n      const $ = cheerio.load(html)\n      expect($('#catchall').text()).toMatch(/Hi \\[first\\] \\[second\\]/)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should navigate to catch-all page with brackets in param as string","suites":["Prerender"],"updatePoint":{"line":730,"column":74},"line":730,"code":"    it('should navigate to catch-all page with brackets in param as string', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.elementByCss('#catchall-explicit-string').click()\n      await browser.waitForElementByCss('#catchall')\n      const value = await browser.elementByCss('#catchall').text()\n      expect(value).toMatch(/Hi \\[first\\] \\[second\\]/)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should SSR catch-all page with brackets in param as object","suites":["Prerender"],"updatePoint":{"line":738,"column":66},"line":738,"code":"    it('should SSR catch-all page with brackets in param as object', async () => {\n      const html = await renderViaHTTP(\n        next.url,\n        '/catchall-explicit/[third]/[fourth]'\n      )\n      const $ = cheerio.load(html)\n      expect($('#catchall').text()).toMatch(/Hi \\[third\\] \\[fourth\\]/)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should navigate to catch-all page with brackets in param as object","suites":["Prerender"],"updatePoint":{"line":747,"column":74},"line":747,"code":"    it('should navigate to catch-all page with brackets in param as object', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.elementByCss('#catchall-explicit-object').click()\n      await browser.waitForElementByCss('#catchall')\n      const value = await browser.elementByCss('#catchall').text()\n      expect(value).toMatch(/Hi \\[third\\] \\[fourth\\]/)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should show error about renaming unstable_revalidate","suites":["Prerender"],"updatePoint":{"line":756,"column":62},"line":756,"code":"      it('should show error about renaming unstable_revalidate', async () => {\n        const res = await fetchViaHTTP(next.url, '/api/manual-revalidate', {\n          pathname: '/blog/first',\n          deprecated: '1',\n        })\n        expect(res.status).toBe(500)\n\n        expect(next.cliOutput).toContain(\n          '\"unstable_revalidate\" has been renamed to \"revalidate\"'\n        )\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should reload page on failed data request, and retry","suites":["Prerender"],"line":772,"code":"      it.skip('should reload page on failed data request, and retry', async () => {","file":"e2e/prerender.test.ts","skipped":true,"dir":"test"},{"name":"should support prerendered catchall route","suites":["Prerender"],"updatePoint":{"line":789,"column":49},"line":789,"code":"    it('should support prerendered catchall route', async () => {\n      const html = await renderViaHTTP(next.url, '/catchall/another/value')\n      const $ = cheerio.load(html)\n\n      expect(\n        JSON.parse(cheerio.load(html)('#__NEXT_DATA__').text()).isFallback\n      ).toBe(false)\n      expect($('#catchall').text()).toMatch(/Hi.*?another value/)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should support lazy catchall route","suites":["Prerender"],"updatePoint":{"line":799,"column":42},"line":799,"code":"    it('should support lazy catchall route', async () => {\n      const html = await renderViaHTTP(next.url, '/catchall/notreturnedinpaths')\n      const $ = cheerio.load(html)\n      expect($('#catchall').text()).toBe('fallback')\n\n      // hydration\n      const browser = await webdriver(next.url, '/catchall/delayby3s')\n\n      const text1 = await browser.elementByCss('#catchall').text()\n      expect(text1).toBe('fallback')\n\n      await check(\n        () => browser.elementByCss('#catchall').text(),\n        /Hi.*?delayby3s/\n      )\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should support nested lazy catchall route","suites":["Prerender"],"updatePoint":{"line":816,"column":49},"line":816,"code":"    it('should support nested lazy catchall route', async () => {\n      // We will render fallback for a \"lazy\" route\n      const html = await renderViaHTTP(\n        next.url,\n        '/catchall/notreturnedinpaths/nested'\n      )\n      const $ = cheerio.load(html)\n      expect($('#catchall').text()).toBe('fallback')\n\n      // hydration\n      const browser = await webdriver(next.url, '/catchall/delayby3s/nested')\n\n      const text1 = await browser.elementByCss('#catchall').text()\n      expect(text1).toBe('fallback')\n\n      await check(\n        () => browser.elementByCss('#catchall').text(),\n        /Hi.*?delayby3s nested/\n      )\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should support prerendered catchall-explicit route (nested)","suites":["Prerender"],"updatePoint":{"line":837,"column":67},"line":837,"code":"    it('should support prerendered catchall-explicit route (nested)', async () => {\n      const html = await renderViaHTTP(\n        next.url,\n        '/catchall-explicit/another/value'\n      )\n      const $ = cheerio.load(html)\n\n      expect(\n        JSON.parse(cheerio.load(html)('#__NEXT_DATA__').text()).isFallback\n      ).toBe(false)\n      expect($('#catchall').text()).toMatch(/Hi.*?another value/)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should support prerendered catchall-explicit route (single)","suites":["Prerender"],"updatePoint":{"line":850,"column":67},"line":850,"code":"    it('should support prerendered catchall-explicit route (single)', async () => {\n      const html = await renderViaHTTP(next.url, '/catchall-explicit/second')\n      const $ = cheerio.load(html)\n\n      expect(\n        JSON.parse(cheerio.load(html)('#__NEXT_DATA__').text()).isFallback\n      ).toBe(false)\n      expect($('#catchall').text()).toMatch(/Hi.*?second/)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should handle fallback only page correctly HTML","suites":["Prerender"],"updatePoint":{"line":860,"column":55},"line":860,"code":"    it('should handle fallback only page correctly HTML', async () => {\n      const browser = await webdriver(next.url, '/fallback-only/first%2Fpost')\n\n      const text = await browser.elementByCss('p').text()\n      expect(text).toContain('hi fallback')\n\n      // wait for fallback data to load\n      await check(() => browser.elementByCss('p').text(), /Post/)\n\n      // check fallback data\n      const post = await browser.elementByCss('p').text()\n      const query = JSON.parse(await browser.elementByCss('#query').text())\n      const params = JSON.parse(await browser.elementByCss('#params').text())\n\n      expect(post).toContain('first/post')\n      expect(params).toEqual({\n        slug: 'first/post',\n      })\n      expect(query).toEqual(params)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should handle fallback only page correctly data","suites":["Prerender"],"updatePoint":{"line":881,"column":55},"line":881,"code":"    it('should handle fallback only page correctly data', async () => {\n      const data = JSON.parse(\n        await renderViaHTTP(\n          next.url,\n          `/_next/data/${next.buildId}/fallback-only/second%2Fpost.json`\n        )\n      )\n\n      expect(data.pageProps.params).toEqual({\n        slug: 'second/post',\n      })\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should 404 for a missing catchall explicit route","suites":["Prerender"],"updatePoint":{"line":894,"column":56},"line":894,"code":"    it('should 404 for a missing catchall explicit route', async () => {\n      const res = await fetchViaHTTP(\n        next.url,\n        '/catchall-explicit/notreturnedinpaths'\n      )\n      expect(res.status).toBe(404)\n      const html = await res.text()\n      expect(html).toMatch(/This page could not be found/)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should 404 for an invalid data url","suites":["Prerender"],"updatePoint":{"line":904,"column":42},"line":904,"code":"    it('should 404 for an invalid data url', async () => {\n      const res = await fetchViaHTTP(next.url, `/_next/data/${next.buildId}`)\n\n      // when deployed this will match due to `index.json` matching the\n      // directory itself\n      if (!isDeploy) {\n        expect(res.status).toBe(404)\n      }\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should allow rewriting to SSG page with fallback: false","suites":["Prerender"],"updatePoint":{"line":914,"column":63},"line":914,"code":"    it('should allow rewriting to SSG page with fallback: false', async () => {\n      const html = await renderViaHTTP(next.url, '/about')\n      expect(html).toMatch(/About:.*?en/)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should allow rewriting to SSG page with fallback: 'blocking'","suites":["Prerender"],"updatePoint":{"line":919,"column":68},"line":919,"code":"    it(\"should allow rewriting to SSG page with fallback: 'blocking'\", async () => {\n      const html = await renderViaHTTP(next.url, '/blocked-create')\n      expect(html).toMatch(/Post:.*?blocked-create/)\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should fetch /_next/data correctly with mismatched href and as","suites":["Prerender"],"updatePoint":{"line":924,"column":70},"line":924,"code":"    it('should fetch /_next/data correctly with mismatched href and as', async () => {\n      const browser = await webdriver(next.url, '/')\n\n      if (!isDev) {\n        await browser.eval(() =>\n          document.querySelector('#to-rewritten-ssg').scrollIntoView()\n        )\n\n        await check(async () => {\n          const hrefs = await browser.eval(\n            `Object.keys(window.next.router.sdc)`\n          )\n          hrefs.sort()\n          expect(\n            hrefs.map((href) =>\n              new URL(href).pathname.replace(/^\\/_next\\/data\\/[^/]+/, '')\n            )\n          ).toContainEqual('/lang/en/about.json')\n          return 'yes'\n        }, 'yes')\n      }\n      await browser.eval('window.beforeNav = \"hi\"')\n      await browser.elementByCss('#to-rewritten-ssg').click()\n      await browser.waitForElementByCss('#about')\n\n      expect(await browser.eval('window.beforeNav')).toBe('hi')\n      expect(await browser.elementByCss('#about').text()).toBe('About: en')\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should not error when rewriting to fallback dynamic SSG page","suites":["Prerender"],"updatePoint":{"line":953,"column":68},"line":953,"code":"    it('should not error when rewriting to fallback dynamic SSG page', async () => {\n      const item = Math.round(Math.random() * 100)\n      const browser = await webdriver(next.url, `/some-rewrite/${item}`)\n\n      await check(\n        () => browser.elementByCss('p').text(),\n        new RegExp(`Post: post-${item}`)\n      )\n\n      expect(JSON.parse(await browser.elementByCss('#params').text())).toEqual({\n        post: `post-${item}`,\n      })\n      expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n        post: `post-${item}`,\n      })\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should show warning when large amount of page data is returned","suites":["Prerender"],"updatePoint":{"line":970,"column":70},"line":970,"code":"    it('should show warning when large amount of page data is returned', async () => {\n      await renderViaHTTP(next.url, '/large-page-data')\n      await check(\n        () => next.cliOutput,\n        /Warning: data for page \"\\/large-page-data\" is 256 kB which exceeds the threshold of 128 kB, this amount of data can reduce performance/\n      )\n      await renderViaHTTP(next.url, '/blocking-fallback/lots-of-data')\n      await check(\n        () => next.cliOutput,\n        /Warning: data for page \"\\/blocking-fallback\\/\\[slug\\]\" \\(path \"\\/blocking-fallback\\/lots-of-data\"\\) is 256 kB which exceeds the threshold of 128 kB, this amount of data can reduce performance/\n      )\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should not show warning from url prop being returned","suites":["Prerender"],"updatePoint":{"line":984,"column":62},"line":984,"code":"      it('should not show warning from url prop being returned', async () => {\n        const urlPropPage = 'pages/url-prop.js'\n        await next.patchFile(\n          urlPropPage,\n          `\n        export async function getStaticProps() {\n          return {\n            props: {\n              url: 'something'\n            }\n          }\n        }\n\n        export default ({ url }) => <p>url: {url}</p>\n      `\n        )\n\n        const html = await renderViaHTTP(next.url, '/url-prop')\n        await next.deleteFile(urlPropPage)\n        expect(next.cliOutput).not.toMatch(\n          /The prop `url` is a reserved prop in Next.js for legacy reasons and will be overridden on page \\/url-prop/\n        )\n        expect(html).toMatch(/url:.*?something/)\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should always show fallback for page not in getStaticPaths","suites":["Prerender"],"updatePoint":{"line":1009,"column":68},"line":1009,"code":"      it('should always show fallback for page not in getStaticPaths', async () => {\n        const html = await renderViaHTTP(next.url, '/blog/post-321')\n        const $ = cheerio.load(html)\n        expect(JSON.parse($('#__NEXT_DATA__').text()).isFallback).toBe(true)\n\n        // make another request to ensure it still is\n        const html2 = await renderViaHTTP(next.url, '/blog/post-321')\n        const $2 = cheerio.load(html2)\n        expect(JSON.parse($2('#__NEXT_DATA__').text()).isFallback).toBe(true)\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should not show fallback for page in getStaticPaths","suites":["Prerender"],"updatePoint":{"line":1020,"column":61},"line":1020,"code":"      it('should not show fallback for page in getStaticPaths', async () => {\n        const html = await renderViaHTTP(next.url, '/blog/post-1')\n        const $ = cheerio.load(html)\n        expect(JSON.parse($('#__NEXT_DATA__').text()).isFallback).toBe(false)\n\n        // make another request to ensure it's still not\n        const html2 = await renderViaHTTP(next.url, '/blog/post-1')\n        const $2 = cheerio.load(html2)\n        expect(JSON.parse($2('#__NEXT_DATA__').text()).isFallback).toBe(false)\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should never show fallback for page not in getStaticPaths when blocking","suites":["Prerender"],"updatePoint":{"line":1031,"column":81},"line":1031,"code":"      it('should never show fallback for page not in getStaticPaths when blocking', async () => {\n        const html = await renderViaHTTP(\n          next.url,\n          '/blocking-fallback-some/asf'\n        )\n        const $ = cheerio.load(html)\n        expect(JSON.parse($('#__NEXT_DATA__').text()).isFallback).toBe(false)\n\n        // make another request to ensure it still is\n        const html2 = await renderViaHTTP(\n          next.url,\n          '/blocking-fallback-some/asf'\n        )\n        const $2 = cheerio.load(html2)\n        expect(JSON.parse($2('#__NEXT_DATA__').text()).isFallback).toBe(false)\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should not show fallback for page in getStaticPaths when blocking","suites":["Prerender"],"updatePoint":{"line":1048,"column":75},"line":1048,"code":"      it('should not show fallback for page in getStaticPaths when blocking', async () => {\n        const html = await renderViaHTTP(next.url, '/blocking-fallback-some/b')\n        const $ = cheerio.load(html)\n        expect(JSON.parse($('#__NEXT_DATA__').text()).isFallback).toBe(false)\n\n        // make another request to ensure it's still not\n        const html2 = await renderViaHTTP(next.url, '/blocking-fallback-some/b')\n        const $2 = cheerio.load(html2)\n        expect(JSON.parse($2('#__NEXT_DATA__').text()).isFallback).toBe(false)\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should log error in console and browser in dev mode","suites":["Prerender"],"updatePoint":{"line":1059,"column":61},"line":1059,"code":"      it('should log error in console and browser in dev mode', async () => {\n        const indexPage = 'pages/index.js'\n        const origContent = await next.readFile(indexPage)\n\n        const browser = await webdriver(next.url, '/')\n        expect(await browser.elementByCss('p').text()).toMatch(/hello.*?world/)\n\n        await next.patchFile(\n          indexPage,\n          origContent\n            .replace('// throw new', 'throw new')\n            .replace('{/* <div', '<div')\n            .replace('</div> */}', '</div>')\n        )\n        await browser.waitForElementByCss('#after-change')\n        // we need to reload the page to trigger getStaticProps\n        await browser.refresh()\n\n        expect(await hasRedbox(browser)).toBe(true)\n        const errOverlayContent = await getRedboxHeader(browser)\n\n        await next.patchFile(indexPage, origContent)\n        const errorMsg = /oops from getStaticProps/\n        expect(next.cliOutput).toMatch(errorMsg)\n        expect(errOverlayContent).toMatch(errorMsg)\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should always call getStaticProps without caching in dev","suites":["Prerender"],"updatePoint":{"line":1086,"column":66},"line":1086,"code":"      it('should always call getStaticProps without caching in dev', async () => {\n        const initialRes = await fetchViaHTTP(next.url, '/something')\n        expect(isCachingHeader(initialRes.headers.get('cache-control'))).toBe(\n          false\n        )\n        const initialHtml = await initialRes.text()\n        expect(initialHtml).toMatch(/hello.*?world/)\n\n        const newRes = await fetchViaHTTP(next.url, '/something')\n        expect(isCachingHeader(newRes.headers.get('cache-control'))).toBe(false)\n        const newHtml = await newRes.text()\n        expect(newHtml).toMatch(/hello.*?world/)\n        expect(initialHtml !== newHtml).toBe(true)\n\n        const newerRes = await fetchViaHTTP(next.url, '/something')\n        expect(isCachingHeader(newerRes.headers.get('cache-control'))).toBe(\n          false\n        )\n        const newerHtml = await newerRes.text()\n        expect(newerHtml).toMatch(/hello.*?world/)\n        expect(newHtml !== newerHtml).toBe(true)\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should error on bad object from getStaticProps","suites":["Prerender"],"updatePoint":{"line":1109,"column":56},"line":1109,"code":"      it('should error on bad object from getStaticProps', async () => {\n        const indexPage = 'pages/index.js'\n        const origContent = await next.readFile(indexPage)\n        await next.patchFile(\n          indexPage,\n          origContent.replace(/\\/\\/ bad-prop/, 'another: true,')\n        )\n        await waitFor(1000)\n        try {\n          const html = await renderViaHTTP(next.url, '/')\n          expect(html).toMatch(/Additional keys were returned/)\n        } finally {\n          await next.patchFile(indexPage, origContent)\n        }\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should error on dynamic page without getStaticPaths","suites":["Prerender"],"updatePoint":{"line":1125,"column":61},"line":1125,"code":"      it('should error on dynamic page without getStaticPaths', async () => {\n        const curPage = 'pages/temp/[slug].js'\n        await next.patchFile(\n          curPage,\n          `\n          export async function getStaticProps() {\n            return {\n              props: {\n                hello: 'world'\n              }\n            }\n          }\n          export default () => 'oops'\n        `\n        )\n        await waitFor(1000)\n        try {\n          const html = await renderViaHTTP(next.url, '/temp/hello')\n          expect(html).toMatch(\n            /getStaticPaths is required for dynamic SSG pages and is missing for/\n          )\n        } finally {\n          await next.deleteFile(curPage)\n        }\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should error on dynamic page without getStaticPaths returning fallback property","suites":["Prerender"],"updatePoint":{"line":1151,"column":89},"line":1151,"code":"      it('should error on dynamic page without getStaticPaths returning fallback property', async () => {\n        const curPage = 'pages/temp2/[slug].js'\n        await next.patchFile(\n          curPage,\n          `\n          export async function getStaticPaths() {\n            return {\n              paths: []\n            }\n          }\n          export async function getStaticProps() {\n            return {\n              props: {\n                hello: 'world'\n              }\n            }\n          }\n          export default () => 'oops'\n        `\n        )\n        await waitFor(1000)\n        try {\n          const html = await renderViaHTTP(next.url, '/temp2/hello')\n          expect(html).toMatch(/`fallback` key must be returned from/)\n        } finally {\n          await next.deleteFile(curPage)\n        }\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should not re-call getStaticProps when updating query","suites":["Prerender"],"updatePoint":{"line":1180,"column":63},"line":1180,"code":"      it('should not re-call getStaticProps when updating query', async () => {\n        const browser = await webdriver(next.url, '/something?hello=world')\n        await waitFor(2000)\n\n        const query = await browser.elementByCss('#query').text()\n        expect(JSON.parse(query)).toEqual({ hello: 'world' })\n\n        const {\n          props: {\n            pageProps: { random: initialRandom },\n          },\n        } = await browser.eval('window.__NEXT_DATA__')\n\n        const curRandom = await browser.elementByCss('#random').text()\n        expect(curRandom).toBe(initialRandom + '')\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should show fallback before invalid JSON is returned from getStaticProps","suites":["Prerender"],"updatePoint":{"line":1197,"column":82},"line":1197,"code":"      it('should show fallback before invalid JSON is returned from getStaticProps', async () => {\n        const html = await renderViaHTTP(next.url, '/non-json/foobar')\n        expect(html).toContain('\"isFallback\":true')\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should not fallback before invalid JSON is returned from getStaticProps when blocking fallback","suites":["Prerender"],"updatePoint":{"line":1202,"column":104},"line":1202,"code":"      it('should not fallback before invalid JSON is returned from getStaticProps when blocking fallback', async () => {\n        const html = await renderViaHTTP(next.url, '/non-json-blocking/foobar')\n        expect(html).toContain('\"isFallback\":false')\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should show error for invalid JSON returned from getStaticProps on SSR","suites":["Prerender"],"updatePoint":{"line":1207,"column":80},"line":1207,"code":"      it('should show error for invalid JSON returned from getStaticProps on SSR', async () => {\n        const browser = await webdriver(next.url, '/non-json/direct')\n\n        // FIXME: enable this\n        // expect(await getRedboxHeader(browser)).toMatch(\n        //   /Error serializing `.time` returned from `getStaticProps`/\n        // )\n\n        // FIXME: disable this\n        expect(await hasRedbox(browser)).toBe(true)\n        expect(await getRedboxHeader(browser)).toMatch(\n          /Failed to load static props/\n        )\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should show error for invalid JSON returned from getStaticProps on CST","suites":["Prerender"],"updatePoint":{"line":1222,"column":80},"line":1222,"code":"      it('should show error for invalid JSON returned from getStaticProps on CST', async () => {\n        const browser = await webdriver(next.url, '/')\n        await browser.elementByCss('#non-json').click()\n\n        // FIXME: enable this\n        // expect(await getRedboxHeader(browser)).toMatch(\n        //   /Error serializing `.time` returned from `getStaticProps`/\n        // )\n\n        // FIXME: disable this\n        expect(await hasRedbox(browser)).toBe(true)\n        expect(await getRedboxHeader(browser)).toMatch(\n          /Failed to load static props/\n        )\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should not contain headers already sent error","suites":["Prerender"],"updatePoint":{"line":1238,"column":55},"line":1238,"code":"      it('should not contain headers already sent error', async () => {\n        await renderViaHTTP(next.url, '/fallback-only/some-fallback-post')\n        expect(next.cliOutput).not.toContain('ERR_HTTP_HEADERS_SENT')\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should use correct caching headers for a no-revalidate page","suites":["Prerender"],"updatePoint":{"line":1243,"column":69},"line":1243,"code":"      it('should use correct caching headers for a no-revalidate page', async () => {\n        const initialRes = await fetchViaHTTP(next.url, '/something')\n        expect(initialRes.headers.get('cache-control')).toBe(\n          isDeploy\n            ? 'public, max-age=0, must-revalidate'\n            : 's-maxage=31536000, stale-while-revalidate'\n        )\n        const initialHtml = await initialRes.text()\n        expect(initialHtml).toMatch(/hello.*?world/)\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should not show error for invalid JSON returned from getStaticProps on SSR","suites":["Prerender"],"updatePoint":{"line":1254,"column":84},"line":1254,"code":"      it('should not show error for invalid JSON returned from getStaticProps on SSR', async () => {\n        const browser = await webdriver(next.url, '/non-json/direct')\n\n        await check(() => getBrowserBodyText(browser), /hello /)\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should not show error for invalid JSON returned from getStaticProps on CST","suites":["Prerender"],"updatePoint":{"line":1260,"column":84},"line":1260,"code":"      it('should not show error for invalid JSON returned from getStaticProps on CST', async () => {\n        const browser = await webdriver(next.url, '/')\n        await browser.elementByCss('#non-json').click()\n        await check(() => getBrowserBodyText(browser), /hello /)\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"outputs dataRoutes in routes-manifest correctly","suites":["Prerender"],"updatePoint":{"line":1267,"column":59},"line":1267,"code":"        it('outputs dataRoutes in routes-manifest correctly', async () => {\n          const { dataRoutes } = JSON.parse(\n            await next.readFile('.next/routes-manifest.json')\n          )\n\n          for (const route of dataRoutes) {\n            route.dataRouteRegex = normalizeRegEx(route.dataRouteRegex)\n          }\n\n          expect(dataRoutes).toEqual([\n            {\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(next.buildId)}\\\\/index.json$`\n              ),\n              page: '/',\n            },\n            {\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                  next.buildId\n                )}\\\\/another.json$`\n              ),\n              page: '/another',\n            },\n            {\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                  next.buildId\n                )}\\\\/api\\\\-docs\\\\/(.+?)\\\\.json$`\n              ),\n              namedDataRouteRegex: `^/_next/data/${escapeRegex(\n                next.buildId\n              )}/api\\\\-docs/(?<slug>.+?)\\\\.json$`,\n              page: '/api-docs/[...slug]',\n              routeKeys: {\n                slug: 'slug',\n              },\n            },\n            {\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                  next.buildId\n                )}\\\\/bad-gssp.json$`\n              ),\n              page: '/bad-gssp',\n            },\n            {\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                  next.buildId\n                )}\\\\/bad-ssr.json$`\n              ),\n              page: '/bad-ssr',\n            },\n            {\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                  next.buildId\n                )}\\\\/blocking\\\\-fallback\\\\/([^\\\\/]+?)\\\\.json$`\n              ),\n              namedDataRouteRegex: `^/_next/data/${escapeRegex(\n                next.buildId\n              )}/blocking\\\\-fallback/(?<slug>[^/]+?)\\\\.json$`,\n              page: '/blocking-fallback/[slug]',\n              routeKeys: { slug: 'slug' },\n            },\n            {\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                  next.buildId\n                )}\\\\/blocking\\\\-fallback\\\\-once\\\\/([^\\\\/]+?)\\\\.json$`\n              ),\n              namedDataRouteRegex: `^/_next/data/${escapeRegex(\n                next.buildId\n              )}/blocking\\\\-fallback\\\\-once/(?<slug>[^/]+?)\\\\.json$`,\n              page: '/blocking-fallback-once/[slug]',\n              routeKeys: { slug: 'slug' },\n            },\n            {\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                  next.buildId\n                )}\\\\/blocking\\\\-fallback\\\\-some\\\\/([^\\\\/]+?)\\\\.json$`\n              ),\n              namedDataRouteRegex: `^/_next/data/${escapeRegex(\n                next.buildId\n              )}/blocking\\\\-fallback\\\\-some/(?<slug>[^/]+?)\\\\.json$`,\n              page: '/blocking-fallback-some/[slug]',\n              routeKeys: { slug: 'slug' },\n            },\n            {\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(next.buildId)}\\\\/blog.json$`\n              ),\n              page: '/blog',\n            },\n            {\n              namedDataRouteRegex: `^/_next/data/${escapeRegex(\n                next.buildId\n              )}/blog/(?<post>[^/]+?)\\\\.json$`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                  next.buildId\n                )}\\\\/blog\\\\/([^\\\\/]+?)\\\\.json$`\n              ),\n              page: '/blog/[post]',\n              routeKeys: {\n                post: 'post',\n              },\n            },\n            {\n              namedDataRouteRegex: `^/_next/data/${escapeRegex(\n                next.buildId\n              )}/blog/(?<post>[^/]+?)/(?<comment>[^/]+?)\\\\.json$`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                  next.buildId\n                )}\\\\/blog\\\\/([^\\\\/]+?)\\\\/([^\\\\/]+?)\\\\.json$`\n              ),\n              page: '/blog/[post]/[comment]',\n              routeKeys: {\n                post: 'post',\n                comment: 'comment',\n              },\n            },\n            {\n              namedDataRouteRegex: `^/_next/data/${escapeRegex(\n                next.buildId\n              )}/catchall/(?<slug>.+?)\\\\.json$`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                  next.buildId\n                )}\\\\/catchall\\\\/(.+?)\\\\.json$`\n              ),\n              page: '/catchall/[...slug]',\n              routeKeys: {\n                slug: 'slug',\n              },\n            },\n            {\n              namedDataRouteRegex: `^/_next/data/${escapeRegex(\n                next.buildId\n              )}/catchall\\\\-explicit/(?<slug>.+?)\\\\.json$`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                  next.buildId\n                )}\\\\/catchall\\\\-explicit\\\\/(.+?)\\\\.json$`\n              ),\n              page: '/catchall-explicit/[...slug]',\n              routeKeys: {\n                slug: 'slug',\n              },\n            },\n            {\n              namedDataRouteRegex: `^/_next/data/${escapeRegex(\n                next.buildId\n              )}/catchall\\\\-optional(?:/(?<slug>.+?))?\\\\.json$`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                  next.buildId\n                )}\\\\/catchall\\\\-optional(?:\\\\/(.+?))?\\\\.json$`\n              ),\n              page: '/catchall-optional/[[...slug]]',\n              routeKeys: {\n                slug: 'slug',\n              },\n            },\n            {\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                  next.buildId\n                )}\\\\/default-revalidate.json$`\n              ),\n              page: '/default-revalidate',\n            },\n            {\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                  next.buildId\n                )}\\\\/dynamic\\\\/([^\\\\/]+?)\\\\.json$`\n              ),\n              namedDataRouteRegex: `^/_next/data/${escapeRegex(\n                next.buildId\n              )}/dynamic/(?<slug>[^/]+?)\\\\.json$`,\n              page: '/dynamic/[slug]',\n              routeKeys: {\n                slug: 'slug',\n              },\n            },\n            {\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                  next.buildId\n                )}\\\\/fallback\\\\-only\\\\/([^\\\\/]+?)\\\\.json$`\n              ),\n              namedDataRouteRegex: `^/_next/data/${escapeRegex(\n                next.buildId\n              )}/fallback\\\\-only/(?<slug>[^/]+?)\\\\.json$`,\n              page: '/fallback-only/[slug]',\n              routeKeys: {\n                slug: 'slug',\n              },\n            },\n            // TODO: investigate index/index\n            // {\n            //   dataRouteRegex: normalizeRegEx(\n            //     `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n            //       next.buildId\n            //     )}\\\\/index\\\\/index.json$`\n            //   ),\n            //   page: '/index',\n            // },\n            {\n              namedDataRouteRegex: `^/_next/data/${escapeRegex(\n                next.buildId\n              )}/lang/(?<lang>[^/]+?)/about\\\\.json$`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                  next.buildId\n                )}\\\\/lang\\\\/([^\\\\/]+?)\\\\/about\\\\.json$`\n              ),\n              page: '/lang/[lang]/about',\n              routeKeys: {\n                lang: 'lang',\n              },\n            },\n            {\n              dataRouteRegex: `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                next.buildId\n              )}\\\\/large-page-data.json$`,\n              page: '/large-page-data',\n            },\n            {\n              namedDataRouteRegex: `^/_next/data/${escapeRegex(\n                next.buildId\n              )}/non\\\\-json/(?<p>[^/]+?)\\\\.json$`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                  next.buildId\n                )}\\\\/non\\\\-json\\\\/([^\\\\/]+?)\\\\.json$`\n              ),\n              page: '/non-json/[p]',\n              routeKeys: {\n                p: 'p',\n              },\n            },\n            {\n              namedDataRouteRegex: `^/_next/data/${escapeRegex(\n                next.buildId\n              )}/non\\\\-json\\\\-blocking/(?<p>[^/]+?)\\\\.json$`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                  next.buildId\n                )}\\\\/non\\\\-json\\\\-blocking\\\\/([^\\\\/]+?)\\\\.json$`\n              ),\n              page: '/non-json-blocking/[p]',\n              routeKeys: {\n                p: 'p',\n              },\n            },\n            {\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                  next.buildId\n                )}\\\\/preview.json$`\n              ),\n              page: '/preview',\n            },\n            {\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                  next.buildId\n                )}\\\\/something.json$`\n              ),\n              page: '/something',\n            },\n            {\n              namedDataRouteRegex: `^/_next/data/${escapeRegex(\n                next.buildId\n              )}/user/(?<user>[^/]+?)/profile\\\\.json$`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                  next.buildId\n                )}\\\\/user\\\\/([^\\\\/]+?)\\\\/profile\\\\.json$`\n              ),\n              page: '/user/[user]/profile',\n              routeKeys: {\n                user: 'user',\n              },\n            },\n          ])\n        })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"outputs a prerender-manifest correctly","suites":["Prerender"],"updatePoint":{"line":1560,"column":50},"line":1560,"code":"        it('outputs a prerender-manifest correctly', async () => {\n          const manifest = JSON.parse(\n            await next.readFile('.next/prerender-manifest.json')\n          )\n          const escapedBuildId = escapeRegex(next.buildId)\n\n          Object.keys(manifest.dynamicRoutes).forEach((key) => {\n            const item = manifest.dynamicRoutes[key]\n\n            if (item.dataRouteRegex) {\n              item.dataRouteRegex = normalizeRegEx(item.dataRouteRegex)\n            }\n            if (item.routeRegex) {\n              item.routeRegex = normalizeRegEx(item.routeRegex)\n            }\n          })\n\n          expect(manifest.version).toBe(3)\n          expect(manifest.routes).toEqual(expectedManifestRoutes())\n          expect(manifest.dynamicRoutes).toEqual({\n            '/api-docs/[...slug]': {\n              dataRoute: `/_next/data/${next.buildId}/api-docs/[...slug].json`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapedBuildId}\\\\/api\\\\-docs\\\\/(.+?)\\\\.json$`\n              ),\n              fallback: '/api-docs/[...slug].html',\n              routeRegex: normalizeRegEx(`^\\\\/api\\\\-docs\\\\/(.+?)(?:\\\\/)?$`),\n            },\n            '/blocking-fallback-once/[slug]': {\n              dataRoute: `/_next/data/${next.buildId}/blocking-fallback-once/[slug].json`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapedBuildId}\\\\/blocking\\\\-fallback\\\\-once\\\\/([^\\\\/]+?)\\\\.json$`\n              ),\n              fallback: null,\n              routeRegex: normalizeRegEx(\n                '^\\\\/blocking\\\\-fallback\\\\-once\\\\/([^\\\\/]+?)(?:\\\\/)?$'\n              ),\n            },\n            '/blocking-fallback-some/[slug]': {\n              dataRoute: `/_next/data/${next.buildId}/blocking-fallback-some/[slug].json`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapedBuildId}\\\\/blocking\\\\-fallback\\\\-some\\\\/([^\\\\/]+?)\\\\.json$`\n              ),\n              fallback: null,\n              routeRegex: normalizeRegEx(\n                '^\\\\/blocking\\\\-fallback\\\\-some\\\\/([^\\\\/]+?)(?:\\\\/)?$'\n              ),\n            },\n            '/blocking-fallback/[slug]': {\n              dataRoute: `/_next/data/${next.buildId}/blocking-fallback/[slug].json`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapedBuildId}\\\\/blocking\\\\-fallback\\\\/([^\\\\/]+?)\\\\.json$`\n              ),\n              fallback: null,\n              routeRegex: normalizeRegEx(\n                '^\\\\/blocking\\\\-fallback\\\\/([^\\\\/]+?)(?:\\\\/)?$'\n              ),\n            },\n            '/blog/[post]': {\n              fallback: '/blog/[post].html',\n              dataRoute: `/_next/data/${next.buildId}/blog/[post].json`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapedBuildId}\\\\/blog\\\\/([^\\\\/]+?)\\\\.json$`\n              ),\n              routeRegex: normalizeRegEx('^\\\\/blog\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n            },\n            '/blog/[post]/[comment]': {\n              fallback: '/blog/[post]/[comment].html',\n              dataRoute: `/_next/data/${next.buildId}/blog/[post]/[comment].json`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapedBuildId}\\\\/blog\\\\/([^\\\\/]+?)\\\\/([^\\\\/]+?)\\\\.json$`\n              ),\n              routeRegex: normalizeRegEx(\n                '^\\\\/blog\\\\/([^\\\\/]+?)\\\\/([^\\\\/]+?)(?:\\\\/)?$'\n              ),\n            },\n            '/dynamic/[slug]': {\n              dataRoute: `/_next/data/${next.buildId}/dynamic/[slug].json`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapedBuildId}\\\\/dynamic\\\\/([^\\\\/]+?)\\\\.json$`\n              ),\n              fallback: false,\n              routeRegex: normalizeRegEx(`^\\\\/dynamic\\\\/([^\\\\/]+?)(?:\\\\/)?$`),\n            },\n            '/fallback-only/[slug]': {\n              dataRoute: `/_next/data/${next.buildId}/fallback-only/[slug].json`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapedBuildId}\\\\/fallback\\\\-only\\\\/([^\\\\/]+?)\\\\.json$`\n              ),\n              fallback: '/fallback-only/[slug].html',\n              routeRegex: normalizeRegEx(\n                '^\\\\/fallback\\\\-only\\\\/([^\\\\/]+?)(?:\\\\/)?$'\n              ),\n            },\n            '/lang/[lang]/about': {\n              dataRoute: `/_next/data/${next.buildId}/lang/[lang]/about.json`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapedBuildId}\\\\/lang\\\\/([^\\\\/]+?)\\\\/about\\\\.json$`\n              ),\n              fallback: false,\n              routeRegex: normalizeRegEx(\n                '^\\\\/lang\\\\/([^\\\\/]+?)\\\\/about(?:\\\\/)?$'\n              ),\n            },\n            '/non-json-blocking/[p]': {\n              dataRoute: `/_next/data/${next.buildId}/non-json-blocking/[p].json`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapedBuildId}\\\\/non\\\\-json\\\\-blocking\\\\/([^\\\\/]+?)\\\\.json$`\n              ),\n              fallback: null,\n              routeRegex: normalizeRegEx(\n                '^\\\\/non\\\\-json\\\\-blocking\\\\/([^\\\\/]+?)(?:\\\\/)?$'\n              ),\n            },\n            '/non-json/[p]': {\n              dataRoute: `/_next/data/${next.buildId}/non-json/[p].json`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapedBuildId}\\\\/non\\\\-json\\\\/([^\\\\/]+?)\\\\.json$`\n              ),\n              fallback: '/non-json/[p].html',\n              routeRegex: normalizeRegEx(\n                '^\\\\/non\\\\-json\\\\/([^\\\\/]+?)(?:\\\\/)?$'\n              ),\n            },\n            '/user/[user]/profile': {\n              fallback: '/user/[user]/profile.html',\n              dataRoute: `/_next/data/${next.buildId}/user/[user]/profile.json`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapedBuildId}\\\\/user\\\\/([^\\\\/]+?)\\\\/profile\\\\.json$`\n              ),\n              routeRegex: normalizeRegEx(\n                `^\\\\/user\\\\/([^\\\\/]+?)\\\\/profile(?:\\\\/)?$`\n              ),\n            },\n\n            '/catchall/[...slug]': {\n              fallback: '/catchall/[...slug].html',\n              routeRegex: normalizeRegEx('^\\\\/catchall\\\\/(.+?)(?:\\\\/)?$'),\n              dataRoute: `/_next/data/${next.buildId}/catchall/[...slug].json`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapedBuildId}\\\\/catchall\\\\/(.+?)\\\\.json$`\n              ),\n            },\n            '/catchall-optional/[[...slug]]': {\n              dataRoute: `/_next/data/${next.buildId}/catchall-optional/[[...slug]].json`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapedBuildId}\\\\/catchall\\\\-optional(?:\\\\/(.+?))?\\\\.json$`\n              ),\n              fallback: false,\n              routeRegex: normalizeRegEx(\n                '^\\\\/catchall\\\\-optional(?:\\\\/(.+?))?(?:\\\\/)?$'\n              ),\n            },\n            '/catchall-explicit/[...slug]': {\n              dataRoute: `/_next/data/${next.buildId}/catchall-explicit/[...slug].json`,\n              dataRouteRegex: normalizeRegEx(\n                `^\\\\/_next\\\\/data\\\\/${escapedBuildId}\\\\/catchall\\\\-explicit\\\\/(.+?)\\\\.json$`\n              ),\n              fallback: false,\n              routeRegex: normalizeRegEx(\n                '^\\\\/catchall\\\\-explicit\\\\/(.+?)(?:\\\\/)?$'\n              ),\n            },\n          })\n        })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"outputs prerendered files correctly","suites":["Prerender"],"updatePoint":{"line":1726,"column":47},"line":1726,"code":"        it('outputs prerendered files correctly', async () => {\n          const routes = [\n            '/another',\n            '/something',\n            '/blog/post-1',\n            '/blog/post-2/comment-2',\n          ]\n\n          for (const route of routes) {\n            await next.readFile(join('.next/server/pages', `${route}.html`))\n            await next.readFile(join('.next/server/pages', `${route}.json`))\n          }\n        })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should handle de-duping correctly","suites":["Prerender"],"updatePoint":{"line":1740,"column":45},"line":1740,"code":"        it('should handle de-duping correctly', async () => {\n          let vals = new Array(10).fill(null)\n\n          // use data route so we don't get the fallback\n          vals = await Promise.all(\n            vals.map(() =>\n              renderViaHTTP(\n                next.url,\n                `/_next/data/${next.buildId}/blog/post-10.json`\n              )\n            )\n          )\n          const val = vals[0]\n\n          expect(JSON.parse(val).pageProps.post).toBe('post-10')\n          expect(new Set(vals).size).toBe(1)\n        })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should not revalidate when set to false","suites":["Prerender"],"updatePoint":{"line":1759,"column":49},"line":1759,"code":"      it('should not revalidate when set to false', async () => {\n        const route = '/something'\n        const initialHtml = await renderViaHTTP(next.url, route)\n        let newHtml = await renderViaHTTP(next.url, route)\n        expect(initialHtml).toBe(newHtml)\n\n        newHtml = await renderViaHTTP(next.url, route)\n        expect(initialHtml).toBe(newHtml)\n\n        newHtml = await renderViaHTTP(next.url, route)\n        expect(initialHtml).toBe(newHtml)\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should not revalidate when set to false in blocking fallback mode","suites":["Prerender"],"updatePoint":{"line":1774,"column":77},"line":1774,"code":"        it('should not revalidate when set to false in blocking fallback mode', async () => {\n          const route = '/blocking-fallback-once/test-no-revalidate'\n\n          const initialHtml = await renderViaHTTP(next.url, route)\n          let newHtml = await renderViaHTTP(next.url, route)\n          expect(initialHtml).toBe(newHtml)\n\n          newHtml = await renderViaHTTP(next.url, route)\n          expect(initialHtml).toBe(newHtml)\n\n          newHtml = await renderViaHTTP(next.url, route)\n          expect(initialHtml).toBe(newHtml)\n        })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should revalidate manual revalidate with preview cookie","suites":["Prerender"],"updatePoint":{"line":1789,"column":65},"line":1789,"code":"      it('should revalidate manual revalidate with preview cookie', async () => {\n        const initialRes = await fetchViaHTTP(next.url, '/preview')\n        expect(initialRes.status).toBe(200)\n\n        const initial$ = cheerio.load(await initialRes.text())\n        const initialProps = JSON.parse(initial$('#props').text())\n\n        expect(initialProps).toEqual({\n          preview: false,\n          previewData: null,\n        })\n\n        const previewRes = await fetchViaHTTP(next.url, '/api/enable')\n        let previewCookie = ''\n\n        expect(previewRes.headers.get('set-cookie')).toMatch(\n          /(__prerender_bypass|__next_preview_data)/\n        )\n\n        previewRes.headers\n          .get('set-cookie')\n          .split(',')\n          .forEach((c) => {\n            c = cookie.parse(c)\n            const isBypass = c.__prerender_bypass\n\n            if (isBypass || c.__next_preview_data) {\n              if (previewCookie) previewCookie += '; '\n\n              previewCookie += `${\n                isBypass ? '__prerender_bypass' : '__next_preview_data'\n              }=${c[isBypass ? '__prerender_bypass' : '__next_preview_data']}`\n            }\n          })\n\n        const apiRes = await fetchViaHTTP(\n          next.url,\n          '/api/manual-revalidate',\n          { pathname: '/preview' },\n          {\n            headers: {\n              cookie: previewCookie,\n            },\n          }\n        )\n\n        expect(apiRes.status).toBe(200)\n        expect(await apiRes.json()).toEqual({ revalidated: true })\n\n        const postRevalidateRes = await fetchViaHTTP(next.url, '/preview')\n        expect(initialRes.status).toBe(200)\n\n        const postRevalidate$ = cheerio.load(await postRevalidateRes.text())\n        const postRevalidateProps = JSON.parse(postRevalidate$('#props').text())\n\n        expect(postRevalidateProps).toEqual({\n          preview: false,\n          previewData: null,\n        })\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should handle revalidating HTML correctly","suites":["Prerender"],"updatePoint":{"line":1850,"column":51},"line":1850,"code":"      it('should handle revalidating HTML correctly', async () => {\n        const route = '/blog/post-2/comment-2'\n        const initialHtml = await renderViaHTTP(next.url, route)\n        expect(initialHtml).toMatch(/Post:.*?post-2/)\n        expect(initialHtml).toMatch(/Comment:.*?comment-2/)\n\n        let newHtml = await renderViaHTTP(next.url, route)\n        expect(newHtml).toMatch(/Post:.*?post-2/)\n        expect(newHtml).toMatch(/Comment:.*?comment-2/)\n\n        await waitFor(2 * 1000)\n        await renderViaHTTP(next.url, route)\n\n        await check(async () => {\n          newHtml = await renderViaHTTP(next.url, route)\n          return newHtml !== initialHtml ? 'success' : newHtml\n        }, 'success')\n\n        expect(newHtml === initialHtml).toBe(false)\n        expect(newHtml).toMatch(/Post:.*?post-2/)\n        expect(newHtml).toMatch(/Comment:.*?comment-2/)\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should handle revalidating JSON correctly","suites":["Prerender"],"updatePoint":{"line":1873,"column":51},"line":1873,"code":"      it('should handle revalidating JSON correctly', async () => {\n        const route = `/_next/data/${next.buildId}/blog/post-2/comment-3.json`\n        const initialJson = await renderViaHTTP(next.url, route)\n        expect(initialJson).toMatch(/post-2/)\n        expect(initialJson).toMatch(/comment-3/)\n\n        let newJson = await renderViaHTTP(next.url, route)\n\n        if (!isDeploy) {\n          // we can't guarantee cache time on deploy\n          expect(newJson).toBe(initialJson)\n        }\n\n        await waitFor(2 * 1000)\n        await renderViaHTTP(next.url, route)\n\n        await check(async () => {\n          newJson = await renderViaHTTP(next.url, route)\n          return newJson !== initialJson ? 'success' : newJson\n        }, 'success')\n\n        expect(newJson === initialJson).toBe(false)\n        expect(newJson).toMatch(/post-2/)\n        expect(newJson).toMatch(/comment-3/)\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should handle revalidating HTML correctly with blocking","suites":["Prerender"],"updatePoint":{"line":1899,"column":65},"line":1899,"code":"      it('should handle revalidating HTML correctly with blocking', async () => {\n        const route = '/blocking-fallback/pewpew'\n        const initialHtml = await renderViaHTTP(next.url, route)\n        expect(initialHtml).toMatch(/Post:.*?pewpew/)\n\n        let newHtml = await renderViaHTTP(next.url, route)\n\n        if (!isDeploy) {\n          // we can't guarantee the cache timing on deployment\n          expect(newHtml).toBe(initialHtml)\n        }\n        await waitFor(2 * 1000)\n        await renderViaHTTP(next.url, route)\n\n        await check(async () => {\n          newHtml = await renderViaHTTP(next.url, route)\n          return newHtml !== initialHtml ? 'success' : newHtml\n        }, 'success')\n\n        expect(newHtml === initialHtml).toBe(false)\n        expect(newHtml).toMatch(/Post:.*?pewpew/)\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should handle revalidating JSON correctly with blocking","suites":["Prerender"],"updatePoint":{"line":1922,"column":65},"line":1922,"code":"      it('should handle revalidating JSON correctly with blocking', async () => {\n        const route = `/_next/data/${next.buildId}/blocking-fallback/pewpewdata.json`\n        const initialJson = await renderViaHTTP(next.url, route)\n        expect(initialJson).toMatch(/pewpewdata/)\n\n        let newJson = await renderViaHTTP(next.url, route)\n\n        if (!isDeploy) {\n          // we can't guarantee the cache on deploy\n          expect(newJson).toBe(initialJson)\n        }\n        await waitFor(2 * 1000)\n        await renderViaHTTP(next.url, route)\n\n        await check(async () => {\n          newJson = await renderViaHTTP(next.url, route)\n          return newJson !== initialJson ? 'success' : newJson\n        }, 'success')\n\n        expect(newJson === initialJson).toBe(false)\n        expect(newJson).toMatch(/pewpewdata/)\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should handle revalidating HTML correctly with blocking and seed","suites":["Prerender"],"updatePoint":{"line":1945,"column":74},"line":1945,"code":"      it('should handle revalidating HTML correctly with blocking and seed', async () => {\n        const route = '/blocking-fallback/a'\n        const initialHtml = await renderViaHTTP(next.url, route)\n        const $initial = cheerio.load(initialHtml)\n        expect($initial('p').text()).toBe('Post: a')\n\n        let newHtml = await renderViaHTTP(next.url, route)\n\n        if (!isDeploy) {\n          // we can't guarantee the cache time on deploy\n          expect(newHtml).toBe(initialHtml)\n        }\n\n        await waitFor(2 * 1000)\n        await renderViaHTTP(next.url, route)\n\n        await check(async () => {\n          newHtml = await renderViaHTTP(next.url, route)\n          return newHtml !== initialHtml ? 'success' : newHtml\n        }, 'success')\n\n        expect(newHtml === initialHtml).toBe(false)\n        const $new = cheerio.load(newHtml)\n        expect($new('p').text()).toBe('Post: a')\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should handle revalidating JSON correctly with blocking and seed","suites":["Prerender"],"updatePoint":{"line":1971,"column":74},"line":1971,"code":"      it('should handle revalidating JSON correctly with blocking and seed', async () => {\n        const route = `/_next/data/${next.buildId}/blocking-fallback/b.json`\n        const initialJson = await renderViaHTTP(next.url, route)\n        expect(JSON.parse(initialJson)).toMatchObject({\n          pageProps: { params: { slug: 'b' } },\n        })\n\n        let newJson = await renderViaHTTP(next.url, route)\n\n        if (!isDeploy) {\n          // we can't guarantee the cache time on deploy\n          expect(newJson).toBe(initialJson)\n        }\n        await waitFor(2 * 1000)\n        await renderViaHTTP(next.url, route)\n\n        await check(async () => {\n          newJson = await renderViaHTTP(next.url, route)\n          return newJson !== initialJson ? 'success' : newJson\n        }, 'success')\n\n        expect(newJson === initialJson).toBe(false)\n        expect(JSON.parse(newJson)).toMatchObject({\n          pageProps: { params: { slug: 'b' } },\n        })\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should not fetch prerender data on mount","suites":["Prerender"],"updatePoint":{"line":1998,"column":50},"line":1998,"code":"      it('should not fetch prerender data on mount', async () => {\n        const browser = await webdriver(next.url, '/blog/post-100')\n        await browser.eval('window.thisShouldStay = true')\n        await waitFor(2 * 1000)\n        const val = await browser.eval('window.thisShouldStay')\n        expect(val).toBe(true)\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should not error when flushing cache files","suites":["Prerender"],"updatePoint":{"line":2006,"column":52},"line":2006,"code":"      it('should not error when flushing cache files', async () => {\n        await fetchViaHTTP(next.url, '/user/user-1/profile')\n        await waitFor(500)\n        expect(next.cliOutput).not.toMatch(\n          /Failed to update prerender files for/\n        )\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should of formatted build output correctly","suites":["Prerender"],"updatePoint":{"line":2016,"column":52},"line":2016,"code":"      it('should of formatted build output correctly', () => {\n        expect(next.cliOutput).toMatch(/○ \\/normal/)\n        expect(next.cliOutput).toMatch(/● \\/blog\\/\\[post\\]/)\n        expect(next.cliOutput).toMatch(/\\+2 more paths/)\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should output traces","suites":["Prerender"],"updatePoint":{"line":2022,"column":30},"line":2022,"code":"      it('should output traces', async () => {\n        const checks = [\n          {\n            page: '/_app',\n            tests: [\n              /webpack-runtime\\.js/,\n              /node_modules\\/react\\/index\\.js/,\n              /node_modules\\/react\\/package\\.json/,\n              /node_modules\\/react\\/cjs\\/react\\.production\\.min\\.js/,\n              /node_modules\\/next/,\n            ],\n            notTests: [],\n          },\n          {\n            page: '/another',\n            tests: [\n              /webpack-runtime\\.js/,\n              /chunks\\/.*?\\.js/,\n              /node_modules\\/react\\/index\\.js/,\n              /node_modules\\/react\\/package\\.json/,\n              /node_modules\\/react\\/cjs\\/react\\.production\\.min\\.js/,\n              /node_modules\\/next/,\n              /\\/world.txt/,\n            ],\n            notTests: [\n              /node_modules\\/@firebase\\/firestore\\/.*?\\.js/,\n              /\\/server\\.js/,\n            ],\n          },\n          {\n            page: '/blog/[post]',\n            tests: [\n              /webpack-runtime\\.js/,\n              /chunks\\/.*?\\.js/,\n              /node_modules\\/react\\/index\\.js/,\n              /node_modules\\/react\\/package\\.json/,\n              /node_modules\\/react\\/cjs\\/react\\.production\\.min\\.js/,\n              /node_modules\\/next/,\n              /next\\/router\\.js/,\n              /next\\/dist\\/client\\/router\\.js/,\n              /node_modules\\/@firebase\\/firestore\\/.*?\\.js/,\n            ],\n            notTests: [/\\/world.txt/],\n          },\n        ]\n\n        for (const check of checks) {\n          const contents = await next.readFile(\n            join('.next/server/pages/', check.page + '.js.nft.json')\n          )\n          const { version, files } = JSON.parse(contents)\n          expect(version).toBe(1)\n\n          expect(\n            check.tests.every((item) => files.some((file) => item.test(file)))\n          ).toBe(true)\n\n          if (sep === '/') {\n            expect(\n              check.notTests.some((item) =>\n                files.some((file) => item.test(file))\n              )\n            ).toBe(false)\n          }\n        }\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should handle manual revalidate for fallback: blocking","suites":["Prerender"],"updatePoint":{"line":2091,"column":64},"line":2091,"code":"      it('should handle manual revalidate for fallback: blocking', async () => {\n        const beforeRevalidate = Date.now()\n        const res = await fetchViaHTTP(\n          next.url,\n          '/blocking-fallback/test-manual-1'\n        )\n\n        if (!isDeploy) {\n          await waitForCacheWrite(\n            '/blocking-fallback/test-manual-1',\n            beforeRevalidate\n          )\n        }\n        const html = await res.text()\n        const $ = cheerio.load(html)\n        const initialTime = $('#time').text()\n        const cacheHeader = isDeploy ? 'x-vercel-cache' : 'x-nextjs-cache'\n\n        expect(res.headers.get(cacheHeader)).toMatch(/MISS/)\n        expect($('p').text()).toMatch(/Post:.*?test-manual-1/)\n\n        if (!isDeploy) {\n          const res2 = await fetchViaHTTP(\n            next.url,\n            '/blocking-fallback/test-manual-1'\n          )\n          const html2 = await res2.text()\n          const $2 = cheerio.load(html2)\n\n          expect(res2.headers.get(cacheHeader)).toMatch(/(HIT|STALE)/)\n          expect(initialTime).toBe($2('#time').text())\n        }\n\n        const res3 = await fetchViaHTTP(\n          next.url,\n          '/api/manual-revalidate',\n          {\n            pathname: '/blocking-fallback/test-manual-1',\n          },\n          { redirect: 'manual' }\n        )\n\n        expect(res3.status).toBe(200)\n        const revalidateData = await res3.json()\n        expect(revalidateData.revalidated).toBe(true)\n\n        await check(async () => {\n          const res4 = await fetchViaHTTP(\n            next.url,\n            '/blocking-fallback/test-manual-1'\n          )\n          const html4 = await res4.text()\n          const $4 = cheerio.load(html4)\n          expect($4('#time').text()).not.toBe(initialTime)\n          expect(res4.headers.get(cacheHeader)).toMatch(/(HIT|STALE)/)\n          return 'success'\n        }, 'success')\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should automatically reset cache TTL when an error occurs and build cache was available","suites":["Prerender"],"updatePoint":{"line":2152,"column":97},"line":2152,"code":"      it('should automatically reset cache TTL when an error occurs and build cache was available', async () => {\n        await next.patchFile('error.txt', 'yes')\n        await waitFor(2000)\n\n        for (let i = 0; i < 5; i++) {\n          const res = await fetchViaHTTP(\n            next.url,\n            '/blocking-fallback/test-errors-1'\n          )\n          expect(res.status).toBe(200)\n        }\n        await next.deleteFile('error.txt')\n        await check(\n          () =>\n            next.cliOutput.match(\n              /throwing error for \\/blocking-fallback\\/test-errors-1/\n            ).length === 1\n              ? 'success'\n              : next.cliOutput,\n          'success'\n        )\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should automatically reset cache TTL when an error occurs and runtime cache was available","suites":["Prerender"],"updatePoint":{"line":2175,"column":99},"line":2175,"code":"      it('should automatically reset cache TTL when an error occurs and runtime cache was available', async () => {\n        const res = await fetchViaHTTP(\n          next.url,\n          '/blocking-fallback/test-errors-2'\n        )\n\n        expect(res.status).toBe(200)\n        await waitFor(2000)\n        await next.patchFile('error.txt', 'yes')\n\n        for (let i = 0; i < 5; i++) {\n          const res = await fetchViaHTTP(\n            next.url,\n            '/blocking-fallback/test-errors-2'\n          )\n          expect(res.status).toBe(200)\n        }\n        await next.deleteFile('error.txt')\n\n        await check(\n          () =>\n            next.cliOutput.match(\n              /throwing error for \\/blocking-fallback\\/test-errors-2/\n            ).length === 1\n              ? 'success'\n              : next.cliOutput,\n          'success'\n        )\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should not manual revalidate for fallback: blocking with onlyGenerated if not generated","suites":["Prerender"],"updatePoint":{"line":2205,"column":97},"line":2205,"code":"      it('should not manual revalidate for fallback: blocking with onlyGenerated if not generated', async () => {\n        const res = await fetchViaHTTP(\n          next.url,\n          '/api/manual-revalidate',\n          {\n            pathname: '/blocking-fallback/test-if-generated-1',\n            onlyGenerated: '1',\n          },\n          { redirect: 'manual' }\n        )\n\n        expect(res.status).toBe(200)\n        const revalidateData = await res.json()\n        expect(revalidateData.revalidated).toBe(true)\n\n        expect(next.cliOutput).not.toContain(\n          `getStaticProps test-if-generated-1`\n        )\n\n        const res2 = await fetchViaHTTP(\n          next.url,\n          '/blocking-fallback/test-if-generated-1'\n        )\n        expect(res2.headers.get('x-nextjs-cache')).toMatch(/(MISS)/)\n        expect(next.cliOutput).toContain(`getStaticProps test-if-generated-1`)\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should manual revalidate for fallback: blocking with onlyGenerated if generated","suites":["Prerender"],"updatePoint":{"line":2232,"column":89},"line":2232,"code":"      it('should manual revalidate for fallback: blocking with onlyGenerated if generated', async () => {\n        const beforeRevalidate = Date.now()\n        const res = await fetchViaHTTP(\n          next.url,\n          '/blocking-fallback/test-if-generated-2'\n        )\n        await waitForCacheWrite(\n          '/blocking-fallback/test-if-generated-2',\n          beforeRevalidate\n        )\n        const html = await res.text()\n        const $ = cheerio.load(html)\n        const initialTime = $('#time').text()\n        expect(res.headers.get('x-nextjs-cache')).toMatch(/MISS/)\n        expect($('p').text()).toMatch(/Post:.*?test-if-generated-2/)\n\n        const res2 = await fetchViaHTTP(\n          next.url,\n          '/blocking-fallback/test-if-generated-2'\n        )\n        const html2 = await res2.text()\n        const $2 = cheerio.load(html2)\n        expect(res2.headers.get('x-nextjs-cache')).toMatch(/(HIT|STALE)/)\n\n        expect(initialTime).toBe($2('#time').text())\n\n        const res3 = await fetchViaHTTP(\n          next.url,\n          '/api/manual-revalidate',\n          {\n            pathname: '/blocking-fallback/test-if-generated-2',\n            onlyGenerated: '1',\n          },\n          { redirect: 'manual' }\n        )\n\n        expect(res3.status).toBe(200)\n        const revalidateData = await res3.json()\n        expect(revalidateData.revalidated).toBe(true)\n\n        const res4 = await fetchViaHTTP(\n          next.url,\n          '/blocking-fallback/test-if-generated-2'\n        )\n        const html4 = await res4.text()\n        const $4 = cheerio.load(html4)\n        expect($4('#time').text()).not.toBe(initialTime)\n        expect(res4.headers.get('x-nextjs-cache')).toMatch(/(HIT|STALE)/)\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should manual revalidate for revalidate: false","suites":["Prerender"],"updatePoint":{"line":2282,"column":56},"line":2282,"code":"      it('should manual revalidate for revalidate: false', async () => {\n        const html = await renderViaHTTP(\n          next.url,\n          '/blocking-fallback-once/test-manual-1'\n        )\n        const $ = cheerio.load(html)\n        const initialTime = $('#time').text()\n\n        expect($('p').text()).toMatch(/Post:.*?test-manual-1/)\n\n        const html2 = await renderViaHTTP(\n          next.url,\n          '/blocking-fallback-once/test-manual-1'\n        )\n        const $2 = cheerio.load(html2)\n\n        expect(initialTime).toBe($2('#time').text())\n\n        const res = await fetchViaHTTP(\n          next.url,\n          '/api/manual-revalidate',\n          {\n            pathname: '/blocking-fallback-once/test-manual-1',\n          },\n          { redirect: 'manual' }\n        )\n\n        expect(res.status).toBe(200)\n        const revalidateData = await res.json()\n        expect(revalidateData.revalidated).toBe(true)\n\n        const html4 = await renderViaHTTP(\n          next.url,\n          '/blocking-fallback-once/test-manual-1'\n        )\n        const $4 = cheerio.load(html4)\n        expect($4('#time').text()).not.toBe(initialTime)\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should manual revalidate that returns notFound: true","suites":["Prerender"],"updatePoint":{"line":2321,"column":62},"line":2321,"code":"      it('should manual revalidate that returns notFound: true', async () => {\n        const res = await fetchViaHTTP(\n          next.url,\n          '/blocking-fallback-once/404-on-manual-revalidate'\n        )\n        const html = await res.text()\n        const $ = cheerio.load(html)\n        const initialTime = $('#time').text()\n        expect(res.headers.get('x-nextjs-cache')).toBe('HIT')\n\n        expect($('p').text()).toMatch(/Post:.*?404-on-manual-revalidate/)\n\n        const html2 = await renderViaHTTP(\n          next.url,\n          '/blocking-fallback-once/404-on-manual-revalidate'\n        )\n        const $2 = cheerio.load(html2)\n\n        expect(initialTime).toBe($2('#time').text())\n\n        const res2 = await fetchViaHTTP(\n          next.url,\n          '/api/manual-revalidate',\n          {\n            pathname: '/blocking-fallback-once/404-on-manual-revalidate',\n          },\n          { redirect: 'manual' }\n        )\n        expect(res2.status).toBe(200)\n        const revalidateData = await res2.json()\n        expect(revalidateData.revalidated).toBe(true)\n\n        const res3 = await fetchViaHTTP(\n          next.url,\n          '/blocking-fallback-once/404-on-manual-revalidate'\n        )\n        expect(res3.status).toBe(404)\n        expect(await res3.text()).toContain('This page could not be found')\n        expect(res3.headers.get('x-nextjs-cache')).toBe('HIT')\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should handle manual revalidate for fallback: false","suites":["Prerender"],"updatePoint":{"line":2362,"column":61},"line":2362,"code":"      it('should handle manual revalidate for fallback: false', async () => {\n        const res = await fetchViaHTTP(\n          next.url,\n          '/catchall-explicit/test-manual-1'\n        )\n        expect(res.status).toBe(404)\n\n        // fallback: false pages should only manually revalidate\n        // prerendered paths\n        const res2 = await fetchViaHTTP(\n          next.url,\n          '/api/manual-revalidate',\n          {\n            pathname: '/catchall-explicity/test-manual-1',\n          },\n          { redirect: 'manual' }\n        )\n\n        expect(res2.status).toBe(200)\n        const revalidateData = await res2.json()\n        expect(revalidateData.revalidated).toBe(false)\n\n        const res3 = await fetchViaHTTP(\n          next.url,\n          '/catchall-explicit/test-manual-1'\n        )\n        expect(res3.status).toBe(404)\n\n        const res4 = await fetchViaHTTP(next.url, '/catchall-explicit/first')\n        expect(res4.status).toBe(200)\n        const html = await res4.text()\n        const $ = cheerio.load(html)\n        const initialTime = $('#time').text()\n\n        const res5 = await fetchViaHTTP(\n          next.url,\n          '/api/manual-revalidate',\n          {\n            pathname: '/catchall-explicit/first',\n          },\n          { redirect: 'manual' }\n        )\n        expect(res5.status).toBe(200)\n        expect((await res5.json()).revalidated).toBe(true)\n\n        const res6 = await fetchViaHTTP(next.url, '/catchall-explicit/first')\n        expect(res6.status).toBe(200)\n        const html2 = await res6.text()\n        const $2 = cheerio.load(html2)\n\n        expect(initialTime).not.toBe($2('#time').text())\n      })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should respond for catch-all deep folder","suites":["Prerender"],"updatePoint":{"line":2416,"column":48},"line":2416,"code":"    it('should respond for catch-all deep folder', async () => {\n      const res = await fetchViaHTTP(\n        next.url,\n        `/_next/data/${next.buildId}/catchall/first/second/third.json`\n      )\n      expect(res.status).toBe(200)\n      expect(await res.text()).toContain('[\"first\",\"second\",\"third\"]')\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should not fail to update incremental cache","suites":["Prerender"],"updatePoint":{"line":2426,"column":51},"line":2426,"code":"    it('should not fail to update incremental cache', async () => {\n      await waitFor(1000)\n      expect(next.cliOutput).not.toContain('Failed to update prerender cache')\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should not have attempted sending invalid payload","suites":["Prerender"],"updatePoint":{"line":2431,"column":57},"line":2431,"code":"    it('should not have attempted sending invalid payload', async () => {\n      expect(next.cliOutput).not.toContain('argument entity must be string')\n    })","file":"e2e/prerender.test.ts","skipped":false,"dir":"test"},{"name":"should proxy  request ","suites":["Requests not effected when middleware used"],"updatePoint":{"line":32,"column":5},"line":30,"code":"    it(`should proxy ${method} request ${\n      body ? 'with body' : ''\n    }`, async () => {\n      const headers = {\n        'content-type': 'application/json',\n        'x-custom-header': 'some value',\n      }\n      const res = await fetchViaHTTP(next.url, `api`, '', {\n        method: method.toUpperCase(),\n        headers,\n        body: method.toLowerCase() !== 'get' ? body : undefined,\n      })\n      const data = await res.json()\n      expect(data.method).toEqual(method)\n      if (body) {\n        expect(data.headers['content-length']).toEqual(String(body.length))\n      }\n      expect(data.headers).toEqual(expect.objectContaining(headers))\n    })","file":"e2e/proxy-request-with-middleware/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should restore the scroll position on navigating back","suites":["reload-scroll-back-restoration"],"updatePoint":{"line":22,"column":59},"line":22,"code":"  it('should restore the scroll position on navigating back', async () => {\n    const browser = await webdriver(next.url, '/0')\n    await browser.eval(() => document.querySelector('#link').scrollIntoView())\n\n    // check browser restoration setting\n    const scrollRestoration = await browser.eval(\n      () => window.history.scrollRestoration\n    )\n    expect(scrollRestoration).toBe('manual')\n\n    const scrollPositionMemories: Array<{ x: number; y: number }> = []\n    scrollPositionMemories.push({\n      x: Math.floor(await browser.eval(() => window.scrollX)),\n      y: Math.floor(await browser.eval(() => window.scrollY)),\n    })\n\n    // check initial value\n    expect(scrollPositionMemories[0].x).not.toBe(0)\n    expect(scrollPositionMemories[0].y).not.toBe(0)\n\n    await browser.eval(`window.next.router.push('/1')`)\n    await browser.eval(() => document.querySelector('#link').scrollIntoView())\n    scrollPositionMemories.push({\n      x: Math.floor(await browser.eval(() => window.scrollX)),\n      y: Math.floor(await browser.eval(() => window.scrollY)),\n    })\n    await browser.eval(`window.next.router.push('/2')`)\n\n    // check restore value on history index: 1\n    await browser.back()\n    await check(\n      () => browser.eval(() => document.documentElement.innerHTML),\n      /routeChangeComplete/\n    )\n\n    await check(async () => {\n      assert.equal(\n        scrollPositionMemories[1].x,\n        Math.floor(await browser.eval(() => window.scrollX))\n      )\n      assert.equal(\n        scrollPositionMemories[1].y,\n        Math.floor(await browser.eval(() => window.scrollY))\n      )\n      return 'success'\n    }, 'success')\n\n    await browser.refresh()\n\n    await check(async () => {\n      const isReady = await browser.eval('next.router.isReady')\n      return isReady ? 'success' : isReady\n    }, 'success')\n\n    // check restore value on history index: 0\n    await browser.back()\n    await check(\n      () => browser.eval(() => document.documentElement.innerHTML),\n      /routeChangeComplete/\n    )\n\n    await check(async () => {\n      assert.equal(\n        scrollPositionMemories[0].x,\n        Math.floor(await browser.eval(() => window.scrollX))\n      )\n      assert.equal(\n        scrollPositionMemories[0].y,\n        Math.floor(await browser.eval(() => window.scrollY))\n      )\n      return 'success'\n    }, 'success')\n  })","file":"e2e/reload-scroll-backforward-restoration/index.test.ts","skipped":false,"dir":"test"},{"name":"should restore the scroll position on navigating forward","suites":["reload-scroll-back-restoration"],"updatePoint":{"line":96,"column":62},"line":96,"code":"  it('should restore the scroll position on navigating forward', async () => {\n    const browser = await webdriver(next.url, '/0')\n    await browser.eval(() => document.querySelector('#link').scrollIntoView())\n\n    // check browser restoration setting\n    const scrollRestoration = await browser.eval(\n      () => window.history.scrollRestoration\n    )\n    expect(scrollRestoration).toBe('manual')\n\n    const scrollPositionMemories: Array<{ x: number; y: number }> = []\n    scrollPositionMemories.push({\n      x: Math.floor(await browser.eval(() => window.scrollX)),\n      y: Math.floor(await browser.eval(() => window.scrollY)),\n    })\n\n    // check initial value\n    expect(scrollPositionMemories[0].x).not.toBe(0)\n    expect(scrollPositionMemories[0].y).not.toBe(0)\n\n    await browser.eval(`window.next.router.push('/1')`)\n    await browser.eval(() => document.querySelector('#link').scrollIntoView())\n    scrollPositionMemories.push({\n      x: Math.floor(await browser.eval(() => window.scrollX)),\n      y: Math.floor(await browser.eval(() => window.scrollY)),\n    })\n    await browser.eval(`window.next.router.push('/2')`)\n    await browser.eval(() => document.querySelector('#link').scrollIntoView())\n    scrollPositionMemories.push({\n      x: Math.floor(await browser.eval(() => window.scrollX)),\n      y: Math.floor(await browser.eval(() => window.scrollY)),\n    })\n\n    // check restore value on history index: 1\n    await browser.back()\n    await browser.back()\n    await browser.forward()\n    await check(\n      () => browser.eval(() => document.documentElement.innerHTML),\n      /routeChangeComplete/\n    )\n\n    await check(async () => {\n      assert.equal(\n        scrollPositionMemories[1].x,\n        Math.floor(await browser.eval(() => window.scrollX))\n      )\n      assert.equal(\n        scrollPositionMemories[1].y,\n        Math.floor(await browser.eval(() => window.scrollY))\n      )\n      return 'success'\n    }, 'success')\n\n    await browser.refresh()\n\n    await check(async () => {\n      const isReady = await browser.eval('next.router.isReady')\n      return isReady ? 'success' : isReady\n    }, 'success')\n\n    // check restore value on history index: 2\n    await browser.forward()\n    await check(\n      () => browser.eval(() => document.documentElement.innerHTML),\n      /routeChangeComplete/\n    )\n\n    await check(async () => {\n      assert.equal(\n        scrollPositionMemories[2].x,\n        Math.floor(await browser.eval(() => window.scrollX))\n      )\n      assert.equal(\n        scrollPositionMemories[2].y,\n        Math.floor(await browser.eval(() => window.scrollY))\n      )\n      return 'success'\n    }, 'success')\n  })","file":"e2e/reload-scroll-backforward-restoration/index.test.ts","skipped":false,"dir":"test"},{"name":"should render a page with context","suites":["React Context"],"updatePoint":{"line":19,"column":39},"line":19,"code":"  it('should render a page with context', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toMatch(/Value: .*?hello world/)\n  })","file":"e2e/ssr-react-context/index.test.ts","skipped":false,"dir":"test"},{"name":"should render correctly with context consumer","suites":["React Context"],"updatePoint":{"line":24,"column":51},"line":24,"code":"  it('should render correctly with context consumer', async () => {\n    const html = await renderViaHTTP(next.url, '/consumer')\n    expect(html).toMatch(/Value: .*?12345/)\n  })","file":"e2e/ssr-react-context/index.test.ts","skipped":false,"dir":"test"},{"name":"should render with context after change","suites":["React Context"],"updatePoint":{"line":30,"column":47},"line":30,"code":"    it('should render with context after change', async () => {\n      const aboutAppPagePath = 'pages/_app.js'\n      const originalContent = await next.readFile(aboutAppPagePath)\n      await next.patchFile(\n        aboutAppPagePath,\n        originalContent.replace('hello world', 'new value')\n      )\n\n      try {\n        await check(() => renderViaHTTP(next.url, '/'), /Value: .*?new value/)\n      } finally {\n        await next.patchFile(aboutAppPagePath, originalContent)\n      }\n      await check(() => renderViaHTTP(next.url, '/'), /Value: .*?hello world/)\n    })","file":"e2e/ssr-react-context/index.test.ts","skipped":false,"dir":"test"},{"name":"should match more specific route along with dynamic routes","suites":["react 18 streaming SSR with custom next configs"],"updatePoint":{"line":34,"column":64},"line":34,"code":"  it('should match more specific route along with dynamic routes', async () => {\n    const res1 = await fetchViaHTTP(next.url, '/api/user/login')\n    const res2 = await fetchViaHTTP(next.url, '/api/user/any')\n    expect(await res1.text()).toBe('login')\n    expect(await res2.text()).toBe('[id]')\n  })","file":"e2e/streaming-ssr/index.test.ts","skipped":false,"dir":"test"},{"name":"should render styled-jsx styles in streaming","suites":["react 18 streaming SSR with custom next configs"],"updatePoint":{"line":41,"column":50},"line":41,"code":"  it('should render styled-jsx styles in streaming', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toContain('color:blue')\n  })","file":"e2e/streaming-ssr/index.test.ts","skipped":false,"dir":"test"},{"name":"should redirect paths without trailing-slash and render when slash is appended","suites":["react 18 streaming SSR with custom next configs"],"updatePoint":{"line":46,"column":84},"line":46,"code":"  it('should redirect paths without trailing-slash and render when slash is appended', async () => {\n    const page = '/hello'\n    const redirectRes = await fetchViaHTTP(\n      next.url,\n      page,\n      {},\n      { redirect: 'manual' }\n    )\n    const res = await fetchViaHTTP(next.url, page + '/')\n    const html = await res.text()\n\n    expect(redirectRes.status).toBe(308)\n    expect(res.status).toBe(200)\n    expect(html).toContain('hello nextjs')\n    expect(html).toContain('home')\n  })","file":"e2e/streaming-ssr/index.test.ts","skipped":false,"dir":"test"},{"name":"should render multi-byte characters correctly in streaming","suites":["react 18 streaming SSR with custom next configs"],"updatePoint":{"line":63,"column":64},"line":63,"code":"  it('should render multi-byte characters correctly in streaming', async () => {\n    const html = await renderViaHTTP(next.url, '/multi-byte')\n    expect(html).toContain('マルチバイト'.repeat(28))\n  })","file":"e2e/streaming-ssr/index.test.ts","skipped":false,"dir":"test"},{"name":"should render page correctly under custom server","suites":["react 18 streaming SSR with custom server"],"updatePoint":{"line":104,"column":56},"line":104,"code":"    it('should render page correctly under custom server', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n      expect(html).toContain('streaming')\n    })","file":"e2e/streaming-ssr/index.test.ts","skipped":false,"dir":"test"},{"name":"should pass correct nextRuntime values","suites":["react 18 streaming SSR in minimal mode with node runtime"],"updatePoint":{"line":160,"column":46},"line":160,"code":"    it('should pass correct nextRuntime values', async () => {\n      const content = await next.readFile('runtimes.txt')\n      expect(content.split('\\n').sort()).toEqual(['client', 'edge', 'nodejs'])\n    })","file":"e2e/streaming-ssr/index.test.ts","skipped":false,"dir":"test"},{"name":"should generate html response by streaming correctly","suites":["react 18 streaming SSR in minimal mode with node runtime"],"updatePoint":{"line":165,"column":60},"line":165,"code":"    it('should generate html response by streaming correctly', async () => {\n      const html = await renderViaHTTP(next.url, '/')\n      expect(html).toContain('streaming')\n    })","file":"e2e/streaming-ssr/index.test.ts","skipped":false,"dir":"test"},{"name":"should have generated a static 404 page","suites":["react 18 streaming SSR in minimal mode with node runtime"],"updatePoint":{"line":171,"column":49},"line":171,"code":"      it('should have generated a static 404 page', async () => {\n        expect(await next.readFile('.next/server/pages/404.html')).toBeTruthy()\n\n        const res = await fetchViaHTTP(next.url, '/non-existent')\n        expect(res.status).toBe(404)\n        expect(await res.text()).toContain('This page could not be found')\n      })","file":"e2e/streaming-ssr/index.test.ts","skipped":false,"dir":"test"},{"name":"should contain styled-jsx styles during SSR","suites":["styled-jsx"],"updatePoint":{"line":37,"column":51},"line":37,"code":"    it('should contain styled-jsx styles during SSR', async () => {\n      const html = await renderViaHTTP(next.url, '/')\n      expect(html).toMatch(/color:.*?red/)\n      expect(html).toMatch(/color:.*?cyan/)\n    })","file":"e2e/styled-jsx/index.test.ts","skipped":false,"dir":"test"},{"name":"should render styles during CSR","suites":["styled-jsx"],"updatePoint":{"line":43,"column":39},"line":43,"code":"    it('should render styles during CSR', async () => {\n      const browser = await webdriver(next.url, '/')\n      const color = await browser.eval(\n        `getComputedStyle(document.querySelector('button')).color`\n      )\n\n      expect(color).toMatch('0, 255, 255')\n    })","file":"e2e/styled-jsx/index.test.ts","skipped":false,"dir":"test"},{"name":"should render styles during CSR (AMP)","suites":["styled-jsx"],"updatePoint":{"line":52,"column":45},"line":52,"code":"    it('should render styles during CSR (AMP)', async () => {\n      const browser = await webdriver(next.url, '/amp')\n      const color = await browser.eval(\n        `getComputedStyle(document.querySelector('button')).color`\n      )\n\n      expect(color).toMatch('0, 255, 255')\n    })","file":"e2e/styled-jsx/index.test.ts","skipped":false,"dir":"test"},{"name":"should render styles during SSR (AMP)","suites":["styled-jsx"],"updatePoint":{"line":61,"column":45},"line":61,"code":"    it('should render styles during SSR (AMP)', async () => {\n      const html = await renderViaHTTP(next.url, '/amp')\n      expect(html).toMatch(/color:.*?cyan/)\n    })","file":"e2e/styled-jsx/index.test.ts","skipped":false,"dir":"test"},{"name":"should have warning","suites":["swc warnings by default"],"updatePoint":{"line":27,"column":25},"line":27,"code":"  it('should have warning', async () => {\n    await renderViaHTTP(next.url, '/')\n    expect(next.cliOutput).toContain(\n      'Disabled SWC as replacement for Babel because of custom Babel configuration'\n    )\n  })","file":"e2e/swc-warnings/index.test.ts","skipped":false,"dir":"test"},{"name":"should not have warning","suites":["can force swc"],"updatePoint":{"line":62,"column":29},"line":62,"code":"  it('should not have warning', async () => {\n    await renderViaHTTP(next.url, '/')\n    expect(next.cliOutput).not.toContain(\n      'Disabled SWC as replacement for Babel because of custom Babel configuration'\n    )\n  })","file":"e2e/swc-warnings/index.test.ts","skipped":false,"dir":"test"},{"name":"should not include edge api routes and edge ssr routes into dev middleware manifest","suites":["Switchable runtime","Switchable runtime (dev)"],"updatePoint":{"line":64,"column":93},"line":64,"code":"      it('should not include edge api routes and edge ssr routes into dev middleware manifest', async () => {\n        const res = await fetchViaHTTP(\n          next.url,\n          `/_next/static/${next.buildId}/_devMiddlewareManifest.json`\n        )\n        const devMiddlewareManifest = await res.json()\n        expect(devMiddlewareManifest).toEqual([])\n      })","file":"e2e/switchable-runtime/index.test.ts","skipped":false,"dir":"test"},{"name":"should sort edge SSR routes correctly","suites":["Switchable runtime","Switchable runtime (dev)"],"updatePoint":{"line":73,"column":47},"line":73,"code":"      it('should sort edge SSR routes correctly', async () => {\n        const res = await fetchViaHTTP(next.url, `/edge/foo`)\n        const html = await res.text()\n\n        // /edge/foo should be caught before /edge/[id]\n        expect(html).toContain(`to /edge/[id]`)\n      })","file":"e2e/switchable-runtime/index.test.ts","skipped":false,"dir":"test"},{"name":"should be able to navigate between edge SSR routes without any errors","suites":["Switchable runtime","Switchable runtime (dev)"],"updatePoint":{"line":81,"column":79},"line":81,"code":"      it('should be able to navigate between edge SSR routes without any errors', async () => {\n        const res = await fetchViaHTTP(next.url, `/edge/foo`)\n        const html = await res.text()\n\n        // /edge/foo should be caught before /edge/[id]\n        expect(html).toContain(`to /edge/[id]`)\n\n        const browser = await webdriver(context.appPort, '/edge/foo')\n\n        await browser.waitForElementByCss('a').click()\n\n        // on /edge/[id]\n        await check(\n          () => browser.eval('document.documentElement.innerHTML'),\n          /to \\/edge\\/foo/\n        )\n\n        await browser.waitForElementByCss('a').click()\n\n        // on /edge/foo\n        await check(\n          () => browser.eval('document.documentElement.innerHTML'),\n          /to \\/edge\\/\\[id\\]/\n        )\n\n        expect(context.stdout).not.toContain('self is not defined')\n        expect(context.stderr).not.toContain('self is not defined')\n      })","file":"e2e/switchable-runtime/index.test.ts","skipped":false,"dir":"test"},{"name":"should support client side navigation to ssr rsc pages","suites":["Switchable runtime","Switchable runtime (dev)"],"line":110,"code":"      it.skip('should support client side navigation to ssr rsc pages', async () => {","file":"e2e/switchable-runtime/index.test.ts","skipped":true,"dir":"test"},{"name":"should support client side navigation to ssg rsc pages","suites":["Switchable runtime","Switchable runtime (dev)"],"line":136,"code":"      it.skip('should support client side navigation to ssg rsc pages', async () => {","file":"e2e/switchable-runtime/index.test.ts","skipped":true,"dir":"test"},{"name":"should support client side navigation to static rsc pages","suites":["Switchable runtime","Switchable runtime (dev)"],"line":150,"code":"      it.skip('should support client side navigation to static rsc pages', async () => {","file":"e2e/switchable-runtime/index.test.ts","skipped":true,"dir":"test"},{"name":"should build /api/hello and /api/edge as an api route with edge runtime","suites":["Switchable runtime","Switchable runtime (dev)"],"updatePoint":{"line":164,"column":81},"line":164,"code":"      it('should build /api/hello and /api/edge as an api route with edge runtime', async () => {\n        let response = await fetchViaHTTP(context.appPort, '/api/hello')\n        let text = await response.text()\n        expect(text).toMatch(/Hello from .+\\/api\\/hello/)\n\n        response = await fetchViaHTTP(context.appPort, '/api/edge')\n        text = await response.text()\n        expect(text).toMatch(/Returned by Edge API Route .+\\/api\\/edge/)\n\n        if (!(global as any).isNextDeploy) {\n          const manifest = await readJson(\n            join(context.appDir, '.next/server/middleware-manifest.json')\n          )\n          expect(manifest).toMatchObject({\n            functions: {\n              '/api/hello': {\n                env: [],\n                files: [\n                  'server/edge-runtime-webpack.js',\n                  'server/pages/api/hello.js',\n                ],\n                name: 'pages/api/hello',\n                page: '/api/hello',\n                matchers: [{ regexp: '^/api/hello$' }],\n                wasm: [],\n              },\n              '/api/edge': {\n                env: [],\n                files: [\n                  'server/edge-runtime-webpack.js',\n                  'server/pages/api/edge.js',\n                ],\n                name: 'pages/api/edge',\n                page: '/api/edge',\n                matchers: [{ regexp: '^/api/edge$' }],\n                wasm: [],\n              },\n            },\n          })\n        }\n      })","file":"e2e/switchable-runtime/index.test.ts","skipped":false,"dir":"test"},{"name":"should be possible to switch between runtimes in API routes","suites":["Switchable runtime","Switchable runtime (dev)"],"updatePoint":{"line":206,"column":69},"line":206,"code":"      it('should be possible to switch between runtimes in API routes', async () => {\n        await check(\n          () => renderViaHTTP(next.url, '/api/switch-in-dev'),\n          'server response'\n        )\n\n        // Edge\n        await next.patchFile(\n          'pages/api/switch-in-dev.js',\n          `\n          export const config = {\n            runtime: 'experimental-edge',\n          }\n  \n          export default () => new Response('edge response')\n          `\n        )\n        await check(\n          () => renderViaHTTP(next.url, '/api/switch-in-dev'),\n          'edge response'\n        )\n\n        // Server\n        await next.patchFile(\n          'pages/api/switch-in-dev.js',\n          `\n          export default function (req, res) {\n            res.send('server response again')\n          }\n          `\n        )\n        await check(\n          () => renderViaHTTP(next.url, '/api/switch-in-dev'),\n          'server response again'\n        )\n\n        // Edge\n        await next.patchFile(\n          'pages/api/switch-in-dev.js',\n          `\n          export const config = {\n            runtime: 'experimental-edge',\n          }\n  \n          export default () => new Response('edge response again')\n          `\n        )\n        await check(\n          () => renderViaHTTP(next.url, '/api/switch-in-dev'),\n          'edge response again'\n        )\n      })","file":"e2e/switchable-runtime/index.test.ts","skipped":false,"dir":"test"},{"name":"should be possible to switch between runtimes in pages","suites":["Switchable runtime","Switchable runtime (dev)"],"updatePoint":{"line":259,"column":64},"line":259,"code":"      it('should be possible to switch between runtimes in pages', async () => {\n        await check(\n          () => renderViaHTTP(next.url, '/switch-in-dev'),\n          /Hello from edge page/\n        )\n\n        // Server\n        await next.patchFile(\n          'pages/switch-in-dev.js',\n          `\n          export default function Page() {\n            return <p>Hello from server page</p>\n          }\n          `\n        )\n        await check(\n          () => renderViaHTTP(next.url, '/switch-in-dev'),\n          /Hello from server page/\n        )\n\n        // Edge\n        await next.patchFile(\n          'pages/switch-in-dev.js',\n          `\n      export default function Page() {\n        return <p>Hello from edge page again</p>\n      }\n\n      export const config = {\n        runtime: 'experimental-edge',\n      }\n      `\n        )\n        await check(\n          () => renderViaHTTP(next.url, '/switch-in-dev'),\n          /Hello from edge page again/\n        )\n\n        // Server\n        await next.patchFile(\n          'pages/switch-in-dev.js',\n          `\n            export default function Page() {\n              return <p>Hello from server page again</p>\n            }\n            `\n        )\n        await check(\n          () => renderViaHTTP(next.url, '/switch-in-dev'),\n          /Hello from server page again/\n        )\n      })","file":"e2e/switchable-runtime/index.test.ts","skipped":false,"dir":"test"},{"name":"should be possible to switch between runtimes with same content","suites":["Switchable runtime","Switchable runtime (dev)"],"line":313,"code":"      it.skip('should be possible to switch between runtimes with same content', async () => {","file":"e2e/switchable-runtime/index.test.ts","skipped":true,"dir":"test"},{"name":"should recover from syntax error when using edge runtime","suites":["Switchable runtime","Switchable runtime (dev)"],"updatePoint":{"line":350,"column":66},"line":350,"code":"      it('should recover from syntax error when using edge runtime', async () => {\n        await check(\n          () => renderViaHTTP(next.url, '/api/syntax-error-in-dev'),\n          'edge response'\n        )\n\n        // Syntax error\n        await next.patchFile(\n          'pages/api/syntax-error-in-dev.js',\n          `\n        export const config = {\n          runtime: 'experimental-edge',\n        }\n    \n        export default  => new Response('edge response')\n        `\n        )\n        await check(\n          () => renderViaHTTP(next.url, '/api/syntax-error-in-dev'),\n          /Unexpected token/\n        )\n\n        // Fix syntax error\n        await next.patchFile(\n          'pages/api/syntax-error-in-dev.js',\n          `\n          export default () => new Response('edge response again')\n\n          export const config = {\n            runtime: 'experimental-edge',\n          }\n          \n        `\n        )\n        await check(\n          () => renderViaHTTP(next.url, '/api/syntax-error-in-dev'),\n          'edge response again'\n        )\n      })","file":"e2e/switchable-runtime/index.test.ts","skipped":false,"dir":"test"},{"name":"should not crash the dev server when invalid runtime is configured","suites":["Switchable runtime","Switchable runtime (dev)"],"updatePoint":{"line":390,"column":76},"line":390,"code":"      it('should not crash the dev server when invalid runtime is configured', async () => {\n        await check(\n          () => renderViaHTTP(next.url, '/invalid-runtime'),\n          /Hello from page without errors/\n        )\n\n        // Invalid runtime type\n        await next.patchFile(\n          'pages/invalid-runtime.js',\n          `\n          export default function Page() {\n            return <p>Hello from page with invalid type</p>\n          }\n          \n          export const config = {\n            runtime: 10,\n          }\n            `\n        )\n        await check(\n          () => renderViaHTTP(next.url, '/invalid-runtime'),\n          /Hello from page with invalid type/\n        )\n        expect(next.cliOutput).toInclude(\n          'error - The `runtime` config must be a string. Please leave it empty or choose one of:'\n        )\n\n        // Invalid runtime\n        await next.patchFile(\n          'pages/invalid-runtime.js',\n          `\n            export default function Page() {\n              return <p>Hello from page with invalid runtime</p>\n            }\n            \n            export const config = {\n              runtime: \"asd\"\n            }\n              `\n        )\n        await check(\n          () => renderViaHTTP(next.url, '/invalid-runtime'),\n          /Hello from page with invalid runtime/\n        )\n        expect(next.cliOutput).toInclude(\n          'error - Provided runtime \"asd\" is not supported. Please leave it empty or choose one of:'\n        )\n\n        // Fix the runtime\n        await next.patchFile(\n          'pages/invalid-runtime.js',\n          `\n        export default function Page() {\n          return <p>Hello from page without errors</p>\n        }\n        \n        export const config = {\n          runtime: 'experimental-edge',\n        }\n  \n        `\n        )\n        await check(\n          () => renderViaHTTP(next.url, '/invalid-runtime'),\n          /Hello from page without errors/\n        )\n      })","file":"e2e/switchable-runtime/index.test.ts","skipped":false,"dir":"test"},{"name":"should build /static as a static page with the nodejs runtime","suites":["Switchable runtime","Switchable runtime (prod)"],"updatePoint":{"line":460,"column":71},"line":460,"code":"      it('should build /static as a static page with the nodejs runtime', async () => {\n        await testRoute(context.appPort, '/static', {\n          isStatic: true,\n          isEdge: false,\n        })\n      })","file":"e2e/switchable-runtime/index.test.ts","skipped":false,"dir":"test"},{"name":"should build /node as a static page with the nodejs runtime","suites":["Switchable runtime","Switchable runtime (prod)"],"line":467,"code":"      it.skip('should build /node as a static page with the nodejs runtime', async () => {","file":"e2e/switchable-runtime/index.test.ts","skipped":true,"dir":"test"},{"name":"should build /node-ssr as a dynamic page with the nodejs runtime","suites":["Switchable runtime","Switchable runtime (prod)"],"updatePoint":{"line":474,"column":74},"line":474,"code":"      it('should build /node-ssr as a dynamic page with the nodejs runtime', async () => {\n        await testRoute(context.appPort, '/node-ssr', {\n          isStatic: false,\n          isEdge: false,\n        })\n      })","file":"e2e/switchable-runtime/index.test.ts","skipped":false,"dir":"test"},{"name":"should build /node-ssg as a static page with the nodejs runtime","suites":["Switchable runtime","Switchable runtime (prod)"],"line":481,"code":"      it.skip('should build /node-ssg as a static page with the nodejs runtime', async () => {","file":"e2e/switchable-runtime/index.test.ts","skipped":true,"dir":"test"},{"name":"should build /node-rsc as a static page with the nodejs runtime","suites":["Switchable runtime","Switchable runtime (prod)"],"line":488,"code":"      it.skip('should build /node-rsc as a static page with the nodejs runtime', async () => {","file":"e2e/switchable-runtime/index.test.ts","skipped":true,"dir":"test"},{"name":"should build /node-rsc-ssr as a dynamic page with the nodejs runtime","suites":["Switchable runtime","Switchable runtime (prod)"],"line":496,"code":"      it.skip('should build /node-rsc-ssr as a dynamic page with the nodejs runtime', async () => {","file":"e2e/switchable-runtime/index.test.ts","skipped":true,"dir":"test"},{"name":"should build /node-rsc-ssg as a static page with the nodejs runtime","suites":["Switchable runtime","Switchable runtime (prod)"],"line":504,"code":"      it.skip('should build /node-rsc-ssg as a static page with the nodejs runtime', async () => {","file":"e2e/switchable-runtime/index.test.ts","skipped":true,"dir":"test"},{"name":"should build /node-rsc-isr as an isr page with the nodejs runtime","suites":["Switchable runtime","Switchable runtime (prod)"],"line":512,"code":"      it.skip('should build /node-rsc-isr as an isr page with the nodejs runtime', async () => {","file":"e2e/switchable-runtime/index.test.ts","skipped":true,"dir":"test"},{"name":"should build /edge as a dynamic page with the edge runtime","suites":["Switchable runtime","Switchable runtime (prod)"],"updatePoint":{"line":536,"column":68},"line":536,"code":"      it('should build /edge as a dynamic page with the edge runtime', async () => {\n        await testRoute(context.appPort, '/edge', {\n          isStatic: false,\n          isEdge: true,\n        })\n        await testRoute(context.appPort, '/rewrite/edge', {\n          isStatic: false,\n          isEdge: true,\n        })\n      })","file":"e2e/switchable-runtime/index.test.ts","skipped":false,"dir":"test"},{"name":"should build /edge-rsc as a dynamic page with the edge runtime","suites":["Switchable runtime","Switchable runtime (prod)"],"line":548,"code":"      it.skip('should build /edge-rsc as a dynamic page with the edge runtime', async () => {","file":"e2e/switchable-runtime/index.test.ts","skipped":true,"dir":"test"},{"name":"should build /api/hello and /api/edge as an api route with edge runtime","suites":["Switchable runtime","Switchable runtime (prod)"],"updatePoint":{"line":555,"column":81},"line":555,"code":"      it('should build /api/hello and /api/edge as an api route with edge runtime', async () => {\n        let response = await fetchViaHTTP(context.appPort, '/api/hello')\n        let text = await response.text()\n        expect(text).toMatch(/Hello from .+\\/api\\/hello/)\n\n        response = await fetchViaHTTP(context.appPort, '/api/edge')\n        text = await response.text()\n        expect(text).toMatch(/Returned by Edge API Route .+\\/api\\/edge/)\n\n        // Rewrite should also work\n        response = await fetchViaHTTP(context.appPort, 'rewrite/api/edge')\n        text = await response.text()\n        expect(text).toMatch(/Returned by Edge API Route .+\\/api\\/edge/)\n\n        if (!(global as any).isNextDeploy) {\n          const manifest = await readJson(\n            join(context.appDir, '.next/server/middleware-manifest.json')\n          )\n          expect(manifest).toMatchObject({\n            functions: {\n              '/api/hello': {\n                env: [],\n                files: [\n                  'server/edge-runtime-webpack.js',\n                  'server/pages/api/hello.js',\n                ],\n                name: 'pages/api/hello',\n                page: '/api/hello',\n                matchers: [{ regexp: '^/api/hello$' }],\n                wasm: [],\n              },\n              '/api/edge': {\n                env: [],\n                files: [\n                  'server/edge-runtime-webpack.js',\n                  'server/pages/api/edge.js',\n                ],\n                name: 'pages/api/edge',\n                page: '/api/edge',\n                matchers: [{ regexp: '^/api/edge$' }],\n                wasm: [],\n              },\n            },\n          })\n        }\n      })","file":"e2e/switchable-runtime/index.test.ts","skipped":false,"dir":"test"},{"name":"should display correct tree view with page types in terminal","suites":["Switchable runtime","Switchable runtime (prod)"],"line":602,"code":"      it.skip('should display correct tree view with page types in terminal', async () => {","file":"e2e/switchable-runtime/index.test.ts","skipped":true,"dir":"test"},{"name":"should prefetch data for static pages","suites":["Switchable runtime","Switchable runtime (prod)"],"line":635,"code":"      it.skip('should prefetch data for static pages', async () => {","file":"e2e/switchable-runtime/index.test.ts","skipped":true,"dir":"test"},{"name":"should support client side navigation to ssr rsc pages","suites":["Switchable runtime","Switchable runtime (prod)"],"line":661,"code":"      it.skip('should support client side navigation to ssr rsc pages', async () => {","file":"e2e/switchable-runtime/index.test.ts","skipped":true,"dir":"test"},{"name":"should support client side navigation to ssg rsc pages","suites":["Switchable runtime","Switchable runtime (prod)"],"line":683,"code":"      it.skip('should support client side navigation to ssg rsc pages', async () => {","file":"e2e/switchable-runtime/index.test.ts","skipped":true,"dir":"test"},{"name":"should support client side navigation to static rsc pages","suites":["Switchable runtime","Switchable runtime (prod)"],"line":692,"code":"      it.skip('should support client side navigation to static rsc pages', async () => {","file":"e2e/switchable-runtime/index.test.ts","skipped":true,"dir":"test"},{"name":"should support etag header in the web server","suites":["Switchable runtime","Switchable runtime (prod)"],"updatePoint":{"line":701,"column":54},"line":701,"code":"      it('should support etag header in the web server', async () => {\n        const res = await fetchViaHTTP(context.appPort, '/edge', '', {\n          headers: {\n            // Make sure the result is static so an etag can be generated.\n            'User-Agent': 'Googlebot',\n          },\n        })\n        expect(res.headers.get('ETag')).toBeDefined()\n      })","file":"e2e/switchable-runtime/index.test.ts","skipped":false,"dir":"test"},{"name":"should render server-side","suites":["Type module interop"],"updatePoint":{"line":86,"column":31},"line":86,"code":"  it('should render server-side', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toContain('hello world')\n    // component load via next/dynamic should rendered on the server side\n    expect(html).toContain('An example components load via next/dynamic')\n    // imported next/amp should work on the server side\n    const $ = cheerio.load(html)\n    expect($('#isAmp').text()).toContain('false')\n  })","file":"e2e/type-module-interop/index.test.ts","skipped":false,"dir":"test"},{"name":"should render client-side","suites":["Type module interop"],"updatePoint":{"line":96,"column":31},"line":96,"code":"  it('should render client-side', async () => {\n    const browser = await webdriver(next.url, '/')\n    expect(await hasRedbox(browser)).toBe(false)\n    await browser.close()\n  })","file":"e2e/type-module-interop/index.test.ts","skipped":false,"dir":"test"},{"name":"should render server-side with modules","suites":["Type module interop"],"updatePoint":{"line":102,"column":44},"line":102,"code":"  it('should render server-side with modules', async () => {\n    const html = await renderViaHTTP(next.url, '/modules')\n    const $ = cheerio.load(html)\n    expect($('#link-to-home').text()).toBe('link to home')\n  })","file":"e2e/type-module-interop/index.test.ts","skipped":false,"dir":"test"},{"name":"should render client-side with modules","suites":["Type module interop"],"updatePoint":{"line":108,"column":44},"line":108,"code":"  it('should render client-side with modules', async () => {\n    const browser = await webdriver(next.url, '/modules')\n    expect(await hasRedbox(browser)).toBe(false)\n    await browser.close()\n  })","file":"e2e/type-module-interop/index.test.ts","skipped":false,"dir":"test"},{"name":"should build successfully","suites":["404 Page Support with _app","production mode"],"updatePoint":{"line":27,"column":33},"line":27,"code":"    it('should build successfully', async () => {\n      const { code, stderr, stdout } = await nextBuild(appDir, [], {\n        stderr: true,\n        stdout: true,\n      })\n\n      expect(code).toBe(0)\n      expect(stderr).not.toMatch(gip404Err)\n      expect(stdout).not.toMatch(gip404Err)\n\n      appPort = await findPort()\n      app = await nextStart(appDir, appPort)\n    })","file":"integration/404-page-app/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not output static 404 if _app has getInitialProps","suites":["404 Page Support with _app","production mode"],"updatePoint":{"line":41,"column":64},"line":41,"code":"    it('should not output static 404 if _app has getInitialProps', async () => {\n      const browser = await webdriver(appPort, '/404')\n      const isAutoExported = await browser.eval('__NEXT_DATA__.autoExport')\n      expect(isAutoExported).toBeFalsy()\n    })","file":"integration/404-page-app/test/index.test.js","skipped":false,"dir":"test"},{"name":"specify to use the 404 page still in the routes-manifest","suites":["404 Page Support with _app","production mode"],"updatePoint":{"line":47,"column":64},"line":47,"code":"    it('specify to use the 404 page still in the routes-manifest', async () => {\n      const manifest = await fs.readJSON(\n        join(appDir, '.next/routes-manifest.json')\n      )\n      expect(manifest.pages404).toBe(true)\n    })","file":"integration/404-page-app/test/index.test.js","skipped":false,"dir":"test"},{"name":"should still use 404 page","suites":["404 Page Support with _app","production mode"],"updatePoint":{"line":54,"column":33},"line":54,"code":"    it('should still use 404 page', async () => {\n      const res = await fetchViaHTTP(appPort, '/abc')\n      expect(res.status).toBe(404)\n      const $ = cheerio.load(await res.text())\n      expect($('#404-title').text()).toBe('Hi There')\n    })","file":"integration/404-page-app/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show pages/404 GIP error if _app has GIP","suites":["404 Page Support with _app","dev mode"],"updatePoint":{"line":79,"column":59},"line":79,"code":"    it('should not show pages/404 GIP error if _app has GIP', async () => {\n      const res = await fetchViaHTTP(appPort, '/abc')\n      expect(res.status).toBe(404)\n      const $ = cheerio.load(await res.text())\n      expect($('#404-title').text()).toBe('Hi There')\n      expect(stderr).not.toMatch(gip404Err)\n      expect(stdout).not.toMatch(gip404Err)\n    })","file":"integration/404-page-app/test/index.test.js","skipped":false,"dir":"test"},{"name":"should respond to 404 correctly","suites":[],"updatePoint":{"line":25,"column":37},"line":25,"code":"  it('should respond to 404 correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/404')\n    expect(res.status).toBe(404)\n    expect(await res.text()).toContain('This page could not be found')\n  })","file":"integration/404-page-custom-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render error correctly","suites":[],"updatePoint":{"line":31,"column":35},"line":31,"code":"  it('should render error correctly', async () => {\n    const text = await renderViaHTTP(appPort, '/err')\n    expect(text).toContain(isDev ? 'oops' : 'Internal Server Error')\n  })","file":"integration/404-page-custom-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render index page normal","suites":[],"updatePoint":{"line":36,"column":37},"line":36,"code":"  it('should render index page normal', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toContain('hello from index')\n  })","file":"integration/404-page-custom-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should set pages404 in routes-manifest correctly","suites":[],"updatePoint":{"line":42,"column":56},"line":42,"code":"    it('should set pages404 in routes-manifest correctly', async () => {\n      const data = await fs.readJSON(join(appDir, '.next/routes-manifest.json'))\n      expect(data.pages404).toBe(true)\n    })","file":"integration/404-page-custom-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have output 404.html","suites":[],"updatePoint":{"line":47,"column":35},"line":47,"code":"    it('should have output 404.html', async () => {\n      const page = getPageFileFromPagesManifest(appDir, '/404')\n      expect(page.endsWith('.html')).toBe(true)\n    })","file":"integration/404-page-custom-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build successfully","suites":["Default 404 Page with custom _error","server mode"],"updatePoint":{"line":58,"column":33},"line":58,"code":"    it('should build successfully', async () => {\n      const { code } = await nextBuild(appDir, [], {\n        stderr: true,\n        stdout: true,\n      })\n\n      expect(code).toBe(0)\n\n      appPort = await findPort()\n\n      app = await nextStart(appDir, appPort)\n    })","file":"integration/404-page-custom-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build successfully","suites":["Default 404 Page with custom _error","serverless mode"],"updatePoint":{"line":80,"column":33},"line":80,"code":"    it('should build successfully', async () => {\n      await fs.writeFile(\n        nextConfig,\n        `\n        module.exports = { target: 'experimental-serverless-trace' }\n      `\n      )\n      const { code } = await nextBuild(appDir, [], {\n        stderr: true,\n        stdout: true,\n      })\n\n      expect(code).toBe(0)\n\n      appPort = await findPort()\n      app = await nextStart(appDir, appPort)\n    })","file":"integration/404-page-custom-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should respond to 404 correctly","suites":[],"updatePoint":{"line":28,"column":37},"line":28,"code":"  it('should respond to 404 correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/404')\n    expect(res.status).toBe(404)\n    expect(await res.text()).toContain('custom 404 page')\n  })","file":"integration/404-page-ssg/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render error correctly","suites":[],"updatePoint":{"line":34,"column":35},"line":34,"code":"  it('should render error correctly', async () => {\n    const text = await renderViaHTTP(appPort, '/err')\n    expect(text).toContain(isDev ? 'oops' : 'Internal Server Error')\n  })","file":"integration/404-page-ssg/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show an error in the logs for 404 SSG","suites":[],"updatePoint":{"line":39,"column":54},"line":39,"code":"  it('should not show an error in the logs for 404 SSG', async () => {\n    await renderViaHTTP(appPort, '/non-existent')\n    expect(stderr).not.toMatch(gip404Err)\n    expect(stdout).not.toMatch(gip404Err)\n  })","file":"integration/404-page-ssg/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render index page normal","suites":[],"updatePoint":{"line":45,"column":37},"line":45,"code":"  it('should render index page normal', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toContain('hello from index')\n  })","file":"integration/404-page-ssg/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not revalidate custom 404 page","suites":[],"updatePoint":{"line":51,"column":45},"line":51,"code":"    it('should not revalidate custom 404 page', async () => {\n      const res1 = await renderViaHTTP(appPort, '/non-existent')\n      const res2 = await renderViaHTTP(appPort, '/non-existent')\n      const res3 = await renderViaHTTP(appPort, '/non-existent')\n      const res4 = await renderViaHTTP(appPort, '/non-existent')\n\n      expect(res1 === res2 && res2 === res3 && res3 === res4).toBe(true)\n\n      expect(res1).toContain('custom 404 page')\n    })","file":"integration/404-page-ssg/test/index.test.js","skipped":false,"dir":"test"},{"name":"should set pages404 in routes-manifest correctly","suites":[],"updatePoint":{"line":62,"column":56},"line":62,"code":"    it('should set pages404 in routes-manifest correctly', async () => {\n      const data = await fs.readJSON(join(appDir, '.next/routes-manifest.json'))\n      expect(data.pages404).toBe(true)\n    })","file":"integration/404-page-ssg/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have 404 page in prerender-manifest","suites":[],"updatePoint":{"line":67,"column":50},"line":67,"code":"    it('should have 404 page in prerender-manifest', async () => {\n      const data = await fs.readJSON(\n        join(appDir, '.next/prerender-manifest.json')\n      )\n      expect(data.routes['/404']).toEqual({\n        initialRevalidateSeconds: false,\n        srcRoute: null,\n        dataRoute: `/_next/data/${buildId}/404.json`,\n      })\n    })","file":"integration/404-page-ssg/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build successfully","suites":["404 Page Support SSG","server mode"],"updatePoint":{"line":84,"column":33},"line":84,"code":"    it('should build successfully', async () => {\n      nextConfigContent = await fs.readFile(nextConfig, 'utf8')\n      const {\n        code,\n        stderr: buildStderr,\n        stdout: buildStdout,\n      } = await nextBuild(appDir, [], {\n        stderr: true,\n        stdout: true,\n      })\n\n      expect(code).toBe(0)\n      expect(buildStderr).not.toMatch(gip404Err)\n      expect(buildStdout).not.toMatch(gip404Err)\n\n      appPort = await findPort()\n      stderr = ''\n      stdout = ''\n\n      app = await nextStart(appDir, appPort, {\n        onStdout(msg) {\n          stdout += msg\n        },\n        onStderr(msg) {\n          stderr += msg\n        },\n      })\n      buildId = await fs.readFile(join(appDir, '.next/BUILD_ID'), 'utf8')\n    })","file":"integration/404-page-ssg/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build successfully","suites":["404 Page Support SSG","serverless mode"],"updatePoint":{"line":123,"column":33},"line":123,"code":"    it('should build successfully', async () => {\n      nextConfigContent = await fs.readFile(nextConfig, 'utf8')\n      await fs.writeFile(\n        nextConfig,\n        `\n        module.exports = { target: 'experimental-serverless-trace' }\n      `\n      )\n      const {\n        code,\n        stderr: buildStderr,\n        stdout: buildStdout,\n      } = await nextBuild(appDir, [], {\n        stderr: true,\n        stdout: true,\n      })\n\n      expect(code).toBe(0)\n      expect(buildStderr).not.toMatch(gip404Err)\n      expect(buildStdout).not.toMatch(gip404Err)\n\n      appPort = await findPort()\n      stderr = ''\n      stdout = ''\n      app = await nextStart(appDir, appPort, {\n        onStdout(msg) {\n          stdout += msg\n        },\n        onStderr(msg) {\n          stderr += msg\n        },\n      })\n      buildId = await fs.readFile(join(appDir, '.next/BUILD_ID'), 'utf8')\n    })","file":"integration/404-page-ssg/test/index.test.js","skipped":false,"dir":"test"},{"name":"should use pages/404","suites":[],"updatePoint":{"line":31,"column":26},"line":31,"code":"  it('should use pages/404', async () => {\n    const html = await renderViaHTTP(appPort, '/abc')\n    expect(html).toContain('custom 404 page')\n  })","file":"integration/404-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"should set correct status code with pages/404","suites":[],"updatePoint":{"line":36,"column":51},"line":36,"code":"  it('should set correct status code with pages/404', async () => {\n    const res = await fetchViaHTTP(appPort, '/abc')\n    expect(res.status).toBe(404)\n  })","file":"integration/404-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"should use pages/404 for .d.ts file","suites":[],"updatePoint":{"line":41,"column":41},"line":41,"code":"  it('should use pages/404 for .d.ts file', async () => {\n    const html = await renderViaHTTP(appPort, '/invalidExtension')\n    expect(html).toContain('custom 404 page')\n  })","file":"integration/404-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not error when visited directly","suites":[],"updatePoint":{"line":46,"column":44},"line":46,"code":"  it('should not error when visited directly', async () => {\n    const res = await fetchViaHTTP(appPort, '/404')\n    expect(res.status).toBe(404)\n    expect(await res.text()).toContain('custom 404 page')\n  })","file":"integration/404-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render _error for a 500 error still","suites":[],"updatePoint":{"line":52,"column":48},"line":52,"code":"  it('should render _error for a 500 error still', async () => {\n    const html = await renderViaHTTP(appPort, '/err')\n    expect(html).not.toContain('custom 404 page')\n    expect(html).toContain(mode === 'dev' ? 'oops' : 'Internal Server Error')\n  })","file":"integration/404-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"should output 404.html during build","suites":[],"updatePoint":{"line":59,"column":43},"line":59,"code":"    it('should output 404.html during build', async () => {\n      const page = getPageFileFromPagesManifest(appDir, '/404')\n      expect(page.endsWith('.html')).toBe(true)\n    })","file":"integration/404-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"should add /404 to pages-manifest correctly","suites":[],"updatePoint":{"line":64,"column":51},"line":64,"code":"    it('should add /404 to pages-manifest correctly', async () => {\n      const manifest = await fs.readJSON(\n        join(appDir, '.next', mode, 'pages-manifest.json')\n      )\n      expect('/404' in manifest).toBe(true)\n    })","file":"integration/404-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not cache for custom 404 page with gssp and revalidate disabled","suites":["404 Page Support","serverless mode"],"updatePoint":{"line":118,"column":76},"line":118,"code":"  it('should not cache for custom 404 page with gssp and revalidate disabled', async () => {\n    await fs.move(pages404, `${pages404}.bak`)\n    await fs.writeFile(\n      pages404,\n      `\n      const page = () => 'custom 404 page'\n      export async function getStaticProps() { return { props: {} } }\n      export default page\n    `\n    )\n    await nextBuild(appDir)\n    appPort = await findPort()\n    app = await nextStart(appDir, appPort)\n    const cache404 = await getCacheHeader(appPort, '/404')\n    const cacheNext = await getCacheHeader(appPort, '/_next/abc')\n    await fs.remove(pages404)\n    await fs.move(`${pages404}.bak`, pages404)\n    await killApp(app)\n\n    expect(cache404).toBe(\n      'private, no-cache, no-store, max-age=0, must-revalidate'\n    )\n    expect(cacheNext).toBe(\n      'private, no-cache, no-store, max-age=0, must-revalidate'\n    )\n  })","file":"integration/404-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not cache for custom 404 page with gssp and revalidate enabled","suites":["404 Page Support","serverless mode"],"updatePoint":{"line":145,"column":75},"line":145,"code":"  it('should not cache for custom 404 page with gssp and revalidate enabled', async () => {\n    await fs.move(pages404, `${pages404}.bak`)\n    await fs.writeFile(\n      pages404,\n      `\n      const page = () => 'custom 404 page'\n      export async function getStaticProps() { return { props: {}, revalidate: 1 } }\n      export default page\n    `\n    )\n    await nextBuild(appDir)\n    appPort = await findPort()\n    app = await nextStart(appDir, appPort)\n    const cache404 = await getCacheHeader(appPort, '/404')\n    const cacheNext = await getCacheHeader(appPort, '/_next/abc')\n    await fs.remove(pages404)\n    await fs.move(`${pages404}.bak`, pages404)\n    await killApp(app)\n\n    expect(cache404).toBe(\n      'private, no-cache, no-store, max-age=0, must-revalidate'\n    )\n    expect(cacheNext).toBe(\n      'private, no-cache, no-store, max-age=0, must-revalidate'\n    )\n  })","file":"integration/404-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not cache for custom 404 page without gssp","suites":["404 Page Support","serverless mode"],"updatePoint":{"line":172,"column":55},"line":172,"code":"  it('should not cache for custom 404 page without gssp', async () => {\n    await nextBuild(appDir)\n    appPort = await findPort()\n    app = await nextStart(appDir, appPort)\n    const cache404 = await getCacheHeader(appPort, '/404')\n    const cacheNext = await getCacheHeader(appPort, '/_next/abc')\n    await killApp(app)\n\n    expect(cache404).toBe(null)\n    expect(cacheNext).toBe('no-cache, no-store, max-age=0, must-revalidate')\n  })","file":"integration/404-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"falls back to _error correctly without pages/404","suites":["404 Page Support","serverless mode"],"updatePoint":{"line":184,"column":54},"line":184,"code":"  it('falls back to _error correctly without pages/404', async () => {\n    await fs.move(pages404, `${pages404}.bak`)\n    appPort = await findPort()\n    app = await launchApp(appDir, appPort)\n    const res = await fetchViaHTTP(appPort, '/abc')\n\n    await fs.move(`${pages404}.bak`, pages404)\n    await killApp(app)\n\n    expect(res.status).toBe(404)\n    expect(await res.text()).toContain('This page could not be found')\n  })","file":"integration/404-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows error with getInitialProps in pages/404 build","suites":["404 Page Support","serverless mode"],"updatePoint":{"line":197,"column":57},"line":197,"code":"  it('shows error with getInitialProps in pages/404 build', async () => {\n    await fs.move(pages404, `${pages404}.bak`)\n    await fs.writeFile(\n      pages404,\n      `\n      const page = () => 'custom 404 page'\n      page.getInitialProps = () => ({ a: 'b' })\n      export default page\n    `\n    )\n    const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n    await fs.remove(pages404)\n    await fs.move(`${pages404}.bak`, pages404)\n\n    expect(stderr).toMatch(gip404Err)\n    expect(code).toBe(1)\n  })","file":"integration/404-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows error with getInitialProps in pages/404 dev","suites":["404 Page Support","serverless mode"],"updatePoint":{"line":215,"column":55},"line":215,"code":"  it('shows error with getInitialProps in pages/404 dev', async () => {\n    await fs.move(pages404, `${pages404}.bak`)\n    await fs.writeFile(\n      pages404,\n      `\n      const page = () => 'custom 404 page'\n      page.getInitialProps = () => ({ a: 'b' })\n      export default page\n    `\n    )\n\n    let stderr = ''\n    appPort = await findPort()\n    app = await launchApp(appDir, appPort, {\n      onStderr(msg) {\n        stderr += msg || ''\n      },\n    })\n    await renderViaHTTP(appPort, '/abc')\n    await waitFor(1000)\n\n    await killApp(app)\n\n    await fs.remove(pages404)\n    await fs.move(`${pages404}.bak`, pages404)\n\n    expect(stderr).toMatch(gip404Err)\n  })","file":"integration/404-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not show error with getStaticProps in pages/404 build","suites":["404 Page Support","serverless mode"],"updatePoint":{"line":244,"column":64},"line":244,"code":"  it('does not show error with getStaticProps in pages/404 build', async () => {\n    await fs.move(pages404, `${pages404}.bak`)\n    await fs.writeFile(\n      pages404,\n      `\n      const page = () => 'custom 404 page'\n      export const getStaticProps = () => ({ props: { a: 'b' } })\n      export default page\n    `\n    )\n    const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n    await fs.remove(pages404)\n    await fs.move(`${pages404}.bak`, pages404)\n\n    expect(stderr).not.toMatch(gip404Err)\n    expect(code).toBe(0)\n  })","file":"integration/404-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not show error with getStaticProps in pages/404 dev","suites":["404 Page Support","serverless mode"],"updatePoint":{"line":262,"column":62},"line":262,"code":"  it('does not show error with getStaticProps in pages/404 dev', async () => {\n    await fs.move(pages404, `${pages404}.bak`)\n    await fs.writeFile(\n      pages404,\n      `\n      const page = () => 'custom 404 page'\n      export const getStaticProps = () => ({ props: { a: 'b' } })\n      export default page\n    `\n    )\n\n    let stderr = ''\n    appPort = await findPort()\n    app = await launchApp(appDir, appPort, {\n      onStderr(msg) {\n        stderr += msg || ''\n      },\n    })\n    await renderViaHTTP(appPort, '/abc')\n    await waitFor(1000)\n\n    await killApp(app)\n\n    await fs.remove(pages404)\n    await fs.move(`${pages404}.bak`, pages404)\n\n    expect(stderr).not.toMatch(gip404Err)\n  })","file":"integration/404-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows error with getServerSideProps in pages/404 build","suites":["404 Page Support","serverless mode"],"updatePoint":{"line":291,"column":60},"line":291,"code":"  it('shows error with getServerSideProps in pages/404 build', async () => {\n    await fs.move(pages404, `${pages404}.bak`)\n    await fs.writeFile(\n      pages404,\n      `\n      const page = () => 'custom 404 page'\n      export const getServerSideProps = () => ({ props: { a: 'b' } })\n      export default page\n    `\n    )\n    const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n    await fs.remove(pages404)\n    await fs.move(`${pages404}.bak`, pages404)\n\n    expect(stderr).toMatch(gip404Err)\n    expect(code).toBe(1)\n  })","file":"integration/404-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows error with getServerSideProps in pages/404 dev","suites":["404 Page Support","serverless mode"],"updatePoint":{"line":309,"column":58},"line":309,"code":"  it('shows error with getServerSideProps in pages/404 dev', async () => {\n    await fs.move(pages404, `${pages404}.bak`)\n    await fs.writeFile(\n      pages404,\n      `\n      const page = () => 'custom 404 page'\n      export const getServerSideProps = () => ({ props: { a: 'b' } })\n      export default page\n    `\n    )\n\n    let stderr = ''\n    appPort = await findPort()\n    app = await launchApp(appDir, appPort, {\n      onStderr(msg) {\n        stderr += msg || ''\n      },\n    })\n    await renderViaHTTP(appPort, '/abc')\n    await waitFor(1000)\n\n    await killApp(app)\n\n    await fs.remove(pages404)\n    await fs.move(`${pages404}.bak`, pages404)\n\n    expect(stderr).toMatch(gip404Err)\n  })","file":"integration/404-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"should use pages/500","suites":[],"updatePoint":{"line":33,"column":26},"line":33,"code":"  it('should use pages/500', async () => {\n    const html = await renderViaHTTP(appPort, '/500')\n    expect(html).toContain('custom 500 page')\n  })","file":"integration/500-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"should set correct status code with pages/500","suites":[],"updatePoint":{"line":38,"column":51},"line":38,"code":"  it('should set correct status code with pages/500', async () => {\n    const res = await fetchViaHTTP(appPort, '/500')\n    expect(res.status).toBe(500)\n  })","file":"integration/500-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not error when visited directly","suites":[],"updatePoint":{"line":43,"column":44},"line":43,"code":"  it('should not error when visited directly', async () => {\n    const res = await fetchViaHTTP(appPort, '/500')\n    expect(res.status).toBe(500)\n    expect(await res.text()).toContain('custom 500 page')\n  })","file":"integration/500-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"should output 500.html during build","suites":[],"updatePoint":{"line":50,"column":43},"line":50,"code":"    it('should output 500.html during build', async () => {\n      const page = getPageFileFromPagesManifest(appDir, '/500')\n      expect(page.endsWith('.html')).toBe(true)\n    })","file":"integration/500-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"should add /500 to pages-manifest correctly","suites":[],"updatePoint":{"line":55,"column":51},"line":55,"code":"    it('should add /500 to pages-manifest correctly', async () => {\n      const manifest = await fs.readJSON(\n        join(appDir, '.next', mode, 'pages-manifest.json')\n      )\n      expect('/500' in manifest).toBe(true)\n    })","file":"integration/500-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not build 500 statically with getInitialProps in _app","suites":["500 Page Support","serverless mode"],"updatePoint":{"line":112,"column":64},"line":112,"code":"  it('does not build 500 statically with getInitialProps in _app', async () => {\n    await fs.writeFile(\n      pagesApp,\n      `\n      import App from 'next/app'\n\n      const page = ({ Component, pageProps }) => <Component {...pageProps} />\n      page.getInitialProps = (ctx) => App.getInitialProps(ctx)\n      export default page\n    `\n    )\n    await fs.remove(join(appDir, '.next'))\n    const {\n      stderr,\n      stdout: buildStdout,\n      code,\n    } = await nextBuild(appDir, [], {\n      stderr: true,\n      stdout: true,\n    })\n\n    await fs.remove(pagesApp)\n\n    expect(stderr).not.toMatch(gip500Err)\n    expect(buildStdout).not.toContain('rendered 500')\n    expect(code).toBe(0)\n    expect(\n      await fs.pathExists(join(appDir, '.next/server/pages/500.html'))\n    ).toBe(false)\n\n    let appStdout = ''\n    const appPort = await findPort()\n    const app = await nextStart(appDir, appPort, {\n      onStdout(msg) {\n        appStdout += msg || ''\n      },\n      onStderr(msg) {\n        appStdout += msg || ''\n      },\n    })\n\n    await renderViaHTTP(appPort, '/err')\n    await killApp(app)\n\n    expect(appStdout).toContain('rendered 500')\n  })","file":"integration/500-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"does build 500 statically with getInitialProps in _app and getStaticProps in pages/500","suites":["500 Page Support","serverless mode"],"updatePoint":{"line":159,"column":92},"line":159,"code":"  it('does build 500 statically with getInitialProps in _app and getStaticProps in pages/500', async () => {\n    await fs.writeFile(\n      pagesApp,\n      `\n      import App from 'next/app'\n\n      const page = ({ Component, pageProps }) => <Component {...pageProps} />\n      page.getInitialProps = (ctx) => App.getInitialProps(ctx)\n      export default page\n    `\n    )\n    await fs.rename(pages500, `${pages500}.bak`)\n    await fs.writeFile(\n      pages500,\n      `\n      const page = () => {\n        console.log('rendered 500')\n        return 'custom 500 page'\n      }\n      export default page\n\n      export const getStaticProps = () => {\n        return {\n          props: {}\n        }\n      }\n    `\n    )\n    await fs.remove(join(appDir, '.next'))\n    const {\n      stderr,\n      stdout: buildStdout,\n      code,\n    } = await nextBuild(appDir, [], {\n      stderr: true,\n      stdout: true,\n    })\n\n    await fs.remove(pagesApp)\n    await fs.remove(pages500)\n    await fs.rename(`${pages500}.bak`, pages500)\n\n    expect(stderr).not.toMatch(gip500Err)\n    expect(buildStdout).toContain('rendered 500')\n    expect(code).toBe(0)\n    expect(\n      await fs.pathExists(join(appDir, '.next/server/pages/500.html'))\n    ).toBe(true)\n\n    let appStdout = ''\n    const appPort = await findPort()\n    const app = await nextStart(appDir, appPort, {\n      onStdout(msg) {\n        appStdout += msg || ''\n      },\n      onStderr(msg) {\n        appStdout += msg || ''\n      },\n    })\n\n    await renderViaHTTP(appPort, '/err')\n    await killApp(app)\n\n    expect(appStdout).not.toContain('rendered 500')\n  })","file":"integration/500-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"builds 500 statically by default with no pages/500","suites":["500 Page Support","serverless mode"],"updatePoint":{"line":225,"column":56},"line":225,"code":"  it('builds 500 statically by default with no pages/500', async () => {\n    await fs.rename(pages500, `${pages500}.bak`)\n    await fs.remove(join(appDir, '.next'))\n    const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n    await fs.rename(`${pages500}.bak`, pages500)\n\n    expect(stderr).not.toMatch(gip500Err)\n    expect(code).toBe(0)\n    expect(\n      await fs.pathExists(join(appDir, '.next/server/pages/500.html'))\n    ).toBe(true)\n\n    const pagesManifest = await getPagesManifest(appDir)\n    await updatePagesManifest(\n      appDir,\n      JSON.stringify({\n        ...pagesManifest,\n        '/500': pagesManifest['/404'].replace('/404', '/500'),\n      })\n    )\n\n    // ensure static 500 hydrates correctly\n    const appPort = await findPort()\n    const app = await nextStart(appDir, appPort)\n\n    try {\n      const browser = await webdriver(appPort, '/err?hello=world')\n      const initialTitle = await browser.eval('document.title')\n\n      const currentTitle = await browser.eval('document.title')\n\n      expect(initialTitle).toBe(currentTitle)\n      expect(initialTitle).toBe('500: Internal Server Error')\n    } finally {\n      await killApp(app)\n    }\n  })","file":"integration/500-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"builds 500 statically by default with no pages/500 and custom _error without getInitialProps","suites":["500 Page Support","serverless mode"],"updatePoint":{"line":263,"column":98},"line":263,"code":"  it('builds 500 statically by default with no pages/500 and custom _error without getInitialProps', async () => {\n    await fs.rename(pages500, `${pages500}.bak`)\n    await fs.writeFile(\n      pagesError,\n      `\n        function Error({ statusCode }) {\n          return <p>Error status: {statusCode}</p>\n        }\n\n        export default Error\n      `\n    )\n    await fs.remove(join(appDir, '.next'))\n    const { stderr: buildStderr, code } = await nextBuild(appDir, [], {\n      stderr: true,\n    })\n    await fs.rename(`${pages500}.bak`, pages500)\n    await fs.remove(pagesError)\n    console.log(buildStderr)\n    expect(buildStderr).not.toMatch(gip500Err)\n    expect(code).toBe(0)\n    expect(\n      await fs.pathExists(join(appDir, '.next/server/pages/500.html'))\n    ).toBe(true)\n  })","file":"integration/500-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not build 500 statically with no pages/500 and custom getInitialProps in _error","suites":["500 Page Support","serverless mode"],"updatePoint":{"line":289,"column":90},"line":289,"code":"  it('does not build 500 statically with no pages/500 and custom getInitialProps in _error', async () => {\n    await fs.rename(pages500, `${pages500}.bak`)\n    await fs.writeFile(\n      pagesError,\n      `\n        function Error({ statusCode }) {\n          return <p>Error status: {statusCode}</p>\n        }\n\n        Error.getInitialProps = ({ req, res, err }) => {\n          console.error('called _error.getInitialProps')\n\n          if (req.url === '/500') {\n            throw new Error('should not export /500')\n          }\n\n          return {\n            statusCode: res && res.statusCode ? res.statusCode : err ? err.statusCode : 404\n          }\n        }\n\n        export default Error\n      `\n    )\n    await fs.remove(join(appDir, '.next'))\n    const { stderr: buildStderr, code } = await nextBuild(appDir, [], {\n      stderr: true,\n    })\n    await fs.rename(`${pages500}.bak`, pages500)\n    await fs.remove(pagesError)\n    console.log(buildStderr)\n    expect(buildStderr).not.toMatch(gip500Err)\n    expect(code).toBe(0)\n    expect(\n      await fs.pathExists(join(appDir, '.next/server/pages/500.html'))\n    ).toBe(false)\n\n    let appStderr = ''\n    const appPort = await findPort()\n    const app = await nextStart(appDir, appPort, {\n      onStderr(msg) {\n        appStderr += msg || ''\n      },\n    })\n\n    await renderViaHTTP(appPort, '/err')\n    await killApp(app)\n\n    expect(appStderr).toContain('called _error.getInitialProps')\n  })","file":"integration/500-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not build 500 statically with no pages/500 and getServerSideProps in _error","suites":["500 Page Support","serverless mode"],"updatePoint":{"line":340,"column":86},"line":340,"code":"  it('does not build 500 statically with no pages/500 and getServerSideProps in _error', async () => {\n    await fs.rename(pages500, `${pages500}.bak`)\n    await fs.writeFile(\n      pagesError,\n      `\n        function Error({ statusCode }) {\n          return <p>Error status: {statusCode}</p>\n        }\n\n        export const getServerSideProps = ({ req, res, err }) => {\n          console.error('called _error getServerSideProps')\n\n          if (req.url === '/500') {\n            throw new Error('should not export /500')\n          }\n\n          return {\n            props: {\n              statusCode: res && res.statusCode ? res.statusCode : err ? err.statusCode : 404\n            }\n          }\n        }\n\n        export default Error\n      `\n    )\n    await fs.remove(join(appDir, '.next'))\n    const { stderr: buildStderr, code } = await nextBuild(appDir, [], {\n      stderr: true,\n    })\n    await fs.rename(`${pages500}.bak`, pages500)\n    await fs.remove(pagesError)\n    console.log(buildStderr)\n    expect(buildStderr).not.toMatch(gip500Err)\n    expect(code).toBe(0)\n    expect(\n      await fs.pathExists(join(appDir, '.next/server/pages/500.html'))\n    ).toBe(false)\n\n    let appStderr = ''\n    const appPort = await findPort()\n    const app = await nextStart(appDir, appPort, {\n      onStderr(msg) {\n        appStderr += msg || ''\n      },\n    })\n\n    await renderViaHTTP(appPort, '/err')\n    await killApp(app)\n\n    expect(appStderr).toContain('called _error getServerSideProps')\n  })","file":"integration/500-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not build 500 statically with no pages/500 and custom getInitialProps in _error and _app","suites":["500 Page Support","serverless mode"],"updatePoint":{"line":393,"column":99},"line":393,"code":"  it('does not build 500 statically with no pages/500 and custom getInitialProps in _error and _app', async () => {\n    await fs.rename(pages500, `${pages500}.bak`)\n    await fs.writeFile(\n      pagesError,\n      `\n        function Error({ statusCode }) {\n          return <p>Error status: {statusCode}</p>\n        }\n\n        Error.getInitialProps = ({ req, res, err }) => {\n          console.error('called _error.getInitialProps')\n\n          if (req.url === '/500') {\n            throw new Error('should not export /500')\n          }\n\n          return {\n            statusCode: res && res.statusCode ? res.statusCode : err ? err.statusCode : 404\n          }\n        }\n\n        export default Error\n      `\n    )\n    await fs.writeFile(\n      pagesApp,\n      `\n        function App({ pageProps, Component }) {\n          return <Component {...pageProps} />\n        }\n\n        App.getInitialProps = async ({ Component, ctx }) => {\n          // throw _app GIP err here\n          let pageProps = {}\n\n          if (Component.getInitialProps) {\n            pageProps = await Component.getInitialProps(ctx)\n          }\n\n          return { pageProps }\n        }\n\n        export default App\n      `\n    )\n    await fs.remove(join(appDir, '.next'))\n    const { stderr: buildStderr, code } = await nextBuild(appDir, [], {\n      stderr: true,\n    })\n    await fs.rename(`${pages500}.bak`, pages500)\n    await fs.remove(pagesError)\n    await fs.remove(pagesApp)\n    console.log(buildStderr)\n    expect(buildStderr).not.toMatch(gip500Err)\n    expect(code).toBe(0)\n    expect(\n      await fs.pathExists(join(appDir, '.next/server/pages/500.html'))\n    ).toBe(false)\n  })","file":"integration/500-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows error with getInitialProps in pages/500 build","suites":["500 Page Support","serverless mode"],"updatePoint":{"line":453,"column":57},"line":453,"code":"  it('shows error with getInitialProps in pages/500 build', async () => {\n    await fs.move(pages500, `${pages500}.bak`)\n    await fs.writeFile(\n      pages500,\n      `\n      const page = () => 'custom 500 page'\n      page.getInitialProps = () => ({ a: 'b' })\n      export default page\n    `\n    )\n    await fs.remove(join(appDir, '.next'))\n    const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n    await fs.remove(pages500)\n    await fs.move(`${pages500}.bak`, pages500)\n\n    expect(stderr).toMatch(gip500Err)\n    expect(code).toBe(1)\n  })","file":"integration/500-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows error with getInitialProps in pages/500 dev","suites":["500 Page Support","serverless mode"],"updatePoint":{"line":472,"column":55},"line":472,"code":"  it('shows error with getInitialProps in pages/500 dev', async () => {\n    await fs.move(pages500, `${pages500}.bak`)\n    await fs.writeFile(\n      pages500,\n      `\n      const page = () => 'custom 500 page'\n      page.getInitialProps = () => ({ a: 'b' })\n      export default page\n    `\n    )\n\n    let stderr = ''\n    appPort = await findPort()\n    app = await launchApp(appDir, appPort, {\n      onStderr(msg) {\n        stderr += msg || ''\n      },\n    })\n    await renderViaHTTP(appPort, '/500')\n    await waitFor(1000)\n\n    await killApp(app)\n\n    await fs.remove(pages500)\n    await fs.move(`${pages500}.bak`, pages500)\n\n    expect(stderr).toMatch(gip500Err)\n  })","file":"integration/500-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not show error with getStaticProps in pages/500 build","suites":["500 Page Support","serverless mode"],"updatePoint":{"line":501,"column":64},"line":501,"code":"  it('does not show error with getStaticProps in pages/500 build', async () => {\n    await fs.move(pages500, `${pages500}.bak`)\n    await fs.writeFile(\n      pages500,\n      `\n      const page = () => 'custom 500 page'\n      export const getStaticProps = () => ({ props: { a: 'b' } })\n      export default page\n    `\n    )\n    await fs.remove(join(appDir, '.next'))\n    const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n    await fs.remove(pages500)\n    await fs.move(`${pages500}.bak`, pages500)\n\n    expect(stderr).not.toMatch(gip500Err)\n    expect(code).toBe(0)\n  })","file":"integration/500-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not show error with getStaticProps in pages/500 dev","suites":["500 Page Support","serverless mode"],"updatePoint":{"line":520,"column":62},"line":520,"code":"  it('does not show error with getStaticProps in pages/500 dev', async () => {\n    await fs.move(pages500, `${pages500}.bak`)\n    await fs.writeFile(\n      pages500,\n      `\n      const page = () => 'custom 500 page'\n      export const getStaticProps = () => ({ props: { a: 'b' } })\n      export default page\n    `\n    )\n\n    let stderr = ''\n    appPort = await findPort()\n    app = await launchApp(appDir, appPort, {\n      onStderr(msg) {\n        stderr += msg || ''\n      },\n    })\n    await renderViaHTTP(appPort, '/abc')\n    await waitFor(1000)\n\n    await killApp(app)\n\n    await fs.remove(pages500)\n    await fs.move(`${pages500}.bak`, pages500)\n\n    expect(stderr).not.toMatch(gip500Err)\n  })","file":"integration/500-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows error with getServerSideProps in pages/500 build","suites":["500 Page Support","serverless mode"],"updatePoint":{"line":549,"column":60},"line":549,"code":"  it('shows error with getServerSideProps in pages/500 build', async () => {\n    await fs.move(pages500, `${pages500}.bak`)\n    await fs.writeFile(\n      pages500,\n      `\n      const page = () => 'custom 500 page'\n      export const getServerSideProps = () => ({ props: { a: 'b' } })\n      export default page\n    `\n    )\n    await fs.remove(join(appDir, '.next'))\n    const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n    await fs.remove(pages500)\n    await fs.move(`${pages500}.bak`, pages500)\n\n    expect(stderr).toMatch(gip500Err)\n    expect(code).toBe(1)\n  })","file":"integration/500-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows error with getServerSideProps in pages/500 dev","suites":["500 Page Support","serverless mode"],"updatePoint":{"line":568,"column":58},"line":568,"code":"  it('shows error with getServerSideProps in pages/500 dev', async () => {\n    await fs.move(pages500, `${pages500}.bak`)\n    await fs.writeFile(\n      pages500,\n      `\n      const page = () => 'custom 500 page'\n      export const getServerSideProps = () => ({ props: { a: 'b' } })\n      export default page\n    `\n    )\n\n    let stderr = ''\n    appPort = await findPort()\n    app = await launchApp(appDir, appPort, {\n      onStderr(msg) {\n        stderr += msg || ''\n      },\n    })\n    await renderViaHTTP(appPort, '/500')\n    await waitFor(1000)\n\n    await killApp(app)\n\n    await fs.remove(pages500)\n    await fs.move(`${pages500}.bak`, pages500)\n\n    expect(stderr).toMatch(gip500Err)\n  })","file":"integration/500-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not fetch static data from a CDN","suites":["absolute assetPrefix with path prefix"],"updatePoint":{"line":67,"column":45},"line":67,"code":"  it('should not fetch static data from a CDN', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.waitForElementByCss('#about-link').click()\n    const prop = await browser.waitForElementByCss('#prop').text()\n    expect(prop).toBe('hello')\n    expect(cdnAccessLog).not.toContain(`/_next/data/${buildId}/about.json`)\n  })","file":"integration/absolute-assetprefix/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fetch from cache correctly","suites":["absolute assetPrefix with path prefix"],"updatePoint":{"line":75,"column":39},"line":75,"code":"  it('should fetch from cache correctly', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.eval('window.clientSideNavigated = true')\n    await browser.waitForElementByCss('#about-link').click()\n    await browser.waitForElementByCss('#prop')\n    await browser.back()\n    await browser.waitForElementByCss('#about-link').click()\n    const prop = await browser.waitForElementByCss('#prop').text()\n    expect(prop).toBe('hello')\n    expect(await browser.eval('window.clientSideNavigated')).toBe(true)\n    expect(\n      cdnAccessLog.filter(\n        (path) => path === `/_next/data/${buildId}/about.json`\n      )\n    ).toHaveLength(0)\n  })","file":"integration/absolute-assetprefix/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with getStaticPaths prerendered","suites":["absolute assetPrefix with path prefix"],"updatePoint":{"line":92,"column":49},"line":92,"code":"  it('should work with getStaticPaths prerendered', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.waitForElementByCss('#gsp-prerender-link').click()\n    const prop = await browser.waitForElementByCss('#prop').text()\n    expect(prop).toBe('prerendered')\n    expect(cdnAccessLog).not.toContain(\n      `/_next/data/${buildId}/gsp-fallback/prerendered.json`\n    )\n  })","file":"integration/absolute-assetprefix/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with getStaticPaths fallback","suites":["absolute assetPrefix with path prefix"],"updatePoint":{"line":102,"column":46},"line":102,"code":"  it('should work with getStaticPaths fallback', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.waitForElementByCss('#gsp-fallback-link').click()\n    const prop = await browser.waitForElementByCss('#prop').text()\n    expect(prop).toBe('fallback')\n    expect(cdnAccessLog).not.toContain(\n      `/_next/data/${buildId}/gsp-fallback/fallback.json`\n    )\n  })","file":"integration/absolute-assetprefix/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with getServerSideProps","suites":["absolute assetPrefix with path prefix"],"updatePoint":{"line":112,"column":41},"line":112,"code":"  it('should work with getServerSideProps', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.waitForElementByCss('#gssp-link').click()\n    const prop = await browser.waitForElementByCss('#prop').text()\n    expect(prop).toBe('foo')\n    expect(cdnAccessLog).not.toContain(\n      `/_next/data/${buildId}/gssp.json?prop=foo`\n    )\n  })","file":"integration/absolute-assetprefix/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have shown errors during build","suites":["AMP Validation on Export"],"updatePoint":{"line":25,"column":43},"line":25,"code":"  it('should have shown errors during build', async () => {\n    expect(buildOutput).toMatch(\n      /error.*The mandatory attribute 'height' is missing in tag 'amp-video'\\./\n    )\n  })","file":"integration/amp-export-validation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export AMP pages","suites":["AMP Validation on Export"],"updatePoint":{"line":31,"column":29},"line":31,"code":"  it('should export AMP pages', async () => {\n    const toCheck = ['first', 'second', 'third.amp']\n    await Promise.all(\n      toCheck.map(async (page) => {\n        const content = await readFile(join(outDir, `${page}.html`))\n        await validateAMP(content.toString())\n      })\n    )\n  })","file":"integration/amp-export-validation/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows AMP warning without throwing error","suites":["AMP Validation on Export"],"line":42,"code":"  it.skip('shows AMP warning without throwing error', async () => {","file":"integration/amp-export-validation/test/index.test.js","skipped":true,"dir":"test"},{"name":"throws error on AMP error","suites":["AMP Validation on Export"],"line":70,"code":"  it.skip('throws error on AMP error', async () => {","file":"integration/amp-export-validation/test/index.test.js","skipped":true,"dir":"test"},{"name":"shows warning and error when throwing error","suites":["AMP Validation on Export"],"line":98,"code":"  it.skip('shows warning and error when throwing error', async () => {","file":"integration/amp-export-validation/test/index.test.js","skipped":true,"dir":"test"},{"name":"should build and start for static page","suites":["AMP Custom Optimizer"],"updatePoint":{"line":17,"column":44},"line":17,"code":"  it('should build and start for static page', async () => {\n    const { code } = await nextBuild(appDir)\n    expect(code).toBe(0)\n\n    appPort = await findPort()\n    app = await nextStart(appDir, appPort)\n\n    const html = await renderViaHTTP(appPort, '/')\n    await killApp(app)\n\n    expect(html).toContain(\n      'amp-twitter width=\"500\" height=\"500\" layout=\"responsive\" data-tweetid=\"1159145442896166912\"'\n    )\n    expect(html).toContain('i-amphtml-version=\"001515617716922\"')\n    expect(html).toContain(\n      'script async src=\"https://cdn.ampproject.org/rtv/001515617716922/v0.mjs\"'\n    )\n  })","file":"integration/amphtml-custom-optimizer/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build and start for dynamic page","suites":["AMP Custom Optimizer"],"updatePoint":{"line":36,"column":45},"line":36,"code":"  it('should build and start for dynamic page', async () => {\n    const { code } = await nextBuild(appDir)\n    expect(code).toBe(0)\n\n    appPort = await findPort()\n    app = await nextStart(appDir, appPort)\n\n    const html = await renderViaHTTP(appPort, '/dynamic')\n    await killApp(app)\n\n    expect(html).toContain(\n      'amp-img width=\"500\" height=\"500\" layout=\"responsive\" src=\"https://amp.dev/static/samples/img/story_dog2_portrait.jpg\"'\n    )\n    expect(html).toContain('i-amphtml-version=\"001515617716922\"')\n    expect(html).toContain(\n      'script async src=\"https://cdn.ampproject.org/rtv/001515617716922/v0.mjs\"'\n    )\n  })","file":"integration/amphtml-custom-optimizer/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build and start successfully","suites":["AMP Custom Validator"],"updatePoint":{"line":18,"column":41},"line":18,"code":"  it('should build and start successfully', async () => {\n    const { code } = await nextBuild(appDir)\n    expect(code).toBe(0)\n\n    appPort = await findPort()\n    app = await nextStart(appDir, appPort)\n\n    const html = await renderViaHTTP(appPort, '/')\n    await killApp(app)\n\n    expect(html).toContain('Hello from AMP')\n  })","file":"integration/amphtml-custom-validator/test/index.test.js","skipped":false,"dir":"test"},{"name":"should run in dev mode successfully","suites":["AMP Custom Validator"],"updatePoint":{"line":31,"column":41},"line":31,"code":"  it('should run in dev mode successfully', async () => {\n    let stderr = ''\n\n    appPort = await findPort()\n    app = await launchApp(appDir, appPort, {\n      onStderr(msg) {\n        stderr += msg || ''\n      },\n    })\n\n    const html = await renderViaHTTP(appPort, '/')\n    await killApp(app)\n\n    expect(stderr).not.toContain('error')\n    expect(html).toContain('Hello from AMP')\n  })","file":"integration/amphtml-custom-validator/test/index.test.js","skipped":false,"dir":"test"},{"name":"adds styles from fragment in AMP mode correctly","suites":["AMP Fragment Styles"],"updatePoint":{"line":26,"column":53},"line":26,"code":"  it('adds styles from fragment in AMP mode correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/', { amp: 1 })\n    await validateAMP(html)\n    const $ = cheerio.load(html)\n    const styles = $('style[amp-custom]').text()\n    expect(styles).toMatch(/background:(.*|)hotpink/)\n    expect(styles).toMatch(/font-size:(.*|)16\\.4px/)\n  })","file":"integration/amphtml-fragment-style/test/index.test.js","skipped":false,"dir":"test"},{"name":"should load an amp first page correctly","suites":[],"updatePoint":{"line":30,"column":45},"line":30,"code":"  it('should load an amp first page correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/amp')\n\n    if (!isDev) {\n      await validateAMP(html)\n    }\n    const $ = cheerio.load(html)\n    expect($('#use-amp').text()).toContain('yes')\n  })","file":"integration/amphtml-ssg/test/index.test.js","skipped":false,"dir":"test"},{"name":"should load a hybrid amp page without query correctly","suites":[],"updatePoint":{"line":40,"column":59},"line":40,"code":"  it('should load a hybrid amp page without query correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/hybrid')\n    const $ = cheerio.load(html)\n    expect($('#use-amp').text()).toContain('no')\n    expect($('#hello').text()).toContain('hello')\n  })","file":"integration/amphtml-ssg/test/index.test.js","skipped":false,"dir":"test"},{"name":"should load dynamic hybrid SSG/AMP page","suites":[],"updatePoint":{"line":47,"column":45},"line":47,"code":"  it('should load dynamic hybrid SSG/AMP page', async () => {\n    const html = await renderViaHTTP(appPort, '/blog/post-1')\n    const $ = cheerio.load(html)\n    expect($('#use-amp').text()).toContain('no')\n    expect($('#hello').text()).toContain('hello')\n    expect($('#slug').text()).toContain('post-1')\n  })","file":"integration/amphtml-ssg/test/index.test.js","skipped":false,"dir":"test"},{"name":"should load dynamic hybrid SSG/AMP page with trailing slash","suites":[],"updatePoint":{"line":55,"column":65},"line":55,"code":"  it('should load dynamic hybrid SSG/AMP page with trailing slash', async () => {\n    const html = await renderViaHTTP(appPort, '/blog/post-1/')\n    const $ = cheerio.load(html)\n    expect($('#use-amp').text()).toContain('no')\n    expect($('#hello').text()).toContain('hello')\n    expect($('#slug').text()).toContain('post-1')\n  })","file":"integration/amphtml-ssg/test/index.test.js","skipped":false,"dir":"test"},{"name":"should load dynamic hybrid SSG/AMP page with query","suites":[],"updatePoint":{"line":63,"column":56},"line":63,"code":"  it('should load dynamic hybrid SSG/AMP page with query', async () => {\n    const html = await renderViaHTTP(appPort, '/blog/post-1?amp=1')\n    const $ = cheerio.load(html)\n    expect($('#use-amp').text()).toContain('yes')\n    expect($('#hello').text()).toContain('hello')\n    expect($('#slug').text()).toContain('post-1')\n  })","file":"integration/amphtml-ssg/test/index.test.js","skipped":false,"dir":"test"},{"name":"should load a hybrid amp page with query correctly","suites":[],"updatePoint":{"line":71,"column":56},"line":71,"code":"  it('should load a hybrid amp page with query correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/hybrid?amp=1')\n\n    if (!isDev) {\n      await validateAMP(html)\n    }\n    const $ = cheerio.load(html)\n    expect($('#use-amp').text()).toContain('yes')\n    expect($('#hello').text()).toContain('hello')\n  })","file":"integration/amphtml-ssg/test/index.test.js","skipped":false,"dir":"test"},{"name":"should output prerendered files correctly during build","suites":[],"updatePoint":{"line":85,"column":62},"line":85,"code":"    it('should output prerendered files correctly during build', async () => {\n      expect(await fsExists(builtPage('amp.js'))).toBe(true)\n      expect(await fsExists(builtPage('amp.html'))).toBe(true)\n      expect(await fsExists(builtPage('amp.json'))).toBe(true)\n\n      expect(await fsExists(builtPage('hybrid.js'))).toBe(true)\n      expect(await fsExists(builtPage('hybrid.html'))).toBe(true)\n      expect(await fsExists(builtPage('hybrid.json'))).toBe(true)\n\n      expect(await fsExists(builtPage('hybrid.amp.js'))).toBe(false)\n      expect(await fsExists(builtPage('hybrid.amp.html'))).toBe(true)\n      expect(await fsExists(builtPage('hybrid.amp.json'))).toBe(true)\n    })","file":"integration/amphtml-ssg/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have copied SSG files correctly","suites":["AMP SSG Support","export mode"],"updatePoint":{"line":151,"column":46},"line":151,"code":"    it('should have copied SSG files correctly', async () => {\n      const outFile = (file) => join(appDir, 'out', file)\n\n      expect(await fsExists(outFile('amp.html'))).toBe(true)\n      expect(await fsExists(outFile('index.html'))).toBe(true)\n      expect(await fsExists(outFile('hybrid.html'))).toBe(true)\n      expect(await fsExists(outFile('amp.amp.html'))).toBe(false)\n      expect(await fsExists(outFile('hybrid.amp.html'))).toBe(true)\n      expect(await fsExists(outFile('blog/post-1.html'))).toBe(true)\n      expect(await fsExists(outFile('blog/post-1.amp.html'))).toBe(true)\n\n      expect(\n        await fsExists(outFile(join('_next/data', buildId, 'amp.json')))\n      ).toBe(true)\n\n      expect(\n        await fsExists(outFile(join('_next/data', buildId, 'hybrid.json')))\n      ).toBe(true)\n    })","file":"integration/amphtml-ssg/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have amp optimizer in trace","suites":["AMP Usage","production mode"],"updatePoint":{"line":52,"column":42},"line":52,"code":"    it('should have amp optimizer in trace', async () => {\n      const trace = JSON.parse(\n        readFileSync(join(appDir, '.next/next-server.js.nft.json'), 'utf8')\n      )\n      expect(\n        trace.files.some((file) =>\n          file.replace(/\\\\/g, '/').includes('@ampproject/toolbox-optimizer')\n        )\n      ).toBe(true)\n    })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not contain missing files warning","suites":["AMP Usage","production mode"],"updatePoint":{"line":63,"column":48},"line":63,"code":"    it('should not contain missing files warning', async () => {\n      expect(output).toContain('Compiled successfully')\n      expect(output).not.toContain('Could not find files for')\n    })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page","suites":["AMP Usage","production mode","With basic usage"],"updatePoint":{"line":69,"column":32},"line":69,"code":"      it('should render the page', async () => {\n        const html = await renderViaHTTP(appPort, '/')\n        expect(html).toMatch(/Hello World/)\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page as valid AMP","suites":["AMP Usage","production mode","With basic AMP usage"],"updatePoint":{"line":76,"column":45},"line":76,"code":"      it('should render the page as valid AMP', async () => {\n        const html = await renderViaHTTP(appPort, '/?amp=1')\n        await validateAMP(html)\n        expect(html).toMatch(/Hello World/)\n\n        const $ = cheerio.load(html)\n        expect($('.abc')).toHaveLength(1)\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page without leaving render target","suites":["AMP Usage","production mode","With basic AMP usage"],"updatePoint":{"line":85,"column":62},"line":85,"code":"      it('should render the page without leaving render target', async () => {\n        const html = await renderViaHTTP(appPort, '/special-chars')\n        await validateAMP(html)\n        expect(html).not.toContain('__NEXT_AMP_RENDER_TARGET__')\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not output client pages for AMP only","suites":["AMP Usage","production mode","With basic AMP usage"],"updatePoint":{"line":91,"column":53},"line":91,"code":"      it('should not output client pages for AMP only', async () => {\n        const browser = await webdriver(appPort, '/nav')\n        await browser.elementByCss('#only-amp-link').click()\n\n        const result = await browser.eval('window.NAV_PAGE_LOADED')\n\n        expect(result).toBeFalsy()\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not output client pages for AMP only with config exported after declaration","suites":["AMP Usage","production mode","With basic AMP usage"],"updatePoint":{"line":100,"column":92},"line":100,"code":"      it('should not output client pages for AMP only with config exported after declaration', async () => {\n        const browser = await webdriver(appPort, '/nav')\n        await browser.elementByCss('#var-before-export-link').click()\n\n        const result = await browser.eval('window.NAV_PAGE_LOADED')\n\n        expect(result).toBeFalsy()\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should drop custom scripts","suites":["AMP Usage","production mode","With basic AMP usage"],"updatePoint":{"line":109,"column":36},"line":109,"code":"      it('should drop custom scripts', async () => {\n        const html = await renderViaHTTP(appPort, '/custom-scripts')\n        expect(html).not.toMatch(/src='\\/im-not-allowed\\.js'/)\n        expect(html).not.toMatch(/console\\.log(\"I'm not either :p\")'/)\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not drop custom amp scripts","suites":["AMP Usage","production mode","With basic AMP usage"],"updatePoint":{"line":115,"column":44},"line":115,"code":"      it('should not drop custom amp scripts', async () => {\n        const html = await renderViaHTTP(appPort, '/amp-script?amp=1')\n        await validateAMP(html)\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should optimize clean","suites":["AMP Usage","production mode","With basic AMP usage"],"updatePoint":{"line":120,"column":31},"line":120,"code":"      it('should optimize clean', async () => {\n        const html = await renderViaHTTP(appPort, '/only-amp')\n        await validateAMP(html)\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should auto import extensions","suites":["AMP Usage","production mode","With basic AMP usage"],"updatePoint":{"line":125,"column":39},"line":125,"code":"      it('should auto import extensions', async () => {\n        const html = await renderViaHTTP(appPort, '/auto-import')\n        await validateAMP(html)\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the normal page that uses the AMP hook","suites":["AMP Usage","production mode","With AMP context"],"updatePoint":{"line":132,"column":62},"line":132,"code":"      it('should render the normal page that uses the AMP hook', async () => {\n        const html = await renderViaHTTP(appPort, '/use-amp-hook')\n        expect(html).toMatch(/Hello others/)\n        expect(html).toMatch(/no AMP for you\\.\\.\\./)\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the AMP page that uses the AMP hook","suites":["AMP Usage","production mode","With AMP context"],"updatePoint":{"line":138,"column":59},"line":138,"code":"      it('should render the AMP page that uses the AMP hook', async () => {\n        const html = await renderViaHTTP(appPort, '/use-amp-hook?amp=1')\n        await validateAMP(html)\n        expect(html).toMatch(/Hello AMP/)\n        expect(html).toMatch(/AMP Power!!!/)\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render nested normal page with AMP hook","suites":["AMP Usage","production mode","With AMP context"],"updatePoint":{"line":145,"column":56},"line":145,"code":"      it('should render nested normal page with AMP hook', async () => {\n        const html = await renderViaHTTP(appPort, '/nested')\n        expect(html).toMatch(/Hello others/)\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render nested AMP page with AMP hook","suites":["AMP Usage","production mode","With AMP context"],"updatePoint":{"line":150,"column":53},"line":150,"code":"      it('should render nested AMP page with AMP hook', async () => {\n        const html = await renderViaHTTP(appPort, '/nested?amp=1')\n        await validateAMP(html)\n        expect(html).toMatch(/Hello AMP/)\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render link rel amphtml","suites":["AMP Usage","production mode","canonical amphtml"],"updatePoint":{"line":158,"column":40},"line":158,"code":"      it('should render link rel amphtml', async () => {\n        const html = await renderViaHTTP(appPort, '/use-amp-hook')\n        const $ = cheerio.load(html)\n        expect($('link[rel=amphtml]').first().attr('href')).toBe(\n          'http://localhost:1234/use-amp-hook.amp'\n        )\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render amphtml from provided rel link","suites":["AMP Usage","production mode","canonical amphtml"],"updatePoint":{"line":166,"column":54},"line":166,"code":"      it('should render amphtml from provided rel link', async () => {\n        const html = await renderViaHTTP(appPort, '/use-amp-hook.amp')\n        await validateAMP(html)\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render link rel amphtml with existing query","suites":["AMP Usage","production mode","canonical amphtml"],"updatePoint":{"line":171,"column":60},"line":171,"code":"      it('should render link rel amphtml with existing query', async () => {\n        const html = await renderViaHTTP(appPort, '/use-amp-hook?hello=1')\n        expect(html).not.toMatch(/&amp;amp=1/)\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the AMP page that uses the AMP hook","suites":["AMP Usage","production mode","canonical amphtml"],"updatePoint":{"line":176,"column":59},"line":176,"code":"      it('should render the AMP page that uses the AMP hook', async () => {\n        const html = await renderViaHTTP(appPort, '/use-amp-hook?amp=1')\n        const $ = cheerio.load(html)\n        await validateAMP(html)\n        expect($('link[rel=canonical]').first().attr('href')).toBe(\n          'http://localhost:1234/use-amp-hook'\n        )\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render a canonical regardless of amp-only status (explicit)","suites":["AMP Usage","production mode","canonical amphtml"],"updatePoint":{"line":185,"column":76},"line":185,"code":"      it('should render a canonical regardless of amp-only status (explicit)', async () => {\n        const html = await renderViaHTTP(appPort, '/only-amp')\n        const $ = cheerio.load(html)\n        await validateAMP(html)\n        expect($('link[rel=canonical]').first().attr('href')).toBe(\n          'http://localhost:1234/only-amp'\n        )\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not render amphtml link tag with no AMP page","suites":["AMP Usage","production mode","canonical amphtml"],"updatePoint":{"line":194,"column":61},"line":194,"code":"      it('should not render amphtml link tag with no AMP page', async () => {\n        const html = await renderViaHTTP(appPort, '/normal')\n        const $ = cheerio.load(html)\n        expect($('link[rel=amphtml]').first().attr('href')).not.toBeTruthy()\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should remove conflicting amp tags","suites":["AMP Usage","production mode","canonical amphtml"],"updatePoint":{"line":200,"column":44},"line":200,"code":"      it('should remove conflicting amp tags', async () => {\n        const html = await renderViaHTTP(appPort, '/conflicting-tag?amp=1')\n        const $ = cheerio.load(html)\n        await validateAMP(html)\n        expect($('meta[name=viewport]').attr('content')).not.toBe(\n          'something :p'\n        )\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should allow manually setting canonical","suites":["AMP Usage","production mode","canonical amphtml"],"updatePoint":{"line":209,"column":49},"line":209,"code":"      it('should allow manually setting canonical', async () => {\n        const html = await renderViaHTTP(appPort, '/manual-rels?amp=1')\n        const $ = cheerio.load(html)\n        await validateAMP(html)\n        expect($('link[rel=canonical]').attr('href')).toBe(\n          '/my-custom-canonical'\n        )\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should allow manually setting amphtml rel","suites":["AMP Usage","production mode","canonical amphtml"],"updatePoint":{"line":218,"column":51},"line":218,"code":"      it('should allow manually setting amphtml rel', async () => {\n        const html = await renderViaHTTP(appPort, '/manual-rels')\n        const $ = cheerio.load(html)\n        expect($('link[rel=amphtml]').attr('href')).toBe('/my-custom-amphtml')\n        expect($('link[rel=amphtml]')).toHaveLength(1)\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should combine style tags","suites":["AMP Usage","production mode","combined styles"],"updatePoint":{"line":227,"column":35},"line":227,"code":"      it('should combine style tags', async () => {\n        const html = await renderViaHTTP(appPort, '/styled?amp=1')\n        const $ = cheerio.load(html)\n        expect($('style[amp-custom]').first().text()).toMatch(\n          /div.jsx-[a-zA-Z0-9]{1,}{color:red}span.jsx-[a-zA-Z0-9]{1,}{color:blue}body{background-color:green}/\n        )\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should remove sourceMaps from styles","suites":["AMP Usage","production mode","combined styles"],"updatePoint":{"line":235,"column":46},"line":235,"code":"      it('should remove sourceMaps from styles', async () => {\n        const html = await renderViaHTTP(appPort, '/styled?amp=1')\n        const $ = cheerio.load(html)\n        const styles = $('style[amp-custom]').first().text()\n\n        expect(styles).not.toMatch(/\\/\\*@ sourceURL=.*?\\*\\//)\n        expect(styles).not.toMatch(/\\/\\*# sourceMappingURL=.*\\*\\//)\n      })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not warn on valid amp","suites":["AMP Usage","AMP dev no-warn"],"updatePoint":{"line":250,"column":36},"line":250,"code":"    it('should not warn on valid amp', async () => {\n      let inspectPayload = ''\n      dynamicAppPort = await findPort()\n      ampDynamic = await launchApp(join(__dirname, '../'), dynamicAppPort, {\n        onStdout(msg) {\n          inspectPayload += msg\n        },\n        onStderr(msg) {\n          inspectPayload += msg\n        },\n      })\n\n      await renderViaHTTP(dynamicAppPort, '/only-amp')\n\n      await killApp(ampDynamic)\n\n      expect(inspectPayload).not.toContain('warn')\n    })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate from non-AMP to AMP without error","suites":["AMP Usage","AMP dev mode"],"updatePoint":{"line":289,"column":57},"line":289,"code":"    it('should navigate from non-AMP to AMP without error', async () => {\n      const browser = await webdriver(dynamicAppPort, '/normal')\n      await browser.elementByCss('#to-amp').click()\n      await browser.waitForElementByCss('#only-amp')\n      expect(await browser.elementByCss('#only-amp').text()).toMatch(/Only AMP/)\n    })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should add data-ampdevmode to development script tags","suites":["AMP Usage","AMP dev mode"],"updatePoint":{"line":296,"column":61},"line":296,"code":"    it('should add data-ampdevmode to development script tags', async () => {\n      const html = await renderViaHTTP(dynamicAppPort, '/only-amp')\n      const $ = cheerio.load(html)\n      expect($('html').attr('data-ampdevmode')).toBe('')\n      expect(\n        [].slice\n          .apply($('script[data-ampdevmode]'))\n          .map((el) => el.attribs.src || el.attribs.id)\n          .map((e) =>\n            e.startsWith('/') ? new URL(e, 'http://x.x').pathname : e\n          )\n      ).toEqual([\n        '__NEXT_DATA__',\n        '/_next/static/chunks/react-refresh.js',\n        '/_next/static/chunks/polyfills.js',\n        '/_next/static/chunks/webpack.js',\n        '/_next/static/chunks/amp.js',\n      ])\n    })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should detect the changes and display it","suites":["AMP Usage","AMP dev mode"],"updatePoint":{"line":316,"column":48},"line":316,"code":"    it('should detect the changes and display it', async () => {\n      let browser\n      try {\n        browser = await webdriver(dynamicAppPort, '/hmr/test')\n        const text = await browser.elementByCss('p').text()\n        expect(text).toBe('This is the hot AMP page.')\n\n        const hmrTestPagePath = join(\n          __dirname,\n          '../',\n          'pages',\n          'hmr',\n          'test.js'\n        )\n\n        const originalContent = readFileSync(hmrTestPagePath, 'utf8')\n        const editedContent = originalContent.replace(\n          'This is the hot AMP page',\n          'This is a cold AMP page'\n        )\n\n        // change the content\n        writeFileSync(hmrTestPagePath, editedContent, 'utf8')\n\n        await check(\n          () => getBrowserBodyText(browser),\n          /This is a cold AMP page/\n        )\n\n        // add the original content\n        writeFileSync(hmrTestPagePath, originalContent, 'utf8')\n\n        await check(\n          () => getBrowserBodyText(browser),\n          /This is the hot AMP page/\n        )\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should detect changes and refresh an AMP page","suites":["AMP Usage","AMP dev mode"],"updatePoint":{"line":357,"column":53},"line":357,"code":"    it('should detect changes and refresh an AMP page', async () => {\n      let browser\n      try {\n        browser = await webdriver(dynamicAppPort, '/hmr/amp')\n        const text = await browser.elementByCss('p').text()\n        expect(text).toBe(`I'm an AMP page!`)\n\n        const hmrTestPagePath = join(__dirname, '../', 'pages', 'hmr', 'amp.js')\n\n        const originalContent = readFileSync(hmrTestPagePath, 'utf8')\n        const editedContent = originalContent.replace(\n          `I'm an AMP page!`,\n          'replaced it!'\n        )\n\n        // change the content\n        writeFileSync(hmrTestPagePath, editedContent, 'utf8')\n\n        await check(() => getBrowserBodyText(browser), /replaced it!/)\n\n        // add the original content\n        writeFileSync(hmrTestPagePath, originalContent, 'utf8')\n\n        await check(() => getBrowserBodyText(browser), /I'm an AMP page!/)\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should detect changes to component and refresh an AMP page","suites":["AMP Usage","AMP dev mode"],"updatePoint":{"line":386,"column":66},"line":386,"code":"    it('should detect changes to component and refresh an AMP page', async () => {\n      const browser = await webdriver(dynamicAppPort, '/hmr/comp')\n      await check(() => browser.elementByCss('#hello-comp').text(), /hello/)\n\n      const testComp = join(__dirname, '../components/hello.js')\n\n      const origContent = readFileSync(testComp, 'utf8')\n      const newContent = origContent.replace('>hello<', '>hi<')\n\n      writeFileSync(testComp, newContent, 'utf8')\n      await check(() => browser.elementByCss('#hello-comp').text(), /hi/)\n\n      writeFileSync(testComp, origContent, 'utf8')\n      await check(() => browser.elementByCss('#hello-comp').text(), /hello/)\n    })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not reload unless the page is edited for an AMP page","suites":["AMP Usage","AMP dev mode"],"updatePoint":{"line":402,"column":67},"line":402,"code":"    it('should not reload unless the page is edited for an AMP page', async () => {\n      let browser\n      const hmrTestPagePath = join(__dirname, '../', 'pages', 'hmr', 'test.js')\n      const originalContent = readFileSync(hmrTestPagePath, 'utf8')\n      try {\n        await renderViaHTTP(dynamicAppPort, '/hmr/test')\n\n        browser = await webdriver(dynamicAppPort, '/hmr/amp')\n        await check(() => browser.elementByCss('p').text(), /I'm an AMP page!/)\n\n        const origDate = await browser.elementByCss('span').text()\n\n        const editedContent = originalContent.replace(\n          `This is the hot AMP page.`,\n          'replaced it!'\n        )\n\n        // change the content\n        writeFileSync(hmrTestPagePath, editedContent, 'utf8')\n\n        let checks = 5\n        let i = 0\n        while (i < checks) {\n          const curText = await browser.elementByCss('span').text()\n          expect(curText).toBe(origDate)\n          await waitFor(1000)\n          i++\n        }\n\n        // add the original content\n        writeFileSync(hmrTestPagePath, originalContent, 'utf8')\n\n        const otherHmrTestPage = join(__dirname, '../pages/hmr/amp.js')\n\n        const otherOrigContent = readFileSync(otherHmrTestPage, 'utf8')\n        const otherEditedContent = otherOrigContent.replace(\n          `I'm an AMP page!`,\n          `replaced it!`\n        )\n\n        // change the content\n        writeFileSync(otherHmrTestPage, otherEditedContent, 'utf8')\n\n        await check(() => getBrowserBodyText(browser), /replaced it!/)\n\n        // restore original content\n        writeFileSync(otherHmrTestPage, otherOrigContent, 'utf8')\n\n        await check(() => getBrowserBodyText(browser), /I'm an AMP page!/)\n      } finally {\n        writeFileSync(hmrTestPagePath, originalContent, 'utf8')\n        await browser.close()\n      }\n    })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should detect changes and refresh a hybrid AMP page","suites":["AMP Usage","AMP dev mode"],"updatePoint":{"line":457,"column":59},"line":457,"code":"    it('should detect changes and refresh a hybrid AMP page', async () => {\n      let browser\n      try {\n        browser = await webdriver(dynamicAppPort, '/hmr/hybrid?amp=1')\n        const text = await browser.elementByCss('p').text()\n        expect(text).toBe(`I'm a hybrid AMP page!`)\n\n        const hmrTestPagePath = join(\n          __dirname,\n          '../',\n          'pages',\n          'hmr',\n          'hybrid.js'\n        )\n\n        const originalContent = readFileSync(hmrTestPagePath, 'utf8')\n        const editedContent = originalContent.replace(\n          `I'm a hybrid AMP page!`,\n          'replaced it!'\n        )\n\n        // change the content\n        writeFileSync(hmrTestPagePath, editedContent, 'utf8')\n\n        await check(() => getBrowserBodyText(browser), /replaced it!/)\n\n        // add the original content\n        writeFileSync(hmrTestPagePath, originalContent, 'utf8')\n\n        await check(() => getBrowserBodyText(browser), /I'm a hybrid AMP page!/)\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should detect changes and refresh an AMP page at root pages/","suites":["AMP Usage","AMP dev mode"],"updatePoint":{"line":492,"column":68},"line":492,"code":"    it('should detect changes and refresh an AMP page at root pages/', async () => {\n      let browser\n      try {\n        browser = await webdriver(dynamicAppPort, '/root-hmr')\n        const text = await browser.elementByCss('p').text()\n        expect(text).toBe(`I'm an AMP page!`)\n\n        const hmrTestPagePath = join(__dirname, '../', 'pages', 'root-hmr.js')\n\n        const originalContent = readFileSync(hmrTestPagePath, 'utf8')\n        const editedContent = originalContent.replace(\n          `I'm an AMP page!`,\n          'replaced it!'\n        )\n\n        // change the content\n        writeFileSync(hmrTestPagePath, editedContent, 'utf8')\n\n        await check(() => getBrowserBodyText(browser), /replaced it!/)\n\n        // add the original content\n        writeFileSync(hmrTestPagePath, originalContent, 'utf8')\n\n        await check(() => getBrowserBodyText(browser), /I'm an AMP page!/)\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should detect amp validator warning on invalid amp","suites":["AMP Usage","AMP dev mode"],"updatePoint":{"line":521,"column":58},"line":521,"code":"    it('should detect amp validator warning on invalid amp', async () => {\n      let inspectPayload = ''\n      dynamicAppPort = await findPort()\n      ampDynamic = await launchApp(join(__dirname, '../'), dynamicAppPort, {\n        onStdout(msg) {\n          inspectPayload += msg\n        },\n        onStderr(msg) {\n          inspectPayload += msg\n        },\n      })\n\n      await renderViaHTTP(dynamicAppPort, '/invalid-amp')\n\n      await killApp(ampDynamic)\n\n      expect(inspectPayload).toContain('error')\n    })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not contain missing files warning","suites":["AMP Usage","AMP dev mode"],"updatePoint":{"line":540,"column":48},"line":540,"code":"    it('should not contain missing files warning', async () => {\n      expect(output).toContain('compiled client and server successfully')\n      expect(output).toContain('compiling /only-amp')\n      expect(output).not.toContain('Could not find files for')\n    })","file":"integration/amphtml/test/index.test.js","skipped":false,"dir":"test"},{"name":"should parse JSON body","suites":[],"updatePoint":{"line":22,"column":28},"line":22,"code":"  it('should parse JSON body', async () => {\n    appPort = await findPort()\n    app = await launchApp(appDir, appPort, {})\n    const data = await makeRequest()\n    expect(data).toEqual([{ title: 'Nextjs' }])\n    killApp(app)\n  })","file":"integration/api-body-parser/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not throw if request body is already parsed in custom middleware","suites":[],"updatePoint":{"line":30,"column":77},"line":30,"code":"  it('should not throw if request body is already parsed in custom middleware', async () => {\n    await startServer()\n    const data = await makeRequest()\n    expect(data).toEqual([{ title: 'Nextjs' }])\n    killApp(server)\n  })","file":"integration/api-body-parser/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not throw if request's content-type is invalid","suites":[],"updatePoint":{"line":37,"column":59},"line":37,"code":"  it(\"should not throw if request's content-type is invalid\", async () => {\n    await startServer()\n    const status = await makeRequestWithInvalidContentType()\n    expect(status).toBe(200)\n    killApp(server)\n  })","file":"integration/api-body-parser/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return data when catch-all","suites":[],"updatePoint":{"line":19,"column":39},"line":19,"code":"  it('should return data when catch-all', async () => {\n    const data = await fetchViaHTTP(appPort, '/api/users/1', null, {}).then(\n      (res) => res.ok && res.json()\n    )\n\n    expect(data).toEqual({ slug: ['1'] })\n  })","file":"integration/api-catch-all/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return redirect when catch-all with index and trailing slash","suites":[],"updatePoint":{"line":27,"column":73},"line":27,"code":"  it('should return redirect when catch-all with index and trailing slash', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/users/', null, {\n      redirect: 'manual',\n    })\n    expect(res.status).toBe(308)\n    const text = await res.text()\n    console.log('### ', text)\n    expect(text).toEqual('/api/users')\n  })","file":"integration/api-catch-all/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return data when catch-all with index and trailing slash","suites":[],"updatePoint":{"line":37,"column":69},"line":37,"code":"  it('should return data when catch-all with index and trailing slash', async () => {\n    const data = await fetchViaHTTP(appPort, '/api/users/', null, {}).then(\n      (res) => res.ok && res.json()\n    )\n\n    expect(data).toEqual({})\n  })","file":"integration/api-catch-all/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return data when catch-all with index and no trailing slash","suites":[],"updatePoint":{"line":45,"column":72},"line":45,"code":"  it('should return data when catch-all with index and no trailing slash', async () => {\n    const data = await fetchViaHTTP(appPort, '/api/users', null, {}).then(\n      (res) => res.ok && res.json()\n    )\n\n    expect(data).toEqual({})\n  })","file":"integration/api-catch-all/test/index.test.js","skipped":false,"dir":"test"},{"name":"should respond from /api/auth/[...nextauth] correctly","suites":[],"updatePoint":{"line":29,"column":59},"line":29,"code":"  it('should respond from /api/auth/[...nextauth] correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/auth/signin', undefined, {\n      redirect: 'manual',\n    })\n    expect(res.status).toBe(200)\n    expect(await res.json()).toEqual({ from: 'auth' })\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle 204 status correctly","suites":[],"updatePoint":{"line":37,"column":40},"line":37,"code":"  it('should handle 204 status correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/status-204', undefined, {\n      redirect: 'manual',\n    })\n    expect(res.status).toBe(204)\n    expect(res.headers.get('content-type')).toBe(null)\n    expect(res.headers.get('content-length')).toBe(null)\n    expect(res.headers.get('transfer-encoding')).toBe(null)\n\n    const stderrIdx = stderr.length\n    const res2 = await fetchViaHTTP(\n      appPort,\n      '/api/status-204',\n      { invalid: '1' },\n      {\n        redirect: 'manual',\n      }\n    )\n    expect(res2.status).toBe(204)\n    expect(res2.headers.get('content-type')).toBe(null)\n    expect(res2.headers.get('content-length')).toBe(null)\n    expect(res2.headers.get('transfer-encoding')).toBe(null)\n\n    if (dev) {\n      expect(stderr.slice(stderrIdx)).toContain(\n        'A body was attempted to be set with a 204 statusCode'\n      )\n    }\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render page","suites":[],"updatePoint":{"line":67,"column":24},"line":67,"code":"  it('should render page', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toMatch(/API - support/)\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return 404 for undefined path","suites":[],"updatePoint":{"line":72,"column":42},"line":72,"code":"  it('should return 404 for undefined path', async () => {\n    const { status } = await fetchViaHTTP(\n      appPort,\n      '/api/not/unexisting/page/really',\n      null,\n      {}\n    )\n    expect(status).toEqual(404)\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not conflict with /api routes","suites":[],"updatePoint":{"line":82,"column":42},"line":82,"code":"  it('should not conflict with /api routes', async () => {\n    const res = await fetchViaHTTP(appPort, '/api-conflict')\n    expect(res.status).not.toEqual(404)\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should set cors headers when adding cors middleware","suites":[],"updatePoint":{"line":87,"column":57},"line":87,"code":"  it('should set cors headers when adding cors middleware', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/cors', null, {\n      method: 'OPTIONS',\n      headers: {\n        origin: 'example.com',\n      },\n    })\n\n    expect(res.status).toEqual(204)\n    expect(res.headers.get('access-control-allow-methods')).toEqual(\n      'GET,POST,OPTIONS'\n    )\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with index api","suites":[],"updatePoint":{"line":101,"column":32},"line":101,"code":"  it('should work with index api', async () => {\n    const text = await fetchViaHTTP(appPort, '/api', null, {}).then(\n      (res) => res.ok && res.text()\n    )\n    expect(text).toEqual('Index should work')\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return custom error","suites":[],"updatePoint":{"line":108,"column":32},"line":108,"code":"  it('should return custom error', async () => {\n    const data = await fetchViaHTTP(appPort, '/api/error', null, {})\n    const json = await data.json()\n\n    expect(data.status).toEqual(500)\n    expect(json).toEqual({ error: 'Server error!' })\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should throw Internal Server Error","suites":[],"updatePoint":{"line":116,"column":40},"line":116,"code":"  it('should throw Internal Server Error', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/user-error', null, {})\n    const text = await res.text()\n    expect(res.status).toBe(500)\n\n    if (dev) {\n      expect(text).toContain('User error')\n    } else {\n      expect(text).toBe('Internal Server Error')\n    }\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should throw Internal Server Error (async)","suites":[],"updatePoint":{"line":128,"column":48},"line":128,"code":"  it('should throw Internal Server Error (async)', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/user-error-async', null, {})\n    const text = await res.text()\n    expect(res.status).toBe(500)\n\n    if (dev) {\n      expect(text).toContain('User error')\n    } else {\n      expect(text).toBe('Internal Server Error')\n    }\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should parse JSON body","suites":[],"updatePoint":{"line":140,"column":28},"line":140,"code":"  it('should parse JSON body', async () => {\n    const data = await fetchViaHTTP(appPort, '/api/parse', null, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json; charset=utf-8',\n      },\n      body: JSON.stringify([{ title: 'Nextjs' }]),\n    }).then((res) => res.ok && res.json())\n\n    expect(data).toEqual([{ title: 'Nextjs' }])\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should special-case empty JSON body","suites":[],"updatePoint":{"line":152,"column":41},"line":152,"code":"  it('should special-case empty JSON body', async () => {\n    const data = await fetchViaHTTP(appPort, '/api/parse', null, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json; charset=utf-8',\n      },\n    }).then((res) => res.ok && res.json())\n\n    expect(data).toEqual({})\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should support boolean for JSON in api page","suites":[],"updatePoint":{"line":163,"column":49},"line":163,"code":"  it('should support boolean for JSON in api page', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/bool', null, {})\n    const body = res.ok ? await res.json() : null\n    expect(res.status).toBe(200)\n    expect(res.headers.get('content-type')).toBe(\n      'application/json; charset=utf-8'\n    )\n    expect(body).toBe(true)\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should support undefined response body","suites":[],"updatePoint":{"line":173,"column":44},"line":173,"code":"  it('should support undefined response body', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/json-undefined', null, {})\n    const body = res.ok ? await res.text() : null\n    expect(body).toBe('')\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should support string in JSON response body","suites":[],"updatePoint":{"line":179,"column":49},"line":179,"code":"  it('should support string in JSON response body', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/json-string', null, {})\n    const body = res.ok ? await res.text() : null\n    expect(body).toBe('\"Hello world!\"')\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should support null in JSON response body","suites":[],"updatePoint":{"line":185,"column":47},"line":185,"code":"  it('should support null in JSON response body', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/json-null')\n    const body = res.ok ? await res.json() : 'Not null'\n    expect(res.status).toBe(200)\n    expect(res.headers.get('content-type')).toBe(\n      'application/json; charset=utf-8'\n    )\n    expect(body).toBe(null)\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return error with invalid JSON","suites":[],"updatePoint":{"line":195,"column":43},"line":195,"code":"  it('should return error with invalid JSON', async () => {\n    const data = await fetchViaHTTP(appPort, '/api/parse', null, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json; charset=utf-8',\n      },\n      body: `{\"message\":Invalid\"}`,\n    })\n    expect(data.status).toEqual(400)\n    expect(data.statusText).toEqual('Invalid JSON')\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return error exceeded body limit","suites":[],"updatePoint":{"line":207,"column":45},"line":207,"code":"  it('should return error exceeded body limit', async () => {\n    let res\n    let error\n\n    try {\n      res = await fetchViaHTTP(appPort, '/api/parse', null, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json; charset=utf-8',\n        },\n        body: JSON.stringify(json),\n      })\n    } catch (err) {\n      error = err\n    }\n\n    if (error) {\n      // This is a temporary workaround for testing since node doesn't handle\n      // closed connections when POSTing data to an endpoint correctly\n      // https://github.com/nodejs/node/issues/12339\n      // TODO: investigate re-enabling this after above issue has been\n      // addressed in node or `node-fetch`\n      expect(error.code).toBe('EPIPE')\n    } else {\n      expect(res.status).toEqual(413)\n      expect(res.statusText).toEqual('Body exceeded 1mb limit')\n    }\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should parse bigger body then 1mb","suites":[],"updatePoint":{"line":236,"column":39},"line":236,"code":"  it('should parse bigger body then 1mb', async () => {\n    const data = await fetchViaHTTP(appPort, '/api/big-parse', null, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json; charset=utf-8',\n      },\n      body: JSON.stringify(json),\n    })\n\n    expect(data.status).toEqual(200)\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should support etag spec","suites":[],"updatePoint":{"line":248,"column":30},"line":248,"code":"  it('should support etag spec', async () => {\n    const response = await fetchViaHTTP(appPort, '/api/blog')\n    const etag = response.headers.get('etag')\n\n    const unmodifiedResponse = await fetchViaHTTP(appPort, '/api/blog', null, {\n      headers: { 'If-None-Match': etag },\n    })\n\n    expect(unmodifiedResponse.status).toBe(304)\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should parse urlencoded body","suites":[],"updatePoint":{"line":259,"column":34},"line":259,"code":"  it('should parse urlencoded body', async () => {\n    const body = {\n      title: 'Nextjs',\n      description: 'The React Framework for Production',\n    }\n\n    const formBody = Object.keys(body)\n      .map((key) => {\n        return `${encodeURIComponent(key)}=${encodeURIComponent(body[key])}`\n      })\n      .join('&')\n\n    const data = await fetchViaHTTP(appPort, '/api/parse', null, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-Form-urlencoded',\n      },\n      body: formBody,\n    }).then((res) => res.ok && res.json())\n\n    expect(data).toEqual({\n      title: 'Nextjs',\n      description: 'The React Framework for Production',\n    })\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should parse body in handler","suites":[],"updatePoint":{"line":285,"column":34},"line":285,"code":"  it('should parse body in handler', async () => {\n    const data = await fetchViaHTTP(appPort, '/api/no-parsing', null, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json; charset=utf-8',\n      },\n      body: JSON.stringify([{ title: 'Nextjs' }]),\n    }).then((res) => res.ok && res.json())\n\n    expect(data).toEqual([{ title: 'Nextjs' }])\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should parse body with config","suites":[],"updatePoint":{"line":297,"column":35},"line":297,"code":"  it('should parse body with config', async () => {\n    const data = await fetchViaHTTP(appPort, '/api/parsing', null, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json; charset=utf-8',\n      },\n      body: JSON.stringify([{ title: 'Nextjs' }]),\n    }).then((res) => res.ok && res.json())\n\n    expect(data).toEqual({ message: 'Parsed body' })\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show friendly error for invalid redirect","suites":[],"updatePoint":{"line":309,"column":53},"line":309,"code":"  it('should show friendly error for invalid redirect', async () => {\n    await fetchViaHTTP(appPort, '/api/redirect-error', null, {})\n    expect(stderr).toContain(\n      `Invalid redirect arguments. Please use a single argument URL, e.g. res.redirect('/destination') or use a status code and URL, e.g. res.redirect(307, '/destination').`\n    )\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show friendly error in case of passing null as first argument redirect","suites":[],"updatePoint":{"line":316,"column":83},"line":316,"code":"  it('should show friendly error in case of passing null as first argument redirect', async () => {\n    await fetchViaHTTP(appPort, '/api/redirect-null', null, {})\n    expect(stderr).toContain(\n      `Invalid redirect arguments. Please use a single argument URL, e.g. res.redirect('/destination') or use a status code and URL, e.g. res.redirect(307, '/destination').`\n    )\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should redirect with status code 307","suites":[],"updatePoint":{"line":323,"column":42},"line":323,"code":"  it('should redirect with status code 307', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/redirect-307', null, {\n      redirect: 'manual',\n    })\n\n    expect(res.status).toEqual(307)\n    const text = await res.text()\n    expect(text).toEqual('/login')\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should redirect to login","suites":[],"updatePoint":{"line":333,"column":30},"line":333,"code":"  it('should redirect to login', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/redirect-307', null, {})\n\n    expect(res.redirected).toBe(true)\n    expect(res.url).toContain('/login')\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should redirect with status code 301","suites":[],"updatePoint":{"line":340,"column":42},"line":340,"code":"  it('should redirect with status code 301', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/redirect-301', null, {\n      redirect: 'manual',\n    })\n\n    expect(res.status).toEqual(301)\n    const text = await res.text()\n    expect(text).toEqual('/login')\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return empty query object","suites":[],"updatePoint":{"line":350,"column":38},"line":350,"code":"  it('should return empty query object', async () => {\n    const data = await fetchViaHTTP(appPort, '/api/query', null, {}).then(\n      (res) => res.ok && res.json()\n    )\n    expect(data).toEqual({})\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should parse query correctly","suites":[],"updatePoint":{"line":357,"column":34},"line":357,"code":"  it('should parse query correctly', async () => {\n    const data = await fetchViaHTTP(\n      appPort,\n      '/api/query?a=1&b=2&a=3',\n      null,\n      {}\n    ).then((res) => res.ok && res.json())\n    expect(data).toEqual({ a: ['1', '3'], b: '2' })\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return empty cookies object","suites":[],"updatePoint":{"line":367,"column":40},"line":367,"code":"  it('should return empty cookies object', async () => {\n    const data = await fetchViaHTTP(appPort, '/api/cookies', null, {}).then(\n      (res) => res.ok && res.json()\n    )\n    expect(data).toEqual({})\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return cookies object","suites":[],"updatePoint":{"line":374,"column":34},"line":374,"code":"  it('should return cookies object', async () => {\n    const data = await fetchViaHTTP(appPort, '/api/cookies', null, {\n      headers: {\n        Cookie: 'nextjs=cool;',\n      },\n    }).then((res) => res.ok && res.json())\n    expect(data).toEqual({ nextjs: 'cool' })\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return 200 on POST on pages","suites":[],"updatePoint":{"line":383,"column":40},"line":383,"code":"  it('should return 200 on POST on pages', async () => {\n    const res = await fetchViaHTTP(appPort, '/user', null, {\n      method: 'POST',\n    })\n\n    expect(res.status).toEqual(200)\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return JSON on post on API","suites":[],"updatePoint":{"line":391,"column":39},"line":391,"code":"  it('should return JSON on post on API', async () => {\n    const data = await fetchViaHTTP(appPort, '/api/blog?title=Nextjs', null, {\n      method: 'POST',\n    }).then((res) => res.ok && res.json())\n\n    expect(data).toEqual([{ title: 'Nextjs' }])\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return data on dynamic route","suites":[],"updatePoint":{"line":399,"column":41},"line":399,"code":"  it('should return data on dynamic route', async () => {\n    const data = await fetchViaHTTP(appPort, '/api/post-1', null, {}).then(\n      (res) => res.ok && res.json()\n    )\n\n    expect(data).toEqual({ post: 'post-1' })\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with dynamic params and search string","suites":[],"updatePoint":{"line":407,"column":55},"line":407,"code":"  it('should work with dynamic params and search string', async () => {\n    const data = await fetchViaHTTP(\n      appPort,\n      '/api/post-1?val=1',\n      null,\n      {}\n    ).then((res) => res.ok && res.json())\n\n    expect(data).toEqual({ val: '1', post: 'post-1' })\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with dynamic params and search string like lambda","suites":[],"updatePoint":{"line":418,"column":67},"line":418,"code":"  it('should work with dynamic params and search string like lambda', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/post-1?val=1')\n    const json = await res.json()\n\n    expect(json).toEqual({ val: '1', post: 'post-1' })\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prioritize a non-dynamic page","suites":[],"updatePoint":{"line":425,"column":42},"line":425,"code":"  it('should prioritize a non-dynamic page', async () => {\n    const data = await fetchViaHTTP(\n      appPort,\n      '/api/post-1/comments',\n      null,\n      {}\n    ).then((res) => res.ok && res.json())\n\n    expect(data).toEqual([{ message: 'Prioritize a non-dynamic api page' }])\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return data on dynamic nested route","suites":[],"updatePoint":{"line":436,"column":48},"line":436,"code":"  it('should return data on dynamic nested route', async () => {\n    const data = await fetchViaHTTP(\n      appPort,\n      '/api/post-1/comment-1',\n      null,\n      {}\n    ).then((res) => res.ok && res.json())\n\n    expect(data).toEqual({ post: 'post-1', comment: 'comment-1' })\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should 404 on optional dynamic api page","suites":[],"updatePoint":{"line":447,"column":45},"line":447,"code":"  it('should 404 on optional dynamic api page', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/blog/543/comment', null, {})\n\n    expect(res.status).toBe(404)\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return data on dynamic optional nested route","suites":[],"updatePoint":{"line":453,"column":57},"line":453,"code":"  it('should return data on dynamic optional nested route', async () => {\n    const data = await fetchViaHTTP(\n      appPort,\n      '/api/blog/post-1/comment/1',\n      null,\n      {}\n    ).then((res) => res.ok && res.json())\n\n    expect(data).toEqual({ post: 'post-1', id: '1' })\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with child_process correctly","suites":[],"updatePoint":{"line":464,"column":46},"line":464,"code":"  it('should work with child_process correctly', async () => {\n    const data = await renderViaHTTP(appPort, '/api/child-process')\n    expect(data).toBe('hi')\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with nullable payload","suites":[],"updatePoint":{"line":469,"column":39},"line":469,"code":"  it('should work with nullable payload', async () => {\n    const data = await renderViaHTTP(appPort, '/api/nullable-payload')\n    expect(data).toBe('')\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should warn if response body is larger than 4MB","suites":[],"updatePoint":{"line":474,"column":53},"line":474,"code":"  it('should warn if response body is larger than 4MB', async () => {\n    let res = await fetchViaHTTP(appPort, '/api/large-response')\n    expect(res.ok).toBeTruthy()\n    expect(stderr).toContain(\n      'API response for /api/large-response exceeds 4MB. API Routes are meant to respond quickly.'\n    )\n\n    res = await fetchViaHTTP(appPort, '/api/large-chunked-response')\n    expect(res.ok).toBeTruthy()\n    expect(stderr).toContain(\n      'API response for /api/large-chunked-response exceeds 4MB. API Routes are meant to respond quickly.'\n    )\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not warn if response body is larger than 4MB with responseLimit config = false","suites":[],"updatePoint":{"line":488,"column":91},"line":488,"code":"  it('should not warn if response body is larger than 4MB with responseLimit config = false', async () => {\n    let res = await fetchViaHTTP(appPort, '/api/large-response-with-config')\n    expect(res.ok).toBeTruthy()\n    expect(stderr).not.toContain(\n      'API response for /api/large-response-with-config exceeds 4MB. API Routes are meant to respond quickly.'\n    )\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should warn with configured size if response body is larger than configured size","suites":[],"updatePoint":{"line":496,"column":86},"line":496,"code":"  it('should warn with configured size if response body is larger than configured size', async () => {\n    let res = await fetchViaHTTP(\n      appPort,\n      '/api/large-response-with-config-size'\n    )\n    expect(res.ok).toBeTruthy()\n    expect(stderr).toContain(\n      'API response for /api/large-response-with-config-size exceeds 5MB. API Routes are meant to respond quickly.'\n    )\n  })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should compile only server code in development","suites":[],"updatePoint":{"line":508,"column":54},"line":508,"code":"    it('should compile only server code in development', async () => {\n      await fetchViaHTTP(appPort, '/api/users')\n\n      expect(() => getPageFileFromBuildManifest(appDir, '/api/users')).toThrow(\n        /No files for page/\n      )\n\n      expect(getPageFileFromPagesManifest(appDir, '/api/users')).toBeTruthy()\n    })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show warning when the API resolves without ending the request in dev mode","suites":[],"updatePoint":{"line":518,"column":88},"line":518,"code":"    it('should show warning when the API resolves without ending the request in dev mode', async () => {\n      const controller = new AbortController()\n      setTimeout(() => {\n        controller.abort()\n      }, 2000)\n      await fetchViaHTTP(appPort, '/api/test-no-end', undefined, {\n        signal: controller.signal,\n      }).catch(() => {})\n\n      await check(\n        () => stderr,\n        /API resolved without sending a response for \\/api\\/test-no-end, this may result in stalled requests/\n      )\n    })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show warning when the API resolves and the response is piped","suites":[],"updatePoint":{"line":533,"column":79},"line":533,"code":"    it('should not show warning when the API resolves and the response is piped', async () => {\n      const startIdx = stderr.length > 0 ? stderr.length - 1 : stderr.length\n      await fetchViaHTTP(appPort, `/api/test-res-pipe`, { port: appPort })\n      expect(stderr.slice(startIdx)).not.toContain(\n        `API resolved without sending a response for /api/test-res-pipe`\n      )\n    })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show false positive warning if not using externalResolver flag","suites":[],"updatePoint":{"line":541,"column":77},"line":541,"code":"    it('should show false positive warning if not using externalResolver flag', async () => {\n      const apiURL = '/api/external-resolver-false-positive'\n      const req = await fetchViaHTTP(appPort, apiURL)\n      expect(stderr).toContain(\n        `API resolved without sending a response for ${apiURL}, this may result in stalled requests.`\n      )\n      expect(await req.text()).toBe('hello world')\n    })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show warning if using externalResolver flag","suites":[],"updatePoint":{"line":550,"column":62},"line":550,"code":"    it('should not show warning if using externalResolver flag', async () => {\n      const startIdx = stderr.length > 0 ? stderr.length - 1 : stderr.length\n      const apiURL = '/api/external-resolver'\n      const req = await fetchViaHTTP(appPort, apiURL)\n      expect(stderr.slice(startIdx)).not.toContain(\n        `API resolved without sending a response for ${apiURL}`\n      )\n      expect(await req.text()).toBe('hello world')\n    })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show warning with next export","suites":[],"updatePoint":{"line":560,"column":44},"line":560,"code":"    it('should show warning with next export', async () => {\n      const { stderr } = await nextExport(\n        appDir,\n        { outdir: join(appDir, 'out') },\n        { stderr: true }\n      )\n      expect(stderr).toContain(\n        'https://nextjs.org/docs/messages/api-routes-static-export'\n      )\n    })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build api routes","suites":[],"updatePoint":{"line":571,"column":31},"line":571,"code":"    it('should build api routes', async () => {\n      const pagesManifest = JSON.parse(\n        await fs.readFile(\n          join(appDir, `.next/${mode}/pages-manifest.json`),\n          'utf8'\n        )\n      )\n      expect(Object.keys(pagesManifest).includes('/api/[post]')).toBeTruthy()\n\n      const res = await fetchViaHTTP(appPort, '/api/nextjs')\n      const json = await res.json()\n\n      expect(json).toEqual({ post: 'nextjs' })\n\n      const buildManifest = JSON.parse(\n        await fs.readFile(join(appDir, '.next/build-manifest.json'), 'utf8')\n      )\n      expect(\n        Object.keys(buildManifest.pages).includes('/api-conflict')\n      ).toBeTruthy()\n    })","file":"integration/api-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have any changes in asPath after a bundle rebuild","suites":["App asPath"],"updatePoint":{"line":27,"column":66},"line":27,"code":"  it('should not have any changes in asPath after a bundle rebuild', async () => {\n    const browser = await webdriver(appPort, '/')\n    const appPath = join(__dirname, '../', 'pages', '_app.js')\n    const originalContent = readFileSync(appPath, 'utf8')\n\n    const text = await browser.elementByCss('body').text()\n    expect(text).toBe(\n      '{ \"url\": { \"query\": {}, \"pathname\": \"/\", \"asPath\": \"/\" } }'\n    )\n\n    const editedContent = originalContent.replace(\n      'find this',\n      'replace with this'\n    )\n\n    // Change the content to trigger a bundle rebuild\n    await writeFileSync(appPath, editedContent, 'utf8')\n\n    // Wait for the bundle rebuild\n    await waitFor(5000)\n\n    const newContent = await browser.elementByCss('body').text()\n    expect(newContent).toBe(\n      '{ \"url\": { \"query\": {}, \"pathname\": \"/\", \"asPath\": \"/\" } }'\n    )\n\n    // Change back to the original content\n    writeFileSync(appPath, originalContent, 'utf8')\n    await browser.close()\n  })","file":"integration/app-aspath/test/index.test.js","skipped":false,"dir":"test"},{"name":"should HMR when _app is added","suites":["_app/_document add HMR"],"updatePoint":{"line":22,"column":35},"line":22,"code":"  it('should HMR when _app is added', async () => {\n    const browser = await webdriver(appPort, '/')\n    try {\n      const html = await browser.eval('document.documentElement.innerHTML')\n      expect(html).not.toContain('custom _app')\n      expect(html).toContain('index page')\n\n      await fs.writeFile(\n        appPage,\n        `\n        export default function MyApp({ Component, pageProps }) {\n          return (\n            <>\n              <p>custom _app</p>\n              <Component {...pageProps} />\n            </>\n          )\n        }\n      `\n      )\n\n      await check(async () => {\n        const html = await browser.eval('document.documentElement.innerHTML')\n        return html.includes('custom _app') && html.includes('index page')\n          ? 'success'\n          : html\n      }, 'success')\n    } finally {\n      await fs.remove(appPage)\n      await check(async () => {\n        const html = await browser.eval('document.documentElement.innerHTML')\n        return !html.includes('custom _app') && html.includes('index page')\n          ? 'restored'\n          : html\n      }, 'restored')\n    }\n  })","file":"integration/app-document-add-hmr/test/index.test.js","skipped":false,"dir":"test"},{"name":"should HMR when _document is added","suites":["_app/_document add HMR"],"updatePoint":{"line":60,"column":40},"line":60,"code":"  it('should HMR when _document is added', async () => {\n    const browser = await webdriver(appPort, '/')\n    try {\n      const html = await browser.eval('document.documentElement.innerHTML')\n      expect(html).not.toContain('custom _document')\n      expect(html).toContain('index page')\n\n      await fs.writeFile(\n        documentPage,\n        `\n        import Document, { Html, Head, Main, NextScript } from 'next/document'\n\n        class MyDocument extends Document {\n          static async getInitialProps(ctx) {\n            const initialProps = await Document.getInitialProps(ctx)\n            return { ...initialProps }\n          }\n\n          render() {\n            return (\n              <Html>\n                <Head />\n                <body>\n                  <p>custom _document</p>\n                  <Main />\n                  <NextScript />\n                </body>\n              </Html>\n            )\n          }\n        }\n\n        export default MyDocument\n\n      `\n      )\n\n      await check(async () => {\n        const html = await browser.eval('document.documentElement.innerHTML')\n        return html.includes('custom _document') && html.includes('index page')\n          ? 'success'\n          : html\n      }, 'success')\n    } finally {\n      await fs.remove(documentPage)\n      await check(async () => {\n        const html = await browser.eval('document.documentElement.innerHTML')\n        return !html.includes('custom _document') && html.includes('index page')\n          ? 'restored'\n          : html\n      }, 'restored')\n    }\n  })","file":"integration/app-document-add-hmr/test/index.test.js","skipped":false,"dir":"test"},{"name":"root components should be imported in this order _document > _app > page in order to respect side effects","suites":["Root components import order"],"updatePoint":{"line":50,"column":110},"line":49,"code":"  it(\n    'root components should be imported in this order _document > _app > page in order to respect side effects',\n    respectsSideEffects\n  )","file":"integration/app-document-import-order/test/index.test.js","skipped":false,"dir":"test"},{"name":"_app chunks should be attached to de dom before page chunks","suites":["Root components import order"],"updatePoint":{"line":76,"column":64},"line":75,"code":"  it(\n    '_app chunks should be attached to de dom before page chunks',\n    respectsChunkAttachmentOrder\n  )","file":"integration/app-document-import-order/test/index.test.js","skipped":false,"dir":"test"},{"name":"root components should be imported in this order _document > _app > page in order to respect side effects","suites":["Root components import order","on dev server"],"updatePoint":{"line":89,"column":112},"line":88,"code":"    it(\n      'root components should be imported in this order _document > _app > page in order to respect side effects',\n      respectsSideEffects\n    )","file":"integration/app-document-import-order/test/index.test.js","skipped":false,"dir":"test"},{"name":"_app chunks should be attached to de dom before page chunks","suites":["Root components import order","on dev server"],"updatePoint":{"line":94,"column":66},"line":93,"code":"    it(\n      '_app chunks should be attached to de dom before page chunks',\n      respectsChunkAttachmentOrder\n    )","file":"integration/app-document-import-order/test/index.test.js","skipped":false,"dir":"test"},{"name":"should HMR when _app is removed","suites":["_app removal HMR"],"updatePoint":{"line":23,"column":37},"line":23,"code":"  it('should HMR when _app is removed', async () => {\n    let indexContent = await fs.readFile(indexPage)\n    try {\n      const browser = await webdriver(appPort, '/')\n\n      const html = await browser.eval('document.documentElement.innerHTML')\n      expect(html).toContain('custom _app')\n\n      await fs.rename(appPage, appPage + '.bak')\n\n      await check(async () => {\n        const html = await browser.eval('document.documentElement.innerHTML')\n        return html.includes('index page') && !html.includes('custom _app')\n          ? 'success'\n          : html\n      }, 'success')\n\n      await fs.writeFile(\n        indexPage,\n        `\n        export default function Page() {\n          return <p>index page updated</p>\n        }\n      `\n      )\n\n      await check(async () => {\n        const html = await browser.eval('document.documentElement.innerHTML')\n        return html.includes('index page updated') &&\n          !html.includes('custom _app')\n          ? 'success'\n          : html\n      }, 'success')\n\n      await fs.rename(appPage + '.bak', appPage)\n\n      await check(async () => {\n        const html = await browser.eval('document.documentElement.innerHTML')\n        return html.includes('index page updated') &&\n          html.includes('custom _app')\n          ? 'success'\n          : html\n      }, 'success')\n    } finally {\n      await fs.writeFile(indexPage, indexContent)\n\n      if (await fs.pathExists(appPage + '.bak')) {\n        await fs.rename(appPage + '.bak', appPage)\n      }\n    }\n  })","file":"integration/app-document-remove-hmr/test/index.test.js","skipped":false,"dir":"test"},{"name":"should HMR when _document is removed","suites":["_app removal HMR"],"updatePoint":{"line":75,"column":42},"line":75,"code":"  it('should HMR when _document is removed', async () => {\n    let indexContent = await fs.readFile(indexPage)\n    try {\n      const browser = await webdriver(appPort, '/')\n\n      const html = await browser.eval('document.documentElement.innerHTML')\n      expect(html).toContain('custom _document')\n\n      await fs.rename(documentPage, documentPage + '.bak')\n\n      await check(async () => {\n        const html = await browser.eval('document.documentElement.innerHTML')\n        return html.includes('index page') && !html.includes('custom _document')\n          ? 'success'\n          : html\n      }, 'success')\n\n      await fs.writeFile(\n        indexPage,\n        `\n        export default function Page() {\n          return <p>index page updated</p>\n        }\n      `\n      )\n\n      await check(async () => {\n        const html = await browser.eval('document.documentElement.innerHTML')\n        return html.includes('index page updated') &&\n          !html.includes('custom _document')\n          ? 'success'\n          : html\n      }, 'success')\n\n      await fs.rename(documentPage + '.bak', documentPage)\n\n      await check(async () => {\n        const html = await browser.eval('document.documentElement.innerHTML')\n        return html.includes('index page updated') &&\n          html.includes('custom _document')\n          ? 'success'\n          : html\n      }, 'success')\n    } finally {\n      await fs.writeFile(indexPage, indexContent)\n\n      if (await fs.pathExists(documentPage + '.bak')) {\n        await fs.rename(documentPage + '.bak', documentPage)\n      }\n    }\n  })","file":"integration/app-document-remove-hmr/test/index.test.js","skipped":false,"dir":"test"},{"name":"correctly adds styles from fragment styles key","suites":["Custom Document Fragment Styles"],"updatePoint":{"line":32,"column":52},"line":32,"code":"  it('correctly adds styles from fragment styles key', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(html)\n\n    const styles = $('style').text()\n    expect(styles).toMatch(/background:(.*|)hotpink/)\n    expect(styles).toMatch(/font-size:(.*|)16\\.4px/)\n  })","file":"integration/app-document-style-fragment/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have any missing key warnings","suites":["Document and App"],"updatePoint":{"line":38,"column":46},"line":38,"code":"  it('should not have any missing key warnings', async () => {\n    await renderViaHTTP(context.appPort, '/')\n    expect(context.output).not.toMatch(\n      /Each child in a list should have a unique \"key\" prop/\n    )\n  })","file":"integration/app-document/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have any missing key warnings","suites":["Document and App"],"updatePoint":{"line":27,"column":46},"line":27,"code":"  it('should not have any missing key warnings', async () => {\n    const html = await renderViaHTTP(context.appPort, '/')\n    expect(html).toMatch(/<div>Hello World!!!<\\/div>/)\n  })","file":"integration/app-functional/test/index.test.js","skipped":false,"dir":"test"},{"name":"should provide router context in AppTree on SSR","suites":[],"updatePoint":{"line":22,"column":53},"line":22,"code":"  it('should provide router context in AppTree on SSR', async () => {\n    let html = await renderViaHTTP(appPort, '/')\n    expect(html).toMatch(/page:.*?\\//)\n\n    html = await renderViaHTTP(appPort, '/another')\n    expect(html).toMatch(/page:.*?\\/another/)\n  })","file":"integration/app-tree/test/index.test.js","skipped":false,"dir":"test"},{"name":"should provide router context in AppTree on CSR","suites":[],"updatePoint":{"line":30,"column":53},"line":30,"code":"  it('should provide router context in AppTree on CSR', async () => {\n    const browser = await webdriver(appPort, '/')\n    let html = await browser.eval(`document.documentElement.innerHTML`)\n    expect(html).toMatch(/page:.*?\\//)\n\n    browser.elementByCss('#another').click()\n    await waitFor(500)\n    html = await browser.eval(`document.documentElement.innerHTML`)\n    expect(html).toMatch(/page:.*?\\//)\n\n    browser.elementByCss('#home').click()\n    await waitFor(500)\n    html = await browser.eval(`document.documentElement.innerHTML`)\n    expect(html).toMatch(/page:.*?\\/another/)\n  })","file":"integration/app-tree/test/index.test.js","skipped":false,"dir":"test"},{"name":"should pass AppTree to NextPageContext","suites":[],"updatePoint":{"line":46,"column":44},"line":46,"code":"  it('should pass AppTree to NextPageContext', async () => {\n    const html = await renderViaHTTP(appPort, '/hello')\n    expect(html).toMatch(/saved:.*?Hello world/)\n  })","file":"integration/app-tree/test/index.test.js","skipped":false,"dir":"test"},{"name":"ssr async page modules","suites":[],"updatePoint":{"line":25,"column":28},"line":25,"code":"  it('ssr async page modules', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(html)\n    expect($('#app-value').text()).toBe('hello')\n    expect($('#page-value').text()).toBe('42')\n  })","file":"integration/async-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"csr async page modules","suites":[],"updatePoint":{"line":32,"column":28},"line":32,"code":"  it('csr async page modules', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      expect(await browser.elementByCss('#app-value').text()).toBe('hello')\n      expect(await browser.elementByCss('#page-value').text()).toBe('42')\n      expect(await browser.elementByCss('#doc-value').text()).toBe('doc value')\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/async-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"works on async api routes","suites":[],"updatePoint":{"line":44,"column":31},"line":44,"code":"  it('works on async api routes', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/hello')\n    expect(res.status).toBe(200)\n    const result = await res.json()\n    expect(result).toHaveProperty('value', 42)\n  })","file":"integration/async-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"works with getServerSideProps","suites":[],"updatePoint":{"line":51,"column":35},"line":51,"code":"  it('works with getServerSideProps', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/gssp')\n      expect(await browser.elementByCss('#gssp-value').text()).toBe('42')\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/async-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"works with getStaticProps","suites":[],"updatePoint":{"line":61,"column":31},"line":61,"code":"  it('works with getStaticProps', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/gsp')\n      expect(await browser.elementByCss('#gsp-value').text()).toBe('42')\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/async-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"can render async 404 pages","suites":[],"updatePoint":{"line":71,"column":32},"line":71,"code":"  it('can render async 404 pages', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/dhiuhefoiahjeoij')\n      expect(await browser.elementByCss('#content-404').text()).toBe(\"hi y'all\")\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/async-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"can render async AMP pages","suites":[],"line":82,"code":"  it.skip('can render async AMP pages', async () => {","file":"integration/async-modules/test/index.test.js","skipped":true,"dir":"test"},{"name":"should not opt-out of auto static optimization from invalid _error","suites":[],"updatePoint":{"line":11,"column":72},"line":11,"code":"  it('should not opt-out of auto static optimization from invalid _error', async () => {\n    const output = await nextBuild(appDir, undefined, {\n      stdout: true,\n      stderr: true,\n    })\n\n    if (output.code) {\n      console.log(output)\n    }\n\n    const combinedOutput = output.stderr + output.stdout\n\n    expect(output.code).toBe(0)\n    expect(combinedOutput).not.toContain(\n      'You have opted-out of Automatic Static Optimization due to'\n    )\n    expect(combinedOutput).toContain(\n      'The following reserved Next.js pages were detected not directly under the pages directory'\n    )\n    expect(combinedOutput).toContain('/app/_error')\n  })","file":"integration/auto-export-error-bail/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show warning for query provided for auto exported page correctly","suites":[],"updatePoint":{"line":14,"column":77},"line":14,"code":"  it('should show warning for query provided for auto exported page correctly', async () => {\n    expect(exitCode).toBe(1)\n    expect(stderr).toContain(\n      'Error: you provided query values for / which is an auto-exported page. These can not be applied since the page can no longer be re-rendered on the server. To disable auto-export for this page add `getInitialProps`'\n    )\n\n    expect(stderr).not.toContain('Error: you provided query values for /amp')\n    expect(stderr).not.toContain('Error: you provided query values for /ssr')\n    expect(stderr).not.toContain('Error: you provided query values for /ssg')\n  })","file":"integration/auto-export-query-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"fails to emit the page","suites":["Auto Export Error Serverless"],"updatePoint":{"line":10,"column":28},"line":10,"code":"  it('fails to emit the page', async () => {\n    const { stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n    })\n\n    expect(\n      fs.existsSync(path.join(appDir, '.next/serverless/pages/index.html'))\n    ).toBe(false)\n    expect(stderr).toContain('ReferenceError')\n    expect(stderr).toContain('Build error occurred')\n  })","file":"integration/auto-export-serverless-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"Refreshes query on mount","suites":["Auto Export Serverless"],"updatePoint":{"line":12,"column":30},"line":12,"code":"  it('Refreshes query on mount', async () => {\n    await nextBuild(appDir)\n    appPort = await findPort()\n    app = await nextStart(appDir, appPort)\n\n    const browser = await webdriver(appPort, '/post-1')\n    const html = await browser.eval('document.body.innerHTML')\n    expect(html).toMatch(/post.*post-1/)\n    expect(html).toMatch(/nextExport/)\n\n    await killApp(app)\n    await browser.close()\n  })","file":"integration/auto-export-serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"Supports commonjs 1","suites":[],"updatePoint":{"line":19,"column":25},"line":19,"code":"  it('Supports commonjs 1', async () => {\n    const browser = await webdriver(appPort, '/commonjs1')\n    const html = await browser.eval('document.body.innerHTML')\n    expect(html).toMatch(/test1/)\n    expect(html).toMatch(/nextExport/)\n    await browser.close()\n  })","file":"integration/auto-export/test/index.test.js","skipped":false,"dir":"test"},{"name":"Supports commonjs 2","suites":[],"updatePoint":{"line":27,"column":25},"line":27,"code":"  it('Supports commonjs 2', async () => {\n    const browser = await webdriver(appPort, '/commonjs2')\n    const html = await browser.eval('document.body.innerHTML')\n    expect(html).toMatch(/test2/)\n    expect(html).toMatch(/nextExport/)\n    await browser.close()\n  })","file":"integration/auto-export/test/index.test.js","skipped":false,"dir":"test"},{"name":"Refreshes query on mount","suites":[],"updatePoint":{"line":35,"column":30},"line":35,"code":"  it('Refreshes query on mount', async () => {\n    const browser = await webdriver(appPort, '/post-1')\n    await check(() => browser.eval('document.body.innerHTML'), /post.*post-1/)\n    const html = await browser.eval('document.body.innerHTML')\n    expect(html).toMatch(/nextExport/)\n  })","file":"integration/auto-export/test/index.test.js","skipped":false,"dir":"test"},{"name":"should update asPath after mount","suites":[],"updatePoint":{"line":42,"column":38},"line":42,"code":"  it('should update asPath after mount', async () => {\n    const browser = await webdriver(appPort, '/zeit/cmnt-2')\n    await check(\n      () => browser.eval(`document.documentElement.innerHTML`),\n      /\\/zeit\\/cmnt-2/\n    )\n  })","file":"integration/auto-export/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not replace URL with page name while asPath is delayed","suites":[],"updatePoint":{"line":50,"column":67},"line":50,"code":"  it('should not replace URL with page name while asPath is delayed', async () => {\n    const browser = await webdriver(appPort, '/zeit/cmnt-1')\n    const val = await browser.eval(`!!window.pathnames.find(function(p) {\n      return p !== '/zeit/cmnt-1'\n    })`)\n    expect(val).toBe(false)\n  })","file":"integration/auto-export/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show hydration warning from mismatching asPath","suites":["Auto Export","dev"],"updatePoint":{"line":84,"column":65},"line":84,"code":"    it('should not show hydration warning from mismatching asPath', async () => {\n      const browser = await webdriver(appPort, '/zeit/cmnt-1')\n      const caughtWarns = await browser.eval(`window.caughtWarns`)\n      expect(caughtWarns).toEqual([])\n    })","file":"integration/auto-export/test/index.test.js","skipped":false,"dir":"test"},{"name":"should include error link when hydration error does occur","suites":["Auto Export","dev"],"updatePoint":{"line":90,"column":65},"line":90,"code":"    it('should include error link when hydration error does occur', async () => {\n      const browser = await webdriver(appPort, '/post-1/hydrate-error')\n      const logs = await browser.log()\n      expect(\n        logs.some((log) =>\n          log.message.includes(\n            'See more info here: https://nextjs.org/docs/messages/react-hydration-error'\n          )\n        )\n      ).toBe(true)\n    })","file":"integration/auto-export/test/index.test.js","skipped":false,"dir":"test"},{"name":"should allow setting babelrc env","suites":["Babel"],"updatePoint":{"line":7,"column":38},"line":7,"code":"  it('should allow setting babelrc env', async () => {\n    await nextBuild(join(__dirname, '../fixtures/babel-env'))\n  })","file":"integration/babel-custom/test/index.test.js","skipped":false,"dir":"test"},{"name":"should allow setting targets.browsers","suites":["Babel"],"updatePoint":{"line":11,"column":43},"line":11,"code":"  it('should allow setting targets.browsers', async () => {\n    await nextBuild(join(__dirname, '../fixtures/targets-browsers'))\n  })","file":"integration/babel-custom/test/index.test.js","skipped":false,"dir":"test"},{"name":"should allow setting targets to a string","suites":["Babel"],"updatePoint":{"line":15,"column":46},"line":15,"code":"  it('should allow setting targets to a string', async () => {\n    await nextBuild(join(__dirname, '../fixtures/targets-string'))\n  })","file":"integration/babel-custom/test/index.test.js","skipped":false,"dir":"test"},{"name":"should allow babelrc JSON5 syntax","suites":["Babel"],"updatePoint":{"line":19,"column":39},"line":19,"code":"  it('should allow babelrc JSON5 syntax', async () => {\n    await nextBuild(join(__dirname, '../fixtures/babel-json5'))\n  })","file":"integration/babel-custom/test/index.test.js","skipped":false,"dir":"test"},{"name":"should use correct data URL for root catch-all","suites":[],"updatePoint":{"line":21,"column":52},"line":21,"code":"  it('should use correct data URL for root catch-all', async () => {\n    const browser = await webdriver(appPort, '/docs/hello')\n    await browser.elementByCss('#root-catchall-link').click()\n    await browser.waitForElementByCss('#url')\n\n    const dataUrl = await browser.elementByCss('#url').text()\n    const { pathname } = url.parse(dataUrl)\n    expect(pathname).toBe(`/_next/data/${buildId}/root/catch-all.json`)\n  })","file":"integration/basepath-root-catch-all/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return 200","suites":[],"updatePoint":{"line":20,"column":23},"line":20,"code":"  it('should return 200', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/bigint', null, {\n      method: 'GET',\n    })\n    expect(res.status).toEqual(200)\n  })","file":"integration/bigint/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return the BigInt result text","suites":[],"updatePoint":{"line":27,"column":42},"line":27,"code":"  it('should return the BigInt result text', async () => {\n    const resText = await fetchViaHTTP(appPort, '/api/bigint', null, {\n      method: 'GET',\n    }).then((res) => res.ok && res.text())\n    expect(resText).toEqual('3')\n  })","file":"integration/bigint/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render error correctly","suites":["Handles a broken webpack plugin (precompile)"],"updatePoint":{"line":34,"column":35},"line":34,"code":"  it('should render error correctly', async () => {\n    const text = await renderViaHTTP(appPort, '/')\n    expect(text).toContain('Internal Server Error')\n\n    expect(stderr).toMatch('Error: oops')\n  })","file":"integration/broken-webpack-plugin/test/index.test.js","skipped":false,"dir":"test"},{"name":"should validate buildActivityPosition config","suites":["Build Activity Indicator"],"updatePoint":{"line":27,"column":50},"line":27,"code":"  it('should validate buildActivityPosition config', async () => {\n    let stderr = ''\n    const configPath = join(appDir, 'next.config.js')\n    await fs.writeFile(\n      configPath,\n      `\n      module.exports = {\n        devIndicators: {\n          buildActivityPosition: 'ttop-leff'\n        }\n      }\n    `\n    )\n    const app = await launchApp(appDir, await findPort(), {\n      onStderr(msg) {\n        stderr += msg\n      },\n    }).catch((err) => {\n      console.error('got err', err)\n    })\n    await fs.remove(configPath)\n\n    expect(stderr).toContain(\n      `Invalid \"devIndicator.buildActivityPosition\" provided, expected one of top-left, top-right, bottom-left, bottom-right, received ttop-leff`\n    )\n\n    if (app) {\n      await killApp(app)\n    }\n  })","file":"integration/build-indicator/test/index.test.js","skipped":false,"dir":"test"},{"name":"Adds the build indicator container","suites":["Build Activity Indicator","Enabled"],"updatePoint":{"line":66,"column":42},"line":66,"code":"    it('Adds the build indicator container', async () => {\n      const browser = await webdriver(appPort, '/')\n      const html = await browser.eval('document.body.innerHTML')\n      expect(html).toMatch(/__next-build-watcher/)\n      await browser.close()\n    })","file":"integration/build-indicator/test/index.test.js","skipped":false,"dir":"test"},{"name":"Shows the build indicator when a page is built during navigation","suites":["Build Activity Indicator","Enabled"],"updatePoint":{"line":73,"column":72},"line":73,"code":"    it('Shows the build indicator when a page is built during navigation', async () => {\n      const browser = await webdriver(appPort, '/')\n      await installCheckVisible(browser)\n      await browser.elementByCss('#to-a').click()\n      await waitFor(500)\n      const wasVisible = await browser.eval('window.showedBuilder')\n      expect(wasVisible).toBe(true)\n      await browser.close()\n    })","file":"integration/build-indicator/test/index.test.js","skipped":false,"dir":"test"},{"name":"Shows build indicator when page is built from modifying","suites":["Build Activity Indicator","Enabled"],"updatePoint":{"line":83,"column":63},"line":83,"code":"    it('Shows build indicator when page is built from modifying', async () => {\n      const browser = await webdriver(appPort, '/b')\n      await installCheckVisible(browser)\n      const pagePath = join(appDir, 'pages/b.js')\n      const origContent = await fs.readFile(pagePath, 'utf8')\n      const newContent = origContent.replace('b', 'c')\n\n      await fs.writeFile(pagePath, newContent, 'utf8')\n      await waitFor(500)\n      const wasVisible = await browser.eval('window.showedBuilder')\n\n      expect(wasVisible).toBe(true)\n      await fs.writeFile(pagePath, origContent, 'utf8')\n      await browser.close()\n    })","file":"integration/build-indicator/test/index.test.js","skipped":false,"dir":"test"},{"name":"Does not add the build indicator container","suites":["Build Activity Indicator","Disabled with next.config.js"],"updatePoint":{"line":115,"column":50},"line":115,"code":"    it('Does not add the build indicator container', async () => {\n      const browser = await webdriver(appPort, '/')\n      const html = await browser.eval('document.body.innerHTML')\n      expect(html).not.toMatch(/__next-build-watcher/)\n      await browser.close()\n    })","file":"integration/build-indicator/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not include internal pages","suites":["Build Output","Basic Application Output (experimental: )"],"updatePoint":{"line":42,"column":43},"line":42,"code":"      it('should not include internal pages', async () => {\n        ;({ stdout } = await nextBuild(appDir, [], {\n          stdout: true,\n        }))\n\n        expect(stdout).toMatch(/\\/ (.* )?\\d{1,} B/)\n        expect(stdout).toMatch(/\\+ First Load JS shared by all [ 0-9.]* kB/)\n        expect(stdout).toMatch(/ chunks\\/main-[0-9a-z]{16}\\.js [ 0-9.]* kB/)\n        expect(stdout).toMatch(\n          / chunks\\/framework-[0-9a-z]{16}\\.js [ 0-9. ]* kB/\n        )\n\n        expect(stdout).not.toContain(' /_document')\n        expect(stdout).not.toContain(' /_app')\n        expect(stdout).not.toContain(' /_error')\n        expect(stdout).not.toContain('<buildId>')\n\n        expect(stdout).toContain('○ /')\n      })","file":"integration/build-output/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not deviate from snapshot","suites":["Build Output","Basic Application Output (experimental: )"],"updatePoint":{"line":62,"column":42},"line":62,"code":"      it('should not deviate from snapshot', async () => {\n        console.log(stdout)\n\n        if (process.env.NEXT_PRIVATE_SKIP_SIZE_TESTS) {\n          return\n        }\n\n        const parsePageSize = (page) =>\n          stdout.match(\n            new RegExp(` ${page} .*?((?:\\\\d|\\\\.){1,} (?:\\\\w{1,})) `)\n          )[1]\n\n        const parsePageFirstLoad = (page) =>\n          stdout.match(\n            new RegExp(\n              ` ${page} .*?(?:(?:\\\\d|\\\\.){1,}) .*? ((?:\\\\d|\\\\.){1,} (?:\\\\w{1,}))`\n            )\n          )[1]\n\n        const parseSharedSize = (sharedPartName) => {\n          const matches = stdout.match(\n            new RegExp(`${sharedPartName} .*? ((?:\\\\d|\\\\.){1,} (?:\\\\w{1,}))`)\n          )\n\n          if (!matches) {\n            throw new Error(`Could not match ${sharedPartName}`)\n          }\n\n          return matches[1]\n        }\n\n        const indexSize = parsePageSize('/')\n        const indexFirstLoad = parsePageFirstLoad('/')\n\n        const err404Size = parsePageSize('/404')\n        const err404FirstLoad = parsePageFirstLoad('/404')\n\n        const sharedByAll = parseSharedSize('shared by all')\n        const _appSize = parseSharedSize('_app-.*?\\\\.js')\n        const webpackSize = parseSharedSize('webpack-.*?\\\\.js')\n        const mainSize = parseSharedSize('main-.*?\\\\.js')\n        const frameworkSize = parseSharedSize('framework-.*?\\\\.js')\n\n        for (const size of [\n          indexSize,\n          indexFirstLoad,\n          err404Size,\n          err404FirstLoad,\n          sharedByAll,\n          _appSize,\n          webpackSize,\n          mainSize,\n          frameworkSize,\n        ]) {\n          expect(parseFloat(size)).toBeGreaterThan(0)\n        }\n\n        // const gz = experimental.gzipSize !== false\n\n        // expect(parseFloat(indexSize) / 1000).toBeCloseTo(\n        //   gz ? 0.251 : 0.394,\n        //   2\n        // )\n        expect(indexSize.endsWith('B')).toBe(true)\n\n        // expect(parseFloat(indexFirstLoad)).toBeCloseTo(gz ? 64 : 196, 1)\n        expect(indexFirstLoad.endsWith('kB')).toBe(true)\n\n        // expect(parseFloat(err404Size)).toBeCloseTo(gz ? 3.17 : 8.51, 1)\n        expect(err404Size.endsWith('B')).toBe(true)\n\n        // expect(parseFloat(err404FirstLoad)).toBeCloseTo(gz ? 66.9 : 204, 1)\n        expect(err404FirstLoad.endsWith('kB')).toBe(true)\n\n        // expect(parseFloat(sharedByAll)).toBeCloseTo(gz ? 63.7 : 196, 1)\n        expect(sharedByAll.endsWith('kB')).toBe(true)\n\n        // const appSizeValue = _appSize.endsWith('kB')\n        //   ? parseFloat(_appSize)\n        //   : parseFloat(_appSize) / 1000\n        // expect(appSizeValue).toBeCloseTo(gz ? 0.799 : 1.63, 1)\n        expect(_appSize.endsWith('kB') || _appSize.endsWith(' B')).toBe(true)\n\n        // const webpackSizeValue = webpackSize.endsWith('kB')\n        //   ? parseFloat(webpackSize)\n        //   : parseFloat(webpackSize) / 1000\n        // expect(webpackSizeValue).toBeCloseTo(gz ? 0.766 : 1.46, 2)\n        expect(webpackSize.endsWith('kB') || webpackSize.endsWith(' B')).toBe(\n          true\n        )\n\n        // expect(parseFloat(mainSize)).toBeCloseTo(gz ? 20.1 : 62.7, 1)\n        expect(mainSize.endsWith('kB')).toBe(true)\n\n        // expect(parseFloat(frameworkSize)).toBeCloseTo(gz ? 42.0 : 130, 1)\n        expect(frameworkSize.endsWith('kB')).toBe(true)\n      })","file":"integration/build-output/test/index.test.js","skipped":false,"dir":"test"},{"name":"should print duration when rendering or get static props takes long","suites":["Build Output","Basic Application Output (experimental: )"],"updatePoint":{"line":160,"column":77},"line":160,"code":"      it('should print duration when rendering or get static props takes long', () => {\n        const matches = stdout.match(\n          / \\/slow-static\\/.+\\/.+(?: \\(\\d+ ms\\))?| \\[\\+\\d+ more paths\\]/g\n        )\n\n        for (const check of [\n          // summary\n          expect.stringMatching(\n            /\\/\\[propsDuration\\]\\/\\[renderDuration\\] \\(\\d+ ms\\)/\n          ),\n          // ordered by duration, includes duration\n          expect.stringMatching(/\\/2000\\/10 \\(\\d+ ms\\)$/),\n          expect.stringMatching(/\\/10\\/1000 \\(\\d+ ms\\)$/),\n          expect.stringMatching(/\\/300\\/10 \\(\\d+ ms\\)$/),\n          // kept in original order\n          expect.stringMatching(/\\/5\\/5$/),\n          expect.stringMatching(/\\/25\\/25$/),\n          expect.stringMatching(/\\/20\\/20$/),\n          expect.stringMatching(/\\/10\\/10$/),\n          // max of 7 preview paths\n          ' [+2 more paths]',\n        ]) {\n          // the order isn't guaranteed on the timing tests as while() is being\n          // used in the render so can block the thread of other renders sharing\n          // the same worker\n          expect(matches).toContainEqual(check)\n        }\n      })","file":"integration/build-output/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not emit extracted comments","suites":["Build Output","Basic Application Output (experimental: )"],"updatePoint":{"line":189,"column":44},"line":189,"code":"      it('should not emit extracted comments', async () => {\n        const files = await recursiveReadDir(\n          join(appDir, '.next'),\n          /\\.txt|\\.LICENSE\\./\n        )\n        expect(files).toEqual([])\n      })","file":"integration/build-output/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not include custom error","suites":["Build Output","Custom App Output"],"updatePoint":{"line":206,"column":39},"line":206,"code":"    it('should not include custom error', async () => {\n      const { stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n\n      expect(stdout).toMatch(/\\/ (.* )?\\d{1,} B/)\n      expect(stdout).toMatch(/\\/_app (.* )?\\d{1,} B/)\n      expect(stdout).toMatch(/\\+ First Load JS shared by all \\s*[0-9.]+ kB/)\n      expect(stdout).toMatch(/ chunks\\/main-[0-9a-z]{16}\\.js \\s*[0-9.]+ kB/)\n      expect(stdout).toMatch(\n        / chunks\\/framework-[0-9a-z]{16}\\.js \\s*[0-9.]+ kB/\n      )\n\n      expect(stdout).not.toContain(' /_document')\n      expect(stdout).not.toContain(' /_error')\n      expect(stdout).not.toContain('<buildId>')\n\n      expect(stdout).toContain(' /_app')\n      expect(stdout).toContain('○ /')\n    })","file":"integration/build-output/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not include custom error","suites":["Build Output","With AMP Output"],"updatePoint":{"line":235,"column":39},"line":235,"code":"    it('should not include custom error', async () => {\n      const { stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n\n      expect(stdout).toMatch(/\\/ (.* )?[0-9.]+ B \\s*[0-9.]+ kB/)\n      expect(stdout).toMatch(/\\/amp (.* )?AMP/)\n      expect(stdout).toMatch(/\\/hybrid (.* )?[0-9.]+ B/)\n      expect(stdout).toMatch(/\\+ First Load JS shared by all \\s*[0-9.]+ kB/)\n      expect(stdout).toMatch(/ chunks\\/main-[0-9a-z]{16}\\.js \\s*[0-9.]+ kB/)\n      expect(stdout).toMatch(\n        / chunks\\/framework-[0-9a-z]{16}\\.js \\s*[0-9.]+ kB/\n      )\n\n      expect(stdout).not.toContain(' /_document')\n      expect(stdout).not.toContain(' /_error')\n      expect(stdout).not.toContain('<buildId>')\n\n      expect(stdout).toContain('○ /')\n    })","file":"integration/build-output/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not include custom app","suites":["Build Output","Custom Error Output"],"updatePoint":{"line":264,"column":37},"line":264,"code":"    it('should not include custom app', async () => {\n      const { stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n\n      expect(stdout).toMatch(/\\/ (.* )?\\d{1,} B/)\n      expect(stdout).toMatch(/λ \\/404 (.* )?\\d{1,} B/)\n      expect(stdout).toMatch(/\\+ First Load JS shared by all [ 0-9.]* kB/)\n      expect(stdout).toMatch(/ chunks\\/main-[0-9a-z]{16}\\.js [ 0-9.]* kB/)\n      expect(stdout).toMatch(/ chunks\\/framework-[0-9a-z]{16}\\.js [ 0-9. ]* kB/)\n\n      expect(stdout).not.toContain(' /_document')\n      expect(stdout).not.toContain(' /_app')\n      expect(stdout).not.toContain('<buildId>')\n\n      expect(stdout).not.toContain(' /_error')\n      expect(stdout).toContain('○ /')\n    })","file":"integration/build-output/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not specify /404 as lambda when static","suites":["Build Output","Custom Static Error Output"],"updatePoint":{"line":291,"column":53},"line":291,"code":"    it('should not specify /404 as lambda when static', async () => {\n      const { stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(stdout).toContain('○ /404')\n      expect(stdout).not.toContain('λ /_error')\n      expect(stdout).not.toContain('<buildId>')\n    })","file":"integration/build-output/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build and trace correctly","suites":["build trace with extra entries"],"updatePoint":{"line":10,"column":38},"line":10,"code":"  it('should build and trace correctly', async () => {\n    const result = await nextBuild(appDir, undefined, {\n      cwd: appDir,\n      stderr: true,\n      stdout: true,\n    })\n    console.log(result)\n    expect(result.code).toBe(0)\n\n    const appTrace = await fs.readJSON(\n      join(appDir, '.next/server/pages/_app.js.nft.json')\n    )\n    const indexTrace = await fs.readJSON(\n      join(appDir, '.next/server/pages/index.js.nft.json')\n    )\n    const anotherTrace = await fs.readJSON(\n      join(appDir, '.next/server/pages/another.js.nft.json')\n    )\n    const imageTrace = await fs.readJSON(\n      join(appDir, '.next/server/pages/image-import.js.nft.json')\n    )\n\n    expect(appTrace.files.some((file) => file.endsWith('hello.json'))).toBe(\n      true\n    )\n    expect(\n      appTrace.files.some((file) => file.endsWith('lib/get-data.js'))\n    ).toBe(true)\n    expect(\n      indexTrace.files.some((file) => file.endsWith('hello.json'))\n    ).toBeFalsy()\n    expect(\n      indexTrace.files.some((file) => file.includes('some-cms/index.js'))\n    ).toBe(true)\n    expect(\n      indexTrace.files.some((file) => file === '../../../include-me/hello.txt')\n    ).toBe(true)\n    expect(\n      indexTrace.files.some((file) => file === '../../../include-me/second.txt')\n    ).toBe(true)\n    expect(indexTrace.files.some((file) => file.includes('exclude-me'))).toBe(\n      false\n    )\n\n    expect(\n      anotherTrace.files.some((file) =>\n        file.includes('nested-structure/constants/package.json')\n      )\n    ).toBe(true)\n    expect(\n      anotherTrace.files.some((file) =>\n        file.includes('nested-structure/package.json')\n      )\n    ).toBe(true)\n    expect(\n      anotherTrace.files.some((file) =>\n        file.includes('nested-structure/dist/constants.js')\n      )\n    ).toBe(true)\n    expect(\n      imageTrace.files.some((file) => file.includes('public/another.jpg'))\n    ).toBe(true)\n    expect(\n      imageTrace.files.some((file) => file.includes('public/test.jpg'))\n    ).toBe(false)\n  })","file":"integration/build-trace-extra-entries/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not shown warning about minification withou any modification","suites":["Build warnings"],"updatePoint":{"line":10,"column":73},"line":10,"code":"  it('should not shown warning about minification withou any modification', async () => {\n    const { stderr } = await nextBuild(appDir, undefined, { stderr: true })\n    expect(stderr).not.toContain('optimization has been disabled')\n  })","file":"integration/build-warnings/test/index.test.js","skipped":false,"dir":"test"},{"name":"should shown warning about minification for minimize","suites":["Build warnings"],"updatePoint":{"line":15,"column":58},"line":15,"code":"  it('should shown warning about minification for minimize', async () => {\n    const nextConfig = new File(join(appDir, 'next.config.js'))\n\n    await waitFor(500)\n\n    nextConfig.replace('true', 'false')\n\n    const { stderr } = await nextBuild(appDir, undefined, { stderr: true })\n\n    expect(stderr).toContain('optimization has been disabled')\n\n    nextConfig.restore()\n  })","file":"integration/build-warnings/test/index.test.js","skipped":false,"dir":"test"},{"name":"should shown warning about minification for minimizer","suites":["Build warnings"],"updatePoint":{"line":29,"column":59},"line":29,"code":"  it('should shown warning about minification for minimizer', async () => {\n    const nextConfig = new File(join(appDir, 'next.config.js'))\n\n    await waitFor(500)\n\n    nextConfig.replace(\n      'config.optimization.minimize = true',\n      'config.optimization.minimizer = []'\n    )\n\n    const { stderr } = await nextBuild(appDir, undefined, { stderr: true })\n\n    expect(stderr).toContain('optimization has been disabled')\n\n    nextConfig.restore()\n  })","file":"integration/build-warnings/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not warn about missing cache in non-CI","suites":["Build warnings"],"updatePoint":{"line":46,"column":51},"line":46,"code":"  it('should not warn about missing cache in non-CI', async () => {\n    await remove(join(appDir, '.next'))\n\n    const { stdout } = await nextBuild(appDir, undefined, {\n      stdout: true,\n      env: {\n        CI: '',\n        CIRCLECI: '',\n        TRAVIS: '',\n        SYSTEM_TEAMFOUNDATIONCOLLECTIONURI: '',\n        GITHUB_ACTIONS: '',\n        GITHUB_EVENT_NAME: '',\n      },\n    })\n    expect(stdout).not.toContain('no-cache')\n  })","file":"integration/build-warnings/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not warn about missing cache on supported platforms","suites":["Build warnings"],"updatePoint":{"line":63,"column":64},"line":63,"code":"  it('should not warn about missing cache on supported platforms', async () => {\n    await remove(join(appDir, '.next'))\n\n    const { stdout } = await nextBuild(appDir, undefined, {\n      stdout: true,\n      env: { CI: '1', NOW_BUILDER: '1' },\n    })\n    expect(stdout).not.toContain('no-cache')\n  })","file":"integration/build-warnings/test/index.test.js","skipped":false,"dir":"test"},{"name":"should warn about missing cache in CI","suites":["Build warnings"],"updatePoint":{"line":73,"column":43},"line":73,"code":"  it('should warn about missing cache in CI', async () => {\n    await remove(join(appDir, '.next'))\n\n    let { stdout } = await nextBuild(appDir, undefined, {\n      stdout: true,\n      env: { CI: '1' },\n    })\n    expect(stdout).toContain('no-cache')\n\n    // Do not warn after cache is present\n    ;({ stdout } = await nextBuild(appDir, undefined, {\n      stdout: true,\n      env: { CI: '1' },\n    }))\n    expect(stdout).not.toContain('no-cache')\n  })","file":"integration/build-warnings/test/index.test.js","skipped":false,"dir":"test"},{"name":"should catch it in dev mode","suites":["Catches Missing getStaticProps"],"updatePoint":{"line":20,"column":33},"line":20,"code":"  it('should catch it in dev mode', async () => {\n    const appPort = await findPort()\n    const app = await launchApp(appDir, appPort)\n    const html = await renderViaHTTP(appPort, '/hello')\n    await killApp(app)\n\n    expect(html).toMatch(errorRegex)\n  })","file":"integration/catches-missing-getStaticProps/test/index.test.js","skipped":false,"dir":"test"},{"name":"should catch it in server build mode","suites":["Catches Missing getStaticProps"],"updatePoint":{"line":29,"column":42},"line":29,"code":"  it('should catch it in server build mode', async () => {\n    await fs.remove(nextConfig)\n    const { stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n    })\n    expect(stderr).toMatch(errorRegex)\n  })","file":"integration/catches-missing-getStaticProps/test/index.test.js","skipped":false,"dir":"test"},{"name":"should catch it in serverless mode","suites":["Catches Missing getStaticProps"],"updatePoint":{"line":37,"column":40},"line":37,"code":"  it('should catch it in serverless mode', async () => {\n    await fs.writeFile(\n      nextConfig,\n      `module.exports = { target: 'serverless' }`,\n      'utf8'\n    )\n    const { stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n    })\n    expect(stderr).toMatch(errorRegex)\n  })","file":"integration/catches-missing-getStaticProps/test/index.test.js","skipped":false,"dir":"test"},{"name":"should use all url friendly names","suites":["Chunking"],"updatePoint":{"line":52,"column":39},"line":52,"code":"  it('should use all url friendly names', () => {\n    expect(chunks).toEqual(chunks.map((name) => encodeURIComponent(name)))\n  })","file":"integration/chunking/test/index.test.js","skipped":false,"dir":"test"},{"name":"should create a framework chunk","suites":["Chunking"],"updatePoint":{"line":56,"column":37},"line":56,"code":"  it('should create a framework chunk', () => {\n    expect(existsChunkNamed('framework')).toBe(true)\n  })","file":"integration/chunking/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not create a commons chunk","suites":["Chunking"],"updatePoint":{"line":60,"column":39},"line":60,"code":"  it('should not create a commons chunk', () => {\n    // This app has no dependency that is required by ALL pages, and should\n    // therefore not have a commons chunk\n    expect(existsChunkNamed('commons')).toBe(false)\n  })","file":"integration/chunking/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not create a lib chunk for react or react-dom","suites":["Chunking"],"updatePoint":{"line":66,"column":58},"line":66,"code":"  it('should not create a lib chunk for react or react-dom', () => {\n    // These large dependencies would become lib chunks, except that they\n    // are preemptively moved into the framework chunk.\n    expect(existsChunkNamed('react|react-dom')).toBe(false)\n  })","file":"integration/chunking/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not preload the build manifest","suites":["Chunking"],"updatePoint":{"line":72,"column":43},"line":72,"code":"  it('should not preload the build manifest', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(html)\n    expect(\n      [].slice\n        .call($('link[rel=\"preload\"][as=\"script\"]'))\n        .map((e) => e.attribs.href)\n        .some((entry) => entry.includes('_buildManifest'))\n    ).toBe(false)\n  })","file":"integration/chunking/test/index.test.js","skipped":false,"dir":"test"},{"name":"should execute the build manifest","suites":["Chunking"],"updatePoint":{"line":83,"column":39},"line":83,"code":"  it('should execute the build manifest', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(html)\n    expect(\n      Array.from($('script'))\n        .map((e) => e.attribs.src)\n        .some((entry) => entry && entry.includes('_buildManifest'))\n    ).toBe(true)\n  })","file":"integration/chunking/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not include more than one instance of react-dom","suites":["Chunking"],"updatePoint":{"line":93,"column":60},"line":93,"code":"  it('should not include more than one instance of react-dom', async () => {\n    const misplacedReactDom = stats.chunks.some((chunk) => {\n      if (chunk.names.includes('framework')) {\n        // disregard react-dom in framework--it's supposed to be there\n        return false\n      }\n      return chunk.modules.some((module) => {\n        return /react-dom/.test(module.name)\n      })\n    })\n    expect(misplacedReactDom).toBe(false)\n  })","file":"integration/chunking/test/index.test.js","skipped":false,"dir":"test"},{"name":"should hydrate with aggressive chunking","suites":["Chunking","Serving"],"updatePoint":{"line":107,"column":47},"line":107,"code":"    it('should hydrate with aggressive chunking', async () => {\n      const browser = await webdriver(appPort, '/page2')\n      const text = await browser.elementByCss('#padded-str').text()\n\n      expect(text).toBe('__rad__')\n\n      await browser.close()\n    })","file":"integration/chunking/test/index.test.js","skipped":false,"dir":"test"},{"name":"should load chunks when navigating","suites":["Chunking","Serving"],"updatePoint":{"line":116,"column":42},"line":116,"code":"    it('should load chunks when navigating', async () => {\n      const browser = await webdriver(appPort, '/page3')\n      const text = await browser\n        .elementByCss('#page2-link')\n        .click()\n        .waitForElementByCss('#padded-str')\n        .elementByCss('#padded-str')\n        .text()\n\n      expect(text).toBe('__rad__')\n\n      await browser.close()\n    })","file":"integration/chunking/test/index.test.js","skipped":false,"dir":"test"},{"name":"should clean up .next before build start","suites":[],"updatePoint":{"line":26,"column":46},"line":26,"code":"  it('should clean up .next before build start', async () => {\n    await checkFileWrite(false)\n  })","file":"integration/clean-distdir/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not clean up .next before build start","suites":["Cleaning distDir","disabled write"],"updatePoint":{"line":71,"column":52},"line":71,"code":"    it('should not clean up .next before build start', async () => {\n      await checkFileWrite(true)\n    })","file":"integration/clean-distdir/test/index.test.js","skipped":false,"dir":"test"},{"name":"--help","suites":["CLI Usage","no command"],"updatePoint":{"line":20,"column":16},"line":20,"code":"    test('--help', async () => {\n      const help = await runNextCommand(['--help'], {\n        stdout: true,\n      })\n      expect(help.stdout).toMatch(/Usage/)\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"-h","suites":["CLI Usage","no command"],"updatePoint":{"line":27,"column":12},"line":27,"code":"    test('-h', async () => {\n      const help = await runNextCommand(['-h'], {\n        stdout: true,\n      })\n      expect(help.stdout).toMatch(/Usage/)\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"--version","suites":["CLI Usage","no command"],"updatePoint":{"line":34,"column":19},"line":34,"code":"    test('--version', async () => {\n      const output = await runNextCommand(['--version'], {\n        stdout: true,\n      })\n      expect(output.stdout).toMatch(\n        new RegExp(`Next\\\\.js v${pkg.version.replace(/\\./g, '\\\\.')}`)\n      )\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"-v","suites":["CLI Usage","no command"],"updatePoint":{"line":43,"column":12},"line":43,"code":"    test('-v', async () => {\n      const output = await runNextCommand(['--version'], {\n        stdout: true,\n      })\n      expect(output.stdout).toMatch(\n        new RegExp(`Next\\\\.js v${pkg.version.replace(/\\./g, '\\\\.')}`)\n      )\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"invalid directory","suites":["CLI Usage","no command"],"updatePoint":{"line":52,"column":27},"line":52,"code":"    test('invalid directory', async () => {\n      const output = await runNextCommand(['non-existent'], {\n        stderr: true,\n      })\n      expect(output.stderr).toContain(\n        'Invalid project directory provided, no such directory'\n      )\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"detects command typos","suites":["CLI Usage","no command"],"updatePoint":{"line":61,"column":31},"line":61,"code":"    test('detects command typos', async () => {\n      const typos = [\n        ['buidl', 'build'],\n        ['buill', 'build'],\n        ['biild', 'build'],\n        ['exporr', 'export'],\n        ['starr', 'start'],\n        ['dee', 'dev'],\n      ]\n\n      for (const check of typos) {\n        const output = await runNextCommand([check[0]], {\n          stderr: true,\n        })\n        expect(output.stderr).toContain(\n          `\"next ${check[0]}\" does not exist. Did you mean \"next ${check[1]}\"?`\n        )\n      }\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"--help","suites":["CLI Usage","build"],"updatePoint":{"line":83,"column":16},"line":83,"code":"    test('--help', async () => {\n      const help = await runNextCommand(['build', '--help'], {\n        stdout: true,\n      })\n      expect(help.stdout).toMatch(\n        /Compiles the application for production deployment/\n      )\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"-h","suites":["CLI Usage","build"],"updatePoint":{"line":92,"column":12},"line":92,"code":"    test('-h', async () => {\n      const help = await runNextCommand(['build', '-h'], {\n        stdout: true,\n      })\n      expect(help.stdout).toMatch(\n        /Compiles the application for production deployment/\n      )\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"should warn when unknown argument provided","suites":["CLI Usage","build"],"updatePoint":{"line":101,"column":52},"line":101,"code":"    test('should warn when unknown argument provided', async () => {\n      const { stderr } = await runNextCommand(['build', '--random'], {\n        stderr: true,\n      })\n      expect(stderr).toEqual('Unknown or unexpected option: --random\\n')\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not throw UnhandledPromiseRejectionWarning","suites":["CLI Usage","build"],"updatePoint":{"line":107,"column":59},"line":107,"code":"    test('should not throw UnhandledPromiseRejectionWarning', async () => {\n      const { stderr } = await runNextCommand(['build', '--random'], {\n        stderr: true,\n      })\n      expect(stderr).not.toContain('UnhandledPromiseRejectionWarning')\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"should exit when SIGINT is signalled","suites":["CLI Usage","build"],"updatePoint":{"line":114,"column":46},"line":114,"code":"    test('should exit when SIGINT is signalled', async () => {\n      const killSigint = (instance) =>\n        setTimeout(() => instance.kill('SIGINT'), 1000)\n      const { code, signal } = await runNextCommand(['build', dir], {\n        ignoreFail: true,\n        instance: killSigint,\n      })\n      // Node can only partially emulate signals on Windows. Our signal handlers won't affect the exit code.\n      // See: https://nodejs.org/api/process.html#process_signal_events\n      const expectedExitCode = process.platform === `win32` ? null : 0\n      const expectedExitSignal = process.platform === `win32` ? 'SIGINT' : null\n      expect(code).toBe(expectedExitCode)\n      expect(signal).toBe(expectedExitSignal)\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"should exit when SIGTERM is signalled","suites":["CLI Usage","build"],"updatePoint":{"line":128,"column":47},"line":128,"code":"    test('should exit when SIGTERM is signalled', async () => {\n      const killSigterm = (instance) =>\n        setTimeout(() => instance.kill('SIGTERM'), 1000)\n      const { code, signal } = await runNextCommand(['build', dir], {\n        ignoreFail: true,\n        instance: killSigterm,\n      })\n      // Node can only partially emulate signals on Windows. Our signal handlers won't affect the exit code.\n      // See: https://nodejs.org/api/process.html#process_signal_events\n      const expectedExitCode = process.platform === `win32` ? null : 0\n      const expectedExitSignal = process.platform === `win32` ? 'SIGTERM' : null\n      expect(code).toBe(expectedExitCode)\n      expect(signal).toBe(expectedExitSignal)\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"invalid directory","suites":["CLI Usage","build"],"updatePoint":{"line":143,"column":27},"line":143,"code":"    test('invalid directory', async () => {\n      const output = await runNextCommand(['build', 'non-existent'], {\n        stderr: true,\n      })\n      expect(output.stderr).toContain(\n        'Invalid project directory provided, no such directory'\n      )\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"--help","suites":["CLI Usage","dev"],"updatePoint":{"line":154,"column":16},"line":154,"code":"    test('--help', async () => {\n      const help = await runNextCommand(['dev', '--help'], {\n        stdout: true,\n      })\n      expect(help.stdout).toMatch(/Starts the application in development mode/)\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"-h","suites":["CLI Usage","dev"],"updatePoint":{"line":161,"column":12},"line":161,"code":"    test('-h', async () => {\n      const help = await runNextCommand(['dev', '-h'], {\n        stdout: true,\n      })\n      expect(help.stdout).toMatch(/Starts the application in development mode/)\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"custom directory","suites":["CLI Usage","dev"],"updatePoint":{"line":168,"column":26},"line":168,"code":"    test('custom directory', async () => {\n      const port = await findPort()\n      const output = await runNextCommandDev([dir, '--port', port], true)\n      expect(output).toMatch(/started server/i)\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"--port","suites":["CLI Usage","dev"],"updatePoint":{"line":174,"column":16},"line":174,"code":"    test('--port', async () => {\n      const port = await findPort()\n      const output = await runNextCommandDev([dir, '--port', port], true)\n      expect(output).toMatch(new RegExp(`on 0.0.0.0:${port}`))\n      expect(output).toMatch(new RegExp(`http://localhost:${port}`))\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"--port 0","suites":["CLI Usage","dev"],"updatePoint":{"line":181,"column":18},"line":181,"code":"    test('--port 0', async () => {\n      const output = await runNextCommandDev([dir, '--port', '0'], true)\n      const matches = /on 0.0.0.0:(\\d+)/.exec(output)\n      expect(matches).not.toBe(null)\n\n      const port = parseInt(matches[1])\n      // Regression test: port 0 was interpreted as if no port had been\n      // provided, falling back to 3000.\n      expect(port).not.toBe(3000)\n\n      expect(output).toMatch(new RegExp(`http://localhost:${port}`))\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"PORT=0","suites":["CLI Usage","dev"],"updatePoint":{"line":194,"column":16},"line":194,"code":"    test('PORT=0', async () => {\n      const output = await runNextCommandDev([dir], true, {\n        env: { PORT: 0 },\n      })\n      const matches = /on 0.0.0.0:(\\d+)/.exec(output)\n      expect(matches).not.toBe(null)\n\n      const port = parseInt(matches[1])\n      // Regression test: port 0 was interpreted as if no port had been\n      // provided, falling back to 3000.\n      expect(port).not.toBe(3000)\n\n      expect(output).toMatch(new RegExp(`http://localhost:${port}`))\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"NODE_OPTIONS='--inspect'","suites":["CLI Usage","dev"],"updatePoint":{"line":209,"column":34},"line":209,"code":"    test(\"NODE_OPTIONS='--inspect'\", async () => {\n      // this test checks that --inspect works by launching a single debugger for the main Next.js process,\n      // not for its subprocesses\n      const port = await findPort()\n      const output = await runNextCommandDev([dir, '--port', port], true, {\n        env: { NODE_OPTIONS: '--inspect' },\n      })\n      expect(output).toMatch(new RegExp(`on 0.0.0.0:${port}`))\n      expect(output).toMatch(new RegExp(`http://localhost:${port}`))\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"-p","suites":["CLI Usage","dev"],"updatePoint":{"line":220,"column":12},"line":220,"code":"    test('-p', async () => {\n      const port = await findPort()\n      const output = await runNextCommandDev([dir, '-p', port], true)\n      expect(output).toMatch(new RegExp(`on 0.0.0.0:${port}`))\n      expect(output).toMatch(new RegExp(`http://localhost:${port}`))\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"-p conflict","suites":["CLI Usage","dev"],"updatePoint":{"line":227,"column":21},"line":227,"code":"    test('-p conflict', async () => {\n      const port = await findPort()\n\n      let app = http.createServer((_, res) => {\n        res.writeHead(200, { 'Content-Type': 'text/plain' })\n        res.end('OK')\n      })\n      await new Promise((resolve, reject) => {\n        // This code catches EADDRINUSE error if the port is already in use\n        app.on('error', reject)\n        app.on('listening', () => resolve())\n        app.listen(port)\n      })\n      let stdout = '',\n        stderr = ''\n      await launchApp(dir, port, {\n        stdout: true,\n        stderr: true,\n        onStdout(msg) {\n          stdout += msg\n        },\n        onStderr(msg) {\n          stderr += msg\n        },\n      })\n      await new Promise((resolve) => app.close(resolve))\n      expect(stderr).toMatch('already in use')\n      expect(stdout).not.toMatch('ready')\n      expect(stdout).not.toMatch('started')\n      expect(stdout).not.toMatch(`${port}`)\n      expect(stdout).toBeFalsy()\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"--hostname","suites":["CLI Usage","dev"],"updatePoint":{"line":260,"column":20},"line":260,"code":"    test('--hostname', async () => {\n      const port = await findPort()\n      const output = await runNextCommandDev(\n        [dir, '--hostname', '0.0.0.0', '--port', port],\n        true\n      )\n      expect(output).toMatch(new RegExp(`on 0.0.0.0:${port}`))\n      expect(output).toMatch(new RegExp(`http://localhost:${port}`))\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"-H","suites":["CLI Usage","dev"],"updatePoint":{"line":270,"column":12},"line":270,"code":"    test('-H', async () => {\n      const port = await findPort()\n      const output = await runNextCommandDev(\n        [dir, '-H', '0.0.0.0', '--port', port],\n        true\n      )\n      expect(output).toMatch(new RegExp(`on 0.0.0.0:${port}`))\n      expect(output).toMatch(new RegExp(`http://localhost:${port}`))\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"should warn when unknown argument provided","suites":["CLI Usage","dev"],"updatePoint":{"line":280,"column":52},"line":280,"code":"    test('should warn when unknown argument provided', async () => {\n      const { stderr } = await runNextCommand(['dev', '--random'], {\n        stderr: true,\n      })\n      expect(stderr).toEqual('Unknown or unexpected option: --random\\n')\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not throw UnhandledPromiseRejectionWarning","suites":["CLI Usage","dev"],"updatePoint":{"line":286,"column":59},"line":286,"code":"    test('should not throw UnhandledPromiseRejectionWarning', async () => {\n      const { stderr } = await runNextCommand(['dev', '--random'], {\n        stderr: true,\n      })\n      expect(stderr).not.toContain('UnhandledPromiseRejectionWarning')\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"should exit when SIGINT is signalled","suites":["CLI Usage","dev"],"updatePoint":{"line":293,"column":46},"line":293,"code":"    test('should exit when SIGINT is signalled', async () => {\n      const killSigint = (instance) =>\n        setTimeout(() => instance.kill('SIGINT'), 1000)\n      const port = await findPort()\n      const { code, signal } = await runNextCommand(['dev', dir, '-p', port], {\n        ignoreFail: true,\n        instance: killSigint,\n      })\n      // Node can only partially emulate signals on Windows. Our signal handlers won't affect the exit code.\n      // See: https://nodejs.org/api/process.html#process_signal_events\n      const expectedExitCode = process.platform === `win32` ? null : 0\n      const expectedExitSignal = process.platform === `win32` ? 'SIGINT' : null\n      expect(code).toBe(expectedExitCode)\n      expect(signal).toBe(expectedExitSignal)\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"should exit when SIGTERM is signalled","suites":["CLI Usage","dev"],"updatePoint":{"line":308,"column":47},"line":308,"code":"    test('should exit when SIGTERM is signalled', async () => {\n      const killSigterm = (instance) =>\n        setTimeout(() => instance.kill('SIGTERM'), 1000)\n      const port = await findPort()\n      const { code, signal } = await runNextCommand(['dev', dir, '-p', port], {\n        ignoreFail: true,\n        instance: killSigterm,\n      })\n      // Node can only partially emulate signals on Windows. Our signal handlers won't affect the exit code.\n      // See: https://nodejs.org/api/process.html#process_signal_events\n      const expectedExitCode = process.platform === `win32` ? null : 0\n      const expectedExitSignal = process.platform === `win32` ? 'SIGTERM' : null\n      expect(code).toBe(expectedExitCode)\n      expect(signal).toBe(expectedExitSignal)\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"invalid directory","suites":["CLI Usage","dev"],"updatePoint":{"line":324,"column":27},"line":324,"code":"    test('invalid directory', async () => {\n      const output = await runNextCommand(['dev', 'non-existent'], {\n        stderr: true,\n      })\n      expect(output.stderr).toContain(\n        'Invalid project directory provided, no such directory'\n      )\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"--help","suites":["CLI Usage","start"],"updatePoint":{"line":335,"column":16},"line":335,"code":"    test('--help', async () => {\n      const help = await runNextCommand(['start', '--help'], {\n        stdout: true,\n      })\n      expect(help.stdout).toMatch(/Starts the application in production mode/)\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"-h","suites":["CLI Usage","start"],"updatePoint":{"line":342,"column":12},"line":342,"code":"    test('-h', async () => {\n      const help = await runNextCommand(['start', '-h'], {\n        stdout: true,\n      })\n      expect(help.stdout).toMatch(/Starts the application in production mode/)\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"should warn when unknown argument provided","suites":["CLI Usage","start"],"updatePoint":{"line":349,"column":52},"line":349,"code":"    test('should warn when unknown argument provided', async () => {\n      const { stderr } = await runNextCommand(['start', '--random'], {\n        stderr: true,\n      })\n      expect(stderr).toEqual('Unknown or unexpected option: --random\\n')\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not throw UnhandledPromiseRejectionWarning","suites":["CLI Usage","start"],"updatePoint":{"line":355,"column":59},"line":355,"code":"    test('should not throw UnhandledPromiseRejectionWarning', async () => {\n      const { stderr } = await runNextCommand(['start', '--random'], {\n        stderr: true,\n      })\n      expect(stderr).not.toContain('UnhandledPromiseRejectionWarning')\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"duplicate sass deps","suites":["CLI Usage","start"],"updatePoint":{"line":362,"column":29},"line":362,"code":"    test('duplicate sass deps', async () => {\n      const port = await findPort()\n\n      let stderr = ''\n      let instance = await launchApp(dirDuplicateSass, port, {\n        stderr: true,\n        onStderr(msg) {\n          stderr += msg\n        },\n      })\n\n      expect(stderr).toMatch('both `sass` and `node-sass` installed')\n\n      await killApp(instance)\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"should exit when SIGINT is signalled","suites":["CLI Usage","start"],"updatePoint":{"line":378,"column":46},"line":378,"code":"    test('should exit when SIGINT is signalled', async () => {\n      const killSigint = (instance) =>\n        setTimeout(() => instance.kill('SIGINT'), 1000)\n      await nextBuild(dir)\n      const port = await findPort()\n      const { code, signal } = await runNextCommand(\n        ['start', dir, '-p', port],\n        {\n          ignoreFail: true,\n          instance: killSigint,\n        }\n      )\n      // Node can only partially emulate signals on Windows. Our signal handlers won't affect the exit code.\n      // See: https://nodejs.org/api/process.html#process_signal_events\n      const expectedExitCode = process.platform === `win32` ? null : 0\n      const expectedExitSignal = process.platform === `win32` ? 'SIGINT' : null\n      expect(code).toBe(expectedExitCode)\n      expect(signal).toBe(expectedExitSignal)\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"should exit when SIGTERM is signalled","suites":["CLI Usage","start"],"updatePoint":{"line":397,"column":47},"line":397,"code":"    test('should exit when SIGTERM is signalled', async () => {\n      const killSigterm = (instance) =>\n        setTimeout(() => instance.kill('SIGTERM'), 1000)\n      await nextBuild(dir)\n      const port = await findPort()\n      const { code, signal } = await runNextCommand(\n        ['start', dir, '-p', port],\n        {\n          ignoreFail: true,\n          instance: killSigterm,\n        }\n      )\n      // Node can only partially emulate signals on Windows. Our signal handlers won't affect the exit code.\n      // See: https://nodejs.org/api/process.html#process_signal_events\n      const expectedExitCode = process.platform === `win32` ? null : 0\n      const expectedExitSignal = process.platform === `win32` ? 'SIGTERM' : null\n      expect(code).toBe(expectedExitCode)\n      expect(signal).toBe(expectedExitSignal)\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"invalid directory","suites":["CLI Usage","start"],"updatePoint":{"line":417,"column":27},"line":417,"code":"    test('invalid directory', async () => {\n      const output = await runNextCommand(['start', 'non-existent'], {\n        stderr: true,\n      })\n      expect(output.stderr).toContain(\n        'Invalid project directory provided, no such directory'\n      )\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"--keepAliveTimeout string arg","suites":["CLI Usage","start"],"updatePoint":{"line":426,"column":39},"line":426,"code":"    test('--keepAliveTimeout string arg', async () => {\n      const { stderr } = await runNextCommand(\n        ['start', '--keepAliveTimeout', 'string'],\n        {\n          stderr: true,\n        }\n      )\n      expect(stderr).toContain(\n        'Invalid --keepAliveTimeout, expected a non negative number but received \"NaN\"'\n      )\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"--keepAliveTimeout negative number","suites":["CLI Usage","start"],"updatePoint":{"line":438,"column":44},"line":438,"code":"    test('--keepAliveTimeout negative number', async () => {\n      const { stderr } = await runNextCommand(\n        ['start', '--keepAliveTimeout=-100'],\n        {\n          stderr: true,\n        }\n      )\n      expect(stderr).toContain(\n        'Invalid --keepAliveTimeout, expected a non negative number but received \"-100\"'\n      )\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"--keepAliveTimeout Infinity","suites":["CLI Usage","start"],"updatePoint":{"line":450,"column":37},"line":450,"code":"    test('--keepAliveTimeout Infinity', async () => {\n      const { stderr } = await runNextCommand(\n        ['start', '--keepAliveTimeout', 'Infinity'],\n        {\n          stderr: true,\n        }\n      )\n      expect(stderr).toContain(\n        'Invalid --keepAliveTimeout, expected a non negative number but received \"Infinity\"'\n      )\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"--keepAliveTimeout happy path","suites":["CLI Usage","start"],"updatePoint":{"line":462,"column":39},"line":462,"code":"    test('--keepAliveTimeout happy path', async () => {\n      const { stderr } = await runNextCommand(\n        ['start', '--keepAliveTimeout', '100'],\n        {\n          stderr: true,\n        }\n      )\n      expect(stderr).not.toContain(\n        'Invalid keep alive timeout provided, expected a non negative number'\n      )\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"--help","suites":["CLI Usage","export"],"updatePoint":{"line":476,"column":16},"line":476,"code":"    test('--help', async () => {\n      const help = await runNextCommand(['export', '--help'], {\n        stdout: true,\n      })\n      expect(help.stdout).toMatch(/Exports the application/)\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"-h","suites":["CLI Usage","export"],"updatePoint":{"line":483,"column":12},"line":483,"code":"    test('-h', async () => {\n      const help = await runNextCommand(['export', '-h'], {\n        stdout: true,\n      })\n      expect(help.stdout).toMatch(/Exports the application/)\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"should warn when unknown argument provided","suites":["CLI Usage","export"],"updatePoint":{"line":490,"column":52},"line":490,"code":"    test('should warn when unknown argument provided', async () => {\n      const { stderr } = await runNextCommand(['export', '--random'], {\n        stderr: true,\n      })\n      expect(stderr).toEqual('Unknown or unexpected option: --random\\n')\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not throw UnhandledPromiseRejectionWarning","suites":["CLI Usage","export"],"updatePoint":{"line":496,"column":59},"line":496,"code":"    test('should not throw UnhandledPromiseRejectionWarning', async () => {\n      const { stderr } = await runNextCommand(['export', '--random'], {\n        stderr: true,\n      })\n      expect(stderr).not.toContain('UnhandledPromiseRejectionWarning')\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"invalid directory","suites":["CLI Usage","export"],"updatePoint":{"line":503,"column":27},"line":503,"code":"    test('invalid directory', async () => {\n      const output = await runNextCommand(['export', 'non-existent'], {\n        stderr: true,\n      })\n      expect(output.stderr).toContain(\n        'Invalid project directory provided, no such directory'\n      )\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"--help","suites":["CLI Usage","telemetry"],"updatePoint":{"line":514,"column":16},"line":514,"code":"    test('--help', async () => {\n      const help = await runNextCommand(['telemetry', '--help'], {\n        stdout: true,\n      })\n      expect(help.stdout).toMatch(\n        /Allows you to control Next\\.js' telemetry collection/\n      )\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"-h","suites":["CLI Usage","telemetry"],"updatePoint":{"line":523,"column":12},"line":523,"code":"    test('-h', async () => {\n      const help = await runNextCommand(['telemetry', '-h'], {\n        stdout: true,\n      })\n      expect(help.stdout).toMatch(\n        /Allows you to control Next\\.js' telemetry collection/\n      )\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"should warn when unknown argument provided","suites":["CLI Usage","telemetry"],"updatePoint":{"line":532,"column":52},"line":532,"code":"    test('should warn when unknown argument provided', async () => {\n      const { stderr } = await runNextCommand(['telemetry', '--random'], {\n        stderr: true,\n      })\n      expect(stderr).toEqual('Unknown or unexpected option: --random\\n')\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not throw UnhandledPromiseRejectionWarning","suites":["CLI Usage","telemetry"],"updatePoint":{"line":538,"column":59},"line":538,"code":"    test('should not throw UnhandledPromiseRejectionWarning', async () => {\n      const { stderr } = await runNextCommand(['telemetry', '--random'], {\n        stderr: true,\n      })\n      expect(stderr).not.toContain('UnhandledPromiseRejectionWarning')\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"--help","suites":["CLI Usage","info"],"updatePoint":{"line":547,"column":16},"line":547,"code":"    test('--help', async () => {\n      const help = await runNextCommand(['info', '--help'], {\n        stdout: true,\n      })\n      expect(help.stdout).toMatch(\n        /Prints relevant details about the current system which can be used to report Next\\.js bugs/\n      )\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"-h","suites":["CLI Usage","info"],"updatePoint":{"line":556,"column":12},"line":556,"code":"    test('-h', async () => {\n      const help = await runNextCommand(['info', '-h'], {\n        stdout: true,\n      })\n      expect(help.stdout).toMatch(\n        /Prints relevant details about the current system which can be used to report Next\\.js bugs/\n      )\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"should print output","suites":["CLI Usage","info"],"updatePoint":{"line":565,"column":29},"line":565,"code":"    test('should print output', async () => {\n      const info = await runNextCommand(['info'], {\n        stdout: true,\n        stderr: true,\n      })\n      expect((info.stderr || '').toLowerCase()).not.toContain('error')\n\n      expect(info.stdout).toMatch(\n        new RegExp(`\n    Operating System:\n      Platform: .*\n      Arch: .*\n      Version: .*\n    Binaries:\n      Node: .*\n      npm: .*\n      Yarn: .*\n      pnpm: .*\n    Relevant packages:\n      next: .*\n      eslint-config-next: .*\n      react: .*\n      react-dom: .*\n`)\n      )\n    })","file":"integration/cli/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have the initial route announced","suites":["Client Navigation accessibility","<RouteAnnouncer />"],"updatePoint":{"line":48,"column":51},"line":48,"code":"    it('should not have the initial route announced', async () => {\n      const browser = await webdriver(context.appPort, '/')\n      const title = await getAnnouncedTitle(browser)\n      expect(title).toBe('')\n    })","file":"integration/client-navigation-a11y/test/index.test.js","skipped":false,"dir":"test"},{"name":"has aria-live=\"assertive\" and role=\"alert\"","suites":["Client Navigation accessibility","<RouteAnnouncer />"],"updatePoint":{"line":54,"column":50},"line":54,"code":"    it('has aria-live=\"assertive\" and role=\"alert\"', async () => {\n      const browser = await webdriver(context.appPort, '/')\n      const routeAnnouncer = await browser.waitForElementByCss(\n        '#__next-route-announcer__'\n      )\n      const ariaLiveValue = await routeAnnouncer.getAttribute('aria-live')\n      const roleValue = await routeAnnouncer.getAttribute('role')\n\n      expect(ariaLiveValue).toBe('assertive')\n      expect(roleValue).toBe('alert')\n      await browser.close()\n    })","file":"integration/client-navigation-a11y/test/index.test.js","skipped":false,"dir":"test"},{"name":"has the innerText equal to the value of document.title","suites":["Client Navigation accessibility","<RouteAnnouncer />","There is a title but no h1 tag"],"updatePoint":{"line":68,"column":64},"line":68,"code":"      it('has the innerText equal to the value of document.title', async () => {\n        const browser = await webdriver(context.appPort, '/')\n        await navigateTo(browser, 'page-with-title')\n\n        const routeAnnouncerValue = await getAnnouncedTitle(browser)\n        const title = await getDocumentTitle(browser)\n\n        expect(routeAnnouncerValue).toBe(title)\n        await browser.close()\n      })","file":"integration/client-navigation-a11y/test/index.test.js","skipped":false,"dir":"test"},{"name":"has the innerText equal to the value of h1","suites":["Client Navigation accessibility","<RouteAnnouncer />","There is no title but a h1 tag"],"updatePoint":{"line":81,"column":52},"line":81,"code":"      it('has the innerText equal to the value of h1', async () => {\n        const browser = await webdriver(context.appPort, '/')\n        await navigateTo(browser, 'page-with-h1')\n\n        const routeAnnouncerValue = await getAnnouncedTitle(browser)\n        const h1Value = await getMainHeadingTitle(browser)\n\n        expect(routeAnnouncerValue).toBe(h1Value)\n        await browser.close()\n      })","file":"integration/client-navigation-a11y/test/index.test.js","skipped":false,"dir":"test"},{"name":"has the innerText equal to the value of h1","suites":["Client Navigation accessibility","<RouteAnnouncer />","There is a title and a h1 tag"],"updatePoint":{"line":94,"column":52},"line":94,"code":"      it('has the innerText equal to the value of h1', async () => {\n        const browser = await webdriver(context.appPort, '/')\n        await navigateTo(browser, 'page-with-h1-and-title')\n\n        const routeAnnouncerValue = await getAnnouncedTitle(browser)\n        const title = await getDocumentTitle(browser)\n\n        expect(routeAnnouncerValue).toBe(title)\n        await browser.close()\n      })","file":"integration/client-navigation-a11y/test/index.test.js","skipped":false,"dir":"test"},{"name":"has the innerText equal to the value of the pathname","suites":["Client Navigation accessibility","<RouteAnnouncer />","There is no title and no h1 tag"],"updatePoint":{"line":107,"column":62},"line":107,"code":"      it('has the innerText equal to the value of the pathname', async () => {\n        const browser = await webdriver(context.appPort, '/')\n        await navigateTo(browser, 'page-without-h1-or-title')\n\n        const routeAnnouncerValue = await getAnnouncedTitle(browser)\n        const pathname = '/page-without-h1-or-title'\n\n        expect(routeAnnouncerValue).toBe(pathname)\n        await browser.close()\n      })","file":"integration/client-navigation-a11y/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not reload when visiting /_error directly","suites":["Client Navigation"],"updatePoint":{"line":30,"column":54},"line":30,"code":"  it('should not reload when visiting /_error directly', async () => {\n    const { status } = await fetchViaHTTP(context.appPort, '/_error')\n    const browser = await webdriver(context.appPort, '/_error')\n\n    await browser.eval('window.hello = true')\n\n    // wait on-demand-entries timeout since it can trigger\n    // reloading non-stop\n    for (let i = 0; i < 15; i++) {\n      expect(await browser.eval('window.hello')).toBe(true)\n      await waitFor(1000)\n    }\n    const html = await browser.eval('document.documentElement.innerHTML')\n\n    expect(status).toBe(404)\n    expect(html).toContain('This page could not be found')\n    expect(html).toContain('404')\n  })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate the page","suites":["Client Navigation","with <Link/>"],"updatePoint":{"line":50,"column":32},"line":50,"code":"    it('should navigate the page', async () => {\n      const browser = await webdriver(context.appPort, '/nav')\n      const text = await browser\n        .elementByCss('#about-link')\n        .click()\n        .waitForElementByCss('.nav-about')\n        .elementByCss('p')\n        .text()\n\n      expect(text).toBe('This is the about page.')\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have proper error when no children are provided","suites":["Client Navigation","with <Link/>"],"updatePoint":{"line":63,"column":62},"line":63,"code":"    it('should have proper error when no children are provided', async () => {\n      const browser = await webdriver(context.appPort, '/link-no-child')\n      expect(await hasRedbox(browser, true)).toBe(true)\n      expect(await getRedboxHeader(browser)).toContain(\n        'No children were passed to <Link> with `href` of `/about` but one child is required'\n      )\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not throw error when one number type child is provided","suites":["Client Navigation","with <Link/>"],"updatePoint":{"line":71,"column":69},"line":71,"code":"    it('should not throw error when one number type child is provided', async () => {\n      const browser = await webdriver(context.appPort, '/link-number-child')\n      expect(await hasRedbox(browser)).toBe(false)\n      if (browser) await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate back after reload","suites":["Client Navigation","with <Link/>"],"updatePoint":{"line":77,"column":41},"line":77,"code":"    it('should navigate back after reload', async () => {\n      const browser = await webdriver(context.appPort, '/nav')\n      await browser.elementByCss('#about-link').click()\n      await browser.waitForElementByCss('.nav-about')\n      await browser.refresh()\n      await waitFor(3000)\n      await browser.back()\n      await waitFor(3000)\n      const text = await browser.elementByCss('#about-link').text()\n      if (browser) await browser.close()\n      expect(text).toMatch(/About/)\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate forwards after reload","suites":["Client Navigation","with <Link/>"],"updatePoint":{"line":90,"column":45},"line":90,"code":"    it('should navigate forwards after reload', async () => {\n      const browser = await webdriver(context.appPort, '/nav')\n      await browser.elementByCss('#about-link').click()\n      await browser.waitForElementByCss('.nav-about')\n      await browser.back()\n      await browser.refresh()\n      await waitFor(3000)\n      await browser.forward()\n      await waitFor(3000)\n      const text = await browser.elementByCss('p').text()\n      if (browser) await browser.close()\n      expect(text).toMatch(/this is the about page/i)\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should error when calling onClick without event","suites":["Client Navigation","with <Link/>"],"updatePoint":{"line":104,"column":55},"line":104,"code":"    it('should error when calling onClick without event', async () => {\n      const browser = await webdriver(context.appPort, '/link-invalid-onclick')\n      expect(await browser.elementByCss('#errors').text()).toBe('0')\n      await browser.elementByCss('#custom-button').click()\n      expect(await browser.elementByCss('#errors').text()).toBe('1')\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate via the client side","suites":["Client Navigation","with <Link/>"],"updatePoint":{"line":111,"column":43},"line":111,"code":"    it('should navigate via the client side', async () => {\n      const browser = await webdriver(context.appPort, '/nav')\n\n      const counterText = await browser\n        .elementByCss('#increase')\n        .click()\n        .elementByCss('#about-link')\n        .click()\n        .waitForElementByCss('.nav-about')\n        .elementByCss('#home-link')\n        .click()\n        .waitForElementByCss('.nav-home')\n        .elementByCss('#counter')\n        .text()\n\n      expect(counterText).toBe('Counter: 1')\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate an absolute url","suites":["Client Navigation","with <Link/>"],"updatePoint":{"line":130,"column":39},"line":130,"code":"    it('should navigate an absolute url', async () => {\n      const browser = await webdriver(\n        context.appPort,\n        `/absolute-url?port=${context.appPort}`\n      )\n      await browser.waitForElementByCss('#absolute-link').click()\n      await check(\n        () => browser.eval(() => window.location.origin),\n        'https://vercel.com'\n      )\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should call mouse handlers with an absolute url","suites":["Client Navigation","with <Link/>"],"updatePoint":{"line":142,"column":55},"line":142,"code":"    it('should call mouse handlers with an absolute url', async () => {\n      const browser = await webdriver(\n        context.appPort,\n        `/absolute-url?port=${context.appPort}`\n      )\n\n      await browser.elementByCss('#absolute-link-mouse-events').moveTo()\n\n      expect(\n        await browser\n          .waitForElementByCss('#absolute-link-mouse-events')\n          .getAttribute('data-hover')\n      ).toBe('true')\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate an absolute local url","suites":["Client Navigation","with <Link/>"],"updatePoint":{"line":157,"column":45},"line":157,"code":"    it('should navigate an absolute local url', async () => {\n      const browser = await webdriver(\n        context.appPort,\n        `/absolute-url?port=${context.appPort}`\n      )\n      await browser.eval(() => (window._didNotNavigate = true))\n      await browser.waitForElementByCss('#absolute-local-link').click()\n      const text = await browser\n        .waitForElementByCss('.nav-about')\n        .elementByCss('p')\n        .text()\n\n      expect(text).toBe('This is the about page.')\n      expect(await browser.eval(() => window._didNotNavigate)).toBe(true)\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate an absolute local url with as","suites":["Client Navigation","with <Link/>"],"updatePoint":{"line":173,"column":53},"line":173,"code":"    it('should navigate an absolute local url with as', async () => {\n      const browser = await webdriver(\n        context.appPort,\n        `/absolute-url?port=${context.appPort}`\n      )\n      await browser.eval(() => (window._didNotNavigate = true))\n      await browser.waitForElementByCss('#absolute-local-dynamic-link').click()\n      expect(await browser.waitForElementByCss('#dynamic-page').text()).toBe(\n        'hello'\n      )\n      expect(await browser.eval(() => window._didNotNavigate)).toBe(true)\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate the page","suites":["Client Navigation","with <a/> tag inside the <Link />"],"updatePoint":{"line":188,"column":32},"line":188,"code":"    it('should navigate the page', async () => {\n      const browser = await webdriver(context.appPort, '/nav/about')\n      const text = await browser\n        .elementByCss('#home-link')\n        .click()\n        .waitForElementByCss('.nav-home')\n        .elementByCss('p')\n        .text()\n\n      expect(text).toBe('This is the home.')\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not navigate if the <a/> tag has a target","suites":["Client Navigation","with <a/> tag inside the <Link />"],"updatePoint":{"line":201,"column":56},"line":201,"code":"    it('should not navigate if the <a/> tag has a target', async () => {\n      const browser = await webdriver(context.appPort, '/nav')\n\n      await browser\n        .elementByCss('#increase')\n        .click()\n        .elementByCss('#target-link')\n        .click()\n\n      await waitFor(1000)\n\n      const counterText = await browser.elementByCss('#counter').text()\n\n      expect(counterText).toBe('Counter: 1')\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not navigate if the click-event is modified","suites":["Client Navigation","with <a/> tag inside the <Link />"],"updatePoint":{"line":218,"column":58},"line":218,"code":"    it('should not navigate if the click-event is modified', async () => {\n      const browser = await webdriver(context.appPort, '/nav')\n\n      await browser.elementByCss('#increase').click()\n\n      const key = process.platform === 'darwin' ? 'Meta' : 'Control'\n\n      await browser.keydown(key)\n\n      await browser.elementByCss('#in-svg-link').click()\n\n      await browser.keyup(key)\n      await waitFor(1000)\n\n      const counterText = await browser.elementByCss('#counter').text()\n\n      expect(counterText).toBe('Counter: 1')\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not redirect if passHref prop is not defined in Link","suites":["Client Navigation","with unexpected <a/> nested tag"],"updatePoint":{"line":240,"column":67},"line":240,"code":"    it('should not redirect if passHref prop is not defined in Link', async () => {\n      const browser = await webdriver(context.appPort, '/nav/pass-href-prop')\n      const text = await browser\n        .elementByCss('#without-href')\n        .click()\n        .waitForElementByCss('.nav-pass-href-prop')\n        .elementByCss('p')\n        .text()\n\n      expect(text).toBe('This is the passHref prop page.')\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should redirect if passHref prop is defined in Link","suites":["Client Navigation","with unexpected <a/> nested tag"],"updatePoint":{"line":253,"column":59},"line":253,"code":"    it('should redirect if passHref prop is defined in Link', async () => {\n      const browser = await webdriver(context.appPort, '/nav/pass-href-prop')\n      const text = await browser\n        .elementByCss('#with-href')\n        .click()\n        .waitForElementByCss('.nav-home')\n        .elementByCss('p')\n        .text()\n\n      expect(text).toBe('This is the home.')\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render an error","suites":["Client Navigation","with empty getInitialProps()"],"updatePoint":{"line":268,"column":30},"line":268,"code":"    it('should render an error', async () => {\n      let browser\n      try {\n        browser = await webdriver(context.appPort, '/nav')\n        await browser.elementByCss('#empty-props').click()\n        expect(await hasRedbox(browser)).toBe(true)\n        expect(await getRedboxHeader(browser)).toMatch(\n          /should resolve to an object\\. But found \"null\" instead\\./\n        )\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate the page","suites":["Client Navigation","with the same page but different querystring"],"updatePoint":{"line":286,"column":32},"line":286,"code":"    it('should navigate the page', async () => {\n      const browser = await webdriver(context.appPort, '/nav/querystring?id=1')\n      const text = await browser\n        .elementByCss('#next-id-link')\n        .click()\n        .waitForElementByCss('.nav-id-2')\n        .elementByCss('p')\n        .text()\n\n      expect(text).toBe('2')\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should remove querystring","suites":["Client Navigation","with the same page but different querystring"],"updatePoint":{"line":299,"column":33},"line":299,"code":"    it('should remove querystring', async () => {\n      const browser = await webdriver(context.appPort, '/nav/querystring?id=1')\n      const text = await browser\n        .elementByCss('#main-page')\n        .click()\n        .waitForElementByCss('.nav-id-0')\n        .elementByCss('p')\n        .text()\n\n      expect(text).toBe('0')\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reload the page","suites":["Client Navigation","with the current url"],"updatePoint":{"line":314,"column":30},"line":314,"code":"    it('should reload the page', async () => {\n      const browser = await webdriver(context.appPort, '/nav/self-reload')\n      const defaultCount = await browser.elementByCss('p').text()\n      expect(defaultCount).toBe('COUNT: 0')\n\n      const countAfterClicked = await browser\n        .elementByCss('#self-reload-link')\n        .click()\n        .elementByCss('p')\n        .text()\n\n      expect(countAfterClicked).toBe('COUNT: 1')\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should always replace the state","suites":["Client Navigation","with the current url"],"updatePoint":{"line":329,"column":39},"line":329,"code":"    it('should always replace the state', async () => {\n      const browser = await webdriver(context.appPort, '/nav')\n\n      const countAfterClicked = await browser\n        .elementByCss('#self-reload-link')\n        .click()\n        .waitForElementByCss('#self-reload-page')\n        .elementByCss('#self-reload-link')\n        .click()\n        .elementByCss('#self-reload-link')\n        .click()\n        .elementByCss('p')\n        .text()\n\n      // counts (page change + two clicks)\n      expect(countAfterClicked).toBe('COUNT: 3')\n\n      // Since we replace the state, back button would simply go us back to /nav\n      await browser.back().waitForElementByCss('.nav-home')\n\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reload the page and perform additional action","suites":["Client Navigation","with onClick action"],"updatePoint":{"line":354,"column":60},"line":354,"code":"    it('should reload the page and perform additional action', async () => {\n      let browser\n      try {\n        browser = await webdriver(context.appPort, '/nav/on-click')\n        const defaultCountQuery = await browser\n          .elementByCss('#query-count')\n          .text()\n        const defaultCountState = await browser\n          .elementByCss('#state-count')\n          .text()\n        expect(defaultCountQuery).toBe('QUERY COUNT: 0')\n        expect(defaultCountState).toBe('STATE COUNT: 0')\n\n        await browser.elementByCss('#on-click-link').click()\n\n        const countQueryAfterClicked = await browser\n          .elementByCss('#query-count')\n          .text()\n        const countStateAfterClicked = await browser\n          .elementByCss('#state-count')\n          .text()\n        expect(countQueryAfterClicked).toBe('QUERY COUNT: 1')\n        expect(countStateAfterClicked).toBe('STATE COUNT: 1')\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not reload if default was prevented","suites":["Client Navigation","with onClick action"],"updatePoint":{"line":384,"column":50},"line":384,"code":"    it('should not reload if default was prevented', async () => {\n      let browser\n      try {\n        browser = await webdriver(context.appPort, '/nav/on-click')\n        const defaultCountQuery = await browser\n          .elementByCss('#query-count')\n          .text()\n        const defaultCountState = await browser\n          .elementByCss('#state-count')\n          .text()\n        expect(defaultCountQuery).toBe('QUERY COUNT: 0')\n        expect(defaultCountState).toBe('STATE COUNT: 0')\n\n        await browser.elementByCss('#on-click-link-prevent-default').click()\n\n        const countQueryAfterClicked = await browser\n          .elementByCss('#query-count')\n          .text()\n        const countStateAfterClicked = await browser\n          .elementByCss('#state-count')\n          .text()\n        expect(countQueryAfterClicked).toBe('QUERY COUNT: 0')\n        expect(countStateAfterClicked).toBe('STATE COUNT: 1')\n\n        await browser.elementByCss('#on-click-link').click()\n\n        const countQueryAfterClickedAgain = await browser\n          .elementByCss('#query-count')\n          .text()\n        const countStateAfterClickedAgain = await browser\n          .elementByCss('#state-count')\n          .text()\n        expect(countQueryAfterClickedAgain).toBe('QUERY COUNT: 1')\n        expect(countStateAfterClickedAgain).toBe('STATE COUNT: 2')\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should always replace the state and perform additional action","suites":["Client Navigation","with onClick action"],"updatePoint":{"line":425,"column":69},"line":425,"code":"    it('should always replace the state and perform additional action', async () => {\n      let browser\n      try {\n        browser = await webdriver(context.appPort, '/nav')\n\n        await browser\n          .elementByCss('#on-click-link')\n          .click()\n          .waitForElementByCss('#on-click-page')\n\n        const defaultCountQuery = await browser\n          .elementByCss('#query-count')\n          .text()\n        expect(defaultCountQuery).toBe('QUERY COUNT: 1')\n\n        await browser.elementByCss('#on-click-link').click()\n        const countQueryAfterClicked = await browser\n          .elementByCss('#query-count')\n          .text()\n        const countStateAfterClicked = await browser\n          .elementByCss('#state-count')\n          .text()\n        expect(countQueryAfterClicked).toBe('QUERY COUNT: 2')\n        expect(countStateAfterClicked).toBe('STATE COUNT: 1')\n\n        // Since we replace the state, back button would simply go us back to /nav\n        await browser.back().waitForElementByCss('.nav-home')\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reset scroll before the new page runs its lifecycles (<Link />)","suites":["Client Navigation","resets scroll at the correct time"],"updatePoint":{"line":460,"column":78},"line":460,"code":"    it('should reset scroll before the new page runs its lifecycles (<Link />)', async () => {\n      let browser\n      try {\n        browser = await webdriver(\n          context.appPort,\n          '/nav/long-page-to-snap-scroll'\n        )\n\n        // Scrolls to item 400 on the page\n        await browser\n          .waitForElementByCss('#long-page-to-snap-scroll')\n          .elementByCss('#scroll-to-item-400')\n          .click()\n\n        const scrollPosition = await browser.eval('window.pageYOffset')\n        expect(scrollPosition).toBe(7208)\n\n        // Go to snap scroll page\n        await browser\n          .elementByCss('#goto-snap-scroll-position')\n          .click()\n          .waitForElementByCss('#scroll-pos-y')\n\n        const snappedScrollPosition = await browser.eval(\n          'document.getElementById(\"scroll-pos-y\").innerText'\n        )\n        expect(snappedScrollPosition).toBe('0')\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reset scroll before the new page runs its lifecycles (Router#push)","suites":["Client Navigation","resets scroll at the correct time"],"updatePoint":{"line":494,"column":81},"line":494,"code":"    it('should reset scroll before the new page runs its lifecycles (Router#push)', async () => {\n      let browser\n      try {\n        browser = await webdriver(\n          context.appPort,\n          '/nav/long-page-to-snap-scroll'\n        )\n\n        // Scrolls to item 400 on the page\n        await browser\n          .waitForElementByCss('#long-page-to-snap-scroll')\n          .elementByCss('#scroll-to-item-400')\n          .click()\n\n        const scrollPosition = await browser.eval('window.pageYOffset')\n        expect(scrollPosition).toBe(7208)\n\n        // Go to snap scroll page\n        await browser\n          .elementByCss('#goto-snap-scroll-position-imperative')\n          .click()\n          .waitForElementByCss('#scroll-pos-y')\n\n        const snappedScrollPosition = await browser.eval(\n          'document.getElementById(\"scroll-pos-y\").innerText'\n        )\n        expect(snappedScrollPosition).toBe('0')\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should intentionally not reset scroll before the new page runs its lifecycles (Router#push)","suites":["Client Navigation","resets scroll at the correct time"],"updatePoint":{"line":528,"column":99},"line":528,"code":"    it('should intentionally not reset scroll before the new page runs its lifecycles (Router#push)', async () => {\n      let browser\n      try {\n        browser = await webdriver(\n          context.appPort,\n          '/nav/long-page-to-snap-scroll'\n        )\n\n        // Scrolls to item 400 on the page\n        await browser\n          .waitForElementByCss('#long-page-to-snap-scroll')\n          .elementByCss('#scroll-to-item-400')\n          .click()\n\n        const scrollPosition = await browser.eval('window.pageYOffset')\n        expect(scrollPosition).toBe(7208)\n\n        // Go to snap scroll page\n        await browser\n          .elementByCss('#goto-snap-scroll-position-imperative-noscroll')\n          .click()\n          .waitForElementByCss('#scroll-pos-y')\n\n        const snappedScrollPosition = await browser.eval(\n          'document.getElementById(\"scroll-pos-y\").innerText'\n        )\n        expect(snappedScrollPosition).not.toBe('0')\n        expect(Number(snappedScrollPosition)).toBeGreaterThanOrEqual(7208)\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have hydration mis-match for hash link","suites":["Client Navigation","with hash changes","check hydration mis-match"],"updatePoint":{"line":566,"column":59},"line":566,"code":"      it('should not have hydration mis-match for hash link', async () => {\n        const browser = await webdriver(context.appPort, '/nav/hash-changes')\n        const browserLogs = await browser.log('browser')\n        let found = false\n        browserLogs.forEach((log) => {\n          console.log('log.message', log.message)\n          if (log.message.includes('Warning: Prop')) {\n            found = true\n          }\n        })\n        expect(found).toEqual(false)\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not run getInitialProps","suites":["Client Navigation","with hash changes","when hash change via Link"],"updatePoint":{"line":581,"column":40},"line":581,"code":"      it('should not run getInitialProps', async () => {\n        const browser = await webdriver(context.appPort, '/nav/hash-changes')\n\n        const counter = await browser\n          .elementByCss('#via-link')\n          .click()\n          .elementByCss('p')\n          .text()\n\n        expect(counter).toBe('COUNT: 0')\n\n        await browser.close()\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should scroll to the specified position on the same page","suites":["Client Navigation","with hash changes","when hash change via Link"],"updatePoint":{"line":595,"column":66},"line":595,"code":"      it('should scroll to the specified position on the same page', async () => {\n        let browser\n        try {\n          browser = await webdriver(context.appPort, '/nav/hash-changes')\n\n          // Scrolls to item 400 on the page\n          await browser.elementByCss('#scroll-to-item-400').click()\n\n          const scrollPositionBeforeEmptyHash = await browser.eval(\n            'window.pageYOffset'\n          )\n\n          expect(scrollPositionBeforeEmptyHash).toBe(7258)\n\n          // Scrolls back to top when scrolling to `#` with no value.\n          await browser.elementByCss('#via-empty-hash').click()\n\n          const scrollPositionAfterEmptyHash = await browser.eval(\n            'window.pageYOffset'\n          )\n\n          expect(scrollPositionAfterEmptyHash).toBe(0)\n\n          // Scrolls to item 400 on the page\n          await browser.elementByCss('#scroll-to-item-400').click()\n\n          const scrollPositionBeforeTopHash = await browser.eval(\n            'window.pageYOffset'\n          )\n\n          expect(scrollPositionBeforeTopHash).toBe(7258)\n\n          // Scrolls back to top when clicking link with href `#top`.\n          await browser.elementByCss('#via-top-hash').click()\n\n          const scrollPositionAfterTopHash = await browser.eval(\n            'window.pageYOffset'\n          )\n\n          expect(scrollPositionAfterTopHash).toBe(0)\n\n          // Scrolls to cjk anchor on the page\n          await browser.elementByCss('#scroll-to-cjk-anchor').click()\n\n          const scrollPositionCJKHash = await browser.eval('window.pageYOffset')\n\n          expect(scrollPositionCJKHash).toBe(17436)\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not scroll to hash when scroll={false} is set","suites":["Client Navigation","with hash changes","when hash change via Link"],"updatePoint":{"line":649,"column":62},"line":649,"code":"      it('should not scroll to hash when scroll={false} is set', async () => {\n        const browser = await webdriver(context.appPort, '/nav/hash-changes')\n        const curScroll = await browser.eval(\n          'document.documentElement.scrollTop'\n        )\n        await browser.elementByCss('#scroll-to-name-item-400-no-scroll').click()\n        expect(curScroll).toBe(\n          await browser.eval('document.documentElement.scrollTop')\n        )\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should scroll to the specified position on the same page with a name property","suites":["Client Navigation","with hash changes","when hash change via Link"],"updatePoint":{"line":660,"column":87},"line":660,"code":"      it('should scroll to the specified position on the same page with a name property', async () => {\n        let browser\n        try {\n          browser = await webdriver(context.appPort, '/nav/hash-changes')\n\n          // Scrolls to item 400 with name=\"name-item-400\" on the page\n          await browser.elementByCss('#scroll-to-name-item-400').click()\n\n          const scrollPosition = await browser.eval('window.pageYOffset')\n\n          expect(scrollPosition).toBe(16258)\n\n          // Scrolls back to top when scrolling to `#` with no value.\n          await browser.elementByCss('#via-empty-hash').click()\n\n          const scrollPositionAfterEmptyHash = await browser.eval(\n            'window.pageYOffset'\n          )\n\n          expect(scrollPositionAfterEmptyHash).toBe(0)\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should scroll to the specified position to a new page","suites":["Client Navigation","with hash changes","when hash change via Link"],"updatePoint":{"line":687,"column":63},"line":687,"code":"      it('should scroll to the specified position to a new page', async () => {\n        let browser\n        try {\n          browser = await webdriver(context.appPort, '/nav')\n\n          // Scrolls to item 400 on the page\n          await browser\n            .elementByCss('#scroll-to-hash')\n            .click()\n            .waitForElementByCss('#hash-changes-page')\n\n          const scrollPosition = await browser.eval('window.pageYOffset')\n          expect(scrollPosition).toBe(7258)\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should scroll to the specified CJK position to a new page","suites":["Client Navigation","with hash changes","when hash change via Link"],"updatePoint":{"line":707,"column":67},"line":707,"code":"      it('should scroll to the specified CJK position to a new page', async () => {\n        let browser\n        try {\n          browser = await webdriver(context.appPort, '/nav')\n\n          // Scrolls to CJK anchor on the page\n          await browser\n            .elementByCss('#scroll-to-cjk-hash')\n            .click()\n            .waitForElementByCss('#hash-changes-page')\n\n          const scrollPosition = await browser.eval('window.pageYOffset')\n          expect(scrollPosition).toBe(17436)\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"Should update asPath","suites":["Client Navigation","with hash changes","when hash change via Link"],"updatePoint":{"line":727,"column":30},"line":727,"code":"      it('Should update asPath', async () => {\n        let browser\n        try {\n          browser = await webdriver(context.appPort, '/nav/hash-changes')\n\n          await browser.elementByCss('#via-link').click()\n\n          const asPath = await browser.elementByCss('div#asPath').text()\n          expect(asPath).toBe('ASPATH: /nav/hash-changes#via-link')\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not run getInitialProps","suites":["Client Navigation","with hash changes","when hash change via A tag"],"updatePoint":{"line":745,"column":40},"line":745,"code":"      it('should not run getInitialProps', async () => {\n        const browser = await webdriver(context.appPort, '/nav/hash-changes')\n\n        const counter = await browser\n          .elementByCss('#via-a')\n          .click()\n          .elementByCss('p')\n          .text()\n\n        expect(counter).toBe('COUNT: 0')\n\n        await browser.close()\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not run getInitialProps","suites":["Client Navigation","with hash changes","when hash get removed"],"updatePoint":{"line":761,"column":40},"line":761,"code":"      it('should not run getInitialProps', async () => {\n        const browser = await webdriver(context.appPort, '/nav/hash-changes')\n\n        const counter = await browser\n          .elementByCss('#via-a')\n          .click()\n          .elementByCss('#page-url')\n          .click()\n          .elementByCss('p')\n          .text()\n\n        expect(counter).toBe('COUNT: 1')\n\n        await browser.close()\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not run getInitialProps when removing via back","suites":["Client Navigation","with hash changes","when hash get removed"],"updatePoint":{"line":777,"column":63},"line":777,"code":"      it('should not run getInitialProps when removing via back', async () => {\n        const browser = await webdriver(context.appPort, '/nav/hash-changes')\n\n        const counter = await browser\n          .elementByCss('#scroll-to-item-400')\n          .click()\n          .back()\n          .elementByCss('p')\n          .text()\n\n        expect(counter).toBe('COUNT: 0')\n        await browser.close()\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not run getInitialProps","suites":["Client Navigation","with hash changes","when hash set to empty"],"updatePoint":{"line":793,"column":40},"line":793,"code":"      it('should not run getInitialProps', async () => {\n        const browser = await webdriver(context.appPort, '/nav/hash-changes')\n\n        const counter = await browser\n          .elementByCss('#via-a')\n          .click()\n          .elementByCss('#via-empty-hash')\n          .click()\n          .elementByCss('p')\n          .text()\n\n        expect(counter).toBe('COUNT: 0')\n\n        await browser.close()\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should increment the history state counter","suites":["Client Navigation","with hash changes with state","when passing state via hash change"],"updatePoint":{"line":813,"column":52},"line":813,"code":"      it('should increment the history state counter', async () => {\n        const browser = await webdriver(\n          context.appPort,\n          '/nav/hash-changes-with-state#'\n        )\n\n        const historyCount = await browser\n          .elementByCss('#increment-history-count')\n          .click()\n          .elementByCss('#increment-history-count')\n          .click()\n          .elementByCss('div#history-count')\n          .text()\n\n        expect(historyCount).toBe('HISTORY COUNT: 2')\n\n        const counter = await browser.elementByCss('p').text()\n\n        // getInitialProps should not be called with only hash changes\n        expect(counter).toBe('COUNT: 0')\n\n        await browser.close()\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should increment the shallow history state counter","suites":["Client Navigation","with hash changes with state","when passing state via hash change"],"updatePoint":{"line":837,"column":60},"line":837,"code":"      it('should increment the shallow history state counter', async () => {\n        const browser = await webdriver(\n          context.appPort,\n          '/nav/hash-changes-with-state#'\n        )\n\n        const historyCount = await browser\n          .elementByCss('#increment-shallow-history-count')\n          .click()\n          .elementByCss('#increment-shallow-history-count')\n          .click()\n          .elementByCss('div#shallow-history-count')\n          .text()\n\n        expect(historyCount).toBe('SHALLOW HISTORY COUNT: 2')\n\n        const counter = await browser.elementByCss('p').text()\n\n        expect(counter).toBe('COUNT: 0')\n\n        await browser.close()\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should update the url without running getInitialProps","suites":["Client Navigation","with shallow routing"],"updatePoint":{"line":863,"column":61},"line":863,"code":"    it('should update the url without running getInitialProps', async () => {\n      const browser = await webdriver(context.appPort, '/nav/shallow-routing')\n      const counter = await browser\n        .elementByCss('#increase')\n        .click()\n        .elementByCss('#increase')\n        .click()\n        .elementByCss('#counter')\n        .text()\n      expect(counter).toBe('Counter: 2')\n\n      const getInitialPropsRunCount = await browser\n        .elementByCss('#get-initial-props-run-count')\n        .text()\n      expect(getInitialPropsRunCount).toBe('getInitialProps run count: 1')\n\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle the back button and should not run getInitialProps","suites":["Client Navigation","with shallow routing"],"updatePoint":{"line":882,"column":72},"line":882,"code":"    it('should handle the back button and should not run getInitialProps', async () => {\n      const browser = await webdriver(context.appPort, '/nav/shallow-routing')\n      let counter = await browser\n        .elementByCss('#increase')\n        .click()\n        .elementByCss('#increase')\n        .click()\n        .elementByCss('#counter')\n        .text()\n      expect(counter).toBe('Counter: 2')\n\n      counter = await browser.back().elementByCss('#counter').text()\n      expect(counter).toBe('Counter: 1')\n\n      const getInitialPropsRunCount = await browser\n        .elementByCss('#get-initial-props-run-count')\n        .text()\n      expect(getInitialPropsRunCount).toBe('getInitialProps run count: 1')\n\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should run getInitialProps always when rending the page to the screen","suites":["Client Navigation","with shallow routing"],"updatePoint":{"line":904,"column":77},"line":904,"code":"    it('should run getInitialProps always when rending the page to the screen', async () => {\n      const browser = await webdriver(context.appPort, '/nav/shallow-routing')\n\n      const counter = await browser\n        .elementByCss('#increase')\n        .click()\n        .elementByCss('#increase')\n        .click()\n        .elementByCss('#home-link')\n        .click()\n        .waitForElementByCss('.nav-home')\n        .back()\n        .waitForElementByCss('.shallow-routing')\n        .elementByCss('#counter')\n        .text()\n      expect(counter).toBe('Counter: 2')\n\n      const getInitialPropsRunCount = await browser\n        .elementByCss('#get-initial-props-run-count')\n        .text()\n      expect(getInitialPropsRunCount).toBe('getInitialProps run count: 2')\n\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should keep the scroll position on shallow routing","suites":["Client Navigation","with shallow routing"],"updatePoint":{"line":929,"column":58},"line":929,"code":"    it('should keep the scroll position on shallow routing', async () => {\n      const browser = await webdriver(context.appPort, '/nav/shallow-routing')\n      await browser.eval(() =>\n        document.querySelector('#increase').scrollIntoView()\n      )\n      const scrollPosition = await browser.eval('window.pageYOffset')\n\n      expect(scrollPosition).toBeGreaterThan(3000)\n\n      await browser.elementByCss('#increase').click()\n      await waitFor(500)\n      const newScrollPosition = await browser.eval('window.pageYOffset')\n\n      expect(newScrollPosition).toBe(scrollPosition)\n\n      await browser.elementByCss('#increase2').click()\n      await waitFor(500)\n      const newScrollPosition2 = await browser.eval('window.pageYOffset')\n\n      expect(newScrollPosition2).toBe(0)\n\n      await browser.eval(() =>\n        document.querySelector('#invalidShallow').scrollIntoView()\n      )\n      const scrollPositionDown = await browser.eval('window.pageYOffset')\n\n      expect(scrollPositionDown).toBeGreaterThan(3000)\n\n      await browser.elementByCss('#invalidShallow').click()\n      await waitFor(500)\n      const newScrollPosition3 = await browser.eval('window.pageYOffset')\n\n      expect(newScrollPosition3).toBe(0)\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should scroll to top when the scroll option is set to true","suites":["Client Navigation","with shallow routing"],"updatePoint":{"line":965,"column":64},"line":965,"code":"  it('should scroll to top when the scroll option is set to true', async () => {\n    const browser = await webdriver(context.appPort, '/nav/shallow-routing')\n    await browser.eval(() =>\n      document.querySelector('#increaseWithScroll').scrollIntoView()\n    )\n    const scrollPosition = await browser.eval('window.pageYOffset')\n\n    expect(scrollPosition).toBeGreaterThan(3000)\n\n    await browser.elementByCss('#increaseWithScroll').click()\n    await check(async () => {\n      const newScrollPosition = await browser.eval('window.pageYOffset')\n      return newScrollPosition === 0 ? 'success' : 'fail'\n    }, 'success')\n  })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with <Link/>","suites":["Client Navigation","with URL objects"],"updatePoint":{"line":982,"column":32},"line":982,"code":"    it('should work with <Link/>', async () => {\n      const browser = await webdriver(context.appPort, '/nav')\n      const text = await browser\n        .elementByCss('#query-string-link')\n        .click()\n        .waitForElementByCss('.nav-querystring')\n        .elementByCss('p')\n        .text()\n      expect(text).toBe('10')\n\n      expect(await browser.url()).toBe(\n        `http://localhost:${context.appPort}/nav/querystring/10#10`\n      )\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with \"Router.push\"","suites":["Client Navigation","with URL objects"],"updatePoint":{"line":998,"column":38},"line":998,"code":"    it('should work with \"Router.push\"', async () => {\n      const browser = await webdriver(context.appPort, '/nav')\n      const text = await browser\n        .elementByCss('#query-string-button')\n        .click()\n        .waitForElementByCss('.nav-querystring')\n        .elementByCss('p')\n        .text()\n      expect(text).toBe('10')\n\n      expect(await browser.url()).toBe(\n        `http://localhost:${context.appPort}/nav/querystring/10#10`\n      )\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with the \"replace\" prop","suites":["Client Navigation","with URL objects"],"updatePoint":{"line":1014,"column":43},"line":1014,"code":"    it('should work with the \"replace\" prop', async () => {\n      const browser = await webdriver(context.appPort, '/nav')\n\n      let stackLength = await browser.eval('window.history.length')\n\n      expect(stackLength).toBe(2)\n\n      // Navigation to /about using a replace link should maintain the url stack length\n      const text = await browser\n        .elementByCss('#about-replace-link')\n        .click()\n        .waitForElementByCss('.nav-about')\n        .elementByCss('p')\n        .text()\n\n      expect(text).toBe('This is the about page.')\n\n      stackLength = await browser.eval('window.history.length')\n\n      expect(stackLength).toBe(2)\n\n      // Going back to the home with a regular link will augment the history count\n      await browser\n        .elementByCss('#home-link')\n        .click()\n        .waitForElementByCss('.nav-home')\n\n      stackLength = await browser.eval('window.history.length')\n\n      expect(stackLength).toBe(3)\n\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle undefined in router.push","suites":["Client Navigation","with URL objects"],"updatePoint":{"line":1048,"column":46},"line":1048,"code":"    it('should handle undefined in router.push', async () => {\n      const browser = await webdriver(context.appPort, '/nav/query-params')\n      await browser.elementByCss('#click-me').click()\n      const query = JSON.parse(\n        await browser.waitForElementByCss('#query-value').text()\n      )\n      expect(query).toEqual({\n        param1: '',\n        param2: '',\n        param3: '',\n        param4: '0',\n        param5: 'false',\n        param7: '',\n        param8: '',\n        param9: '',\n        param10: '',\n        param11: ['', '', '', '0', 'false', '', '', '', '', ''],\n      })\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with Link","suites":["Client Navigation","with querystring relative urls"],"updatePoint":{"line":1070,"column":29},"line":1070,"code":"    it('should work with Link', async () => {\n      const browser = await webdriver(context.appPort, '/nav/query-only')\n      try {\n        await browser.elementByCss('#link').click()\n\n        await check(() => browser.waitForElementByCss('#prop').text(), 'foo')\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with router.push","suites":["Client Navigation","with querystring relative urls"],"updatePoint":{"line":1081,"column":36},"line":1081,"code":"    it('should work with router.push', async () => {\n      const browser = await webdriver(context.appPort, '/nav/query-only')\n      try {\n        await browser.elementByCss('#router-push').click()\n\n        await check(() => browser.waitForElementByCss('#prop').text(), 'bar')\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with router.replace","suites":["Client Navigation","with querystring relative urls"],"updatePoint":{"line":1092,"column":39},"line":1092,"code":"    it('should work with router.replace', async () => {\n      const browser = await webdriver(context.appPort, '/nav/query-only')\n      try {\n        await browser.elementByCss('#router-replace').click()\n\n        await check(() => browser.waitForElementByCss('#prop').text(), 'baz')\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should redirect the page via client side","suites":["Client Navigation","with getInitialProp redirect"],"updatePoint":{"line":1105,"column":48},"line":1105,"code":"    it('should redirect the page via client side', async () => {\n      const browser = await webdriver(context.appPort, '/nav')\n      const text = await browser\n        .elementByCss('#redirect-link')\n        .click()\n        .waitForElementByCss('.nav-about')\n        .elementByCss('p')\n        .text()\n\n      expect(text).toBe('This is the about page.')\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should redirect the page when loading","suites":["Client Navigation","with getInitialProp redirect"],"updatePoint":{"line":1118,"column":45},"line":1118,"code":"    it('should redirect the page when loading', async () => {\n      const browser = await webdriver(context.appPort, '/nav/redirect')\n      const text = await browser\n        .waitForElementByCss('.nav-about')\n        .elementByCss('p')\n        .text()\n\n      expect(text).toBe('This is the about page.')\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with normal page","suites":["Client Navigation","with different types of urls"],"updatePoint":{"line":1131,"column":36},"line":1131,"code":"    it('should work with normal page', async () => {\n      const browser = await webdriver(context.appPort, '/with-cdm')\n      const text = await browser.elementByCss('p').text()\n\n      expect(text).toBe('ComponentDidMount executed on client.')\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with dir/ page","suites":["Client Navigation","with different types of urls"],"updatePoint":{"line":1139,"column":34},"line":1139,"code":"    it('should work with dir/ page', async () => {\n      const browser = await webdriver(context.appPort, '/nested-cdm')\n      const text = await browser.elementByCss('p').text()\n\n      expect(text).toBe('ComponentDidMount executed on client.')\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not work with /index page","suites":["Client Navigation","with different types of urls"],"updatePoint":{"line":1147,"column":40},"line":1147,"code":"    it('should not work with /index page', async () => {\n      const browser = await webdriver(context.appPort, '/index')\n      expect(await browser.elementByCss('h1').text()).toBe('404')\n      expect(await browser.elementByCss('h2').text()).toBe(\n        'This page could not be found.'\n      )\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with / page","suites":["Client Navigation","with different types of urls"],"updatePoint":{"line":1156,"column":31},"line":1156,"code":"    it('should work with / page', async () => {\n      const browser = await webdriver(context.appPort, '/')\n      const text = await browser.elementByCss('p').text()\n\n      expect(text).toBe('ComponentDidMount executed on client.')\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate as expected","suites":["Client Navigation","with the HOC based router"],"updatePoint":{"line":1166,"column":35},"line":1166,"code":"    it('should navigate as expected', async () => {\n      const browser = await webdriver(context.appPort, '/nav/with-hoc')\n\n      const pathname = await browser.elementByCss('#pathname').text()\n      expect(pathname).toBe('Current path: /nav/with-hoc')\n\n      const asPath = await browser.elementByCss('#asPath').text()\n      expect(asPath).toBe('Current asPath: /nav/with-hoc')\n\n      const text = await browser\n        .elementByCss('.nav-with-hoc a')\n        .click()\n        .waitForElementByCss('.nav-home')\n        .elementByCss('p')\n        .text()\n\n      expect(text).toBe('This is the home.')\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show the correct asPath with a Link with as prop","suites":["Client Navigation","with asPath","inside getInitialProps"],"updatePoint":{"line":1189,"column":65},"line":1189,"code":"      it('should show the correct asPath with a Link with as prop', async () => {\n        const browser = await webdriver(context.appPort, '/nav')\n        const asPath = await browser\n          .elementByCss('#as-path-link')\n          .click()\n          .waitForElementByCss('.as-path-content')\n          .elementByCss('.as-path-content')\n          .text()\n\n        expect(asPath).toBe('/as/path')\n        await browser.close()\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show the correct asPath with a Link without the as prop","suites":["Client Navigation","with asPath","inside getInitialProps"],"updatePoint":{"line":1202,"column":72},"line":1202,"code":"      it('should show the correct asPath with a Link without the as prop', async () => {\n        const browser = await webdriver(context.appPort, '/nav')\n        const asPath = await browser\n          .elementByCss('#as-path-link-no-as')\n          .click()\n          .waitForElementByCss('.as-path-content')\n          .elementByCss('.as-path-content')\n          .text()\n\n        expect(asPath).toBe('/nav/as-path')\n        await browser.close()\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show the correct asPath","suites":["Client Navigation","with asPath","with next/router"],"updatePoint":{"line":1217,"column":40},"line":1217,"code":"      it('should show the correct asPath', async () => {\n        const browser = await webdriver(context.appPort, '/nav')\n        const asPath = await browser\n          .elementByCss('#as-path-using-router-link')\n          .click()\n          .waitForElementByCss('.as-path-content')\n          .elementByCss('.as-path-content')\n          .text()\n\n        expect(asPath).toBe('/nav/as-path-using-router')\n        await browser.close()\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate an absolute url on push","suites":["Client Navigation","with asPath","with next/router"],"updatePoint":{"line":1230,"column":49},"line":1230,"code":"      it('should navigate an absolute url on push', async () => {\n        const browser = await webdriver(\n          context.appPort,\n          `/absolute-url?port=${context.appPort}`\n        )\n        await browser.waitForElementByCss('#router-push').click()\n        await check(\n          () => browser.eval(() => window.location.origin),\n          'https://vercel.com'\n        )\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate an absolute url on replace","suites":["Client Navigation","with asPath","with next/router"],"updatePoint":{"line":1242,"column":52},"line":1242,"code":"      it('should navigate an absolute url on replace', async () => {\n        const browser = await webdriver(\n          context.appPort,\n          `/absolute-url?port=${context.appPort}`\n        )\n        await browser.waitForElementByCss('#router-replace').click()\n        await check(\n          () => browser.eval(() => window.location.origin),\n          'https://vercel.com'\n        )\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate an absolute local url on push","suites":["Client Navigation","with asPath","with next/router"],"updatePoint":{"line":1254,"column":55},"line":1254,"code":"      it('should navigate an absolute local url on push', async () => {\n        const browser = await webdriver(\n          context.appPort,\n          `/absolute-url?port=${context.appPort}`\n        )\n        await browser.eval(() => (window._didNotNavigate = true))\n        await browser.waitForElementByCss('#router-local-push').click()\n        const text = await browser\n          .waitForElementByCss('.nav-about')\n          .elementByCss('p')\n          .text()\n        expect(text).toBe('This is the about page.')\n        expect(await browser.eval(() => window._didNotNavigate)).toBe(true)\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate an absolute local url on replace","suites":["Client Navigation","with asPath","with next/router"],"updatePoint":{"line":1269,"column":58},"line":1269,"code":"      it('should navigate an absolute local url on replace', async () => {\n        const browser = await webdriver(\n          context.appPort,\n          `/absolute-url?port=${context.appPort}`\n        )\n        await browser.eval(() => (window._didNotNavigate = true))\n        await browser.waitForElementByCss('#router-local-replace').click()\n        const text = await browser\n          .waitForElementByCss('.nav-about')\n          .elementByCss('p')\n          .text()\n        expect(text).toBe('This is the about page.')\n        expect(await browser.eval(() => window._didNotNavigate)).toBe(true)\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should use pushState with same href and different asPath","suites":["Client Navigation","with asPath","with next/link"],"updatePoint":{"line":1286,"column":66},"line":1286,"code":"      it('should use pushState with same href and different asPath', async () => {\n        let browser\n        try {\n          browser = await webdriver(context.appPort, '/nav/as-path-pushstate')\n          await browser\n            .elementByCss('#hello')\n            .click()\n            .waitForElementByCss('#something-hello')\n          const queryOne = JSON.parse(\n            await browser.elementByCss('#router-query').text()\n          )\n          expect(queryOne.something).toBe('hello')\n          await browser\n            .elementByCss('#same-query')\n            .click()\n            .waitForElementByCss('#something-same-query')\n          const queryTwo = JSON.parse(\n            await browser.elementByCss('#router-query').text()\n          )\n          expect(queryTwo.something).toBe('hello')\n          await browser.back().waitForElementByCss('#something-hello')\n          const queryThree = JSON.parse(\n            await browser.elementByCss('#router-query').text()\n          )\n          expect(queryThree.something).toBe('hello')\n          await browser\n            .elementByCss('#else')\n            .click()\n            .waitForElementByCss('#something-else')\n          await browser\n            .elementByCss('#hello2')\n            .click()\n            .waitForElementByCss('#nav-as-path-pushstate')\n          await browser.back().waitForElementByCss('#something-else')\n          const queryFour = JSON.parse(\n            await browser.elementByCss('#router-query').text()\n          )\n          expect(queryFour.something).toBe(undefined)\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should detect asPath query changes correctly","suites":["Client Navigation","with asPath","with next/link"],"updatePoint":{"line":1331,"column":54},"line":1331,"code":"      it('should detect asPath query changes correctly', async () => {\n        let browser\n        try {\n          browser = await webdriver(context.appPort, '/nav/as-path-query')\n          await browser\n            .elementByCss('#hello')\n            .click()\n            .waitForElementByCss('#something-hello-something-hello')\n          const queryOne = JSON.parse(\n            await browser.elementByCss('#router-query').text()\n          )\n          expect(queryOne.something).toBe('hello')\n          await browser\n            .elementByCss('#hello2')\n            .click()\n            .waitForElementByCss('#something-hello-something-else')\n          const queryTwo = JSON.parse(\n            await browser.elementByCss('#router-query').text()\n          )\n          expect(queryTwo.something).toBe('else')\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show redbox when a client side error is thrown inside a component","suites":["Client Navigation","runtime errors"],"updatePoint":{"line":1361,"column":80},"line":1361,"code":"    it('should show redbox when a client side error is thrown inside a component', async () => {\n      let browser\n      try {\n        browser = await webdriver(context.appPort, '/error-inside-browser-page')\n        expect(await hasRedbox(browser)).toBe(true)\n        const text = await getRedboxSource(browser)\n        expect(text).toMatch(/An Expected error occurred/)\n        expect(text).toMatch(/pages[\\\\/]error-inside-browser-page\\.js \\(5:12\\)/)\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show redbox when a client side error is thrown outside a component","suites":["Client Navigation","runtime errors"],"updatePoint":{"line":1376,"column":81},"line":1376,"code":"    it('should show redbox when a client side error is thrown outside a component', async () => {\n      let browser\n      try {\n        browser = await webdriver(\n          context.appPort,\n          '/error-in-the-browser-global-scope'\n        )\n        expect(await hasRedbox(browser)).toBe(true)\n        const text = await getRedboxSource(browser)\n        expect(text).toMatch(/An Expected error occurred/)\n        expect(text).toMatch(/error-in-the-browser-global-scope\\.js \\(2:8\\)/)\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should 404 on not existent page","suites":["Client Navigation","with 404 pages"],"updatePoint":{"line":1396,"column":39},"line":1396,"code":"    it('should 404 on not existent page', async () => {\n      const browser = await webdriver(context.appPort, '/non-existent')\n      expect(await browser.elementByCss('h1').text()).toBe('404')\n      expect(await browser.elementByCss('h2').text()).toBe(\n        'This page could not be found.'\n      )\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should 404 on wrong casing","suites":["Client Navigation","with 404 pages"],"updatePoint":{"line":1405,"column":34},"line":1405,"code":"    it('should 404 on wrong casing', async () => {\n      const browser = await webdriver(context.appPort, '/nAv/AbOuT')\n      expect(await browser.elementByCss('h1').text()).toBe('404')\n      expect(await browser.elementByCss('h2').text()).toBe(\n        'This page could not be found.'\n      )\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should get url dynamic param","suites":["Client Navigation","with 404 pages"],"updatePoint":{"line":1414,"column":36},"line":1414,"code":"    it('should get url dynamic param', async () => {\n      const browser = await webdriver(\n        context.appPort,\n        '/dynamic/dynamic-part/route'\n      )\n      expect(await browser.elementByCss('p').text()).toBe('dynamic-part')\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should 404 on wrong casing of url dynamic param","suites":["Client Navigation","with 404 pages"],"updatePoint":{"line":1423,"column":55},"line":1423,"code":"    it('should 404 on wrong casing of url dynamic param', async () => {\n      const browser = await webdriver(\n        context.appPort,\n        '/dynamic/dynamic-part/RoUtE'\n      )\n      expect(await browser.elementByCss('h1').text()).toBe('404')\n      expect(await browser.elementByCss('h2').text()).toBe(\n        'This page could not be found.'\n      )\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not 404 for <page>/","suites":["Client Navigation","with 404 pages"],"updatePoint":{"line":1435,"column":34},"line":1435,"code":"    it('should not 404 for <page>/', async () => {\n      const browser = await webdriver(context.appPort, '/nav/about/')\n      const text = await browser.elementByCss('p').text()\n      expect(text).toBe('This is the about page.')\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should should not contain a page script in a 404 page","suites":["Client Navigation","with 404 pages"],"updatePoint":{"line":1442,"column":61},"line":1442,"code":"    it('should should not contain a page script in a 404 page', async () => {\n      const browser = await webdriver(context.appPort, '/non-existent')\n      const scripts = await browser.elementsByCss('script[src]')\n      for (const script of scripts) {\n        const src = await script.getAttribute('src')\n        expect(src.includes('/non-existent')).toBeFalsy()\n      }\n      await browser.close()\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should only execute async and defer scripts once","suites":["Client Navigation","updating head while client routing"],"updatePoint":{"line":1454,"column":56},"line":1454,"code":"    it('should only execute async and defer scripts once', async () => {\n      let browser\n      try {\n        browser = await webdriver(context.appPort, '/head')\n\n        await browser.waitForElementByCss('h1')\n        await waitFor(2000)\n        expect(\n          Number(await browser.eval('window.__test_async_executions'))\n        ).toBe(1)\n        expect(\n          Number(await browser.eval('window.__test_defer_executions'))\n        ).toBe(1)\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should warn when stylesheets or scripts are in head","suites":["Client Navigation","updating head while client routing"],"updatePoint":{"line":1474,"column":59},"line":1474,"code":"    it('should warn when stylesheets or scripts are in head', async () => {\n      let browser\n      try {\n        browser = await webdriver(context.appPort, '/head')\n\n        await browser.waitForElementByCss('h1')\n        await waitFor(1000)\n        const browserLogs = await browser.log('browser')\n        let foundStyles = false\n        let foundScripts = false\n        const logs = []\n        browserLogs.forEach(({ message }) => {\n          if (message.includes('Do not add stylesheets using next/head')) {\n            foundStyles = true\n            logs.push(message)\n          }\n          if (message.includes('Do not add <script> tags using next/head')) {\n            foundScripts = true\n            logs.push(message)\n          }\n        })\n\n        expect(foundStyles).toEqual(true)\n        expect(foundScripts).toEqual(true)\n\n        // Warnings are unique\n        expect(logs.length).toEqual(new Set(logs).size)\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should warn when scripts are in head","suites":["Client Navigation","updating head while client routing"],"updatePoint":{"line":1508,"column":44},"line":1508,"code":"    it('should warn when scripts are in head', async () => {\n      let browser\n      try {\n        browser = await webdriver(context.appPort, '/head')\n        await browser.waitForElementByCss('h1')\n        await waitFor(1000)\n        const browserLogs = await browser.log('browser')\n        let found = false\n        browserLogs.forEach((log) => {\n          if (log.message.includes('Use next/script instead')) {\n            found = true\n          }\n        })\n        expect(found).toEqual(true)\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not warn when application/ld+json scripts are in head","suites":["Client Navigation","updating head while client routing"],"updatePoint":{"line":1529,"column":68},"line":1529,"code":"    it('should not warn when application/ld+json scripts are in head', async () => {\n      let browser\n      try {\n        browser = await webdriver(context.appPort, '/head-with-json-ld-snippet')\n        await browser.waitForElementByCss('h1')\n        await waitFor(1000)\n        const browserLogs = await browser.log('browser')\n        let found = false\n        browserLogs.forEach((log) => {\n          if (log.message.includes('Use next/script instead')) {\n            found = true\n          }\n        })\n        expect(found).toEqual(false)\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should update head during client routing","suites":["Client Navigation","updating head while client routing"],"updatePoint":{"line":1550,"column":48},"line":1550,"code":"    it('should update head during client routing', async () => {\n      let browser\n      try {\n        browser = await webdriver(context.appPort, '/nav/head-1')\n        expect(\n          await browser\n            .elementByCss('meta[name=\"description\"]')\n            .getAttribute('content')\n        ).toBe('Head One')\n\n        await browser\n          .elementByCss('#to-head-2')\n          .click()\n          .waitForElementByCss('#head-2', 3000)\n        expect(\n          await browser\n            .elementByCss('meta[name=\"description\"]')\n            .getAttribute('content')\n        ).toBe('Head Two')\n\n        await browser\n          .elementByCss('#to-head-1')\n          .click()\n          .waitForElementByCss('#head-1', 3000)\n        expect(\n          await browser\n            .elementByCss('meta[name=\"description\"]')\n            .getAttribute('content')\n        ).toBe('Head One')\n\n        await browser\n          .elementByCss('#to-head-3')\n          .click()\n          .waitForElementByCss('#head-3', 3000)\n        expect(\n          await browser\n            .elementByCss('meta[name=\"description\"]')\n            .getAttribute('content')\n        ).toBe('Head Three')\n        expect(await browser.eval('document.title')).toBe('')\n\n        await browser\n          .elementByCss('#to-head-1')\n          .click()\n          .waitForElementByCss('#head-1', 3000)\n        expect(\n          await browser\n            .elementByCss('meta[name=\"description\"]')\n            .getAttribute('content')\n        ).toBe('Head One')\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should update title during client routing","suites":["Client Navigation","updating head while client routing"],"updatePoint":{"line":1607,"column":49},"line":1607,"code":"    it('should update title during client routing', async () => {\n      let browser\n      try {\n        browser = await webdriver(context.appPort, '/nav/head-1')\n        expect(await browser.eval('document.title')).toBe('this is head-1')\n\n        await browser\n          .elementByCss('#to-head-2')\n          .click()\n          .waitForElementByCss('#head-2', 3000)\n        expect(await browser.eval('document.title')).toBe('this is head-2')\n\n        await browser\n          .elementByCss('#to-head-1')\n          .click()\n          .waitForElementByCss('#head-1', 3000)\n        expect(await browser.eval('document.title')).toBe('this is head-1')\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should update head when unmounting component","suites":["Client Navigation","updating head while client routing"],"updatePoint":{"line":1631,"column":52},"line":1631,"code":"    it('should update head when unmounting component', async () => {\n      let browser\n      try {\n        browser = await webdriver(context.appPort, '/head-dynamic')\n        expect(await browser.eval('document.title')).toBe('B')\n        await browser.elementByCss('button').click()\n        expect(await browser.eval('document.title')).toBe('A')\n        await browser.elementByCss('button').click()\n        expect(await browser.eval('document.title')).toBe('B')\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should ignore history state without options","suites":["Client Navigation","foreign history manipulation"],"updatePoint":{"line":1649,"column":51},"line":1649,"code":"    it('should ignore history state without options', async () => {\n      let browser\n      try {\n        browser = await webdriver(context.appPort, '/nav')\n        // push history object without options\n        await browser.eval(\n          'window.history.pushState({ url: \"/whatever\" }, \"\", \"/whatever\")'\n        )\n        await browser.elementByCss('#about-link').click()\n        await browser.waitForElementByCss('.nav-about')\n        await browser.back()\n        await waitFor(1000)\n        expect(await hasRedbox(browser)).toBe(false)\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should ignore history state with an invalid url","suites":["Client Navigation","foreign history manipulation"],"updatePoint":{"line":1669,"column":55},"line":1669,"code":"    it('should ignore history state with an invalid url', async () => {\n      let browser\n      try {\n        browser = await webdriver(context.appPort, '/nav')\n        // push history object wit invalid url (not relative)\n        await browser.eval(\n          'window.history.pushState({ url: \"http://google.com\" }, \"\", \"/whatever\")'\n        )\n        await browser.elementByCss('#about-link').click()\n        await browser.waitForElementByCss('.nav-about')\n        await browser.back()\n        await waitFor(1000)\n        expect(await hasRedbox(browser)).toBe(false)\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should ignore foreign history state with missing properties","suites":["Client Navigation","foreign history manipulation"],"updatePoint":{"line":1689,"column":67},"line":1689,"code":"    it('should ignore foreign history state with missing properties', async () => {\n      let browser\n      try {\n        browser = await webdriver(context.appPort, '/nav')\n        // push empty history state\n        await browser.eval('window.history.pushState({}, \"\", \"/whatever\")')\n        await browser.elementByCss('#about-link').click()\n        await browser.waitForElementByCss('.nav-about')\n        await browser.back()\n        await waitFor(1000)\n        expect(await hasRedbox(browser)).toBe(false)\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not error on module.exports + polyfills","suites":["Client Navigation","foreign history manipulation"],"updatePoint":{"line":1708,"column":52},"line":1708,"code":"  it('should not error on module.exports + polyfills', async () => {\n    let browser\n    try {\n      browser = await webdriver(context.appPort, '/read-only-object-error')\n      expect(await browser.elementByCss('body').text()).toBe(\n        'this is just a placeholder component'\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work on nested /index/index.js","suites":["Client Navigation","foreign history manipulation"],"updatePoint":{"line":1722,"column":43},"line":1722,"code":"  it('should work on nested /index/index.js', async () => {\n    const browser = await webdriver(context.appPort, '/nested-index/index')\n    expect(await browser.elementByCss('p').text()).toBe(\n      'This is an index.js nested in an index/ folder.'\n    )\n    await browser.close()\n  })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle undefined prop in head client-side","suites":["Client Navigation","foreign history manipulation"],"updatePoint":{"line":1730,"column":54},"line":1730,"code":"  it('should handle undefined prop in head client-side', async () => {\n    const browser = await webdriver(context.appPort, '/head')\n    const value = await browser.eval(\n      `document.querySelector('meta[name=\"empty-content\"]').hasAttribute('content')`\n    )\n\n    expect(value).toBe(false)\n  })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should emit routeChangeError on hash change cancel","suites":["Client Navigation","foreign history manipulation"],"updatePoint":{"line":1739,"column":56},"line":1739,"code":"  it('should emit routeChangeError on hash change cancel', async () => {\n    const browser = await webdriver(context.appPort, '/')\n\n    await browser.eval(`(function() {\n      window.routeErrors = []\n      \n      window.next.router.events.on('routeChangeError', function (err) {\n        window.routeErrors.push(err)\n      })\n      window.next.router.push('#first')\n      window.next.router.push('#second')\n      window.next.router.push('#third')\n    })()`)\n\n    await check(async () => {\n      const errorCount = await browser.eval('window.routeErrors.length')\n      return errorCount > 0 ? 'success' : errorCount\n    }, 'success')\n  })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate to paths relative to the current page","suites":["Client Navigation","foreign history manipulation"],"updatePoint":{"line":1759,"column":59},"line":1759,"code":"  it('should navigate to paths relative to the current page', async () => {\n    const browser = await webdriver(context.appPort, '/nav/relative')\n    let page\n\n    await browser.elementByCss('a').click()\n\n    browser.waitForElementByCss('#relative-1')\n    page = await browser.elementByCss('body').text()\n    expect(page).toMatch(/On relative 1/)\n    await browser.elementByCss('a').click()\n\n    browser.waitForElementByCss('#relative-2')\n    page = await browser.elementByCss('body').text()\n    expect(page).toMatch(/On relative 2/)\n\n    await browser.elementByCss('button').click()\n    browser.waitForElementByCss('#relative')\n    page = await browser.elementByCss('body').text()\n    expect(page).toMatch(/On relative index/)\n\n    await browser.close()\n  })","file":"integration/client-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not shallowly navigate back in history when current page was not shallow","suites":[],"updatePoint":{"line":20,"column":85},"line":20,"code":"  it('should not shallowly navigate back in history when current page was not shallow', async () => {\n    const browser = await webdriver(appPort, '/first')\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props.params).toEqual({ slug: 'first' })\n\n    await browser.elementByCss('#add-query-shallow').click()\n    await waitFor(1000)\n\n    const props2 = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props2).toEqual(props)\n\n    await browser.elementByCss('#remove-query-shallow').click()\n    await waitFor(1000)\n\n    const props3 = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props3).toEqual(props)\n\n    await browser.elementByCss('#to-another').click()\n    await waitFor(1000)\n\n    await check(() => browser.elementByCss('#props').text(), /another/)\n\n    const props4 = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props4.params).toEqual({ slug: 'another' })\n    expect(props4.random).not.toBe(props.random)\n\n    await browser.back()\n    await waitFor(1000)\n\n    const props5 = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props5.params).toEqual({ slug: 'first' })\n    expect(props5.random).not.toBe(props4.random)\n  })","file":"integration/client-shallow-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not shallowly navigate forwards in history when current page was not shallow","suites":[],"updatePoint":{"line":55,"column":89},"line":55,"code":"  it('should not shallowly navigate forwards in history when current page was not shallow', async () => {\n    const browser = await webdriver(appPort, '/first')\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props.params).toEqual({ slug: 'first' })\n\n    await browser.elementByCss('#add-query-shallow').click()\n    await waitFor(1000)\n\n    const props2 = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props2).toEqual(props)\n\n    await browser.elementByCss('#to-another').click()\n    await waitFor(1000)\n\n    const props3 = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props3.params).toEqual({ slug: 'another' })\n    expect(props3.random).not.toBe(props2.random)\n\n    await browser.back()\n    await waitFor(1000)\n\n    const props4 = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props4.params).toEqual({ slug: 'first' })\n    expect(props4.random).not.toBe(props3.random)\n\n    await browser.forward()\n    await waitFor(1000)\n\n    const props5 = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props5.params).toEqual({ slug: 'another' })\n    expect(props5.random).not.toBe(props4.random)\n  })","file":"integration/client-shallow-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should compress responses by default","suites":["Compression"],"updatePoint":{"line":24,"column":42},"line":24,"code":"  it('should compress responses by default', async () => {\n    const res = await fetchViaHTTP(context.appPort, '/')\n\n    expect(res.headers.get('content-encoding')).toMatch(/gzip/)\n  })","file":"integration/compression/test/index.test.js","skipped":false,"dir":"test"},{"name":"should warn and revert when a devtool is set in development mode","suites":["devtool set in development mode in next config"],"updatePoint":{"line":17,"column":70},"line":17,"code":"  it('should warn and revert when a devtool is set in development mode', async () => {\n    let stderr = ''\n\n    const appPort = await findPort()\n    const app = await launchApp(appDir, appPort, {\n      env: { __NEXT_TEST_WITH_DEVTOOL: true },\n      onStderr(msg) {\n        stderr += msg || ''\n      },\n    })\n\n    const found = await check(\n      () => stderr,\n      /Reverting webpack devtool to /,\n      false\n    )\n\n    const browser = await webdriver(appPort, '/')\n    expect(await hasRedbox(browser)).toBe(true)\n    if (process.platform === 'win32') {\n      // TODO: add win32 snapshot\n    } else {\n      expect(await getRedboxSource(browser)).toMatchInlineSnapshot(`\n\"pages/index.js (5:10) @ eval\n\n  3 | export default function Index(props) {\n  4 | useEffect(() => {\n> 5 |   throw new Error('this should render')\n    |        ^\n  6 | }, [])\n  7 | return <div>Index Page</div>\n  8 | }\"\n`)\n    }\n    await browser.close()\n\n    await killApp(app)\n    expect(found).toBeTruthy()\n  })","file":"integration/config-devtool-dev/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show relevant warning and compile successfully for next build","suites":["Empty configuration"],"updatePoint":{"line":15,"column":74},"line":15,"code":"  it('should show relevant warning and compile successfully for next build', async () => {\n    const { stderr, stdout } = await nextBuild(appDir, [], {\n      stderr: true,\n      stdout: true,\n    })\n    expect(stdout).toMatch(/Compiled successfully/)\n    expect(stderr).toMatch(\n      /Detected next\\.config\\.js, no exported configuration found\\. https:\\/\\//\n    )\n  })","file":"integration/config-empty/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show relevant warning and compile successfully for next dev","suites":["Empty configuration"],"updatePoint":{"line":26,"column":72},"line":26,"code":"  it('should show relevant warning and compile successfully for next dev', async () => {\n    let stderr = ''\n\n    const appPort = await findPort()\n    const app = await launchApp(appDir, appPort, {\n      onStderr(msg) {\n        stderr += msg || ''\n      },\n    })\n    await waitFor(1000)\n    await killApp(app)\n\n    expect(stderr).toMatch(\n      /Detected next\\.config\\.js, no exported configuration found\\. https:\\/\\//\n    )\n  })","file":"integration/config-empty/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show warning with default config from function","suites":["Config Experimental Warning"],"updatePoint":{"line":18,"column":63},"line":18,"code":"  it('should not show warning with default config from function', async () => {\n    configFile.write(`\n      module.exports = (phase, { defaultConfig }) => {\n        return {\n          target: 'server',\n          ...defaultConfig,\n        }\n      }\n    `)\n\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n    expect(stderr).not.toMatch('You have enabled experimental feature')\n  })","file":"integration/config-experimental-warning/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show warning with config from object","suites":["Config Experimental Warning"],"updatePoint":{"line":32,"column":53},"line":32,"code":"  it('should not show warning with config from object', async () => {\n    configFile.write(`\n      module.exports = {\n        target: 'server'\n      }\n    `)\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n    expect(stderr).not.toMatch('You have enabled experimental feature')\n  })","file":"integration/config-experimental-warning/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show warning with config from object with experimental","suites":["Config Experimental Warning"],"updatePoint":{"line":42,"column":67},"line":42,"code":"  it('should show warning with config from object with experimental', async () => {\n    configFile.write(`\n      module.exports = {\n        target: 'server',\n        experimental: {\n          newNextLinkBehavior: true\n        }\n      }\n    `)\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n    expect(stderr).toMatch(\n      'You have enabled experimental feature (newNextLinkBehavior) in next.config.js.'\n    )\n  })","file":"integration/config-experimental-warning/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show warning with config from function with experimental","suites":["Config Experimental Warning"],"updatePoint":{"line":57,"column":69},"line":57,"code":"  it('should show warning with config from function with experimental', async () => {\n    configFile.write(`\n      module.exports = (phase) => ({\n        target: 'server',\n        experimental: {\n          newNextLinkBehavior: true\n        }\n      })\n    `)\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n    expect(stderr).toMatch(\n      'You have enabled experimental feature (newNextLinkBehavior) in next.config.js.'\n    )\n  })","file":"integration/config-experimental-warning/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show warning with default value","suites":["Config Experimental Warning"],"updatePoint":{"line":72,"column":48},"line":72,"code":"  it('should not show warning with default value', async () => {\n    configFile.write(`\n      module.exports = (phase) => ({\n        target: 'server',\n        experimental: {\n          newNextLinkBehavior: false\n        }\n      })\n    `)\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n    expect(stderr).not.toMatch(\n      'You have enabled experimental feature (newNextLinkBehavior) in next.config.js.'\n    )\n  })","file":"integration/config-experimental-warning/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show warning with config from object with experimental and multiple keys","suites":["Config Experimental Warning"],"updatePoint":{"line":87,"column":85},"line":87,"code":"  it('should show warning with config from object with experimental and multiple keys', async () => {\n    configFile.write(`\n      module.exports = {\n        experimental: {\n          newNextLinkBehavior: true,\n          legacyBrowsers: false,\n        }\n      }\n    `)\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n    expect(stderr).toMatch(\n      'You have enabled experimental features (newNextLinkBehavior, legacyBrowsers) in next.config.js.'\n    )\n  })","file":"integration/config-experimental-warning/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show warning with next.config.mjs from object with experimental","suites":["Config Experimental Warning"],"updatePoint":{"line":102,"column":76},"line":102,"code":"  it('should show warning with next.config.mjs from object with experimental', async () => {\n    configFileMjs.write(`\n      const config = {\n        experimental: {\n          newNextLinkBehavior: true,\n        }\n      }\n      export default config\n    `)\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n    expect(stderr).toMatch(\n      'You have enabled experimental feature (newNextLinkBehavior) in next.config.mjs.'\n    )\n  })","file":"integration/config-experimental-warning/test/index.test.js","skipped":false,"dir":"test"},{"name":"should disable X-Powered-By header support","suites":["Configuration"],"updatePoint":{"line":45,"column":48},"line":45,"code":"  it('should disable X-Powered-By header support', async () => {\n    const url = `http://localhost:${context.appPort}/`\n    const header = (await fetch(url)).headers.get('X-Powered-By')\n    expect(header).not.toBe('Next.js')\n  })","file":"integration/config-mjs/test/index.test.js","skipped":false,"dir":"test"},{"name":"renders server config on the server only","suites":["Configuration"],"updatePoint":{"line":51,"column":48},"line":51,"code":"  test('renders server config on the server only', async () => {\n    const $ = await get$('/next-config')\n    expect($('#server-only').text()).toBe('secret')\n  })","file":"integration/config-mjs/test/index.test.js","skipped":false,"dir":"test"},{"name":"renders public config on the server only","suites":["Configuration"],"updatePoint":{"line":56,"column":48},"line":56,"code":"  test('renders public config on the server only', async () => {\n    const $ = await get$('/next-config')\n    expect($('#server-and-client').text()).toBe('/static')\n  })","file":"integration/config-mjs/test/index.test.js","skipped":false,"dir":"test"},{"name":"renders the build id in development mode","suites":["Configuration"],"updatePoint":{"line":61,"column":48},"line":61,"code":"  test('renders the build id in development mode', async () => {\n    const $ = await get$('/build-id')\n    expect($('#buildId').text()).toBe('development')\n  })","file":"integration/config-mjs/test/index.test.js","skipped":false,"dir":"test"},{"name":"correctly imports a package that defines `module` but no `main` in package.json","suites":["Configuration"],"updatePoint":{"line":66,"column":87},"line":66,"code":"  test('correctly imports a package that defines `module` but no `main` in package.json', async () => {\n    const $ = await get$('/module-only-content')\n    expect($('#messageInAPackage').text()).toBe('OK')\n  })","file":"integration/config-mjs/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have config available on the client","suites":["Configuration"],"updatePoint":{"line":71,"column":48},"line":71,"code":"  it('should have config available on the client', async () => {\n    const browser = await webdriver(context.appPort, '/next-config')\n\n    const serverText = await browser.elementByCss('#server-only').text()\n    const serverClientText = await browser\n      .elementByCss('#server-and-client')\n      .text()\n    const envValue = await browser.elementByCss('#env').text()\n\n    expect(serverText).toBe('')\n    expect(serverClientText).toBe('/static')\n    expect(envValue).toBe('hello')\n    await browser.close()\n  })","file":"integration/config-mjs/test/index.test.js","skipped":false,"dir":"test"},{"name":"should warn when a promise is returned on webpack","suites":["Promise in next config"],"updatePoint":{"line":12,"column":55},"line":12,"code":"  it('should warn when a promise is returned on webpack', async () => {\n    fs.writeFile(\n      join(appDir, 'next.config.js'),\n      `\n      module.exports = (phase, { isServer }) => {\n        return {\n          webpack: async (config) => {\n            return config\n          }\n        }\n      }\n    `\n    )\n\n    const { stderr, stdout } = await nextBuild(appDir, undefined, {\n      stderr: true,\n      stdout: true,\n    })\n    expect(stderr + stdout).toMatch(\n      /> Promise returned in next config\\. https:\\/\\//\n    )\n  })","file":"integration/config-promise-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show relevant error when webpack resolve alias is wrong","suites":["Invalid resolve alias"],"updatePoint":{"line":7,"column":68},"line":7,"code":"  it('should show relevant error when webpack resolve alias is wrong', async () => {\n    const { stderr } = await runNextCommand(['build', join(__dirname, '..')], {\n      stderr: true,\n    })\n\n    expect(stderr).toMatch(\n      'webpack config.resolve.alias was incorrectly overridden. https://'\n    )\n  })","file":"integration/config-resolve-alias/test/index.test.js","skipped":false,"dir":"test"},{"name":"should error when next.config.js contains syntax error","suites":["Invalid config syntax"],"updatePoint":{"line":11,"column":60},"line":11,"code":"  it('should error when next.config.js contains syntax error', async () => {\n    await fs.writeFile(\n      nextConfigJS,\n      `\n      module.exports = {\n        reactStrictMode: true,,\n      }\n    `\n    )\n    const { stderr } = await nextBuild(appDir, undefined, {\n      stderr: true,\n    })\n    await fs.remove(nextConfigJS)\n\n    expect(stderr).toContain(\n      'error - Failed to load next.config.js, see more info here https://nextjs.org/docs/messages/next-config-error'\n    )\n    expect(stderr).toContain('SyntaxError')\n  })","file":"integration/config-syntax-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should error when next.config.mjs contains syntax error","suites":["Invalid config syntax"],"updatePoint":{"line":31,"column":61},"line":31,"code":"  it('should error when next.config.mjs contains syntax error', async () => {\n    await fs.writeFile(\n      nextConfigMJS,\n      `\n      const config = {\n        reactStrictMode: true,,\n      }\n      export default config\n    `\n    )\n    const { stderr } = await nextBuild(appDir, undefined, {\n      stderr: true,\n    })\n    await fs.remove(nextConfigMJS)\n\n    expect(stderr).toContain(\n      'error - Failed to load next.config.mjs, see more info here https://nextjs.org/docs/messages/next-config-error'\n    )\n    expect(stderr).toContain('SyntaxError')\n  })","file":"integration/config-syntax-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"it should validate correctly for $name","suites":["next.config.js validation"],"line":8,"code":"  it.each([\n    {\n      name: 'invalid config types',\n      configContent: `\n        module.exports = {\n          swcMinify: 'hello',\n          rewrites: true,\n          images: {\n            loader: 'something'\n          }\n        }\n      `,\n      outputs: [\n        'The value at .images.loader must be one of',\n        'The value at .rewrites must be a function that returns a Promise',\n        'The value at .swcMinify must be a boolean but it was a string',\n      ],\n    },\n    {\n      name: 'unexpected config fields',\n      configContent: `\n        module.exports = {\n          nonExistent: true,\n          experimental: {\n            anotherNonExistent: true\n          }\n        }\n      `,\n      outputs: [\n        'The root value has an unexpected property, nonExistent,',\n        'The value at .experimental has an unexpected property, anotherNonExistent',\n      ],\n    },\n  ])(\n    'it should validate correctly for $name',\n    async ({ outputs, configContent }) => {\n      await fs.writeFile(nextConfigPath, configContent)\n      const result = await nextBuild(path.join(__dirname, '../'), undefined, {\n        stderr: true,\n        stdout: true,\n      })\n      await fs.remove(nextConfigPath)\n\n      for (const output of outputs) {\n        expect(result.stdout + result.stderr).toContain(output)\n      }\n    }\n  )","file":"integration/config-validation/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should disable X-Powered-By header support","suites":["Configuration"],"updatePoint":{"line":45,"column":48},"line":45,"code":"  it('should disable X-Powered-By header support', async () => {\n    const url = `http://localhost:${context.appPort}/`\n    const header = (await fetch(url)).headers.get('X-Powered-By')\n    expect(header).not.toBe('Next.js')\n  })","file":"integration/config/test/index.test.js","skipped":false,"dir":"test"},{"name":"renders server config on the server only","suites":["Configuration"],"updatePoint":{"line":51,"column":48},"line":51,"code":"  test('renders server config on the server only', async () => {\n    const $ = await get$('/next-config')\n    expect($('#server-only').text()).toBe('secret')\n  })","file":"integration/config/test/index.test.js","skipped":false,"dir":"test"},{"name":"renders public config on the server only","suites":["Configuration"],"updatePoint":{"line":56,"column":48},"line":56,"code":"  test('renders public config on the server only', async () => {\n    const $ = await get$('/next-config')\n    expect($('#server-and-client').text()).toBe('/static')\n  })","file":"integration/config/test/index.test.js","skipped":false,"dir":"test"},{"name":"renders the build id in development mode","suites":["Configuration"],"updatePoint":{"line":61,"column":48},"line":61,"code":"  test('renders the build id in development mode', async () => {\n    const $ = await get$('/build-id')\n    expect($('#buildId').text()).toBe('development')\n  })","file":"integration/config/test/index.test.js","skipped":false,"dir":"test"},{"name":"correctly imports a package that defines `module` but no `main` in package.json","suites":["Configuration"],"updatePoint":{"line":66,"column":87},"line":66,"code":"  test('correctly imports a package that defines `module` but no `main` in package.json', async () => {\n    const $ = await get$('/module-only-content')\n    expect($('#messageInAPackage').text()).toBe('OK')\n  })","file":"integration/config/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have config available on the client","suites":["Configuration"],"updatePoint":{"line":71,"column":48},"line":71,"code":"  it('should have config available on the client', async () => {\n    const browser = await webdriver(context.appPort, '/next-config')\n\n    const serverText = await browser.elementByCss('#server-only').text()\n    const serverClientText = await browser\n      .elementByCss('#server-and-client')\n      .text()\n    const envValue = await browser.elementByCss('#env').text()\n\n    expect(serverText).toBe('')\n    expect(serverClientText).toBe('/static')\n    expect(envValue).toBe('hello')\n    await browser.close()\n  })","file":"integration/config/test/index.test.js","skipped":false,"dir":"test"},{"name":"Throws error during development","suites":["Errors on conflict between public file and page file"],"updatePoint":{"line":15,"column":37},"line":15,"code":"  it('Throws error during development', async () => {\n    const appPort = await findPort()\n    const app = await launchApp(appDir, appPort)\n    const conflicts = ['/another/conflict', '/hello']\n\n    for (const conflict of conflicts) {\n      const html = await renderViaHTTP(appPort, conflict)\n      expect(html).toMatch(\n        /A conflicting public file and page file was found for path/\n      )\n    }\n    await killApp(app)\n  })","file":"integration/conflicting-public-file-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"Throws error during build","suites":["Errors on conflict between public file and page file"],"updatePoint":{"line":29,"column":31},"line":29,"code":"  it('Throws error during build', async () => {\n    const conflicts = ['/another/conflict', '/another', '/hello']\n    const results = await nextBuild(appDir, [], { stdout: true, stderr: true })\n    const output = results.stdout + results.stderr\n    expect(output).toMatch(/Conflicting public and page files were found/)\n\n    for (const conflict of conflicts) {\n      expect(output.indexOf(conflict) > 0).toBe(true)\n    }\n  })","file":"integration/conflicting-public-file-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show proper error when two dynamic SSG routes have conflicting paths","suites":["Conflicting SSG paths"],"updatePoint":{"line":13,"column":81},"line":13,"code":"  it('should show proper error when two dynamic SSG routes have conflicting paths', async () => {\n    await fs.ensureDir(join(pagesDir, 'blog'))\n    await fs.writeFile(\n      join(pagesDir, 'blog/[slug].js'),\n      `\n      export const getStaticProps = () => {\n        return {\n          props: {}\n        }\n      }\n\n      export const getStaticPaths = () => {\n        return {\n          paths: [\n            '/blog/conflicting',\n            '/blog/first'\n          ],\n          fallback: false\n        }\n      }\n\n      export default function Page() {\n        return '/blog/[slug]'\n      }\n    `\n    )\n\n    await fs.writeFile(\n      join(pagesDir, '[...catchAll].js'),\n      `\n      export const getStaticProps = () => {\n        return {\n          props: {}\n        }\n      }\n\n      export const getStaticPaths = () => {\n        return {\n          paths: [\n            '/blog/conflicting',\n            '/hello/world'\n          ],\n          fallback: false\n        }\n      }\n\n      export default function Page() {\n        return '/[catchAll]'\n      }\n    `\n    )\n\n    const result = await nextBuild(appDir, undefined, {\n      stdout: true,\n      stderr: true,\n    })\n    const output = result.stdout + result.stderr\n    expect(output).toContain(\n      'Conflicting paths returned from getStaticPaths, paths must be unique per page'\n    )\n    expect(output).toContain(\n      'https://nextjs.org/docs/messages/conflicting-ssg-paths'\n    )\n    expect(output).toContain(\n      `path: \"/blog/conflicting\" from page: \"/[...catchAll]\"`\n    )\n    expect(output).toContain(`conflicts with path: \"/blog/conflicting\"`)\n  })","file":"integration/conflicting-ssg-paths/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show proper error when a dynamic SSG route conflicts with normal route","suites":["Conflicting SSG paths"],"updatePoint":{"line":82,"column":83},"line":82,"code":"  it('should show proper error when a dynamic SSG route conflicts with normal route', async () => {\n    await fs.ensureDir(join(pagesDir, 'hello'))\n    await fs.writeFile(\n      join(pagesDir, 'hello/world.js'),\n      `\n      export default function Page() {\n        return '/hello/world'\n      }\n    `\n    )\n\n    await fs.writeFile(\n      join(pagesDir, '[...catchAll].js'),\n      `\n      export const getStaticProps = () => {\n        return {\n          props: {}\n        }\n      }\n\n      export const getStaticPaths = () => {\n        return {\n          paths: [\n            '/hello',\n            '/hellO/world'\n          ],\n          fallback: false\n        }\n      }\n\n      export default function Page() {\n        return '/[catchAll]'\n      }\n    `\n    )\n\n    const result = await nextBuild(appDir, undefined, {\n      stdout: true,\n      stderr: true,\n    })\n    const output = result.stdout + result.stderr\n    expect(output).toContain(\n      'Conflicting paths returned from getStaticPaths, paths must be unique per page'\n    )\n    expect(output).toContain(\n      'https://nextjs.org/docs/messages/conflicting-ssg-paths'\n    )\n    expect(output).toContain(\n      `path: \"/hellO/world\" from page: \"/[...catchAll]\" conflicts with path: \"/hello/world\"`\n    )\n  })","file":"integration/conflicting-ssg-paths/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show proper error when a dynamic SSG route conflicts with SSR route","suites":["Conflicting SSG paths"],"updatePoint":{"line":134,"column":80},"line":134,"code":"  it('should show proper error when a dynamic SSG route conflicts with SSR route', async () => {\n    await fs.ensureDir(join(pagesDir, 'hello'))\n    await fs.writeFile(\n      join(pagesDir, 'hello/world.js'),\n      `\n      export const getServerSideProps = () => ({ props: {} })\n\n      export default function Page() {\n        return '/hello/world'\n      }\n    `\n    )\n\n    await fs.writeFile(\n      join(pagesDir, '[...catchAll].js'),\n      `\n      export const getStaticProps = () => {\n        return {\n          props: {}\n        }\n      }\n\n      export const getStaticPaths = () => {\n        return {\n          paths: [\n            '/hello',\n            '/hellO/world'\n          ],\n          fallback: false\n        }\n      }\n\n      export default function Page() {\n        return '/[catchAll]'\n      }\n    `\n    )\n\n    const result = await nextBuild(appDir, undefined, {\n      stdout: true,\n      stderr: true,\n    })\n    const output = result.stdout + result.stderr\n    expect(output).toContain(\n      'Conflicting paths returned from getStaticPaths, paths must be unique per page'\n    )\n    expect(output).toContain(\n      'https://nextjs.org/docs/messages/conflicting-ssg-paths'\n    )\n    expect(output).toContain(\n      `path: \"/hellO/world\" from page: \"/[...catchAll]\" conflicts with path: \"/hello/world\"`\n    )\n  })","file":"integration/conflicting-ssg-paths/test/index.test.js","skipped":false,"dir":"test"},{"name":"non-empty directory","suites":["create next app"],"updatePoint":{"line":26,"column":25},"line":26,"code":"  it('non-empty directory', async () => {\n    await usingTempDir(async (cwd) => {\n      const projectName = 'non-empty-directory'\n      await fs.mkdirp(path.join(cwd, projectName))\n      const pkg = path.join(cwd, projectName, 'package.json')\n      fs.writeFileSync(pkg, '{ \"foo\": \"bar\" }')\n\n      const res = await run([projectName], { cwd, reject: false })\n      expect(res.exitCode).toBe(1)\n      expect(res.stdout).toMatch(/contains files that could conflict/)\n    })\n  })","file":"integration/create-next-app/index.test.ts","skipped":false,"dir":"test"},{"name":"empty directory","suites":["create next app"],"updatePoint":{"line":42,"column":23},"line":42,"code":"    it('empty directory', async () => {\n      await usingTempDir(async (cwd) => {\n        const projectName = 'empty-directory'\n        const res = await run([projectName], { cwd })\n\n        expect(res.exitCode).toBe(0)\n        expect(\n          fs.existsSync(path.join(cwd, projectName, 'package.json'))\n        ).toBeTruthy()\n        expect(\n          fs.existsSync(path.join(cwd, projectName, 'pages/index.js'))\n        ).toBeTruthy()\n        expect(\n          fs.existsSync(path.join(cwd, projectName, '.eslintrc.json'))\n        ).toBeTruthy()\n        expect(\n          fs.existsSync(path.join(cwd, projectName, 'node_modules/next'))\n        ).toBe(true)\n      })\n    })","file":"integration/create-next-app/index.test.ts","skipped":false,"dir":"test"},{"name":"invalid example name","suites":["create next app"],"updatePoint":{"line":64,"column":26},"line":64,"code":"  it('invalid example name', async () => {\n    await usingTempDir(async (cwd) => {\n      const projectName = 'invalid-example-name'\n      const res = await run([projectName, '--example', 'not a real example'], {\n        cwd,\n        reject: false,\n      })\n\n      expect(res.exitCode).toBe(1)\n      expect(res.stderr).toMatch(/Could not locate an example named/i)\n      expect(\n        fs.existsSync(path.join(cwd, projectName, 'package.json'))\n      ).toBeFalsy()\n    })\n  })","file":"integration/create-next-app/index.test.ts","skipped":false,"dir":"test"},{"name":"valid example","suites":["create next app"],"updatePoint":{"line":80,"column":19},"line":80,"code":"  it('valid example', async () => {\n    await usingTempDir(async (cwd) => {\n      const projectName = 'valid-example'\n      const res = await run([projectName, '--example', 'basic-css'], { cwd })\n      expect(res.exitCode).toBe(0)\n\n      expect(\n        fs.existsSync(path.join(cwd, projectName, 'package.json'))\n      ).toBeTruthy()\n      expect(\n        fs.existsSync(path.join(cwd, projectName, 'pages/index.tsx'))\n      ).toBeTruthy()\n      // check we copied default `.gitignore`\n      expect(\n        fs.existsSync(path.join(cwd, projectName, '.gitignore'))\n      ).toBeTruthy()\n      expect(\n        fs.existsSync(path.join(cwd, projectName, 'node_modules/next'))\n      ).toBe(true)\n    })\n  })","file":"integration/create-next-app/index.test.ts","skipped":false,"dir":"test"},{"name":"valid example without package.json","suites":["create next app"],"updatePoint":{"line":102,"column":40},"line":102,"code":"  it('valid example without package.json', async () => {\n    await usingTempDir(async (cwd) => {\n      const projectName = 'valid-example-without-package-json'\n      const res = await run([projectName, '--example', 'with-docker-compose'], {\n        cwd,\n      })\n      expect(res.exitCode).toBe(0)\n\n      expect(\n        fs.existsSync(path.join(cwd, projectName, '.dockerignore'))\n      ).toBeTruthy()\n      // check we copied default `.gitignore`\n      expect(\n        fs.existsSync(path.join(cwd, projectName, '.gitignore'))\n      ).toBeTruthy()\n    })\n  })","file":"integration/create-next-app/index.test.ts","skipped":false,"dir":"test"},{"name":"should support typescript flag","suites":["create next app"],"updatePoint":{"line":120,"column":36},"line":120,"code":"  it('should support typescript flag', async () => {\n    await usingTempDir(async (cwd) => {\n      const projectName = 'typescript'\n      const res = await run([projectName, '--typescript'], { cwd })\n      expect(res.exitCode).toBe(0)\n\n      const files = [\n        'package.json',\n        'pages/index.tsx',\n        'pages/_app.tsx',\n        'pages/api/hello.ts',\n        'tsconfig.json',\n        'next-env.d.ts',\n        '.eslintrc.json',\n        'node_modules/next',\n        // check we copied default `.gitignore`\n        '.gitignore',\n      ]\n\n      files.forEach((file) =>\n        expect(fs.existsSync(path.join(cwd, projectName, file))).toBeTruthy()\n      )\n\n      const pkgJSONPath = path.join(cwd, projectName, 'package.json')\n\n      // Assert for dependencies specific to the typescript template\n      const pkgJSON = require(pkgJSONPath)\n      expect(Object.keys(pkgJSON.dependencies)).toEqual([\n        'next',\n        'react',\n        'react-dom',\n      ])\n      expect(Object.keys(pkgJSON.devDependencies)).toEqual([\n        '@types/node',\n        '@types/react',\n        '@types/react-dom',\n        'eslint',\n        'eslint-config-next',\n        'typescript',\n      ])\n    })\n  })","file":"integration/create-next-app/index.test.ts","skipped":false,"dir":"test"},{"name":"should allow example with GitHub URL","suites":["create next app"],"updatePoint":{"line":163,"column":42},"line":163,"code":"  it('should allow example with GitHub URL', async () => {\n    await usingTempDir(async (cwd) => {\n      const projectName = 'github-app'\n      const res = await run(\n        [projectName, '--example', `${exampleRepo}/${examplePath}`],\n        {\n          cwd,\n        }\n      )\n\n      expect(res.exitCode).toBe(0)\n      expect(\n        fs.existsSync(path.join(cwd, projectName, 'package.json'))\n      ).toBeTruthy()\n      expect(\n        fs.existsSync(path.join(cwd, projectName, 'pages/index.tsx'))\n      ).toBeTruthy()\n      expect(\n        fs.existsSync(path.join(cwd, projectName, '.gitignore'))\n      ).toBeTruthy()\n      expect(\n        fs.existsSync(path.join(cwd, projectName, 'node_modules/next'))\n      ).toBe(true)\n    })\n  })","file":"integration/create-next-app/index.test.ts","skipped":false,"dir":"test"},{"name":"should allow example with GitHub URL with trailing slash","suites":["create next app"],"updatePoint":{"line":189,"column":62},"line":189,"code":"  it('should allow example with GitHub URL with trailing slash', async () => {\n    await usingTempDir(async (cwd) => {\n      const projectName = 'github-app'\n      const res = await run(\n        [\n          projectName,\n          '--example',\n          'https://github.com/vercel/nextjs-portfolio-starter/',\n        ],\n        {\n          cwd,\n        }\n      )\n\n      expect(res.exitCode).toBe(0)\n      expect(\n        fs.existsSync(path.join(cwd, projectName, 'package.json'))\n      ).toBeTruthy()\n      expect(\n        fs.existsSync(path.join(cwd, projectName, 'pages/index.mdx'))\n      ).toBeTruthy()\n      expect(\n        fs.existsSync(path.join(cwd, projectName, '.gitignore'))\n      ).toBeTruthy()\n      expect(\n        fs.existsSync(path.join(cwd, projectName, 'node_modules/next'))\n      ).toBe(true)\n    })\n  })","file":"integration/create-next-app/index.test.ts","skipped":false,"dir":"test"},{"name":"should allow example with GitHub URL and example-path","suites":["create next app"],"updatePoint":{"line":219,"column":59},"line":219,"code":"  it('should allow example with GitHub URL and example-path', async () => {\n    await usingTempDir(async (cwd) => {\n      const projectName = 'github-example-path'\n      const res = await run(\n        [projectName, '--example', exampleRepo, '--example-path', examplePath],\n        {\n          cwd,\n        }\n      )\n\n      expect(res.exitCode).toBe(0)\n      expect(\n        fs.existsSync(path.join(cwd, projectName, 'package.json'))\n      ).toBeTruthy()\n      expect(\n        fs.existsSync(path.join(cwd, projectName, 'pages/index.tsx'))\n      ).toBeTruthy()\n      expect(\n        fs.existsSync(path.join(cwd, projectName, '.gitignore'))\n      ).toBeTruthy()\n      expect(\n        fs.existsSync(path.join(cwd, projectName, 'node_modules/next'))\n      ).toBe(true)\n    })\n  })","file":"integration/create-next-app/index.test.ts","skipped":false,"dir":"test"},{"name":"should use --example-path over the file path in the GitHub URL","suites":["create next app"],"updatePoint":{"line":245,"column":68},"line":245,"code":"  it('should use --example-path over the file path in the GitHub URL', async () => {\n    await usingTempDir(async (cwd) => {\n      const projectName = 'github-example-path-2'\n      const res = await run(\n        [\n          projectName,\n          '--example',\n          `${exampleRepo}/${examplePath}`,\n          '--example-path',\n          examplePath,\n        ],\n        {\n          cwd,\n        }\n      )\n\n      expect(res.exitCode).toBe(0)\n      expect(\n        fs.existsSync(path.join(cwd, projectName, 'package.json'))\n      ).toBeTruthy()\n      expect(\n        fs.existsSync(path.join(cwd, projectName, 'pages/index.tsx'))\n      ).toBeTruthy()\n      expect(\n        fs.existsSync(path.join(cwd, projectName, '.gitignore'))\n      ).toBeTruthy()\n      expect(\n        fs.existsSync(path.join(cwd, projectName, 'node_modules/next'))\n      ).toBe(true)\n    })\n  })","file":"integration/create-next-app/index.test.ts","skipped":false,"dir":"test"},{"name":"should fall back to default template","suites":["create next app"],"updatePoint":{"line":280,"column":44},"line":280,"code":"    it('should fall back to default template', async () => {\n      await usingTempDir(async (cwd) => {\n        const projectName = 'fail-example'\n        const res = await run(\n          [projectName, '--example', '__internal-testing-retry'],\n          {\n            cwd,\n            input: '\\n',\n          }\n        )\n        expect(res.exitCode).toBe(0)\n\n        const files = [\n          'package.json',\n          'pages/index.js',\n          '.gitignore',\n          '.eslintrc.json',\n        ]\n        files.forEach((file) =>\n          expect(fs.existsSync(path.join(cwd, projectName, file))).toBeTruthy()\n        )\n      })\n    })","file":"integration/create-next-app/index.test.ts","skipped":false,"dir":"test"},{"name":"should allow an example named default","suites":["create next app"],"updatePoint":{"line":305,"column":43},"line":305,"code":"  it('should allow an example named default', async () => {\n    await usingTempDir(async (cwd) => {\n      const projectName = 'default-example'\n      const res = await run([projectName, '--example', 'default'], { cwd })\n      expect(res.exitCode).toBe(0)\n\n      expect(\n        fs.existsSync(path.join(cwd, projectName, 'package.json'))\n      ).toBeTruthy()\n      expect(\n        fs.existsSync(path.join(cwd, projectName, 'pages/index.js'))\n      ).toBeTruthy()\n      // check we copied default `.gitignore`\n      expect(\n        fs.existsSync(path.join(cwd, projectName, '.gitignore'))\n      ).toBeTruthy()\n      expect(\n        fs.existsSync(path.join(cwd, projectName, 'node_modules/next'))\n      ).toBe(true)\n    })\n  })","file":"integration/create-next-app/index.test.ts","skipped":false,"dir":"test"},{"name":"should exit if example flag is empty","suites":["create next app"],"updatePoint":{"line":327,"column":42},"line":327,"code":"  it('should exit if example flag is empty', async () => {\n    await usingTempDir(async (cwd) => {\n      const projectName = 'no-example-provided'\n      const res = await run([projectName, '--example'], { cwd, reject: false })\n      expect(res.exitCode).toBe(1)\n    })\n  })","file":"integration/create-next-app/index.test.ts","skipped":false,"dir":"test"},{"name":"should exit if the folder is not writable","suites":["create next app"],"updatePoint":{"line":335,"column":47},"line":335,"code":"  it('should exit if the folder is not writable', async () => {\n    await usingTempDir(async (cwd) => {\n      const projectName = 'not-writable'\n      const res = await run([projectName], { cwd, reject: false })\n\n      if (process.platform === 'win32') {\n        expect(res.exitCode).toBe(0)\n        expect(\n          fs.existsSync(path.join(cwd, projectName, 'package.json'))\n        ).toBeTruthy()\n        return\n      }\n      expect(res.exitCode).toBe(1)\n      expect(res.stderr).toMatch(\n        /you do not have write permissions for this folder/\n      )\n    }, 0o500)\n  })","file":"integration/create-next-app/index.test.ts","skipped":false,"dir":"test"},{"name":"should create a project in the current directory","suites":["create next app"],"updatePoint":{"line":354,"column":54},"line":354,"code":"  it('should create a project in the current directory', async () => {\n    await usingTempDir(async (cwd) => {\n      const env = { ...process.env }\n      const tmpBin = path.join(__dirname, 'bin')\n      const tmpYarn = path.join(tmpBin, 'yarn')\n\n      if (process.platform !== 'win32') {\n        // ensure install succeeds with invalid yarn binary\n        // which simulates no yarn binary being available as\n        // an alternative to removing the binary and reinstalling\n        await fs.remove(tmpBin)\n        await fs.mkdir(tmpBin)\n        await fs.writeFile(tmpYarn, '#!/bin/sh\\nexit 1')\n        await fs.chmod(tmpYarn, '755')\n        env.PATH = `${tmpBin}:${env.PATH}`\n        delete env.npm_config_user_agent\n      }\n\n      const res = await run(['.'], {\n        cwd,\n        env,\n        extendEnv: false,\n        stdio: 'inherit',\n      })\n      await fs.remove(tmpBin)\n\n      expect(res.exitCode).toBe(0)\n\n      const files = [\n        'package.json',\n        'pages/index.js',\n        '.gitignore',\n        'node_modules/next',\n        '.eslintrc.json',\n      ]\n      files.forEach((file) =>\n        expect(fs.existsSync(path.join(cwd, file))).toBeTruthy()\n      )\n    })\n  })","file":"integration/create-next-app/index.test.ts","skipped":false,"dir":"test"},{"name":"should ask the user for a name for the project if none supplied","suites":["create next app"],"updatePoint":{"line":395,"column":69},"line":395,"code":"  it('should ask the user for a name for the project if none supplied', async () => {\n    await usingTempDir(async (cwd) => {\n      const projectName = 'test-project'\n      const res = await run([], { cwd, input: `${projectName}\\n` })\n      expect(res.exitCode).toBe(0)\n\n      const files = [\n        'package.json',\n        'pages/index.js',\n        '.gitignore',\n        'node_modules/next',\n        '.eslintrc.json',\n      ]\n      files.forEach((file) =>\n        expect(fs.existsSync(path.join(cwd, projectName, file))).toBeTruthy()\n      )\n    })\n  })","file":"integration/create-next-app/index.test.ts","skipped":false,"dir":"test"},{"name":"should use npm as the package manager on supplying --use-npm","suites":["create next app"],"updatePoint":{"line":414,"column":66},"line":414,"code":"  it('should use npm as the package manager on supplying --use-npm', async () => {\n    await usingTempDir(async (cwd) => {\n      const projectName = 'use-npm'\n      const res = await run([projectName, '--use-npm'], { cwd })\n      expect(res.exitCode).toBe(0)\n\n      const files = [\n        'package.json',\n        'pages/index.js',\n        '.gitignore',\n        '.eslintrc.json',\n        'package-lock.json',\n        'node_modules/next',\n      ]\n      files.forEach((file) =>\n        expect(fs.existsSync(path.join(cwd, projectName, file))).toBeTruthy()\n      )\n    })\n  })","file":"integration/create-next-app/index.test.ts","skipped":false,"dir":"test"},{"name":"should use npm as the package manager on supplying --use-npm with example","suites":["create next app"],"updatePoint":{"line":434,"column":79},"line":434,"code":"  it('should use npm as the package manager on supplying --use-npm with example', async () => {\n    await usingTempDir(async (cwd) => {\n      const projectName = 'use-npm'\n      const res = await run(\n        [\n          projectName,\n          '--use-npm',\n          '--example',\n          `${exampleRepo}/${examplePath}`,\n        ],\n        { cwd }\n      )\n      expect(res.exitCode).toBe(0)\n\n      const files = [\n        'package.json',\n        'pages/index.tsx',\n        '.gitignore',\n        'package-lock.json',\n        'node_modules/next',\n      ]\n      files.forEach((file) =>\n        expect(fs.existsSync(path.join(cwd, projectName, file))).toBeTruthy()\n      )\n    })\n  })","file":"integration/create-next-app/index.test.ts","skipped":false,"dir":"test"},{"name":"should use pnpm as the package manager on supplying --use-pnpm","suites":["create next app"],"updatePoint":{"line":461,"column":68},"line":461,"code":"  it('should use pnpm as the package manager on supplying --use-pnpm', async () => {\n    await usingTempDir(async (cwd) => {\n      const projectName = 'use-pnpm'\n      const res = await run([projectName, '--use-pnpm'], { cwd })\n      expect(res.exitCode).toBe(0)\n\n      const files = [\n        'package.json',\n        'pages/index.js',\n        '.gitignore',\n        '.eslintrc.json',\n        'pnpm-lock.yaml',\n        'node_modules/next',\n      ]\n      files.forEach((file) =>\n        expect(fs.existsSync(path.join(cwd, projectName, file))).toBeTruthy()\n      )\n    })\n  })","file":"integration/create-next-app/index.test.ts","skipped":false,"dir":"test"},{"name":"should use pnpm as the package manager on supplying --use-pnpm with example","suites":["create next app"],"updatePoint":{"line":481,"column":81},"line":481,"code":"  it('should use pnpm as the package manager on supplying --use-pnpm with example', async () => {\n    try {\n      await execa('pnpm', ['--version'])\n    } catch (_) {\n      // install pnpm if not available\n      await execa('npm', ['i', '-g', 'pnpm'])\n    }\n\n    await usingTempDir(async (cwd) => {\n      const projectName = 'use-pnpm'\n      const res = await run(\n        [\n          projectName,\n          '--use-pnpm',\n          '--example',\n          `${exampleRepo}/${examplePath}`,\n        ],\n        { cwd }\n      )\n      expect(res.exitCode).toBe(0)\n\n      const files = [\n        'package.json',\n        'pages/index.tsx',\n        '.gitignore',\n        'pnpm-lock.yaml',\n        'node_modules/next',\n      ]\n\n      files.forEach((file) =>\n        expect(fs.existsSync(path.join(cwd, projectName, file))).toBeTruthy()\n      )\n    })\n  })","file":"integration/create-next-app/index.test.ts","skipped":false,"dir":"test"},{"name":"should have all CSS files in manifest","suites":[],"updatePoint":{"line":21,"column":43},"line":21,"code":"  it('should have all CSS files in manifest', async () => {\n    const cssFiles = (\n      await glob('**/*.css', {\n        cwd: join(appDir, '.next/static'),\n      })\n    ).map((file) => join('.next/static', file))\n\n    const requiredServerFiles = await fs.readJSON(\n      join(appDir, '.next/required-server-files.json')\n    )\n\n    expect(\n      requiredServerFiles.files.filter((file) => file.endsWith('.css'))\n    ).toEqual(cssFiles)\n  })","file":"integration/critical-css/test/index.test.js","skipped":false,"dir":"test"},{"name":"should inline critical CSS","suites":[],"updatePoint":{"line":37,"column":32},"line":37,"code":"  it('should inline critical CSS', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toMatch(\n      /<link rel=\"stylesheet\" href=\"\\/_next\\/static\\/css\\/.*\\.css\" .*>/\n    )\n    expect(html).toMatch(/body{font-family:SF Pro Text/)\n  })","file":"integration/critical-css/test/index.test.js","skipped":false,"dir":"test"},{"name":"should inline critical CSS (dynamic)","suites":[],"updatePoint":{"line":45,"column":42},"line":45,"code":"  it('should inline critical CSS (dynamic)', async () => {\n    const html = await renderViaHTTP(appPort, '/another')\n    expect(html).toMatch(\n      /<link rel=\"stylesheet\" href=\"\\/_next\\/static\\/css\\/.*\\.css\" .*>/\n    )\n    expect(html).toMatch(/body{font-family:SF Pro Text/)\n  })","file":"integration/critical-css/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not inline non-critical css","suites":[],"updatePoint":{"line":53,"column":40},"line":53,"code":"  it('should not inline non-critical css', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).not.toMatch(/.extra-style/)\n  })","file":"integration/critical-css/test/index.test.js","skipped":false,"dir":"test"},{"name":"should be able to client-side navigate from red to blue","suites":[],"updatePoint":{"line":27,"column":61},"line":27,"code":"  it('should be able to client-side navigate from red to blue', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/red')\n\n      await browser.eval(`window.__did_not_ssr = 'make sure this is set'`)\n\n      const redColor = await browser.eval(\n        `window.getComputedStyle(document.querySelector('#verify-red')).color`\n      )\n      expect(redColor).toMatchInlineSnapshot(`\"rgb(255, 0, 0)\"`)\n\n      await browser.elementByCss('#link-blue').click()\n\n      await browser.waitForElementByCss('#verify-blue')\n\n      const blueColor = await browser.eval(\n        `window.getComputedStyle(document.querySelector('#verify-blue')).color`\n      )\n      expect(blueColor).toMatchInlineSnapshot(`\"rgb(0, 0, 255)\"`)\n\n      expect(await browser.eval(`window.__did_not_ssr`)).toMatchInlineSnapshot(\n        `\"make sure this is set\"`\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/css-client-nav/test/index.test.js","skipped":false,"dir":"test"},{"name":"should be able to client-side navigate from blue to red","suites":[],"updatePoint":{"line":58,"column":61},"line":58,"code":"  it('should be able to client-side navigate from blue to red', async () => {\n    const content = await renderViaHTTP(appPort, '/blue')\n    const $ = cheerio.load(content)\n\n    if (!dev) {\n      // Ensure only `/blue` page's CSS is preloaded\n      const serverCssPreloads = $('link[rel=\"preload\"][as=\"style\"]')\n      expect(serverCssPreloads.length).toBe(2)\n\n      const serverCssPrefetches = $('link[rel=\"prefetch\"][as=\"style\"]')\n      expect(serverCssPrefetches.length).toBe(0)\n    }\n\n    let browser\n    try {\n      browser = await webdriver(appPort, '/blue')\n\n      await browser.eval(`window.__did_not_ssr = 'make sure this is set'`)\n\n      const redColor = await browser.eval(\n        `window.getComputedStyle(document.querySelector('#verify-blue')).color`\n      )\n      expect(redColor).toMatchInlineSnapshot(`\"rgb(0, 0, 255)\"`)\n\n      await browser.elementByCss('#link-red').click()\n\n      await browser.waitForElementByCss('#verify-red')\n\n      const blueColor = await browser.eval(\n        `window.getComputedStyle(document.querySelector('#verify-red')).color`\n      )\n      expect(blueColor).toMatchInlineSnapshot(`\"rgb(255, 0, 0)\"`)\n\n      expect(await browser.eval(`window.__did_not_ssr`)).toMatchInlineSnapshot(\n        `\"make sure this is set\"`\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/css-client-nav/test/index.test.js","skipped":false,"dir":"test"},{"name":"should be able to client-side navigate from none to red","suites":[],"updatePoint":{"line":101,"column":61},"line":101,"code":"  it('should be able to client-side navigate from none to red', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/none')\n\n      await browser.eval(`window.__did_not_ssr = 'make sure this is set'`)\n\n      await browser.elementByCss('#link-red').click()\n      await browser.waitForElementByCss('#verify-red')\n\n      const blueColor = await browser.eval(\n        `window.getComputedStyle(document.querySelector('#verify-red')).color`\n      )\n      expect(blueColor).toMatchInlineSnapshot(`\"rgb(255, 0, 0)\"`)\n\n      expect(await browser.eval(`window.__did_not_ssr`)).toMatchInlineSnapshot(\n        `\"make sure this is set\"`\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/css-client-nav/test/index.test.js","skipped":false,"dir":"test"},{"name":"should be able to client-side navigate from none to blue","suites":[],"updatePoint":{"line":126,"column":62},"line":126,"code":"  it('should be able to client-side navigate from none to blue', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/none')\n\n      await browser.eval(`window.__did_not_ssr = 'make sure this is set'`)\n\n      await browser.elementByCss('#link-blue').click()\n      await browser.waitForElementByCss('#verify-blue')\n\n      const blueColor = await browser.eval(\n        `window.getComputedStyle(document.querySelector('#verify-blue')).color`\n      )\n      expect(blueColor).toMatchInlineSnapshot(`\"rgb(0, 0, 255)\"`)\n\n      expect(await browser.eval(`window.__did_not_ssr`)).toMatchInlineSnapshot(\n        `\"make sure this is set\"`\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/css-client-nav/test/index.test.js","skipped":false,"dir":"test"},{"name":"should time out and hard navigate for stalled CSS request","suites":["CSS Module client-side navigation","production"],"updatePoint":{"line":186,"column":65},"line":186,"code":"    it('should time out and hard navigate for stalled CSS request', async () => {\n      let browser\n      stallCss = true\n\n      try {\n        browser = await webdriver(appPort, '/red')\n        await browser.eval('window.beforeNav = \"hello\"')\n\n        const redColor = await browser.eval(\n          `window.getComputedStyle(document.querySelector('#verify-red')).color`\n        )\n        expect(redColor).toMatchInlineSnapshot(`\"rgb(255, 0, 0)\"`)\n        expect(await browser.eval('window.beforeNav')).toBe('hello')\n\n        await browser.elementByCss('#link-blue').click()\n\n        await browser.waitForElementByCss('#verify-blue')\n\n        const blueColor = await browser.eval(\n          `window.getComputedStyle(document.querySelector('#verify-blue')).color`\n        )\n        expect(blueColor).toMatchInlineSnapshot(`\"rgb(0, 0, 255)\"`)\n\n        // the timeout should have been reached and we did a hard\n        // navigation\n        expect(await browser.eval('window.beforeNav')).toBeFalsy()\n      } finally {\n        stallCss = false\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/css-client-nav/test/index.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["CSS Customization"],"updatePoint":{"line":17,"column":33},"line":17,"code":"  it('should compile successfully', async () => {\n    const { code, stdout } = await nextBuild(appDir, [], {\n      stdout: true,\n    })\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/css-customization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've compiled and prefixed","suites":["CSS Customization"],"updatePoint":{"line":25,"column":37},"line":25,"code":"  it(`should've compiled and prefixed`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\"@media (480px <= width < 768px){::placeholder{color:green}}.video{max-width:400px;max-height:300px}\"`\n    )\n\n    // Contains a source map\n    expect(cssContent).toMatch(/\\/\\*#\\s*sourceMappingURL=(.+\\.map)\\s*\\*\\//)\n  })","file":"integration/css-customization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a source map","suites":["CSS Customization"],"updatePoint":{"line":41,"column":36},"line":41,"code":"  it(`should've emitted a source map`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssMapFiles = files.filter((f) => /\\.css\\.map$/.test(f))\n\n    expect(cssMapFiles.length).toBe(1)\n    const cssMapContent = (\n      await readFile(join(cssFolder, cssMapFiles[0]), 'utf8')\n    ).trim()\n\n    const { version, mappings, sourcesContent } = JSON.parse(cssMapContent)\n    expect({ version, mappings, sourcesContent }).toMatchInlineSnapshot(`\n      Object {\n        \"mappings\": \"AACA,gCACE,cACE,WACF,CACF,CAGA,OACE,eAA0B,CAA1B,gBACF\",\n        \"sourcesContent\": Array [\n          \"/* this should pass through untransformed */\n      @media (480px <= width < 768px) {\n        ::placeholder {\n          color: green;\n        }\n      }\n\n      /* this should be transformed to width/height */\n      .video {\n        -xyz-max-size: 400px 300px;\n      }\n      \",\n        ],\n        \"version\": 3,\n      }\n    `)\n  })","file":"integration/css-customization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["CSS Customization Array"],"updatePoint":{"line":83,"column":33},"line":83,"code":"  it('should compile successfully', async () => {\n    const { code, stdout } = await nextBuild(appDir, [], {\n      stdout: true,\n    })\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/css-customization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've compiled and prefixed","suites":["CSS Customization Array"],"updatePoint":{"line":91,"column":37},"line":91,"code":"  it(`should've compiled and prefixed`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\"@media (480px <= width < 768px){a:before{content:\\\\\"\\\\\"}::placeholder{color:green}}.video{max-width:6400px;max-height:4800px;max-width:400rem;max-height:300rem}\"`\n    )\n\n    // Contains a source map\n    expect(cssContent).toMatch(/\\/\\*#\\s*sourceMappingURL=(.+\\.map)\\s*\\*\\//)\n  })","file":"integration/css-customization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a source map","suites":["CSS Customization Array"],"updatePoint":{"line":107,"column":36},"line":107,"code":"  it(`should've emitted a source map`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssMapFiles = files.filter((f) => /\\.css\\.map$/.test(f))\n\n    expect(cssMapFiles.length).toBe(1)\n    const cssMapContent = (\n      await readFile(join(cssFolder, cssMapFiles[0]), 'utf8')\n    ).trim()\n\n    const { version, mappings, sourcesContent } = JSON.parse(cssMapContent)\n    expect({ version, mappings, sourcesContent }).toMatchInlineSnapshot(`\n      Object {\n        \"mappings\": \"AACA,gCACE,SACE,UACF,CACA,cACE,WACF,CACF,CAGA,OACE,gBAA4B,CAA5B,iBAA4B,CAA5B,gBAA4B,CAA5B,iBACF\",\n        \"sourcesContent\": Array [\n          \"/* this should pass through untransformed */\n      @media (480px <= width < 768px) {\n        a::before {\n          content: '';\n        }\n        ::placeholder {\n          color: green;\n        }\n      }\n\n      /* this should be transformed to width/height */\n      .video {\n        -xyz-max-size: 400rem 300rem;\n      }\n      \",\n        ],\n        \"version\": 3,\n      }\n    `)\n  })","file":"integration/css-customization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["CSS Customization custom loader"],"updatePoint":{"line":152,"column":33},"line":152,"code":"  it('should compile successfully', async () => {\n    const { code, stdout, stderr } = await nextBuild(appDir, [], {\n      stdout: true,\n      stderr: true,\n    })\n    expect(code).toBe(0)\n    expect(stderr).toMatch(/Built-in CSS support is being disabled/)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/css-customization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've applied style","suites":["CSS Customization custom loader"],"updatePoint":{"line":162,"column":29},"line":162,"code":"  it(`should've applied style`, async () => {\n    const pagesFolder = join(appDir, '.next/static/chunks/pages')\n\n    const files = await readdir(pagesFolder)\n    const indexFiles = files.filter((f) => /^index.+\\.js$/.test(f))\n\n    expect(indexFiles.length).toBe(1)\n    const indexContent = await readFile(\n      join(pagesFolder, indexFiles[0]),\n      'utf8'\n    )\n    expect(indexContent).toMatch(/\\.my-text\\.jsx-[0-9a-z]+{color:red}/)\n  })","file":"integration/css-customization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["Bad CSS Customization"],"updatePoint":{"line":184,"column":33},"line":184,"code":"  it('should compile successfully', async () => {\n    const { stdout, stderr } = await nextBuild(appDir, [], {\n      stdout: true,\n      stderr: true,\n    })\n    expect(stdout).toMatch(/Compiled successfully/)\n    expect(stderr).toMatch(/field which is not supported.*?sourceMap/)\n    ;[\n      'postcss-modules-values',\n      'postcss-modules-scope',\n      'postcss-modules-extract-imports',\n      'postcss-modules-local-by-default',\n      'postcss-modules',\n    ].forEach((plugin) => {\n      expect(stderr).toMatch(\n        new RegExp(`Please remove the.*?${escapeStringRegexp(plugin)}`)\n      )\n    })\n  })","file":"integration/css-customization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've compiled and prefixed","suites":["Bad CSS Customization"],"updatePoint":{"line":204,"column":37},"line":204,"code":"  it(`should've compiled and prefixed`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\".video{max-width:400px;max-height:300px}\"`\n    )\n\n    // Contains a source map\n    expect(cssContent).toMatch(/\\/\\*#\\s*sourceMappingURL=(.+\\.map)\\s*\\*\\//)\n  })","file":"integration/css-customization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a source map","suites":["Bad CSS Customization"],"updatePoint":{"line":220,"column":36},"line":220,"code":"  it(`should've emitted a source map`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssMapFiles = files.filter((f) => /\\.css\\.map$/.test(f))\n\n    expect(cssMapFiles.length).toBe(1)\n  })","file":"integration/css-customization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail the build","suites":["Bad CSS Customization Array (1)"],"updatePoint":{"line":237,"column":27},"line":237,"code":"  it('should fail the build', async () => {\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n\n    expect(stderr).toMatch(\n      /A PostCSS Plugin was passed as an array but did not provide its configuration \\('postcss-trolling'\\)/\n    )\n    expect(stderr).toMatch(/Build failed because of webpack errors/)\n  })","file":"integration/css-customization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail the build","suites":["Bad CSS Customization Array (2)"],"updatePoint":{"line":254,"column":27},"line":254,"code":"  it('should fail the build', async () => {\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n\n    expect(stderr).toMatch(\n      /Error: Your PostCSS configuration for 'postcss-trolling' cannot have null configuration./\n    )\n    expect(stderr).toMatch(\n      /To disable 'postcss-trolling', pass false, otherwise, pass true or a configuration object./\n    )\n    expect(stderr).toMatch(/Build failed because of webpack errors/)\n  })","file":"integration/css-customization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail the build","suites":["Bad CSS Customization Array (3)"],"updatePoint":{"line":274,"column":27},"line":274,"code":"  it('should fail the build', async () => {\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n\n    expect(stderr).toMatch(\n      /A PostCSS Plugin must be provided as a string. Instead, we got: '5'/\n    )\n    expect(stderr).toMatch(/Build failed because of webpack errors/)\n  })","file":"integration/css-customization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail the build","suites":["Bad CSS Customization Array (4)"],"updatePoint":{"line":291,"column":27},"line":291,"code":"  it('should fail the build', async () => {\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n\n    expect(stderr).toMatch(/An unknown PostCSS plugin was provided \\(5\\)/)\n    expect(stderr).toMatch(/Build failed because of webpack errors/)\n  })","file":"integration/css-customization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail the build","suites":["Bad CSS Customization Array (5)"],"updatePoint":{"line":306,"column":27},"line":306,"code":"  it('should fail the build', async () => {\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n\n    expect(stderr).toMatch(\n      /Your custom PostCSS configuration must export a `plugins` key./\n    )\n    expect(stderr).toMatch(/Build failed because of webpack errors/)\n  })","file":"integration/css-customization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail the build","suites":["Bad CSS Customization Array (6)"],"updatePoint":{"line":323,"column":27},"line":323,"code":"  it('should fail the build', async () => {\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n\n    expect(stderr).toMatch(\n      /Your custom PostCSS configuration must export a `plugins` key./\n    )\n    expect(stderr).toMatch(/Build failed because of webpack errors/)\n  })","file":"integration/css-customization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail the build","suites":["Bad CSS Customization Array (7)"],"updatePoint":{"line":340,"column":27},"line":340,"code":"  it('should fail the build', async () => {\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n\n    expect(stderr).toMatch(\n      /A PostCSS Plugin was passed as an array but did not provide its configuration \\('postcss-trolling'\\)/\n    )\n    expect(stderr).toMatch(/Build failed because of webpack errors/)\n  })","file":"integration/css-customization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail the build","suites":["Bad CSS Customization Array (8)"],"updatePoint":{"line":357,"column":27},"line":357,"code":"  it('should fail the build', async () => {\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n\n    expect(stderr).toMatch(\n      /A PostCSS Plugin was passed as a function using require\\(\\), but it must be provided as a string/\n    )\n    expect(stderr).toMatch(/Build failed because of webpack errors/)\n  })","file":"integration/css-customization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail the build","suites":["Bad CSS Customization Function"],"updatePoint":{"line":374,"column":27},"line":374,"code":"  it('should fail the build', async () => {\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n\n    expect(stderr).toMatch(\n      /Your custom PostCSS configuration may not export a function/\n    )\n    expect(stderr).toMatch(/Build failed because of webpack errors/)\n  })","file":"integration/css-customization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["Browserslist: Old"],"updatePoint":{"line":21,"column":39},"line":21,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/css-features/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["Browserslist: Old"],"updatePoint":{"line":26,"column":41},"line":26,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\"a{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:none;border-collapse:separate;-webkit-border-image:none;border-image:none;-webkit-border-radius:0;border-radius:0;border-spacing:0;bottom:auto;-webkit-box-shadow:none;box-shadow:none;-webkit-box-sizing:content-box;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-webkit-column-count:auto;-webkit-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;column-span:1;-webkit-column-width:auto;columns:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc none outside;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}@media (-webkit-min-device-pixel-ratio:2),(min-resolution:2dppx){.image{background-image:url(data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)}}\"`\n    )\n  })","file":"integration/css-features/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["Browserslist: New"],"updatePoint":{"line":53,"column":39},"line":53,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/css-features/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["Browserslist: New"],"updatePoint":{"line":58,"column":41},"line":58,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\"a{all:initial}@media (min-resolution:2dppx){.image{background-image:url(data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)}}\"`\n    )\n  })","file":"integration/css-features/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["Custom Properties: Pass-Through IE11"],"updatePoint":{"line":85,"column":39},"line":85,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/css-features/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["Custom Properties: Pass-Through IE11"],"updatePoint":{"line":90,"column":41},"line":90,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\":root{--color:red}h1{color:var(--color)}\"`\n    )\n  })","file":"integration/css-features/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["Custom Properties: Pass-Through Modern"],"updatePoint":{"line":117,"column":39},"line":117,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/css-features/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["Custom Properties: Pass-Through Modern"],"updatePoint":{"line":122,"column":41},"line":122,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\":root{--color:red}h1{color:var(--color)}\"`\n    )\n  })","file":"integration/css-features/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail to build","suites":["Custom Properties: Fail for :root {} in CSS Modules"],"updatePoint":{"line":144,"column":26},"line":144,"code":"  it('should fail to build', async () => {\n    const { code, stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n    })\n    expect(code).not.toBe(0)\n    expect(stderr).toContain('Failed to compile')\n    expect(stderr).toContain('pages/styles.module.css')\n    expect(stderr).toContain('Selector \":root\" is not pure')\n  })","file":"integration/css-features/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail to build","suites":["Custom Properties: Fail for global element in CSS Modules"],"updatePoint":{"line":162,"column":26},"line":162,"code":"  it('should fail to build', async () => {\n    const { code, stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n    })\n    expect(code).not.toBe(0)\n    expect(stderr).toContain('Failed to compile')\n    expect(stderr).toContain('pages/styles.module.css')\n    expect(stderr).toContain('Selector \"h1\" is not pure')\n  })","file":"integration/css-features/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["CSS Modules: Import Global CSS"],"updatePoint":{"line":185,"column":39},"line":185,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/css-features/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["CSS Modules: Import Global CSS"],"updatePoint":{"line":190,"column":41},"line":190,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\"a .styles_foo__Io_Us{all:initial}\"`\n    )\n  })","file":"integration/css-features/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail to build","suites":["CSS Modules: Importing Invalid Global CSS"],"updatePoint":{"line":212,"column":26},"line":212,"code":"  it('should fail to build', async () => {\n    const { code, stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n    })\n    expect(code).not.toBe(0)\n    expect(stderr).toContain('Failed to compile')\n    expect(stderr).toContain('pages/styles.css')\n    expect(stderr).toContain('Selector \"a\" is not pure')\n  })","file":"integration/css-features/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["CSS Modules: Import Exports"],"updatePoint":{"line":235,"column":39},"line":235,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/css-features/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["CSS Modules: Import Exports"],"updatePoint":{"line":240,"column":41},"line":240,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\".styles_blk__CqbFg{color:#000}\"`\n    )\n  })","file":"integration/css-features/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["Inline Comments: Minify"],"updatePoint":{"line":267,"column":39},"line":267,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/css-features/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["Inline Comments: Minify"],"updatePoint":{"line":272,"column":41},"line":272,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\"*{box-sizing:border-box}\"`\n    )\n  })","file":"integration/css-features/test/index.test.js","skipped":false,"dir":"test"},{"name":"should minify correctly by removing whitespace","suites":[],"updatePoint":{"line":18,"column":52},"line":18,"code":"  it('should minify correctly by removing whitespace', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(html)\n    const href = $('link').attr('href')\n    expect(href).toMatch(/\\/_next\\/static\\/css\\/.*\\.css/)\n    const css = await renderViaHTTP(appPort, href)\n    expect(css).toBe(\n      '.a{--var-1:0;--var-2:0;--var-1:-50%;--var-2:-50%}.b{--var-1:0;--var-2:0;--var-2:-50%}'\n    )\n  })","file":"integration/css-minify/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["Basic CSS Module Support"],"updatePoint":{"line":39,"column":39},"line":39,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n    expect(stdout).toContain('.css')\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["Basic CSS Module Support"],"updatePoint":{"line":45,"column":41},"line":45,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\".index_redText__KCBQp{color:red}\"`\n    )\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've injected the CSS on server render","suites":["Basic CSS Module Support"],"updatePoint":{"line":59,"column":49},"line":59,"code":"  it(`should've injected the CSS on server render`, async () => {\n    const content = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(content)\n\n    const cssPreload = $('link[rel=\"preload\"][as=\"style\"]')\n    expect(cssPreload.length).toBe(1)\n    expect(cssPreload.attr('href')).toMatch(/^\\/_next\\/static\\/css\\/.*\\.css$/)\n\n    const cssSheet = $('link[rel=\"stylesheet\"]')\n    expect(cssSheet.length).toBe(1)\n    expect(cssSheet.attr('href')).toMatch(/^\\/_next\\/static\\/css\\/.*\\.css$/)\n\n    expect($('#verify-red').attr('class')).toMatchInlineSnapshot(\n      `\"index_redText__KCBQp\"`\n    )\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["3rd Party CSS Module Support"],"updatePoint":{"line":96,"column":39},"line":96,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["3rd Party CSS Module Support"],"updatePoint":{"line":101,"column":41},"line":101,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\".index_foo__2K5pY{position:relative}.index_foo__2K5pY .bar,.index_foo__2K5pY .baz{height:100%;overflow:hidden}.index_foo__2K5pY .lol,.index_foo__2K5pY>.lel{width:80%}\"`\n    )\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've injected the CSS on server render","suites":["3rd Party CSS Module Support"],"updatePoint":{"line":115,"column":49},"line":115,"code":"  it(`should've injected the CSS on server render`, async () => {\n    const content = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(content)\n\n    const cssPreload = $('link[rel=\"preload\"][as=\"style\"]')\n    expect(cssPreload.length).toBe(1)\n    expect(cssPreload.attr('href')).toMatch(/^\\/_next\\/static\\/css\\/.*\\.css$/)\n\n    const cssSheet = $('link[rel=\"stylesheet\"]')\n    expect(cssSheet.length).toBe(1)\n    expect(cssSheet.attr('href')).toMatch(/^\\/_next\\/static\\/css\\/.*\\.css$/)\n\n    expect($('#verify-div').attr('class')).toMatchInlineSnapshot(\n      `\"index_foo__2K5pY\"`\n    )\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have CSS for page","suites":["Has CSS Module in computed styles in Development"],"updatePoint":{"line":147,"column":30},"line":147,"code":"  it('should have CSS for page', async () => {\n    const browser = await webdriver(appPort, '/')\n\n    const currentColor = await browser.eval(\n      `window.getComputedStyle(document.querySelector('#verify-red')).color`\n    )\n    expect(currentColor).toMatchInlineSnapshot(`\"rgb(255, 0, 0)\"`)\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["Has CSS Module in computed styles in Production"],"updatePoint":{"line":176,"column":39},"line":176,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have CSS for page","suites":["Has CSS Module in computed styles in Production"],"updatePoint":{"line":181,"column":30},"line":181,"code":"  it('should have CSS for page', async () => {\n    const browser = await webdriver(appPort, '/')\n\n    const currentColor = await browser.eval(\n      `window.getComputedStyle(document.querySelector('#verify-red')).color`\n    )\n    expect(currentColor).toMatchInlineSnapshot(`\"rgb(255, 0, 0)\"`)\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should update CSS color without remounting <input>","suites":["Can hot reload CSS Module without losing state"],"updatePoint":{"line":205,"column":56},"line":205,"code":"  it('should update CSS color without remounting <input>', async () => {\n    const browser = await webdriver(appPort, '/')\n\n    const desiredText = 'hello world'\n    await browser.elementById('text-input').type(desiredText)\n    expect(await browser.elementById('text-input').getValue()).toBe(desiredText)\n\n    const currentColor = await browser.eval(\n      `window.getComputedStyle(document.querySelector('#verify-red')).color`\n    )\n    expect(currentColor).toMatchInlineSnapshot(`\"rgb(255, 0, 0)\"`)\n\n    const cssFile = new File(join(appDir, 'pages/index.module.css'))\n    try {\n      cssFile.replace('color: red', 'color: purple')\n      await waitFor(2000) // wait for HMR\n\n      const refreshedColor = await browser.eval(\n        `window.getComputedStyle(document.querySelector('#verify-red')).color`\n      )\n      expect(refreshedColor).toMatchInlineSnapshot(`\"rgb(128, 0, 128)\"`)\n\n      // ensure text remained\n      expect(await browser.elementById('text-input').getValue()).toBe(\n        desiredText\n      )\n    } finally {\n      cssFile.restore()\n    }\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail to build","suites":["Invalid CSS Module Usage in node_modules"],"updatePoint":{"line":244,"column":26},"line":244,"code":"  it('should fail to build', async () => {\n    const { code, stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n    })\n    expect(code).not.toBe(0)\n    expect(stderr).toContain('Failed to compile')\n    expect(stderr).toContain('node_modules/example/index.module.css')\n    expect(stderr).toMatch(\n      /CSS Modules.*cannot.*be imported from within.*node_modules/\n    )\n    expect(stderr).toMatch(/Location:.*node_modules[\\\\/]example[\\\\/]index\\.mjs/)\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail to build","suites":["Invalid Global CSS Module Usage in node_modules"],"updatePoint":{"line":265,"column":26},"line":265,"code":"  it('should fail to build', async () => {\n    const { code, stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n    })\n    expect(code).not.toBe(0)\n    expect(stderr).toContain('Failed to compile')\n    expect(stderr).toContain('node_modules/example/index.css')\n    expect(stderr).toMatch(\n      /Global CSS.*cannot.*be imported from within.*node_modules/\n    )\n    expect(stderr).toMatch(/Location:.*node_modules[\\\\/]example[\\\\/]index\\.mjs/)\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["Valid CSS Module Usage from within node_modules"],"updatePoint":{"line":302,"column":39},"line":302,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've prerendered with relevant data","suites":["Valid CSS Module Usage from within node_modules"],"updatePoint":{"line":307,"column":46},"line":307,"code":"  it(`should've prerendered with relevant data`, async () => {\n    const content = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(content)\n\n    const cssPreload = $('#nm-div')\n    expect(cssPreload.text()).toMatchInlineSnapshot(\n      `\"{\\\\\"message\\\\\":\\\\\"Why hello there\\\\\"} {\\\\\"redText\\\\\":\\\\\"example_redText__lIU4W\\\\\"}\"`\n    )\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["Valid CSS Module Usage from within node_modules"],"updatePoint":{"line":317,"column":41},"line":317,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\".example_redText__lIU4W{color:red}\"`\n    )\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["Valid Nested CSS Module Usage from within node_modules"],"updatePoint":{"line":355,"column":39},"line":355,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've prerendered with relevant data","suites":["Valid Nested CSS Module Usage from within node_modules"],"updatePoint":{"line":360,"column":46},"line":360,"code":"  it(`should've prerendered with relevant data`, async () => {\n    const content = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(content)\n\n    const cssPreload = $('#nm-div')\n    expect(cssPreload.text()).toMatchInlineSnapshot(\n      `\"{\\\\\"message\\\\\":\\\\\"Why hello there\\\\\"} {\\\\\"subClass\\\\\":\\\\\"example_subClass__ak_R4 other_className__hfPre\\\\\"}\"`\n    )\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["Valid Nested CSS Module Usage from within node_modules"],"updatePoint":{"line":370,"column":41},"line":370,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\".other2_other2__n0niK{color:red}.other3_other3__5PqwU{color:violet}.other_className__hfPre{background:red;color:#ff0}.example_subClass__ak_R4{background:blue}\"`\n    )\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["CSS Module Composes Usage (Basic)"],"updatePoint":{"line":398,"column":39},"line":398,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["CSS Module Composes Usage (Basic)"],"updatePoint":{"line":403,"column":41},"line":403,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\".index_className___fnCf{background:red;color:#ff0}.index_subClass__3ZQHz{background:blue}\"`\n    )\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["CSS Module Composes Usage (External)"],"updatePoint":{"line":431,"column":39},"line":431,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["CSS Module Composes Usage (External)"],"updatePoint":{"line":436,"column":41},"line":436,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\".other_className__3Kqmr{background:red;color:#ff0}.index_subClass__3ZQHz{background:blue}\"`\n    )\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["Dynamic Route CSS Module Usage"],"updatePoint":{"line":469,"column":39},"line":469,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply styles correctly","suites":["Dynamic Route CSS Module Usage"],"updatePoint":{"line":474,"column":35},"line":474,"code":"  it('should apply styles correctly', async () => {\n    const browser = await webdriver(appPort, '/post-1')\n\n    const background = await browser\n      .elementByCss('#my-div')\n      .getComputedCss('background-color')\n\n    expect(background).toMatch(/rgb(a|)\\(255, 0, 0/)\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["Dynamic Route CSS Module Usage"],"updatePoint":{"line":484,"column":41},"line":484,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\"._post__home__BTqh4{background:red}\"`\n    )\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["Catch-all Route CSS Module Usage"],"updatePoint":{"line":517,"column":39},"line":517,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply styles correctly","suites":["Catch-all Route CSS Module Usage"],"updatePoint":{"line":522,"column":35},"line":522,"code":"  it('should apply styles correctly', async () => {\n    const browser = await webdriver(appPort, '/post-1')\n\n    const bg = await browser\n      .elementByCss('#my-div')\n      .getComputedCss('background-color')\n    expect(bg).toMatch(/rgb(a|)\\(255, 0, 0/)\n\n    const fg = await browser.elementByCss('#my-div').getComputedCss('color')\n    expect(fg).toMatch(/rgb(a|)\\(0, 128, 0/)\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["Catch-all Route CSS Module Usage"],"updatePoint":{"line":534,"column":41},"line":534,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\".___post__home__G40mx{background:red}.__55css_home__OvQYk{color:green}\"`\n    )\n  })","file":"integration/css-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["CSS Support","Basic Global Support"],"updatePoint":{"line":29,"column":35},"line":29,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["CSS Support","Basic Global Support"],"updatePoint":{"line":37,"column":43},"line":37,"code":"    it(`should've emitted a single CSS file`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      expect(await readFile(join(cssFolder, cssFiles[0]), 'utf8')).toContain(\n        'color:red'\n      )\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["CSS Support","Basic Global Support with special characters in path"],"updatePoint":{"line":57,"column":35},"line":57,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["CSS Support","Basic Global Support with special characters in path"],"updatePoint":{"line":65,"column":43},"line":65,"code":"    it(`should've emitted a single CSS file`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      expect(await readFile(join(cssFolder, cssFiles[0]), 'utf8')).toContain(\n        'color:red'\n      )\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["CSS Support","Basic Global Support with src/ dir"],"updatePoint":{"line":85,"column":35},"line":85,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["CSS Support","Basic Global Support with src/ dir"],"updatePoint":{"line":93,"column":43},"line":93,"code":"    it(`should've emitted a single CSS file`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      expect(await readFile(join(cssFolder, cssFiles[0]), 'utf8')).toContain(\n        'color:red'\n      )\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["CSS Support","Multi Global Support"],"updatePoint":{"line":113,"column":35},"line":113,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["CSS Support","Multi Global Support"],"updatePoint":{"line":121,"column":43},"line":121,"code":"    it(`should've emitted a single CSS file`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(\n        cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()\n      ).toMatchInlineSnapshot(`\".red-text{color:red}.blue-text{color:blue}\"`)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["CSS Support","Nested @import() Global Support"],"updatePoint":{"line":142,"column":35},"line":142,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["CSS Support","Nested @import() Global Support"],"updatePoint":{"line":150,"column":43},"line":150,"code":"    it(`should've emitted a single CSS file`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(\n        cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()\n      ).toMatchInlineSnapshot(\n        `\".red-text{color:purple;font-weight:bolder;color:red}.blue-text{color:orange;font-weight:bolder;color:blue}\"`\n      )\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["CSS Support","CSS Compilation and Prefixing"],"updatePoint":{"line":173,"column":35},"line":173,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've compiled and prefixed","suites":["CSS Support","CSS Compilation and Prefixing"],"updatePoint":{"line":181,"column":39},"line":181,"code":"    it(`should've compiled and prefixed`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(\n        cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()\n      ).toMatchInlineSnapshot(\n        `\"@media (min-width:480px) and (max-width:767px){::-moz-placeholder{color:green}:-ms-input-placeholder{color:green}::placeholder{color:green}}.flex-parsing{flex:0 0 calc(50% - var(--vertical-gutter))}.transform-parsing{transform:translate3d(0,0)}.css-grid-shorthand{grid-column:span 2}.g-docs-sidenav .filter::-webkit-input-placeholder{opacity:80%}\"`\n      )\n\n      // Contains a source map\n      expect(cssContent).toMatch(/\\/\\*#\\s*sourceMappingURL=(.+\\.map)\\s*\\*\\//)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a source map","suites":["CSS Support","CSS Compilation and Prefixing"],"updatePoint":{"line":199,"column":38},"line":199,"code":"    it(`should've emitted a source map`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssMapFiles = files.filter((f) => /\\.css\\.map$/.test(f))\n\n      expect(cssMapFiles.length).toBe(1)\n      const cssMapContent = (\n        await readFile(join(cssFolder, cssMapFiles[0]), 'utf8')\n      ).trim()\n\n      const { version, mappings, sourcesContent } = JSON.parse(cssMapContent)\n      expect({ version, mappings, sourcesContent }).toMatchInlineSnapshot(`\n        Object {\n          \"mappings\": \"AAAA,+CACE,mBACE,WACF,CAFA,uBACE,WACF,CAFA,cACE,WACF,CACF,CAEA,cACE,2CACF,CAEA,mBACE,0BACF,CAEA,oBACE,kBACF,CAEA,mDACE,WACF\",\n          \"sourcesContent\": Array [\n            \"@media (480px <= width < 768px) {\n          ::placeholder {\n            color: green;\n          }\n        }\n\n        .flex-parsing {\n          flex: 0 0 calc(50% - var(--vertical-gutter));\n        }\n\n        .transform-parsing {\n          transform: translate3d(0px, 0px);\n        }\n\n        .css-grid-shorthand {\n          grid-column: span 2;\n        }\n\n        .g-docs-sidenav .filter::-webkit-input-placeholder {\n          opacity: 80%;\n        }\n        \",\n          ],\n          \"version\": 3,\n        }\n      `)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["CSS Support","Multi Global Support (reversed)"],"updatePoint":{"line":252,"column":35},"line":252,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["CSS Support","Multi Global Support (reversed)"],"updatePoint":{"line":260,"column":43},"line":260,"code":"    it(`should've emitted a single CSS file`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(\n        cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()\n      ).toMatchInlineSnapshot(`\".blue-text{color:blue}.red-text{color:red}\"`)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should have the correct color on mount after navigation","suites":["CSS Support","React Lifecyce Order (dev)"],"updatePoint":{"line":290,"column":63},"line":290,"code":"    it('should have the correct color on mount after navigation', async () => {\n      let browser\n      try {\n        browser = await webdriver(appPort, '/')\n\n        // Navigate to other:\n        await browser.waitForElementByCss('#link-other').click()\n        const text = await browser.waitForElementByCss('#red-title').text()\n        expect(text).toMatchInlineSnapshot(`\"rgb(255, 0, 0)\"`)\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["CSS Support","React Lifecyce Order (production)"],"updatePoint":{"line":328,"column":41},"line":328,"code":"    it('should have compiled successfully', () => {\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should have the correct color on mount after navigation","suites":["CSS Support","React Lifecyce Order (production)"],"updatePoint":{"line":333,"column":63},"line":333,"code":"    it('should have the correct color on mount after navigation', async () => {\n      let browser\n      try {\n        browser = await webdriver(appPort, '/')\n\n        // Navigate to other:\n        await browser.waitForElementByCss('#link-other').click()\n        const text = await browser.waitForElementByCss('#red-title').text()\n        expect(text).toMatchInlineSnapshot(`\"rgb(255, 0, 0)\"`)\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should fail to build","suites":["CSS Support","Invalid CSS in _document"],"updatePoint":{"line":357,"column":28},"line":357,"code":"    it('should fail to build', async () => {\n      const { code, stderr } = await nextBuild(appDir, [], {\n        stderr: true,\n      })\n      expect(code).not.toBe(0)\n      expect(stderr).toContain('Failed to compile')\n      expect(stderr).toContain('styles.module.css')\n      expect(stderr).toMatch(\n        /CSS.*cannot.*be imported within.*pages[\\\\/]_document\\.js/\n      )\n      expect(stderr).toMatch(/Location:.*pages[\\\\/]_document\\.js/)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should fail to build","suites":["CSS Support","Invalid Global CSS"],"updatePoint":{"line":378,"column":28},"line":378,"code":"    it('should fail to build', async () => {\n      const { code, stderr } = await nextBuild(appDir, [], {\n        stderr: true,\n      })\n      expect(code).not.toBe(0)\n      expect(stderr).toContain('Failed to compile')\n      expect(stderr).toContain('styles/global.css')\n      expect(stderr).toMatch(\n        /Please move all first-party global CSS imports.*?pages(\\/|\\\\)_app/\n      )\n      expect(stderr).toMatch(/Location:.*pages[\\\\/]index\\.js/)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["CSS Support","Valid Global CSS from npm"],"updatePoint":{"line":399,"column":35},"line":399,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["CSS Support","Valid Global CSS from npm"],"updatePoint":{"line":407,"column":43},"line":407,"code":"    it(`should've emitted a single CSS file`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(\n        cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()\n      ).toMatchInlineSnapshot(`\".red-text{color:\\\\\"red\\\\\"}\"`)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should fail to build","suites":["CSS Support","Invalid Global CSS with Custom App"],"updatePoint":{"line":428,"column":28},"line":428,"code":"    it('should fail to build', async () => {\n      const { code, stderr } = await nextBuild(appDir, [], {\n        stderr: true,\n      })\n      expect(code).not.toBe(0)\n      expect(stderr).toContain('Failed to compile')\n      expect(stderr).toContain('styles/global.css')\n      expect(stderr).toMatch(\n        /Please move all first-party global CSS imports.*?pages(\\/|\\\\)_app/\n      )\n      expect(stderr).toMatch(/Location:.*pages[\\\\/]index\\.js/)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should fail to build","suites":["CSS Support","Valid and Invalid Global CSS with Custom App"],"updatePoint":{"line":449,"column":28},"line":449,"code":"    it('should fail to build', async () => {\n      const { code, stderr } = await nextBuild(appDir, [], {\n        stderr: true,\n      })\n      expect(code).not.toBe(0)\n      expect(stderr).toContain('Failed to compile')\n      expect(stderr).toContain('styles/global.css')\n      expect(stderr).toContain('Please move all first-party global CSS imports')\n      expect(stderr).toMatch(/Location:.*pages[\\\\/]index\\.js/)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should update CSS color without remounting <input>","suites":["CSS Support","Can hot reload CSS without losing state"],"updatePoint":{"line":478,"column":58},"line":478,"code":"    it('should update CSS color without remounting <input>', async () => {\n      let browser\n      try {\n        browser = await webdriver(appPort, '/page1')\n\n        const desiredText = 'hello world'\n        await browser.elementById('text-input').type(desiredText)\n        expect(await browser.elementById('text-input').getValue()).toBe(\n          desiredText\n        )\n\n        const currentColor = await browser.eval(\n          `window.getComputedStyle(document.querySelector('.red-text')).color`\n        )\n        expect(currentColor).toMatchInlineSnapshot(`\"rgb(255, 0, 0)\"`)\n\n        const cssFile = new File(join(appDir, 'styles/global1.css'))\n        try {\n          cssFile.replace('color: red', 'color: purple')\n\n          await check(\n            () =>\n              browser.eval(\n                `window.getComputedStyle(document.querySelector('.red-text')).color`\n              ),\n            'rgb(128, 0, 128)'\n          )\n\n          // ensure text remained\n          expect(await browser.elementById('text-input').getValue()).toBe(\n            desiredText\n          )\n        } finally {\n          cssFile.restore()\n        }\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should have CSS for page","suites":["CSS Support","Has CSS in computed styles in Development"],"updatePoint":{"line":538,"column":32},"line":538,"code":"    it('should have CSS for page', async () => {\n      let browser\n      try {\n        browser = await webdriver(appPort, '/page2')\n\n        const currentColor = await browser.eval(\n          `window.getComputedStyle(document.querySelector('.blue-text')).color`\n        )\n        expect(currentColor).toMatchInlineSnapshot(`\"rgb(0, 0, 255)\"`)\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should have body visible","suites":["CSS Support","Body is not hidden when unused in Development"],"updatePoint":{"line":572,"column":32},"line":572,"code":"    it('should have body visible', async () => {\n      let browser\n      try {\n        browser = await webdriver(appPort, '/')\n        const currentDisplay = await browser.eval(\n          `window.getComputedStyle(document.querySelector('body')).display`\n        )\n        expect(currentDisplay).toBe('block')\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should have body visible","suites":["CSS Support","Body is not hidden when broken in Development"],"updatePoint":{"line":602,"column":32},"line":602,"code":"    it('should have body visible', async () => {\n      const pageFile = new File(join(appDir, 'pages/index.js'))\n      let browser\n      try {\n        pageFile.replace('<div />', '<div>')\n        await waitFor(2000) // wait for recompile\n\n        browser = await webdriver(appPort, '/')\n        const currentDisplay = await browser.eval(\n          `window.getComputedStyle(document.querySelector('body')).display`\n        )\n        expect(currentDisplay).toBe('block')\n      } finally {\n        pageFile.restore()\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["CSS Support","Has CSS in computed styles in Production"],"updatePoint":{"line":642,"column":41},"line":642,"code":"    it('should have compiled successfully', () => {\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should have CSS for page","suites":["CSS Support","Has CSS in computed styles in Production"],"updatePoint":{"line":647,"column":32},"line":647,"code":"    it('should have CSS for page', async () => {\n      const browser = await webdriver(appPort, '/page2')\n\n      const currentColor = await browser.eval(\n        `window.getComputedStyle(document.querySelector('.blue-text')).color`\n      )\n      expect(currentColor).toMatchInlineSnapshot(`\"rgb(0, 0, 255)\"`)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've preloaded the CSS file and injected it in <head>","suites":["CSS Support","Has CSS in computed styles in Production"],"updatePoint":{"line":656,"column":66},"line":656,"code":"    it(`should've preloaded the CSS file and injected it in <head>`, async () => {\n      const content = await renderViaHTTP(appPort, '/page2')\n      const $ = cheerio.load(content)\n\n      const cssPreload = $('link[rel=\"preload\"][as=\"style\"]')\n      expect(cssPreload.length).toBe(1)\n      expect(cssPreload.attr('href')).toMatch(/^\\/_next\\/static\\/css\\/.*\\.css$/)\n\n      const cssSheet = $('link[rel=\"stylesheet\"]')\n      expect(cssSheet.length).toBe(1)\n      expect(cssSheet.attr('href')).toMatch(/^\\/_next\\/static\\/css\\/.*\\.css$/)\n\n      /* ensure CSS preloaded first */\n      const allPreloads = [].slice.call($('link[rel=\"preload\"]'))\n      const styleIndexes = allPreloads.flatMap((p, i) =>\n        p.attribs.as === 'style' ? i : []\n      )\n      expect(styleIndexes).toEqual([0])\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["CSS Support","CSS URL via `file-loader`"],"updatePoint":{"line":684,"column":35},"line":684,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've emitted expected files","suites":["CSS Support","CSS URL via `file-loader`"],"updatePoint":{"line":692,"column":40},"line":692,"code":"    it(`should've emitted expected files`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n      const mediaFolder = join(appDir, '.next/static/media')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatch(\n        /^\\.red-text\\{color:red;background-image:url\\(\\/_next\\/static\\/media\\/dark\\.[a-f0-9]{8}\\.svg\\) url\\(\\/_next\\/static\\/media\\/dark2\\.[a-f0-9]{8}\\.svg\\)\\}\\.blue-text\\{color:orange;font-weight:bolder;background-image:url\\(\\/_next\\/static\\/media\\/light\\.[a-f0-9]{8}\\.svg\\);color:blue\\}$/\n      )\n\n      const mediaFiles = await readdir(mediaFolder)\n      expect(mediaFiles.length).toBe(3)\n      expect(\n        mediaFiles\n          .map((fileName) =>\n            /^(.+?)\\..{8}\\.(.+?)$/.exec(fileName).slice(1).join('.')\n          )\n          .sort()\n      ).toMatchInlineSnapshot(`\n        Array [\n          \"dark.svg\",\n          \"dark2.svg\",\n          \"light.svg\",\n        ]\n      `)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["CSS Support","CSS URL via `file-loader` and asset prefix (1)"],"updatePoint":{"line":730,"column":35},"line":730,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've emitted expected files","suites":["CSS Support","CSS URL via `file-loader` and asset prefix (1)"],"updatePoint":{"line":738,"column":40},"line":738,"code":"    it(`should've emitted expected files`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n      const mediaFolder = join(appDir, '.next/static/media')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatch(\n        /^\\.red-text\\{color:red;background-image:url\\(\\/foo\\/_next\\/static\\/media\\/dark\\.[a-f0-9]{8}\\.svg\\) url\\(\\/foo\\/_next\\/static\\/media\\/dark2\\.[a-f0-9]{8}\\.svg\\)\\}\\.blue-text\\{color:orange;font-weight:bolder;background-image:url\\(\\/foo\\/_next\\/static\\/media\\/light\\.[a-f0-9]{8}\\.svg\\);color:blue\\}$/\n      )\n\n      const mediaFiles = await readdir(mediaFolder)\n      expect(mediaFiles.length).toBe(3)\n      expect(\n        mediaFiles\n          .map((fileName) =>\n            /^(.+?)\\..{8}\\.(.+?)$/.exec(fileName).slice(1).join('.')\n          )\n          .sort()\n      ).toMatchInlineSnapshot(`\n        Array [\n          \"dark.svg\",\n          \"dark2.svg\",\n          \"light.svg\",\n        ]\n      `)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["CSS Support","CSS URL via `file-loader` and asset prefix (2)"],"updatePoint":{"line":776,"column":35},"line":776,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've emitted expected files","suites":["CSS Support","CSS URL via `file-loader` and asset prefix (2)"],"updatePoint":{"line":784,"column":40},"line":784,"code":"    it(`should've emitted expected files`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n      const mediaFolder = join(appDir, '.next/static/media')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatch(\n        /^\\.red-text\\{color:red;background-image:url\\(\\/foo\\/_next\\/static\\/media\\/dark\\.[a-f0-9]{8}\\.svg\\) url\\(\\/foo\\/_next\\/static\\/media\\/dark2\\.[a-f0-9]{8}\\.svg\\)\\}\\.blue-text\\{color:orange;font-weight:bolder;background-image:url\\(\\/foo\\/_next\\/static\\/media\\/light\\.[a-f0-9]{8}\\.svg\\);color:blue\\}$/\n      )\n\n      const mediaFiles = await readdir(mediaFolder)\n      expect(mediaFiles.length).toBe(3)\n      expect(\n        mediaFiles\n          .map((fileName) =>\n            /^(.+?)\\..{8}\\.(.+?)$/.exec(fileName).slice(1).join('.')\n          )\n          .sort()\n      ).toMatchInlineSnapshot(`\n        Array [\n          \"dark.svg\",\n          \"dark2.svg\",\n          \"light.svg\",\n        ]\n      `)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["CSS Support","Good CSS Import from node_modules"],"updatePoint":{"line":822,"column":35},"line":822,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["CSS Support","Good CSS Import from node_modules"],"updatePoint":{"line":830,"column":43},"line":830,"code":"    it(`should've emitted a single CSS file`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatch(/nprogress/)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["CSS Support","Good Nested CSS Import from node_modules"],"updatePoint":{"line":849,"column":35},"line":849,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["CSS Support","Good Nested CSS Import from node_modules"],"updatePoint":{"line":857,"column":43},"line":857,"code":"    it(`should've emitted a single CSS file`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(\n        cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()\n      ).toMatchInlineSnapshot(`\".other{color:blue}.test{color:red}\"`)\n    })","file":"integration/css/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should fail the build","suites":["CSS Support","CSS Import from node_modules"],"updatePoint":{"line":29,"column":29},"line":29,"code":"    it('should fail the build', async () => {\n      const { code, stderr } = await nextBuild(appDir, [], { stderr: true })\n\n      expect(code).toBe(0)\n      expect(stderr).not.toMatch(/Can't resolve '[^']*?nprogress[^']*?'/)\n      expect(stderr).not.toMatch(/Build error occurred/)\n    })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have the correct color (css ordering)","suites":["CSS Support","Ordering with styled-jsx (dev)"],"updatePoint":{"line":52,"column":52},"line":52,"code":"    it('should have the correct color (css ordering)', async () => {\n      const browser = await webdriver(appPort, '/')\n\n      const currentColor = await browser.eval(\n        `window.getComputedStyle(document.querySelector('.my-text')).color`\n      )\n      expect(currentColor).toMatchInlineSnapshot(`\"rgb(0, 128, 0)\"`)\n    })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["CSS Support","Ordering with styled-jsx (prod)"],"updatePoint":{"line":81,"column":41},"line":81,"code":"    it('should have compiled successfully', () => {\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have the correct color (css ordering)","suites":["CSS Support","Ordering with styled-jsx (prod)"],"updatePoint":{"line":86,"column":52},"line":86,"code":"    it('should have the correct color (css ordering)', async () => {\n      const browser = await webdriver(appPort, '/')\n\n      const currentColor = await browser.eval(\n        `window.getComputedStyle(document.querySelector('.my-text')).color`\n      )\n      expect(currentColor).toMatchInlineSnapshot(`\"rgb(0, 128, 0)\"`)\n    })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should not execute scripts in any order","suites":["CSS Support","Ordering with Global CSS and Modules (dev)"],"updatePoint":{"line":110,"column":47},"line":110,"code":"    it('should not execute scripts in any order', async () => {\n      const content = await renderViaHTTP(appPort, '/')\n      const $ = cheerio.load(content)\n\n      let asyncCount = 0\n      let totalCount = 0\n      for (const script of $('script').toArray()) {\n        ++totalCount\n        if ('async' in script.attribs) {\n          ++asyncCount\n        }\n      }\n\n      expect(asyncCount).toBe(0)\n      expect(totalCount).not.toBe(0)\n    })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have the correct color (css ordering)","suites":["CSS Support","Ordering with Global CSS and Modules (dev)"],"updatePoint":{"line":127,"column":52},"line":127,"code":"    it('should have the correct color (css ordering)', async () => {\n      const browser = await webdriver(appPort, '/')\n\n      const currentColor = await browser.eval(\n        `window.getComputedStyle(document.querySelector('#blueText')).color`\n      )\n      expect(currentColor).toMatchInlineSnapshot(`\"rgb(0, 0, 255)\"`)\n    })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have the correct color (css ordering) during hot reloads","suites":["CSS Support","Ordering with Global CSS and Modules (dev)"],"updatePoint":{"line":136,"column":71},"line":136,"code":"    it('should have the correct color (css ordering) during hot reloads', async () => {\n      let browser\n      try {\n        browser = await webdriver(appPort, '/')\n\n        const blueColor = await browser.eval(\n          `window.getComputedStyle(document.querySelector('#blueText')).color`\n        )\n        expect(blueColor).toMatchInlineSnapshot(`\"rgb(0, 0, 255)\"`)\n\n        const yellowColor = await browser.eval(\n          `window.getComputedStyle(document.querySelector('#yellowText')).color`\n        )\n        expect(yellowColor).toMatchInlineSnapshot(`\"rgb(255, 255, 0)\"`)\n\n        const cssFile = new File(join(appDir, 'pages/index.module.css'))\n        try {\n          cssFile.replace('color: yellow;', 'color: rgb(1, 1, 1);')\n          await check(\n            () =>\n              browser.eval(\n                `window.getComputedStyle(document.querySelector('#yellowText')).color`\n              ),\n            'rgb(1, 1, 1)'\n          )\n          await check(\n            () =>\n              browser.eval(\n                `window.getComputedStyle(document.querySelector('#blueText')).color`\n              ),\n            'rgb(0, 0, 255)'\n          )\n        } finally {\n          cssFile.restore()\n        }\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["CSS Support","Ordering with Global CSS and Modules (prod)"],"updatePoint":{"line":198,"column":41},"line":198,"code":"    it('should have compiled successfully', () => {\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have the correct color (css ordering)","suites":["CSS Support","Ordering with Global CSS and Modules (prod)"],"updatePoint":{"line":203,"column":52},"line":203,"code":"    it('should have the correct color (css ordering)', async () => {\n      const browser = await webdriver(appPort, '/')\n\n      const currentColor = await browser.eval(\n        `window.getComputedStyle(document.querySelector('#blueText')).color`\n      )\n      expect(currentColor).toMatchInlineSnapshot(`\"rgb(0, 0, 255)\"`)\n    })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["CSS Support","CSS Property Ordering"],"updatePoint":{"line":233,"column":41},"line":233,"code":"    it('should have compiled successfully', () => {\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have the border width (property ordering)","suites":["CSS Support","CSS Property Ordering"],"updatePoint":{"line":238,"column":56},"line":238,"code":"    it('should have the border width (property ordering)', async () => {\n      const browser = await webdriver(appPort, '/')\n\n      const width1 = await browser.eval(\n        `window.getComputedStyle(document.querySelector('.test1')).borderWidth`\n      )\n      expect(width1).toMatchInlineSnapshot(`\"0px\"`)\n\n      const width2 = await browser.eval(\n        `window.getComputedStyle(document.querySelector('.test2')).borderWidth`\n      )\n      expect(width2).toMatchInlineSnapshot(`\"5px\"`)\n    })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["CSS Support","Basic Tailwind CSS"],"updatePoint":{"line":260,"column":35},"line":260,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n      expect(stdout).toContain('.css')\n    })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should've compiled and prefixed","suites":["CSS Support","Basic Tailwind CSS"],"updatePoint":{"line":269,"column":39},"line":269,"code":"    it(`should've compiled and prefixed`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n      expect(cssContent).toMatch(/object-right-bottom/) // look for tailwind's CSS\n      expect(cssContent).not.toMatch(/tailwind/) // ensure @tailwind was removed\n\n      // Contains a source map\n      expect(cssContent).toMatch(/\\/\\*#\\s*sourceMappingURL=(.+\\.map)\\s*\\*\\//)\n    })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a source map","suites":["CSS Support","Basic Tailwind CSS"],"updatePoint":{"line":285,"column":38},"line":285,"code":"    it(`should've emitted a source map`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssMapFiles = files.filter((f) => /\\.css\\.map$/.test(f))\n\n      expect(cssMapFiles.length).toBe(1)\n    })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["CSS Support","Tailwind and Purge CSS"],"updatePoint":{"line":302,"column":35},"line":302,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should've compiled and prefixed","suites":["CSS Support","Tailwind and Purge CSS"],"updatePoint":{"line":310,"column":39},"line":310,"code":"    it(`should've compiled and prefixed`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n      expect(cssContent).not.toMatch(/object-right-bottom/) // this was unused and should be gone\n      expect(cssContent).toMatch(/text-blue-500/) // this was used\n      expect(cssContent).not.toMatch(/tailwind/) // ensure @tailwind was removed\n\n      // Contains a source map\n      expect(cssContent).toMatch(/\\/\\*#\\s*sourceMappingURL=(.+\\.map)\\s*\\*\\//)\n    })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a source map","suites":["CSS Support","Tailwind and Purge CSS"],"updatePoint":{"line":327,"column":38},"line":327,"code":"    it(`should've emitted a source map`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssMapFiles = files.filter((f) => /\\.css\\.map$/.test(f))\n\n      expect(cssMapFiles.length).toBe(1)\n    })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have correct color on index page (on load)","suites":["CSS Support","CSS page transition inject <style> with nonce so it works with CSP header"],"updatePoint":{"line":358,"column":59},"line":358,"code":"      it('should have correct color on index page (on load)', async () => {\n        const browser = await webdriver(appPort, '/')\n        try {\n          await checkGreenTitle(browser)\n        } finally {\n          await browser.close()\n        }\n      })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have correct color on index page (on hover)","suites":["CSS Support","CSS page transition inject <style> with nonce so it works with CSP header"],"updatePoint":{"line":367,"column":60},"line":367,"code":"      it('should have correct color on index page (on hover)', async () => {\n        const browser = await webdriver(appPort, '/')\n        try {\n          await checkGreenTitle(browser)\n          await browser.waitForElementByCss('#link-other').moveTo()\n          await waitFor(2000)\n          await checkGreenTitle(browser)\n        } finally {\n          await browser.close()\n        }\n      })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should not change color on hover","suites":["CSS Support","CSS page transition inject <style> with nonce so it works with CSP header"],"updatePoint":{"line":379,"column":42},"line":379,"code":"      it('should not change color on hover', async () => {\n        const browser = await webdriver(appPort, '/')\n        try {\n          await checkGreenTitle(browser)\n          await browser.waitForElementByCss('#link-other').moveTo()\n          await waitFor(2000)\n          await checkGreenTitle(browser)\n        } finally {\n          await browser.close()\n        }\n      })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have correct CSS injection order","suites":["CSS Support","CSS page transition inject <style> with nonce so it works with CSP header"],"updatePoint":{"line":391,"column":49},"line":391,"code":"      it('should have correct CSS injection order', async () => {\n        const browser = await webdriver(appPort, '/')\n        try {\n          await checkGreenTitle(browser)\n\n          const prevSiblingHref = await browser.eval(\n            `document.querySelector('link[rel=stylesheet][data-n-p]').previousSibling.getAttribute('href')`\n          )\n          const currentPageHref = await browser.eval(\n            `document.querySelector('link[rel=stylesheet][data-n-p]').getAttribute('href')`\n          )\n          expect(prevSiblingHref).toBeDefined()\n          expect(prevSiblingHref).toBe(currentPageHref)\n\n          // Navigate to other:\n          await browser.waitForElementByCss('#link-other').click()\n          await checkBlueTitle(browser)\n\n          const newPrevSibling = await browser.eval(\n            `document.querySelector('style[data-n-href]').previousSibling.getAttribute('data-n-css')`\n          )\n          const newPageHref = await browser.eval(\n            `document.querySelector('style[data-n-href]').getAttribute('data-n-href')`\n          )\n          expect(newPrevSibling).toBe('VmVyY2Vs')\n          expect(newPageHref).toBeDefined()\n          expect(newPageHref).not.toBe(currentPageHref)\n\n          // Navigate to home:\n          await browser.waitForElementByCss('#link-index').click()\n          await checkGreenTitle(browser)\n\n          const newPrevSibling2 = await browser.eval(\n            `document.querySelector('style[data-n-href]').previousSibling.getAttribute('data-n-css')`\n          )\n          const newPageHref2 = await browser.eval(\n            `document.querySelector('style[data-n-href]').getAttribute('data-n-href')`\n          )\n          expect(newPrevSibling2).toBeTruthy()\n          expect(newPageHref2).toBeDefined()\n          expect(newPageHref2).toBe(currentPageHref)\n        } finally {\n          await browser.close()\n        }\n      })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have correct color on index page (on nav from index)","suites":["CSS Support","CSS page transition inject <style> with nonce so it works with CSP header"],"updatePoint":{"line":437,"column":69},"line":437,"code":"      it('should have correct color on index page (on nav from index)', async () => {\n        const browser = await webdriver(appPort, '/')\n        try {\n          await checkGreenTitle(browser)\n          await browser.waitForElementByCss('#link-other').click()\n\n          // Wait for navigation:\n          await browser.waitForElementByCss('#link-index')\n          await checkBlueTitle(browser)\n\n          // Navigate back to index:\n          await browser.waitForElementByCss('#link-index').click()\n          await checkGreenTitle(browser)\n        } finally {\n          await browser.close()\n        }\n      })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have correct color on index page (on nav from other)","suites":["CSS Support","CSS page transition inject <style> with nonce so it works with CSP header"],"updatePoint":{"line":455,"column":69},"line":455,"code":"      it('should have correct color on index page (on nav from other)', async () => {\n        const browser = await webdriver(appPort, '/other')\n        try {\n          await checkBlueTitle(browser)\n          await browser.waitForElementByCss('#link-index').click()\n\n          // Wait for navigation:\n          await browser.waitForElementByCss('#link-other')\n          await checkGreenTitle(browser)\n\n          // Navigate back to other:\n          await browser.waitForElementByCss('#link-other').click()\n          await checkBlueTitle(browser)\n        } finally {\n          await browser.close()\n        }\n      })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have correct color on index page (on load)","suites":["CSS Support","CSS Modules Composes Ordering"],"updatePoint":{"line":512,"column":59},"line":512,"code":"      it('should have correct color on index page (on load)', async () => {\n        const browser = await webdriver(appPort, '/')\n        try {\n          await checkBlackTitle(browser)\n        } finally {\n          await browser.close()\n        }\n      })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have correct color on index page (on hover)","suites":["CSS Support","CSS Modules Composes Ordering"],"updatePoint":{"line":521,"column":60},"line":521,"code":"      it('should have correct color on index page (on hover)', async () => {\n        const browser = await webdriver(appPort, '/')\n        try {\n          await checkBlackTitle(browser)\n          await browser.waitForElementByCss('#link-other').moveTo()\n          await waitFor(2000)\n          await checkBlackTitle(browser)\n        } finally {\n          await browser.close()\n        }\n      })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should not change color on hover","suites":["CSS Support","CSS Modules Composes Ordering"],"updatePoint":{"line":534,"column":44},"line":534,"code":"        it('should not change color on hover', async () => {\n          const browser = await webdriver(appPort, '/')\n          try {\n            await checkBlackTitle(browser)\n            await browser.waitForElementByCss('#link-other').moveTo()\n            await waitFor(2000)\n            await checkBlackTitle(browser)\n          } finally {\n            await browser.close()\n          }\n        })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have correct CSS injection order","suites":["CSS Support","CSS Modules Composes Ordering"],"updatePoint":{"line":546,"column":51},"line":546,"code":"        it('should have correct CSS injection order', async () => {\n          const browser = await webdriver(appPort, '/')\n          try {\n            await checkBlackTitle(browser)\n\n            const prevSiblingHref = await browser.eval(\n              `document.querySelector('link[rel=stylesheet][data-n-p]').previousSibling.getAttribute('href')`\n            )\n            const currentPageHref = await browser.eval(\n              `document.querySelector('link[rel=stylesheet][data-n-p]').getAttribute('href')`\n            )\n            expect(prevSiblingHref).toBeDefined()\n            expect(prevSiblingHref).toBe(currentPageHref)\n\n            // Navigate to other:\n            await browser.waitForElementByCss('#link-other').click()\n            await checkRedTitle(browser)\n\n            const newPrevSibling = await browser.eval(\n              `document.querySelector('style[data-n-href]').previousSibling.getAttribute('data-n-css')`\n            )\n            const newPageHref = await browser.eval(\n              `document.querySelector('style[data-n-href]').getAttribute('data-n-href')`\n            )\n            expect(newPrevSibling).toBe('')\n            expect(newPageHref).toBeDefined()\n            expect(newPageHref).not.toBe(currentPageHref)\n\n            // Navigate to home:\n            await browser.waitForElementByCss('#link-index').click()\n            await checkBlackTitle(browser)\n\n            const newPrevSibling2 = await browser.eval(\n              `document.querySelector('style[data-n-href]').previousSibling.getAttribute('data-n-css')`\n            )\n            const newPageHref2 = await browser.eval(\n              `document.querySelector('style[data-n-href]').getAttribute('data-n-href')`\n            )\n            expect(newPrevSibling2).toBe('')\n            expect(newPageHref2).toBeDefined()\n            expect(newPageHref2).toBe(currentPageHref)\n          } finally {\n            await browser.close()\n          }\n        })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have correct color on index page (on nav from index)","suites":["CSS Support","CSS Modules Composes Ordering"],"updatePoint":{"line":593,"column":69},"line":593,"code":"      it('should have correct color on index page (on nav from index)', async () => {\n        const browser = await webdriver(appPort, '/')\n        try {\n          await checkBlackTitle(browser)\n          await browser.waitForElementByCss('#link-other').click()\n\n          // Wait for navigation:\n          await browser.waitForElementByCss('#link-index')\n          await checkRedTitle(browser)\n\n          // Navigate back to index:\n          await browser.waitForElementByCss('#link-index').click()\n          await checkBlackTitle(browser)\n        } finally {\n          await browser.close()\n        }\n      })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have correct color on index page (on nav from other)","suites":["CSS Support","CSS Modules Composes Ordering"],"updatePoint":{"line":611,"column":69},"line":611,"code":"      it('should have correct color on index page (on nav from other)', async () => {\n        const browser = await webdriver(appPort, '/other')\n        try {\n          await checkRedTitle(browser)\n          await browser.waitForElementByCss('#link-index').click()\n\n          // Wait for navigation:\n          await browser.waitForElementByCss('#link-other')\n          await checkBlackTitle(browser)\n\n          // Navigate back to other:\n          await browser.waitForElementByCss('#link-other').click()\n          await checkRedTitle(browser)\n        } finally {\n          await browser.close()\n        }\n      })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"not have intermediary page styles on error rendering","suites":["CSS Support","CSS Cleanup on Render Failure"],"updatePoint":{"line":675,"column":62},"line":675,"code":"      it('not have intermediary page styles on error rendering', async () => {\n        const browser = await webdriver(appPort, '/')\n        try {\n          await checkBlackTitle(browser)\n\n          const currentPageStyles = await browser.eval(\n            `document.querySelector('link[rel=stylesheet][data-n-p]')`\n          )\n          expect(currentPageStyles).toBeDefined()\n\n          // Navigate to other:\n          await browser.waitForElementByCss('#link-other').click()\n          await check(\n            () => browser.eval(`document.body.innerText`),\n            'Application error: a client-side exception has occurred (see the browser console for more information).',\n            true\n          )\n\n          const newPageStyles = await browser.eval(\n            `document.querySelector('link[rel=stylesheet][data-n-p]')`\n          )\n          expect(newPageStyles).toBeFalsy()\n\n          const allPageStyles = await browser.eval(\n            `document.querySelector('link[rel=stylesheet]')`\n          )\n          expect(allPageStyles).toBeFalsy()\n        } finally {\n          await browser.close()\n        }\n      })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should fall back to server-side transition on missing CSS","suites":["CSS Support","Page reload on CSS missing"],"updatePoint":{"line":738,"column":67},"line":738,"code":"      it('should fall back to server-side transition on missing CSS', async () => {\n        const browser = await webdriver(appPort, '/')\n        try {\n          await checkBlackTitle(browser)\n          await browser.eval(`window.__priorNavigatePageState = 'OOF';`)\n\n          // Navigate to other:\n          await browser.waitForElementByCss('#link-other').click()\n          // Wait for navigation:\n          await browser.waitForElementByCss('#link-index')\n\n          const state = await browser.eval(`window.__priorNavigatePageState`)\n          expect(state).toBeFalsy()\n        } finally {\n          await browser.close()\n        }\n      })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should hydrate black without dependencies manifest","suites":["CSS Support","Page hydrates with CSS and not waiting on dependencies"],"updatePoint":{"line":804,"column":60},"line":804,"code":"      it('should hydrate black without dependencies manifest', async () => {\n        const browser = await webdriver(appPort, '/')\n        try {\n          await checkBlackTitle(browser)\n          await check(\n            () => browser.eval(`document.querySelector('p').innerText`),\n            'mounted'\n          )\n        } finally {\n          await browser.close()\n        }\n      })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should hydrate red without dependencies manifest","suites":["CSS Support","Page hydrates with CSS and not waiting on dependencies"],"updatePoint":{"line":817,"column":58},"line":817,"code":"      it('should hydrate red without dependencies manifest', async () => {\n        const browser = await webdriver(appPort, '/client')\n        try {\n          await checkRedTitle(browser)\n          await check(\n            () => browser.eval(`document.querySelector('p').innerText`),\n            'mounted'\n          )\n        } finally {\n          await browser.close()\n        }\n      })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should route from black to red without dependencies","suites":["CSS Support","Page hydrates with CSS and not waiting on dependencies"],"updatePoint":{"line":830,"column":61},"line":830,"code":"      it('should route from black to red without dependencies', async () => {\n        const browser = await webdriver(appPort, '/')\n        try {\n          await checkBlackTitle(browser)\n          await check(\n            () => browser.eval(`document.querySelector('p').innerText`),\n            'mounted'\n          )\n          await browser.eval(`document.querySelector('#link-client').click()`)\n          await checkRedTitle(browser)\n          await check(\n            () => browser.eval(`document.querySelector('p').innerText`),\n            'mounted'\n          )\n        } finally {\n          await browser.close()\n        }\n      })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have correct color on index page (on load)","suites":["CSS Support","Basic CSS Modules Ordering"],"updatePoint":{"line":902,"column":59},"line":902,"code":"      it('should have correct color on index page (on load)', async () => {\n        const browser = await webdriver(appPort, '/')\n        try {\n          await checkGreenButton(browser)\n        } finally {\n          await browser.close()\n        }\n      })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have correct color on index page (on hover)","suites":["CSS Support","Basic CSS Modules Ordering"],"updatePoint":{"line":911,"column":60},"line":911,"code":"      it('should have correct color on index page (on hover)', async () => {\n        const browser = await webdriver(appPort, '/')\n        try {\n          await checkGreenButton(browser)\n          await browser.waitForElementByCss('#link-other').moveTo()\n          await waitFor(2000)\n          await checkGreenButton(browser)\n        } finally {\n          await browser.close()\n        }\n      })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have correct color on index page (on nav)","suites":["CSS Support","Basic CSS Modules Ordering"],"updatePoint":{"line":923,"column":58},"line":923,"code":"      it('should have correct color on index page (on nav)', async () => {\n        const browser = await webdriver(appPort, '/')\n        try {\n          await checkGreenButton(browser)\n          await browser.waitForElementByCss('#link-other').click()\n\n          // Wait for navigation:\n          await browser.waitForElementByCss('#link-index')\n          await checkPinkButton(browser)\n\n          // Navigate back to index:\n          await browser.waitForElementByCss('#link-index').click()\n          await checkGreenButton(browser)\n        } finally {\n          await browser.close()\n        }\n      })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should build correctly","suites":["CSS Support","should handle unresolved files gracefully"],"updatePoint":{"line":977,"column":30},"line":977,"code":"    it('should build correctly', async () => {\n      await remove(join(workDir, '.next'))\n      const { code } = await nextBuild(workDir)\n      expect(code).toBe(0)\n    })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have correct file references in CSS output","suites":["CSS Support","should handle unresolved files gracefully"],"updatePoint":{"line":983,"column":57},"line":983,"code":"    it('should have correct file references in CSS output', async () => {\n      const cssFiles = await readdir(join(workDir, '.next/static/css'))\n\n      for (const file of cssFiles) {\n        if (file.endsWith('.css.map')) continue\n\n        const content = await readFile(\n          join(workDir, '.next/static/css', file),\n          'utf8'\n        )\n        console.log(file, content)\n\n        // if it is the combined global CSS file there are double the expected\n        // results\n        const howMany = content.includes('p{') || content.includes('p,') ? 2 : 1\n\n        expect(content.match(/\\(\\/vercel\\.svg/g).length).toBe(howMany)\n        // expect(content.match(/\\(vercel\\.svg/g).length).toBe(howMany)\n        expect(content.match(/\\(\\/_next\\/static\\/media/g).length).toBe(1)\n        expect(content.match(/\\(https:\\/\\//g).length).toBe(howMany)\n      }\n    })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["CSS Support","Data URLs"],"updatePoint":{"line":1010,"column":35},"line":1010,"code":"    it('should compile successfully', async () => {\n      await remove(join(workDir, '.next'))\n      const { code } = await nextBuild(workDir)\n      expect(code).toBe(0)\n    })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have emitted expected files","suites":["CSS Support","Data URLs"],"updatePoint":{"line":1016,"column":42},"line":1016,"code":"    it('should have emitted expected files', async () => {\n      const cssFolder = join(workDir, '.next/static/css')\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatch(\n        /background:url\\(\"data:[^\"]+\"\\)/\n      )\n    })","file":"integration/css/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should handle errors from _error render","suites":["Custom error page exception"],"updatePoint":{"line":25,"column":45},"line":25,"code":"  it('should handle errors from _error render', async () => {\n    const navSel = '#nav'\n    const browser = await webdriver(appPort, '/')\n    await browser.waitForElementByCss(navSel).elementByCss(navSel).click()\n\n    await check(\n      () => browser.eval('document.documentElement.innerHTML'),\n      /Application error: a client-side exception has occurred/\n    )\n  })","file":"integration/custom-error-page-exception/test/index.test.js","skipped":false,"dir":"test"},{"name":"renders custom _error successfully","suites":[],"updatePoint":{"line":21,"column":40},"line":21,"code":"  it('renders custom _error successfully', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toMatch(/Custom error/)\n  })","file":"integration/custom-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not warn with /_error and /404 when rendering error first","suites":["Custom _error","dev mode 1"],"updatePoint":{"line":44,"column":72},"line":44,"code":"    it('should not warn with /_error and /404 when rendering error first', async () => {\n      stderr = ''\n      await fs.writeFile(page404, 'export default <h1>')\n      const html = await renderViaHTTP(appPort, '/404')\n      await fs.remove(page404)\n      expect(html).toContain('Unexpected eof')\n      expect(stderr).not.toMatch(customErrNo404Match)\n    })","file":"integration/custom-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not warn with /_error and /404","suites":["Custom _error","dev mode 2"],"updatePoint":{"line":67,"column":45},"line":67,"code":"    it('should not warn with /_error and /404', async () => {\n      stderr = ''\n      await fs.writeFile(page404, `export default () => 'not found...'`)\n      const html = await renderViaHTTP(appPort, '/404')\n      await fs.remove(page404)\n      expect(html).toContain('not found...')\n      expect(stderr).not.toMatch(customErrNo404Match)\n    })","file":"integration/custom-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should warn on custom /_error without custom /404","suites":["Custom _error","dev mode 2"],"updatePoint":{"line":76,"column":57},"line":76,"code":"    it('should warn on custom /_error without custom /404', async () => {\n      stderr = ''\n      const html = await renderViaHTTP(appPort, '/404')\n      expect(html).toContain('An error 404 occurred on server')\n      expect(stderr).toMatch(customErrNo404Match)\n    })","file":"integration/custom-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not contain /_error in build output","suites":["Custom _error","production mode"],"updatePoint":{"line":98,"column":50},"line":98,"code":"    it('should not contain /_error in build output', async () => {\n      expect(buildOutput).toMatch(/λ .*?\\/404/)\n      expect(buildOutput).not.toMatch(/λ .*?\\/_error/)\n    })","file":"integration/custom-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with normal page","suites":[],"updatePoint":{"line":19,"column":34},"line":19,"code":"  it('should work with normal page', async () => {\n    const html = await renderViaHTTP(appPort, '/blog')\n    expect(html).toContain('Blog - CPE')\n  })","file":"integration/custom-page-extension/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work dynamic page","suites":[],"updatePoint":{"line":24,"column":30},"line":24,"code":"  it('should work dynamic page', async () => {\n    const html = await renderViaHTTP(appPort, '/blog/nextjs')\n    expect(html).toContain('Post - nextjs')\n  })","file":"integration/custom-page-extension/test/index.test.js","skipped":false,"dir":"test"},{"name":"should rewrite and render page correctly","suites":[],"updatePoint":{"line":20,"column":46},"line":20,"code":"  it('should rewrite and render page correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/docs/hello')\n    expect(html).toMatch(/hello world/)\n  })","file":"integration/custom-routes-catchall/test/index.test.js","skipped":false,"dir":"test"},{"name":"should rewrite to /_next/static correctly","suites":[],"updatePoint":{"line":25,"column":47},"line":25,"code":"  it('should rewrite to /_next/static correctly', async () => {\n    const bundlePath = await join(\n      '/docs/_next/static/',\n      buildId,\n      '_buildManifest.js'\n    )\n    const data = await renderViaHTTP(appPort, bundlePath)\n    expect(data).toContain('/hello')\n  })","file":"integration/custom-routes-catchall/test/index.test.js","skipped":false,"dir":"test"},{"name":"should rewrite to public/static correctly","suites":[],"updatePoint":{"line":35,"column":47},"line":35,"code":"  it('should rewrite to public/static correctly', async () => {\n    const data = await renderViaHTTP(appPort, '/docs/static/data.json')\n    expect(data).toContain('some data...')\n  })","file":"integration/custom-routes-catchall/test/index.test.js","skipped":false,"dir":"test"},{"name":"should rewrite to public file correctly","suites":[],"updatePoint":{"line":40,"column":45},"line":40,"code":"  it('should rewrite to public file correctly', async () => {\n    const data = await renderViaHTTP(appPort, '/docs/another.txt')\n    expect(data).toContain('some text')\n  })","file":"integration/custom-routes-catchall/test/index.test.js","skipped":false,"dir":"test"},{"name":"should respond to default locale redirects correctly","suites":[],"updatePoint":{"line":27,"column":58},"line":27,"code":"  it('should respond to default locale redirects correctly', async () => {\n    for (const [path, dest] of [\n      ['/redirect-1', '/destination-1'],\n      ['/en/redirect-1', '/destination-1'],\n      ['/fr/redirect-1', '/fr/destination-1'],\n      ['/nl-NL/redirect-2', '/destination-2'],\n      ['/fr/redirect-2', false],\n    ]) {\n      const res = await fetchViaHTTP(appPort, path, undefined, {\n        redirect: 'manual',\n      })\n\n      expect(res.status).toBe(dest ? 307 : 404)\n\n      if (dest) {\n        const text = await res.text()\n        expect(text).toEqual(dest)\n        if (dest.startsWith('/')) {\n          const parsed = url.parse(res.headers.get('location'))\n          expect(parsed.pathname).toBe(dest)\n          expect(parsed.query).toBe(null)\n        } else {\n          expect(res.headers.get('location')).toBe(dest)\n        }\n      }\n    }\n  })","file":"integration/custom-routes-i18n/test/index.test.js","skipped":false,"dir":"test"},{"name":"should rewrite index routes correctly","suites":[],"updatePoint":{"line":55,"column":43},"line":55,"code":"  it('should rewrite index routes correctly', async () => {\n    for (const path of ['/', '/fr', '/nl-NL']) {\n      const res = await fetchViaHTTP(appPort, path, undefined, {\n        redirect: 'manual',\n      })\n      expect(res.status).toBe(200)\n      const $ = cheerio.load(await res.text())\n      expect($('#links').text()).toBe('Links')\n    }\n  })","file":"integration/custom-routes-i18n/test/index.test.js","skipped":false,"dir":"test"},{"name":"should rewrite correctly","suites":[],"updatePoint":{"line":66,"column":30},"line":66,"code":"  it('should rewrite correctly', async () => {\n    for (const [path, dest] of [\n      ['/about', '/about'],\n      ['/en/about', '/about'],\n      ['/nl-NL/about', '/about'],\n      ['/fr/about', '/fr/about'],\n      ['/en/catch-all/hello', '/hello'],\n      ['/catch-all/hello', '/hello'],\n      ['/nl-NL/catch-all/hello', '/hello'],\n      ['/fr/catch-all/hello', '/fr/hello'],\n    ]) {\n      const res = await fetchViaHTTP(appPort, path, undefined, {\n        redirect: 'manual',\n      })\n      expect(res.status).toBe(200)\n      const $ = cheerio.load(await res.text())\n      expect(JSON.parse($('#data').text())).toEqual({\n        url: dest,\n      })\n    }\n  })","file":"integration/custom-routes-i18n/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate on the client with rewrites correctly","suites":[],"updatePoint":{"line":88,"column":59},"line":88,"code":"  it('should navigate on the client with rewrites correctly', async () => {\n    for (const locale of ['', '/nl-NL', '/fr']) {\n      const browser = await webdriver(appPort, `${locale}/links`)\n\n      const expectedIndex = locale === '/fr' ? `fr` : ''\n\n      await browser.elementByCss('#to-about').click()\n\n      await check(async () => {\n        const data = JSON.parse(\n          cheerio\n            .load(await browser.eval('document.documentElement.innerHTML'))(\n              '#data'\n            )\n            .text()\n        )\n        console.log(data)\n        return data.url === `${expectedIndex ? '/fr' : ''}/about`\n          ? 'success'\n          : 'fail'\n      }, 'success')\n\n      await browser\n        .back()\n        .waitForElementByCss('#links')\n        .elementByCss('#to-catch-all')\n        .click()\n\n      await check(async () => {\n        const data = JSON.parse(\n          cheerio\n            .load(await browser.eval('document.documentElement.innerHTML'))(\n              '#data'\n            )\n            .text()\n        )\n        console.log(data)\n        return data.url === `${expectedIndex ? '/fr' : ''}/hello`\n          ? 'success'\n          : 'fail'\n      }, 'success')\n\n      await browser.back().waitForElementByCss('#links')\n\n      await browser.eval('window.beforeNav = 1')\n\n      await browser.elementByCss('#to-index').click()\n\n      await check(() => browser.eval('window.location.pathname'), locale || '/')\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n\n      await browser.elementByCss('#to-links').click()\n\n      await check(\n        () => browser.eval('window.location.pathname'),\n        `${locale}/links`\n      )\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n    }\n  })","file":"integration/custom-routes-i18n/test/index.test.js","skipped":false,"dir":"test"},{"name":"should successfully rewrite a WebSocket request","suites":[],"updatePoint":{"line":43,"column":53},"line":43,"code":"  it('should successfully rewrite a WebSocket request', async () => {\n    const messages = []\n    const ws = await new Promise((resolve, reject) => {\n      let socket = new WebSocket(`ws://localhost:${appPort}/to-websocket`)\n      socket.on('message', (data) => {\n        messages.push(data.toString())\n      })\n      socket.on('open', () => resolve(socket))\n      socket.on('error', (err) => {\n        console.error(err)\n        socket.close()\n        reject()\n      })\n    })\n\n    await check(\n      () => (messages.length > 0 ? 'success' : JSON.stringify(messages)),\n      'success'\n    )\n    ws.close()\n    expect([...externalServerHits]).toEqual(['/_next/webpack-hmr?page=/about'])\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not rewrite for _next/data route when a match is found","suites":[],"updatePoint":{"line":66,"column":67},"line":66,"code":"  it('should not rewrite for _next/data route when a match is found', async () => {\n    const initial = await fetchViaHTTP(appPort, '/overridden/first')\n    expect(initial.status).toBe(200)\n    expect(await initial.text()).toContain('this page is overridden')\n\n    const nextData = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${buildId}/overridden/first.json`\n    )\n    expect(nextData.status).toBe(200)\n    expect(await nextData.json()).toEqual({\n      pageProps: { params: { slug: 'first' } },\n      __N_SSG: true,\n    })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle has query encoding correctly","suites":[],"updatePoint":{"line":82,"column":48},"line":82,"code":"  it('should handle has query encoding correctly', async () => {\n    for (const expected of [\n      {\n        post: 'first',\n        slug: ['first'],\n      },\n      {\n        post: 'hello%20world',\n        slug: ['hello world'],\n      },\n      {\n        post: 'hello/world',\n        slug: ['hello', 'world'],\n      },\n      {\n        post: 'hello%2fworld',\n        slug: ['hello', 'world'],\n      },\n    ]) {\n      const { status = 200, post } = expected\n      const res = await fetchViaHTTP(\n        appPort,\n        '/has-rewrite-8',\n        `?post=${post}`,\n        {\n          redirect: 'manual',\n        }\n      )\n\n      expect(res.status).toBe(status)\n\n      if (status === 200) {\n        const $ = cheerio.load(await res.text())\n        expect(JSON.parse($('#props').text())).toEqual({\n          params: {\n            slug: expected.slug,\n          },\n        })\n      }\n    }\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle external beforeFiles rewrite correctly","suites":[],"updatePoint":{"line":124,"column":58},"line":124,"code":"  it('should handle external beforeFiles rewrite correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/overridden')\n    const html = await res.text()\n\n    if (res.status !== 200) {\n      console.error('Invalid response', html)\n    }\n    expect(res.status).toBe(200)\n    expect(html).toContain('Example Domain')\n\n    const browser = await webdriver(appPort, '/nav')\n    await browser.elementByCss('#to-before-files-overridden').click()\n    await check(\n      () => browser.eval('document.documentElement.innerHTML'),\n      /Example Domain/\n    )\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle beforeFiles rewrite to dynamic route correctly","suites":[],"updatePoint":{"line":142,"column":66},"line":142,"code":"  it('should handle beforeFiles rewrite to dynamic route correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/nfl')\n    const html = await res.text()\n\n    if (res.status !== 200) {\n      console.error('Invalid response', html)\n    }\n    expect(res.status).toBe(200)\n    expect(html).toContain('/_sport/[slug]')\n\n    const browser = await webdriver(appPort, '/nav')\n    await browser.eval('window.beforeNav = 1')\n    await browser.elementByCss('#to-before-files-dynamic').click()\n    await check(\n      () => browser.eval('document.documentElement.innerHTML'),\n      /_sport\\/\\[slug\\]/\n    )\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      slug: 'nfl',\n    })\n    expect(await browser.elementByCss('#pathname').text()).toBe(\n      '/_sport/[slug]'\n    )\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle beforeFiles rewrite to partly dynamic route correctly","suites":[],"updatePoint":{"line":168,"column":73},"line":168,"code":"  it('should handle beforeFiles rewrite to partly dynamic route correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/nfl')\n    const html = await res.text()\n\n    if (res.status !== 200) {\n      console.error('Invalid response', html)\n    }\n    expect(res.status).toBe(200)\n    expect(html).toContain('/_sport/[slug]')\n\n    const browser = await webdriver(appPort, '/nav')\n    await browser.eval('window.beforeNav = 1')\n    await browser.elementByCss('#to-before-files-dynamic-again').click()\n    await check(\n      () => browser.eval('document.documentElement.innerHTML'),\n      /_sport\\/\\[slug\\]\\/test/\n    )\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      slug: 'nfl',\n    })\n    expect(await browser.elementByCss('#pathname').text()).toBe(\n      '/_sport/[slug]/test'\n    )\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should support long URLs for rewrites","suites":[],"updatePoint":{"line":194,"column":43},"line":194,"code":"  it('should support long URLs for rewrites', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/catchall-rewrite/a9btBxtHQALZ6cxfuj18X6OLGNSkJVzrOXz41HG4QwciZfn7ggRZzPx21dWqGiTBAqFRiWvVNm5ko2lpyso5jtVaXg88dC1jKfqI2qmIcdeyJat8xamrIh2LWnrYRrsBcoKfQU65KHod8DPANuzPS3fkVYWlmov05GQbc82HwR1exOvPVKUKb5gBRWiN0WOh7hN4QyezIuq3dJINAptFQ6m2bNGjYACBRk4MOSHdcQG58oq5Ch7luuqrl9EcbWSa'\n    )\n\n    const html = await res.text()\n    expect(res.status).toBe(200)\n    expect(html).toContain('/with-params')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolveHref correctly navigating through history","suites":[],"updatePoint":{"line":205,"column":61},"line":205,"code":"  it('should resolveHref correctly navigating through history', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.eval('window.beforeNav = 1')\n\n    expect(await browser.eval('document.documentElement.innerHTML')).toContain(\n      'multi-rewrites'\n    )\n\n    await browser.eval('next.router.push(\"/rewriting-to-auto-export\")')\n    await browser.waitForElementByCss('#auto-export')\n\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      slug: 'hello',\n      rewrite: '1',\n    })\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n\n    await browser.eval('next.router.push(\"/nav\")')\n    await browser.waitForElementByCss('#nav')\n\n    expect(await browser.elementByCss('#nav').text()).toBe('Nav')\n\n    await browser.back()\n    await browser.waitForElementByCss('#auto-export')\n\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      slug: 'hello',\n      rewrite: '1',\n    })\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n\n    if (isDev) {\n      expect(await hasRedbox(browser, false)).toBe(false)\n    }\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should continue in beforeFiles rewrites","suites":[],"updatePoint":{"line":241,"column":45},"line":241,"code":"  it('should continue in beforeFiles rewrites', async () => {\n    const res = await fetchViaHTTP(appPort, '/old-blog/about')\n    expect(res.status).toBe(200)\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n\n    expect($('#hello').text()).toContain('Hello')\n\n    const browser = await webdriver(appPort, '/nav')\n\n    await browser.eval('window.beforeNav = 1')\n    await browser\n      .elementByCss('#to-old-blog')\n      .click()\n      .waitForElementByCss('#hello')\n    expect(await browser.elementByCss('#hello').text()).toContain('Hello')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not hang when proxy rewrite fails","suites":[],"updatePoint":{"line":260,"column":46},"line":260,"code":"  it('should not hang when proxy rewrite fails', async () => {\n    const res = await fetchViaHTTP(appPort, '/to-nowhere', undefined, {\n      timeout: 5000,\n    })\n\n    expect(res.status).toBe(500)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should parse params correctly for rewrite to auto-export dynamic page","suites":[],"updatePoint":{"line":268,"column":75},"line":268,"code":"  it('should parse params correctly for rewrite to auto-export dynamic page', async () => {\n    const browser = await webdriver(appPort, '/rewriting-to-auto-export')\n    await check(\n      () => browser.eval(() => document.documentElement.innerHTML),\n      /auto-export.*?hello/\n    )\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      rewrite: '1',\n      slug: 'hello',\n    })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should provide params correctly for rewrite to auto-export non-dynamic page","suites":[],"updatePoint":{"line":280,"column":81},"line":280,"code":"  it('should provide params correctly for rewrite to auto-export non-dynamic page', async () => {\n    const browser = await webdriver(\n      appPort,\n      '/rewriting-to-another-auto-export/first'\n    )\n\n    expect(await browser.elementByCss('#auto-export-another').text()).toBe(\n      'auto-export another'\n    )\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      rewrite: '1',\n      path: ['first'],\n    })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle one-to-one rewrite successfully","suites":[],"updatePoint":{"line":295,"column":51},"line":295,"code":"  it('should handle one-to-one rewrite successfully', async () => {\n    const html = await renderViaHTTP(appPort, '/first')\n    expect(html).toMatch(/hello/)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle chained rewrites successfully","suites":[],"updatePoint":{"line":300,"column":49},"line":300,"code":"  it('should handle chained rewrites successfully', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toMatch(/multi-rewrites/)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle param like headers properly","suites":[],"updatePoint":{"line":305,"column":47},"line":305,"code":"  it('should handle param like headers properly', async () => {\n    const res = await fetchViaHTTP(appPort, '/my-other-header/my-path')\n    expect(res.headers.get('x-path')).toBe('my-path')\n    expect(res.headers.get('somemy-path')).toBe('hi')\n    expect(res.headers.get('x-test')).toBe('some:value*')\n    expect(res.headers.get('x-test-2')).toBe('value*')\n    expect(res.headers.get('x-test-3')).toBe(':value?')\n    expect(res.headers.get('x-test-4')).toBe(':value+')\n    expect(res.headers.get('x-test-5')).toBe('something https:')\n    expect(res.headers.get('x-test-6')).toBe(':hello(world)')\n    expect(res.headers.get('x-test-7')).toBe('hello(world)')\n    expect(res.headers.get('x-test-8')).toBe('hello{1,}')\n    expect(res.headers.get('x-test-9')).toBe(':hello{1,2}')\n    expect(res.headers.get('content-security-policy')).toBe(\n      \"default-src 'self'; img-src *; media-src media1.com media2.com; script-src userscripts.example.com/my-path\"\n    )\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not match dynamic route immediately after applying header","suites":[],"updatePoint":{"line":323,"column":70},"line":323,"code":"  it('should not match dynamic route immediately after applying header', async () => {\n    const res = await fetchViaHTTP(appPort, '/blog/post-321')\n    expect(res.headers.get('x-something')).toBe('applied-everywhere')\n\n    const $ = cheerio.load(await res.text())\n    expect(JSON.parse($('p').text()).path).toBe('blog')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle chained redirects successfully","suites":[],"updatePoint":{"line":331,"column":50},"line":331,"code":"  it('should handle chained redirects successfully', async () => {\n    const res1 = await fetchViaHTTP(appPort, '/redir-chain1', undefined, {\n      redirect: 'manual',\n    })\n    const res1location = url.parse(res1.headers.get('location')).pathname\n    expect(res1.status).toBe(301)\n    expect(res1location).toBe('/redir-chain2')\n\n    const res2 = await fetchViaHTTP(appPort, res1location, undefined, {\n      redirect: 'manual',\n    })\n    const res2location = url.parse(res2.headers.get('location')).pathname\n    expect(res2.status).toBe(302)\n    expect(res2location).toBe('/redir-chain3')\n\n    const res3 = await fetchViaHTTP(appPort, res2location, undefined, {\n      redirect: 'manual',\n    })\n    const res3location = url.parse(res3.headers.get('location')).pathname\n    expect(res3.status).toBe(303)\n    expect(res3location).toBe('/')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not match redirect for /_next","suites":[],"updatePoint":{"line":354,"column":42},"line":354,"code":"  it('should not match redirect for /_next', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/_next/has-redirect-5',\n      undefined,\n      {\n        headers: {\n          'x-test-next': 'true',\n        },\n        redirect: 'manual',\n      }\n    )\n    expect(res.status).toBe(404)\n\n    const res2 = await fetchViaHTTP(\n      appPort,\n      '/another/has-redirect-5',\n      undefined,\n      {\n        headers: {\n          'x-test-next': 'true',\n        },\n        redirect: 'manual',\n      }\n    )\n    expect(res2.status).toBe(307)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should redirect successfully with permanent: false","suites":[],"updatePoint":{"line":382,"column":56},"line":382,"code":"  it('should redirect successfully with permanent: false', async () => {\n    const res = await fetchViaHTTP(appPort, '/redirect1', undefined, {\n      redirect: 'manual',\n    })\n    const { pathname } = url.parse(res.headers.get('location'))\n    expect(res.status).toBe(307)\n    expect(pathname).toBe('/')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should redirect with params successfully","suites":[],"updatePoint":{"line":391,"column":46},"line":391,"code":"  it('should redirect with params successfully', async () => {\n    const res = await fetchViaHTTP(appPort, '/hello/123/another', undefined, {\n      redirect: 'manual',\n    })\n    const { pathname } = url.parse(res.headers.get('location'))\n    expect(res.status).toBe(307)\n    expect(pathname).toBe('/blog/123')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should redirect with hash successfully","suites":[],"updatePoint":{"line":400,"column":44},"line":400,"code":"  it('should redirect with hash successfully', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/docs/router-status/500',\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n    const { pathname, hash, query } = url.parse(\n      res.headers.get('location'),\n      true\n    )\n    expect(res.status).toBe(301)\n    expect(pathname).toBe('/docs/v2/network/status-codes')\n    expect(hash).toBe('#500')\n    expect(query).toEqual({})\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should redirect successfully with provided statusCode","suites":[],"updatePoint":{"line":419,"column":59},"line":419,"code":"  it('should redirect successfully with provided statusCode', async () => {\n    const res = await fetchViaHTTP(appPort, '/redirect2', undefined, {\n      redirect: 'manual',\n    })\n    const { pathname, query } = url.parse(res.headers.get('location'), true)\n    expect(res.status).toBe(301)\n    expect(pathname).toBe('/')\n    expect(query).toEqual({})\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should redirect successfully with catchall","suites":[],"updatePoint":{"line":429,"column":48},"line":429,"code":"  it('should redirect successfully with catchall', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/catchall-redirect/hello/world',\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n    const { pathname, query } = url.parse(res.headers.get('location'), true)\n    expect(res.status).toBe(307)\n    expect(pathname).toBe('/somewhere')\n    expect(query).toEqual({})\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should server static files through a rewrite","suites":[],"updatePoint":{"line":444,"column":50},"line":444,"code":"  it('should server static files through a rewrite', async () => {\n    const text = await renderViaHTTP(appPort, '/hello-world')\n    expect(text).toBe('hello world!')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should rewrite with params successfully","suites":[],"updatePoint":{"line":449,"column":45},"line":449,"code":"  it('should rewrite with params successfully', async () => {\n    const html = await renderViaHTTP(appPort, '/test/hello')\n    expect(html).toMatch(/Hello/)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not append params when one is used in destination path","suites":[],"updatePoint":{"line":454,"column":67},"line":454,"code":"  it('should not append params when one is used in destination path', async () => {\n    const html = await renderViaHTTP(appPort, '/test/with-params?a=b')\n    const $ = cheerio.load(html)\n    expect(JSON.parse($('p').text())).toEqual({ a: 'b' })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should double redirect successfully","suites":[],"updatePoint":{"line":460,"column":41},"line":460,"code":"  it('should double redirect successfully', async () => {\n    const html = await renderViaHTTP(appPort, '/docs/github')\n    expect(html).toMatch(/hi there/)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should allow params in query for rewrite","suites":[],"updatePoint":{"line":465,"column":46},"line":465,"code":"  it('should allow params in query for rewrite', async () => {\n    const html = await renderViaHTTP(appPort, '/query-rewrite/hello/world?a=b')\n    const $ = cheerio.load(html)\n    expect(JSON.parse($('#__NEXT_DATA__').html()).query).toEqual({\n      first: 'hello',\n      second: 'world',\n      a: 'b',\n      section: 'hello',\n      name: 'world',\n    })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct params for catchall rewrite","suites":[],"updatePoint":{"line":477,"column":53},"line":477,"code":"  it('should have correct params for catchall rewrite', async () => {\n    const html = await renderViaHTTP(\n      appPort,\n      '/catchall-rewrite/hello/world?a=b'\n    )\n    const $ = cheerio.load(html)\n    expect(JSON.parse($('#__NEXT_DATA__').html()).query).toEqual({\n      a: 'b',\n      path: ['hello', 'world'],\n    })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct encoding for params with catchall rewrite","suites":[],"updatePoint":{"line":489,"column":67},"line":489,"code":"  it('should have correct encoding for params with catchall rewrite', async () => {\n    const html = await renderViaHTTP(\n      appPort,\n      '/catchall-rewrite/hello%20world%3Fw%3D24%26focalpoint%3Dcenter?a=b'\n    )\n    const $ = cheerio.load(html)\n    expect(JSON.parse($('#__NEXT_DATA__').html()).query).toEqual({\n      a: 'b',\n      path: ['hello%20world%3Fw%3D24%26focalpoint%3Dcenter'],\n    })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query for catchall rewrite","suites":[],"updatePoint":{"line":501,"column":52},"line":501,"code":"  it('should have correct query for catchall rewrite', async () => {\n    const html = await renderViaHTTP(appPort, '/catchall-query/hello/world?a=b')\n    const $ = cheerio.load(html)\n    expect(JSON.parse($('#__NEXT_DATA__').html()).query).toEqual({\n      a: 'b',\n      another: 'hello/world',\n      path: ['hello', 'world'],\n    })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct header for catchall rewrite","suites":[],"updatePoint":{"line":511,"column":53},"line":511,"code":"  it('should have correct header for catchall rewrite', async () => {\n    const res = await fetchViaHTTP(appPort, '/catchall-header/hello/world?a=b')\n    const headerValue = res.headers.get('x-value')\n    expect(headerValue).toBe('hello/world')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should allow params in query for redirect","suites":[],"updatePoint":{"line":517,"column":47},"line":517,"code":"  it('should allow params in query for redirect', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/query-redirect/hello/world?a=b',\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n    const { pathname, query } = url.parse(res.headers.get('location'), true)\n    expect(res.status).toBe(307)\n    expect(pathname).toBe('/with-params')\n    expect(query).toEqual({\n      first: 'hello',\n      second: 'world',\n      a: 'b',\n    })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correctly encoded params in query for redirect","suites":[],"updatePoint":{"line":536,"column":64},"line":536,"code":"  it('should have correctly encoded params in query for redirect', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/query-redirect/hello%20world%3Fw%3D24%26focalpoint%3Dcenter/world?a=b',\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n    const { pathname, query } = url.parse(res.headers.get('location'), true)\n    expect(res.status).toBe(307)\n    expect(pathname).toBe('/with-params')\n    expect(query).toEqual({\n      // this should be decoded since url.parse decodes query values\n      first: 'hello world?w=24&focalpoint=center',\n      second: 'world',\n      a: 'b',\n    })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should overwrite param values correctly","suites":[],"updatePoint":{"line":556,"column":45},"line":556,"code":"  it('should overwrite param values correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/test-overwrite/first/second')\n    expect(html).toMatch(/this-should-be-the-value/)\n    expect(html).not.toMatch(/first/)\n    expect(html).toMatch(/second/)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle query for rewrite correctly","suites":[],"updatePoint":{"line":563,"column":47},"line":563,"code":"  it('should handle query for rewrite correctly', async () => {\n    // query merge order lowest priority to highest\n    // 1. initial URL query values\n    // 2. path segment values\n    // 3. destination specified query values\n\n    const html = await renderViaHTTP(\n      appPort,\n      '/query-rewrite/first/second?section=overridden&name=overridden&first=overridden&second=overridden&keep=me'\n    )\n\n    const data = JSON.parse(cheerio.load(html)('p').text())\n    expect(data).toEqual({\n      first: 'first',\n      second: 'second',\n      section: 'first',\n      name: 'second',\n      keep: 'me',\n    })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not allow rewrite to override page file","suites":[],"updatePoint":{"line":586,"column":52},"line":586,"code":"  it('should not allow rewrite to override page file', async () => {\n    const html = await renderViaHTTP(appPort, '/nav')\n    expect(html).toContain('to-hello')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"show allow redirect to override the page","suites":[],"updatePoint":{"line":591,"column":46},"line":591,"code":"  it('show allow redirect to override the page', async () => {\n    const res = await fetchViaHTTP(appPort, '/redirect-override', undefined, {\n      redirect: 'manual',\n    })\n    const { pathname } = url.parse(res.headers.get('location') || '')\n    expect(res.status).toBe(307)\n    expect(pathname).toBe('/thank-you-next')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work successfully on the client","suites":[],"updatePoint":{"line":600,"column":44},"line":600,"code":"  it('should work successfully on the client', async () => {\n    const browser = await webdriver(appPort, '/nav')\n    await browser.elementByCss('#to-hello').click()\n    await browser.waitForElementByCss('#hello')\n\n    expect(await browser.eval('window.location.href')).toMatch(/\\/first$/)\n    expect(await getBrowserBodyText(browser)).toMatch(/Hello/)\n\n    await browser.eval('window.location.href = window.location.href')\n    await waitFor(500)\n    expect(await browser.eval('window.location.href')).toMatch(/\\/first$/)\n    expect(await getBrowserBodyText(browser)).toMatch(/Hello/)\n\n    await browser.elementByCss('#to-nav').click()\n    await browser.waitForElementByCss('#to-hello-again')\n    await browser.elementByCss('#to-hello-again').click()\n    await browser.waitForElementByCss('#hello-again')\n\n    expect(await browser.eval('window.location.href')).toMatch(/\\/second$/)\n    expect(await getBrowserBodyText(browser)).toMatch(/Hello again/)\n\n    await browser.eval('window.location.href = window.location.href')\n    await waitFor(500)\n    expect(await browser.eval('window.location.href')).toMatch(/\\/second$/)\n    expect(await getBrowserBodyText(browser)).toMatch(/Hello again/)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with rewrite when manually specifying href/as","suites":[],"updatePoint":{"line":627,"column":63},"line":627,"code":"  it('should work with rewrite when manually specifying href/as', async () => {\n    const browser = await webdriver(appPort, '/nav')\n    await browser.eval('window.beforeNav = 1')\n    await browser\n      .elementByCss('#to-params-manual')\n      .click()\n      .waitForElementByCss('#query')\n\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n    const query = JSON.parse(await browser.elementByCss('#query').text())\n    expect(query).toEqual({\n      something: '1',\n      another: 'value',\n    })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with rewrite when only specifying href","suites":[],"updatePoint":{"line":643,"column":56},"line":643,"code":"  it('should work with rewrite when only specifying href', async () => {\n    const browser = await webdriver(appPort, '/nav')\n    await browser.eval('window.beforeNav = 1')\n    await browser\n      .elementByCss('#to-params')\n      .click()\n      .waitForElementByCss('#query')\n\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n    const query = JSON.parse(await browser.elementByCss('#query').text())\n    expect(query).toEqual({\n      something: '1',\n      another: 'value',\n    })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with rewrite when only specifying href and ends in dynamic route","suites":[],"updatePoint":{"line":659,"column":82},"line":659,"code":"  it('should work with rewrite when only specifying href and ends in dynamic route', async () => {\n    const browser = await webdriver(appPort, '/nav')\n    await browser.eval('window.beforeNav = 1')\n    await browser\n      .elementByCss('#to-rewritten-dynamic')\n      .click()\n      .waitForElementByCss('#auto-export')\n\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n\n    const text = await browser.eval(() => document.documentElement.innerHTML)\n    expect(text).toContain('auto-export hello')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match a page after a rewrite","suites":[],"updatePoint":{"line":673,"column":41},"line":673,"code":"  it('should match a page after a rewrite', async () => {\n    const html = await renderViaHTTP(appPort, '/to-hello')\n    expect(html).toContain('Hello')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match dynamic route after rewrite","suites":[],"updatePoint":{"line":678,"column":46},"line":678,"code":"  it('should match dynamic route after rewrite', async () => {\n    const html = await renderViaHTTP(appPort, '/blog/post-1')\n    expect(html).toMatch(/post:.*?post-2/)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match public file after rewrite","suites":[],"updatePoint":{"line":683,"column":44},"line":683,"code":"  it('should match public file after rewrite', async () => {\n    const data = await renderViaHTTP(appPort, '/blog/data.json')\n    expect(JSON.parse(data)).toEqual({ hello: 'world' })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match /_next file after rewrite","suites":[],"updatePoint":{"line":688,"column":44},"line":688,"code":"  it('should match /_next file after rewrite', async () => {\n    await renderViaHTTP(appPort, '/hello')\n    const data = await renderViaHTTP(\n      appPort,\n      `/hidden/_next/static/${buildId}/_buildManifest.js`\n    )\n    expect(data).toContain('/hello')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should allow redirecting to external resource","suites":[],"updatePoint":{"line":697,"column":51},"line":697,"code":"  it('should allow redirecting to external resource', async () => {\n    const res = await fetchViaHTTP(appPort, '/to-external', undefined, {\n      redirect: 'manual',\n    })\n    const location = res.headers.get('location')\n    expect(res.status).toBe(307)\n    expect(location).toBe('https://google.com/')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply headers for exact match","suites":[],"updatePoint":{"line":706,"column":42},"line":706,"code":"  it('should apply headers for exact match', async () => {\n    const res = await fetchViaHTTP(appPort, '/add-header')\n    expect(res.headers.get('x-custom-header')).toBe('hello world')\n    expect(res.headers.get('x-another-header')).toBe('hello again')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply headers for multi match","suites":[],"updatePoint":{"line":712,"column":42},"line":712,"code":"  it('should apply headers for multi match', async () => {\n    const res = await fetchViaHTTP(appPort, '/my-headers/first')\n    expect(res.headers.get('x-first-header')).toBe('first')\n    expect(res.headers.get('x-second-header')).toBe('second')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply params for header key/values","suites":[],"updatePoint":{"line":718,"column":47},"line":718,"code":"  it('should apply params for header key/values', async () => {\n    const res = await fetchViaHTTP(appPort, '/my-other-header/first')\n    expect(res.headers.get('x-path')).toBe('first')\n    expect(res.headers.get('somefirst')).toBe('hi')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should support URL for header key/values","suites":[],"updatePoint":{"line":724,"column":46},"line":724,"code":"  it('should support URL for header key/values', async () => {\n    const res = await fetchViaHTTP(appPort, '/without-params/url')\n    expect(res.headers.get('x-origin')).toBe('https://example.com')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply params header key/values with URL","suites":[],"updatePoint":{"line":729,"column":52},"line":729,"code":"  it('should apply params header key/values with URL', async () => {\n    const res = await fetchViaHTTP(appPort, '/with-params/url/first')\n    expect(res.headers.get('x-url')).toBe('https://example.com/first')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply params header key/values with URL that has port","suites":[],"updatePoint":{"line":734,"column":66},"line":734,"code":"  it('should apply params header key/values with URL that has port', async () => {\n    const res = await fetchViaHTTP(appPort, '/with-params/url2/first')\n    expect(res.headers.get('x-url')).toBe(\n      'https://example.com:8080?hello=first'\n    )\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should support named pattern for header key/values","suites":[],"updatePoint":{"line":741,"column":56},"line":741,"code":"  it('should support named pattern for header key/values', async () => {\n    const res = await fetchViaHTTP(appPort, '/named-pattern/hello')\n    expect(res.headers.get('x-something')).toBe('value=hello')\n    expect(res.headers.get('path-hello')).toBe('end')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should support proxying to external resource","suites":[],"updatePoint":{"line":747,"column":50},"line":747,"code":"  it('should support proxying to external resource', async () => {\n    const res = await fetchViaHTTP(appPort, '/proxy-me/first?keep=me&and=me')\n    expect(res.status).toBe(200)\n    expect(\n      [...externalServerHits].map((u) => {\n        const { pathname, query } = url.parse(u, true)\n        return {\n          pathname,\n          query,\n        }\n      })\n    ).toEqual([\n      {\n        pathname: '/first',\n        query: {\n          keep: 'me',\n          and: 'me',\n        },\n      },\n    ])\n    const nextHost = `localhost:${appPort}`\n    const externalHost = `localhost:${externalServerPort}`\n    expect(await res.text()).toContain(`hi ${nextHost} from ${externalHost}`)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should support unnamed parameters correctly","suites":[],"updatePoint":{"line":772,"column":49},"line":772,"code":"  it('should support unnamed parameters correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/unnamed/first/final', undefined, {\n      redirect: 'manual',\n    })\n    const { pathname } = url.parse(res.headers.get('location') || '')\n    expect(res.status).toBe(307)\n    expect(pathname).toBe('/got-unnamed')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should support named like unnamed parameters correctly","suites":[],"updatePoint":{"line":781,"column":60},"line":781,"code":"  it('should support named like unnamed parameters correctly', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/named-like-unnamed/first',\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n    const { pathname } = url.parse(res.headers.get('location') || '')\n    expect(res.status).toBe(307)\n    expect(pathname).toBe('/first')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should add refresh header for 308 redirect","suites":[],"updatePoint":{"line":795,"column":48},"line":795,"code":"  it('should add refresh header for 308 redirect', async () => {\n    const res = await fetchViaHTTP(appPort, '/redirect4', undefined, {\n      redirect: 'manual',\n    })\n    expect(res.status).toBe(308)\n    expect(res.headers.get('refresh')).toBe(`0;url=/`)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correctly encoded query in location and refresh headers","suites":[],"updatePoint":{"line":803,"column":73},"line":803,"code":"  it('should have correctly encoded query in location and refresh headers', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      // Query unencoded is ?テスト=あ\n      '/redirect4?%E3%83%86%E3%82%B9%E3%83%88=%E3%81%82',\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n    expect(res.status).toBe(308)\n\n    expect(res.headers.get('location').split('?')[1]).toBe(\n      '%E3%83%86%E3%82%B9%E3%83%88=%E3%81%82'\n    )\n    expect(res.headers.get('refresh')).toBe(\n      '0;url=/?%E3%83%86%E3%82%B9%E3%83%88=%E3%81%82'\n    )\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle basic api rewrite successfully","suites":[],"updatePoint":{"line":823,"column":50},"line":823,"code":"  it('should handle basic api rewrite successfully', async () => {\n    const data = await renderViaHTTP(appPort, '/api-hello')\n    expect(JSON.parse(data)).toEqual({ query: {} })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle api rewrite with un-named param successfully","suites":[],"updatePoint":{"line":828,"column":64},"line":828,"code":"  it('should handle api rewrite with un-named param successfully', async () => {\n    const data = await renderViaHTTP(appPort, '/api-hello-regex/hello/world')\n    expect(JSON.parse(data)).toEqual({\n      query: { name: 'hello/world', first: 'hello/world' },\n    })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle api rewrite with param successfully","suites":[],"updatePoint":{"line":835,"column":55},"line":835,"code":"  it('should handle api rewrite with param successfully', async () => {\n    const data = await renderViaHTTP(appPort, '/api-hello-param/hello')\n    expect(JSON.parse(data)).toEqual({\n      query: { name: 'hello', hello: 'hello' },\n    })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle encoded value in the pathname correctly","suites":[],"updatePoint":{"line":842,"column":59},"line":842,"code":"  it('should handle encoded value in the pathname correctly', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/redirect/me/to-about/' + encodeURI('\\\\google.com'),\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n\n    const { pathname, hostname, query } = url.parse(\n      res.headers.get('location') || '',\n      true\n    )\n    expect(res.status).toBe(307)\n    expect(pathname).toBe(encodeURI('/\\\\google.com/about'))\n    expect(hostname).not.toBe('google.com')\n    expect(query).toEqual({})\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle unnamed parameters with multi-match successfully","suites":[],"updatePoint":{"line":862,"column":68},"line":862,"code":"  it('should handle unnamed parameters with multi-match successfully', async () => {\n    const html = await renderViaHTTP(\n      appPort,\n      '/unnamed-params/nested/first/second/hello/world'\n    )\n    const params = JSON.parse(cheerio.load(html)('p').text())\n    expect(params).toEqual({ test: 'hello' })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle named regex parameters with multi-match successfully","suites":[],"updatePoint":{"line":871,"column":72},"line":871,"code":"  it('should handle named regex parameters with multi-match successfully', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/docs/integrations/v2-some/thing',\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n    const { pathname } = url.parse(res.headers.get('location') || '')\n    expect(res.status).toBe(307)\n    expect(pathname).toBe('/integrations/-some/thing')\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should redirect with URL in query correctly","suites":[],"updatePoint":{"line":885,"column":49},"line":885,"code":"  it('should redirect with URL in query correctly', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/to-external-with-query',\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n\n    expect(res.status).toBe(307)\n    expect(res.headers.get('location')).toBe(\n      'https://authserver.example.com/set-password?returnUrl=https://www.example.com/login'\n    )\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should redirect with URL in query correctly non-encoded","suites":[],"updatePoint":{"line":901,"column":61},"line":901,"code":"  it('should redirect with URL in query correctly non-encoded', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/to-external-with-query',\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n\n    expect(res.status).toBe(307)\n    expect(res.headers.get('location')).toBe(\n      'https://authserver.example.com/set-password?returnUrl=https://www.example.com/login'\n    )\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match has header rewrite correctly","suites":[],"updatePoint":{"line":917,"column":47},"line":917,"code":"  it('should match has header rewrite correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/has-rewrite-1', undefined, {\n      headers: {\n        'x-my-header': 'hello world!!',\n      },\n    })\n\n    expect(res.status).toBe(200)\n    const $ = cheerio.load(await res.text())\n\n    expect(JSON.parse($('#query').text())).toEqual({\n      myHeader: 'hello world!!',\n    })\n\n    const res2 = await fetchViaHTTP(appPort, '/has-rewrite-1')\n    expect(res2.status).toBe(404)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match has query rewrite correctly","suites":[],"updatePoint":{"line":935,"column":46},"line":935,"code":"  it('should match has query rewrite correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/has-rewrite-2', {\n      'my-query': 'hellooo',\n    })\n\n    expect(res.status).toBe(200)\n    const $ = cheerio.load(await res.text())\n\n    expect(JSON.parse($('#query').text())).toEqual({\n      'my-query': 'hellooo',\n      myquery: 'hellooo',\n      value: 'hellooo',\n    })\n\n    const res2 = await fetchViaHTTP(appPort, '/has-rewrite-2')\n    expect(res2.status).toBe(404)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match has cookie rewrite correctly","suites":[],"updatePoint":{"line":953,"column":47},"line":953,"code":"  it('should match has cookie rewrite correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/has-rewrite-3', undefined, {\n      headers: {\n        cookie: 'loggedIn=true',\n      },\n    })\n\n    expect(res.status).toBe(200)\n    const $ = cheerio.load(await res.text())\n\n    expect(JSON.parse($('#query').text())).toEqual({\n      loggedIn: 'true',\n      authorized: '1',\n    })\n\n    const res2 = await fetchViaHTTP(appPort, '/has-rewrite-3')\n    expect(res2.status).toBe(404)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match has host rewrite correctly","suites":[],"updatePoint":{"line":972,"column":45},"line":972,"code":"  it('should match has host rewrite correctly', async () => {\n    const res1 = await fetchViaHTTP(appPort, '/has-rewrite-4')\n    expect(res1.status).toBe(404)\n\n    const res = await fetchViaHTTP(appPort, '/has-rewrite-4', undefined, {\n      headers: {\n        host: 'example.com',\n      },\n    })\n\n    expect(res.status).toBe(200)\n    const $ = cheerio.load(await res.text())\n\n    expect(JSON.parse($('#query').text())).toEqual({\n      host: '1',\n    })\n\n    const res2 = await fetchViaHTTP(appPort, '/has-rewrite-4')\n    expect(res2.status).toBe(404)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should pass has segment for rewrite correctly","suites":[],"updatePoint":{"line":993,"column":51},"line":993,"code":"  it('should pass has segment for rewrite correctly', async () => {\n    const res1 = await fetchViaHTTP(appPort, '/has-rewrite-5')\n    expect(res1.status).toBe(404)\n\n    const res = await fetchViaHTTP(appPort, '/has-rewrite-5', {\n      hasParam: 'with-params',\n    })\n\n    expect(res.status).toBe(200)\n    const $ = cheerio.load(await res.text())\n\n    expect(JSON.parse($('#query').text())).toEqual({\n      hasParam: 'with-params',\n    })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not pass non captured has value for rewrite correctly","suites":[],"updatePoint":{"line":1009,"column":66},"line":1009,"code":"  it('should not pass non captured has value for rewrite correctly', async () => {\n    const res1 = await fetchViaHTTP(appPort, '/has-rewrite-6')\n    expect(res1.status).toBe(404)\n\n    const res = await fetchViaHTTP(appPort, '/has-rewrite-6', undefined, {\n      headers: {\n        hasParam: 'with-params',\n      },\n    })\n    expect(res.status).toBe(200)\n\n    const $ = cheerio.load(await res.text())\n    expect(JSON.parse($('#query').text())).toEqual({})\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should pass captured has value for rewrite correctly","suites":[],"updatePoint":{"line":1024,"column":58},"line":1024,"code":"  it('should pass captured has value for rewrite correctly', async () => {\n    const res1 = await fetchViaHTTP(appPort, '/has-rewrite-7')\n    expect(res1.status).toBe(404)\n\n    const res = await fetchViaHTTP(appPort, '/has-rewrite-7', {\n      hasParam: 'with-params',\n    })\n    expect(res.status).toBe(200)\n\n    const $ = cheerio.load(await res.text())\n    expect(JSON.parse($('#query').text())).toEqual({\n      hasParam: 'with-params',\n      idk: 'with-params',\n    })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match has rewrite correctly before files","suites":[],"updatePoint":{"line":1040,"column":53},"line":1040,"code":"  it('should match has rewrite correctly before files', async () => {\n    const res1 = await fetchViaHTTP(appPort, '/hello')\n    expect(res1.status).toBe(200)\n    const $1 = cheerio.load(await res1.text())\n    expect($1('#hello').text()).toBe('Hello')\n\n    const res = await fetchViaHTTP(appPort, '/hello', { overrideMe: '1' })\n\n    expect(res.status).toBe(200)\n    const $ = cheerio.load(await res.text())\n\n    expect(JSON.parse($('#query').text())).toEqual({\n      overrideMe: '1',\n      overridden: '1',\n    })\n\n    const browser = await webdriver(appPort, '/nav')\n    await browser.eval('window.beforeNav = 1')\n    await browser.elementByCss('#to-overridden').click()\n    await browser.waitForElementByCss('#query')\n\n    expect(await browser.eval('window.next.router.pathname')).toBe(\n      '/with-params'\n    )\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      overridden: '1',\n      overrideMe: '1',\n    })\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match has header redirect correctly","suites":[],"updatePoint":{"line":1071,"column":48},"line":1071,"code":"  it('should match has header redirect correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/has-redirect-1', undefined, {\n      headers: {\n        'x-my-header': 'hello world!!',\n      },\n      redirect: 'manual',\n    })\n\n    expect(res.status).toBe(307)\n    const parsed = url.parse(res.headers.get('location'), true)\n\n    expect(parsed.pathname).toBe('/another')\n    expect(parsed.query).toEqual({\n      myHeader: 'hello world!!',\n    })\n\n    const res2 = await fetchViaHTTP(appPort, '/has-redirect-1', undefined, {\n      redirect: 'manual',\n    })\n    expect(res2.status).toBe(404)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match has query redirect correctly","suites":[],"updatePoint":{"line":1093,"column":47},"line":1093,"code":"  it('should match has query redirect correctly', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/has-redirect-2',\n      {\n        'my-query': 'hellooo',\n      },\n      {\n        redirect: 'manual',\n      }\n    )\n\n    expect(res.status).toBe(307)\n    const parsed = url.parse(res.headers.get('location'), true)\n\n    expect(parsed.pathname).toBe('/another')\n    expect(parsed.query).toEqual({\n      value: 'hellooo',\n      'my-query': 'hellooo',\n    })\n\n    const res2 = await fetchViaHTTP(appPort, '/has-redirect-2', undefined, {\n      redirect: 'manual',\n    })\n    expect(res2.status).toBe(404)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match has cookie redirect correctly","suites":[],"updatePoint":{"line":1120,"column":48},"line":1120,"code":"  it('should match has cookie redirect correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/has-redirect-3', undefined, {\n      headers: {\n        cookie: 'loggedIn=true',\n      },\n      redirect: 'manual',\n    })\n\n    expect(res.status).toBe(307)\n    const parsed = url.parse(res.headers.get('location'), true)\n\n    expect(parsed.pathname).toBe('/another')\n    expect(parsed.query).toEqual({\n      authorized: '1',\n    })\n\n    const res2 = await fetchViaHTTP(appPort, '/has-redirect-3', undefined, {\n      redirect: 'manual',\n    })\n    expect(res2.status).toBe(404)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match has host redirect correctly","suites":[],"updatePoint":{"line":1142,"column":46},"line":1142,"code":"  it('should match has host redirect correctly', async () => {\n    const res1 = await fetchViaHTTP(appPort, '/has-redirect-4', undefined, {\n      redirect: 'manual',\n    })\n    expect(res1.status).toBe(404)\n\n    const res = await fetchViaHTTP(appPort, '/has-redirect-4', undefined, {\n      headers: {\n        host: 'example.com',\n      },\n      redirect: 'manual',\n    })\n\n    expect(res.status).toBe(307)\n    const parsed = url.parse(res.headers.get('location'), true)\n\n    expect(parsed.pathname).toBe('/another')\n    expect(parsed.query).toEqual({\n      host: '1',\n    })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match has host redirect and insert in destination correctly","suites":[],"updatePoint":{"line":1164,"column":72},"line":1164,"code":"  it('should match has host redirect and insert in destination correctly', async () => {\n    const res1 = await fetchViaHTTP(appPort, '/has-redirect-6', undefined, {\n      redirect: 'manual',\n    })\n    expect(res1.status).toBe(404)\n\n    const res = await fetchViaHTTP(appPort, '/has-redirect-6', undefined, {\n      headers: {\n        host: 'hello-test.example.com',\n      },\n      redirect: 'manual',\n    })\n\n    expect(res.status).toBe(307)\n    const parsed = url.parse(res.headers.get('location'), true)\n\n    expect(parsed.protocol).toBe('https:')\n    expect(parsed.hostname).toBe('hello.example.com')\n    expect(parsed.pathname).toBe('/some-path/end')\n    expect(parsed.query).toEqual({\n      a: 'b',\n    })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match has query redirect with duplicate query key","suites":[],"updatePoint":{"line":1188,"column":62},"line":1188,"code":"  it('should match has query redirect with duplicate query key', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/has-redirect-7',\n      '?hello=world&hello=another',\n      {\n        redirect: 'manual',\n      }\n    )\n    expect(res.status).toBe(307)\n    const parsed = url.parse(res.headers.get('location'), true)\n\n    expect(parsed.pathname).toBe('/somewhere')\n    expect(parsed.query).toEqual({\n      hello: ['world', 'another'],\n      value: 'another',\n    })\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match has header for header correctly","suites":[],"updatePoint":{"line":1207,"column":50},"line":1207,"code":"  it('should match has header for header correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/has-header-1', undefined, {\n      headers: {\n        'x-my-header': 'hello world!!',\n      },\n      redirect: 'manual',\n    })\n\n    expect(res.headers.get('x-another')).toBe('header')\n\n    const res2 = await fetchViaHTTP(appPort, '/has-header-1', undefined, {\n      redirect: 'manual',\n    })\n    expect(res2.headers.get('x-another')).toBe(null)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match has query for header correctly","suites":[],"updatePoint":{"line":1223,"column":49},"line":1223,"code":"  it('should match has query for header correctly', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/has-header-2',\n      {\n        'my-query': 'hellooo',\n      },\n      {\n        redirect: 'manual',\n      }\n    )\n\n    expect(res.headers.get('x-added')).toBe('value')\n\n    const res2 = await fetchViaHTTP(appPort, '/has-header-2', undefined, {\n      redirect: 'manual',\n    })\n    expect(res2.headers.get('x-another')).toBe(null)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match has cookie for header correctly","suites":[],"updatePoint":{"line":1243,"column":50},"line":1243,"code":"  it('should match has cookie for header correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/has-header-3', undefined, {\n      headers: {\n        cookie: 'loggedIn=true',\n      },\n      redirect: 'manual',\n    })\n\n    expect(res.headers.get('x-is-user')).toBe('yuuuup')\n\n    const res2 = await fetchViaHTTP(appPort, '/has-header-3', undefined, {\n      redirect: 'manual',\n    })\n    expect(res2.headers.get('x-is-user')).toBe(null)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match has host for header correctly","suites":[],"updatePoint":{"line":1259,"column":48},"line":1259,"code":"  it('should match has host for header correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/has-header-4', undefined, {\n      headers: {\n        host: 'example.com',\n      },\n      redirect: 'manual',\n    })\n\n    expect(res.headers.get('x-is-host')).toBe('yuuuup')\n\n    const res2 = await fetchViaHTTP(appPort, '/has-header-4', undefined, {\n      redirect: 'manual',\n    })\n    expect(res2.headers.get('x-is-host')).toBe(null)\n  })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should output routes-manifest successfully","suites":[],"updatePoint":{"line":1276,"column":50},"line":1276,"code":"    it('should output routes-manifest successfully', async () => {\n      const manifest = await fs.readJSON(\n        join(appDir, '.next/routes-manifest.json')\n      )\n\n      for (const route of [\n        ...manifest.dynamicRoutes,\n        ...manifest.rewrites.beforeFiles,\n        ...manifest.rewrites.afterFiles,\n        ...manifest.rewrites.fallback,\n        ...manifest.redirects,\n        ...manifest.headers,\n      ]) {\n        route.regex = normalizeRegEx(route.regex)\n      }\n      for (const route of manifest.dataRoutes) {\n        route.dataRouteRegex = normalizeRegEx(route.dataRouteRegex)\n      }\n\n      expect(manifest).toEqual({\n        version: 3,\n        pages404: true,\n        basePath: '',\n        dataRoutes: [\n          {\n            dataRouteRegex: normalizeRegEx(\n              `^/_next/data/${escapeRegex(\n                buildId\n              )}/blog\\\\-catchall/(.+?)\\\\.json$`\n            ),\n            namedDataRouteRegex: `^/_next/data/${escapeRegex(\n              buildId\n            )}/blog\\\\-catchall/(?<slug>.+?)\\\\.json$`,\n            page: '/blog-catchall/[...slug]',\n            routeKeys: {\n              slug: 'slug',\n            },\n          },\n          {\n            dataRouteRegex: `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n              buildId\n            )}\\\\/overridden\\\\/([^\\\\/]+?)\\\\.json$`,\n            namedDataRouteRegex: `^/_next/data/${escapeRegex(\n              buildId\n            )}/overridden/(?<slug>[^/]+?)\\\\.json$`,\n            page: '/overridden/[slug]',\n            routeKeys: {\n              slug: 'slug',\n            },\n          },\n        ],\n        redirects: [\n          {\n            destination: '/:path+',\n            regex: normalizeRegEx(\n              '^(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))\\\\/$'\n            ),\n            source: '/:path+/',\n            statusCode: 308,\n            internal: true,\n          },\n          {\n            destination: '/:lang/about',\n            regex: normalizeRegEx(\n              '^(?!\\\\/_next)\\\\/redirect\\\\/me\\\\/to-about(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'\n            ),\n            source: '/redirect/me/to-about/:lang',\n            statusCode: 307,\n          },\n          {\n            source: '/docs/router-status/:code',\n            destination: '/docs/v2/network/status-codes#:code',\n            statusCode: 301,\n            regex: normalizeRegEx(\n              '^(?!\\\\/_next)\\\\/docs\\\\/router-status(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'\n            ),\n          },\n          {\n            source: '/docs/github',\n            destination: '/docs/v2/advanced/now-for-github',\n            statusCode: 301,\n            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/docs\\\\/github(?:\\\\/)?$'),\n          },\n          {\n            source: '/docs/v2/advanced/:all(.*)',\n            destination: '/docs/v2/more/:all',\n            statusCode: 301,\n            regex: normalizeRegEx(\n              '^(?!\\\\/_next)\\\\/docs\\\\/v2\\\\/advanced(?:\\\\/(.*))(?:\\\\/)?$'\n            ),\n          },\n          {\n            source: '/hello/:id/another',\n            destination: '/blog/:id',\n            statusCode: 307,\n            regex: normalizeRegEx(\n              '^(?!\\\\/_next)\\\\/hello(?:\\\\/([^\\\\/]+?))\\\\/another(?:\\\\/)?$'\n            ),\n          },\n          {\n            source: '/redirect1',\n            destination: '/',\n            statusCode: 307,\n            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/redirect1(?:\\\\/)?$'),\n          },\n          {\n            source: '/redirect2',\n            destination: '/',\n            statusCode: 301,\n            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/redirect2(?:\\\\/)?$'),\n          },\n          {\n            source: '/redirect3',\n            destination: '/another',\n            statusCode: 302,\n            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/redirect3(?:\\\\/)?$'),\n          },\n          {\n            source: '/redirect4',\n            destination: '/',\n            statusCode: 308,\n            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/redirect4(?:\\\\/)?$'),\n          },\n          {\n            source: '/redir-chain1',\n            destination: '/redir-chain2',\n            statusCode: 301,\n            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/redir-chain1(?:\\\\/)?$'),\n          },\n          {\n            source: '/redir-chain2',\n            destination: '/redir-chain3',\n            statusCode: 302,\n            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/redir-chain2(?:\\\\/)?$'),\n          },\n          {\n            source: '/redir-chain3',\n            destination: '/',\n            statusCode: 303,\n            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/redir-chain3(?:\\\\/)?$'),\n          },\n          {\n            destination: 'https://google.com',\n            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/to-external(?:\\\\/)?$'),\n            source: '/to-external',\n            statusCode: 307,\n          },\n          {\n            destination: '/with-params?first=:section&second=:name',\n            regex: normalizeRegEx(\n              '^(?!\\\\/_next)\\\\/query-redirect(?:\\\\/([^\\\\/]+?))(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'\n            ),\n            source: '/query-redirect/:section/:name',\n            statusCode: 307,\n          },\n          {\n            destination: '/got-unnamed',\n            regex: normalizeRegEx(\n              '^(?!\\\\/_next)\\\\/unnamed(?:\\\\/(first|second))(?:\\\\/(.*))(?:\\\\/)?$'\n            ),\n            source: '/unnamed/(first|second)/(.*)',\n            statusCode: 307,\n          },\n          {\n            destination: '/:0',\n            regex: normalizeRegEx(\n              '^(?!\\\\/_next)\\\\/named-like-unnamed(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'\n            ),\n            source: '/named-like-unnamed/:0',\n            statusCode: 307,\n          },\n          {\n            destination: '/thank-you-next',\n            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/redirect-override(?:\\\\/)?$'),\n            source: '/redirect-override',\n            statusCode: 307,\n          },\n          {\n            destination: '/:first/:second',\n            regex: normalizeRegEx(\n              '^(?!\\\\/_next)\\\\/docs(?:\\\\/(integrations|now-cli))\\\\/v2(.*)(?:\\\\/)?$'\n            ),\n            source: '/docs/:first(integrations|now-cli)/v2:second(.*)',\n            statusCode: 307,\n          },\n          {\n            destination: '/somewhere',\n            regex: normalizeRegEx(\n              '^(?!\\\\/_next)\\\\/catchall-redirect(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n            ),\n            source: '/catchall-redirect/:path*',\n            statusCode: 307,\n          },\n          {\n            destination:\n              'https://authserver.example.com/set-password?returnUrl=https%3A%2F%2Fwww.example.com/login',\n            regex: normalizeRegEx(\n              '^(?!\\\\/_next)\\\\/to-external-with-query(?:\\\\/)?$'\n            ),\n            source: '/to-external-with-query',\n            statusCode: 307,\n          },\n          {\n            destination:\n              'https://authserver.example.com/set-password?returnUrl=https://www.example.com/login',\n            regex: normalizeRegEx(\n              '^(?!\\\\/_next)\\\\/to-external-with-query-2(?:\\\\/)?$'\n            ),\n            source: '/to-external-with-query-2',\n            statusCode: 307,\n          },\n          {\n            destination: '/another?myHeader=:myHeader',\n            has: [\n              {\n                key: 'x-my-header',\n                type: 'header',\n                value: '(?<myHeader>.*)',\n              },\n            ],\n            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/has-redirect-1(?:\\\\/)?$'),\n            source: '/has-redirect-1',\n            statusCode: 307,\n          },\n          {\n            destination: '/another?value=:myquery',\n            has: [\n              {\n                key: 'my-query',\n                type: 'query',\n              },\n            ],\n            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/has-redirect-2(?:\\\\/)?$'),\n            source: '/has-redirect-2',\n            statusCode: 307,\n          },\n          {\n            destination: '/another?authorized=1',\n            has: [\n              {\n                key: 'loggedIn',\n                type: 'cookie',\n                value: 'true',\n              },\n            ],\n            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/has-redirect-3(?:\\\\/)?$'),\n            source: '/has-redirect-3',\n            statusCode: 307,\n          },\n          {\n            destination: '/another?host=1',\n            has: [\n              {\n                type: 'host',\n                value: 'example.com',\n              },\n            ],\n            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/has-redirect-4(?:\\\\/)?$'),\n            source: '/has-redirect-4',\n            statusCode: 307,\n          },\n          {\n            destination: '/somewhere',\n            has: [\n              {\n                key: 'x-test-next',\n                type: 'header',\n              },\n            ],\n            regex: normalizeRegEx(\n              '^(?!\\\\/_next)(?:\\\\/([^\\\\/]+?))\\\\/has-redirect-5(?:\\\\/)?$'\n            ),\n            source: '/:path/has-redirect-5',\n            statusCode: 307,\n          },\n          {\n            destination: 'https://:subdomain.example.com/some-path/end?a=b',\n            has: [\n              {\n                type: 'host',\n                value: '(?<subdomain>.*)-test.example.com',\n              },\n            ],\n            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/has-redirect-6(?:\\\\/)?$'),\n            source: '/has-redirect-6',\n            statusCode: 307,\n          },\n          {\n            source: '/has-redirect-7',\n            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/has-redirect-7(?:\\\\/)?$'),\n            has: [\n              {\n                type: 'query',\n                key: 'hello',\n                value: '(?<hello>.*)',\n              },\n            ],\n            destination: '/somewhere?value=:hello',\n            statusCode: 307,\n          },\n        ],\n        headers: [\n          {\n            headers: [\n              {\n                key: 'x-custom-header',\n                value: 'hello world',\n              },\n              {\n                key: 'x-another-header',\n                value: 'hello again',\n              },\n            ],\n            regex: normalizeRegEx('^\\\\/add-header(?:\\\\/)?$'),\n            source: '/add-header',\n          },\n          {\n            headers: [\n              {\n                key: 'x-first-header',\n                value: 'first',\n              },\n              {\n                key: 'x-second-header',\n                value: 'second',\n              },\n            ],\n            regex: normalizeRegEx('^\\\\/my-headers(?:\\\\/(.*))(?:\\\\/)?$'),\n            source: '/my-headers/(.*)',\n          },\n          {\n            headers: [\n              {\n                key: 'x-path',\n                value: ':path',\n              },\n              {\n                key: 'some:path',\n                value: 'hi',\n              },\n              {\n                key: 'x-test',\n                value: 'some:value*',\n              },\n              {\n                key: 'x-test-2',\n                value: 'value*',\n              },\n              {\n                key: 'x-test-3',\n                value: ':value?',\n              },\n              {\n                key: 'x-test-4',\n                value: ':value+',\n              },\n              {\n                key: 'x-test-5',\n                value: 'something https:',\n              },\n              {\n                key: 'x-test-6',\n                value: ':hello(world)',\n              },\n              {\n                key: 'x-test-7',\n                value: 'hello(world)',\n              },\n              {\n                key: 'x-test-8',\n                value: 'hello{1,}',\n              },\n              {\n                key: 'x-test-9',\n                value: ':hello{1,2}',\n              },\n              {\n                key: 'content-security-policy',\n                value:\n                  \"default-src 'self'; img-src *; media-src media1.com media2.com; script-src userscripts.example.com/:path\",\n              },\n            ],\n            regex: normalizeRegEx(\n              '^\\\\/my-other-header(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'\n            ),\n            source: '/my-other-header/:path',\n          },\n          {\n            headers: [\n              {\n                key: 'x-origin',\n                value: 'https://example.com',\n              },\n            ],\n            regex: normalizeRegEx('^\\\\/without-params\\\\/url(?:\\\\/)?$'),\n            source: '/without-params/url',\n          },\n          {\n            headers: [\n              {\n                key: 'x-url',\n                value: 'https://example.com/:path*',\n              },\n            ],\n            regex: normalizeRegEx(\n              '^\\\\/with-params\\\\/url(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n            ),\n            source: '/with-params/url/:path*',\n          },\n          {\n            headers: [\n              {\n                key: 'x-url',\n                value: 'https://example.com:8080?hello=:path*',\n              },\n            ],\n            regex: normalizeRegEx(\n              '^\\\\/with-params\\\\/url2(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n            ),\n            source: '/with-params/url2/:path*',\n          },\n          {\n            headers: [\n              {\n                key: 'x-something',\n                value: 'applied-everywhere',\n              },\n            ],\n            regex: normalizeRegEx(\n              '^(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n            ),\n            source: '/:path*',\n          },\n          {\n            headers: [\n              {\n                key: 'x-something',\n                value: 'value=:path',\n              },\n              {\n                key: 'path-:path',\n                value: 'end',\n              },\n            ],\n            regex: normalizeRegEx('^\\\\/named-pattern(?:\\\\/(.*))(?:\\\\/)?$'),\n            source: '/named-pattern/:path(.*)',\n          },\n          {\n            headers: [\n              {\n                key: 'x-value',\n                value: ':path*',\n              },\n            ],\n            regex: normalizeRegEx(\n              '^\\\\/catchall-header(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n            ),\n            source: '/catchall-header/:path*',\n          },\n          {\n            has: [\n              {\n                key: 'x-my-header',\n                type: 'header',\n                value: '(?<myHeader>.*)',\n              },\n            ],\n            headers: [\n              {\n                key: 'x-another',\n                value: 'header',\n              },\n            ],\n            regex: normalizeRegEx('^\\\\/has-header-1(?:\\\\/)?$'),\n            source: '/has-header-1',\n          },\n          {\n            has: [\n              {\n                key: 'my-query',\n                type: 'query',\n              },\n            ],\n            headers: [\n              {\n                key: 'x-added',\n                value: 'value',\n              },\n            ],\n            regex: normalizeRegEx('^\\\\/has-header-2(?:\\\\/)?$'),\n            source: '/has-header-2',\n          },\n          {\n            has: [\n              {\n                key: 'loggedIn',\n                type: 'cookie',\n                value: 'true',\n              },\n            ],\n            headers: [\n              {\n                key: 'x-is-user',\n                value: 'yuuuup',\n              },\n            ],\n            regex: normalizeRegEx('^\\\\/has-header-3(?:\\\\/)?$'),\n            source: '/has-header-3',\n          },\n          {\n            has: [\n              {\n                type: 'host',\n                value: 'example.com',\n              },\n            ],\n            headers: [\n              {\n                key: 'x-is-host',\n                value: 'yuuuup',\n              },\n            ],\n            regex: normalizeRegEx('^\\\\/has-header-4(?:\\\\/)?$'),\n            source: '/has-header-4',\n          },\n        ],\n        rewrites: {\n          beforeFiles: [\n            {\n              destination: '/with-params?overridden=1',\n              has: [\n                {\n                  key: 'overrideMe',\n                  type: 'query',\n                },\n              ],\n              regex: normalizeRegEx('^\\\\/hello(?:\\\\/)?$'),\n              source: '/hello',\n            },\n            {\n              destination: '/blog/:path*',\n              regex: normalizeRegEx(\n                '^\\\\/old-blog(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n              ),\n              source: '/old-blog/:path*',\n            },\n            {\n              destination: 'https://example.vercel.sh',\n              regex: normalizeRegEx('^\\\\/overridden(?:\\\\/)?$'),\n              source: '/overridden',\n            },\n            {\n              destination: '/_sport/nfl/:path*',\n              regex: normalizeRegEx(\n                '^\\\\/nfl(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n              ),\n              source: '/nfl/:path*',\n            },\n          ],\n          afterFiles: [\n            {\n              destination: `http://localhost:${externalServerPort}/_next/webpack-hmr?page=/about`,\n              regex: normalizeRegEx('^\\\\/to-websocket(?:\\\\/)?$'),\n              source: '/to-websocket',\n            },\n            {\n              destination: 'http://localhost:12233',\n              regex: normalizeRegEx('^\\\\/to-nowhere(?:\\\\/)?$'),\n              source: '/to-nowhere',\n            },\n            {\n              destination: '/auto-export/hello?rewrite=1',\n              regex: normalizeRegEx('^\\\\/rewriting-to-auto-export(?:\\\\/)?$'),\n              source: '/rewriting-to-auto-export',\n            },\n            {\n              destination: '/auto-export/another?rewrite=1',\n              regex: normalizeRegEx(\n                '^\\\\/rewriting-to-another-auto-export(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n              ),\n              source: '/rewriting-to-another-auto-export/:path*',\n            },\n            {\n              destination: '/another/one',\n              regex: normalizeRegEx('^\\\\/to-another(?:\\\\/)?$'),\n              source: '/to-another',\n            },\n            {\n              destination: '/404',\n              regex: normalizeRegEx('^\\\\/nav(?:\\\\/)?$'),\n              source: '/nav',\n            },\n            {\n              source: '/hello-world',\n              destination: '/static/hello.txt',\n              regex: normalizeRegEx('^\\\\/hello-world(?:\\\\/)?$'),\n            },\n            {\n              source: '/',\n              destination: '/another',\n              regex: normalizeRegEx('^\\\\/(?:\\\\/)?$'),\n            },\n            {\n              source: '/another',\n              destination: '/multi-rewrites',\n              regex: normalizeRegEx('^\\\\/another(?:\\\\/)?$'),\n            },\n            {\n              source: '/first',\n              destination: '/hello',\n              regex: normalizeRegEx('^\\\\/first(?:\\\\/)?$'),\n            },\n            {\n              source: '/second',\n              destination: '/hello-again',\n              regex: normalizeRegEx('^\\\\/second(?:\\\\/)?$'),\n            },\n            {\n              destination: '/hello',\n              regex: normalizeRegEx('^\\\\/to-hello(?:\\\\/)?$'),\n              source: '/to-hello',\n            },\n            {\n              destination: '/blog/post-2',\n              regex: normalizeRegEx('^\\\\/blog\\\\/post-1(?:\\\\/)?$'),\n              source: '/blog/post-1',\n            },\n            {\n              source: '/test/:path',\n              destination: '/:path',\n              regex: normalizeRegEx('^\\\\/test(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'),\n            },\n            {\n              source: '/test-overwrite/:something/:another',\n              destination: '/params/this-should-be-the-value',\n              regex: normalizeRegEx(\n                '^\\\\/test-overwrite(?:\\\\/([^\\\\/]+?))(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'\n              ),\n            },\n            {\n              source: '/params/:something',\n              destination: '/with-params',\n              regex: normalizeRegEx('^\\\\/params(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'),\n            },\n            {\n              destination: '/with-params?first=:section&second=:name',\n              regex: normalizeRegEx(\n                '^\\\\/query-rewrite(?:\\\\/([^\\\\/]+?))(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'\n              ),\n              source: '/query-rewrite/:section/:name',\n            },\n            {\n              destination: '/_next/:path*',\n              regex: normalizeRegEx(\n                '^\\\\/hidden\\\\/_next(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n              ),\n              source: '/hidden/_next/:path*',\n            },\n            {\n              destination: `http://localhost:${externalServerPort}/:path*`,\n              regex: normalizeRegEx(\n                '^\\\\/proxy-me(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n              ),\n              source: '/proxy-me/:path*',\n            },\n            {\n              destination: '/api/hello',\n              regex: normalizeRegEx('^\\\\/api-hello(?:\\\\/)?$'),\n              source: '/api-hello',\n            },\n            {\n              destination: '/api/hello?name=:first*',\n              regex: normalizeRegEx('^\\\\/api-hello-regex(?:\\\\/(.*))(?:\\\\/)?$'),\n              source: '/api-hello-regex/:first(.*)',\n            },\n            {\n              destination: '/api/hello?hello=:name',\n              regex: normalizeRegEx(\n                '^\\\\/api-hello-param(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'\n              ),\n              source: '/api-hello-param/:name',\n            },\n            {\n              destination: '/api/dynamic/:name?hello=:name',\n              regex: normalizeRegEx(\n                '^\\\\/api-dynamic-param(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'\n              ),\n              source: '/api-dynamic-param/:name',\n            },\n            {\n              destination: '/with-params',\n              regex: normalizeRegEx('^(?:\\\\/([^\\\\/]+?))\\\\/post-321(?:\\\\/)?$'),\n              source: '/:path/post-321',\n            },\n            {\n              destination: '/with-params',\n              regex: normalizeRegEx(\n                '^\\\\/unnamed-params\\\\/nested(?:\\\\/(.*))(?:\\\\/([^\\\\/]+?))(?:\\\\/(.*))(?:\\\\/)?$'\n              ),\n              source: '/unnamed-params/nested/(.*)/:test/(.*)',\n            },\n            {\n              destination: '/with-params',\n              regex: normalizeRegEx(\n                '^\\\\/catchall-rewrite(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n              ),\n              source: '/catchall-rewrite/:path*',\n            },\n            {\n              destination: '/with-params?another=:path*',\n              regex: normalizeRegEx(\n                '^\\\\/catchall-query(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n              ),\n              source: '/catchall-query/:path*',\n            },\n            {\n              destination: '/with-params?myHeader=:myHeader',\n              has: [\n                {\n                  key: 'x-my-header',\n                  type: 'header',\n                  value: '(?<myHeader>.*)',\n                },\n              ],\n              regex: normalizeRegEx('^\\\\/has-rewrite-1(?:\\\\/)?$'),\n              source: '/has-rewrite-1',\n            },\n            {\n              destination: '/with-params?value=:myquery',\n              has: [\n                {\n                  key: 'my-query',\n                  type: 'query',\n                },\n              ],\n              regex: normalizeRegEx('^\\\\/has-rewrite-2(?:\\\\/)?$'),\n              source: '/has-rewrite-2',\n            },\n            {\n              destination: '/with-params?authorized=1',\n              has: [\n                {\n                  key: 'loggedIn',\n                  type: 'cookie',\n                  value: '(?<loggedIn>true)',\n                },\n              ],\n              regex: normalizeRegEx('^\\\\/has-rewrite-3(?:\\\\/)?$'),\n              source: '/has-rewrite-3',\n            },\n            {\n              destination: '/with-params?host=1',\n              has: [\n                {\n                  type: 'host',\n                  value: 'example.com',\n                },\n              ],\n              regex: normalizeRegEx('^\\\\/has-rewrite-4(?:\\\\/)?$'),\n              source: '/has-rewrite-4',\n            },\n            {\n              destination: '/:hasParam',\n              has: [\n                {\n                  key: 'hasParam',\n                  type: 'query',\n                },\n              ],\n              regex: normalizeRegEx('^\\\\/has-rewrite-5(?:\\\\/)?$'),\n              source: '/has-rewrite-5',\n            },\n            {\n              destination: '/with-params',\n              has: [\n                {\n                  key: 'hasParam',\n                  type: 'header',\n                  value: 'with-params',\n                },\n              ],\n              regex: normalizeRegEx('^\\\\/has-rewrite-6(?:\\\\/)?$'),\n              source: '/has-rewrite-6',\n            },\n            {\n              destination: '/with-params?idk=:idk',\n              has: [\n                {\n                  key: 'hasParam',\n                  type: 'query',\n                  value: '(?<idk>with-params|hello)',\n                },\n              ],\n              regex: normalizeRegEx('^\\\\/has-rewrite-7(?:\\\\/)?$'),\n              source: '/has-rewrite-7',\n            },\n            {\n              destination: '/blog-catchall/:post',\n              has: [\n                {\n                  key: 'post',\n                  type: 'query',\n                },\n              ],\n              regex: normalizeRegEx('^\\\\/has-rewrite-8(?:\\\\/)?$'),\n              source: '/has-rewrite-8',\n            },\n            {\n              destination: '/hello',\n              regex: normalizeRegEx('^\\\\/blog\\\\/about(?:\\\\/)?$'),\n              source: '/blog/about',\n            },\n            {\n              destination: '/overridden',\n              regex:\n                '^\\\\/overridden(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$',\n              source: '/overridden/:path*',\n            },\n          ],\n          fallback: [],\n        },\n        dynamicRoutes: [\n          {\n            namedRegex: '^/_sport/(?<slug>[^/]+?)(?:/)?$',\n            page: '/_sport/[slug]',\n            regex: normalizeRegEx('^\\\\/_sport\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n            routeKeys: {\n              slug: 'slug',\n            },\n          },\n          {\n            namedRegex: '^/_sport/(?<slug>[^/]+?)/test(?:/)?$',\n            page: '/_sport/[slug]/test',\n            regex: normalizeRegEx('^\\\\/_sport\\\\/([^\\\\/]+?)\\\\/test(?:\\\\/)?$'),\n            routeKeys: {\n              slug: 'slug',\n            },\n          },\n          {\n            namedRegex: '^/another/(?<id>[^/]+?)(?:/)?$',\n            page: '/another/[id]',\n            regex: normalizeRegEx('^\\\\/another\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n            routeKeys: {\n              id: 'id',\n            },\n          },\n          {\n            namedRegex: '^/api/dynamic/(?<slug>[^/]+?)(?:/)?$',\n            page: '/api/dynamic/[slug]',\n            regex: normalizeRegEx('^\\\\/api\\\\/dynamic\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n            routeKeys: {\n              slug: 'slug',\n            },\n          },\n          {\n            namedRegex: '^/auto\\\\-export/(?<slug>[^/]+?)(?:/)?$',\n            page: '/auto-export/[slug]',\n            regex: normalizeRegEx('^\\\\/auto\\\\-export\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n            routeKeys: {\n              slug: 'slug',\n            },\n          },\n          {\n            namedRegex: '^/blog/(?<post>[^/]+?)(?:/)?$',\n            page: '/blog/[post]',\n            regex: normalizeRegEx('^\\\\/blog\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n            routeKeys: {\n              post: 'post',\n            },\n          },\n          {\n            namedRegex: '^/blog\\\\-catchall/(?<slug>.+?)(?:/)?$',\n            page: '/blog-catchall/[...slug]',\n            regex: normalizeRegEx('^\\\\/blog\\\\-catchall\\\\/(.+?)(?:\\\\/)?$'),\n            routeKeys: {\n              slug: 'slug',\n            },\n          },\n          {\n            namedRegex: '^/overridden/(?<slug>[^/]+?)(?:/)?$',\n            page: '/overridden/[slug]',\n            regex: '^\\\\/overridden\\\\/([^\\\\/]+?)(?:\\\\/)?$',\n            routeKeys: {\n              slug: 'slug',\n            },\n          },\n        ],\n        staticRoutes: [\n          {\n            namedRegex: '^/auto\\\\-export/another(?:/)?$',\n            page: '/auto-export/another',\n            regex: '^/auto\\\\-export/another(?:/)?$',\n            routeKeys: {},\n          },\n          {\n            namedRegex: '^/docs/v2/more/now\\\\-for\\\\-github(?:/)?$',\n            page: '/docs/v2/more/now-for-github',\n            regex: '^/docs/v2/more/now\\\\-for\\\\-github(?:/)?$',\n            routeKeys: {},\n          },\n          {\n            namedRegex: '^/hello(?:/)?$',\n            page: '/hello',\n            regex: '^/hello(?:/)?$',\n            routeKeys: {},\n          },\n          {\n            namedRegex: '^/hello\\\\-again(?:/)?$',\n            page: '/hello-again',\n            regex: '^/hello\\\\-again(?:/)?$',\n            routeKeys: {},\n          },\n          {\n            namedRegex: '^/multi\\\\-rewrites(?:/)?$',\n            page: '/multi-rewrites',\n            regex: '^/multi\\\\-rewrites(?:/)?$',\n            routeKeys: {},\n          },\n          {\n            namedRegex: '^/nav(?:/)?$',\n            page: '/nav',\n            regex: '^/nav(?:/)?$',\n            routeKeys: {},\n          },\n          {\n            namedRegex: '^/overridden(?:/)?$',\n            page: '/overridden',\n            regex: '^/overridden(?:/)?$',\n            routeKeys: {},\n          },\n          {\n            namedRegex: '^/redirect\\\\-override(?:/)?$',\n            page: '/redirect-override',\n            regex: '^/redirect\\\\-override(?:/)?$',\n            routeKeys: {},\n          },\n          {\n            namedRegex: '^/with\\\\-params(?:/)?$',\n            page: '/with-params',\n            regex: '^/with\\\\-params(?:/)?$',\n            routeKeys: {},\n          },\n        ],\n      })\n    })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have redirects/rewrites in build output with debug flag","suites":[],"updatePoint":{"line":2222,"column":70},"line":2222,"code":"    it('should have redirects/rewrites in build output with debug flag', async () => {\n      const manifest = await fs.readJSON(\n        join(appDir, '.next/routes-manifest.json')\n      )\n      const cleanStdout = stripAnsi(stdout)\n      expect(cleanStdout).toContain('Redirects')\n      expect(cleanStdout).toContain('Rewrites')\n      expect(cleanStdout).toContain('Headers')\n      expect(cleanStdout).toMatch(/source.*?/i)\n      expect(cleanStdout).toMatch(/destination.*?/i)\n\n      for (const route of [\n        ...manifest.redirects,\n        ...manifest.rewrites.beforeFiles,\n        ...manifest.rewrites.afterFiles,\n        ...manifest.rewrites.fallback,\n      ]) {\n        expect(cleanStdout).toContain(route.source)\n        expect(cleanStdout).toContain(route.destination)\n      }\n\n      for (const route of manifest.headers) {\n        expect(cleanStdout).toContain(route.source)\n\n        for (const header of route.headers) {\n          expect(cleanStdout).toContain(header.key)\n          expect(cleanStdout).toContain(header.value)\n        }\n      }\n    })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not error for no-op rewrite and auto export dynamic route","suites":["Custom routes","no-op rewrite"],"updatePoint":{"line":2334,"column":72},"line":2334,"code":"    it('should not error for no-op rewrite and auto export dynamic route', async () => {\n      const browser = await webdriver(appPort, '/auto-export/my-slug')\n      await check(\n        () => browser.eval(() => document.documentElement.innerHTML),\n        /auto-export.*?my-slug/\n      )\n    })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show warning for custom routes when not next export","suites":["Custom routes","server mode"],"updatePoint":{"line":2362,"column":70},"line":2362,"code":"    it('should not show warning for custom routes when not next export', async () => {\n      expect(stderr).not.toContain(\n        `rewrites, redirects, and headers are not applied when exporting your application detected`\n      )\n    })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show warning for experimental has usage","suites":["Custom routes","server mode"],"updatePoint":{"line":2368,"column":58},"line":2368,"code":"    it('should not show warning for experimental has usage', async () => {\n      expect(stderr).not.toContain(\n        \"'has' route field support is still experimental and not covered by semver, use at your own risk.\"\n      )\n    })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show warning for custom routes when not next export","suites":["Custom routes","export"],"updatePoint":{"line":2410,"column":70},"line":2410,"code":"    it('should not show warning for custom routes when not next export', async () => {\n      expect(stderr).not.toContain(\n        `rewrites, redirects, and headers are not applied when exporting your application detected`\n      )\n    })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show warning for custom routes when next export on Vercel","suites":["Custom routes","export"],"updatePoint":{"line":2416,"column":76},"line":2416,"code":"    it('should not show warning for custom routes when next export on Vercel', async () => {\n      expect(exportVercelStderr).not.toContain(\n        `rewrites, redirects, and headers are not applied when exporting your application detected`\n      )\n    })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show warning for custom routes with next export","suites":["Custom routes","export"],"updatePoint":{"line":2422,"column":62},"line":2422,"code":"    it('should show warning for custom routes with next export', async () => {\n      expect(exportStderr).toContain(\n        `rewrites, redirects, and headers are not applied when exporting your application, detected (rewrites, redirects, headers)`\n      )\n    })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply rewrites in lambda correctly for page route","suites":["Custom routes","raw serverless mode"],"updatePoint":{"line":2478,"column":64},"line":2478,"code":"    it('should apply rewrites in lambda correctly for page route', async () => {\n      const html = await renderViaHTTP(appPort, '/query-rewrite/first/second')\n      const data = JSON.parse(cheerio.load(html)('p').text())\n      expect(data).toEqual({\n        first: 'first',\n        second: 'second',\n        section: 'first',\n        name: 'second',\n      })\n    })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply rewrites in lambda correctly for dynamic route","suites":["Custom routes","raw serverless mode"],"updatePoint":{"line":2489,"column":67},"line":2489,"code":"    it('should apply rewrites in lambda correctly for dynamic route', async () => {\n      const html = await renderViaHTTP(appPort, '/blog/post-1')\n      expect(html).toContain('post-2')\n    })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply rewrites in lambda correctly for API route","suites":["Custom routes","raw serverless mode"],"updatePoint":{"line":2494,"column":63},"line":2494,"code":"    it('should apply rewrites in lambda correctly for API route', async () => {\n      const data = JSON.parse(\n        await renderViaHTTP(appPort, '/api-hello-param/first')\n      )\n      expect(data).toEqual({\n        query: {\n          name: 'first',\n          hello: 'first',\n        },\n      })\n    })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply rewrites in lambda correctly for dynamic API route","suites":["Custom routes","raw serverless mode"],"updatePoint":{"line":2506,"column":71},"line":2506,"code":"    it('should apply rewrites in lambda correctly for dynamic API route', async () => {\n      const data = JSON.parse(\n        await renderViaHTTP(appPort, '/api-dynamic-param/first')\n      )\n      expect(data).toEqual({\n        query: {\n          slug: 'first',\n          hello: 'first',\n        },\n      })\n    })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with just headers","suites":["Custom routes","should load custom routes when only one type is used"],"updatePoint":{"line":2533,"column":39},"line":2533,"code":"      it('should work with just headers', async () => {\n        nextConfigContent = await fs.readFile(nextConfigPath, 'utf8')\n        await fs.writeFile(\n          nextConfigPath,\n          nextConfigContent.replace(/(async (?:redirects|rewrites))/g, '$1s')\n        )\n        await buildAndStart()\n\n        const res = await fetchViaHTTP(appPort, '/add-header')\n\n        const res2 = await fetchViaHTTP(appPort, '/docs/github', undefined, {\n          redirect: 'manual',\n        })\n        const res3 = await fetchViaHTTP(appPort, '/hello-world')\n\n        await fs.writeFile(nextConfigPath, nextConfigContent)\n        await killApp(app)\n\n        expect(res.headers.get('x-custom-header')).toBe('hello world')\n        expect(res.headers.get('x-another-header')).toBe('hello again')\n\n        expect(res2.status).toBe(404)\n        expect(res3.status).toBe(404)\n      })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with just rewrites","suites":["Custom routes","should load custom routes when only one type is used"],"updatePoint":{"line":2558,"column":40},"line":2558,"code":"      it('should work with just rewrites', async () => {\n        nextConfigContent = await fs.readFile(nextConfigPath, 'utf8')\n        await fs.writeFile(\n          nextConfigPath,\n          nextConfigContent.replace(/(async (?:redirects|headers))/g, '$1s')\n        )\n        await buildAndStart()\n\n        const res = await fetchViaHTTP(appPort, '/add-header')\n\n        const res2 = await fetchViaHTTP(appPort, '/docs/github', undefined, {\n          redirect: 'manual',\n        })\n        const res3 = await fetchViaHTTP(appPort, '/hello-world')\n\n        await fs.writeFile(nextConfigPath, nextConfigContent)\n        await killApp(app)\n\n        expect(res.headers.get('x-custom-header')).toBeFalsy()\n        expect(res.headers.get('x-another-header')).toBeFalsy()\n\n        expect(res2.status).toBe(404)\n\n        expect(res3.status).toBe(200)\n        expect(await res3.text()).toContain('hello world!')\n      })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with just redirects","suites":["Custom routes","should load custom routes when only one type is used"],"updatePoint":{"line":2585,"column":41},"line":2585,"code":"      it('should work with just redirects', async () => {\n        nextConfigContent = await fs.readFile(nextConfigPath, 'utf8')\n        await fs.writeFile(\n          nextConfigPath,\n          nextConfigContent.replace(/(async (?:rewrites|headers))/g, '$1s')\n        )\n        await buildAndStart()\n\n        const res = await fetchViaHTTP(appPort, '/add-header')\n\n        const res2 = await fetchViaHTTP(appPort, '/docs/github', undefined, {\n          redirect: 'manual',\n        })\n        const res3 = await fetchViaHTTP(appPort, '/hello world')\n\n        await fs.writeFile(nextConfigPath, nextConfigContent)\n        await killApp(app)\n\n        expect(res.headers.get('x-custom-header')).toBeFalsy()\n        expect(res.headers.get('x-another-header')).toBeFalsy()\n\n        const { pathname } = url.parse(res2.headers.get('location'))\n        expect(res2.status).toBe(301)\n        expect(pathname).toBe('/docs/v2/advanced/now-for-github')\n\n        expect(res3.status).toBe(404)\n      })","file":"integration/custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build server.ts correctly","suites":["Custom Server TypeScript"],"updatePoint":{"line":9,"column":38},"line":9,"code":"  it('should build server.ts correctly', async () => {\n    await buildTS([], appDir)\n  })","file":"integration/custom-server-types/test/index.test.js","skipped":false,"dir":"test"},{"name":"Custom Server $title","suites":[],"line":26,"code":"describe.each([\n  { title: 'using HTTP', useHttps: false },\n  { title: 'using HTTPS', useHttps: true },\n])('Custom Server $title', ({ useHttps }) => {\n  let nextUrl\n\n  const agent = useHttps\n    ? new https.Agent({\n        rejectUnauthorized: false,\n      })\n    : undefined\n\n  const startServer = async (optEnv = {}, opts) => {\n    const scriptPath = join(appDir, 'server.js')\n    context.appPort = appPort = await getPort()\n    nextUrl = `http${useHttps ? 's' : ''}://127.0.0.1:${context.appPort}`\n\n    const env = Object.assign(\n      { ...process.env },\n      { PORT: `${appPort}`, __NEXT_TEST_MODE: 'true', USE_HTTPS: useHttps },\n      optEnv\n    )\n\n    server = await initNextServerScript(\n      scriptPath,\n      /ready on/i,\n      env,\n      /ReferenceError: options is not defined/,\n      opts\n    )\n  }\n\n  describe('with dynamic assetPrefix', () => {\n    beforeAll(() => startServer())\n    afterAll(() => killApp(server))\n\n    it('should serve internal file from render', async () => {\n      const data = await renderViaHTTP(\n        nextUrl,\n        '/static/hello.txt',\n        undefined,\n        { agent }\n      )\n      expect(data).toMatch(/hello world/)\n    })\n\n    it('should handle render with undefined query', async () => {\n      expect(\n        await renderViaHTTP(nextUrl, '/no-query', undefined, { agent })\n      ).toMatch(/\"query\":/)\n    })\n\n    it('should set the assetPrefix dynamically', async () => {\n      const normalUsage = await renderViaHTTP(nextUrl, '/asset', undefined, {\n        agent,\n      })\n      expect(normalUsage).not.toMatch(/127\\.0\\.0\\.1/)\n\n      const dynamicUsage = await renderViaHTTP(\n        nextUrl,\n        '/asset?setAssetPrefix=1',\n        undefined,\n        { agent }\n      )\n      expect(dynamicUsage).toMatch(/127\\.0\\.0\\.1/)\n    })\n\n    it('should handle null assetPrefix accordingly', async () => {\n      const normalUsage = await renderViaHTTP(\n        nextUrl,\n        '/asset?setEmptyAssetPrefix=1',\n        undefined,\n        { agent }\n      )\n      expect(normalUsage).toMatch(/\"\\/_next/)\n    })\n\n    it('should set the assetPrefix to a given request', async () => {\n      for (let lc = 0; lc < 1000; lc++) {\n        const [normalUsage, dynamicUsage] = await Promise.all([\n          await renderViaHTTP(nextUrl, '/asset', undefined, { agent }),\n          await renderViaHTTP(nextUrl, '/asset?setAssetPrefix=1', undefined, {\n            agent,\n          }),\n        ])\n\n        expect(normalUsage).not.toMatch(/127\\.0\\.0\\.1/)\n        expect(dynamicUsage).toMatch(/127\\.0\\.0\\.1/)\n      }\n    })\n\n    it('should render nested index', async () => {\n      const html = await renderViaHTTP(nextUrl, '/dashboard', undefined, {\n        agent,\n      })\n      expect(html).toMatch(/made it to dashboard/)\n    })\n\n    it('should contain customServer in NEXT_DATA', async () => {\n      const html = await renderViaHTTP(nextUrl, '/', undefined, { agent })\n      const $ = cheerio.load(html)\n      expect(JSON.parse($('#__NEXT_DATA__').text()).customServer).toBe(true)\n    })\n  })\n\n  describe('with generateEtags enabled', () => {\n    beforeAll(async () => {\n      await nextBuild(appDir)\n      await startServer({ GENERATE_ETAGS: 'true', NODE_ENV: 'production' })\n    })\n    afterAll(() => killApp(server))\n\n    it('response includes etag header', async () => {\n      const response = await fetchViaHTTP(nextUrl, '/', undefined, { agent })\n      expect(response.headers.get('etag')).toBeTruthy()\n    })\n  })\n\n  describe('with generateEtags disabled', () => {\n    beforeAll(() => startServer({ GENERATE_ETAGS: 'false' }))\n    afterAll(() => killApp(server))\n\n    it('response does not include etag header', async () => {\n      const response = await fetchViaHTTP(nextUrl, '/', undefined, { agent })\n      expect(response.headers.get('etag')).toBeNull()\n    })\n  })\n\n  // playwright fails with SSL error due to self-signed cert\n  if (!useHttps) {\n    describe('HMR with custom server', () => {\n      beforeAll(() => startServer())\n      afterAll(() => {\n        killApp(server)\n        indexPg.restore()\n      })\n\n      it('Should support HMR when rendering with /index pathname', async () => {\n        let browser\n        try {\n          browser = await webdriver(nextUrl, '/test-index-hmr')\n          const text = await browser.elementByCss('#go-asset').text()\n          const logs = await browser.log()\n          expect(text).toBe('Asset')\n\n          // Hydrates with react 18 is correct as expected\n          expect(\n            logs.some((log) =>\n              log.message.includes(\n                'ReactDOM.hydrate is no longer supported in React 18'\n              )\n            )\n          ).toBe(false)\n\n          indexPg.replace('Asset', 'Asset!!')\n\n          await check(() => browser.elementByCss('#go-asset').text(), /Asset!!/)\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })\n    })\n  }\n\n  describe('Error when rendering without starting slash', () => {\n    afterEach(() => killApp(server))\n\n    it('should warn in dev mode', async () => {\n      let stderr = ''\n      await startServer(\n        {},\n        {\n          onStderr(msg) {\n            stderr += msg || ''\n          },\n        }\n      )\n      const html = await renderViaHTTP(nextUrl, '/no-slash', undefined, {\n        agent,\n      })\n      expect(html).toContain('made it to dashboard')\n      expect(stderr).toContain('Cannot render page with path \"dashboard\"')\n    })\n\n    it('should warn in production mode', async () => {\n      const { code } = await nextBuild(appDir)\n      expect(code).toBe(0)\n\n      let stderr = ''\n\n      await startServer(\n        { NODE_ENV: 'production' },\n        {\n          onStderr(msg) {\n            stderr += msg || ''\n          },\n        }\n      )\n\n      const html = await renderViaHTTP(nextUrl, '/no-slash', undefined, {\n        agent,\n      })\n      expect(html).toContain('made it to dashboard')\n      expect(stderr).toContain('Cannot render page with path \"dashboard\"')\n    })\n  })\n\n  describe('compression handling', function () {\n    beforeAll(() => startServer())\n    afterAll(() => killApp(server))\n\n    it.each(['/', '/no-query'])(\n      'should handle compression for route %s',\n      async (route) => {\n        const response = await fetchViaHTTP(nextUrl, route, undefined, {\n          agent,\n        })\n        expect(response.headers.get('Content-Encoding')).toBe('gzip')\n      }\n    )\n  })\n\n  describe('with a custom fetch polyfill', () => {\n    beforeAll(() => startServer({ POLYFILL_FETCH: 'true' }))\n    afterAll(() => killApp(server))\n\n    it('should serve internal file from render', async () => {\n      const data = await renderViaHTTP(\n        nextUrl,\n        '/static/hello.txt',\n        undefined,\n        { agent }\n      )\n      expect(data).toMatch(/hello world/)\n    })\n  })\n\n  describe('unhandled rejection', () => {\n    afterEach(() => killApp(server))\n\n    it('stderr should include error message and stack trace', async () => {\n      let stderr = ''\n      await startServer(\n        {},\n        {\n          onStderr(msg) {\n            stderr += msg || ''\n          },\n        }\n      )\n      await fetchViaHTTP(nextUrl, '/unhandled-rejection', undefined, { agent })\n      await check(() => stderr, /unhandledRejection/)\n      expect(stderr).toContain(\n        'error - unhandledRejection: Error: unhandled rejection'\n      )\n      expect(stderr).toContain('server.js:31:22')\n    })\n  })\n\n  describe('with middleware $title', () => {\n    beforeAll(() => startServer(undefined, undefined, useHttps))\n    afterAll(() => killApp(server))\n\n    it('should read the expected url protocol in middleware', async () => {\n      const path = '/middleware-augmented'\n      const response = await fetchViaHTTP(nextUrl, path, undefined, { agent })\n      expect(response.headers.get('x-original-url')).toBe(\n        `${useHttps ? 'https' : 'http'}://localhost:${appPort}${path}`\n      )\n    })\n  })\n})","file":"integration/custom-server/test/index.test.js","skipped":false,"dir":"test"},{"name":"should serve internal file from render","suites":["with dynamic assetPrefix"],"updatePoint":{"line":62,"column":46},"line":62,"code":"    it('should serve internal file from render', async () => {\n      const data = await renderViaHTTP(\n        nextUrl,\n        '/static/hello.txt',\n        undefined,\n        { agent }\n      )\n      expect(data).toMatch(/hello world/)\n    })","file":"integration/custom-server/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle render with undefined query","suites":["with dynamic assetPrefix"],"updatePoint":{"line":72,"column":49},"line":72,"code":"    it('should handle render with undefined query', async () => {\n      expect(\n        await renderViaHTTP(nextUrl, '/no-query', undefined, { agent })\n      ).toMatch(/\"query\":/)\n    })","file":"integration/custom-server/test/index.test.js","skipped":false,"dir":"test"},{"name":"should set the assetPrefix dynamically","suites":["with dynamic assetPrefix"],"updatePoint":{"line":78,"column":46},"line":78,"code":"    it('should set the assetPrefix dynamically', async () => {\n      const normalUsage = await renderViaHTTP(nextUrl, '/asset', undefined, {\n        agent,\n      })\n      expect(normalUsage).not.toMatch(/127\\.0\\.0\\.1/)\n\n      const dynamicUsage = await renderViaHTTP(\n        nextUrl,\n        '/asset?setAssetPrefix=1',\n        undefined,\n        { agent }\n      )\n      expect(dynamicUsage).toMatch(/127\\.0\\.0\\.1/)\n    })","file":"integration/custom-server/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle null assetPrefix accordingly","suites":["with dynamic assetPrefix"],"updatePoint":{"line":93,"column":50},"line":93,"code":"    it('should handle null assetPrefix accordingly', async () => {\n      const normalUsage = await renderViaHTTP(\n        nextUrl,\n        '/asset?setEmptyAssetPrefix=1',\n        undefined,\n        { agent }\n      )\n      expect(normalUsage).toMatch(/\"\\/_next/)\n    })","file":"integration/custom-server/test/index.test.js","skipped":false,"dir":"test"},{"name":"should set the assetPrefix to a given request","suites":["with dynamic assetPrefix"],"updatePoint":{"line":103,"column":53},"line":103,"code":"    it('should set the assetPrefix to a given request', async () => {\n      for (let lc = 0; lc < 1000; lc++) {\n        const [normalUsage, dynamicUsage] = await Promise.all([\n          await renderViaHTTP(nextUrl, '/asset', undefined, { agent }),\n          await renderViaHTTP(nextUrl, '/asset?setAssetPrefix=1', undefined, {\n            agent,\n          }),\n        ])\n\n        expect(normalUsage).not.toMatch(/127\\.0\\.0\\.1/)\n        expect(dynamicUsage).toMatch(/127\\.0\\.0\\.1/)\n      }\n    })","file":"integration/custom-server/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render nested index","suites":["with dynamic assetPrefix"],"updatePoint":{"line":117,"column":34},"line":117,"code":"    it('should render nested index', async () => {\n      const html = await renderViaHTTP(nextUrl, '/dashboard', undefined, {\n        agent,\n      })\n      expect(html).toMatch(/made it to dashboard/)\n    })","file":"integration/custom-server/test/index.test.js","skipped":false,"dir":"test"},{"name":"should contain customServer in NEXT_DATA","suites":["with dynamic assetPrefix"],"updatePoint":{"line":124,"column":48},"line":124,"code":"    it('should contain customServer in NEXT_DATA', async () => {\n      const html = await renderViaHTTP(nextUrl, '/', undefined, { agent })\n      const $ = cheerio.load(html)\n      expect(JSON.parse($('#__NEXT_DATA__').text()).customServer).toBe(true)\n    })","file":"integration/custom-server/test/index.test.js","skipped":false,"dir":"test"},{"name":"response includes etag header","suites":["with generateEtags enabled"],"updatePoint":{"line":138,"column":37},"line":138,"code":"    it('response includes etag header', async () => {\n      const response = await fetchViaHTTP(nextUrl, '/', undefined, { agent })\n      expect(response.headers.get('etag')).toBeTruthy()\n    })","file":"integration/custom-server/test/index.test.js","skipped":false,"dir":"test"},{"name":"response does not include etag header","suites":["with generateEtags disabled"],"updatePoint":{"line":148,"column":45},"line":148,"code":"    it('response does not include etag header', async () => {\n      const response = await fetchViaHTTP(nextUrl, '/', undefined, { agent })\n      expect(response.headers.get('etag')).toBeNull()\n    })","file":"integration/custom-server/test/index.test.js","skipped":false,"dir":"test"},{"name":"Should support HMR when rendering with /index pathname","suites":["HMR with custom server"],"updatePoint":{"line":163,"column":64},"line":163,"code":"      it('Should support HMR when rendering with /index pathname', async () => {\n        let browser\n        try {\n          browser = await webdriver(nextUrl, '/test-index-hmr')\n          const text = await browser.elementByCss('#go-asset').text()\n          const logs = await browser.log()\n          expect(text).toBe('Asset')\n\n          // Hydrates with react 18 is correct as expected\n          expect(\n            logs.some((log) =>\n              log.message.includes(\n                'ReactDOM.hydrate is no longer supported in React 18'\n              )\n            )\n          ).toBe(false)\n\n          indexPg.replace('Asset', 'Asset!!')\n\n          await check(() => browser.elementByCss('#go-asset').text(), /Asset!!/)\n        } finally {\n          if (browser) {\n            await browser.close()\n          }\n        }\n      })","file":"integration/custom-server/test/index.test.js","skipped":false,"dir":"test"},{"name":"should warn in dev mode","suites":["Error when rendering without starting slash"],"updatePoint":{"line":195,"column":31},"line":195,"code":"    it('should warn in dev mode', async () => {\n      let stderr = ''\n      await startServer(\n        {},\n        {\n          onStderr(msg) {\n            stderr += msg || ''\n          },\n        }\n      )\n      const html = await renderViaHTTP(nextUrl, '/no-slash', undefined, {\n        agent,\n      })\n      expect(html).toContain('made it to dashboard')\n      expect(stderr).toContain('Cannot render page with path \"dashboard\"')\n    })","file":"integration/custom-server/test/index.test.js","skipped":false,"dir":"test"},{"name":"should warn in production mode","suites":["Error when rendering without starting slash"],"updatePoint":{"line":212,"column":38},"line":212,"code":"    it('should warn in production mode', async () => {\n      const { code } = await nextBuild(appDir)\n      expect(code).toBe(0)\n\n      let stderr = ''\n\n      await startServer(\n        { NODE_ENV: 'production' },\n        {\n          onStderr(msg) {\n            stderr += msg || ''\n          },\n        }\n      )\n\n      const html = await renderViaHTTP(nextUrl, '/no-slash', undefined, {\n        agent,\n      })\n      expect(html).toContain('made it to dashboard')\n      expect(stderr).toContain('Cannot render page with path \"dashboard\"')\n    })","file":"integration/custom-server/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle compression for route %s","suites":["compression handling"],"line":239,"code":"    it.each(['/', '/no-query'])(\n      'should handle compression for route %s',\n      async (route) => {\n        const response = await fetchViaHTTP(nextUrl, route, undefined, {\n          agent,\n        })\n        expect(response.headers.get('Content-Encoding')).toBe('gzip')\n      }\n    )","file":"integration/custom-server/test/index.test.js","skipped":false,"dir":"test"},{"name":"should serve internal file from render","suites":["with a custom fetch polyfill"],"updatePoint":{"line":254,"column":46},"line":254,"code":"    it('should serve internal file from render', async () => {\n      const data = await renderViaHTTP(\n        nextUrl,\n        '/static/hello.txt',\n        undefined,\n        { agent }\n      )\n      expect(data).toMatch(/hello world/)\n    })","file":"integration/custom-server/test/index.test.js","skipped":false,"dir":"test"},{"name":"stderr should include error message and stack trace","suites":["unhandled rejection"],"updatePoint":{"line":268,"column":59},"line":268,"code":"    it('stderr should include error message and stack trace', async () => {\n      let stderr = ''\n      await startServer(\n        {},\n        {\n          onStderr(msg) {\n            stderr += msg || ''\n          },\n        }\n      )\n      await fetchViaHTTP(nextUrl, '/unhandled-rejection', undefined, { agent })\n      await check(() => stderr, /unhandledRejection/)\n      expect(stderr).toContain(\n        'error - unhandledRejection: Error: unhandled rejection'\n      )\n      expect(stderr).toContain('server.js:31:22')\n    })","file":"integration/custom-server/test/index.test.js","skipped":false,"dir":"test"},{"name":"should read the expected url protocol in middleware","suites":["with middleware $title"],"updatePoint":{"line":291,"column":59},"line":291,"code":"    it('should read the expected url protocol in middleware', async () => {\n      const path = '/middleware-augmented'\n      const response = await fetchViaHTTP(nextUrl, path, undefined, { agent })\n      expect(response.headers.get('x-original-url')).toBe(\n        `${useHttps ? 'https' : 'http'}://localhost:${appPort}${path}`\n      )\n    })","file":"integration/custom-server/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show error for getStaticProps as component member","suites":[],"updatePoint":{"line":45,"column":62},"line":45,"code":"  it('should show error for getStaticProps as component member', async () => {\n    await fs.writeFile(\n      indexPage,\n      `\n      const Page = () => 'hi'\n      Page.getStaticProps = () => ({ props: { hello: 'world' }})\n      export default Page\n    `\n    )\n    expect(await getStderr()).toContain(\n      `getStaticProps can not be attached to a page's component and must be exported from the page`\n    )\n  })","file":"integration/data-fetching-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show error for getServerSideProps as component member","suites":[],"updatePoint":{"line":59,"column":66},"line":59,"code":"  it('should show error for getServerSideProps as component member', async () => {\n    await fs.writeFile(\n      indexPage,\n      `\n      import React from 'react'\n      export default class MyPage extends React.Component {\n        static async getServerSideProps() {\n          return {\n            props: {\n              hello: 'world'\n            }\n          }\n        }\n        render() {\n          return 'hi'\n        }\n      }\n    `\n    )\n    expect(await getStderr()).toContain(\n      `getServerSideProps can not be attached to a page's component and must be exported from the page`\n    )\n  })","file":"integration/data-fetching-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show error for getStaticPaths as component member","suites":[],"updatePoint":{"line":83,"column":62},"line":83,"code":"  it('should show error for getStaticPaths as component member', async () => {\n    await fs.writeFile(\n      indexPage,\n      `\n      const Page = () => 'hi'\n      Page.getStaticPaths = () => ({ paths: [], fallback: true })\n      export default Page\n    `\n    )\n    expect(await getStderr()).toContain(\n      `getStaticPaths can not be attached to a page's component and must be exported from the page`\n    )\n  })","file":"integration/data-fetching-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show error for undefined getStaticProps","suites":[],"updatePoint":{"line":97,"column":52},"line":97,"code":"  it('should show error for undefined getStaticProps', async () => {\n    await fs.writeFile(\n      indexPage,\n      `\n        export function getStaticProps() {}\n        export default function Page() {\n          return <div />;\n        }\n      `\n    )\n    expect(await getStderr()).toContain(GSP_NO_RETURNED_VALUE)\n  })","file":"integration/data-fetching-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show error for undefined getServerSideProps","suites":[],"updatePoint":{"line":111,"column":58},"line":111,"code":"    it('should show error for undefined getServerSideProps', async () => {\n      await fs.writeFile(\n        indexPage,\n        `\n          export function getServerSideProps() {}\n          export default function Page() {\n            return <div />;\n          }\n        `\n      )\n      expect(await getStderr()).toContain(GSSP_NO_RETURNED_VALUE)\n    })","file":"integration/data-fetching-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"Error stack printed to stderr","suites":["GS(S)P Page Errors","start mode"],"updatePoint":{"line":141,"column":37},"line":141,"code":"    it('Error stack printed to stderr', async () => {\n      try {\n        await fs.writeFile(\n          indexPage,\n          `export default function Page() {\n            return <div/>\n          }\n            export function getStaticProps() {\n              // Make it pass on the build phase\n              if(process.env.NEXT_PHASE === \"${PHASE_PRODUCTION_BUILD}\") {\n                return { props: { foo: 'bar' }, revalidate: 1 }\n              }\n    \n              throw new Error(\"Oops\")\n            }\n            `\n        )\n\n        await nextBuild(appDir)\n\n        appPort = await findPort()\n\n        let stderr = ''\n        app = await nextStart(appDir, appPort, {\n          onStderr: (msg) => {\n            stderr += msg || ''\n          },\n        })\n        await check(async () => {\n          await renderViaHTTP(appPort, '/')\n          return stderr\n        }, /error: oops/i)\n\n        expect(stderr).toContain('Error: Oops')\n        expect(stderr).toContain(`\\n    at getStaticProps`)\n      } finally {\n        await killApp(app)\n      }\n    })","file":"integration/data-fetching-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"Does not have duplicate script references","suites":["De-dedupes scripts in _document"],"updatePoint":{"line":25,"column":47},"line":25,"code":"  it('Does not have duplicate script references', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(html)\n    let foundDuplicate = false\n    const srcs = new Set()\n\n    for (const script of $('script').toArray()) {\n      const { src } = script.attribs\n      if (!src || !src.startsWith('/_next/static')) continue\n      if (srcs.has(src)) {\n        console.error(`Found duplicate script ${src}`)\n        foundDuplicate = true\n      }\n      srcs.add(src)\n    }\n    expect(foundDuplicate).toBe(false)\n  })","file":"integration/dedupes-scripts/test/index.test.js","skipped":false,"dir":"test"},{"name":"page should not reload when the file is not changed","suites":[],"updatePoint":{"line":18,"column":55},"line":18,"code":"it('page should not reload when the file is not changed', async () => {\n  const browser = await webdriver(appPort, '/with+Special&Chars=')\n\n  browser.eval(`window.doesNotReloadCheck = true`)\n\n  await waitFor(10000)\n\n  expect(await browser.eval('window.doesNotReloadCheck')).toBe(true)\n})","file":"integration/development-hmr-refresh/test/index.test.js","skipped":false,"dir":"test"},{"name":"empty runtime-config","suites":["should work with runtime-config in next.config.js"],"updatePoint":{"line":46,"column":28},"line":46,"code":"  test('empty runtime-config', async () => {\n    await fs.writeFile(\n      nextConfig,\n      `\n      module.exports = {\n      }\n    `\n    )\n\n    await runApp({})\n  })","file":"integration/development-runtime-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"with runtime-config","suites":["should work with runtime-config in next.config.js"],"updatePoint":{"line":58,"column":27},"line":58,"code":"  test('with runtime-config', async () => {\n    const config = {\n      serverRuntimeConfig: {\n        mySecret: '**********',\n      },\n      publicRuntimeConfig: {\n        staticFolder: '/static',\n      },\n    }\n\n    await fs.writeFile(\n      nextConfig,\n      `\n      module.exports = ${JSON.stringify(config)}\n    `\n    )\n\n    await runApp(config)\n  })","file":"integration/development-runtime-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page","suites":["disabled JS preloads","production mode"],"updatePoint":{"line":38,"column":30},"line":38,"code":"    it('should render the page', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n      expect(html).toMatch(/Hello World/)\n    })","file":"integration/disable-js-preload/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have JS preload links","suites":["disabled JS preloads","production mode"],"updatePoint":{"line":43,"column":40},"line":43,"code":"    it('should not have JS preload links', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n      const $ = cheerio.load(html)\n      expect($('link[rel=preload]').length).toBe(0)\n    })","file":"integration/disable-js-preload/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page","suites":["disabled JS preloads","dev mode"],"updatePoint":{"line":61,"column":30},"line":61,"code":"    it('should render the page', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n      expect(html).toMatch(/Hello World/)\n    })","file":"integration/disable-js-preload/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have JS preload links","suites":["disabled JS preloads","dev mode"],"updatePoint":{"line":66,"column":40},"line":66,"code":"    it('should not have JS preload links', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n      const $ = cheerio.load(html)\n      expect($('link[rel=preload]').length).toBe(0)\n    })","file":"integration/disable-js-preload/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page","suites":["disabled runtime JS","production mode"],"updatePoint":{"line":38,"column":30},"line":38,"code":"    it('should render the page', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n      expect(html).toMatch(/Hello World/)\n    })","file":"integration/disable-js/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have __NEXT_DATA__ script","suites":["disabled runtime JS","production mode"],"updatePoint":{"line":43,"column":44},"line":43,"code":"    it('should not have __NEXT_DATA__ script', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n\n      const $ = cheerio.load(html)\n      expect($('script#__NEXT_DATA__').length).toBe(0)\n    })","file":"integration/disable-js/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have scripts","suites":["disabled runtime JS","production mode"],"updatePoint":{"line":50,"column":31},"line":50,"code":"    it('should not have scripts', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n      const $ = cheerio.load(html)\n      expect($('script[src]').length).toBe(0)\n    })","file":"integration/disable-js/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have preload links","suites":["disabled runtime JS","production mode"],"updatePoint":{"line":56,"column":37},"line":56,"code":"    it('should not have preload links', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n      const $ = cheerio.load(html)\n      expect($('link[rel=preload]').length).toBe(0)\n    })","file":"integration/disable-js/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page","suites":["disabled runtime JS","dev mode"],"updatePoint":{"line":74,"column":30},"line":74,"code":"    it('should render the page', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n      expect(html).toMatch(/Hello World/)\n    })","file":"integration/disable-js/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have __NEXT_DATA__ script","suites":["disabled runtime JS","dev mode"],"updatePoint":{"line":79,"column":44},"line":79,"code":"    it('should not have __NEXT_DATA__ script', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n\n      const $ = cheerio.load(html)\n      expect($('script#__NEXT_DATA__').length).toBe(1)\n    })","file":"integration/disable-js/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have a script for each preload link","suites":["disabled runtime JS","dev mode"],"updatePoint":{"line":86,"column":50},"line":86,"code":"    it('should have a script for each preload link', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n      const $ = cheerio.load(html)\n      const preloadLinks = $('link[rel=preload]')\n      preloadLinks.each((idx, element) => {\n        const url = $(element).attr('href')\n        expect($(`script[src=\"${url}\"]`).length).toBe(1)\n      })\n    })","file":"integration/disable-js/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page","suites":["distDir","With basic usage"],"updatePoint":{"line":30,"column":30},"line":30,"code":"    it('should render the page', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n      expect(html).toMatch(/Hello World/)\n    })","file":"integration/dist-dir/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build the app within the given `dist` directory","suites":["distDir","With basic usage"],"updatePoint":{"line":35,"column":62},"line":35,"code":"    it('should build the app within the given `dist` directory', async () => {\n      expect(\n        await fs.exists(join(__dirname, `/../dist/${BUILD_ID_FILE}`))\n      ).toBeTruthy()\n    })","file":"integration/dist-dir/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not build the app within the default `.next` directory","suites":["distDir","With basic usage"],"updatePoint":{"line":40,"column":69},"line":40,"code":"    it('should not build the app within the default `.next` directory', async () => {\n      expect(await fs.exists(join(__dirname, '/../.next'))).toBeFalsy()\n    })","file":"integration/dist-dir/test/index.test.js","skipped":false,"dir":"test"},{"name":"should throw error with invalid distDir","suites":["distDir","With basic usage"],"updatePoint":{"line":45,"column":45},"line":45,"code":"  it('should throw error with invalid distDir', async () => {\n    const origNextConfig = await fs.readFile(nextConfig, 'utf8')\n    await fs.writeFile(nextConfig, `module.exports = { distDir: '' }`)\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n    await fs.writeFile(nextConfig, origNextConfig)\n\n    expect(stderr).toContain(\n      'Invalid distDir provided, distDir can not be an empty string. Please remove this config or set it to undefined'\n    )\n  })","file":"integration/dist-dir/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle null/undefined distDir","suites":["distDir","With basic usage"],"updatePoint":{"line":56,"column":42},"line":56,"code":"  it('should handle null/undefined distDir', async () => {\n    const origNextConfig = await fs.readFile(nextConfig, 'utf8')\n    await fs.writeFile(\n      nextConfig,\n      `module.exports = { distDir: null, eslint: { ignoreDuringBuilds: true } }`\n    )\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n    await fs.writeFile(nextConfig, origNextConfig)\n\n    expect(stderr.length).toBe(0)\n  })","file":"integration/dist-dir/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply styles defined in global and module css files in a standard page.","suites":["File Dependencies","production mode"],"updatePoint":{"line":22,"column":86},"line":22,"code":"    it('should apply styles defined in global and module css files in a standard page.', async () => {\n      const browser = await webdriver(appPort, '/')\n      await browser.waitForElementByCss('#index')\n\n      const styles = await browser.eval(() => {\n        const computed = getComputedStyle(document.getElementById('index'))\n        return {\n          color: computed.color,\n          backgroundColor: computed.backgroundColor,\n        }\n      })\n\n      expect(styles).toEqual({\n        color: 'rgb(0, 0, 255)',\n        backgroundColor: 'rgb(200, 200, 200)',\n      })\n    })","file":"integration/document-file-dependencies/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply styles defined in global and module css files in 404 page","suites":["File Dependencies","production mode"],"updatePoint":{"line":40,"column":78},"line":40,"code":"    it('should apply styles defined in global and module css files in 404 page', async () => {\n      const browser = await webdriver(appPort, '/__not_found__')\n      await browser.waitForElementByCss('#notFound')\n\n      const styles = await browser.eval(() => {\n        const computed = getComputedStyle(document.getElementById('notFound'))\n        return {\n          color: computed.color,\n          backgroundColor: computed.backgroundColor,\n        }\n      })\n\n      expect(styles).toEqual({\n        color: 'rgb(0, 255, 0)',\n        backgroundColor: 'rgb(200, 200, 200)',\n      })\n    })","file":"integration/document-file-dependencies/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply styles defined in global and module css files in error page","suites":["File Dependencies","production mode"],"updatePoint":{"line":58,"column":80},"line":58,"code":"    it('should apply styles defined in global and module css files in error page', async () => {\n      const browser = await webdriver(appPort, '/error-trigger')\n      await browser.waitForElementByCss('#error')\n\n      const styles = await browser.eval(() => {\n        const computed = getComputedStyle(document.getElementById('error'))\n        return {\n          color: computed.color,\n          backgroundColor: computed.backgroundColor,\n        }\n      })\n\n      expect(styles).toEqual({\n        color: 'rgb(255, 0, 0)',\n        backgroundColor: 'rgb(200, 200, 200)',\n      })\n    })","file":"integration/document-file-dependencies/test/index.test.js","skipped":false,"dir":"test"},{"name":"warns when using a <title> in document/head","suites":["Custom Document Head Warnings","development mode"],"updatePoint":{"line":24,"column":51},"line":24,"code":"    it('warns when using a <title> in document/head', () => {\n      expect(output).toMatch(\n        /.*Warning: <title> should not be used in _document.js's <Head>\\..*/\n      )\n    })","file":"integration/document-head-warnings/test/index.test.js","skipped":false,"dir":"test"},{"name":"warns when using viewport meta tags in document/head","suites":["Custom Document Head Warnings","development mode"],"updatePoint":{"line":30,"column":60},"line":30,"code":"    it('warns when using viewport meta tags in document/head', () => {\n      expect(output).toMatch(\n        /.*Warning: viewport meta tags should not be used in _document.js's <Head>\\..*/\n      )\n    })","file":"integration/document-head-warnings/test/index.test.js","skipped":false,"dir":"test"},{"name":"warns when using a crossOrigin attribute on document/head","suites":["Custom Document Head Warnings","development mode"],"updatePoint":{"line":36,"column":65},"line":36,"code":"    it('warns when using a crossOrigin attribute on document/head', () => {\n      expect(output).toMatch(\n        /.*Warning: `Head` attribute `crossOrigin` is deprecated\\..*/\n      )\n    })","file":"integration/document-head-warnings/test/index.test.js","skipped":false,"dir":"test"},{"name":"Throws an error during build","suites":["Handles Duplicate Pages","production"],"updatePoint":{"line":17,"column":36},"line":17,"code":"    it('Throws an error during build', async () => {\n      const { stderr } = await nextBuild(appDir, [], { stderr: true })\n      expect(stderr).toContain('Duplicate page detected')\n    })","file":"integration/duplicate-pages/test/index.test.js","skipped":false,"dir":"test"},{"name":"Shows warning in development","suites":["Handles Duplicate Pages","dev mode"],"updatePoint":{"line":24,"column":36},"line":24,"code":"    it('Shows warning in development', async () => {\n      let output\n      const handleOutput = (msg) => {\n        output += msg\n      }\n      const appPort = await findPort()\n      const app = await launchApp(appDir, appPort, {\n        onStdout: handleOutput,\n        onStderr: handleOutput,\n      })\n      await renderViaHTTP(appPort, '/hello')\n      await killApp(app)\n      expect(output).toMatch(/Duplicate page detected/)\n    })","file":"integration/duplicate-pages/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render optional catch-all top-level route with no segments","suites":[],"updatePoint":{"line":20,"column":71},"line":20,"code":"  it('should render optional catch-all top-level route with no segments', async () => {\n    const browser = await webdriver(appPort, '/')\n    try {\n      await browser.waitForElementByCss('#success')\n      await check(() => browser.elementByCss('#success').text(), /yay/)\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/dynamic-optional-routing-root-fallback/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render optional catch-all top-level route with one segment","suites":[],"updatePoint":{"line":30,"column":71},"line":30,"code":"  it('should render optional catch-all top-level route with one segment', async () => {\n    const browser = await webdriver(appPort, '/one')\n    try {\n      await browser.waitForElementByCss('#success')\n      await check(() => browser.elementByCss('#success').text(), /one/)\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/dynamic-optional-routing-root-fallback/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render optional catch-all top-level route with two segments","suites":[],"updatePoint":{"line":40,"column":72},"line":40,"code":"  it('should render optional catch-all top-level route with two segments', async () => {\n    const browser = await webdriver(appPort, '/one/two')\n    try {\n      await browser.waitForElementByCss('#success')\n      await check(() => browser.elementByCss('#success').text(), /one,two/)\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/dynamic-optional-routing-root-fallback/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render optional catch-all top-level route with no segments","suites":[],"updatePoint":{"line":20,"column":71},"line":20,"code":"  it('should render optional catch-all top-level route with no segments', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(html)\n    expect($('#success').text()).toBe('yay')\n  })","file":"integration/dynamic-optional-routing-root-static-paths/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render optional catch-all top-level route with one segment","suites":[],"updatePoint":{"line":26,"column":71},"line":26,"code":"  it('should render optional catch-all top-level route with one segment', async () => {\n    const html = await renderViaHTTP(appPort, '/one')\n    const $ = cheerio.load(html)\n    expect($('#success').text()).toBe('one')\n  })","file":"integration/dynamic-optional-routing-root-static-paths/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render optional catch-all top-level route with two segments","suites":[],"updatePoint":{"line":32,"column":72},"line":32,"code":"  it('should render optional catch-all top-level route with two segments', async () => {\n    const html = await renderViaHTTP(appPort, '/one/two')\n    const $ = cheerio.load(html)\n    expect($('#success').text()).toBe('one,two')\n  })","file":"integration/dynamic-optional-routing-root-static-paths/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render catch-all top-level route with multiple segments","suites":[],"updatePoint":{"line":26,"column":68},"line":26,"code":"  it('should render catch-all top-level route with multiple segments', async () => {\n    const html = await renderViaHTTP(appPort, '/hello/world')\n    const $ = cheerio.load(html)\n    expect($('#route').text()).toBe('top level route param: [hello|world]')\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render catch-all top-level route with single segment","suites":[],"updatePoint":{"line":32,"column":65},"line":32,"code":"  it('should render catch-all top-level route with single segment', async () => {\n    const html = await renderViaHTTP(appPort, '/hello')\n    const $ = cheerio.load(html)\n    expect($('#route').text()).toBe('top level route param: [hello]')\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render catch-all top-level route with no segments","suites":[],"updatePoint":{"line":38,"column":62},"line":38,"code":"  it('should render catch-all top-level route with no segments', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(html)\n    expect($('#route').text()).toBe('top level route param: undefined')\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render catch-all nested route with multiple segments","suites":[],"updatePoint":{"line":44,"column":65},"line":44,"code":"  it('should render catch-all nested route with multiple segments', async () => {\n    const html = await renderViaHTTP(appPort, '/nested/hello/world')\n    const $ = cheerio.load(html)\n    expect($('#route').text()).toBe('nested route param: [hello|world]')\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render catch-all nested route with single segment","suites":[],"updatePoint":{"line":50,"column":62},"line":50,"code":"  it('should render catch-all nested route with single segment', async () => {\n    const html = await renderViaHTTP(appPort, '/nested/hello')\n    const $ = cheerio.load(html)\n    expect($('#route').text()).toBe('nested route param: [hello]')\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render catch-all nested route with no segments","suites":[],"updatePoint":{"line":56,"column":59},"line":56,"code":"  it('should render catch-all nested route with no segments', async () => {\n    const html = await renderViaHTTP(appPort, '/nested')\n    const $ = cheerio.load(html)\n    expect($('#route').text()).toBe('nested route param: undefined')\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render catch-all nested route with no segments and leading slash","suites":[],"updatePoint":{"line":62,"column":77},"line":62,"code":"  it('should render catch-all nested route with no segments and leading slash', async () => {\n    const html = await renderViaHTTP(appPort, '/nested/')\n    const $ = cheerio.load(html)\n    expect($('#route').text()).toBe('nested route param: undefined')\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match catch-all api route with multiple segments","suites":[],"updatePoint":{"line":68,"column":61},"line":68,"code":"  it('should match catch-all api route with multiple segments', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/post/ab/cd')\n    expect(res.status).toBe(200)\n    expect(await res.json()).toEqual({ slug: ['ab', 'cd'] })\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match catch-all api route with single segment","suites":[],"updatePoint":{"line":74,"column":58},"line":74,"code":"  it('should match catch-all api route with single segment', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/post/a')\n    expect(res.status).toBe(200)\n    expect(await res.json()).toEqual({ slug: ['a'] })\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match catch-all api route with no segments","suites":[],"updatePoint":{"line":80,"column":55},"line":80,"code":"  it('should match catch-all api route with no segments', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/post')\n    expect(res.status).toBe(200)\n    expect(await res.json()).toEqual({})\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match catch-all api route with no segments and leading slash","suites":[],"updatePoint":{"line":86,"column":73},"line":86,"code":"  it('should match catch-all api route with no segments and leading slash', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/post/')\n    expect(res.status).toBe(200)\n    expect(await res.json()).toEqual({})\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle getStaticPaths no segments","suites":[],"updatePoint":{"line":92,"column":46},"line":92,"code":"  it('should handle getStaticPaths no segments', async () => {\n    const html = await renderViaHTTP(appPort, '/get-static-paths')\n    const $ = cheerio.load(html)\n    expect($('#route').text()).toBe('gsp route: undefined')\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle getStaticPaths no segments and trailing slash","suites":[],"updatePoint":{"line":98,"column":65},"line":98,"code":"  it('should handle getStaticPaths no segments and trailing slash', async () => {\n    const html = await renderViaHTTP(appPort, '/get-static-paths/')\n    const $ = cheerio.load(html)\n    expect($('#route').text()).toBe('gsp route: undefined')\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle getStaticPaths 1 segment","suites":[],"updatePoint":{"line":104,"column":44},"line":104,"code":"  it('should handle getStaticPaths 1 segment', async () => {\n    const html = await renderViaHTTP(appPort, '/get-static-paths/p1')\n    const $ = cheerio.load(html)\n    expect($('#route').text()).toBe('gsp route: [p1]')\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle getStaticPaths 1 segment and trailing slash","suites":[],"updatePoint":{"line":110,"column":63},"line":110,"code":"  it('should handle getStaticPaths 1 segment and trailing slash', async () => {\n    const html = await renderViaHTTP(appPort, '/get-static-paths/p1/')\n    const $ = cheerio.load(html)\n    expect($('#route').text()).toBe('gsp route: [p1]')\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle getStaticPaths 2 segments","suites":[],"updatePoint":{"line":116,"column":45},"line":116,"code":"  it('should handle getStaticPaths 2 segments', async () => {\n    const html = await renderViaHTTP(appPort, '/get-static-paths/p2/p3')\n    const $ = cheerio.load(html)\n    expect($('#route').text()).toBe('gsp route: [p2|p3]')\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle getStaticPaths 2 segments and trailing slash","suites":[],"updatePoint":{"line":122,"column":64},"line":122,"code":"  it('should handle getStaticPaths 2 segments and trailing slash', async () => {\n    const html = await renderViaHTTP(appPort, '/get-static-paths/p2/p3/')\n    const $ = cheerio.load(html)\n    expect($('#route').text()).toBe('gsp route: [p2|p3]')\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fall back to top-level catch-all","suites":[],"updatePoint":{"line":128,"column":45},"line":128,"code":"  it('should fall back to top-level catch-all', async () => {\n    const html = await renderViaHTTP(appPort, '/get-static-paths/hello/world')\n    const $ = cheerio.load(html)\n    expect($('#route').text()).toBe(\n      'top level route param: [get-static-paths|hello|world]'\n    )\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match root path on undefined param","suites":[],"updatePoint":{"line":136,"column":47},"line":136,"code":"  it('should match root path on undefined param', async () => {\n    const html = await renderViaHTTP(appPort, '/get-static-paths-undefined')\n    const $ = cheerio.load(html)\n    expect($('#route').text()).toBe('gsp undefined route: undefined')\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match root path on false param","suites":[],"updatePoint":{"line":142,"column":43},"line":142,"code":"  it('should match root path on false param', async () => {\n    const html = await renderViaHTTP(appPort, '/get-static-paths-false')\n    const $ = cheerio.load(html)\n    expect($('#route').text()).toBe('gsp false route: undefined')\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match root path on null param","suites":[],"updatePoint":{"line":148,"column":42},"line":148,"code":"  it('should match root path on null param', async () => {\n    const html = await renderViaHTTP(appPort, '/get-static-paths-null')\n    const $ = cheerio.load(html)\n    expect($('#route').text()).toBe('gsp null route: undefined')\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle getStaticPaths with fallback no segments","suites":[],"updatePoint":{"line":154,"column":60},"line":154,"code":"  it('should handle getStaticPaths with fallback no segments', async () => {\n    const html = await renderViaHTTP(appPort, '/get-static-paths-fallback')\n    const $ = cheerio.load(html)\n    expect($('#route').text()).toBe(\n      'gsp fallback route: undefined is not fallback'\n    )\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle getStaticPaths with fallback 2 segments","suites":[],"updatePoint":{"line":162,"column":59},"line":162,"code":"  it('should handle getStaticPaths with fallback 2 segments', async () => {\n    const html = await renderViaHTTP(\n      appPort,\n      '/get-static-paths-fallback/p2/p3'\n    )\n    const $ = cheerio.load(html)\n    expect($('#route').text()).toBe(\n      'gsp fallback route: [p2|p3] is not fallback'\n    )\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fallback correctly when fallback enabled","suites":[],"updatePoint":{"line":173,"column":53},"line":173,"code":"  it('should fallback correctly when fallback enabled', async () => {\n    const html = await renderViaHTTP(\n      appPort,\n      '/get-static-paths-fallback/hello/world'\n    )\n    const $ = cheerio.load(html)\n    expect($('#route').text()).toBe('gsp fallback route: undefined is fallback')\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail to build when optional route has index.js at root","suites":[],"updatePoint":{"line":186,"column":67},"line":186,"code":"  it('should fail to build when optional route has index.js at root', async () => {\n    const invalidRoute = appDir + 'pages/index.js'\n    try {\n      await fs.outputFile(invalidRoute, DUMMY_PAGE, 'utf-8')\n      await buildFn(appDir)\n      await check(\n        () => stderr,\n        /You cannot define a route with the same specificity as a optional catch-all route/\n      )\n    } finally {\n      await fs.unlink(invalidRoute)\n    }\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail to build when optional route has same page at root","suites":[],"updatePoint":{"line":200,"column":68},"line":200,"code":"  it('should fail to build when optional route has same page at root', async () => {\n    const invalidRoute = appDir + 'pages/nested.js'\n    try {\n      await fs.outputFile(invalidRoute, DUMMY_PAGE, 'utf-8')\n      await buildFn(appDir)\n      await check(\n        () => stderr,\n        /You cannot define a route with the same specificity as a optional catch-all route/\n      )\n    } finally {\n      await fs.unlink(invalidRoute)\n    }\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail to build when mixed with regular catch-all","suites":[],"updatePoint":{"line":214,"column":60},"line":214,"code":"  it('should fail to build when mixed with regular catch-all', async () => {\n    const invalidRoute = appDir + 'pages/nested/[...param].js'\n    try {\n      await fs.outputFile(invalidRoute, DUMMY_PAGE, 'utf-8')\n      await buildFn(appDir)\n      await check(() => stderr, /You cannot use both .+ at the same level/)\n    } finally {\n      await fs.unlink(invalidRoute)\n    }\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail to build when optional but no catch-all","suites":[],"updatePoint":{"line":225,"column":57},"line":225,"code":"  it('should fail to build when optional but no catch-all', async () => {\n    const invalidRoute = appDir + 'pages/invalid/[[param]].js'\n    try {\n      await fs.outputFile(invalidRoute, DUMMY_PAGE, 'utf-8')\n      await buildFn(appDir)\n      await check(\n        () => stderr,\n        /Optional route parameters are not yet supported/\n      )\n    } finally {\n      await fs.unlink(invalidRoute)\n    }\n  })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail to build when param is not explicitly defined","suites":["Dynamic Optional Routing","production mode"],"updatePoint":{"line":280,"column":65},"line":280,"code":"    it('should fail to build when param is not explicitly defined', async () => {\n      const invalidRoute = appDir + 'pages/invalid/[[...slug]].js'\n      try {\n        await fs.outputFile(\n          invalidRoute,\n          `\n            export async function getStaticPaths() {\n              return {\n                paths: [\n                  { params: {} },\n                ],\n                fallback: false,\n              }\n            }\n\n            export async function getStaticProps({ params }) {\n              return { props: { params } }\n            }\n\n            export default function Index(props) {\n              return (\n                <div>Invalid</div>\n              )\n            }\n          `,\n          'utf-8'\n        )\n        const { stderr } = await nextBuild(appDir, [], { stderr: true })\n        await expect(stderr).toMatch(\n          'A required parameter (slug) was not provided as an array in getStaticPaths for /invalid/[[...slug]]'\n        )\n      } finally {\n        await fs.unlink(invalidRoute)\n      }\n    })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render normal (non-dynamic) page","suites":["Dynamic Optional Routing","raw serverless mode"],"updatePoint":{"line":371,"column":47},"line":371,"code":"    it('should render normal (non-dynamic) page', async () => {\n      const html = await render('/about')\n      const $ = cheerio.load(html)\n      expect($('#content').text()).toBe('about')\n    })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render top level optional catch-all root","suites":["Dynamic Optional Routing","raw serverless mode"],"updatePoint":{"line":377,"column":55},"line":377,"code":"    it('should render top level optional catch-all root', async () => {\n      const html = await render('/', { optionalName: '' })\n      const $ = cheerio.load(html)\n      expect($('#route').text()).toBe('top level route param: undefined')\n      expect($('#keys').text()).toBe('[]')\n      expect($('#asPath').text()).toBe('/')\n    })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render top level optional catch-all one level","suites":["Dynamic Optional Routing","raw serverless mode"],"updatePoint":{"line":385,"column":60},"line":385,"code":"    it('should render top level optional catch-all one level', async () => {\n      const html = await render('/hello', { optionalName: 'hello' })\n      const $ = cheerio.load(html)\n      expect($('#route').text()).toBe('top level route param: [hello]')\n      expect($('#keys').text()).toBe('[\"optionalName\"]')\n      expect($('#asPath').text()).toBe('/hello')\n    })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render top level optional catch-all two levels","suites":["Dynamic Optional Routing","raw serverless mode"],"updatePoint":{"line":393,"column":61},"line":393,"code":"    it('should render top level optional catch-all two levels', async () => {\n      const html = await render('/hello/world', { optionalName: 'hello/world' })\n      const $ = cheerio.load(html)\n      expect($('#route').text()).toBe('top level route param: [hello|world]')\n      expect($('#keys').text()).toBe('[\"optionalName\"]')\n      expect($('#asPath').text()).toBe('/hello/world')\n    })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render nested optional catch-all root","suites":["Dynamic Optional Routing","raw serverless mode"],"updatePoint":{"line":401,"column":52},"line":401,"code":"    it('should render nested optional catch-all root', async () => {\n      const html = await render('/nested', { optionalName: '' })\n      const $ = cheerio.load(html)\n      expect($('#route').text()).toBe('nested route param: undefined')\n      expect($('#keys').text()).toBe('[]')\n      expect($('#asPath').text()).toBe('/nested')\n    })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render nested optional catch-all one level","suites":["Dynamic Optional Routing","raw serverless mode"],"updatePoint":{"line":409,"column":57},"line":409,"code":"    it('should render nested optional catch-all one level', async () => {\n      const html = await render('/nested/hello', { optionalName: 'hello' })\n      const $ = cheerio.load(html)\n      expect($('#route').text()).toBe('nested route param: [hello]')\n      expect($('#keys').text()).toBe('[\"optionalName\"]')\n      expect($('#asPath').text()).toBe('/nested/hello')\n    })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render nested optional catch-all two levels","suites":["Dynamic Optional Routing","raw serverless mode"],"updatePoint":{"line":417,"column":58},"line":417,"code":"    it('should render nested optional catch-all two levels', async () => {\n      const html = await render('/nested/hello/world', {\n        optionalName: 'hello/world',\n      })\n      const $ = cheerio.load(html)\n      expect($('#route').text()).toBe('nested route param: [hello|world]')\n      expect($('#keys').text()).toBe('[\"optionalName\"]')\n      expect($('#asPath').text()).toBe('/nested/hello/world')\n    })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render optional catch-all api root","suites":["Dynamic Optional Routing","raw serverless mode"],"updatePoint":{"line":427,"column":49},"line":427,"code":"    it('should render optional catch-all api root', async () => {\n      const text = await render('/api/post', { slug: '' })\n      const data = JSON.parse(text)\n      expect(data).toEqual({})\n    })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render optional catch-all api root one level","suites":["Dynamic Optional Routing","raw serverless mode"],"updatePoint":{"line":433,"column":59},"line":433,"code":"    it('should render optional catch-all api root one level', async () => {\n      const text = await render('/api/post/hello', { slug: 'hello' })\n      const data = JSON.parse(text)\n      expect(data).toEqual({ slug: ['hello'] })\n    })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render optional catch-all api root two levels","suites":["Dynamic Optional Routing","raw serverless mode"],"updatePoint":{"line":439,"column":60},"line":439,"code":"    it('should render optional catch-all api root two levels', async () => {\n      const text = await render('/api/post/hello', { slug: 'hello/world' })\n      const data = JSON.parse(text)\n      expect(data).toEqual({ slug: ['hello', 'world'] })\n    })","file":"integration/dynamic-optional-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not throw error when dynamic require is used","suites":["Dynamic require"],"updatePoint":{"line":16,"column":57},"line":16,"code":"  it('should not throw error when dynamic require is used', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toMatch(/If you can see this then we are good/)\n  })","file":"integration/dynamic-require/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not throw error when changing casing of dynamic route file","suites":["Dynamic route rename casing"],"updatePoint":{"line":32,"column":71},"line":32,"code":"  it('should not throw error when changing casing of dynamic route file', async () => {\n    // make sure route is loaded in webpack\n    const html = await renderViaHTTP(appPort, '/abc')\n    expect(html).toContain('hi')\n\n    await fs.rename(pageFile, pageFileAlt)\n    await waitFor(2000)\n\n    expect(stderr).not.toContain(\n      `You cannot use different slug names for the same dynamic path`\n    )\n\n    await fs.rename(pageFileAlt, pageFile)\n    await waitFor(2000)\n\n    expect(stderr).not.toContain(\n      `You cannot use different slug names for the same dynamic path`\n    )\n  })","file":"integration/dynamic-route-rename/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct cache entries on prefetch","suites":[],"updatePoint":{"line":32,"column":53},"line":32,"code":"    it('should have correct cache entries on prefetch', async () => {\n      const browser = await webdriver(appPort, '/')\n      await browser.waitForCondition('!!window.next.router.isReady')\n\n      const getCacheKeys = async () => {\n        return (await browser.eval('Object.keys(window.next.router.sdc)'))\n          .map((key) => {\n            // strip http://localhost:PORT\n            // and then strip buildId prefix\n            return key\n              .substring(key.indexOf('/_next'))\n              .replace(/\\/_next\\/data\\/(.*?)\\//, '/_next/data/BUILD_ID/')\n          })\n          .sort()\n      }\n\n      const cacheKeys = await getCacheKeys()\n      expect(cacheKeys).toEqual([\n        ...(process.env.__MIDDLEWARE_TEST\n          ? // data route is fetched with middleware due to query hydration\n            // since middleware matches the index route\n            ['/_next/data/BUILD_ID/index.json']\n          : []),\n        '/_next/data/BUILD_ID/p1/p2/all-ssg/hello.json?rest=hello',\n        '/_next/data/BUILD_ID/p1/p2/all-ssg/hello1/hello2.json?rest=hello1&rest=hello2',\n        '/_next/data/BUILD_ID/p1/p2/nested-all-ssg/hello.json?rest=hello',\n        '/_next/data/BUILD_ID/p1/p2/nested-all-ssg/hello1/hello2.json?rest=hello1&rest=hello2',\n      ])\n\n      // ensure no new cache entries after navigation\n      const links = [\n        {\n          linkSelector: '#ssg-catch-all-single',\n          waitForSelector: '#all-ssg-content',\n        },\n        {\n          linkSelector: '#ssg-catch-all-single-interpolated',\n          waitForSelector: '#all-ssg-content',\n        },\n        {\n          linkSelector: '#ssg-catch-all-multi',\n          waitForSelector: '#all-ssg-content',\n        },\n        {\n          linkSelector: '#ssg-catch-all-multi-no-as',\n          waitForSelector: '#all-ssg-content',\n        },\n        {\n          linkSelector: '#ssg-catch-all-multi',\n          waitForSelector: '#all-ssg-content',\n        },\n        {\n          linkSelector: '#nested-ssg-catch-all-single',\n          waitForSelector: '#nested-all-ssg-content',\n        },\n        {\n          linkSelector: '#nested-ssg-catch-all-multi',\n          waitForSelector: '#nested-all-ssg-content',\n        },\n      ]\n\n      for (const { linkSelector, waitForSelector } of links) {\n        await browser.elementByCss(linkSelector).click()\n        await browser.waitForElementByCss(waitForSelector)\n        await browser.back()\n        await browser.waitForElementByCss(linkSelector)\n      }\n      const newCacheKeys = await getCacheKeys()\n      expect(newCacheKeys).toEqual(cacheKeys)\n    })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have error after pinging WebSocket","suites":[],"updatePoint":{"line":105,"column":53},"line":105,"code":"    it('should not have error after pinging WebSocket', async () => {\n      const browser = await webdriver(appPort, '/')\n      await browser.eval(`(function() {\n        window.uncaughtErrs = []\n        window.addEventListener('uncaughtexception', function (err) {\n          window.uncaught.push(err)\n        })\n      })()`)\n      const curFrames = [...(await browser.websocketFrames())]\n      await check(async () => {\n        const frames = await browser.websocketFrames()\n        const newFrames = frames.slice(curFrames.length)\n        // console.error({newFrames, curFrames, frames});\n\n        return newFrames.some((frame) => {\n          try {\n            const data = JSON.parse(frame.payload)\n            return data.event === 'pong'\n          } catch (_) {}\n          return false\n        })\n          ? 'success'\n          : JSON.stringify(newFrames)\n      }, 'success')\n      expect(await browser.eval('window.uncaughtErrs.length')).toBe(0)\n    })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should support long URLs for dynamic routes","suites":[],"updatePoint":{"line":133,"column":49},"line":133,"code":"  it('should support long URLs for dynamic routes', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/dash/a9btBxtHQALZ6cxfuj18X6OLGNSkJVzrOXz41HG4QwciZfn7ggRZzPx21dWqGiTBAqFRiWvVNm5ko2lpyso5jtVaXg88dC1jKfqI2qmIcdeyJat8xamrIh2LWnrYRrsBcoKfQU65KHod8DPANuzPS3fkVYWlmov05GQbc82HwR1exOvPVKUKb5gBRWiN0WOh7hN4QyezIuq3dJINAptFQ6m2bNGjYACBRk4MOSHdcQG58oq5Ch7luuqrl9EcbWSa'\n    )\n\n    const html = await res.text()\n    expect(res.status).toBe(200)\n    expect(html).toContain('hi')\n    expect(html).toContain('/dash/[hello-world]')\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle only query on dynamic route","suites":[],"updatePoint":{"line":145,"column":47},"line":145,"code":"  it('should handle only query on dynamic route', async () => {\n    const browser = await webdriver(appPort, '/post-1')\n\n    for (const expectedValues of [\n      {\n        id: 'dynamic-route-only-query',\n        pathname: '/post-2',\n        query: {},\n        hash: '',\n        navQuery: { name: 'post-2' },\n      },\n      {\n        id: 'dynamic-route-only-query-extra',\n        pathname: '/post-3',\n        query: { another: 'value' },\n        hash: '',\n        navQuery: { name: 'post-3', another: 'value' },\n      },\n      {\n        id: 'dynamic-route-only-query-obj',\n        pathname: '/post-4',\n        query: {},\n        hash: '',\n        navQuery: { name: 'post-4' },\n      },\n      {\n        id: 'dynamic-route-only-query-obj-extra',\n        pathname: '/post-5',\n        query: { another: 'value' },\n        hash: '',\n        navQuery: { name: 'post-5', another: 'value' },\n      },\n      {\n        id: 'dynamic-route-query-hash',\n        pathname: '/post-2',\n        query: {},\n        hash: '#hash-too',\n        navQuery: { name: 'post-2' },\n      },\n      {\n        id: 'dynamic-route-query-extra-hash',\n        pathname: '/post-3',\n        query: { another: 'value' },\n        hash: '#hash-again',\n        navQuery: { name: 'post-3', another: 'value' },\n      },\n      {\n        id: 'dynamic-route-query-hash-obj',\n        pathname: '/post-4',\n        query: {},\n        hash: '#hash-too',\n        navQuery: { name: 'post-4' },\n      },\n      {\n        id: 'dynamic-route-query-obj-extra-hash',\n        pathname: '/post-5',\n        query: { another: 'value' },\n        hash: '#hash-again',\n        navQuery: { name: 'post-5', another: 'value' },\n      },\n    ]) {\n      const { id, pathname, query, hash, navQuery } = expectedValues\n\n      const parsedHref = url.parse(\n        await browser.elementByCss(`#${id}`).getAttribute('href'),\n        true\n      )\n      expect(parsedHref.pathname).toBe(pathname)\n      expect(parsedHref.query || {}).toEqual(query)\n      expect(parsedHref.hash || '').toBe(hash)\n\n      await browser.eval('window.beforeNav = 1')\n      await browser.elementByCss(`#${id}`).click()\n      await check(() => browser.eval('window.location.pathname'), pathname)\n\n      expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual(\n        navQuery\n      )\n      expect(await browser.eval('window.location.pathname')).toBe(pathname)\n      expect(await browser.eval('window.location.hash')).toBe(hash)\n      expect(\n        Object.fromEntries(\n          new URLSearchParams(await browser.eval('window.location.search'))\n        )\n      ).toEqual(query)\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle only hash on dynamic route","suites":[],"updatePoint":{"line":234,"column":46},"line":234,"code":"  it('should handle only hash on dynamic route', async () => {\n    const browser = await webdriver(appPort, '/post-1')\n    const parsedHref = url.parse(\n      await browser\n        .elementByCss('#dynamic-route-only-hash')\n        .getAttribute('href'),\n      true\n    )\n    expect(parsedHref.pathname).toBe('/post-1')\n    expect(parsedHref.hash).toBe('#only-hash')\n    expect(parsedHref.query || {}).toEqual({})\n\n    const parsedHref2 = url.parse(\n      await browser\n        .elementByCss('#dynamic-route-only-hash-obj')\n        .getAttribute('href'),\n      true\n    )\n    expect(parsedHref2.pathname).toBe('/post-1')\n    expect(parsedHref2.hash).toBe('#only-hash-obj')\n    expect(parsedHref2.query || {}).toEqual({})\n\n    expect(await browser.eval('window.location.hash')).toBe('')\n\n    await browser.elementByCss('#dynamic-route-only-hash').click()\n    expect(await browser.eval('window.location.hash')).toBe('#only-hash')\n\n    await browser.elementByCss('#dynamic-route-only-hash-obj').click()\n    expect(await browser.eval('window.location.hash')).toBe('#only-hash-obj')\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate with hash to dynamic route with link","suites":[],"updatePoint":{"line":265,"column":58},"line":265,"code":"  it('should navigate with hash to dynamic route with link', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.eval('window.beforeNav = 1')\n\n    await browser\n      .elementByCss('#view-post-1-hash-1')\n      .click()\n      .waitForElementByCss('#asdf')\n\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      name: 'post-1',\n    })\n    expect(await browser.eval('window.next.router.pathname')).toBe('/[name]')\n    expect(await browser.eval('window.location.pathname')).toBe('/post-1')\n    expect(await browser.eval('window.location.hash')).toBe('#my-hash')\n    expect(await browser.eval('window.location.search')).toBe('')\n\n    await browser\n      .back()\n      .waitForElementByCss('#view-post-1-hash-1-interpolated')\n      .elementByCss('#view-post-1-hash-1-interpolated')\n      .click('#view-post-1-hash-1-interpolated')\n      .waitForElementByCss('#asdf')\n\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      name: 'post-1',\n    })\n    expect(await browser.eval('window.next.router.pathname')).toBe('/[name]')\n    expect(await browser.eval('window.location.pathname')).toBe('/post-1')\n    expect(await browser.eval('window.location.hash')).toBe('#my-hash')\n    expect(await browser.eval('window.location.search')).toBe('')\n\n    await browser\n      .back()\n      .waitForElementByCss('#view-post-1-hash-1-href-only')\n      .elementByCss('#view-post-1-hash-1-href-only')\n      .click('#view-post-1-hash-1-href-only')\n      .waitForElementByCss('#asdf')\n\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      name: 'post-1',\n    })\n    expect(await browser.eval('window.next.router.pathname')).toBe('/[name]')\n    expect(await browser.eval('window.location.pathname')).toBe('/post-1')\n    expect(await browser.eval('window.location.hash')).toBe('#my-hash')\n    expect(await browser.eval('window.location.search')).toBe('')\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate with hash to dynamic route with router","suites":[],"updatePoint":{"line":316,"column":60},"line":316,"code":"  it('should navigate with hash to dynamic route with router', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.eval(`(function() {\n      window.beforeNav = 1\n      window.next.router.push('/[name]', '/post-1#my-hash')\n    })()`)\n\n    await browser.waitForElementByCss('#asdf')\n\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      name: 'post-1',\n    })\n    expect(await browser.eval('window.next.router.pathname')).toBe('/[name]')\n    expect(await browser.eval('window.location.pathname')).toBe('/post-1')\n    expect(await browser.eval('window.location.hash')).toBe('#my-hash')\n    expect(await browser.eval('window.location.search')).toBe('')\n\n    await browser.back().waitForElementByCss('#view-post-1-hash-1-interpolated')\n\n    await browser.eval(`(function() {\n      window.beforeNav = 1\n      window.next.router.push({\n        hash: 'my-hash',\n        pathname: '/[name]',\n        query: {\n          name: 'post-1'\n        }\n      })\n    })()`)\n\n    await browser.waitForElementByCss('#asdf')\n\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      name: 'post-1',\n    })\n    expect(await browser.eval('window.next.router.pathname')).toBe('/[name]')\n    expect(await browser.eval('window.location.pathname')).toBe('/post-1')\n    expect(await browser.eval('window.location.hash')).toBe('#my-hash')\n    expect(await browser.eval('window.location.search')).toBe('')\n\n    await browser.eval(`(function() {\n      window.beforeNav = 1\n      window.next.router.push('/post-1#my-hash')\n    })()`)\n\n    await browser.waitForElementByCss('#asdf')\n\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      name: 'post-1',\n    })\n    expect(await browser.eval('window.next.router.pathname')).toBe('/[name]')\n    expect(await browser.eval('window.location.pathname')).toBe('/post-1')\n    expect(await browser.eval('window.location.hash')).toBe('#my-hash')\n    expect(await browser.eval('window.location.search')).toBe('')\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have any query values when not defined","suites":[],"updatePoint":{"line":375,"column":55},"line":375,"code":"  it('should not have any query values when not defined', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(html)\n    expect(JSON.parse($('#query').text())).toEqual([])\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render normal route","suites":[],"updatePoint":{"line":381,"column":32},"line":381,"code":"  it('should render normal route', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toMatch(/my blog/i)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render another normal route","suites":[],"updatePoint":{"line":386,"column":40},"line":386,"code":"  it('should render another normal route', async () => {\n    const html = await renderViaHTTP(appPort, '/another')\n    expect(html).toMatch(/hello from another/)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render dynamic page","suites":[],"updatePoint":{"line":391,"column":32},"line":391,"code":"  it('should render dynamic page', async () => {\n    const html = await renderViaHTTP(appPort, '/post-1')\n    expect(html).toMatch(/this is.*?post-1/i)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prioritize a non-dynamic page","suites":[],"updatePoint":{"line":396,"column":42},"line":396,"code":"  it('should prioritize a non-dynamic page', async () => {\n    const html = await renderViaHTTP(appPort, '/post-1/comments')\n    expect(html).toMatch(/show comments for.*post-1.*here/i)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render nested dynamic page","suites":[],"updatePoint":{"line":401,"column":39},"line":401,"code":"  it('should render nested dynamic page', async () => {\n    const html = await renderViaHTTP(appPort, '/post-1/comment-1')\n    expect(html).toMatch(/i am.*comment-1.*on.*post-1/i)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render optional dynamic page","suites":[],"updatePoint":{"line":406,"column":41},"line":406,"code":"  it('should render optional dynamic page', async () => {\n    const html = await renderViaHTTP(appPort, '/blog/543/comment')\n    // expect(html).toMatch(/blog post.*543.*comment.*all/i)\n    expect(html).toMatch(/404/i)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render nested optional dynamic page","suites":[],"updatePoint":{"line":412,"column":48},"line":412,"code":"  it('should render nested optional dynamic page', async () => {\n    const html = await renderViaHTTP(appPort, '/blog/321/comment/123')\n    expect(html).toMatch(/blog post.*321.*comment.*123/i)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not error when requesting dynamic page with /api","suites":[],"updatePoint":{"line":417,"column":61},"line":417,"code":"  it('should not error when requesting dynamic page with /api', async () => {\n    const res = await fetchViaHTTP(appPort, '/api')\n    expect(res.status).toBe(200)\n    expect(await res.text()).toMatch(/this is.*?api/i)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render dynamic route with query","suites":[],"updatePoint":{"line":423,"column":44},"line":423,"code":"  it('should render dynamic route with query', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.elementByCss('#view-post-1-with-query').click()\n    await waitFor(1000)\n    const url = await browser.eval('window.location.search')\n    expect(url).toBe('?fromHome=true')\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have any console warnings on initial load","suites":[],"updatePoint":{"line":432,"column":60},"line":432,"code":"    it('should not have any console warnings on initial load', async () => {\n      const browser = await webdriver(appPort, '/')\n      expect(await browser.eval('window.caughtWarns')).toEqual([])\n    })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have any console warnings when navigating to dynamic route","suites":[],"updatePoint":{"line":437,"column":77},"line":437,"code":"    it('should not have any console warnings when navigating to dynamic route', async () => {\n      let browser\n      try {\n        browser = await webdriver(appPort, '/')\n        await browser.eval('window.beforeNav = 1')\n        await browser.elementByCss('#dynamic-route-no-as').click()\n        await browser.waitForElementByCss('#asdf')\n\n        expect(await browser.eval('window.beforeNav')).toBe(1)\n\n        const text = await browser.elementByCss('#asdf').text()\n        expect(text).toMatch(/this is.*?dynamic-1/i)\n        expect(await browser.eval('window.caughtWarns')).toEqual([])\n      } finally {\n        if (browser) await browser.close()\n      }\n    })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate to a dynamic page successfully","suites":[],"updatePoint":{"line":456,"column":52},"line":456,"code":"  it('should navigate to a dynamic page successfully', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.eval('window.beforeNav = 1')\n      await browser.elementByCss('#view-post-1').click()\n      await browser.waitForElementByCss('#asdf')\n\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n\n      const text = await browser.elementByCss('#asdf').text()\n      expect(text).toMatch(/this is.*?post-1/i)\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate to a dynamic page with href with differing query and as correctly","suites":[],"updatePoint":{"line":473,"column":87},"line":473,"code":"  it('should navigate to a dynamic page with href with differing query and as correctly', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.eval('window.beforeNav = 1')\n      await browser.elementByCss('#view-post-1-hidden-query').click()\n      await browser.waitForElementByCss('#asdf')\n\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n\n      const text = await browser.elementByCss('#asdf').text()\n      expect(text).toMatch(/this is.*?post-1/i)\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate to a dynamic page successfully no as","suites":[],"updatePoint":{"line":490,"column":58},"line":490,"code":"  it('should navigate to a dynamic page successfully no as', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.eval('window.beforeNav = 1')\n      await browser.elementByCss('#view-post-1-no-as').click()\n      await browser.waitForElementByCss('#asdf')\n\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n\n      const text = await browser.elementByCss('#asdf').text()\n      expect(text).toMatch(/this is.*?post-1/i)\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate to a dynamic page successfully interpolated","suites":[],"updatePoint":{"line":507,"column":65},"line":507,"code":"  it('should navigate to a dynamic page successfully interpolated', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.eval('window.beforeNav = 1')\n\n      const href = await browser\n        .elementByCss('#view-post-1-interpolated')\n        .getAttribute('href')\n\n      const parsedHref = url.parse(href, true)\n      expect(parsedHref.pathname).toBe('/post-1')\n      expect(parsedHref.query).toEqual({})\n\n      await browser.elementByCss('#view-post-1-interpolated').click()\n      await browser.waitForElementByCss('#asdf')\n\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n\n      const text = await browser.elementByCss('#asdf').text()\n      expect(text).toMatch(/this is.*?post-1/i)\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate to a dynamic page successfully interpolated with additional query values","suites":[],"updatePoint":{"line":533,"column":94},"line":533,"code":"  it('should navigate to a dynamic page successfully interpolated with additional query values', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.eval('window.beforeNav = 1')\n\n      const href = await browser\n        .elementByCss('#view-post-1-interpolated-more-query')\n        .getAttribute('href')\n\n      const parsedHref = url.parse(href, true)\n      expect(parsedHref.pathname).toBe('/post-1')\n      expect(parsedHref.query).toEqual({ another: 'value' })\n\n      await browser.elementByCss('#view-post-1-interpolated-more-query').click()\n      await browser.waitForElementByCss('#asdf')\n\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n\n      const text = await browser.elementByCss('#asdf').text()\n      expect(text).toMatch(/this is.*?post-1/i)\n\n      const query = JSON.parse(await browser.elementByCss('#query').text())\n      expect(query).toEqual({\n        name: 'post-1',\n        another: 'value',\n      })\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should allow calling Router.push on mount successfully","suites":[],"updatePoint":{"line":565,"column":60},"line":565,"code":"  it('should allow calling Router.push on mount successfully', async () => {\n    const browser = await webdriver(appPort, '/post-1/on-mount-redir')\n    try {\n      expect(await browser.waitForElementByCss('h3').text()).toBe('My blog')\n    } finally {\n      browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate optional dynamic page","suites":[],"updatePoint":{"line":574,"column":43},"line":574,"code":"  it('should navigate optional dynamic page', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.elementByCss('#view-post-1-comments').click()\n      await browser.waitForElementByCss('#asdf')\n\n      const text = await browser.elementByCss('#asdf').text()\n      expect(text).toMatch(/comments for post-1 here/i)\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate optional dynamic page with value","suites":[],"updatePoint":{"line":588,"column":54},"line":588,"code":"  it('should navigate optional dynamic page with value', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.elementByCss('#view-nested-dynamic-cmnt').click()\n      await browser.waitForElementByCss('#asdf')\n\n      const text = await browser.elementByCss('#asdf').text()\n      expect(text).toMatch(/blog post.*321.*comment.*123/i)\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate to a nested dynamic page successfully","suites":[],"updatePoint":{"line":602,"column":59},"line":602,"code":"  it('should navigate to a nested dynamic page successfully', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.eval('window.beforeNav = 1')\n      await browser.elementByCss('#view-post-1-comment-1').click()\n      await browser.waitForElementByCss('#asdf')\n\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n\n      const text = await browser.elementByCss('#asdf').text()\n      expect(text).toMatch(/i am.*comment-1.*on.*post-1/i)\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate to a nested dynamic page successfully no as","suites":[],"updatePoint":{"line":619,"column":65},"line":619,"code":"  it('should navigate to a nested dynamic page successfully no as', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.eval('window.beforeNav = 1')\n      await browser.elementByCss('#view-post-1-comment-1-no-as').click()\n      await browser.waitForElementByCss('#asdf')\n\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n\n      const text = await browser.elementByCss('#asdf').text()\n      expect(text).toMatch(/i am.*comment-1.*on.*post-1/i)\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate to a nested dynamic page successfully interpolated","suites":[],"updatePoint":{"line":636,"column":72},"line":636,"code":"  it('should navigate to a nested dynamic page successfully interpolated', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.eval('window.beforeNav = 1')\n\n      const href = await browser\n        .elementByCss('#view-post-1-comment-1-interpolated')\n        .getAttribute('href')\n\n      expect(url.parse(href).pathname).toBe('/post-1/comment-1')\n\n      await browser.elementByCss('#view-post-1-comment-1-interpolated').click()\n      await browser.waitForElementByCss('#asdf')\n\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n\n      const text = await browser.elementByCss('#asdf').text()\n      expect(text).toMatch(/i am.*comment-1.*on.*post-1/i)\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should pass params in getInitialProps during SSR","suites":[],"updatePoint":{"line":660,"column":54},"line":660,"code":"  it('should pass params in getInitialProps during SSR', async () => {\n    const html = await renderViaHTTP(appPort, '/post-1/cmnt-1')\n    expect(html).toMatch(/gip.*post-1/i)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should pass params in getInitialProps during client navigation","suites":[],"updatePoint":{"line":665,"column":68},"line":665,"code":"  it('should pass params in getInitialProps during client navigation', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.elementByCss('#view-post-1-comment-1').click()\n      await browser.waitForElementByCss('span')\n\n      const text = await browser.elementByCss('span').text()\n      expect(text).toMatch(/gip.*post-1/i)\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[catch all] should not match root on SSR","suites":[],"updatePoint":{"line":679,"column":46},"line":679,"code":"  it('[catch all] should not match root on SSR', async () => {\n    const res = await fetchViaHTTP(appPort, '/p1/p2/all-ssr')\n    expect(res.status).toBe(404)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[catch all] should pass param in getInitialProps during SSR","suites":[],"updatePoint":{"line":684,"column":65},"line":684,"code":"  it('[catch all] should pass param in getInitialProps during SSR', async () => {\n    const html = await renderViaHTTP(appPort, '/p1/p2/all-ssr/test1')\n    const $ = cheerio.load(html)\n    expect($('#all-ssr-content').text()).toBe('{\"rest\":[\"test1\"]}')\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[catch all] should pass params in getInitialProps during SSR","suites":[],"updatePoint":{"line":690,"column":66},"line":690,"code":"  it('[catch all] should pass params in getInitialProps during SSR', async () => {\n    const html = await renderViaHTTP(appPort, '/p1/p2/all-ssr/test1/test2')\n    const $ = cheerio.load(html)\n    expect($('#all-ssr-content').text()).toBe('{\"rest\":[\"test1\",\"test2\"]}')\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[catch all] should strip trailing slash","suites":[],"updatePoint":{"line":696,"column":45},"line":696,"code":"  it('[catch all] should strip trailing slash', async () => {\n    const html = await renderViaHTTP(appPort, '/p1/p2/all-ssr/test1/test2/')\n    const $ = cheerio.load(html)\n    expect($('#all-ssr-content').text()).toBe('{\"rest\":[\"test1\",\"test2\"]}')\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[catch all] should not decode slashes (start)","suites":[],"updatePoint":{"line":702,"column":51},"line":702,"code":"  it('[catch all] should not decode slashes (start)', async () => {\n    const html = await renderViaHTTP(appPort, '/p1/p2/all-ssr/test1/%2Ftest2')\n    const $ = cheerio.load(html)\n    expect($('#all-ssr-content').text()).toBe('{\"rest\":[\"test1\",\"/test2\"]}')\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[catch all] should not decode slashes (end)","suites":[],"updatePoint":{"line":708,"column":49},"line":708,"code":"  it('[catch all] should not decode slashes (end)', async () => {\n    const html = await renderViaHTTP(appPort, '/p1/p2/all-ssr/test1%2F/test2')\n    const $ = cheerio.load(html)\n    expect($('#all-ssr-content').text()).toBe('{\"rest\":[\"test1/\",\"test2\"]}')\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[catch all] should not decode slashes (middle)","suites":[],"updatePoint":{"line":714,"column":52},"line":714,"code":"  it('[catch all] should not decode slashes (middle)', async () => {\n    const html = await renderViaHTTP(appPort, '/p1/p2/all-ssr/test1/te%2Fst2')\n    const $ = cheerio.load(html)\n    expect($('#all-ssr-content').text()).toBe('{\"rest\":[\"test1\",\"te/st2\"]}')\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[catch-all] should pass params in getInitialProps during client navigation (single)","suites":[],"updatePoint":{"line":720,"column":89},"line":720,"code":"  it('[catch-all] should pass params in getInitialProps during client navigation (single)', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.elementByCss('#catch-all-single').click()\n      await browser.waitForElementByCss('#all-ssr-content')\n\n      const text = await browser.elementByCss('#all-ssr-content').text()\n      expect(text).toBe('{\"rest\":[\"hello\"]}')\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[catch-all] should pass params in getInitialProps during client navigation (multi)","suites":[],"updatePoint":{"line":734,"column":88},"line":734,"code":"  it('[catch-all] should pass params in getInitialProps during client navigation (multi)', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.elementByCss('#catch-all-multi').click()\n      await browser.waitForElementByCss('#all-ssr-content')\n\n      const text = await browser.elementByCss('#all-ssr-content').text()\n      expect(text).toBe('{\"rest\":[\"hello1\",\"hello2\"]}')\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[catch-all] should pass params in getInitialProps during client navigation (encoded)","suites":[],"updatePoint":{"line":748,"column":90},"line":748,"code":"  it('[catch-all] should pass params in getInitialProps during client navigation (encoded)', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.elementByCss('#catch-all-enc').click()\n      await browser.waitForElementByCss('#all-ssr-content')\n\n      const text = await browser.elementByCss('#all-ssr-content').text()\n      expect(text).toBe('{\"rest\":[\"hello1/\",\"he/llo2\"]}')\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[catch-all] shouldn't fail on colon followed by double digits in the path","suites":[],"updatePoint":{"line":762,"column":79},"line":762,"code":"  it(\"[catch-all] shouldn't fail on colon followed by double digits in the path\", async () => {\n    // https://github.com/GoogleChromeLabs/native-url/issues/27\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.elementByCss('#catch-all-colonnumber').click()\n      await browser.waitForElementByCss('#all-ssr-content')\n\n      const text = await browser.elementByCss('#all-ssr-content').text()\n      expect(text).toBe('{\"rest\":[\":42\"]}')\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[ssg: catch all] should pass param in getStaticProps during SSR","suites":[],"updatePoint":{"line":777,"column":69},"line":777,"code":"  it('[ssg: catch all] should pass param in getStaticProps during SSR', async () => {\n    const data = await renderViaHTTP(\n      appPort,\n      `/_next/data/${buildId}/p1/p2/all-ssg/test1.json`\n    )\n    expect(JSON.parse(data).pageProps.params).toEqual({ rest: ['test1'] })\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[ssg: catch all] should pass params in getStaticProps during SSR","suites":[],"updatePoint":{"line":785,"column":70},"line":785,"code":"  it('[ssg: catch all] should pass params in getStaticProps during SSR', async () => {\n    const data = await renderViaHTTP(\n      appPort,\n      `/_next/data/${buildId}/p1/p2/all-ssg/test1/test2.json`\n    )\n    expect(JSON.parse(data).pageProps.params).toEqual({\n      rest: ['test1', 'test2'],\n    })\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[nested ssg: catch all] should pass param in getStaticProps during SSR","suites":[],"updatePoint":{"line":795,"column":76},"line":795,"code":"  it('[nested ssg: catch all] should pass param in getStaticProps during SSR', async () => {\n    const data = await renderViaHTTP(\n      appPort,\n      `/_next/data/${buildId}/p1/p2/nested-all-ssg/test1.json`\n    )\n    expect(JSON.parse(data).pageProps.params).toEqual({ rest: ['test1'] })\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[nested ssg: catch all] should pass params in getStaticProps during SSR","suites":[],"updatePoint":{"line":803,"column":77},"line":803,"code":"  it('[nested ssg: catch all] should pass params in getStaticProps during SSR', async () => {\n    const data = await renderViaHTTP(\n      appPort,\n      `/_next/data/${buildId}/p1/p2/nested-all-ssg/test1/test2.json`\n    )\n    expect(JSON.parse(data).pageProps.params).toEqual({\n      rest: ['test1', 'test2'],\n    })\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[predefined ssg: catch all] should pass param in getStaticProps during SSR","suites":[],"updatePoint":{"line":813,"column":80},"line":813,"code":"  it('[predefined ssg: catch all] should pass param in getStaticProps during SSR', async () => {\n    const data = await renderViaHTTP(\n      appPort,\n      `/_next/data/${buildId}/p1/p2/predefined-ssg/test1.json`\n    )\n    expect(JSON.parse(data).pageProps.params).toEqual({ rest: ['test1'] })\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[predefined ssg: catch all] should pass params in getStaticProps during SSR","suites":[],"updatePoint":{"line":821,"column":81},"line":821,"code":"  it('[predefined ssg: catch all] should pass params in getStaticProps during SSR', async () => {\n    const data = await renderViaHTTP(\n      appPort,\n      `/_next/data/${buildId}/p1/p2/predefined-ssg/test1/test2.json`\n    )\n    expect(JSON.parse(data).pageProps.params).toEqual({\n      rest: ['test1', 'test2'],\n    })\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[predefined ssg: prerendered catch all] should pass param in getStaticProps during SSR","suites":[],"updatePoint":{"line":831,"column":92},"line":831,"code":"  it('[predefined ssg: prerendered catch all] should pass param in getStaticProps during SSR', async () => {\n    const data = await renderViaHTTP(\n      appPort,\n      `/_next/data/${buildId}/p1/p2/predefined-ssg/one-level.json`\n    )\n    expect(JSON.parse(data).pageProps.params).toEqual({ rest: ['one-level'] })\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[predefined ssg: prerendered catch all] should pass params in getStaticProps during SSR","suites":[],"updatePoint":{"line":839,"column":93},"line":839,"code":"  it('[predefined ssg: prerendered catch all] should pass params in getStaticProps during SSR', async () => {\n    const data = await renderViaHTTP(\n      appPort,\n      `/_next/data/${buildId}/p1/p2/predefined-ssg/1st-level/2nd-level.json`\n    )\n    expect(JSON.parse(data).pageProps.params).toEqual({\n      rest: ['1st-level', '2nd-level'],\n    })\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[ssg: catch-all] should pass params in getStaticProps during client navigation (single)","suites":[],"updatePoint":{"line":849,"column":93},"line":849,"code":"  it('[ssg: catch-all] should pass params in getStaticProps during client navigation (single)', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.eval('window.beforeNav = 1')\n      await browser.elementByCss('#ssg-catch-all-single').click()\n      await browser.waitForElementByCss('#all-ssg-content')\n\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n\n      const text = await browser.elementByCss('#all-ssg-content').text()\n      expect(text).toBe('{\"rest\":[\"hello\"]}')\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[ssg: catch-all] should pass params in getStaticProps during client navigation (single interpolated)","suites":[],"updatePoint":{"line":866,"column":106},"line":866,"code":"  it('[ssg: catch-all] should pass params in getStaticProps during client navigation (single interpolated)', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.eval('window.beforeNav = 1')\n\n      const href = await browser\n        .elementByCss('#ssg-catch-all-single-interpolated')\n        .getAttribute('href')\n\n      expect(url.parse(href).pathname).toBe('/p1/p2/all-ssg/hello')\n\n      await browser.elementByCss('#ssg-catch-all-single-interpolated').click()\n      await browser.waitForElementByCss('#all-ssg-content')\n\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n\n      const text = await browser.elementByCss('#all-ssg-content').text()\n      expect(text).toBe('{\"rest\":[\"hello\"]}')\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[ssg: catch-all] should pass params in getStaticProps during client navigation (multi)","suites":[],"updatePoint":{"line":890,"column":92},"line":890,"code":"  it('[ssg: catch-all] should pass params in getStaticProps during client navigation (multi)', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.eval('window.beforeNav = 1')\n      await browser.elementByCss('#ssg-catch-all-multi').click()\n      await browser.waitForElementByCss('#all-ssg-content')\n\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n\n      const text = await browser.elementByCss('#all-ssg-content').text()\n      expect(text).toBe('{\"rest\":[\"hello1\",\"hello2\"]}')\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[ssg: catch-all] should pass params in getStaticProps during client navigation (multi) no as","suites":[],"updatePoint":{"line":907,"column":98},"line":907,"code":"  it('[ssg: catch-all] should pass params in getStaticProps during client navigation (multi) no as', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.eval('window.beforeNav = 1')\n      await browser.elementByCss('#ssg-catch-all-multi-no-as').click()\n      await browser.waitForElementByCss('#all-ssg-content')\n\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n\n      const text = await browser.elementByCss('#all-ssg-content').text()\n      expect(text).toBe('{\"rest\":[\"hello1\",\"hello2\"]}')\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[ssg: catch-all] should pass params in getStaticProps during client navigation (multi interpolated)","suites":[],"updatePoint":{"line":924,"column":105},"line":924,"code":"  it('[ssg: catch-all] should pass params in getStaticProps during client navigation (multi interpolated)', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.eval('window.beforeNav = 1')\n\n      const href = await browser\n        .elementByCss('#ssg-catch-all-multi-interpolated')\n        .getAttribute('href')\n\n      expect(url.parse(href).pathname).toBe('/p1/p2/all-ssg/hello1/hello2')\n\n      await browser.elementByCss('#ssg-catch-all-multi-interpolated').click()\n      await browser.waitForElementByCss('#all-ssg-content')\n\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n\n      const text = await browser.elementByCss('#all-ssg-content').text()\n      expect(text).toBe('{\"rest\":[\"hello1\",\"hello2\"]}')\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[nested ssg: catch-all] should pass params in getStaticProps during client navigation (single)","suites":[],"updatePoint":{"line":948,"column":100},"line":948,"code":"  it('[nested ssg: catch-all] should pass params in getStaticProps during client navigation (single)', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.elementByCss('#nested-ssg-catch-all-single').click()\n      await browser.waitForElementByCss('#nested-all-ssg-content')\n\n      const text = await browser.elementByCss('#nested-all-ssg-content').text()\n      expect(text).toBe('{\"rest\":[\"hello\"]}')\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"[nested ssg: catch-all] should pass params in getStaticProps during client navigation (multi)","suites":[],"updatePoint":{"line":962,"column":99},"line":962,"code":"  it('[nested ssg: catch-all] should pass params in getStaticProps during client navigation (multi)', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.elementByCss('#nested-ssg-catch-all-multi').click()\n      await browser.waitForElementByCss('#nested-all-ssg-content')\n\n      const text = await browser.elementByCss('#nested-all-ssg-content').text()\n      expect(text).toBe('{\"rest\":[\"hello1\",\"hello2\"]}')\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should update dynamic values on mount","suites":[],"updatePoint":{"line":976,"column":43},"line":976,"code":"  it('should update dynamic values on mount', async () => {\n    const html = await renderViaHTTP(appPort, '/on-mount/post-1')\n    expect(html).toMatch(/onmpost:.*pending/)\n\n    const browser = await webdriver(appPort, '/on-mount/post-1')\n    await check(\n      () => browser.eval(`document.body.innerHTML`),\n      /onmpost:.*post-1/\n    )\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have placeholder query values for SSS","suites":[],"updatePoint":{"line":987,"column":54},"line":987,"code":"  it('should not have placeholder query values for SSS', async () => {\n    const html = await renderViaHTTP(appPort, '/on-mount/post-1')\n    expect(html).not.toMatch(/post:.*?\\[post\\].*?<\\/p>/)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should update with a hash in the URL","suites":[],"updatePoint":{"line":992,"column":42},"line":992,"code":"  it('should update with a hash in the URL', async () => {\n    const browser = await webdriver(appPort, '/on-mount/post-1#abc')\n    await check(\n      () => browser.eval(`document.body.innerHTML`),\n      /onmpost:.*post-1/\n    )\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should scroll to a hash on mount","suites":[],"updatePoint":{"line":1000,"column":38},"line":1000,"code":"  it('should scroll to a hash on mount', async () => {\n    const browser = await webdriver(appPort, '/on-mount/post-1#item-400')\n\n    await check(\n      () => browser.eval(`document.body.innerHTML`),\n      /onmpost:.*post-1/\n    )\n\n    const elementPosition = await browser.eval(\n      `document.querySelector(\"#item-400\").getBoundingClientRect().y`\n    )\n    expect(elementPosition).toEqual(0)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should scroll to a hash on client-side navigation","suites":[],"updatePoint":{"line":1014,"column":55},"line":1014,"code":"  it('should scroll to a hash on client-side navigation', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.elementByCss('#view-dynamic-with-hash').click()\n    await browser.waitForElementByCss('#asdf')\n\n    const text = await browser.elementByCss('#asdf').text()\n    expect(text).toMatch(/onmpost:.*test-w-hash/)\n\n    const elementPosition = await browser.eval(\n      `document.querySelector(\"#item-400\").getBoundingClientRect().y`\n    )\n    expect(elementPosition).toEqual(0)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prioritize public files over dynamic route","suites":[],"updatePoint":{"line":1028,"column":55},"line":1028,"code":"  it('should prioritize public files over dynamic route', async () => {\n    const data = await renderViaHTTP(appPort, '/hello.txt')\n    expect(data).toMatch(/hello world/)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should serve file with space from public folder","suites":[],"updatePoint":{"line":1033,"column":53},"line":1033,"code":"  it('should serve file with space from public folder', async () => {\n    const res = await fetchViaHTTP(appPort, '/hello copy.txt')\n    const text = (await res.text()).trim()\n    expect(text).toBe('hello world copy')\n    expect(res.status).toBe(200)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should serve file with plus from public folder","suites":[],"updatePoint":{"line":1040,"column":52},"line":1040,"code":"  it('should serve file with plus from public folder', async () => {\n    const res = await fetchViaHTTP(appPort, '/hello+copy.txt')\n    const text = (await res.text()).trim()\n    expect(text).toBe('hello world +')\n    expect(res.status).toBe(200)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should serve file from public folder encoded","suites":[],"updatePoint":{"line":1047,"column":50},"line":1047,"code":"  it('should serve file from public folder encoded', async () => {\n    const res = await fetchViaHTTP(appPort, '/hello%20copy.txt')\n    const text = (await res.text()).trim()\n    expect(text).toBe('hello world copy')\n    expect(res.status).toBe(200)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should serve file with %20 from public folder","suites":[],"updatePoint":{"line":1054,"column":51},"line":1054,"code":"  it('should serve file with %20 from public folder', async () => {\n    const res = await fetchViaHTTP(appPort, '/hello%2520copy.txt')\n    const text = (await res.text()).trim()\n    expect(text).toBe('hello world %20')\n    expect(res.status).toBe(200)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should serve file with space from static folder","suites":[],"updatePoint":{"line":1061,"column":53},"line":1061,"code":"  it('should serve file with space from static folder', async () => {\n    const res = await fetchViaHTTP(appPort, '/static/hello copy.txt')\n    const text = (await res.text()).trim()\n    expect(text).toBe('hello world copy')\n    expect(res.status).toBe(200)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should serve file with plus from static folder","suites":[],"updatePoint":{"line":1068,"column":52},"line":1068,"code":"  it('should serve file with plus from static folder', async () => {\n    const res = await fetchViaHTTP(appPort, '/static/hello+copy.txt')\n    const text = (await res.text()).trim()\n    expect(text).toBe('hello world +')\n    expect(res.status).toBe(200)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should serve file from static folder encoded","suites":[],"updatePoint":{"line":1075,"column":50},"line":1075,"code":"  it('should serve file from static folder encoded', async () => {\n    const res = await fetchViaHTTP(appPort, '/static/hello%20copy.txt')\n    const text = (await res.text()).trim()\n    expect(text).toBe('hello world copy')\n    expect(res.status).toBe(200)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should serve file with %20 from static folder","suites":[],"updatePoint":{"line":1082,"column":51},"line":1082,"code":"  it('should serve file with %20 from static folder', async () => {\n    const res = await fetchViaHTTP(appPort, '/static/hello%2520copy.txt')\n    const text = (await res.text()).trim()\n    expect(text).toBe('hello world %20')\n    expect(res.status).toBe(200)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should respond with bad request with invalid encoding","suites":[],"updatePoint":{"line":1089,"column":59},"line":1089,"code":"  it('should respond with bad request with invalid encoding', async () => {\n    const res = await fetchViaHTTP(appPort, '/%')\n    expect(res.status).toBe(400)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not preload buildManifest for non-auto export dynamic pages","suites":[],"updatePoint":{"line":1094,"column":72},"line":1094,"code":"  it('should not preload buildManifest for non-auto export dynamic pages', async () => {\n    const html = await renderViaHTTP(appPort, '/hello')\n    const $ = cheerio.load(html)\n    let found = 0\n\n    for (const el of Array.from($('link[rel=\"preload\"]'))) {\n      const { href } = el.attribs\n      if (href.includes('_buildManifest')) {\n        found++\n      }\n    }\n    expect(found).toBe(0)\n  })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve dynamic route href for page added later","suites":[],"updatePoint":{"line":1109,"column":62},"line":1109,"code":"    it('should resolve dynamic route href for page added later', async () => {\n      const browser = await webdriver(appPort, '/')\n      const addLaterPage = join(appDir, 'pages/added-later/[slug].js')\n\n      await fs.mkdir(dirname(addLaterPage)).catch(() => {})\n      await fs.writeFile(\n        addLaterPage,\n        `\n        import { useRouter } from 'next/router'\n\n        export default function Page() {\n          return <p id='added-later'>slug: {useRouter().query.slug}</p>\n        }\n      `\n      )\n\n      await check(async () => {\n        const contents = await renderViaHTTP(\n          appPort,\n          '/_next/static/development/_devPagesManifest.json'\n        )\n        return contents.includes('added-later') ? 'success' : 'fail'\n      }, 'success')\n\n      await browser.elementByCss('#added-later-link').click()\n      await browser.waitForElementByCss('#added-later')\n\n      const text = await browser.elementByCss('#added-later').text()\n\n      await fs.remove(dirname(addLaterPage))\n      expect(text).toBe('slug: first')\n    })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show error when interpolating fails for href","suites":[],"updatePoint":{"line":1143,"column":61},"line":1143,"code":"      it('should show error when interpolating fails for href', async () => {\n        const browser = await webdriver(appPort, '/')\n        await browser\n          .elementByCss('#view-post-1-interpolated-incorrectly')\n          .click()\n        expect(await hasRedbox(browser)).toBe(true)\n        const header = await getRedboxHeader(browser)\n        expect(header).toContain(\n          'The provided `href` (/[name]?another=value) value is missing query values (name) to be interpolated properly.'\n        )\n      })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with HMR correctly","suites":[],"updatePoint":{"line":1156,"column":38},"line":1156,"code":"    it('should work with HMR correctly', async () => {\n      const browser = await webdriver(appPort, '/post-1/comments')\n      let text = await browser.eval(`document.documentElement.innerHTML`)\n      expect(text).toMatch(/comments for.*post-1/)\n\n      const page = join(appDir, 'pages/[name]/comments.js')\n      const origContent = await fs.readFile(page, 'utf8')\n      const newContent = origContent.replace(/comments/, 'commentss')\n\n      try {\n        await fs.writeFile(page, newContent, 'utf8')\n        await waitFor(3 * 1000)\n\n        let text = await browser.eval(`document.documentElement.innerHTML`)\n        expect(text).toMatch(/commentss for.*post-1/)\n      } finally {\n        await fs.writeFile(page, origContent, 'utf8')\n        if (browser) await browser.close()\n      }\n    })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should output a routes-manifest correctly","suites":[],"updatePoint":{"line":1177,"column":49},"line":1177,"code":"    it('should output a routes-manifest correctly', async () => {\n      const manifest = await fs.readJson(\n        join(appDir, '.next/routes-manifest.json')\n      )\n\n      for (const route of manifest.dynamicRoutes) {\n        route.regex = normalizeRegEx(route.regex)\n\n        // ensure regexes are valid\n        new RegExp(route.regex)\n        new RegExp(route.namedRegex)\n      }\n\n      for (const route of manifest.dataRoutes) {\n        route.dataRouteRegex = normalizeRegEx(route.dataRouteRegex)\n\n        // ensure regexes are valid\n        new RegExp(route.dataRouteRegex)\n        new RegExp(route.namedDataRouteRegex)\n      }\n\n      expect(manifest).toEqual({\n        version: 3,\n        pages404: true,\n        basePath: '',\n        headers: [],\n        rewrites: [],\n        staticRoutes: [\n          {\n            namedRegex: '^/(?:/)?$',\n            page: '/',\n            regex: '^/(?:/)?$',\n            routeKeys: {},\n          },\n          {\n            namedRegex: '^/another(?:/)?$',\n            page: '/another',\n            regex: '^/another(?:/)?$',\n            routeKeys: {},\n          },\n        ],\n        redirects: expect.arrayContaining([]),\n        dataRoutes: [\n          {\n            dataRouteRegex: `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n              buildId\n            )}\\\\/b\\\\/([^\\\\/]+?)\\\\.json$`,\n            namedDataRouteRegex: `^/_next/data/${escapeRegex(\n              buildId\n            )}/b/(?<a>[^/]+?)\\\\.json$`,\n            page: '/b/[123]',\n            routeKeys: {\n              a: '123',\n            },\n          },\n          {\n            dataRouteRegex: `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n              buildId\n            )}\\\\/c\\\\/([^\\\\/]+?)\\\\.json$`,\n            namedDataRouteRegex: `^/_next/data/${escapeRegex(\n              buildId\n            )}/c/(?<a>[^/]+?)\\\\.json$`,\n            page: '/c/[alongparamnameshouldbeallowedeventhoughweird]',\n            routeKeys: {\n              a: 'alongparamnameshouldbeallowedeventhoughweird',\n            },\n          },\n          {\n            namedDataRouteRegex: `^/_next/data/${escapeRegex(\n              buildId\n            )}/p1/p2/all\\\\-ssg/(?<rest>.+?)\\\\.json$`,\n            dataRouteRegex: normalizeRegEx(\n              `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                buildId\n              )}\\\\/p1\\\\/p2\\\\/all\\\\-ssg\\\\/(.+?)\\\\.json$`\n            ),\n            page: '/p1/p2/all-ssg/[...rest]',\n            routeKeys: {\n              rest: 'rest',\n            },\n          },\n          {\n            namedDataRouteRegex: `^/_next/data/${escapeRegex(\n              buildId\n            )}/p1/p2/nested\\\\-all\\\\-ssg/(?<rest>.+?)\\\\.json$`,\n            dataRouteRegex: normalizeRegEx(\n              `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                buildId\n              )}\\\\/p1\\\\/p2\\\\/nested\\\\-all\\\\-ssg\\\\/(.+?)\\\\.json$`\n            ),\n            page: '/p1/p2/nested-all-ssg/[...rest]',\n            routeKeys: {\n              rest: 'rest',\n            },\n          },\n          {\n            namedDataRouteRegex: `^/_next/data/${escapeRegex(\n              buildId\n            )}/p1/p2/predefined\\\\-ssg/(?<rest>.+?)\\\\.json$`,\n            dataRouteRegex: normalizeRegEx(\n              `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n                buildId\n              )}\\\\/p1\\\\/p2\\\\/predefined\\\\-ssg\\\\/(.+?)\\\\.json$`\n            ),\n            page: '/p1/p2/predefined-ssg/[...rest]',\n            routeKeys: {\n              rest: 'rest',\n            },\n          },\n        ],\n        dynamicRoutes: [\n          {\n            namedRegex: '^/b/(?<a>[^/]+?)(?:/)?$',\n            page: '/b/[123]',\n            regex: normalizeRegEx('^\\\\/b\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n            routeKeys: {\n              a: '123',\n            },\n          },\n          {\n            namedRegex: `^/blog/(?<name>[^/]+?)/comment/(?<id>[^/]+?)(?:/)?$`,\n            page: '/blog/[name]/comment/[id]',\n            regex: normalizeRegEx(\n              '^\\\\/blog\\\\/([^\\\\/]+?)\\\\/comment\\\\/([^\\\\/]+?)(?:\\\\/)?$'\n            ),\n            routeKeys: {\n              name: 'name',\n              id: 'id',\n            },\n          },\n          {\n            namedRegex: '^/c/(?<a>[^/]+?)(?:/)?$',\n            page: '/c/[alongparamnameshouldbeallowedeventhoughweird]',\n            regex: normalizeRegEx('^\\\\/c\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n            routeKeys: {\n              a: 'alongparamnameshouldbeallowedeventhoughweird',\n            },\n          },\n          {\n            namedRegex: '^/catchall\\\\-dash/(?<helloworld>.+?)(?:/)?$',\n            page: '/catchall-dash/[...hello-world]',\n            regex: normalizeRegEx('^\\\\/catchall\\\\-dash\\\\/(.+?)(?:\\\\/)?$'),\n            routeKeys: {\n              helloworld: 'hello-world',\n            },\n          },\n          {\n            namedRegex: '^/d/(?<id>[^/]+?)(?:/)?$',\n            page: '/d/[id]',\n            regex: normalizeRegEx('^\\\\/d\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n            routeKeys: {\n              id: 'id',\n            },\n          },\n          {\n            namedRegex: '^/dash/(?<helloworld>[^/]+?)(?:/)?$',\n            page: '/dash/[hello-world]',\n            regex: normalizeRegEx('^\\\\/dash\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n            routeKeys: {\n              helloworld: 'hello-world',\n            },\n          },\n          {\n            namedRegex: '^/index/(?<slug>.+?)(?:/)?$',\n            page: '/index/[...slug]',\n            regex: normalizeRegEx('^/index/(.+?)(?:/)?$'),\n            routeKeys: {\n              slug: 'slug',\n            },\n          },\n          {\n            namedRegex: `^/on\\\\-mount/(?<post>[^/]+?)(?:/)?$`,\n            page: '/on-mount/[post]',\n            regex: normalizeRegEx('^\\\\/on\\\\-mount\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n            routeKeys: {\n              post: 'post',\n            },\n          },\n          {\n            namedRegex: `^/p1/p2/all\\\\-ssg/(?<rest>.+?)(?:/)?$`,\n            page: '/p1/p2/all-ssg/[...rest]',\n            regex: normalizeRegEx('^\\\\/p1\\\\/p2\\\\/all\\\\-ssg\\\\/(.+?)(?:\\\\/)?$'),\n            routeKeys: {\n              rest: 'rest',\n            },\n          },\n          {\n            namedRegex: `^/p1/p2/all\\\\-ssr/(?<rest>.+?)(?:/)?$`,\n            page: '/p1/p2/all-ssr/[...rest]',\n            regex: normalizeRegEx('^\\\\/p1\\\\/p2\\\\/all\\\\-ssr\\\\/(.+?)(?:\\\\/)?$'),\n            routeKeys: {\n              rest: 'rest',\n            },\n          },\n          {\n            namedRegex: `^/p1/p2/nested\\\\-all\\\\-ssg/(?<rest>.+?)(?:/)?$`,\n            page: '/p1/p2/nested-all-ssg/[...rest]',\n            regex: normalizeRegEx(\n              '^\\\\/p1\\\\/p2\\\\/nested\\\\-all\\\\-ssg\\\\/(.+?)(?:\\\\/)?$'\n            ),\n            routeKeys: {\n              rest: 'rest',\n            },\n          },\n          {\n            namedRegex: `^/p1/p2/predefined\\\\-ssg/(?<rest>.+?)(?:/)?$`,\n            page: '/p1/p2/predefined-ssg/[...rest]',\n            regex: normalizeRegEx(\n              '^\\\\/p1\\\\/p2\\\\/predefined\\\\-ssg\\\\/(.+?)(?:\\\\/)?$'\n            ),\n            routeKeys: {\n              rest: 'rest',\n            },\n          },\n          {\n            namedRegex: `^/(?<name>[^/]+?)(?:/)?$`,\n            page: '/[name]',\n            regex: normalizeRegEx('^\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n            routeKeys: {\n              name: 'name',\n            },\n          },\n          {\n            namedRegex: `^/(?<name>[^/]+?)/comments(?:/)?$`,\n            page: '/[name]/comments',\n            regex: normalizeRegEx('^\\\\/([^\\\\/]+?)\\\\/comments(?:\\\\/)?$'),\n            routeKeys: {\n              name: 'name',\n            },\n          },\n          {\n            namedRegex: `^/(?<name>[^/]+?)/on\\\\-mount\\\\-redir(?:/)?$`,\n            page: '/[name]/on-mount-redir',\n            regex: normalizeRegEx(\n              '^\\\\/([^\\\\/]+?)\\\\/on\\\\-mount\\\\-redir(?:\\\\/)?$'\n            ),\n            routeKeys: {\n              name: 'name',\n            },\n          },\n          {\n            namedRegex: `^/(?<name>[^/]+?)/(?<comment>[^/]+?)(?:/)?$`,\n            page: '/[name]/[comment]',\n            regex: normalizeRegEx('^\\\\/([^\\\\/]+?)\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n            routeKeys: {\n              name: 'name',\n              comment: 'comment',\n            },\n          },\n        ],\n      })\n    })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should output a pages-manifest correctly","suites":[],"updatePoint":{"line":1431,"column":50},"line":1431,"code":"      it('should output a pages-manifest correctly', async () => {\n        const manifest = await fs.readJson(\n          join(appDir, '.next/server/pages-manifest.json')\n        )\n\n        expect(manifest).toEqual({\n          '/[name]/[comment]': 'pages/[name]/[comment].js',\n          '/[name]/comments': 'pages/[name]/comments.js',\n          '/[name]': 'pages/[name].js',\n          '/[name]/on-mount-redir': 'pages/[name]/on-mount-redir.html',\n          '/another': 'pages/another.html',\n          '/b/[123]': 'pages/b/[123].js',\n          '/blog/[name]/comment/[id]': 'pages/blog/[name]/comment/[id].js',\n          '/c/[alongparamnameshouldbeallowedeventhoughweird]':\n            'pages/c/[alongparamnameshouldbeallowedeventhoughweird].js',\n          '/catchall-dash/[...hello-world]':\n            'pages/catchall-dash/[...hello-world].html',\n          '/d/[id]': 'pages/d/[id].html',\n          '/dash/[hello-world]': 'pages/dash/[hello-world].html',\n          '/': 'pages/index.html',\n          '/index/[...slug]': 'pages/index/[...slug].html',\n          '/on-mount/[post]': 'pages/on-mount/[post].html',\n          '/p1/p2/all-ssg/[...rest]': 'pages/p1/p2/all-ssg/[...rest].js',\n          '/p1/p2/all-ssr/[...rest]': 'pages/p1/p2/all-ssr/[...rest].js',\n          '/p1/p2/nested-all-ssg/[...rest]':\n            'pages/p1/p2/nested-all-ssg/[...rest].js',\n          '/p1/p2/predefined-ssg/[...rest]':\n            'pages/p1/p2/predefined-ssg/[...rest].js',\n          '/_app': 'pages/_app.js',\n          '/_error': 'pages/_error.js',\n          '/_document': 'pages/_document.js',\n          '/404': 'pages/404.html',\n        })\n      })","file":"integration/dynamic-routing/test/index.test.js","skipped":false,"dir":"test"},{"name":"does issue dynamic code evaluation warnings","suites":["Page using eval in dev mode"],"updatePoint":{"line":44,"column":49},"line":44,"code":"  it('does issue dynamic code evaluation warnings', async () => {\n    const html = await renderViaHTTP(context.appPort, '/')\n    expect(html).toMatch(/>.*?100.*?and.*?100.*?<\\//)\n    await waitFor(500)\n    expect(output).not.toContain(EVAL_ERROR)\n    expect(output).not.toContain(DYNAMIC_CODE_ERROR)\n    expect(output).not.toContain(WASM_COMPILE_ERROR)\n    expect(output).not.toContain(WASM_INSTANTIATE_ERROR)\n  })","file":"integration/edge-runtime-dynamic-code/test/index.test.js","skipped":false,"dir":"test"},{"name":"$title usage of dynamic code evaluation","suites":["Page using eval in dev mode"],"line":55,"code":"describe.each([\n  {\n    title: 'Middleware',\n    computeRoute(useCase) {\n      return `/${useCase}`\n    },\n    async extractValue(response) {\n      return JSON.parse(response.headers.get('data')).value\n    },\n  },\n  {\n    title: 'Edge route',\n    computeRoute(useCase) {\n      return `/api/route?case=${useCase}`\n    },\n    async extractValue(response) {\n      return (await response.json()).value\n    },\n  },\n])(\n  '$title usage of dynamic code evaluation',\n  ({ extractValue, computeRoute }) => {\n    describe('dev mode', () => {\n      let output = ''\n\n      beforeAll(async () => {\n        context.appPort = await findPort()\n        context.app = await launchApp(context.appDir, context.appPort, {\n          env: { __NEXT_TEST_WITH_DEVTOOL: 1 },\n          onStdout(msg) {\n            output += msg\n          },\n          onStderr(msg) {\n            output += msg\n          },\n        })\n      })\n\n      beforeEach(() => (output = ''))\n      afterAll(() => killApp(context.app))\n\n      it('shows a warning when running code with eval', async () => {\n        const res = await fetchViaHTTP(\n          context.appPort,\n          computeRoute('using-eval')\n        )\n        expect(await extractValue(res)).toEqual(100)\n        await waitFor(500)\n        expect(output).toContain(EVAL_ERROR)\n        // TODO check why that has a backslash on windows\n        expect(output).toMatch(/lib[\\\\/]utils\\.js/)\n        expect(output).toContain('usingEval')\n        expect(stripAnsi(output)).toContain(\"value: eval('100')\")\n      })\n\n      it('does not show warning when no code uses eval', async () => {\n        const res = await fetchViaHTTP(\n          context.appPort,\n          computeRoute('not-using-eval')\n        )\n        expect(await extractValue(res)).toEqual(100)\n        await waitFor(500)\n        expect(output).not.toContain('Dynamic Code Evaluation')\n      })\n\n      it('shows a warning when running WebAssembly.compile', async () => {\n        const res = await fetchViaHTTP(\n          context.appPort,\n          computeRoute('using-webassembly-compile')\n        )\n        expect(await extractValue(res)).toEqual(81)\n        await waitFor(500)\n        expect(output).toContain(WASM_COMPILE_ERROR)\n        expect(output).toMatch(/lib[\\\\/]wasm\\.js/)\n        expect(output).toContain('usingWebAssemblyCompile')\n        expect(stripAnsi(output)).toContain(\n          'await WebAssembly.compile(SQUARE_WASM_BUFFER)'\n        )\n      })\n\n      it('shows a warning when running WebAssembly.instantiate with a buffer parameter', async () => {\n        const res = await fetchViaHTTP(\n          context.appPort,\n          computeRoute('using-webassembly-instantiate-with-buffer')\n        )\n        expect(await extractValue(res)).toEqual(81)\n        await waitFor(500)\n        expect(output).toContain(WASM_INSTANTIATE_ERROR)\n        expect(output).toMatch(/lib[\\\\/]wasm\\.js/)\n        expect(output).toContain('usingWebAssemblyInstantiateWithBuffer')\n        expect(stripAnsi(output)).toContain(\n          'await WebAssembly.instantiate(SQUARE_WASM_BUFFER, {})'\n        )\n      })\n\n      it('does not show a warning when running WebAssembly.instantiate with a module parameter', async () => {\n        const res = await fetchViaHTTP(\n          context.appPort,\n          computeRoute('using-webassembly-instantiate')\n        )\n        expect(await extractValue(res)).toEqual(81)\n        await waitFor(500)\n        expect(output).not.toContain(WASM_INSTANTIATE_ERROR)\n        expect(output).not.toContain('DynamicWasmCodeGenerationWarning')\n      })\n    })\n\n    describe('production mode', () => {\n      let buildResult\n\n      beforeAll(async () => {\n        buildResult = await nextBuild(context.appDir, undefined, {\n          stderr: true,\n          stdout: true,\n        })\n      })\n\n      it('should have middleware warning during build', () => {\n        expect(buildResult.stderr).toContain(`Failed to compile`)\n        expect(buildResult.stderr).toContain(`Used by usingEval, usingEvalSync`)\n        expect(buildResult.stderr).toContain(`Used by usingWebAssemblyCompile`)\n        expect(buildResult.stderr).toContain(DYNAMIC_CODE_ERROR)\n      })\n    })\n  }\n)","file":"integration/edge-runtime-dynamic-code/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows a warning when running code with eval","suites":["dev mode"],"updatePoint":{"line":96,"column":53},"line":96,"code":"      it('shows a warning when running code with eval', async () => {\n        const res = await fetchViaHTTP(\n          context.appPort,\n          computeRoute('using-eval')\n        )\n        expect(await extractValue(res)).toEqual(100)\n        await waitFor(500)\n        expect(output).toContain(EVAL_ERROR)\n        // TODO check why that has a backslash on windows\n        expect(output).toMatch(/lib[\\\\/]utils\\.js/)\n        expect(output).toContain('usingEval')\n        expect(stripAnsi(output)).toContain(\"value: eval('100')\")\n      })","file":"integration/edge-runtime-dynamic-code/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not show warning when no code uses eval","suites":["dev mode"],"updatePoint":{"line":110,"column":54},"line":110,"code":"      it('does not show warning when no code uses eval', async () => {\n        const res = await fetchViaHTTP(\n          context.appPort,\n          computeRoute('not-using-eval')\n        )\n        expect(await extractValue(res)).toEqual(100)\n        await waitFor(500)\n        expect(output).not.toContain('Dynamic Code Evaluation')\n      })","file":"integration/edge-runtime-dynamic-code/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows a warning when running WebAssembly.compile","suites":["dev mode"],"updatePoint":{"line":120,"column":58},"line":120,"code":"      it('shows a warning when running WebAssembly.compile', async () => {\n        const res = await fetchViaHTTP(\n          context.appPort,\n          computeRoute('using-webassembly-compile')\n        )\n        expect(await extractValue(res)).toEqual(81)\n        await waitFor(500)\n        expect(output).toContain(WASM_COMPILE_ERROR)\n        expect(output).toMatch(/lib[\\\\/]wasm\\.js/)\n        expect(output).toContain('usingWebAssemblyCompile')\n        expect(stripAnsi(output)).toContain(\n          'await WebAssembly.compile(SQUARE_WASM_BUFFER)'\n        )\n      })","file":"integration/edge-runtime-dynamic-code/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows a warning when running WebAssembly.instantiate with a buffer parameter","suites":["dev mode"],"updatePoint":{"line":135,"column":86},"line":135,"code":"      it('shows a warning when running WebAssembly.instantiate with a buffer parameter', async () => {\n        const res = await fetchViaHTTP(\n          context.appPort,\n          computeRoute('using-webassembly-instantiate-with-buffer')\n        )\n        expect(await extractValue(res)).toEqual(81)\n        await waitFor(500)\n        expect(output).toContain(WASM_INSTANTIATE_ERROR)\n        expect(output).toMatch(/lib[\\\\/]wasm\\.js/)\n        expect(output).toContain('usingWebAssemblyInstantiateWithBuffer')\n        expect(stripAnsi(output)).toContain(\n          'await WebAssembly.instantiate(SQUARE_WASM_BUFFER, {})'\n        )\n      })","file":"integration/edge-runtime-dynamic-code/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not show a warning when running WebAssembly.instantiate with a module parameter","suites":["dev mode"],"updatePoint":{"line":150,"column":94},"line":150,"code":"      it('does not show a warning when running WebAssembly.instantiate with a module parameter', async () => {\n        const res = await fetchViaHTTP(\n          context.appPort,\n          computeRoute('using-webassembly-instantiate')\n        )\n        expect(await extractValue(res)).toEqual(81)\n        await waitFor(500)\n        expect(output).not.toContain(WASM_INSTANTIATE_ERROR)\n        expect(output).not.toContain('DynamicWasmCodeGenerationWarning')\n      })","file":"integration/edge-runtime-dynamic-code/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have middleware warning during build","suites":["production mode"],"updatePoint":{"line":172,"column":53},"line":172,"code":"      it('should have middleware warning during build', () => {\n        expect(buildResult.stderr).toContain(`Failed to compile`)\n        expect(buildResult.stderr).toContain(`Used by usingEval, usingEvalSync`)\n        expect(buildResult.stderr).toContain(`Used by usingWebAssemblyCompile`)\n        expect(buildResult.stderr).toContain(DYNAMIC_CODE_ERROR)\n      })","file":"integration/edge-runtime-dynamic-code/test/index.test.js","skipped":false,"dir":"test"},{"name":"$title statically importing node.js module","suites":["Edge runtime code with imports"],"line":58,"code":"  describe.each([\n    {\n      title: 'Edge API',\n      url: routeUrl,\n      init(importStatement) {\n        context.api.write(`\n          ${importStatement}\n\n          export default async function handler(request) {\n            basename()\n            return Response.json({ ok: basename() })\n          }\n\n          export const config = { runtime: 'experimental-edge' }\n        `)\n      },\n    },\n    {\n      title: 'Middleware',\n      url: middlewareUrl,\n      init(importStatement) {\n        context.middleware.write(`\n          import { NextResponse } from 'next/server'\n          ${importStatement}\n\n          export async function middleware(request) {\n            basename()\n            return NextResponse.next()\n          }\n        `)\n      },\n    },\n  ])('$title statically importing node.js module', ({ init, url }) => {\n    const moduleName = 'path'\n    const importStatement = `import { basename } from \"${moduleName}\"`\n\n    beforeEach(() => init(importStatement))\n\n    it('throws unsupported module error in dev at runtime and highlights the faulty line', async () => {\n      context.app = await launchApp(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(500)\n      expectUnsupportedModuleDevError(\n        moduleName,\n        importStatement,\n        await res.text()\n      )\n    })\n\n    it('throws unsupported module error in production at runtime and prints error on logs', async () => {\n      const { stderr } = await nextBuild(context.appDir, undefined, {\n        stderr: true,\n      })\n      expect(stderr).toContain(getUnsupportedModuleWarning(moduleName))\n      context.app = await nextStart(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(500)\n      expectUnsupportedModuleProdError(moduleName)\n    })\n  })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"throws unsupported module error in dev at runtime and highlights the faulty line","suites":["Edge runtime code with imports"],"updatePoint":{"line":96,"column":88},"line":96,"code":"    it('throws unsupported module error in dev at runtime and highlights the faulty line', async () => {\n      context.app = await launchApp(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(500)\n      expectUnsupportedModuleDevError(\n        moduleName,\n        importStatement,\n        await res.text()\n      )\n    })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"throws unsupported module error in production at runtime and prints error on logs","suites":["Edge runtime code with imports"],"updatePoint":{"line":107,"column":89},"line":107,"code":"    it('throws unsupported module error in production at runtime and prints error on logs', async () => {\n      const { stderr } = await nextBuild(context.appDir, undefined, {\n        stderr: true,\n      })\n      expect(stderr).toContain(getUnsupportedModuleWarning(moduleName))\n      context.app = await nextStart(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(500)\n      expectUnsupportedModuleProdError(moduleName)\n    })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"$title dynamically importing node.js module","suites":["Edge runtime code with imports"],"line":119,"code":"  describe.each([\n    {\n      title: 'Edge API',\n      url: routeUrl,\n      init(importStatement) {\n        context.api.write(`\n          import { NextResponse } from 'next/server'\n  \n          export default async function handler(request) {\n            const { writeFile } = ${importStatement}\n            return Response.json({ ok: writeFile() })\n          }\n  \n          export const config = { runtime: 'experimental-edge' }\n        `)\n      },\n    },\n    {\n      title: 'Middleware',\n      url: middlewareUrl,\n      init(importStatement) {\n        context.middleware.write(`\n          import { NextResponse } from 'next/server'\n  \n          export async function middleware(request) {\n            const { writeFile } = ${importStatement}\n            return NextResponse.next()\n          }\n        `)\n      },\n    },\n  ])('$title dynamically importing node.js module', ({ init, url }) => {\n    const moduleName = 'fs'\n    const importStatement = `await import(\"${moduleName}\")`\n\n    beforeEach(() => init(importStatement))\n\n    it('throws unsupported module error in dev at runtime and highlights the faulty line', async () => {\n      context.app = await launchApp(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(500)\n      expectUnsupportedModuleDevError(\n        moduleName,\n        importStatement,\n        await res.text()\n      )\n    })\n\n    it('throws unsupported module error in production at runtime and prints error on logs', async () => {\n      const { stderr } = await nextBuild(context.appDir, undefined, {\n        stderr: true,\n      })\n      expect(stderr).toContain(getUnsupportedModuleWarning(moduleName))\n      context.app = await nextStart(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(500)\n      expectUnsupportedModuleProdError(moduleName)\n    })\n  })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"throws unsupported module error in dev at runtime and highlights the faulty line","suites":["Edge runtime code with imports"],"updatePoint":{"line":156,"column":88},"line":156,"code":"    it('throws unsupported module error in dev at runtime and highlights the faulty line', async () => {\n      context.app = await launchApp(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(500)\n      expectUnsupportedModuleDevError(\n        moduleName,\n        importStatement,\n        await res.text()\n      )\n    })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"throws unsupported module error in production at runtime and prints error on logs","suites":["Edge runtime code with imports"],"updatePoint":{"line":167,"column":89},"line":167,"code":"    it('throws unsupported module error in production at runtime and prints error on logs', async () => {\n      const { stderr } = await nextBuild(context.appDir, undefined, {\n        stderr: true,\n      })\n      expect(stderr).toContain(getUnsupportedModuleWarning(moduleName))\n      context.app = await nextStart(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(500)\n      expectUnsupportedModuleProdError(moduleName)\n    })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"$title dynamically importing node.js module in a lib","suites":["Edge runtime code with imports"],"line":179,"code":"  describe.each([\n    {\n      title: 'Edge API',\n      url: routeUrl,\n      init(importStatement) {\n        context.api.write(`\n          import throwAsync from '../../lib'\n  \n          export default async function handler(request) {\n            return Response.json({ ok: await throwAsync() })\n          }\n  \n          export const config = { runtime: 'experimental-edge' }\n        `)\n      },\n    },\n    {\n      title: 'Middleware',\n      url: middlewareUrl,\n      init(importStatement) {\n        context.middleware.write(`\n          import { NextResponse } from 'next/server'\n          import throwAsync from './lib'\n  \n          export async function middleware(request) {\n            await throwAsync()\n            return NextResponse.next()\n          }\n        `)\n      },\n    },\n  ])(\n    '$title dynamically importing node.js module in a lib',\n    ({ init, url }) => {\n      const moduleName = 'os'\n      const importStatement = `await import(\"${moduleName}\")`\n\n      beforeEach(() => {\n        init(importStatement)\n        context.lib.write(`\n        export default async function throwAsync() {\n          (${importStatement}).cwd()\n        }\n      `)\n      })\n\n      it('throws unsupported module error in dev at runtime and highlights the faulty line', async () => {\n        context.app = await launchApp(\n          context.appDir,\n          context.appPort,\n          appOption\n        )\n        const res = await fetchViaHTTP(context.appPort, url)\n        expect(res.status).toBe(500)\n        expectUnsupportedModuleDevError(\n          moduleName,\n          importStatement,\n          await res.text()\n        )\n      })\n\n      it('throws unsupported module error in production at runtime and prints error on logs', async () => {\n        const { stderr } = await nextBuild(context.appDir, undefined, {\n          stderr: true,\n        })\n        expect(stderr).toContain(getUnsupportedModuleWarning(moduleName))\n        context.app = await nextStart(\n          context.appDir,\n          context.appPort,\n          appOption\n        )\n        const res = await fetchViaHTTP(context.appPort, url)\n        expect(res.status).toBe(500)\n        expectUnsupportedModuleProdError(moduleName)\n      })\n    }\n  )","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"throws unsupported module error in dev at runtime and highlights the faulty line","suites":["Edge runtime code with imports"],"updatePoint":{"line":225,"column":90},"line":225,"code":"      it('throws unsupported module error in dev at runtime and highlights the faulty line', async () => {\n        context.app = await launchApp(\n          context.appDir,\n          context.appPort,\n          appOption\n        )\n        const res = await fetchViaHTTP(context.appPort, url)\n        expect(res.status).toBe(500)\n        expectUnsupportedModuleDevError(\n          moduleName,\n          importStatement,\n          await res.text()\n        )\n      })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"throws unsupported module error in production at runtime and prints error on logs","suites":["Edge runtime code with imports"],"updatePoint":{"line":240,"column":91},"line":240,"code":"      it('throws unsupported module error in production at runtime and prints error on logs', async () => {\n        const { stderr } = await nextBuild(context.appDir, undefined, {\n          stderr: true,\n        })\n        expect(stderr).toContain(getUnsupportedModuleWarning(moduleName))\n        context.app = await nextStart(\n          context.appDir,\n          context.appPort,\n          appOption\n        )\n        const res = await fetchViaHTTP(context.appPort, url)\n        expect(res.status).toBe(500)\n        expectUnsupportedModuleProdError(moduleName)\n      })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"$title statically importing 3rd party module","suites":["Edge runtime code with imports"],"line":257,"code":"  describe.each([\n    {\n      title: 'Edge API',\n      url: routeUrl,\n      init(importStatement) {\n        context.api.write(`\n          ${importStatement}\n  \n          export default async function handler(request) {\n            new Unknown()\n            return Response.json({ ok: true })\n          }\n  \n          export const config = { runtime: 'experimental-edge' }\n        `)\n      },\n    },\n    {\n      title: 'Middleware',\n      url: middlewareUrl,\n      init(importStatement) {\n        context.middleware.write(`\n          import { NextResponse } from 'next/server'\n          ${importStatement}\n  \n          export async function middleware(request) {\n            new Unknown()\n            return NextResponse.next()\n          }\n        `)\n      },\n    },\n  ])('$title statically importing 3rd party module', ({ init, url }) => {\n    const moduleName = 'not-exist'\n    const importStatement = `import Unknown from \"${moduleName}\"`\n\n    beforeEach(() => init(importStatement))\n\n    it('throws not-found module error in dev at runtime and highlights the faulty line', async () => {\n      context.app = await launchApp(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(500)\n      expectModuleNotFoundDevError(\n        moduleName,\n        importStatement,\n        await res.text()\n      )\n    })\n\n    it('does not build and reports', async () => {\n      const { code, stderr } = await nextBuild(context.appDir, undefined, {\n        ignoreFail: true,\n        stdout: true,\n        stderr: true,\n      })\n      expect(code).toEqual(1)\n      expectModuleNotFoundProdError(moduleName, stderr)\n    })\n  })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"throws not-found module error in dev at runtime and highlights the faulty line","suites":["Edge runtime code with imports"],"updatePoint":{"line":295,"column":86},"line":295,"code":"    it('throws not-found module error in dev at runtime and highlights the faulty line', async () => {\n      context.app = await launchApp(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(500)\n      expectModuleNotFoundDevError(\n        moduleName,\n        importStatement,\n        await res.text()\n      )\n    })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not build and reports","suites":["Edge runtime code with imports"],"updatePoint":{"line":306,"column":34},"line":306,"code":"    it('does not build and reports', async () => {\n      const { code, stderr } = await nextBuild(context.appDir, undefined, {\n        ignoreFail: true,\n        stdout: true,\n        stderr: true,\n      })\n      expect(code).toEqual(1)\n      expectModuleNotFoundProdError(moduleName, stderr)\n    })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"$title dynamically importing 3rd party module","suites":["Edge runtime code with imports"],"line":317,"code":"  describe.each([\n    {\n      title: 'Edge API',\n      url: routeUrl,\n      init(importStatement) {\n        context.api.write(`\n          export default async function handler(request) {\n            new (${importStatement})()\n            return Response.json({ ok: true })\n          }\n  \n          export const config = { runtime: 'experimental-edge' }\n        `)\n      },\n    },\n    {\n      title: 'Middleware',\n      url: middlewareUrl,\n      init(importStatement) {\n        context.middleware.write(`\n          import { NextResponse } from 'next/server'\n  \n          export async function middleware(request) {\n            new (${importStatement})()\n            return NextResponse.next()\n          }\n        `)\n      },\n    },\n  ])('$title dynamically importing 3rd party module', ({ init, url }) => {\n    const moduleName = 'not-exist'\n    const importStatement = `await import(\"${moduleName}\")`\n\n    beforeEach(() => init(importStatement))\n\n    it('throws not-found module error in dev at runtime and highlights the faulty line', async () => {\n      context.app = await launchApp(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(500)\n      expectModuleNotFoundDevError(\n        moduleName,\n        importStatement,\n        await res.text()\n      )\n    })\n\n    it('does not build and reports module not found error', async () => {\n      const { code, stderr } = await nextBuild(context.appDir, undefined, {\n        ignoreFail: true,\n        stdout: true,\n        stderr: true,\n      })\n      expect(code).toEqual(1)\n      expectModuleNotFoundProdError(moduleName, stderr)\n    })\n  })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"throws not-found module error in dev at runtime and highlights the faulty line","suites":["Edge runtime code with imports"],"updatePoint":{"line":352,"column":86},"line":352,"code":"    it('throws not-found module error in dev at runtime and highlights the faulty line', async () => {\n      context.app = await launchApp(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(500)\n      expectModuleNotFoundDevError(\n        moduleName,\n        importStatement,\n        await res.text()\n      )\n    })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not build and reports module not found error","suites":["Edge runtime code with imports"],"updatePoint":{"line":363,"column":57},"line":363,"code":"    it('does not build and reports module not found error', async () => {\n      const { code, stderr } = await nextBuild(context.appDir, undefined, {\n        ignoreFail: true,\n        stdout: true,\n        stderr: true,\n      })\n      expect(code).toEqual(1)\n      expectModuleNotFoundProdError(moduleName, stderr)\n    })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"$title importing unused 3rd party module","suites":["Edge runtime code with imports"],"line":374,"code":"  describe.each([\n    {\n      title: 'Edge API',\n      url: routeUrl,\n      init(importStatement) {\n        context.api.write(`\n          export default async function handler(request) {\n            if (process.env === 'production') {\n              new (${importStatement})()\n            }\n            return Response.json({ ok: true })\n          }\n  \n          export const config = { runtime: 'experimental-edge' }\n        `)\n      },\n    },\n    {\n      title: 'Middleware',\n      url: middlewareUrl,\n      init(importStatement) {\n        context.middleware.write(`\n          import { NextResponse } from 'next/server'\n  \n          export async function middleware(request) {\n            if (process.env === 'production') {\n              new (${importStatement})()\n            }\n            return NextResponse.next()\n          }\n        `)\n      },\n    },\n  ])('$title importing unused 3rd party module', ({ init, url }) => {\n    const moduleName = 'not-exist'\n    const importStatement = `await import(\"${moduleName}\")`\n\n    beforeEach(() => init(importStatement))\n\n    it('throws not-found module error in dev at runtime and highlights the faulty line', async () => {\n      context.app = await launchApp(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(500)\n      expectModuleNotFoundDevError(\n        moduleName,\n        importStatement,\n        await res.text()\n      )\n    })\n\n    it('does not build and reports module not found error', async () => {\n      const { code, stderr } = await nextBuild(context.appDir, undefined, {\n        ignoreFail: true,\n        stdout: true,\n        stderr: true,\n      })\n      expect(code).toEqual(1)\n      expectModuleNotFoundProdError(moduleName, stderr)\n    })\n  })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"throws not-found module error in dev at runtime and highlights the faulty line","suites":["Edge runtime code with imports"],"updatePoint":{"line":413,"column":86},"line":413,"code":"    it('throws not-found module error in dev at runtime and highlights the faulty line', async () => {\n      context.app = await launchApp(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(500)\n      expectModuleNotFoundDevError(\n        moduleName,\n        importStatement,\n        await res.text()\n      )\n    })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not build and reports module not found error","suites":["Edge runtime code with imports"],"updatePoint":{"line":424,"column":57},"line":424,"code":"    it('does not build and reports module not found error', async () => {\n      const { code, stderr } = await nextBuild(context.appDir, undefined, {\n        ignoreFail: true,\n        stdout: true,\n        stderr: true,\n      })\n      expect(code).toEqual(1)\n      expectModuleNotFoundProdError(moduleName, stderr)\n    })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"$title importing unused node.js module","suites":["Edge runtime code with imports"],"line":435,"code":"  describe.each([\n    {\n      title: 'Edge API',\n      url: routeUrl,\n      init(importStatement) {\n        context.api.write(`\n          export default async function handler(request) {\n            if (process.env === 'production') {\n              (${importStatement}).spawn('ls', ['-lh', '/usr'])\n            }\n            return Response.json({ ok: true })\n          }\n  \n          export const config = { runtime: 'experimental-edge' }\n        `)\n      },\n    },\n    {\n      title: 'Middleware',\n      url: middlewareUrl,\n      init(importStatement) {\n        context.middleware.write(`\n          import { NextResponse } from 'next/server'\n  \n          export async function middleware(request) {\n            if (process.env === 'production') {\n              (${importStatement}).spawn('ls', ['-lh', '/usr'])\n            }\n            return NextResponse.next()\n          }\n        `)\n      },\n    },\n  ])('$title importing unused node.js module', ({ init, url }) => {\n    const moduleName = 'child_process'\n    const importStatement = `await import(\"${moduleName}\")`\n\n    beforeEach(() => init(importStatement))\n\n    it('does not throw in dev at runtime', async () => {\n      context.app = await launchApp(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(200)\n      expectNoError(moduleName)\n    })\n\n    it('does not throw in production at runtime', async () => {\n      const { stderr } = await nextBuild(context.appDir, undefined, {\n        stderr: true,\n      })\n      expect(stderr).toContain(getUnsupportedModuleWarning(moduleName))\n      context.app = await nextStart(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(200)\n      expectNoError(moduleName)\n    })\n  })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not throw in dev at runtime","suites":["Edge runtime code with imports"],"updatePoint":{"line":474,"column":40},"line":474,"code":"    it('does not throw in dev at runtime', async () => {\n      context.app = await launchApp(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(200)\n      expectNoError(moduleName)\n    })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not throw in production at runtime","suites":["Edge runtime code with imports"],"updatePoint":{"line":481,"column":47},"line":481,"code":"    it('does not throw in production at runtime', async () => {\n      const { stderr } = await nextBuild(context.appDir, undefined, {\n        stderr: true,\n      })\n      expect(stderr).toContain(getUnsupportedModuleWarning(moduleName))\n      context.app = await nextStart(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(200)\n      expectNoError(moduleName)\n    })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"$title importing vanilla 3rd party module","suites":["Edge runtime code with imports"],"line":493,"code":"  describe.each([\n    {\n      title: 'Edge API',\n      url: routeUrl,\n      init(importStatement) {\n        context.api.write(`\n          ${importStatement}\n          export default async function handler(request) {\n            const response = Response.json({ ok: true })\n            response.headers.set('x-from-runtime', nanoid())\n            return response\n          }\n  \n          export const config = { runtime: 'experimental-edge' }\n        `)\n      },\n    },\n    {\n      title: 'Middleware',\n      url: middlewareUrl,\n      init(importStatement) {\n        context.middleware.write(`\n          import { NextResponse } from 'next/server'\n          ${importStatement}\n\n          export async function middleware(request) {\n            const response = NextResponse.next()\n            response.headers.set('x-from-runtime', nanoid())\n            return response\n          }\n        `)\n      },\n    },\n  ])('$title importing vanilla 3rd party module', ({ init, url }) => {\n    const moduleName = 'nanoid'\n    const importStatement = `import { nanoid } from \"${moduleName}\"`\n\n    beforeEach(() => init(importStatement))\n\n    it('does not throw in dev at runtime', async () => {\n      context.app = await launchApp(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(200)\n      expect(res.headers.get('x-from-runtime')).toBeDefined()\n      expectNoError(moduleName)\n    })\n\n    it('does not throw in production at runtime', async () => {\n      const { stderr } = await nextBuild(context.appDir, undefined, {\n        stderr: true,\n      })\n      expect(stderr).not.toContain(getUnsupportedModuleWarning(moduleName))\n      context.app = await nextStart(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(200)\n      expect(res.headers.get('x-from-runtime')).toBeDefined()\n      expectNoError(moduleName)\n    })\n  })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not throw in dev at runtime","suites":["Edge runtime code with imports"],"updatePoint":{"line":532,"column":40},"line":532,"code":"    it('does not throw in dev at runtime', async () => {\n      context.app = await launchApp(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(200)\n      expect(res.headers.get('x-from-runtime')).toBeDefined()\n      expectNoError(moduleName)\n    })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not throw in production at runtime","suites":["Edge runtime code with imports"],"updatePoint":{"line":540,"column":47},"line":540,"code":"    it('does not throw in production at runtime', async () => {\n      const { stderr } = await nextBuild(context.appDir, undefined, {\n        stderr: true,\n      })\n      expect(stderr).not.toContain(getUnsupportedModuleWarning(moduleName))\n      context.app = await nextStart(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(200)\n      expect(res.headers.get('x-from-runtime')).toBeDefined()\n      expectNoError(moduleName)\n    })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"$title using Buffer polyfill","suites":["Edge runtime code with imports"],"line":553,"code":"  describe.each([\n    {\n      title: 'Edge API',\n      url: routeUrl,\n      init(importStatement) {\n        context.api.write(`\n          ${importStatement}\n\n          export default async function handler(request) {\n            const response = Response.json({ ok: true })\n            response.headers.set('x-from-runtime', Buffer.isBuffer('a string'))\n            return response\n          }\n  \n          export const config = { runtime: 'experimental-edge' }\n        `)\n      },\n    },\n    {\n      title: 'Middleware',\n      url: middlewareUrl,\n      init(importStatement) {\n        context.middleware.write(`\n          import { NextResponse } from 'next/server'\n          ${importStatement}\n\n          export async function middleware(request) {\n            const response = NextResponse.next()\n            response.headers.set('x-from-runtime', Buffer.isBuffer('a string'))\n            return response\n          }\n        `)\n      },\n    },\n  ])('$title using Buffer polyfill', ({ init, url }) => {\n    const moduleName = 'buffer'\n    const importStatement = `import { Buffer } from \"${moduleName}\"`\n\n    beforeEach(() => init(importStatement))\n\n    it('does not throw in dev at runtime', async () => {\n      context.app = await launchApp(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(200)\n      expect(res.headers.get('x-from-runtime')).toBe('false')\n      expectNoError(moduleName)\n    })\n\n    it('does not throw in production at runtime', async () => {\n      await nextBuild(context.appDir, undefined, { stderr: true })\n      context.app = await nextStart(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(200)\n      expect(res.headers.get('x-from-runtime')).toBe('false')\n      expectNoError(moduleName)\n    })\n  })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not throw in dev at runtime","suites":["Edge runtime code with imports"],"updatePoint":{"line":593,"column":40},"line":593,"code":"    it('does not throw in dev at runtime', async () => {\n      context.app = await launchApp(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(200)\n      expect(res.headers.get('x-from-runtime')).toBe('false')\n      expectNoError(moduleName)\n    })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not throw in production at runtime","suites":["Edge runtime code with imports"],"updatePoint":{"line":601,"column":47},"line":601,"code":"    it('does not throw in production at runtime', async () => {\n      await nextBuild(context.appDir, undefined, { stderr: true })\n      context.app = await nextStart(context.appDir, context.appPort, appOption)\n      const res = await fetchViaHTTP(context.appPort, url)\n      expect(res.status).toBe(200)\n      expect(res.headers.get('x-from-runtime')).toBe('false')\n      expectNoError(moduleName)\n    })","file":"integration/edge-runtime-module-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"$title using Node.js API","suites":[],"line":49,"code":"describe.each([\n  {\n    title: 'Middleware',\n    computeRoute(useCase) {\n      return `/${useCase}`\n    },\n  },\n  {\n    title: 'Edge route',\n    computeRoute(useCase) {\n      return `/api/route?case=${useCase}`\n    },\n  },\n])('$title using Node.js API', ({ computeRoute }) => {\n  const appDir = join(__dirname, '..')\n\n  describe('dev mode', () => {\n    let output = ''\n    let appPort: number\n    let app = null\n\n    beforeAll(async () => {\n      output = ''\n      appPort = await findPort()\n      app = await launchApp(appDir, appPort, {\n        env: { __NEXT_TEST_WITH_DEVTOOL: 1 },\n        onStdout(msg) {\n          output += msg\n        },\n        onStderr(msg) {\n          output += msg\n        },\n      })\n    })\n\n    afterAll(() => killApp(app))\n\n    it.each(undefinedProperties.map((api) => ({ api })))(\n      'does not throw on using $api',\n      async ({ api }) => {\n        const res = await fetchViaHTTP(appPort, computeRoute(api))\n        expect(res.status).toBe(200)\n        await waitFor(500)\n        expect(output).not.toInclude(`A Node.js API is used (${api})`)\n      }\n    )\n\n    it.each([\n      ...unsupportedFunctions.map((api) => ({\n        api,\n        errorHighlight: `${api}(`,\n      })),\n      ...unsupportedClasses.map((api) => ({\n        api,\n        errorHighlight: `new ${api}(`,\n      })),\n    ])(`throws error when using $api`, async ({ api, errorHighlight }) => {\n      const res = await fetchViaHTTP(appPort, computeRoute(api))\n      expect(res.status).toBe(500)\n      await waitFor(500)\n      expect(output)\n        .toInclude(`A Node.js API is used (${api}) which is not supported in the Edge Runtime.\nLearn more: https://nextjs.org/docs/api-reference/edge-runtime`)\n      expect(stripAnsi(output)).toInclude(errorHighlight)\n    })\n  })\n\n  describe('production mode', () => {\n    let buildResult\n\n    beforeAll(async () => {\n      await remove(join(appDir, '.next'))\n      buildResult = await nextBuild(appDir, undefined, {\n        stderr: true,\n        stdout: true,\n      })\n    })\n\n    it.each(\n      [...unsupportedFunctions, ...unsupportedClasses].map((api, index) => ({\n        api,\n      }))\n    )(`warns for $api during build`, ({ api }) => {\n      expect(buildResult.stderr).toContain(`A Node.js API is used (${api}`)\n    })\n\n    it.each(['Buffer', ...undefinedProperties].map((api) => ({ api })))(\n      'does not warn on using $api',\n      ({ api }) => {\n        expect(buildResult.stderr).toContain(`A Node.js API is used (${api}`)\n      }\n    )\n  })\n})","file":"integration/edge-runtime-with-node.js-apis/test/index.test.ts","skipped":false,"dir":"test"},{"name":"does not throw on using $api","suites":["dev mode"],"line":86,"code":"    it.each(undefinedProperties.map((api) => ({ api })))(\n      'does not throw on using $api',\n      async ({ api }) => {\n        const res = await fetchViaHTTP(appPort, computeRoute(api))\n        expect(res.status).toBe(200)\n        await waitFor(500)\n        expect(output).not.toInclude(`A Node.js API is used (${api})`)\n      }\n    )","file":"integration/edge-runtime-with-node.js-apis/test/index.test.ts","skipped":false,"dir":"test"},{"name":"throws error when using $api","suites":["dev mode"],"line":96,"code":"    it.each([\n      ...unsupportedFunctions.map((api) => ({\n        api,\n        errorHighlight: `${api}(`,\n      })),\n      ...unsupportedClasses.map((api) => ({\n        api,\n        errorHighlight: `new ${api}(`,\n      })),\n    ])(`throws error when using $api`, async ({ api, errorHighlight }) => {\n      const res = await fetchViaHTTP(appPort, computeRoute(api))\n      expect(res.status).toBe(500)\n      await waitFor(500)\n      expect(output)\n        .toInclude(`A Node.js API is used (${api}) which is not supported in the Edge Runtime.\nLearn more: https://nextjs.org/docs/api-reference/edge-runtime`)\n      expect(stripAnsi(output)).toInclude(errorHighlight)\n    })","file":"integration/edge-runtime-with-node.js-apis/test/index.test.ts","skipped":false,"dir":"test"},{"name":"warns for $api during build","suites":["production mode"],"line":127,"code":"    it.each(\n      [...unsupportedFunctions, ...unsupportedClasses].map((api, index) => ({\n        api,\n      }))\n    )(`warns for $api during build`, ({ api }) => {\n      expect(buildResult.stderr).toContain(`A Node.js API is used (${api}`)\n    })","file":"integration/edge-runtime-with-node.js-apis/test/index.test.ts","skipped":false,"dir":"test"},{"name":"does not warn on using $api","suites":["production mode"],"line":135,"code":"    it.each(['Buffer', ...undefinedProperties].map((api) => ({ api })))(\n      'does not warn on using $api',\n      ({ api }) => {\n        expect(buildResult.stderr).toContain(`A Node.js API is used (${api}`)\n      }\n    )","file":"integration/edge-runtime-with-node.js-apis/test/index.test.ts","skipped":false,"dir":"test"},{"name":"It should show empty object warning on SSR","suites":["Empty Project"],"updatePoint":{"line":33,"column":48},"line":33,"code":"  it('It should show empty object warning on SSR', async () => {\n    output = ''\n    await renderViaHTTP(appPort, '/')\n    await waitFor(100)\n    expect(output).toMatch(/returned an empty object from `getInitialProps`/)\n  })","file":"integration/empty-object-getInitialProps/test/index.test.js","skipped":false,"dir":"test"},{"name":"It should not show empty object warning for page without `getInitialProps`","suites":["Empty Project"],"updatePoint":{"line":40,"column":80},"line":40,"code":"  it('It should not show empty object warning for page without `getInitialProps`', async () => {\n    output = ''\n    await renderViaHTTP(appPort, '/static')\n    await waitFor(100)\n    expect(output).not.toMatch(\n      /returned an empty object from `getInitialProps`/\n    )\n  })","file":"integration/empty-object-getInitialProps/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show empty object warning during client transition","suites":["Empty Project"],"updatePoint":{"line":49,"column":63},"line":49,"code":"  it('should show empty object warning during client transition', async () => {\n    const browser = await webdriver(appPort, '/static')\n    try {\n      await browser.eval(`(function() {\n        window.gotWarn = false\n        const origWarn = console.warn\n        window.console.warn = function () {\n          if (arguments[0].match(/returned an empty object from \\`getInitialProps\\`/)) {\n            window.gotWarn = true\n          }\n          origWarn.apply(this, arguments)\n        }\n        window.next.router.replace('/another')\n      })()`)\n      await check(async () => {\n        const gotWarn = await browser.eval(`window.gotWarn`)\n        return gotWarn ? 'pass' : 'fail'\n      }, 'pass')\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/empty-object-getInitialProps/test/index.test.js","skipped":false,"dir":"test"},{"name":"Should not time out and return 404","suites":["Empty Project"],"updatePoint":{"line":18,"column":40},"line":18,"code":"  it('Should not time out and return 404', async () => {\n    const res = await fetch('/')\n    expect(res.status).toBe(404)\n  })","file":"integration/empty-project/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have process environment override .env","suites":[],"updatePoint":{"line":71,"column":51},"line":71,"code":"  it('should have process environment override .env', async () => {\n    const data = await getEnvFromHtml('/')\n    expect(data.PROCESS_ENV_KEY).toEqual('processenvironment')\n  })","file":"integration/env-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"should provide global env to next.config.js","suites":[],"updatePoint":{"line":76,"column":49},"line":76,"code":"  it('should provide global env to next.config.js', async () => {\n    const res = await fetchViaHTTP(appPort, '/hello', undefined, {\n      redirect: 'manual',\n    })\n    const { pathname } = url.parse(res.headers.get('location'))\n\n    expect(res.status).toBe(307)\n    expect(pathname).toBe('/another')\n  })","file":"integration/env-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"should inline global values during build","suites":[],"updatePoint":{"line":86,"column":46},"line":86,"code":"  it('should inline global values during build', async () => {\n    // make sure to build page\n    await renderViaHTTP(appPort, '/global')\n\n    const buildManifest = require(join(\n      __dirname,\n      '../app/.next/build-manifest.json'\n    ))\n\n    const pageFile = buildManifest.pages['/global'].find((filename) =>\n      filename.includes('pages/global')\n    )\n\n    // read client bundle contents since a server side render can\n    // have the value available during render but it not be injected\n    const bundleContent = await fs.readFile(\n      join(appDir, '.next', pageFile),\n      'utf8'\n    )\n    expect(bundleContent).toContain('another')\n  })","file":"integration/env-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"should provide env for SSG","suites":[],"updatePoint":{"line":108,"column":32},"line":108,"code":"  it('should provide env for SSG', async () => {\n    const data = await getEnvFromHtml('/some-ssg')\n    checkEnvData(data)\n  })","file":"integration/env-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"should provide env correctly for SSR","suites":[],"updatePoint":{"line":113,"column":42},"line":113,"code":"  it('should provide env correctly for SSR', async () => {\n    const data = await getEnvFromHtml('/some-ssp')\n    checkEnvData(data)\n  })","file":"integration/env-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"should provide env correctly for API routes","suites":[],"updatePoint":{"line":118,"column":49},"line":118,"code":"  it('should provide env correctly for API routes', async () => {\n    const data = JSON.parse(await renderViaHTTP(appPort, '/api/all'))\n    checkEnvData(data)\n  })","file":"integration/env-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"should load env from .env","suites":[],"updatePoint":{"line":123,"column":31},"line":123,"code":"  it('should load env from .env', async () => {\n    const data = await getEnvFromHtml('/')\n    expect(data.ENV_FILE_KEY).toEqual('env')\n    expect(data.ENV_FILE_DEVELOPMENT_OVERRIDE_TEST).toEqual(\n      isDevOnly ? 'development' : 'env'\n    )\n    expect(data.ENV_FILE_DEVELOPMENT_LOCAL_OVERRIDEOVERRIDE_TEST).toEqual(\n      isDevOnly ? 'localdevelopment' : 'env'\n    )\n    expect(data.ENV_FILE_TEST_OVERRIDE_TEST).toEqual(isTestEnv ? 'test' : 'env')\n    expect(data.ENV_FILE_TEST_LOCAL_OVERRIDEOVERRIDE_TEST).toBe(\n      isTestEnv ? 'localtest' : 'env'\n    )\n    expect(data.LOCAL_ENV_FILE_KEY).toBe(isTestEnv ? undefined : 'localenv')\n    expect(data.ENV_FILE_PRODUCTION_OVERRIDEOVERRIDE_TEST).toEqual(\n      isDev ? 'env' : 'production'\n    )\n    expect(data.ENV_FILE_PRODUCTION_LOCAL_OVERRIDEOVERRIDE_TEST).toEqual(\n      isDev ? 'env' : 'localproduction'\n    )\n  })","file":"integration/env-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have updated runtime values after change","suites":["Env Config","dev mode","with hot reload"],"updatePoint":{"line":214,"column":57},"line":214,"code":"      it('should have updated runtime values after change', async () => {\n        let html = await fetchViaHTTP(appPort, '/').then((res) => res.text())\n        let renderedEnv = JSON.parse(cheerio.load(html)('p').text())\n\n        expect(renderedEnv['ENV_FILE_KEY']).toBe('env')\n        expect(renderedEnv['ENV_FILE_LOCAL_OVERRIDE_TEST']).toBe('localenv')\n        let outputIdx = output.length\n\n        const envFile = join(appDir, '.env')\n        const envLocalFile = join(appDir, '.env.local')\n        const envContent = originalContents.find(\n          (item) => item.file === '.env'\n        ).content\n        const envLocalContent = originalContents.find(\n          (item) => item.file === '.env.local'\n        ).content\n\n        try {\n          await fs.writeFile(\n            envFile,\n            envContent.replace(`ENV_FILE_KEY=env`, `ENV_FILE_KEY=env-updated`)\n          )\n\n          // we should only log we loaded new env from .env\n          await check(() => output.substring(outputIdx), /Loaded env from/)\n          expect(\n            [...output.substring(outputIdx).matchAll(/Loaded env from/g)].length\n          ).toBe(1)\n          expect(output.substring(outputIdx)).not.toContain('.env.local')\n\n          await check(async () => {\n            html = await fetchViaHTTP(appPort, '/').then((res) => res.text())\n            renderedEnv = JSON.parse(cheerio.load(html)('p').text())\n            expect(renderedEnv['ENV_FILE_KEY']).toBe('env-updated')\n            expect(renderedEnv['ENV_FILE_LOCAL_OVERRIDE_TEST']).toBe('localenv')\n            return 'success'\n          }, 'success')\n\n          outputIdx = output.length\n\n          await fs.writeFile(\n            envLocalFile,\n            envLocalContent.replace(\n              `ENV_FILE_LOCAL_OVERRIDE_TEST=localenv`,\n              `ENV_FILE_LOCAL_OVERRIDE_TEST=localenv-updated`\n            )\n          )\n\n          // we should only log we loaded new env from .env\n          await check(() => output.substring(outputIdx), /Loaded env from/)\n          expect(\n            [...output.substring(outputIdx).matchAll(/Loaded env from/g)].length\n          ).toBe(1)\n          expect(output.substring(outputIdx)).toContain('.env.local')\n\n          await check(async () => {\n            html = await fetchViaHTTP(appPort, '/').then((res) => res.text())\n            renderedEnv = JSON.parse(cheerio.load(html)('p').text())\n            expect(renderedEnv['ENV_FILE_KEY']).toBe('env-updated')\n            expect(renderedEnv['ENV_FILE_LOCAL_OVERRIDE_TEST']).toBe(\n              'localenv-updated'\n            )\n            return 'success'\n          }, 'success')\n        } finally {\n          await fs.writeFile(envFile, envContent)\n          await fs.writeFile(envLocalFile, envLocalContent)\n        }\n      })","file":"integration/env-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"should trigger HMR correctly when NEXT_PUBLIC_ env is changed","suites":["Env Config","dev mode","with hot reload"],"updatePoint":{"line":284,"column":71},"line":284,"code":"      it('should trigger HMR correctly when NEXT_PUBLIC_ env is changed', async () => {\n        const envFile = join(appDir, '.env')\n        const envLocalFile = join(appDir, '.env.local')\n        const envContent = originalContents.find(\n          (item) => item.file === '.env'\n        ).content\n        const envLocalContent = originalContents.find(\n          (item) => item.file === '.env.local'\n        ).content\n\n        try {\n          const browser = await webdriver(appPort, '/global')\n          expect(await browser.elementByCss('p').text()).toBe('another')\n\n          let outputIdx = output.length\n\n          await fs.writeFile(\n            envFile,\n            envContent.replace(\n              `NEXT_PUBLIC_TEST_DEST=another`,\n              `NEXT_PUBLIC_TEST_DEST=replaced`\n            )\n          )\n          // we should only log we loaded new env from .env\n          await check(() => output.substring(outputIdx), /Loaded env from/)\n          expect(\n            [...output.substring(outputIdx).matchAll(/Loaded env from/g)].length\n          ).toBe(1)\n          expect(output.substring(outputIdx)).not.toContain('.env.local')\n\n          await check(() => browser.elementByCss('p').text(), 'replaced')\n\n          outputIdx = output.length\n\n          await fs.writeFile(\n            envLocalFile,\n            envLocalContent + `\\nNEXT_PUBLIC_TEST_DEST=overridden`\n          )\n          // we should only log we loaded new env from .env\n          await check(() => output.substring(outputIdx), /Loaded env from/)\n          expect(\n            [...output.substring(outputIdx).matchAll(/Loaded env from/g)].length\n          ).toBe(1)\n          expect(output.substring(outputIdx)).toContain('.env.local')\n\n          await check(() => browser.elementByCss('p').text(), 'overridden')\n\n          outputIdx = output.length\n\n          await fs.writeFile(envLocalFile, envLocalContent)\n          // we should only log we loaded new env from .env\n          await check(() => output.substring(outputIdx), /Loaded env from/)\n          expect(\n            [...output.substring(outputIdx).matchAll(/Loaded env from/g)].length\n          ).toBe(1)\n          expect(output.substring(outputIdx)).toContain('.env.local')\n\n          await check(() => browser.elementByCss('p').text(), 'replaced')\n        } finally {\n          await fs.writeFile(envFile, envContent)\n          await fs.writeFile(envLocalFile, envLocalContent)\n        }\n      })","file":"integration/env-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"Handles error during SSR","suites":["Handles an Error in _error"],"updatePoint":{"line":26,"column":30},"line":26,"code":"  it('Handles error during SSR', async () => {\n    const html = await renderViaHTTP(port, '/some-404-page')\n    expect(html).toMatch(/internal server error/i)\n  })","file":"integration/error-in-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"Handles error during client transition","suites":["Handles an Error in _error"],"updatePoint":{"line":31,"column":44},"line":31,"code":"  it('Handles error during client transition', async () => {\n    const browser = await webdriver(port, '/')\n    await browser.waitForElementByCss('a').click()\n    await waitFor(1000)\n    const html = await browser.eval('document.body.innerHTML')\n    expect(html).toMatch(/internal server error/i)\n  })","file":"integration/error-in-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"handles failing to load _error correctly","suites":["Failing to load _error"],"updatePoint":{"line":21,"column":46},"line":21,"code":"  it('handles failing to load _error correctly', async () => {\n    await nextBuild(appDir)\n    const appPort = await findPort()\n    app = await nextStart(appDir, appPort)\n\n    const browser = await webdriver(appPort, '/')\n    await browser.eval(`window.beforeNavigate = true`)\n\n    await browser.elementByCss('#to-broken').moveTo()\n    await check(\n      async () => {\n        const scripts = await browser.elementsByCss('script')\n        let found = false\n\n        for (const script of scripts) {\n          const src = await script.getAttribute('src')\n          if (src.includes('broken-')) {\n            found = true\n            break\n          }\n        }\n        return found\n      },\n      {\n        test(content) {\n          return content === true\n        },\n      }\n    )\n\n    const errorPageFilePath = getPageFileFromBuildManifest(appDir, '/_error')\n    // remove _error client bundle so that it can't be loaded\n    await fs.remove(join(appDir, '.next', errorPageFilePath))\n\n    await browser.elementByCss('#to-broken').click()\n\n    await check(async () => {\n      return !(await browser.eval('window.beforeNavigate'))\n        ? 'reloaded'\n        : 'fail'\n    }, /reloaded/)\n  })","file":"integration/error-load-fail/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows details in next build","suites":["Reports stack trace when webpack plugin stack overflows"],"updatePoint":{"line":9,"column":33},"line":9,"code":"  it('shows details in next build', async () => {\n    const { code, stderr } = await nextBuild(appDir, undefined, {\n      stderr: true,\n      ignoreFail: true,\n    })\n    expect(code).toBe(1)\n    expect(stderr).toContain(\n      'caused by plugins in Compilation.hooks.processAssets'\n    )\n    expect(stderr).toContain('Maximum call stack size exceeded')\n    expect(stderr).toContain('next.config.js:7')\n  })","file":"integration/error-plugin-stack-overflow/test/index.test.js","skipped":false,"dir":"test"},{"name":"Throws error when `distDir` is set to public","suites":["Errors on output to public"],"updatePoint":{"line":11,"column":50},"line":11,"code":"  it('Throws error when `distDir` is set to public', async () => {\n    await fs.writeFile(nextConfig, `module.exports = { distDir: 'public' }`)\n    const results = await nextBuild(appDir, [], { stdout: true, stderr: true })\n    expect(results.stdout + results.stderr).toMatch(\n      /The 'public' directory is reserved in Next\\.js and can not be set as/\n    )\n    await fs.remove(nextConfig)\n  })","file":"integration/errors-on-output-to-public/test/index.test.js","skipped":false,"dir":"test"},{"name":"Throws error when export out dir is public","suites":["Errors on output to public"],"updatePoint":{"line":20,"column":48},"line":20,"code":"  it('Throws error when export out dir is public', async () => {\n    await fs.remove(nextConfig)\n    await nextBuild(appDir)\n    const outdir = path.join(appDir, 'public')\n    const results = await nextExport(\n      appDir,\n      { outdir },\n      {\n        stdout: true,\n        stderr: true,\n      }\n    )\n    expect(results.stdout + results.stderr).toMatch(\n      /The 'public' directory is reserved in Next\\.js and can not be used as/\n    )\n  })","file":"integration/errors-on-output-to-public/test/index.test.js","skipped":false,"dir":"test"},{"name":"Throws error when export out dir is static","suites":["Errors on output to static"],"updatePoint":{"line":11,"column":48},"line":11,"code":"  it('Throws error when export out dir is static', async () => {\n    await fs.remove(nextConfig)\n    await nextBuild(appDir)\n    const outdir = path.join(appDir, 'static')\n    const results = await nextExport(\n      appDir,\n      { outdir },\n      {\n        stdout: true,\n        stderr: true,\n      }\n    )\n    expect(results.stdout + results.stderr).toMatch(\n      /The 'static' directory is reserved in Next\\.js and can not be used as/\n    )\n  })","file":"integration/errors-on-output-to-static/test/index.test.js","skipped":false,"dir":"test"},{"name":"first time setup","suites":["ESLint","Next Build"],"updatePoint":{"line":40,"column":26},"line":40,"code":"    test('first time setup', async () => {\n      const eslintrcJson = join(dirFirstTimeSetup, '.eslintrc.json')\n      await fs.writeFile(eslintrcJson, '')\n\n      const { stdout, stderr } = await nextBuild(dirFirstTimeSetup, [], {\n        stdout: true,\n        stderr: true,\n      })\n      const output = stdout + stderr\n\n      expect(output).toContain(\n        'No ESLint configuration detected. Run next lint to begin setup'\n      )\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows warnings and errors","suites":["ESLint","Next Build"],"updatePoint":{"line":55,"column":35},"line":55,"code":"    test('shows warnings and errors', async () => {\n      const { stdout, stderr } = await nextBuild(dirCustomConfig, [], {\n        stdout: true,\n        stderr: true,\n      })\n\n      const output = stdout + stderr\n      expect(output).toContain(\n        'Warning: Synchronous scripts should not be used.'\n      )\n      expect(output).toContain(\n        'Error: Comments inside children section of tag should be placed inside braces'\n      )\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"ignore during builds","suites":["ESLint","Next Build"],"updatePoint":{"line":70,"column":30},"line":70,"code":"    test('ignore during builds', async () => {\n      const { stdout, stderr } = await nextBuild(dirIgnoreDuringBuilds, [], {\n        stdout: true,\n        stderr: true,\n      })\n\n      const output = stdout + stderr\n      expect(output).not.toContain('Failed to compile')\n      expect(output).not.toContain(\n        'Error: Comments inside children section of tag should be placed inside braces'\n      )\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"base directories are linted by default during builds","suites":["ESLint","Next Build"],"updatePoint":{"line":83,"column":62},"line":83,"code":"    test('base directories are linted by default during builds', async () => {\n      const { stdout, stderr } = await nextBuild(dirBaseDirectories, [], {\n        stdout: true,\n        stderr: true,\n      })\n\n      const output = stdout + stderr\n\n      expect(output).toContain('Failed to compile')\n      expect(output).toContain(\n        'Error: `next/head` should not be imported in `pages/_document.js`. Use `<Head />` from `next/document` instead'\n      )\n      expect(output).toContain(\n        'Warning: Do not use `<img>` element. Use `<Image />` from `next/image` instead'\n      )\n      expect(output).toContain('Warning: Do not include stylesheets manually')\n      expect(output).toContain(\n        'Warning: Synchronous scripts should not be used'\n      )\n\n      // Files in pages, components, lib, and src directories are linted\n      expect(output).toContain('pages/_document.js')\n      expect(output).toContain('components/bar.js')\n      expect(output).toContain('lib/foo.js')\n      expect(output).toContain('src/index.js')\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"custom directories","suites":["ESLint","Next Build"],"updatePoint":{"line":110,"column":28},"line":110,"code":"    test('custom directories', async () => {\n      const { stdout, stderr } = await nextBuild(dirCustomDirectories, [], {\n        stdout: true,\n        stderr: true,\n      })\n\n      const output = stdout + stderr\n      expect(output).toContain('Failed to compile')\n      expect(output).toContain(\n        'Error: Comments inside children section of tag should be placed inside braces'\n      )\n      expect(output).toContain(\n        'Warning: Synchronous scripts should not be used.'\n      )\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"invalid older eslint version","suites":["ESLint","Next Build"],"updatePoint":{"line":126,"column":38},"line":126,"code":"    test('invalid older eslint version', async () => {\n      const { stdout, stderr } = await nextBuild(\n        dirInvalidOlderEslintVersion,\n        [],\n        {\n          stdout: true,\n          stderr: true,\n        }\n      )\n\n      const output = stdout + stderr\n      expect(output).toContain(\n        'Your project has an older version of ESLint installed'\n      )\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"empty directories do not fail the build","suites":["ESLint","Next Build"],"updatePoint":{"line":142,"column":49},"line":142,"code":"    test('empty directories do not fail the build', async () => {\n      const { stdout, stderr } = await nextBuild(dirEmptyDirectory, [], {\n        stdout: true,\n        stderr: true,\n      })\n\n      const output = stdout + stderr\n      expect(output).not.toContain('Build error occurred')\n      expect(output).not.toContain('NoFilesFoundError')\n      expect(output).toContain(\n        'Warning: Synchronous scripts should not be used.'\n      )\n      expect(output).toContain('Compiled successfully')\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"eslint ignored directories do not fail the build","suites":["ESLint","Next Build"],"updatePoint":{"line":157,"column":58},"line":157,"code":"    test('eslint ignored directories do not fail the build', async () => {\n      const { stdout, stderr } = await nextBuild(dirEslintIgnore, [], {\n        stdout: true,\n        stderr: true,\n      })\n\n      const output = stdout + stderr\n      expect(output).not.toContain('Build error occurred')\n      expect(output).not.toContain('AllFilesIgnoredError')\n      expect(output).toContain(\n        'Warning: Synchronous scripts should not be used.'\n      )\n      expect(output).toContain('Compiled successfully')\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"missing Next.js plugin","suites":["ESLint","Next Build"],"updatePoint":{"line":172,"column":32},"line":172,"code":"    test('missing Next.js plugin', async () => {\n      const { stdout, stderr } = await nextBuild(dirNoEslintPlugin, [], {\n        stdout: true,\n        stderr: true,\n      })\n\n      const output = stdout + stderr\n      expect(output).toContain(\n        'The Next.js plugin was not detected in your ESLint configuration'\n      )\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"eslint caching is enabled","suites":["ESLint","Next Build"],"updatePoint":{"line":184,"column":35},"line":184,"code":"    test('eslint caching is enabled', async () => {\n      const cacheDir = join(dirEslintCache, '.next', 'cache')\n\n      await fs.remove(cacheDir)\n      await nextBuild(dirEslintCache, [])\n\n      const files = await fs.readdir(join(cacheDir, 'eslint/'))\n      const cacheExists = files.some((f) => /\\.cache/.test(f))\n\n      expect(cacheExists).toBe(true)\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"eslint cache lives in the user defined build directory","suites":["ESLint","Next Build"],"updatePoint":{"line":196,"column":64},"line":196,"code":"    test('eslint cache lives in the user defined build directory', async () => {\n      const oldCacheDir = join(dirEslintCacheCustomDir, '.next', 'cache')\n      const newCacheDir = join(dirEslintCacheCustomDir, 'build', 'cache')\n\n      await fs.remove(oldCacheDir)\n      await fs.remove(newCacheDir)\n\n      await nextBuild(dirEslintCacheCustomDir, [])\n\n      expect(fs.existsSync(oldCacheDir)).toBe(false)\n\n      const files = await fs.readdir(join(newCacheDir, 'eslint/'))\n      const cacheExists = files.some((f) => /\\.cache/.test(f))\n\n      expect(cacheExists).toBe(true)\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"show a prompt to set up ESLint if no configuration detected","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":247,"column":71},"line":247,"code":"      test('show a prompt to set up ESLint if no configuration detected', async () => {\n        const eslintrcJson = join(dirFirstTimeSetup, '.eslintrc.json')\n        await fs.writeFile(eslintrcJson, '')\n\n        const { stdout, stderr } = await nextLint(dirFirstTimeSetup, [], {\n          stdout: true,\n          stderr: true,\n        })\n        const output = stdout + stderr\n        expect(output).toContain('How would you like to configure ESLint?')\n\n        // Different options that can be selected\n        expect(output).toContain('Strict (recommended)')\n        expect(output).toContain('Base')\n        expect(output).toContain('Cancel')\n      })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"installs eslint and eslint-config-next as devDependencies if missing with ","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":269,"column":104},"line":269,"code":"        test(`installs eslint and eslint-config-next as devDependencies if missing with ${packageManger}`, async () => {\n          const { stdout, pkgJson } = await nextLintTemp(async (folder) => {\n            await fs.writeFile(join(folder, lockFile), '')\n          })\n\n          expect(stdout).toContain(\n            `Installing devDependencies (${packageManger}):`\n          )\n          expect(stdout).toContain('eslint')\n          expect(stdout).toContain('eslint-config-next')\n          expect(stdout).toContain(packageManger)\n          expect(pkgJson.devDependencies).toHaveProperty('eslint')\n          expect(pkgJson.devDependencies).toHaveProperty('eslint-config-next')\n        })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"creates .eslintrc.json file with a default configuration","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":285,"column":68},"line":285,"code":"      test('creates .eslintrc.json file with a default configuration', async () => {\n        const { stdout, eslintrcJson } = await nextLintTemp()\n\n        expect(stdout).toContain(\n          'We created the .eslintrc.json file for you and included your selected configuration'\n        )\n        expect(eslintrcJson).toMatchObject({ extends: 'next/core-web-vitals' })\n      })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows a successful message when completed","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":294,"column":53},"line":294,"code":"      test('shows a successful message when completed', async () => {\n        const { stdout } = await nextLintTemp()\n\n        expect(stdout).toContain(\n          'ESLint has successfully been configured. Run next lint again to view warnings and errors'\n        )\n      })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows warnings and errors","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":303,"column":35},"line":303,"code":"    test('shows warnings and errors', async () => {\n      const { stdout, stderr } = await nextLint(dirCustomConfig, [], {\n        stdout: true,\n        stderr: true,\n      })\n\n      const output = stdout + stderr\n      expect(output).toContain(\n        'Warning: Synchronous scripts should not be used.'\n      )\n      expect(output).toContain(\n        'Error: Comments inside children section of tag should be placed inside braces'\n      )\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"base directories are linted by default","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":318,"column":48},"line":318,"code":"    test('base directories are linted by default', async () => {\n      const { stdout, stderr } = await nextLint(dirBaseDirectories, [], {\n        stdout: true,\n        stderr: true,\n      })\n\n      const output = stdout + stderr\n      expect(output).toContain(\n        'Error: `next/head` should not be imported in `pages/_document.js`. Use `<Head />` from `next/document` instead'\n      )\n      expect(output).toContain(\n        'Warning: Do not use `<img>` element. Use `<Image />` from `next/image` instead'\n      )\n      expect(output).toContain('Warning: Do not include stylesheets manually')\n      expect(output).toContain(\n        'Warning: Synchronous scripts should not be used'\n      )\n\n      // Files in pages, components, lib, and src directories are linted\n      expect(output).toContain('pages/_document.js')\n      expect(output).toContain('components/bar.js')\n      expect(output).toContain('lib/foo.js')\n      expect(output).toContain('src/index.js')\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows warnings and errors with next/core-web-vitals config","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":343,"column":68},"line":343,"code":"    test('shows warnings and errors with next/core-web-vitals config', async () => {\n      const { stdout, stderr } = await nextLint(dirWebVitalsConfig, [], {\n        stdout: true,\n        stderr: true,\n      })\n\n      const output = stdout + stderr\n      expect(output).toContain(\n        'Warning: Do not use `<img>` element. Use `<Image />` from `next/image` instead.'\n      )\n      expect(output).toContain('Error: Synchronous scripts should not be used.')\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows warnings and errors when extending plugin recommended config","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":356,"column":76},"line":356,"code":"    test('shows warnings and errors when extending plugin recommended config', async () => {\n      const { stdout, stderr } = await nextLint(\n        dirPluginRecommendedConfig,\n        [],\n        {\n          stdout: true,\n          stderr: true,\n        }\n      )\n\n      const output = stdout + stderr\n      expect(output).toContain(\n        'Warning: Synchronous scripts should not be used.'\n      )\n      expect(output).toContain(\n        'Error: `<Document />` from `next/document` should not be imported outside of `pages/_document.js`.'\n      )\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows warnings and errors when extending plugin core-web-vitals config","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":375,"column":80},"line":375,"code":"    test('shows warnings and errors when extending plugin core-web-vitals config', async () => {\n      const { stdout, stderr } = await nextLint(\n        dirPluginCoreWebVitalsConfig,\n        [],\n        {\n          stdout: true,\n          stderr: true,\n        }\n      )\n\n      const output = stdout + stderr\n      expect(output).toContain(\n        'Warning: Do not use `<img>` element. Use `<Image />` from `next/image` instead.'\n      )\n      expect(output).toContain('Error: Synchronous scripts should not be used.')\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"success message when no warnings or errors","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":392,"column":52},"line":392,"code":"    test('success message when no warnings or errors', async () => {\n      const eslintrcJson = join(dirFirstTimeSetup, '.eslintrc.json')\n      await fs.writeFile(eslintrcJson, '{ \"extends\": \"next\", \"root\": true }\\n')\n\n      const { stdout, stderr } = await nextLint(dirFirstTimeSetup, [], {\n        stdout: true,\n        stderr: true,\n      })\n\n      const output = stdout + stderr\n      expect(output).toContain('No ESLint warnings or errors')\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"don't create .eslintrc file if package.json has eslintConfig field","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":405,"column":76},"line":405,"code":"    test(\"don't create .eslintrc file if package.json has eslintConfig field\", async () => {\n      const eslintrcFile =\n        (await findUp(\n          [\n            '.eslintrc.js',\n            '.eslintrc.cjs',\n            '.eslintrc.yaml',\n            '.eslintrc.yml',\n            '.eslintrc.json',\n            '.eslintrc',\n          ],\n          {\n            cwd: '.',\n          }\n        )) ?? null\n\n      try {\n        // If we found a .eslintrc file, it's probably config from root Next.js directory. Rename it during the test\n        if (eslintrcFile) {\n          await fs.move(eslintrcFile, `${eslintrcFile}.original`)\n        }\n\n        const { stdout, stderr } = await nextLint(dirConfigInPackageJson, [], {\n          stdout: true,\n          stderr: true,\n        })\n\n        const output = stdout + stderr\n        expect(output).not.toContain(\n          'We created the .eslintrc file for you and included your selected configuration'\n        )\n      } finally {\n        // Restore original .eslintrc file\n        if (eslintrcFile) {\n          await fs.move(`${eslintrcFile}.original`, eslintrcFile)\n        }\n      }\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"quiet flag suppresses warnings and only reports errors","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":444,"column":64},"line":444,"code":"    test('quiet flag suppresses warnings and only reports errors', async () => {\n      const { stdout, stderr } = await nextLint(dirCustomConfig, ['--quiet'], {\n        stdout: true,\n        stderr: true,\n      })\n\n      const output = stdout + stderr\n      expect(output).toContain(\n        'Error: Comments inside children section of tag should be placed inside braces'\n      )\n      expect(output).not.toContain(\n        'Warning: Synchronous scripts should not be used.'\n      )\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"custom directories","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":459,"column":28},"line":459,"code":"    test('custom directories', async () => {\n      const { stdout, stderr } = await nextLint(dirCustomDirectories, [], {\n        stdout: true,\n        stderr: true,\n      })\n\n      const output = stdout + stderr\n      expect(output).toContain(\n        'Error: Comments inside children section of tag should be placed inside braces'\n      )\n      expect(output).toContain(\n        'Warning: Synchronous scripts should not be used.'\n      )\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"max warnings flag errors when warnings exceed threshold","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":474,"column":65},"line":474,"code":"    test('max warnings flag errors when warnings exceed threshold', async () => {\n      const { stdout, stderr } = await nextLint(\n        dirMaxWarnings,\n        ['--max-warnings', 1],\n        {\n          stdout: true,\n          stderr: true,\n        }\n      )\n\n      expect(stderr).not.toEqual('')\n      expect(stderr).toContain(\n        'Warning: Synchronous scripts should not be used.'\n      )\n      expect(stdout).not.toContain(\n        'Warning: Synchronous scripts should not be used.'\n      )\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"max warnings flag does not error when warnings do not exceed threshold","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":493,"column":80},"line":493,"code":"    test('max warnings flag does not error when warnings do not exceed threshold', async () => {\n      const { stdout, stderr } = await nextLint(\n        dirMaxWarnings,\n        ['--max-warnings', 2],\n        {\n          stdout: true,\n          stderr: true,\n        }\n      )\n\n      expect(stderr).toEqual('')\n      expect(stderr).not.toContain(\n        'Warning: Synchronous scripts should not be used.'\n      )\n      expect(stdout).toContain(\n        'Warning: Synchronous scripts should not be used.'\n      )\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"format flag supports additional user-defined formats","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":512,"column":62},"line":512,"code":"    test('format flag supports additional user-defined formats', async () => {\n      const { stdout, stderr } = await nextLint(\n        dirMaxWarnings,\n        ['-f', 'codeframe'],\n        {\n          stdout: true,\n          stderr: true,\n        }\n      )\n\n      const output = stdout + stderr\n      expect(output).toContain(\n        'warning: Synchronous scripts should not be used.'\n      )\n      expect(stdout).toContain('<script src=\"https://example.com\" />')\n      expect(stdout).toContain('2 warnings found')\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"eslint caching is enabled by default","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":530,"column":46},"line":530,"code":"    test('eslint caching is enabled by default', async () => {\n      const cacheDir = join(dirEslintCache, '.next', 'cache')\n\n      await fs.remove(cacheDir)\n      await nextLint(dirEslintCache, [])\n\n      const files = await fs.readdir(join(cacheDir, 'eslint/'))\n      const cacheExists = files.some((f) => /\\.cache/.test(f))\n\n      expect(cacheExists).toBe(true)\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"eslint caching is disabled with the --no-cache flag","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":542,"column":61},"line":542,"code":"    test('eslint caching is disabled with the --no-cache flag', async () => {\n      const cacheDir = join(dirEslintCache, '.next', 'cache')\n\n      await fs.remove(cacheDir)\n      await nextLint(dirEslintCache, ['--no-cache'])\n\n      expect(fs.existsSync(join(cacheDir, 'eslint/'))).toBe(false)\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"the default eslint cache lives in the user defined build directory","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":551,"column":76},"line":551,"code":"    test('the default eslint cache lives in the user defined build directory', async () => {\n      const oldCacheDir = join(dirEslintCacheCustomDir, '.next', 'cache')\n      const newCacheDir = join(dirEslintCacheCustomDir, 'build', 'cache')\n\n      await fs.remove(oldCacheDir)\n      await fs.remove(newCacheDir)\n\n      await nextLint(dirEslintCacheCustomDir, [])\n\n      expect(fs.existsSync(oldCacheDir)).toBe(false)\n\n      const files = await fs.readdir(join(newCacheDir, 'eslint/'))\n      const cacheExists = files.some((f) => /\\.cache/.test(f))\n\n      expect(cacheExists).toBe(true)\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"the --cache-location flag allows the user to define a separate cache location","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":568,"column":87},"line":568,"code":"    test('the --cache-location flag allows the user to define a separate cache location', async () => {\n      const cacheFile = join(dirEslintCache, '.eslintcache')\n\n      await fs.remove(cacheFile)\n      await nextLint(dirEslintCache, ['--cache-location', cacheFile])\n\n      const hasCache = fs.existsSync(cacheFile)\n      await fs.remove(cacheFile) // remove after generate\n      expect(hasCache).toBe(true)\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"the default eslint caching strategy is metadata","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":588,"column":57},"line":588,"code":"    test('the default eslint caching strategy is metadata', async () => {\n      const cacheDir = join(dirEslintCache, '.next', 'cache')\n\n      await fs.remove(cacheDir)\n      await nextLint(dirEslintCache)\n\n      const defaultStrategyCache = await getEslintCacheContent(cacheDir)\n\n      await fs.remove(cacheDir)\n      await nextLint(dirEslintCache, ['--cache-strategy', 'metadata'])\n\n      const metadataStrategyCache = await getEslintCacheContent(cacheDir)\n\n      expect(metadataStrategyCache).toBe(defaultStrategyCache)\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"cache with content strategy is different from the one with default strategy","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":604,"column":85},"line":604,"code":"    test('cache with content strategy is different from the one with default strategy', async () => {\n      const cacheDir = join(dirEslintCache, '.next', 'cache')\n\n      await fs.remove(cacheDir)\n      await nextLint(dirEslintCache)\n\n      const defaultStrategyCache = await getEslintCacheContent(cacheDir)\n\n      await fs.remove(cacheDir)\n      await nextLint(dirEslintCache, ['--cache-strategy', 'content'])\n\n      const contentStrategyCache = await getEslintCacheContent(cacheDir)\n\n      expect(contentStrategyCache).not.toBe(defaultStrategyCache)\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"file flag can selectively lint only a single file","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":620,"column":59},"line":620,"code":"    test('file flag can selectively lint only a single file', async () => {\n      const { stdout, stderr } = await nextLint(\n        dirFileLinting,\n        ['--file', 'utils/math.js'],\n        {\n          stdout: true,\n          stderr: true,\n        }\n      )\n\n      const output = stdout + stderr\n\n      expect(output).toContain('utils/math.js')\n      expect(output).toContain(\n        'Comments inside children section of tag should be placed inside braces'\n      )\n\n      expect(output).not.toContain('pages/')\n      expect(output).not.toContain('Synchronous scripts should not be used.')\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"file flag can selectively lints multiple files","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":641,"column":56},"line":641,"code":"    test('file flag can selectively lints multiple files', async () => {\n      const { stdout, stderr } = await nextLint(\n        dirFileLinting,\n        ['--file', 'utils/math.js', '--file', 'pages/bar.js'],\n        {\n          stdout: true,\n          stderr: true,\n        }\n      )\n\n      const output = stdout + stderr\n\n      expect(output).toContain('utils/math.js')\n      expect(output).toContain(\n        'Comments inside children section of tag should be placed inside braces'\n      )\n\n      expect(output).toContain('pages/bar.js')\n      expect(output).toContain(\n        'Do not use `<img>` element. Use `<Image />` from `next/image` instead.'\n      )\n\n      expect(output).not.toContain('pages/index.js')\n      expect(output).not.toContain('Synchronous scripts should not be used.')\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"output flag create a file respecting the chosen format","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":667,"column":64},"line":667,"code":"    test('output flag create a file respecting the chosen format', async () => {\n      const filePath = `${__dirname}/output/output.json`\n      const { stdout, stderr } = await nextLint(\n        dirFileLinting,\n        ['--format', 'json', '--output-file', filePath],\n        {\n          stdout: true,\n          stderr: true,\n        }\n      )\n\n      const cliOutput = stdout + stderr\n      const fileOutput = await fs.readJSON(filePath)\n\n      expect(cliOutput).toContain(\n        `The output file has been created: ${filePath}`\n      )\n\n      if (fileOutput && fileOutput.length) {\n        fileOutput.forEach((file) => {\n          expect(file).toHaveProperty('filePath')\n          expect(file).toHaveProperty('messages')\n          expect(file).toHaveProperty('errorCount')\n          expect(file).toHaveProperty('warningCount')\n          expect(file).toHaveProperty('fixableErrorCount')\n          expect(file).toHaveProperty('fixableWarningCount')\n          expect(file).toHaveProperty('source')\n          expect(file).toHaveProperty('usedDeprecatedRules')\n        })\n\n        expect(fileOutput[0].messages).toEqual(\n          expect.arrayContaining([\n            expect.objectContaining({\n              message:\n                'img elements must have an alt prop, either with meaningful text, or an empty string for decorative images.',\n            }),\n            expect.objectContaining({\n              message:\n                'Do not use `<img>` element. Use `<Image />` from `next/image` instead. See: https://nextjs.org/docs/messages/no-img-element',\n            }),\n          ])\n        )\n\n        expect(fileOutput[1].messages).toEqual(\n          expect.arrayContaining([\n            expect.objectContaining({\n              message:\n                'Synchronous scripts should not be used. See: https://nextjs.org/docs/messages/no-sync-scripts',\n            }),\n          ])\n        )\n      }\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"output flag create a file respecting the chosen format","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":721,"column":64},"line":721,"code":"    test('output flag create a file respecting the chosen format', async () => {\n      const filePath = `${__dirname}/output/output.txt`\n      const { stdout, stderr } = await nextLint(\n        dirFileLinting,\n        ['--format', 'compact', '--output-file', filePath],\n        {\n          stdout: true,\n          stderr: true,\n        }\n      )\n\n      const cliOutput = stdout + stderr\n      const fileOutput = fs.readFileSync(filePath, 'utf8')\n\n      expect(cliOutput).toContain(\n        `The output file has been created: ${filePath}`\n      )\n\n      expect(fileOutput).toContain('file-linting/pages/bar.js')\n      expect(fileOutput).toContain(\n        'img elements must have an alt prop, either with meaningful text, or an empty string for decorative images.'\n      )\n      expect(fileOutput).toContain(\n        'Do not use `<img>` element. Use `<Image />` from `next/image` instead. See: https://nextjs.org/docs/messages/no-img-element'\n      )\n\n      expect(fileOutput).toContain('file-linting/pages/index.js')\n      expect(fileOutput).toContain(\n        'Synchronous scripts should not be used. See: https://nextjs.org/docs/messages/no-sync-scripts'\n      )\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"show error message when the file path is a directory","suites":["ESLint","Next Lint","First Time Setup "],"updatePoint":{"line":753,"column":62},"line":753,"code":"    test('show error message when the file path is a directory', async () => {\n      const filePath = `${__dirname}`\n      const { stdout, stderr } = await nextLint(\n        dirFileLinting,\n        ['--format', 'compact', '--output-file', filePath],\n        {\n          stdout: true,\n          stderr: true,\n        }\n      )\n\n      const cliOutput = stdout + stderr\n\n      expect(cliOutput).toContain(\n        `Cannot write to output file path, it is a directory: ${filePath}`\n      )\n    })","file":"integration/eslint/test/index.test.js","skipped":false,"dir":"test"},{"name":"only export 404.html when trailingSlash: false","suites":["Static 404 Export"],"updatePoint":{"line":22,"column":52},"line":22,"code":"  it('only export 404.html when trailingSlash: false', async () => {\n    await nextBuild(appDir)\n    await nextExport(appDir, { outdir })\n\n    expect(await fileExist(join(outdir, '404.html'))).toBe(true)\n    expect(await fileExist(join(outdir, '404.html.html'))).toBe(false)\n    expect(await fileExist(join(outdir, '404/index.html'))).toBe(false)\n  })","file":"integration/export-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"export 404.html and 404/index.html when trailingSlash: true","suites":["Static 404 Export"],"updatePoint":{"line":31,"column":65},"line":31,"code":"  it('export 404.html and 404/index.html when trailingSlash: true', async () => {\n    nextConfig.replace(`trailingSlash: false`, `trailingSlash: true`)\n    await nextBuild(appDir)\n    await nextExport(appDir, { outdir })\n    nextConfig.restore()\n\n    expect(await fileExist(join(outdir, '404/index.html'))).toBe(true)\n    expect(await fileExist(join(outdir, '404.html.html'))).toBe(false)\n    expect(await fileExist(join(outdir, '404.html'))).toBe(true)\n  })","file":"integration/export-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export a custom 404.html instead of default 404.html","suites":["Export with a page named 404.js"],"updatePoint":{"line":44,"column":65},"line":44,"code":"  it('should export a custom 404.html instead of default 404.html', async () => {\n    await nextBuild(appDir)\n    await nextExport(appDir, { outdir })\n\n    const html = await readFile(join(outdir, '404.html'), 'utf8')\n    expect(html).toMatch(/this is a 404 page override the default 404\\.html/)\n  })","file":"integration/export-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export with folder that has dot in name","suites":["Export with default map"],"updatePoint":{"line":18,"column":52},"line":18,"code":"  it('should export with folder that has dot in name', async () => {\n    expect.assertions(1)\n    await expect(access(join(outdir, 'v1.12.html'))).resolves.toBe(undefined)\n  })","file":"integration/export-default-map-serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export an amp only page to clean path","suites":["Export with default map"],"updatePoint":{"line":23,"column":50},"line":23,"code":"  it('should export an amp only page to clean path', async () => {\n    expect.assertions(1)\n    await expect(access(join(outdir, 'docs.html'))).resolves.toBe(undefined)\n  })","file":"integration/export-default-map-serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export hybrid amp page correctly","suites":["Export with default map"],"updatePoint":{"line":28,"column":45},"line":28,"code":"  it('should export hybrid amp page correctly', async () => {\n    expect.assertions(2)\n    await expect(access(join(outdir, 'some.html'))).resolves.toBe(undefined)\n    await expect(access(join(outdir, 'some.amp.html'))).resolves.toBe(undefined)\n  })","file":"integration/export-default-map-serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export nested hybrid amp page correctly","suites":["Export with default map"],"updatePoint":{"line":34,"column":52},"line":34,"code":"  it('should export nested hybrid amp page correctly', async () => {\n    expect.assertions(3)\n    await expect(access(join(outdir, 'docs.html'))).resolves.toBe(undefined)\n    await expect(access(join(outdir, 'docs.amp.html'))).resolves.toBe(undefined)\n\n    const html = await readFile(join(outdir, 'docs.html'))\n    const $ = cheerio.load(html)\n    expect($('link[rel=amphtml]').attr('href')).toBe('/docs.amp')\n  })","file":"integration/export-default-map-serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export nested hybrid amp page correctly with folder","suites":["Export with default map"],"updatePoint":{"line":44,"column":64},"line":44,"code":"  it('should export nested hybrid amp page correctly with folder', async () => {\n    expect.assertions(3)\n    await expect(access(join(outdir, 'info.html'))).resolves.toBe(undefined)\n    await expect(access(join(outdir, 'info.amp.html'))).resolves.toBe(undefined)\n\n    const html = await readFile(join(outdir, 'info.html'))\n    const $ = cheerio.load(html)\n    expect($('link[rel=amphtml]').attr('href')).toBe('/info.amp')\n  })","file":"integration/export-default-map-serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export hybrid index amp page correctly","suites":["Export with default map"],"updatePoint":{"line":54,"column":51},"line":54,"code":"  it('should export hybrid index amp page correctly', async () => {\n    expect.assertions(3)\n    await expect(access(join(outdir, 'index.html'))).resolves.toBe(undefined)\n    await expect(access(join(outdir, 'index.amp.html'))).resolves.toBe(\n      undefined\n    )\n\n    const html = await readFile(join(outdir, 'index.html'))\n    const $ = cheerio.load(html)\n    expect($('link[rel=amphtml]').attr('href')).toBe('/index.amp')\n  })","file":"integration/export-default-map-serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export with folder that has dot in name","suites":["Export with default map"],"updatePoint":{"line":18,"column":52},"line":18,"code":"  it('should export with folder that has dot in name', async () => {\n    expect.assertions(1)\n    await expect(access(join(outdir, 'v1.12.html'))).resolves.toBe(undefined)\n  })","file":"integration/export-default-map/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export an amp only page to clean path","suites":["Export with default map"],"updatePoint":{"line":23,"column":50},"line":23,"code":"  it('should export an amp only page to clean path', async () => {\n    expect.assertions(1)\n    await expect(access(join(outdir, 'docs.html'))).resolves.toBe(undefined)\n  })","file":"integration/export-default-map/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export hybrid amp page correctly","suites":["Export with default map"],"updatePoint":{"line":28,"column":45},"line":28,"code":"  it('should export hybrid amp page correctly', async () => {\n    expect.assertions(2)\n    await expect(access(join(outdir, 'some.html'))).resolves.toBe(undefined)\n    await expect(access(join(outdir, 'some.amp.html'))).resolves.toBe(undefined)\n  })","file":"integration/export-default-map/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export nested hybrid amp page correctly","suites":["Export with default map"],"updatePoint":{"line":34,"column":52},"line":34,"code":"  it('should export nested hybrid amp page correctly', async () => {\n    expect.assertions(3)\n    await expect(access(join(outdir, 'docs.html'))).resolves.toBe(undefined)\n    await expect(access(join(outdir, 'docs.amp.html'))).resolves.toBe(undefined)\n\n    const html = await readFile(join(outdir, 'docs.html'))\n    const $ = cheerio.load(html)\n    expect($('link[rel=amphtml]').attr('href')).toBe('/docs.amp')\n  })","file":"integration/export-default-map/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export nested hybrid amp page correctly with folder","suites":["Export with default map"],"updatePoint":{"line":44,"column":64},"line":44,"code":"  it('should export nested hybrid amp page correctly with folder', async () => {\n    expect.assertions(3)\n    await expect(access(join(outdir, 'info.html'))).resolves.toBe(undefined)\n    await expect(access(join(outdir, 'info.amp.html'))).resolves.toBe(undefined)\n\n    const html = await readFile(join(outdir, 'info.html'))\n    const $ = cheerio.load(html)\n    expect($('link[rel=amphtml]').attr('href')).toBe('/info.amp')\n  })","file":"integration/export-default-map/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export hybrid index amp page correctly","suites":["Export with default map"],"updatePoint":{"line":54,"column":51},"line":54,"code":"  it('should export hybrid index amp page correctly', async () => {\n    expect.assertions(3)\n    await expect(access(join(outdir, 'index.html'))).resolves.toBe(undefined)\n    await expect(access(join(outdir, 'index.amp.html'))).resolves.toBe(\n      undefined\n    )\n\n    const html = await readFile(join(outdir, 'index.html'))\n    const $ = cheerio.load(html)\n    expect($('link[rel=amphtml]').attr('href')).toBe('/index.amp')\n  })","file":"integration/export-default-map/test/index.test.js","skipped":false,"dir":"test"},{"name":"should of exported with correct asPath","suites":["Export Dynamic Pages"],"updatePoint":{"line":32,"column":44},"line":32,"code":"  it('should of exported with correct asPath', async () => {\n    const html = await renderViaHTTP(port, '/regression/jeff-is-cool')\n    const $ = cheerio.load(html)\n    expect($('#asPath').text()).toBe('/regression/jeff-is-cool')\n  })","file":"integration/export-dynamic-pages-serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should hydrate with correct asPath","suites":["Export Dynamic Pages"],"updatePoint":{"line":38,"column":40},"line":38,"code":"  it('should hydrate with correct asPath', async () => {\n    expect.assertions(1)\n    const browser = await webdriver(port, '/regression/jeff-is-cool')\n    try {\n      expect(await browser.eval(`window.__AS_PATHS`)).toEqual([\n        '/regression/jeff-is-cool',\n      ])\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/export-dynamic-pages-serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should of exported with correct asPath","suites":["Export Dyanmic Pages"],"updatePoint":{"line":32,"column":44},"line":32,"code":"  it('should of exported with correct asPath', async () => {\n    const html = await renderViaHTTP(port, '/regression/jeff-is-cool')\n    const $ = cheerio.load(html)\n    expect($('#asPath').text()).toBe('/regression/jeff-is-cool')\n  })","file":"integration/export-dynamic-pages/test/index.test.js","skipped":false,"dir":"test"},{"name":"should hydrate with correct asPath","suites":["Export Dyanmic Pages"],"updatePoint":{"line":38,"column":40},"line":38,"code":"  it('should hydrate with correct asPath', async () => {\n    expect.assertions(1)\n    const browser = await webdriver(port, '/regression/jeff-is-cool')\n    try {\n      expect(await browser.eval(`window.__AS_PATHS`)).toEqual([\n        '/regression/jeff-is-cool',\n      ])\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/export-dynamic-pages/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build successfully","suites":["Export error for fallback: true"],"updatePoint":{"line":11,"column":31},"line":11,"code":"  it('should build successfully', async () => {\n    await fs.remove(join(appDir, '.next'))\n    const { code } = await nextBuild(appDir)\n    if (code !== 0) throw new Error(`build failed with status ${code}`)\n  })","file":"integration/export-fallback-true-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have error during next export","suites":["Export error for fallback: true"],"updatePoint":{"line":17,"column":42},"line":17,"code":"  it('should have error during next export', async () => {\n    const { stderr } = await nextExport(appDir, { outdir }, { stderr: true })\n    expect(stderr).toContain('Found pages with `fallback` enabled')\n    expect(stderr).toContain(\n      'Pages with `fallback` enabled in `getStaticPaths` can not be exported'\n    )\n    expect(stderr).toContain('/[slug]')\n  })","file":"integration/export-fallback-true-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show warning with next export","suites":["Export with getInitialProps"],"updatePoint":{"line":10,"column":42},"line":10,"code":"  it('should show warning with next export', async () => {\n    await nextBuild(appDir)\n    const { stderr } = await nextExport(appDir, { outdir }, { stderr: true })\n    expect(stderr).toContain(\n      'https://nextjs.org/docs/messages/get-initial-props-export'\n    )\n  })","file":"integration/export-getInitialProps-warn/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build successfully","suites":["Export with default loader next/image component"],"updatePoint":{"line":11,"column":31},"line":11,"code":"  it('should build successfully', async () => {\n    await fs.remove(join(appDir, '.next'))\n    const { code } = await nextBuild(appDir)\n    if (code !== 0) throw new Error(`build failed with status ${code}`)\n  })","file":"integration/export-image-default/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have error during next export","suites":["Export with default loader next/image component"],"updatePoint":{"line":17,"column":42},"line":17,"code":"  it('should have error during next export', async () => {\n    const { stderr } = await nextExport(appDir, { outdir }, { stderr: true })\n    expect(stderr).toContain(\n      \"Image Optimization using Next.js' default loader is not compatible with `next export`.\"\n    )\n  })","file":"integration/export-image-default/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build successfully","suites":["Export with cloudinary loader next/image component"],"updatePoint":{"line":25,"column":31},"line":25,"code":"  it('should build successfully', async () => {\n    await fs.remove(join(appDir, '.next'))\n    const { code } = await nextBuild(appDir)\n    if (code !== 0) throw new Error(`build failed with status ${code}`)\n  })","file":"integration/export-image-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export successfully","suites":["Export with cloudinary loader next/image component"],"updatePoint":{"line":31,"column":32},"line":31,"code":"  it('should export successfully', async () => {\n    const { code } = await nextExport(appDir, { outdir })\n    if (code !== 0) throw new Error(`export failed with status ${code}`)\n  })","file":"integration/export-image-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"should contain img element in html output","suites":["Export with cloudinary loader next/image component"],"updatePoint":{"line":36,"column":47},"line":36,"code":"  it('should contain img element in html output', async () => {\n    const html = await fs.readFile(join(outdir, 'index.html'))\n    const $ = cheerio.load(html)\n    expect($('img[alt=\"icon\"]').attr('alt')).toBe('icon')\n  })","file":"integration/export-image-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build successfully","suites":["Export with custom loader next/image component"],"updatePoint":{"line":62,"column":31},"line":62,"code":"  it('should build successfully', async () => {\n    await fs.remove(join(appDir, '.next'))\n    const { code } = await nextBuild(appDir)\n    if (code !== 0) throw new Error(`build failed with status ${code}`)\n  })","file":"integration/export-image-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export successfully","suites":["Export with custom loader next/image component"],"updatePoint":{"line":68,"column":32},"line":68,"code":"  it('should export successfully', async () => {\n    const { code } = await nextExport(appDir, { outdir })\n    if (code !== 0) throw new Error(`export failed with status ${code}`)\n  })","file":"integration/export-image-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"should contain img element with same src in html output","suites":["Export with custom loader next/image component"],"updatePoint":{"line":73,"column":61},"line":73,"code":"  it('should contain img element with same src in html output', async () => {\n    const html = await fs.readFile(join(outdir, 'index.html'))\n    const $ = cheerio.load(html)\n    expect($('img[src=\"/custom/o.png\"]')).toBeDefined()\n  })","file":"integration/export-image-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build successfully","suites":["Export with unoptimized next/image component"],"updatePoint":{"line":96,"column":31},"line":96,"code":"  it('should build successfully', async () => {\n    await fs.remove(join(appDir, '.next'))\n    const { code } = await nextBuild(appDir)\n    if (code !== 0) throw new Error(`build failed with status ${code}`)\n  })","file":"integration/export-image-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export successfully","suites":["Export with unoptimized next/image component"],"updatePoint":{"line":102,"column":32},"line":102,"code":"  it('should export successfully', async () => {\n    const { code } = await nextExport(appDir, { outdir })\n    if (code !== 0) throw new Error(`export failed with status ${code}`)\n  })","file":"integration/export-image-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"should contain img element with same src in html output","suites":["Export with unoptimized next/image component"],"updatePoint":{"line":107,"column":61},"line":107,"code":"  it('should contain img element with same src in html output', async () => {\n    const html = await fs.readFile(join(outdir, 'index.html'))\n    const $ = cheerio.load(html)\n    expect($('img[src=\"/o.png\"]')).toBeDefined()\n  })","file":"integration/export-image-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build and export","suites":["Application Export Intent Output","Default Export"],"updatePoint":{"line":19,"column":31},"line":19,"code":"    it('should build and export', async () => {\n      await nextBuild(appDir)\n      await nextExportDefault(appDir)\n    })","file":"integration/export-intent/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have the expected outputs for export","suites":["Application Export Intent Output","Default Export"],"updatePoint":{"line":24,"column":51},"line":24,"code":"    it('should have the expected outputs for export', () => {\n      expect(\n        JSON.parse(fs.readFileSync(join(distDir, 'export-marker.json'), 'utf8'))\n      ).toMatchInlineSnapshot(`\n        Object {\n          \"exportTrailingSlash\": false,\n          \"hasExportPathMap\": false,\n          \"isNextImageImported\": false,\n          \"version\": 1,\n        }\n      `)\n\n      const detail = JSON.parse(\n        fs.readFileSync(join(distDir, 'export-detail.json'), 'utf8')\n      )\n      expect({\n        ...detail,\n        outDirectory: path.basename(detail.outDirectory),\n      }).toMatchInlineSnapshot(`\n        Object {\n          \"outDirectory\": \"out\",\n          \"success\": true,\n          \"version\": 1,\n        }\n      `)\n    })","file":"integration/export-intent/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build and export","suites":["Application Export Intent Output","Custom Export"],"updatePoint":{"line":60,"column":31},"line":60,"code":"    it('should build and export', async () => {\n      await nextBuild(appDir)\n      await nextExportDefault(appDir)\n    })","file":"integration/export-intent/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have the expected outputs for export","suites":["Application Export Intent Output","Custom Export"],"updatePoint":{"line":65,"column":51},"line":65,"code":"    it('should have the expected outputs for export', () => {\n      expect(\n        JSON.parse(fs.readFileSync(join(distDir, 'export-marker.json'), 'utf8'))\n      ).toMatchInlineSnapshot(`\n        Object {\n          \"exportTrailingSlash\": false,\n          \"hasExportPathMap\": true,\n          \"isNextImageImported\": false,\n          \"version\": 1,\n        }\n      `)\n\n      const detail = JSON.parse(\n        fs.readFileSync(join(distDir, 'export-detail.json'), 'utf8')\n      )\n      expect({\n        ...detail,\n        outDirectory: path.basename(detail.outDirectory),\n      }).toMatchInlineSnapshot(`\n        Object {\n          \"outDirectory\": \"out\",\n          \"success\": true,\n          \"version\": 1,\n        }\n      `)\n    })","file":"integration/export-intent/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build and export","suites":["Application Export Intent Output","Custom Out"],"updatePoint":{"line":101,"column":31},"line":101,"code":"    it('should build and export', async () => {\n      await nextBuild(appDir)\n      await nextExport(appDir, { outdir: join(appDir, 'lel') })\n    })","file":"integration/export-intent/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have the expected outputs for export","suites":["Application Export Intent Output","Custom Out"],"updatePoint":{"line":106,"column":51},"line":106,"code":"    it('should have the expected outputs for export', () => {\n      expect(\n        JSON.parse(fs.readFileSync(join(distDir, 'export-marker.json'), 'utf8'))\n      ).toMatchInlineSnapshot(`\n        Object {\n          \"exportTrailingSlash\": true,\n          \"hasExportPathMap\": false,\n          \"isNextImageImported\": false,\n          \"version\": 1,\n        }\n      `)\n\n      const detail = JSON.parse(\n        fs.readFileSync(join(distDir, 'export-detail.json'), 'utf8')\n      )\n      expect({\n        ...detail,\n        outDirectory: path.basename(detail.outDirectory),\n      }).toMatchInlineSnapshot(`\n        Object {\n          \"outDirectory\": \"lel\",\n          \"success\": true,\n          \"version\": 1,\n        }\n      `)\n    })","file":"integration/export-intent/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build and export","suites":["Application Export Intent Output","Bad Export"],"updatePoint":{"line":142,"column":31},"line":142,"code":"    it('should build and export', async () => {\n      await nextBuild(appDir)\n      await nextExportDefault(appDir, { ignoreFail: true })\n    })","file":"integration/export-intent/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have the expected outputs for export","suites":["Application Export Intent Output","Bad Export"],"updatePoint":{"line":147,"column":51},"line":147,"code":"    it('should have the expected outputs for export', () => {\n      expect(\n        JSON.parse(fs.readFileSync(join(distDir, 'export-marker.json'), 'utf8'))\n      ).toMatchInlineSnapshot(`\n        Object {\n          \"exportTrailingSlash\": false,\n          \"hasExportPathMap\": false,\n          \"isNextImageImported\": false,\n          \"version\": 1,\n        }\n      `)\n\n      const detail = JSON.parse(\n        fs.readFileSync(join(distDir, 'export-detail.json'), 'utf8')\n      )\n      expect({\n        ...detail,\n        outDirectory: path.basename(detail.outDirectory),\n      }).toMatchInlineSnapshot(`\n        Object {\n          \"outDirectory\": \"out\",\n          \"success\": false,\n          \"version\": 1,\n        }\n      `)\n    })","file":"integration/export-intent/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build and not export","suites":["Application Export Intent Output","No Export"],"updatePoint":{"line":183,"column":35},"line":183,"code":"    it('should build and not export', async () => {\n      await nextBuild(appDir)\n    })","file":"integration/export-intent/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have the expected outputs for export","suites":["Application Export Intent Output","No Export"],"updatePoint":{"line":187,"column":51},"line":187,"code":"    it('should have the expected outputs for export', () => {\n      expect(\n        JSON.parse(fs.readFileSync(join(distDir, 'export-marker.json'), 'utf8'))\n      ).toMatchInlineSnapshot(`\n        Object {\n          \"exportTrailingSlash\": false,\n          \"hasExportPathMap\": false,\n          \"isNextImageImported\": false,\n          \"version\": 1,\n        }\n      `)\n\n      expect(() => {\n        fs.readFileSync(join(distDir, 'export-detail.json'), 'utf8')\n      }).toThrowError(/ENOENT/)\n    })","file":"integration/export-intent/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export and create file","suites":["Application Export Intent Output","No Export"],"updatePoint":{"line":204,"column":37},"line":204,"code":"    it('should export and create file', async () => {\n      await nextExportDefault(appDir)\n\n      expect(() => {\n        fs.readFileSync(join(distDir, 'export-detail.json'), 'utf8')\n      }).not.toThrow()\n    })","file":"integration/export-intent/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build and clean up","suites":["Application Export Intent Output","No Export"],"updatePoint":{"line":212,"column":33},"line":212,"code":"    it('should build and clean up', async () => {\n      await nextBuild(appDir)\n\n      expect(() => {\n        fs.readFileSync(join(distDir, 'export-detail.json'), 'utf8')\n      }).toThrowError(/ENOENT/)\n    })","file":"integration/export-intent/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show error when there is no production build","suites":["next export without build"],"updatePoint":{"line":7,"column":57},"line":7,"code":"  it('should show error when there is no production build', async () => {\n    const result = await nextExport(appDir, {}, { stderr: true, stdout: true })\n    console.log(result.stdout, result.stderr)\n    expect(result.stderr).toMatch(/Could not find a production build in the/)\n  })","file":"integration/export-no-build/test/index.test.js","skipped":false,"dir":"test"},{"name":"build: should log with internally passed statusMessage","suites":["Export cli prints progress info"],"updatePoint":{"line":18,"column":60},"line":18,"code":"  it('build: should log with internally passed statusMessage', async () => {\n    const lines = buildStdout.split('\\n')\n    // Search `info  - Generating static pages (n/m)` line\n    const found = lines.some((line) =>\n      /Generating static pages \\(\\d+\\/\\d+\\)/.test(line)\n    )\n\n    expect(found).toBeTruthy()\n  })","file":"integration/export-progress-status-message/test/index.test.js","skipped":false,"dir":"test"},{"name":"export: should log with default label","suites":["Export cli prints progress info"],"updatePoint":{"line":28,"column":43},"line":28,"code":"  it('export: should log with default label', async () => {\n    const lines = exportStdout.split('\\n')\n    // Search `info  - Exporting (n/m)` line\n    const found = lines.some((line) => /Exporting \\(\\d+\\/\\d+\\)/.test(line))\n\n    expect(found).toBeTruthy()\n  })","file":"integration/export-progress-status-message/test/index.test.js","skipped":false,"dir":"test"},{"name":"should delete existing exported files","suites":["Static Export"],"updatePoint":{"line":31,"column":43},"line":31,"code":"  it('should delete existing exported files', async () => {\n    const outdir = join(appDir, 'out')\n    const tempfile = join(outdir, 'temp.txt')\n\n    await mkdir(outdir).catch((e) => {\n      if (e.code !== 'EEXIST') throw e\n    })\n    await writeFile(tempfile, 'Hello there')\n\n    await nextBuild(appDir)\n    await nextExport(appDir, { outdir })\n\n    let doesNotExist = false\n    await access(tempfile).catch((e) => {\n      if (e.code === 'ENOENT') doesNotExist = true\n    })\n    expect(doesNotExist).toBe(true)\n  })","file":"integration/export-serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export pages as [filename].html instead of [filename]/index.html","suites":["Export config#exportTrailingSlash set to false"],"updatePoint":{"line":18,"column":77},"line":18,"code":"  it('should export pages as [filename].html instead of [filename]/index.html', async () => {\n    expect.assertions(6)\n\n    await expect(access(join(outdir, 'index.html'))).resolves.toBe(undefined)\n    await expect(access(join(outdir, 'about.html'))).resolves.toBe(undefined)\n    await expect(access(join(outdir, 'posts.html'))).resolves.toBe(undefined)\n    await expect(access(join(outdir, 'posts', 'single.html'))).resolves.toBe(\n      undefined\n    )\n\n    const html = await readFile(join(outdir, 'index.html'))\n    const $ = cheerio.load(html)\n    expect($('p').text()).toBe('I am a home page')\n\n    const htmlSingle = await readFile(join(outdir, 'posts', 'single.html'))\n    const $single = cheerio.load(htmlSingle)\n    expect($single('p').text()).toBe('I am a single post')\n  })","file":"integration/export-subfolders-serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export pages as [filename].html instead of [filename]/index.html","suites":["Export config#exportTrailingSlash set to false"],"updatePoint":{"line":18,"column":77},"line":18,"code":"  it('should export pages as [filename].html instead of [filename]/index.html', async () => {\n    expect.assertions(6)\n\n    await expect(access(join(outdir, 'index.html'))).resolves.toBe(undefined)\n    await expect(access(join(outdir, 'about.html'))).resolves.toBe(undefined)\n    await expect(access(join(outdir, 'posts.html'))).resolves.toBe(undefined)\n    await expect(access(join(outdir, 'posts', 'single.html'))).resolves.toBe(\n      undefined\n    )\n\n    const html = await readFile(join(outdir, 'index.html'))\n    const $ = cheerio.load(html)\n    expect($('p').text()).toBe('I am a home page')\n\n    const htmlSingle = await readFile(join(outdir, 'posts', 'single.html'))\n    const $single = cheerio.load(htmlSingle)\n    expect($single('p').text()).toBe('I am a single post')\n  })","file":"integration/export-subfolders/test/index.test.js","skipped":false,"dir":"test"},{"name":"should delete existing exported files","suites":["Static Export"],"updatePoint":{"line":39,"column":43},"line":39,"code":"  it('should delete existing exported files', async () => {\n    const tempfile = join(outdir, 'temp.txt')\n\n    await mkdir(outdir).catch((e) => {\n      if (e.code !== 'EEXIST') throw e\n    })\n    await writeFile(tempfile, 'Hello there')\n\n    await nextBuild(appDir)\n    await nextExport(appDir, { outdir })\n\n    let doesNotExist = false\n    await access(tempfile).catch((e) => {\n      if (e.code === 'ENOENT') doesNotExist = true\n    })\n    expect(doesNotExist).toBe(true)\n  })","file":"integration/export/test/index.test.js","skipped":false,"dir":"test"},{"name":"should honor exportTrailingSlash for 404 page","suites":["Static Export"],"updatePoint":{"line":95,"column":51},"line":95,"code":"  it('should honor exportTrailingSlash for 404 page', async () => {\n    expect(await fileExist(join(outdir, '404/index.html'))).toBe(true)\n\n    // we still output 404.html for backwards compat\n    expect(await fileExist(join(outdir, '404.html'))).toBe(true)\n  })","file":"integration/export/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle trailing slash in getStaticPaths","suites":["Static Export"],"updatePoint":{"line":102,"column":52},"line":102,"code":"  it('should handle trailing slash in getStaticPaths', async () => {\n    expect(await fileExist(join(outdir, 'gssp/foo/index.html'))).toBe(true)\n\n    expect(await fileExist(join(outNoTrailSlash, 'gssp/foo.html'))).toBe(true)\n  })","file":"integration/export/test/index.test.js","skipped":false,"dir":"test"},{"name":"should only output 404.html without exportTrailingSlash","suites":["Static Export"],"updatePoint":{"line":108,"column":61},"line":108,"code":"  it('should only output 404.html without exportTrailingSlash', async () => {\n    expect(await fileExist(join(outNoTrailSlash, '404/index.html'))).toBe(false)\n\n    expect(await fileExist(join(outNoTrailSlash, '404.html'))).toBe(true)\n  })","file":"integration/export/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not duplicate /index with exportTrailingSlash","suites":["Static Export"],"updatePoint":{"line":114,"column":58},"line":114,"code":"  it('should not duplicate /index with exportTrailingSlash', async () => {\n    expect(await fileExist(join(outdir, 'index/index.html'))).toBe(false)\n\n    expect(await fileExist(join(outdir, 'index.html'))).toBe(true)\n  })","file":"integration/export/test/index.test.js","skipped":false,"dir":"test"},{"name":"should support Firebase","suites":["External Assets"],"updatePoint":{"line":24,"column":29},"line":24,"code":"  it('should support Firebase', async () => {\n    const html = await renderViaHTTP(appPort, '/about/history')\n    expect(html).toMatch(/Hello Firebase: <!-- -->0/)\n  })","file":"integration/external-assets/test/index.test.js","skipped":false,"dir":"test"},{"name":"Does not bundle next/dist/shared/lib/head.js in _error","suites":["externalize next/dist/shared"],"updatePoint":{"line":13,"column":60},"line":13,"code":"  it('Does not bundle next/dist/shared/lib/head.js in _error', async () => {\n    const content = readNextBuildServerPageFile(appDir, '/_error')\n    expect(content).toMatch(\n      new RegExp(\n        '^' +\n          escapeStringRegexp(\n            `module.exports = require(\"next/dist/shared/lib/head.js\");`\n          ) +\n          ';?$',\n        'm'\n      )\n    )\n  })","file":"integration/externalize-next-server/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the static page","suites":["Handle ESM externals with esmExternals: 'loose'"],"updatePoint":{"line":29,"column":35},"line":29,"code":"  it('should render the static page', async () => {\n    const html = await renderViaHTTP(appPort, '/static')\n    expect(html).toMatch(expected)\n  })","file":"integration/externals-esm-loose/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the ssr page","suites":["Handle ESM externals with esmExternals: 'loose'"],"updatePoint":{"line":34,"column":32},"line":34,"code":"  it('should render the ssr page', async () => {\n    const html = await renderViaHTTP(appPort, '/ssr')\n    expect(html).toMatch(expected)\n  })","file":"integration/externals-esm-loose/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the ssg page","suites":["Handle ESM externals with esmExternals: 'loose'"],"updatePoint":{"line":39,"column":32},"line":39,"code":"  it('should render the ssg page', async () => {\n    const html = await renderViaHTTP(appPort, '/ssg')\n    expect(html).toMatch(expected)\n  })","file":"integration/externals-esm-loose/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the static page","suites":["Handle ESM externals with esmExternals: true"],"updatePoint":{"line":29,"column":35},"line":29,"code":"  it('should render the static page', async () => {\n    const html = await renderViaHTTP(appPort, '/static')\n    expect(html).toMatch(expected)\n  })","file":"integration/externals-esm/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the ssr page","suites":["Handle ESM externals with esmExternals: true"],"updatePoint":{"line":34,"column":32},"line":34,"code":"  it('should render the ssr page', async () => {\n    const html = await renderViaHTTP(appPort, '/ssr')\n    expect(html).toMatch(expected)\n  })","file":"integration/externals-esm/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the ssg page","suites":["Handle ESM externals with esmExternals: true"],"updatePoint":{"line":39,"column":32},"line":39,"code":"  it('should render the ssg page', async () => {\n    const html = await renderViaHTTP(appPort, '/ssg')\n    expect(html).toMatch(expected)\n  })","file":"integration/externals-esm/test/index.test.js","skipped":false,"dir":"test"},{"name":"should rewrite correctly for path at same level as fallback: false SSR","suites":[],"updatePoint":{"line":21,"column":76},"line":21,"code":"  it('should rewrite correctly for path at same level as fallback: false SSR', async () => {\n    const res = await fetchViaHTTP(appPort, '/hello', undefined, {\n      redirect: 'manual',\n    })\n    expect(res.status).toBe(200)\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n\n    expect($('#another').text()).toBe('another')\n    expect(JSON.parse($('#query').text())).toEqual({\n      path: ['hello'],\n    })\n  })","file":"integration/fallback-false-rewrite/test/index.test.js","skipped":false,"dir":"test"},{"name":"should rewrite correctly for path above fallback: false SSR","suites":[],"updatePoint":{"line":36,"column":65},"line":36,"code":"  it('should rewrite correctly for path above fallback: false SSR', async () => {\n    const res = await fetchViaHTTP(appPort, '/hello/world', undefined, {\n      redirect: 'manual',\n    })\n    expect(res.status).toBe(200)\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n\n    expect($('#another').text()).toBe('another')\n    expect(JSON.parse($('#query').text())).toEqual({\n      path: ['hello', 'world'],\n    })\n  })","file":"integration/fallback-false-rewrite/test/index.test.js","skipped":false,"dir":"test"},{"name":"should rewrite correctly for path at same level as fallback: false client","suites":[],"updatePoint":{"line":51,"column":79},"line":51,"code":"  it('should rewrite correctly for path at same level as fallback: false client', async () => {\n    const browser = await webdriver(appPort, '/hello')\n\n    expect(await browser.elementByCss('#another').text()).toBe('another')\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      path: ['hello'],\n    })\n  })","file":"integration/fallback-false-rewrite/test/index.test.js","skipped":false,"dir":"test"},{"name":"should rewrite correctly for path above fallback: false client","suites":[],"updatePoint":{"line":60,"column":68},"line":60,"code":"  it('should rewrite correctly for path above fallback: false client', async () => {\n    const browser = await webdriver(appPort, '/hello/world')\n\n    expect(await browser.elementByCss('#another').text()).toBe('another')\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      path: ['hello', 'world'],\n    })\n  })","file":"integration/fallback-false-rewrite/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not rewrite for path from fallback: false SSR","suites":[],"updatePoint":{"line":69,"column":58},"line":69,"code":"  it('should not rewrite for path from fallback: false SSR', async () => {\n    const res = await fetchViaHTTP(appPort, '/first', undefined, {\n      redirect: 'manual',\n    })\n    expect(res.status).toBe(200)\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n\n    expect($('#slug').text()).toContain('hello')\n    expect(JSON.parse($('#query').text())).toEqual({\n      slug: 'first',\n    })\n  })","file":"integration/fallback-false-rewrite/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not rewrite for path from fallback: false client","suites":[],"updatePoint":{"line":84,"column":61},"line":84,"code":"  it('should not rewrite for path from fallback: false client', async () => {\n    const browser = await webdriver(appPort, '/second')\n\n    expect(await browser.elementByCss('#slug').text()).toContain('hello')\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      slug: 'second',\n    })\n  })","file":"integration/fallback-false-rewrite/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not include crypto","suites":["Build Output","Crypto Application"],"updatePoint":{"line":19,"column":33},"line":19,"code":"    it('should not include crypto', async () => {\n      if (process.env.NEXT_PRIVATE_SKIP_SIZE_TESTS) {\n        return\n      }\n\n      ;({ stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      }))\n\n      console.log(stdout)\n\n      const parsePageSize = (page) =>\n        stdout.match(\n          new RegExp(` ${page} .*?((?:\\\\d|\\\\.){1,} (?:\\\\w{1,})) `)\n        )[1]\n\n      const parsePageFirstLoad = (page) =>\n        stdout.match(\n          new RegExp(\n            ` ${page} .*?(?:(?:\\\\d|\\\\.){1,}) .*? ((?:\\\\d|\\\\.){1,} (?:\\\\w{1,}))`\n          )\n        )[1]\n\n      const indexSize = parsePageSize('/')\n      const indexFirstLoad = parsePageFirstLoad('/')\n\n      // expect(parseFloat(indexSize)).toBeLessThanOrEqual(3.1)\n      // expect(parseFloat(indexSize)).toBeGreaterThanOrEqual(2)\n      expect(indexSize.endsWith('kB')).toBe(true)\n\n      // expect(parseFloat(indexFirstLoad)).toBeLessThanOrEqual(67.9)\n      // expect(parseFloat(indexFirstLoad)).toBeGreaterThanOrEqual(60)\n      expect(indexFirstLoad.endsWith('kB')).toBe(true)\n    })","file":"integration/fallback-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct fallback query (skeleton)","suites":[],"updatePoint":{"line":23,"column":51},"line":23,"code":"  it('should have correct fallback query (skeleton)', async () => {\n    const html = await renderViaHTTP(appPort, '/first')\n    const $ = cheerio.load(html)\n    const { query } = JSON.parse($('#__NEXT_DATA__').text())\n    expect(query).toEqual({})\n  })","file":"integration/fallback-route-params/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct fallback query (hydration)","suites":[],"updatePoint":{"line":30,"column":52},"line":30,"code":"  it('should have correct fallback query (hydration)', async () => {\n    const browser = await webdriver(appPort, '/second')\n    const initialSlug = await browser.eval(() => window.initialSlug)\n    expect(initialSlug).toBeFalsy()\n\n    await browser.waitForElementByCss('#query')\n\n    const hydratedQuery = JSON.parse(\n      await browser.elementByCss('#query').text()\n    )\n    expect(hydratedQuery).toEqual({ slug: 'second' })\n  })","file":"integration/fallback-route-params/test/index.test.js","skipped":false,"dir":"test"},{"name":"includes polyfilled fetch when using getStaticProps","suites":[],"updatePoint":{"line":55,"column":57},"line":55,"code":"  it('includes polyfilled fetch when using getStaticProps', async () => {\n    const html = await renderViaHTTP(appPort, '/static')\n    expect(html).toMatch(/bar/)\n  })","file":"integration/fetch-polyfill-ky-universal/test/index.test.js","skipped":false,"dir":"test"},{"name":"includes polyfilled fetch when using getServerSideProps","suites":[],"updatePoint":{"line":59,"column":61},"line":59,"code":"  it('includes polyfilled fetch when using getServerSideProps', async () => {\n    const html = await renderViaHTTP(appPort, '/ssr')\n    expect(html).toMatch(/bar/)\n  })","file":"integration/fetch-polyfill-ky-universal/test/index.test.js","skipped":false,"dir":"test"},{"name":"includes polyfilled fetch when using getInitialProps","suites":[],"updatePoint":{"line":63,"column":58},"line":63,"code":"  it('includes polyfilled fetch when using getInitialProps', async () => {\n    const html = await renderViaHTTP(appPort, '/getinitialprops')\n    expect(html).toMatch(/bar/)\n  })","file":"integration/fetch-polyfill-ky-universal/test/index.test.js","skipped":false,"dir":"test"},{"name":"includes polyfilled fetch when using getStaticProps","suites":[],"updatePoint":{"line":57,"column":57},"line":57,"code":"  it('includes polyfilled fetch when using getStaticProps', async () => {\n    const html = await renderViaHTTP(appPort, '/static')\n    expect(html).toMatch(/bar/)\n  })","file":"integration/fetch-polyfill/test/index.test.js","skipped":false,"dir":"test"},{"name":"includes polyfilled fetch when using getServerSideProps","suites":[],"updatePoint":{"line":61,"column":61},"line":61,"code":"  it('includes polyfilled fetch when using getServerSideProps', async () => {\n    const html = await renderViaHTTP(appPort, '/ssr')\n    expect(html).toMatch(/bar/)\n  })","file":"integration/fetch-polyfill/test/index.test.js","skipped":false,"dir":"test"},{"name":"includes polyfilled fetch when using getInitialProps","suites":[],"updatePoint":{"line":65,"column":58},"line":65,"code":"  it('includes polyfilled fetch when using getInitialProps', async () => {\n    const html = await renderViaHTTP(appPort, '/getinitialprops')\n    expect(html).toMatch(/bar/)\n  })","file":"integration/fetch-polyfill/test/index.test.js","skipped":false,"dir":"test"},{"name":"includes polyfilled fetch when using API routes","suites":[],"updatePoint":{"line":70,"column":53},"line":70,"code":"  it('includes polyfilled fetch when using API routes', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/api-route')\n    const json = await res.json()\n\n    expect(json.foo).toBe('bar')\n  })","file":"integration/fetch-polyfill/test/index.test.js","skipped":false,"dir":"test"},{"name":"includes polyfilled fetch when using getStaticPaths","suites":[],"updatePoint":{"line":77,"column":57},"line":77,"code":"  it('includes polyfilled fetch when using getStaticPaths', async () => {\n    const htmlA = await renderViaHTTP(appPort, '/user/a')\n    const $a = cheerio.load(htmlA)\n    expect($a('#username').text()).toBe('a')\n\n    const htmlB = await renderViaHTTP(appPort, '/user/b')\n    const $b = cheerio.load(htmlB)\n    expect($b('#username').text()).toBe('b')\n  })","file":"integration/fetch-polyfill/test/index.test.js","skipped":false,"dir":"test"},{"name":"should serve file with space correctly from public/","suites":[],"updatePoint":{"line":52,"column":57},"line":52,"code":"  it('should serve file with space correctly from public/', async () => {\n    const res = await fetchViaHTTP(appPort, '/hello world.txt')\n    expect(res.status).toBe(200)\n    expect(await res.text()).toBe('hi')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should serve file with space correctly static/","suites":[],"updatePoint":{"line":58,"column":52},"line":58,"code":"  it('should serve file with space correctly static/', async () => {\n    const res = await fetchViaHTTP(appPort, '/static/hello world.txt')\n    expect(res.status).toBe(200)\n    expect(await res.text()).toBe('hi')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should serve avif image with correct content-type","suites":[],"updatePoint":{"line":64,"column":55},"line":64,"code":"  it('should serve avif image with correct content-type', async () => {\n    // vercel-icon-dark.avif is downloaded from https://vercel.com/design and transformed to avif on avif.io\n    const res = await fetchViaHTTP(appPort, '/vercel-icon-dark.avif')\n    expect(res.status).toBe(200)\n    expect(res.headers.get('content-type')).toBe('image/avif')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should serve correct error code","suites":[],"updatePoint":{"line":71,"column":37},"line":71,"code":"  it('should serve correct error code', async () => {\n    // vercel-icon-dark.avif is downloaded from https://vercel.com/design and transformed to avif on avif.io\n    const res = await fetchViaHTTP(appPort, '/vercel-icon-dark.avif', '', {\n      headers: {\n        Range: 'bytes=1000000000-',\n      },\n    })\n    expect(res.status).toBe(416) // 416 Range Not Satisfiable\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../test-file.txt","suites":[],"updatePoint":{"line":84,"column":54},"line":84,"code":"  it('should prevent traversing with /../test-file.txt', async () => {\n    await expectStatus('/../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../../test-file.txt","suites":[],"updatePoint":{"line":88,"column":57},"line":88,"code":"  it('should prevent traversing with /../../test-file.txt', async () => {\n    await expectStatus('/../../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../../../test-file.txt","suites":[],"updatePoint":{"line":92,"column":60},"line":92,"code":"  it('should prevent traversing with /../../../test-file.txt', async () => {\n    await expectStatus('/../../../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../../../../test-file.txt","suites":[],"updatePoint":{"line":96,"column":63},"line":96,"code":"  it('should prevent traversing with /../../../../test-file.txt', async () => {\n    await expectStatus('/../../../../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../../../../../test-file.txt","suites":[],"updatePoint":{"line":100,"column":66},"line":100,"code":"  it('should prevent traversing with /../../../../../test-file.txt', async () => {\n    await expectStatus('/../../../../../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../../../../../../test-file.txt","suites":[],"updatePoint":{"line":104,"column":69},"line":104,"code":"  it('should prevent traversing with /../../../../../../test-file.txt', async () => {\n    await expectStatus('/../../../../../../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../../../../../../../test-file.txt","suites":[],"updatePoint":{"line":108,"column":72},"line":108,"code":"  it('should prevent traversing with /../../../../../../../test-file.txt', async () => {\n    await expectStatus('/../../../../../../../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../../../../../../../../test-file.txt","suites":[],"updatePoint":{"line":112,"column":75},"line":112,"code":"  it('should prevent traversing with /../../../../../../../../test-file.txt', async () => {\n    await expectStatus('/../../../../../../../../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2ftest-file.txt","suites":[],"updatePoint":{"line":116,"column":56},"line":116,"code":"  it('should prevent traversing with /..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2f..%2ftest-file.txt","suites":[],"updatePoint":{"line":120,"column":61},"line":120,"code":"  it('should prevent traversing with /..%2f..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2f..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2f..%2f..%2ftest-file.txt","suites":[],"updatePoint":{"line":124,"column":66},"line":124,"code":"  it('should prevent traversing with /..%2f..%2f..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2f..%2f..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2f..%2f..%2f..%2ftest-file.txt","suites":[],"updatePoint":{"line":128,"column":71},"line":128,"code":"  it('should prevent traversing with /..%2f..%2f..%2f..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2f..%2f..%2f..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2f..%2f..%2f..%2f..%2ftest-file.txt","suites":[],"updatePoint":{"line":132,"column":76},"line":132,"code":"  it('should prevent traversing with /..%2f..%2f..%2f..%2f..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2f..%2f..%2f..%2f..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt","suites":[],"updatePoint":{"line":136,"column":81},"line":136,"code":"  it('should prevent traversing with /..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2f..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt","suites":[],"updatePoint":{"line":140,"column":86},"line":140,"code":"  it('should prevent traversing with /..%2f..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2f..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt","suites":[],"updatePoint":{"line":144,"column":91},"line":144,"code":"  it('should prevent traversing with /..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":148,"column":58},"line":148,"code":"  it('should prevent traversing with /%2e%2e/test-file.txt', async () => {\n    await expectStatus('/%2e%2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":152,"column":65},"line":152,"code":"  it('should prevent traversing with /%2e%2e/%2e%2e/test-file.txt', async () => {\n    await expectStatus('/%2e%2e/%2e%2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":156,"column":72},"line":156,"code":"  it('should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/test-file.txt', async () => {\n    await expectStatus('/%2e%2e/%2e%2e/%2e%2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":160,"column":79},"line":160,"code":"  it('should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt', async () => {\n    await expectStatus('/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":164,"column":86},"line":164,"code":"  it('should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt', async () => {\n    await expectStatus('/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":168,"column":93},"line":168,"code":"  it('should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":174,"column":100},"line":174,"code":"  it('should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":180,"column":107},"line":180,"code":"  it('should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":186,"column":60},"line":186,"code":"  it('should prevent traversing with /%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus('/%2e%2e%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":190,"column":69},"line":190,"code":"  it('should prevent traversing with /%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus('/%2e%2e%2f%2e%2e%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":194,"column":78},"line":194,"code":"  it('should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus('/%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":198,"column":87},"line":198,"code":"  it('should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus('/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":202,"column":96},"line":202,"code":"  it('should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":208,"column":105},"line":208,"code":"  it('should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":214,"column":114},"line":214,"code":"  it('should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":220,"column":123},"line":220,"code":"  it('should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252ftest-file.txt","suites":[],"updatePoint":{"line":226,"column":58},"line":226,"code":"  it('should prevent traversing with /..%252ftest-file.txt', async () => {\n    await expectStatus('/..%252ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252f..%252ftest-file.txt","suites":[],"updatePoint":{"line":230,"column":65},"line":230,"code":"  it('should prevent traversing with /..%252f..%252ftest-file.txt', async () => {\n    await expectStatus('/..%252f..%252ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252f..%252f..%252ftest-file.txt","suites":[],"updatePoint":{"line":234,"column":72},"line":234,"code":"  it('should prevent traversing with /..%252f..%252f..%252ftest-file.txt', async () => {\n    await expectStatus('/..%252f..%252f..%252ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252f..%252f..%252f..%252ftest-file.txt","suites":[],"updatePoint":{"line":238,"column":79},"line":238,"code":"  it('should prevent traversing with /..%252f..%252f..%252f..%252ftest-file.txt', async () => {\n    await expectStatus('/..%252f..%252f..%252f..%252ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252f..%252f..%252f..%252f..%252ftest-file.txt","suites":[],"updatePoint":{"line":242,"column":86},"line":242,"code":"  it('should prevent traversing with /..%252f..%252f..%252f..%252f..%252ftest-file.txt', async () => {\n    await expectStatus('/..%252f..%252f..%252f..%252f..%252ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt","suites":[],"updatePoint":{"line":246,"column":93},"line":246,"code":"  it('should prevent traversing with /..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252f..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt","suites":[],"updatePoint":{"line":252,"column":100},"line":252,"code":"  it('should prevent traversing with /..%252f..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/..%252f..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt","suites":[],"updatePoint":{"line":258,"column":107},"line":258,"code":"  it('should prevent traversing with /..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":264,"column":62},"line":264,"code":"  it('should prevent traversing with /%252e%252e/test-file.txt', async () => {\n    await expectStatus('/%252e%252e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":268,"column":73},"line":268,"code":"  it('should prevent traversing with /%252e%252e/%252e%252e/test-file.txt', async () => {\n    await expectStatus('/%252e%252e/%252e%252e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":272,"column":84},"line":272,"code":"  it('should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/test-file.txt', async () => {\n    await expectStatus('/%252e%252e/%252e%252e/%252e%252e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":276,"column":95},"line":276,"code":"  it('should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":282,"column":106},"line":282,"code":"  it('should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":288,"column":117},"line":288,"code":"  it('should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":294,"column":128},"line":294,"code":"  it('should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":300,"column":139},"line":300,"code":"  it('should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":306,"column":66},"line":306,"code":"  it('should prevent traversing with /%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus('/%252e%252e%252ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252f%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":310,"column":81},"line":310,"code":"  it('should prevent traversing with /%252e%252e%252f%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus('/%252e%252e%252f%252e%252e%252ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":314,"column":96},"line":314,"code":"  it('should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":320,"column":111},"line":320,"code":"  it('should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":326,"column":126},"line":326,"code":"  it('should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":332,"column":141},"line":332,"code":"  it('should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":338,"column":156},"line":338,"code":"  it('should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":344,"column":171},"line":344,"code":"  it('should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\test-file.txt","suites":[],"updatePoint":{"line":350,"column":55},"line":350,"code":"  it('should prevent traversing with /..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\test-file.txt","suites":[],"updatePoint":{"line":354,"column":59},"line":354,"code":"  it('should prevent traversing with /..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":358,"column":63},"line":358,"code":"  it('should prevent traversing with /..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":362,"column":67},"line":362,"code":"  it('should prevent traversing with /..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\..\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":366,"column":71},"line":366,"code":"  it('should prevent traversing with /..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":370,"column":75},"line":370,"code":"  it('should prevent traversing with /..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":374,"column":79},"line":374,"code":"  it('should prevent traversing with /..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\..\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":378,"column":83},"line":378,"code":"  it('should prevent traversing with /..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255ctest-file.txt","suites":[],"updatePoint":{"line":382,"column":58},"line":382,"code":"  it('should prevent traversing with /..%255ctest-file.txt', async () => {\n    await expectStatus('/..%255ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255c..%255ctest-file.txt","suites":[],"updatePoint":{"line":386,"column":65},"line":386,"code":"  it('should prevent traversing with /..%255c..%255ctest-file.txt', async () => {\n    await expectStatus('/..%255c..%255ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255c..%255c..%255ctest-file.txt","suites":[],"updatePoint":{"line":390,"column":72},"line":390,"code":"  it('should prevent traversing with /..%255c..%255c..%255ctest-file.txt', async () => {\n    await expectStatus('/..%255c..%255c..%255ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255c..%255c..%255c..%255ctest-file.txt","suites":[],"updatePoint":{"line":394,"column":79},"line":394,"code":"  it('should prevent traversing with /..%255c..%255c..%255c..%255ctest-file.txt', async () => {\n    await expectStatus('/..%255c..%255c..%255c..%255ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255c..%255c..%255c..%255c..%255ctest-file.txt","suites":[],"updatePoint":{"line":398,"column":86},"line":398,"code":"  it('should prevent traversing with /..%255c..%255c..%255c..%255c..%255ctest-file.txt', async () => {\n    await expectStatus('/..%255c..%255c..%255c..%255c..%255ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt","suites":[],"updatePoint":{"line":402,"column":93},"line":402,"code":"  it('should prevent traversing with /..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255c..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt","suites":[],"updatePoint":{"line":408,"column":100},"line":408,"code":"  it('should prevent traversing with /..%255c..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/..%255c..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255c..%255c..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt","suites":[],"updatePoint":{"line":414,"column":107},"line":414,"code":"  it('should prevent traversing with /..%255c..%255c..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/..%255c..%255c..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5c..%5ctest-file.txt","suites":[],"updatePoint":{"line":420,"column":61},"line":420,"code":"  it('should prevent traversing with /..%5c..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5c..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5c..%5c..%5ctest-file.txt","suites":[],"updatePoint":{"line":424,"column":66},"line":424,"code":"  it('should prevent traversing with /..%5c..%5c..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5c..%5c..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5c..%5c..%5c..%5ctest-file.txt","suites":[],"updatePoint":{"line":428,"column":71},"line":428,"code":"  it('should prevent traversing with /..%5c..%5c..%5c..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5c..%5c..%5c..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5c..%5c..%5c..%5c..%5ctest-file.txt","suites":[],"updatePoint":{"line":432,"column":76},"line":432,"code":"  it('should prevent traversing with /..%5c..%5c..%5c..%5c..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5c..%5c..%5c..%5c..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt","suites":[],"updatePoint":{"line":436,"column":81},"line":436,"code":"  it('should prevent traversing with /..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5c..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt","suites":[],"updatePoint":{"line":440,"column":86},"line":440,"code":"  it('should prevent traversing with /..%5c..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5c..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt","suites":[],"updatePoint":{"line":444,"column":91},"line":444,"code":"  it('should prevent traversing with /..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":448,"column":59},"line":448,"code":"  it('should prevent traversing with /%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus('/%2e%2e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":452,"column":67},"line":452,"code":"  it('should prevent traversing with /%2e%2e\\\\%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus('/%2e%2e\\\\%2e%2e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\%2e%2e\\%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":456,"column":75},"line":456,"code":"  it('should prevent traversing with /%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus('/%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":460,"column":83},"line":460,"code":"  it('should prevent traversing with /%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus('/%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":464,"column":91},"line":464,"code":"  it('should prevent traversing with /%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus('/%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":468,"column":99},"line":468,"code":"  it('should prevent traversing with /%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":474,"column":107},"line":474,"code":"  it('should prevent traversing with /%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":480,"column":115},"line":480,"code":"  it('should prevent traversing with /%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":486,"column":60},"line":486,"code":"  it('should prevent traversing with /%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus('/%2e%2e%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":490,"column":69},"line":490,"code":"  it('should prevent traversing with /%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus('/%2e%2e%5c%2e%2e%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":494,"column":78},"line":494,"code":"  it('should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus('/%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":498,"column":87},"line":498,"code":"  it('should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus('/%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":502,"column":96},"line":502,"code":"  it('should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":508,"column":105},"line":508,"code":"  it('should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":514,"column":114},"line":514,"code":"  it('should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":520,"column":123},"line":520,"code":"  it('should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":526,"column":63},"line":526,"code":"  it('should prevent traversing with /%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus('/%252e%252e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":530,"column":75},"line":530,"code":"  it('should prevent traversing with /%252e%252e\\\\%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus('/%252e%252e\\\\%252e%252e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\%252e%252e\\%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":534,"column":87},"line":534,"code":"  it('should prevent traversing with /%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus('/%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":538,"column":99},"line":538,"code":"  it('should prevent traversing with /%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":544,"column":111},"line":544,"code":"  it('should prevent traversing with /%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":550,"column":123},"line":550,"code":"  it('should prevent traversing with /%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":556,"column":135},"line":556,"code":"  it('should prevent traversing with /%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":562,"column":147},"line":562,"code":"  it('should prevent traversing with /%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":568,"column":66},"line":568,"code":"  it('should prevent traversing with /%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus('/%252e%252e%255ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255c%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":572,"column":81},"line":572,"code":"  it('should prevent traversing with /%252e%252e%255c%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus('/%252e%252e%255c%252e%252e%255ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":576,"column":96},"line":576,"code":"  it('should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":582,"column":111},"line":582,"code":"  it('should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":588,"column":126},"line":588,"code":"  it('should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":594,"column":141},"line":594,"code":"  it('should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":600,"column":156},"line":600,"code":"  it('should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":606,"column":171},"line":606,"code":"  it('should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%aftest-file.txt","suites":[],"updatePoint":{"line":612,"column":59},"line":612,"code":"  it('should prevent traversing with /..%c0%aftest-file.txt', async () => {\n    await expectStatus('/..%c0%aftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%af..%c0%aftest-file.txt","suites":[],"updatePoint":{"line":616,"column":67},"line":616,"code":"  it('should prevent traversing with /..%c0%af..%c0%aftest-file.txt', async () => {\n    await expectStatus('/..%c0%af..%c0%aftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%af..%c0%af..%c0%aftest-file.txt","suites":[],"updatePoint":{"line":620,"column":75},"line":620,"code":"  it('should prevent traversing with /..%c0%af..%c0%af..%c0%aftest-file.txt', async () => {\n    await expectStatus('/..%c0%af..%c0%af..%c0%aftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%af..%c0%af..%c0%af..%c0%aftest-file.txt","suites":[],"updatePoint":{"line":624,"column":83},"line":624,"code":"  it('should prevent traversing with /..%c0%af..%c0%af..%c0%af..%c0%aftest-file.txt', async () => {\n    await expectStatus('/..%c0%af..%c0%af..%c0%af..%c0%aftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%af..%c0%af..%c0%af..%c0%af..%c0%aftest-file.txt","suites":[],"updatePoint":{"line":628,"column":91},"line":628,"code":"  it('should prevent traversing with /..%c0%af..%c0%af..%c0%af..%c0%af..%c0%aftest-file.txt', async () => {\n    await expectStatus('/..%c0%af..%c0%af..%c0%af..%c0%af..%c0%aftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%aftest-file.txt","suites":[],"updatePoint":{"line":632,"column":99},"line":632,"code":"  it('should prevent traversing with /..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%aftest-file.txt', async () => {\n    await expectStatus(\n      '/..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%aftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%aftest-file.txt","suites":[],"updatePoint":{"line":638,"column":107},"line":638,"code":"  it('should prevent traversing with /..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%aftest-file.txt', async () => {\n    await expectStatus(\n      '/..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%aftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%aftest-file.txt","suites":[],"updatePoint":{"line":644,"column":115},"line":644,"code":"  it('should prevent traversing with /..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%aftest-file.txt', async () => {\n    await expectStatus(\n      '/..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%aftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae/test-file.txt","suites":[],"updatePoint":{"line":650,"column":64},"line":650,"code":"  it('should prevent traversing with /%c0%ae%c0%ae/test-file.txt', async () => {\n    await expectStatus('/%c0%ae%c0%ae/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae/%c0%ae%c0%ae/test-file.txt","suites":[],"updatePoint":{"line":654,"column":77},"line":654,"code":"  it('should prevent traversing with /%c0%ae%c0%ae/%c0%ae%c0%ae/test-file.txt', async () => {\n    await expectStatus('/%c0%ae%c0%ae/%c0%ae%c0%ae/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/test-file.txt","suites":[],"updatePoint":{"line":658,"column":90},"line":658,"code":"  it('should prevent traversing with /%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/test-file.txt', async () => {\n    await expectStatus('/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/test-file.txt","suites":[],"updatePoint":{"line":662,"column":103},"line":662,"code":"  it('should prevent traversing with /%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/test-file.txt","suites":[],"updatePoint":{"line":668,"column":116},"line":668,"code":"  it('should prevent traversing with /%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/test-file.txt","suites":[],"updatePoint":{"line":674,"column":129},"line":674,"code":"  it('should prevent traversing with /%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/test-file.txt","suites":[],"updatePoint":{"line":680,"column":142},"line":680,"code":"  it('should prevent traversing with /%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/test-file.txt","suites":[],"updatePoint":{"line":686,"column":155},"line":686,"code":"  it('should prevent traversing with /%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae%c0%aftest-file.txt","suites":[],"updatePoint":{"line":692,"column":69},"line":692,"code":"  it('should prevent traversing with /%c0%ae%c0%ae%c0%aftest-file.txt', async () => {\n    await expectStatus('/%c0%ae%c0%ae%c0%aftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%aftest-file.txt","suites":[],"updatePoint":{"line":696,"column":87},"line":696,"code":"  it('should prevent traversing with /%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%aftest-file.txt', async () => {\n    await expectStatus('/%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%aftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%aftest-file.txt","suites":[],"updatePoint":{"line":700,"column":105},"line":700,"code":"  it('should prevent traversing with /%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%aftest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%aftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%aftest-file.txt","suites":[],"updatePoint":{"line":706,"column":123},"line":706,"code":"  it('should prevent traversing with /%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%aftest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%aftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%aftest-file.txt","suites":[],"updatePoint":{"line":712,"column":141},"line":712,"code":"  it('should prevent traversing with /%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%aftest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%aftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%aftest-file.txt","suites":[],"updatePoint":{"line":718,"column":159},"line":718,"code":"  it('should prevent traversing with /%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%aftest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%aftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%aftest-file.txt","suites":[],"updatePoint":{"line":724,"column":177},"line":724,"code":"  it('should prevent traversing with /%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%aftest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%aftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%aftest-file.txt","suites":[],"updatePoint":{"line":730,"column":195},"line":730,"code":"  it('should prevent traversing with /%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%aftest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%aftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%25c0%25aftest-file.txt","suites":[],"updatePoint":{"line":736,"column":63},"line":736,"code":"  it('should prevent traversing with /..%25c0%25aftest-file.txt', async () => {\n    await expectStatus('/..%25c0%25aftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%25c0%25af..%25c0%25aftest-file.txt","suites":[],"updatePoint":{"line":740,"column":75},"line":740,"code":"  it('should prevent traversing with /..%25c0%25af..%25c0%25aftest-file.txt', async () => {\n    await expectStatus('/..%25c0%25af..%25c0%25aftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%25c0%25af..%25c0%25af..%25c0%25aftest-file.txt","suites":[],"updatePoint":{"line":744,"column":87},"line":744,"code":"  it('should prevent traversing with /..%25c0%25af..%25c0%25af..%25c0%25aftest-file.txt', async () => {\n    await expectStatus('/..%25c0%25af..%25c0%25af..%25c0%25aftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25aftest-file.txt","suites":[],"updatePoint":{"line":748,"column":99},"line":748,"code":"  it('should prevent traversing with /..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25aftest-file.txt', async () => {\n    await expectStatus(\n      '/..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25aftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25aftest-file.txt","suites":[],"updatePoint":{"line":754,"column":111},"line":754,"code":"  it('should prevent traversing with /..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25aftest-file.txt', async () => {\n    await expectStatus(\n      '/..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25aftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25aftest-file.txt","suites":[],"updatePoint":{"line":760,"column":123},"line":760,"code":"  it('should prevent traversing with /..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25aftest-file.txt', async () => {\n    await expectStatus(\n      '/..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25aftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25aftest-file.txt","suites":[],"updatePoint":{"line":766,"column":135},"line":766,"code":"  it('should prevent traversing with /..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25aftest-file.txt', async () => {\n    await expectStatus(\n      '/..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25aftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25aftest-file.txt","suites":[],"updatePoint":{"line":772,"column":147},"line":772,"code":"  it('should prevent traversing with /..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25aftest-file.txt', async () => {\n    await expectStatus(\n      '/..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25af..%25c0%25aftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae/test-file.txt","suites":[],"updatePoint":{"line":778,"column":72},"line":778,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae/test-file.txt', async () => {\n    await expectStatus('/%25c0%25ae%25c0%25ae/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/test-file.txt","suites":[],"updatePoint":{"line":782,"column":93},"line":782,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/test-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/test-file.txt","suites":[],"updatePoint":{"line":788,"column":114},"line":788,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/test-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/test-file.txt","suites":[],"updatePoint":{"line":794,"column":135},"line":794,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/test-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/test-file.txt","suites":[],"updatePoint":{"line":800,"column":156},"line":800,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/test-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/test-file.txt","suites":[],"updatePoint":{"line":806,"column":177},"line":806,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/test-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/test-file.txt","suites":[],"updatePoint":{"line":812,"column":198},"line":812,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/test-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/test-file.txt","suites":[],"updatePoint":{"line":818,"column":219},"line":818,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/test-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/%25c0%25ae%25c0%25ae/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt","suites":[],"updatePoint":{"line":824,"column":81},"line":824,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt', async () => {\n    await expectStatus('/%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt","suites":[],"updatePoint":{"line":828,"column":111},"line":828,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt","suites":[],"updatePoint":{"line":834,"column":141},"line":834,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt","suites":[],"updatePoint":{"line":840,"column":171},"line":840,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt","suites":[],"updatePoint":{"line":846,"column":201},"line":846,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt","suites":[],"updatePoint":{"line":852,"column":231},"line":852,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt","suites":[],"updatePoint":{"line":858,"column":261},"line":858,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt","suites":[],"updatePoint":{"line":864,"column":291},"line":864,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25af%25c0%25ae%25c0%25ae%25c0%25aftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c1%9ctest-file.txt","suites":[],"updatePoint":{"line":870,"column":59},"line":870,"code":"  it('should prevent traversing with /..%c1%9ctest-file.txt', async () => {\n    await expectStatus('/..%c1%9ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c1%9c..%c1%9ctest-file.txt","suites":[],"updatePoint":{"line":874,"column":67},"line":874,"code":"  it('should prevent traversing with /..%c1%9c..%c1%9ctest-file.txt', async () => {\n    await expectStatus('/..%c1%9c..%c1%9ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c1%9c..%c1%9c..%c1%9ctest-file.txt","suites":[],"updatePoint":{"line":878,"column":75},"line":878,"code":"  it('should prevent traversing with /..%c1%9c..%c1%9c..%c1%9ctest-file.txt', async () => {\n    await expectStatus('/..%c1%9c..%c1%9c..%c1%9ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c1%9c..%c1%9c..%c1%9c..%c1%9ctest-file.txt","suites":[],"updatePoint":{"line":882,"column":83},"line":882,"code":"  it('should prevent traversing with /..%c1%9c..%c1%9c..%c1%9c..%c1%9ctest-file.txt', async () => {\n    await expectStatus('/..%c1%9c..%c1%9c..%c1%9c..%c1%9ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9ctest-file.txt","suites":[],"updatePoint":{"line":886,"column":91},"line":886,"code":"  it('should prevent traversing with /..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9ctest-file.txt', async () => {\n    await expectStatus('/..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9ctest-file.txt","suites":[],"updatePoint":{"line":890,"column":99},"line":890,"code":"  it('should prevent traversing with /..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9ctest-file.txt', async () => {\n    await expectStatus(\n      '/..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9ctest-file.txt","suites":[],"updatePoint":{"line":896,"column":107},"line":896,"code":"  it('should prevent traversing with /..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9ctest-file.txt', async () => {\n    await expectStatus(\n      '/..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9ctest-file.txt","suites":[],"updatePoint":{"line":902,"column":115},"line":902,"code":"  it('should prevent traversing with /..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9ctest-file.txt', async () => {\n    await expectStatus(\n      '/..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9c..%c1%9ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae\\test-file.txt","suites":[],"updatePoint":{"line":908,"column":65},"line":908,"code":"  it('should prevent traversing with /%c0%ae%c0%ae\\\\test-file.txt', async () => {\n    await expectStatus('/%c0%ae%c0%ae\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae\\%c0%ae%c0%ae\\test-file.txt","suites":[],"updatePoint":{"line":912,"column":79},"line":912,"code":"  it('should prevent traversing with /%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\test-file.txt', async () => {\n    await expectStatus('/%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae\\%c0%ae%c0%ae\\%c0%ae%c0%ae\\test-file.txt","suites":[],"updatePoint":{"line":916,"column":93},"line":916,"code":"  it('should prevent traversing with /%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae\\%c0%ae%c0%ae\\%c0%ae%c0%ae\\%c0%ae%c0%ae\\test-file.txt","suites":[],"updatePoint":{"line":922,"column":107},"line":922,"code":"  it('should prevent traversing with /%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae\\%c0%ae%c0%ae\\%c0%ae%c0%ae\\%c0%ae%c0%ae\\%c0%ae%c0%ae\\test-file.txt","suites":[],"updatePoint":{"line":928,"column":121},"line":928,"code":"  it('should prevent traversing with /%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae\\%c0%ae%c0%ae\\%c0%ae%c0%ae\\%c0%ae%c0%ae\\%c0%ae%c0%ae\\%c0%ae%c0%ae\\test-file.txt","suites":[],"updatePoint":{"line":934,"column":135},"line":934,"code":"  it('should prevent traversing with /%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae\\%c0%ae%c0%ae\\%c0%ae%c0%ae\\%c0%ae%c0%ae\\%c0%ae%c0%ae\\%c0%ae%c0%ae\\%c0%ae%c0%ae\\test-file.txt","suites":[],"updatePoint":{"line":940,"column":149},"line":940,"code":"  it('should prevent traversing with /%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae\\%c0%ae%c0%ae\\%c0%ae%c0%ae\\%c0%ae%c0%ae\\%c0%ae%c0%ae\\%c0%ae%c0%ae\\%c0%ae%c0%ae\\%c0%ae%c0%ae\\test-file.txt","suites":[],"updatePoint":{"line":946,"column":163},"line":946,"code":"  it('should prevent traversing with /%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\%c0%ae%c0%ae\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae%c1%9ctest-file.txt","suites":[],"updatePoint":{"line":952,"column":69},"line":952,"code":"  it('should prevent traversing with /%c0%ae%c0%ae%c1%9ctest-file.txt', async () => {\n    await expectStatus('/%c0%ae%c0%ae%c1%9ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9ctest-file.txt","suites":[],"updatePoint":{"line":956,"column":87},"line":956,"code":"  it('should prevent traversing with /%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9ctest-file.txt', async () => {\n    await expectStatus('/%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9ctest-file.txt","suites":[],"updatePoint":{"line":960,"column":105},"line":960,"code":"  it('should prevent traversing with /%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9ctest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9ctest-file.txt","suites":[],"updatePoint":{"line":966,"column":123},"line":966,"code":"  it('should prevent traversing with /%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9ctest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9ctest-file.txt","suites":[],"updatePoint":{"line":972,"column":141},"line":972,"code":"  it('should prevent traversing with /%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9ctest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9ctest-file.txt","suites":[],"updatePoint":{"line":978,"column":159},"line":978,"code":"  it('should prevent traversing with /%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9ctest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9ctest-file.txt","suites":[],"updatePoint":{"line":984,"column":177},"line":984,"code":"  it('should prevent traversing with /%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9ctest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9ctest-file.txt","suites":[],"updatePoint":{"line":990,"column":195},"line":990,"code":"  it('should prevent traversing with /%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9ctest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9c%c0%ae%c0%ae%c1%9ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%25c1%259ctest-file.txt","suites":[],"updatePoint":{"line":996,"column":63},"line":996,"code":"  it('should prevent traversing with /..%25c1%259ctest-file.txt', async () => {\n    await expectStatus('/..%25c1%259ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%25c1%259c..%25c1%259ctest-file.txt","suites":[],"updatePoint":{"line":1000,"column":75},"line":1000,"code":"  it('should prevent traversing with /..%25c1%259c..%25c1%259ctest-file.txt', async () => {\n    await expectStatus('/..%25c1%259c..%25c1%259ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%25c1%259c..%25c1%259c..%25c1%259ctest-file.txt","suites":[],"updatePoint":{"line":1004,"column":87},"line":1004,"code":"  it('should prevent traversing with /..%25c1%259c..%25c1%259c..%25c1%259ctest-file.txt', async () => {\n    await expectStatus('/..%25c1%259c..%25c1%259c..%25c1%259ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259ctest-file.txt","suites":[],"updatePoint":{"line":1008,"column":99},"line":1008,"code":"  it('should prevent traversing with /..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259ctest-file.txt', async () => {\n    await expectStatus(\n      '/..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259ctest-file.txt","suites":[],"updatePoint":{"line":1014,"column":111},"line":1014,"code":"  it('should prevent traversing with /..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259ctest-file.txt', async () => {\n    await expectStatus(\n      '/..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259ctest-file.txt","suites":[],"updatePoint":{"line":1020,"column":123},"line":1020,"code":"  it('should prevent traversing with /..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259ctest-file.txt', async () => {\n    await expectStatus(\n      '/..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259ctest-file.txt","suites":[],"updatePoint":{"line":1026,"column":135},"line":1026,"code":"  it('should prevent traversing with /..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259ctest-file.txt', async () => {\n    await expectStatus(\n      '/..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259ctest-file.txt","suites":[],"updatePoint":{"line":1032,"column":147},"line":1032,"code":"  it('should prevent traversing with /..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259ctest-file.txt', async () => {\n    await expectStatus(\n      '/..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259c..%25c1%259ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae\\test-file.txt","suites":[],"updatePoint":{"line":1038,"column":73},"line":1038,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae\\\\test-file.txt', async () => {\n    await expectStatus('/%25c0%25ae%25c0%25ae\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\test-file.txt","suites":[],"updatePoint":{"line":1042,"column":95},"line":1042,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\test-file.txt","suites":[],"updatePoint":{"line":1048,"column":117},"line":1048,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\test-file.txt","suites":[],"updatePoint":{"line":1054,"column":139},"line":1054,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\test-file.txt","suites":[],"updatePoint":{"line":1060,"column":161},"line":1060,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\test-file.txt","suites":[],"updatePoint":{"line":1066,"column":183},"line":1066,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\test-file.txt","suites":[],"updatePoint":{"line":1072,"column":205},"line":1072,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\%25c0%25ae%25c0%25ae\\test-file.txt","suites":[],"updatePoint":{"line":1078,"column":227},"line":1078,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\%25c0%25ae%25c0%25ae\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt","suites":[],"updatePoint":{"line":1084,"column":81},"line":1084,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt', async () => {\n    await expectStatus('/%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt","suites":[],"updatePoint":{"line":1088,"column":111},"line":1088,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt","suites":[],"updatePoint":{"line":1094,"column":141},"line":1094,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt","suites":[],"updatePoint":{"line":1100,"column":171},"line":1100,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt","suites":[],"updatePoint":{"line":1106,"column":201},"line":1106,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt","suites":[],"updatePoint":{"line":1112,"column":231},"line":1112,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt","suites":[],"updatePoint":{"line":1118,"column":261},"line":1118,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt","suites":[],"updatePoint":{"line":1124,"column":291},"line":1124,"code":"  it('should prevent traversing with /%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt', async () => {\n    await expectStatus(\n      '/%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259c%25c0%25ae%25c0%25ae%25c1%259ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%%32%66test-file.txt","suites":[],"updatePoint":{"line":1130,"column":60},"line":1130,"code":"  it('should prevent traversing with /..%%32%66test-file.txt', async () => {\n    await expectStatus('/..%%32%66test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%%32%66..%%32%66test-file.txt","suites":[],"updatePoint":{"line":1134,"column":69},"line":1134,"code":"  it('should prevent traversing with /..%%32%66..%%32%66test-file.txt', async () => {\n    await expectStatus('/..%%32%66..%%32%66test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%%32%66..%%32%66..%%32%66test-file.txt","suites":[],"updatePoint":{"line":1138,"column":78},"line":1138,"code":"  it('should prevent traversing with /..%%32%66..%%32%66..%%32%66test-file.txt', async () => {\n    await expectStatus('/..%%32%66..%%32%66..%%32%66test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%%32%66..%%32%66..%%32%66..%%32%66test-file.txt","suites":[],"updatePoint":{"line":1142,"column":87},"line":1142,"code":"  it('should prevent traversing with /..%%32%66..%%32%66..%%32%66..%%32%66test-file.txt', async () => {\n    await expectStatus('/..%%32%66..%%32%66..%%32%66..%%32%66test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66test-file.txt","suites":[],"updatePoint":{"line":1146,"column":96},"line":1146,"code":"  it('should prevent traversing with /..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66test-file.txt', async () => {\n    await expectStatus(\n      '/..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66test-file.txt","suites":[],"updatePoint":{"line":1152,"column":105},"line":1152,"code":"  it('should prevent traversing with /..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66test-file.txt', async () => {\n    await expectStatus(\n      '/..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66test-file.txt","suites":[],"updatePoint":{"line":1158,"column":114},"line":1158,"code":"  it('should prevent traversing with /..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66test-file.txt', async () => {\n    await expectStatus(\n      '/..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66test-file.txt","suites":[],"updatePoint":{"line":1164,"column":123},"line":1164,"code":"  it('should prevent traversing with /..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66test-file.txt', async () => {\n    await expectStatus(\n      '/..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66..%%32%66test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65/test-file.txt","suites":[],"updatePoint":{"line":1170,"column":66},"line":1170,"code":"  it('should prevent traversing with /%%32%65%%32%65/test-file.txt', async () => {\n    await expectStatus('/%%32%65%%32%65/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/test-file.txt","suites":[],"updatePoint":{"line":1174,"column":81},"line":1174,"code":"  it('should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/test-file.txt', async () => {\n    await expectStatus('/%%32%65%%32%65/%%32%65%%32%65/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt","suites":[],"updatePoint":{"line":1178,"column":96},"line":1178,"code":"  it('should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt","suites":[],"updatePoint":{"line":1184,"column":111},"line":1184,"code":"  it('should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt","suites":[],"updatePoint":{"line":1190,"column":126},"line":1190,"code":"  it('should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt","suites":[],"updatePoint":{"line":1196,"column":141},"line":1196,"code":"  it('should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt","suites":[],"updatePoint":{"line":1202,"column":156},"line":1202,"code":"  it('should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt","suites":[],"updatePoint":{"line":1208,"column":171},"line":1208,"code":"  it('should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65%%32%66test-file.txt","suites":[],"updatePoint":{"line":1214,"column":72},"line":1214,"code":"  it('should prevent traversing with /%%32%65%%32%65%%32%66test-file.txt', async () => {\n    await expectStatus('/%%32%65%%32%65%%32%66test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66test-file.txt","suites":[],"updatePoint":{"line":1218,"column":93},"line":1218,"code":"  it('should prevent traversing with /%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66test-file.txt","suites":[],"updatePoint":{"line":1224,"column":114},"line":1224,"code":"  it('should prevent traversing with /%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66test-file.txt","suites":[],"updatePoint":{"line":1230,"column":135},"line":1230,"code":"  it('should prevent traversing with /%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66test-file.txt","suites":[],"updatePoint":{"line":1236,"column":156},"line":1236,"code":"  it('should prevent traversing with /%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66test-file.txt","suites":[],"updatePoint":{"line":1242,"column":177},"line":1242,"code":"  it('should prevent traversing with /%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66test-file.txt","suites":[],"updatePoint":{"line":1248,"column":198},"line":1248,"code":"  it('should prevent traversing with /%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66test-file.txt","suites":[],"updatePoint":{"line":1254,"column":219},"line":1254,"code":"  it('should prevent traversing with /%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66%%32%65%%32%65%%32%66test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%%35%63test-file.txt","suites":[],"updatePoint":{"line":1260,"column":60},"line":1260,"code":"  it('should prevent traversing with /..%%35%63test-file.txt', async () => {\n    await expectStatus('/..%%35%63test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%%35%63..%%35%63test-file.txt","suites":[],"updatePoint":{"line":1264,"column":69},"line":1264,"code":"  it('should prevent traversing with /..%%35%63..%%35%63test-file.txt', async () => {\n    await expectStatus('/..%%35%63..%%35%63test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%%35%63..%%35%63..%%35%63test-file.txt","suites":[],"updatePoint":{"line":1268,"column":78},"line":1268,"code":"  it('should prevent traversing with /..%%35%63..%%35%63..%%35%63test-file.txt', async () => {\n    await expectStatus('/..%%35%63..%%35%63..%%35%63test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%%35%63..%%35%63..%%35%63..%%35%63test-file.txt","suites":[],"updatePoint":{"line":1272,"column":87},"line":1272,"code":"  it('should prevent traversing with /..%%35%63..%%35%63..%%35%63..%%35%63test-file.txt', async () => {\n    await expectStatus('/..%%35%63..%%35%63..%%35%63..%%35%63test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63test-file.txt","suites":[],"updatePoint":{"line":1276,"column":96},"line":1276,"code":"  it('should prevent traversing with /..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63test-file.txt', async () => {\n    await expectStatus(\n      '/..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63test-file.txt","suites":[],"updatePoint":{"line":1282,"column":105},"line":1282,"code":"  it('should prevent traversing with /..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63test-file.txt', async () => {\n    await expectStatus(\n      '/..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63test-file.txt","suites":[],"updatePoint":{"line":1288,"column":114},"line":1288,"code":"  it('should prevent traversing with /..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63test-file.txt', async () => {\n    await expectStatus(\n      '/..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63test-file.txt","suites":[],"updatePoint":{"line":1294,"column":123},"line":1294,"code":"  it('should prevent traversing with /..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63test-file.txt', async () => {\n    await expectStatus(\n      '/..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63..%%35%63test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65/test-file.txt","suites":[],"updatePoint":{"line":1300,"column":66},"line":1300,"code":"  it('should prevent traversing with /%%32%65%%32%65/test-file.txt', async () => {\n    await expectStatus('/%%32%65%%32%65/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/test-file.txt","suites":[],"updatePoint":{"line":1304,"column":81},"line":1304,"code":"  it('should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/test-file.txt', async () => {\n    await expectStatus('/%%32%65%%32%65/%%32%65%%32%65/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt","suites":[],"updatePoint":{"line":1308,"column":96},"line":1308,"code":"  it('should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt","suites":[],"updatePoint":{"line":1314,"column":111},"line":1314,"code":"  it('should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt","suites":[],"updatePoint":{"line":1320,"column":126},"line":1320,"code":"  it('should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt","suites":[],"updatePoint":{"line":1326,"column":141},"line":1326,"code":"  it('should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt","suites":[],"updatePoint":{"line":1332,"column":156},"line":1332,"code":"  it('should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt","suites":[],"updatePoint":{"line":1338,"column":171},"line":1338,"code":"  it('should prevent traversing with /%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65%%35%63test-file.txt","suites":[],"updatePoint":{"line":1344,"column":72},"line":1344,"code":"  it('should prevent traversing with /%%32%65%%32%65%%35%63test-file.txt', async () => {\n    await expectStatus('/%%32%65%%32%65%%35%63test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63test-file.txt","suites":[],"updatePoint":{"line":1348,"column":93},"line":1348,"code":"  it('should prevent traversing with /%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63test-file.txt","suites":[],"updatePoint":{"line":1354,"column":114},"line":1354,"code":"  it('should prevent traversing with /%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63test-file.txt","suites":[],"updatePoint":{"line":1360,"column":135},"line":1360,"code":"  it('should prevent traversing with /%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63test-file.txt","suites":[],"updatePoint":{"line":1366,"column":156},"line":1366,"code":"  it('should prevent traversing with /%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63test-file.txt","suites":[],"updatePoint":{"line":1372,"column":177},"line":1372,"code":"  it('should prevent traversing with /%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63test-file.txt","suites":[],"updatePoint":{"line":1378,"column":198},"line":1378,"code":"  it('should prevent traversing with /%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63test-file.txt","suites":[],"updatePoint":{"line":1384,"column":219},"line":1384,"code":"  it('should prevent traversing with /%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63test-file.txt', async () => {\n    await expectStatus(\n      '/%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63%%32%65%%32%65%%35%63test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../test-file.txt","suites":[],"updatePoint":{"line":1390,"column":54},"line":1390,"code":"  it('should prevent traversing with /../test-file.txt', async () => {\n    await expectStatus('/../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../../test-file.txt","suites":[],"updatePoint":{"line":1394,"column":57},"line":1394,"code":"  it('should prevent traversing with /../../test-file.txt', async () => {\n    await expectStatus('/../../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../../../test-file.txt","suites":[],"updatePoint":{"line":1398,"column":60},"line":1398,"code":"  it('should prevent traversing with /../../../test-file.txt', async () => {\n    await expectStatus('/../../../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../../../../test-file.txt","suites":[],"updatePoint":{"line":1402,"column":63},"line":1402,"code":"  it('should prevent traversing with /../../../../test-file.txt', async () => {\n    await expectStatus('/../../../../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../../../../../test-file.txt","suites":[],"updatePoint":{"line":1406,"column":66},"line":1406,"code":"  it('should prevent traversing with /../../../../../test-file.txt', async () => {\n    await expectStatus('/../../../../../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../../../../../../test-file.txt","suites":[],"updatePoint":{"line":1410,"column":69},"line":1410,"code":"  it('should prevent traversing with /../../../../../../test-file.txt', async () => {\n    await expectStatus('/../../../../../../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../../../../../../../test-file.txt","suites":[],"updatePoint":{"line":1414,"column":72},"line":1414,"code":"  it('should prevent traversing with /../../../../../../../test-file.txt', async () => {\n    await expectStatus('/../../../../../../../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../../../../../../../../test-file.txt","suites":[],"updatePoint":{"line":1418,"column":75},"line":1418,"code":"  it('should prevent traversing with /../../../../../../../../test-file.txt', async () => {\n    await expectStatus('/../../../../../../../../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2ftest-file.txt","suites":[],"updatePoint":{"line":1422,"column":56},"line":1422,"code":"  it('should prevent traversing with /..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2f..%2ftest-file.txt","suites":[],"updatePoint":{"line":1426,"column":61},"line":1426,"code":"  it('should prevent traversing with /..%2f..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2f..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2f..%2f..%2ftest-file.txt","suites":[],"updatePoint":{"line":1430,"column":66},"line":1430,"code":"  it('should prevent traversing with /..%2f..%2f..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2f..%2f..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2f..%2f..%2f..%2ftest-file.txt","suites":[],"updatePoint":{"line":1434,"column":71},"line":1434,"code":"  it('should prevent traversing with /..%2f..%2f..%2f..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2f..%2f..%2f..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2f..%2f..%2f..%2f..%2ftest-file.txt","suites":[],"updatePoint":{"line":1438,"column":76},"line":1438,"code":"  it('should prevent traversing with /..%2f..%2f..%2f..%2f..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2f..%2f..%2f..%2f..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt","suites":[],"updatePoint":{"line":1442,"column":81},"line":1442,"code":"  it('should prevent traversing with /..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2f..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt","suites":[],"updatePoint":{"line":1446,"column":86},"line":1446,"code":"  it('should prevent traversing with /..%2f..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2f..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt","suites":[],"updatePoint":{"line":1450,"column":91},"line":1450,"code":"  it('should prevent traversing with /..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":1454,"column":58},"line":1454,"code":"  it('should prevent traversing with /%2e%2e/test-file.txt', async () => {\n    await expectStatus('/%2e%2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":1458,"column":65},"line":1458,"code":"  it('should prevent traversing with /%2e%2e/%2e%2e/test-file.txt', async () => {\n    await expectStatus('/%2e%2e/%2e%2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":1462,"column":72},"line":1462,"code":"  it('should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/test-file.txt', async () => {\n    await expectStatus('/%2e%2e/%2e%2e/%2e%2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":1466,"column":79},"line":1466,"code":"  it('should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt', async () => {\n    await expectStatus('/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":1470,"column":86},"line":1470,"code":"  it('should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt', async () => {\n    await expectStatus('/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":1474,"column":93},"line":1474,"code":"  it('should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":1480,"column":100},"line":1480,"code":"  it('should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":1486,"column":107},"line":1486,"code":"  it('should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":1492,"column":60},"line":1492,"code":"  it('should prevent traversing with /%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus('/%2e%2e%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":1496,"column":69},"line":1496,"code":"  it('should prevent traversing with /%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus('/%2e%2e%2f%2e%2e%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":1500,"column":78},"line":1500,"code":"  it('should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus('/%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":1504,"column":87},"line":1504,"code":"  it('should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus('/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":1508,"column":96},"line":1508,"code":"  it('should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":1514,"column":105},"line":1514,"code":"  it('should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":1520,"column":114},"line":1520,"code":"  it('should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":1526,"column":123},"line":1526,"code":"  it('should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252ftest-file.txt","suites":[],"updatePoint":{"line":1532,"column":58},"line":1532,"code":"  it('should prevent traversing with /..%252ftest-file.txt', async () => {\n    await expectStatus('/..%252ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252f..%252ftest-file.txt","suites":[],"updatePoint":{"line":1536,"column":65},"line":1536,"code":"  it('should prevent traversing with /..%252f..%252ftest-file.txt', async () => {\n    await expectStatus('/..%252f..%252ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252f..%252f..%252ftest-file.txt","suites":[],"updatePoint":{"line":1540,"column":72},"line":1540,"code":"  it('should prevent traversing with /..%252f..%252f..%252ftest-file.txt', async () => {\n    await expectStatus('/..%252f..%252f..%252ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252f..%252f..%252f..%252ftest-file.txt","suites":[],"updatePoint":{"line":1544,"column":79},"line":1544,"code":"  it('should prevent traversing with /..%252f..%252f..%252f..%252ftest-file.txt', async () => {\n    await expectStatus('/..%252f..%252f..%252f..%252ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252f..%252f..%252f..%252f..%252ftest-file.txt","suites":[],"updatePoint":{"line":1548,"column":86},"line":1548,"code":"  it('should prevent traversing with /..%252f..%252f..%252f..%252f..%252ftest-file.txt', async () => {\n    await expectStatus('/..%252f..%252f..%252f..%252f..%252ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt","suites":[],"updatePoint":{"line":1552,"column":93},"line":1552,"code":"  it('should prevent traversing with /..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252f..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt","suites":[],"updatePoint":{"line":1558,"column":100},"line":1558,"code":"  it('should prevent traversing with /..%252f..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/..%252f..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt","suites":[],"updatePoint":{"line":1564,"column":107},"line":1564,"code":"  it('should prevent traversing with /..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":1570,"column":62},"line":1570,"code":"  it('should prevent traversing with /%252e%252e/test-file.txt', async () => {\n    await expectStatus('/%252e%252e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":1574,"column":73},"line":1574,"code":"  it('should prevent traversing with /%252e%252e/%252e%252e/test-file.txt', async () => {\n    await expectStatus('/%252e%252e/%252e%252e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":1578,"column":84},"line":1578,"code":"  it('should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/test-file.txt', async () => {\n    await expectStatus('/%252e%252e/%252e%252e/%252e%252e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":1582,"column":95},"line":1582,"code":"  it('should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":1588,"column":106},"line":1588,"code":"  it('should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":1594,"column":117},"line":1594,"code":"  it('should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":1600,"column":128},"line":1600,"code":"  it('should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":1606,"column":139},"line":1606,"code":"  it('should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":1612,"column":66},"line":1612,"code":"  it('should prevent traversing with /%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus('/%252e%252e%252ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252f%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":1616,"column":81},"line":1616,"code":"  it('should prevent traversing with /%252e%252e%252f%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus('/%252e%252e%252f%252e%252e%252ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":1620,"column":96},"line":1620,"code":"  it('should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":1626,"column":111},"line":1626,"code":"  it('should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":1632,"column":126},"line":1632,"code":"  it('should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":1638,"column":141},"line":1638,"code":"  it('should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":1644,"column":156},"line":1644,"code":"  it('should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":1650,"column":171},"line":1650,"code":"  it('should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\test-file.txt","suites":[],"updatePoint":{"line":1656,"column":55},"line":1656,"code":"  it('should prevent traversing with /..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\test-file.txt","suites":[],"updatePoint":{"line":1660,"column":59},"line":1660,"code":"  it('should prevent traversing with /..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":1664,"column":63},"line":1664,"code":"  it('should prevent traversing with /..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":1668,"column":67},"line":1668,"code":"  it('should prevent traversing with /..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\..\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":1672,"column":71},"line":1672,"code":"  it('should prevent traversing with /..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":1676,"column":75},"line":1676,"code":"  it('should prevent traversing with /..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":1680,"column":79},"line":1680,"code":"  it('should prevent traversing with /..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\..\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":1684,"column":83},"line":1684,"code":"  it('should prevent traversing with /..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5ctest-file.txt","suites":[],"updatePoint":{"line":1688,"column":56},"line":1688,"code":"  it('should prevent traversing with /..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5c..%5ctest-file.txt","suites":[],"updatePoint":{"line":1692,"column":61},"line":1692,"code":"  it('should prevent traversing with /..%5c..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5c..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5c..%5c..%5ctest-file.txt","suites":[],"updatePoint":{"line":1696,"column":66},"line":1696,"code":"  it('should prevent traversing with /..%5c..%5c..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5c..%5c..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5c..%5c..%5c..%5ctest-file.txt","suites":[],"updatePoint":{"line":1700,"column":71},"line":1700,"code":"  it('should prevent traversing with /..%5c..%5c..%5c..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5c..%5c..%5c..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5c..%5c..%5c..%5c..%5ctest-file.txt","suites":[],"updatePoint":{"line":1704,"column":76},"line":1704,"code":"  it('should prevent traversing with /..%5c..%5c..%5c..%5c..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5c..%5c..%5c..%5c..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt","suites":[],"updatePoint":{"line":1708,"column":81},"line":1708,"code":"  it('should prevent traversing with /..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5c..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt","suites":[],"updatePoint":{"line":1712,"column":86},"line":1712,"code":"  it('should prevent traversing with /..%5c..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5c..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt","suites":[],"updatePoint":{"line":1716,"column":91},"line":1716,"code":"  it('should prevent traversing with /..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":1720,"column":59},"line":1720,"code":"  it('should prevent traversing with /%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus('/%2e%2e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":1724,"column":67},"line":1724,"code":"  it('should prevent traversing with /%2e%2e\\\\%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus('/%2e%2e\\\\%2e%2e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\%2e%2e\\%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":1728,"column":75},"line":1728,"code":"  it('should prevent traversing with /%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus('/%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":1732,"column":83},"line":1732,"code":"  it('should prevent traversing with /%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus('/%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":1736,"column":91},"line":1736,"code":"  it('should prevent traversing with /%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus('/%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":1740,"column":99},"line":1740,"code":"  it('should prevent traversing with /%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":1746,"column":107},"line":1746,"code":"  it('should prevent traversing with /%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":1752,"column":115},"line":1752,"code":"  it('should prevent traversing with /%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":1758,"column":60},"line":1758,"code":"  it('should prevent traversing with /%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus('/%2e%2e%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":1762,"column":69},"line":1762,"code":"  it('should prevent traversing with /%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus('/%2e%2e%5c%2e%2e%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":1766,"column":78},"line":1766,"code":"  it('should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus('/%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":1770,"column":87},"line":1770,"code":"  it('should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus('/%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":1774,"column":96},"line":1774,"code":"  it('should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":1780,"column":105},"line":1780,"code":"  it('should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":1786,"column":114},"line":1786,"code":"  it('should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":1792,"column":123},"line":1792,"code":"  it('should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255ctest-file.txt","suites":[],"updatePoint":{"line":1798,"column":58},"line":1798,"code":"  it('should prevent traversing with /..%255ctest-file.txt', async () => {\n    await expectStatus('/..%255ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255c..%255ctest-file.txt","suites":[],"updatePoint":{"line":1802,"column":65},"line":1802,"code":"  it('should prevent traversing with /..%255c..%255ctest-file.txt', async () => {\n    await expectStatus('/..%255c..%255ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255c..%255c..%255ctest-file.txt","suites":[],"updatePoint":{"line":1806,"column":72},"line":1806,"code":"  it('should prevent traversing with /..%255c..%255c..%255ctest-file.txt', async () => {\n    await expectStatus('/..%255c..%255c..%255ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255c..%255c..%255c..%255ctest-file.txt","suites":[],"updatePoint":{"line":1810,"column":79},"line":1810,"code":"  it('should prevent traversing with /..%255c..%255c..%255c..%255ctest-file.txt', async () => {\n    await expectStatus('/..%255c..%255c..%255c..%255ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255c..%255c..%255c..%255c..%255ctest-file.txt","suites":[],"updatePoint":{"line":1814,"column":86},"line":1814,"code":"  it('should prevent traversing with /..%255c..%255c..%255c..%255c..%255ctest-file.txt', async () => {\n    await expectStatus('/..%255c..%255c..%255c..%255c..%255ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt","suites":[],"updatePoint":{"line":1818,"column":93},"line":1818,"code":"  it('should prevent traversing with /..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255c..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt","suites":[],"updatePoint":{"line":1824,"column":100},"line":1824,"code":"  it('should prevent traversing with /..%255c..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/..%255c..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255c..%255c..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt","suites":[],"updatePoint":{"line":1830,"column":107},"line":1830,"code":"  it('should prevent traversing with /..%255c..%255c..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/..%255c..%255c..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":1836,"column":63},"line":1836,"code":"  it('should prevent traversing with /%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus('/%252e%252e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":1840,"column":75},"line":1840,"code":"  it('should prevent traversing with /%252e%252e\\\\%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus('/%252e%252e\\\\%252e%252e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\%252e%252e\\%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":1844,"column":87},"line":1844,"code":"  it('should prevent traversing with /%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus('/%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":1848,"column":99},"line":1848,"code":"  it('should prevent traversing with /%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":1854,"column":111},"line":1854,"code":"  it('should prevent traversing with /%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":1860,"column":123},"line":1860,"code":"  it('should prevent traversing with /%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":1866,"column":135},"line":1866,"code":"  it('should prevent traversing with /%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":1872,"column":147},"line":1872,"code":"  it('should prevent traversing with /%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":1878,"column":66},"line":1878,"code":"  it('should prevent traversing with /%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus('/%252e%252e%255ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255c%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":1882,"column":81},"line":1882,"code":"  it('should prevent traversing with /%252e%252e%255c%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus('/%252e%252e%255c%252e%252e%255ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":1886,"column":96},"line":1886,"code":"  it('should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":1892,"column":111},"line":1892,"code":"  it('should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":1898,"column":126},"line":1898,"code":"  it('should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":1904,"column":141},"line":1904,"code":"  it('should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":1910,"column":156},"line":1910,"code":"  it('should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":1916,"column":171},"line":1916,"code":"  it('should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../test-file.txt","suites":[],"updatePoint":{"line":1922,"column":54},"line":1922,"code":"  it('should prevent traversing with /../test-file.txt', async () => {\n    await expectStatus('/../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../../test-file.txt","suites":[],"updatePoint":{"line":1926,"column":57},"line":1926,"code":"  it('should prevent traversing with /../../test-file.txt', async () => {\n    await expectStatus('/../../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../../../test-file.txt","suites":[],"updatePoint":{"line":1930,"column":60},"line":1930,"code":"  it('should prevent traversing with /../../../test-file.txt', async () => {\n    await expectStatus('/../../../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../../../../test-file.txt","suites":[],"updatePoint":{"line":1934,"column":63},"line":1934,"code":"  it('should prevent traversing with /../../../../test-file.txt', async () => {\n    await expectStatus('/../../../../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../../../../../test-file.txt","suites":[],"updatePoint":{"line":1938,"column":66},"line":1938,"code":"  it('should prevent traversing with /../../../../../test-file.txt', async () => {\n    await expectStatus('/../../../../../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../../../../../../test-file.txt","suites":[],"updatePoint":{"line":1942,"column":69},"line":1942,"code":"  it('should prevent traversing with /../../../../../../test-file.txt', async () => {\n    await expectStatus('/../../../../../../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../../../../../../../test-file.txt","suites":[],"updatePoint":{"line":1946,"column":72},"line":1946,"code":"  it('should prevent traversing with /../../../../../../../test-file.txt', async () => {\n    await expectStatus('/../../../../../../../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../../../../../../../../test-file.txt","suites":[],"updatePoint":{"line":1950,"column":75},"line":1950,"code":"  it('should prevent traversing with /../../../../../../../../test-file.txt', async () => {\n    await expectStatus('/../../../../../../../../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2ftest-file.txt","suites":[],"updatePoint":{"line":1954,"column":56},"line":1954,"code":"  it('should prevent traversing with /..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2f..%2ftest-file.txt","suites":[],"updatePoint":{"line":1958,"column":61},"line":1958,"code":"  it('should prevent traversing with /..%2f..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2f..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2f..%2f..%2ftest-file.txt","suites":[],"updatePoint":{"line":1962,"column":66},"line":1962,"code":"  it('should prevent traversing with /..%2f..%2f..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2f..%2f..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2f..%2f..%2f..%2ftest-file.txt","suites":[],"updatePoint":{"line":1966,"column":71},"line":1966,"code":"  it('should prevent traversing with /..%2f..%2f..%2f..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2f..%2f..%2f..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2f..%2f..%2f..%2f..%2ftest-file.txt","suites":[],"updatePoint":{"line":1970,"column":76},"line":1970,"code":"  it('should prevent traversing with /..%2f..%2f..%2f..%2f..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2f..%2f..%2f..%2f..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt","suites":[],"updatePoint":{"line":1974,"column":81},"line":1974,"code":"  it('should prevent traversing with /..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2f..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt","suites":[],"updatePoint":{"line":1978,"column":86},"line":1978,"code":"  it('should prevent traversing with /..%2f..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2f..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt","suites":[],"updatePoint":{"line":1982,"column":91},"line":1982,"code":"  it('should prevent traversing with /..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt', async () => {\n    await expectStatus('/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":1986,"column":58},"line":1986,"code":"  it('should prevent traversing with /%2e%2e/test-file.txt', async () => {\n    await expectStatus('/%2e%2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":1990,"column":65},"line":1990,"code":"  it('should prevent traversing with /%2e%2e/%2e%2e/test-file.txt', async () => {\n    await expectStatus('/%2e%2e/%2e%2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":1994,"column":72},"line":1994,"code":"  it('should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/test-file.txt', async () => {\n    await expectStatus('/%2e%2e/%2e%2e/%2e%2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":1998,"column":79},"line":1998,"code":"  it('should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt', async () => {\n    await expectStatus('/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":2002,"column":86},"line":2002,"code":"  it('should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt', async () => {\n    await expectStatus('/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":2006,"column":93},"line":2006,"code":"  it('should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":2012,"column":100},"line":2012,"code":"  it('should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt","suites":[],"updatePoint":{"line":2018,"column":107},"line":2018,"code":"  it('should prevent traversing with /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":2024,"column":60},"line":2024,"code":"  it('should prevent traversing with /%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus('/%2e%2e%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":2028,"column":69},"line":2028,"code":"  it('should prevent traversing with /%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus('/%2e%2e%2f%2e%2e%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":2032,"column":78},"line":2032,"code":"  it('should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus('/%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":2036,"column":87},"line":2036,"code":"  it('should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus('/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":2040,"column":96},"line":2040,"code":"  it('should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":2046,"column":105},"line":2046,"code":"  it('should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":2052,"column":114},"line":2052,"code":"  it('should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":2058,"column":123},"line":2058,"code":"  it('should prevent traversing with /%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252ftest-file.txt","suites":[],"updatePoint":{"line":2064,"column":58},"line":2064,"code":"  it('should prevent traversing with /..%252ftest-file.txt', async () => {\n    await expectStatus('/..%252ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252f..%252ftest-file.txt","suites":[],"updatePoint":{"line":2068,"column":65},"line":2068,"code":"  it('should prevent traversing with /..%252f..%252ftest-file.txt', async () => {\n    await expectStatus('/..%252f..%252ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252f..%252f..%252ftest-file.txt","suites":[],"updatePoint":{"line":2072,"column":72},"line":2072,"code":"  it('should prevent traversing with /..%252f..%252f..%252ftest-file.txt', async () => {\n    await expectStatus('/..%252f..%252f..%252ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252f..%252f..%252f..%252ftest-file.txt","suites":[],"updatePoint":{"line":2076,"column":79},"line":2076,"code":"  it('should prevent traversing with /..%252f..%252f..%252f..%252ftest-file.txt', async () => {\n    await expectStatus('/..%252f..%252f..%252f..%252ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252f..%252f..%252f..%252f..%252ftest-file.txt","suites":[],"updatePoint":{"line":2080,"column":86},"line":2080,"code":"  it('should prevent traversing with /..%252f..%252f..%252f..%252f..%252ftest-file.txt', async () => {\n    await expectStatus('/..%252f..%252f..%252f..%252f..%252ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt","suites":[],"updatePoint":{"line":2084,"column":93},"line":2084,"code":"  it('should prevent traversing with /..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252f..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt","suites":[],"updatePoint":{"line":2090,"column":100},"line":2090,"code":"  it('should prevent traversing with /..%252f..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/..%252f..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt","suites":[],"updatePoint":{"line":2096,"column":107},"line":2096,"code":"  it('should prevent traversing with /..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":2102,"column":62},"line":2102,"code":"  it('should prevent traversing with /%252e%252e/test-file.txt', async () => {\n    await expectStatus('/%252e%252e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":2106,"column":73},"line":2106,"code":"  it('should prevent traversing with /%252e%252e/%252e%252e/test-file.txt', async () => {\n    await expectStatus('/%252e%252e/%252e%252e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":2110,"column":84},"line":2110,"code":"  it('should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/test-file.txt', async () => {\n    await expectStatus('/%252e%252e/%252e%252e/%252e%252e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":2114,"column":95},"line":2114,"code":"  it('should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":2120,"column":106},"line":2120,"code":"  it('should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":2126,"column":117},"line":2126,"code":"  it('should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":2132,"column":128},"line":2132,"code":"  it('should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt","suites":[],"updatePoint":{"line":2138,"column":139},"line":2138,"code":"  it('should prevent traversing with /%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":2144,"column":66},"line":2144,"code":"  it('should prevent traversing with /%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus('/%252e%252e%252ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252f%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":2148,"column":81},"line":2148,"code":"  it('should prevent traversing with /%252e%252e%252f%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus('/%252e%252e%252f%252e%252e%252ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":2152,"column":96},"line":2152,"code":"  it('should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":2158,"column":111},"line":2158,"code":"  it('should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":2164,"column":126},"line":2164,"code":"  it('should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":2170,"column":141},"line":2170,"code":"  it('should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":2176,"column":156},"line":2176,"code":"  it('should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt","suites":[],"updatePoint":{"line":2182,"column":171},"line":2182,"code":"  it('should prevent traversing with /%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\test-file.txt","suites":[],"updatePoint":{"line":2188,"column":55},"line":2188,"code":"  it('should prevent traversing with /..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2192,"column":59},"line":2192,"code":"  it('should prevent traversing with /..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2196,"column":63},"line":2196,"code":"  it('should prevent traversing with /..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2200,"column":67},"line":2200,"code":"  it('should prevent traversing with /..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\..\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2204,"column":71},"line":2204,"code":"  it('should prevent traversing with /..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2208,"column":75},"line":2208,"code":"  it('should prevent traversing with /..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2212,"column":79},"line":2212,"code":"  it('should prevent traversing with /..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\..\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2216,"column":83},"line":2216,"code":"  it('should prevent traversing with /..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5ctest-file.txt","suites":[],"updatePoint":{"line":2220,"column":56},"line":2220,"code":"  it('should prevent traversing with /..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5c..%5ctest-file.txt","suites":[],"updatePoint":{"line":2224,"column":61},"line":2224,"code":"  it('should prevent traversing with /..%5c..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5c..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5c..%5c..%5ctest-file.txt","suites":[],"updatePoint":{"line":2228,"column":66},"line":2228,"code":"  it('should prevent traversing with /..%5c..%5c..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5c..%5c..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5c..%5c..%5c..%5ctest-file.txt","suites":[],"updatePoint":{"line":2232,"column":71},"line":2232,"code":"  it('should prevent traversing with /..%5c..%5c..%5c..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5c..%5c..%5c..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5c..%5c..%5c..%5c..%5ctest-file.txt","suites":[],"updatePoint":{"line":2236,"column":76},"line":2236,"code":"  it('should prevent traversing with /..%5c..%5c..%5c..%5c..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5c..%5c..%5c..%5c..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt","suites":[],"updatePoint":{"line":2240,"column":81},"line":2240,"code":"  it('should prevent traversing with /..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5c..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt","suites":[],"updatePoint":{"line":2244,"column":86},"line":2244,"code":"  it('should prevent traversing with /..%5c..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5c..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt","suites":[],"updatePoint":{"line":2248,"column":91},"line":2248,"code":"  it('should prevent traversing with /..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt', async () => {\n    await expectStatus('/..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":2252,"column":59},"line":2252,"code":"  it('should prevent traversing with /%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus('/%2e%2e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":2256,"column":67},"line":2256,"code":"  it('should prevent traversing with /%2e%2e\\\\%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus('/%2e%2e\\\\%2e%2e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\%2e%2e\\%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":2260,"column":75},"line":2260,"code":"  it('should prevent traversing with /%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus('/%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":2264,"column":83},"line":2264,"code":"  it('should prevent traversing with /%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus('/%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":2268,"column":91},"line":2268,"code":"  it('should prevent traversing with /%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus('/%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":2272,"column":99},"line":2272,"code":"  it('should prevent traversing with /%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":2278,"column":107},"line":2278,"code":"  it('should prevent traversing with /%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\%2e%2e\\test-file.txt","suites":[],"updatePoint":{"line":2284,"column":115},"line":2284,"code":"  it('should prevent traversing with /%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\%2e%2e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":2290,"column":60},"line":2290,"code":"  it('should prevent traversing with /%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus('/%2e%2e%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":2294,"column":69},"line":2294,"code":"  it('should prevent traversing with /%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus('/%2e%2e%5c%2e%2e%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":2298,"column":78},"line":2298,"code":"  it('should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus('/%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":2302,"column":87},"line":2302,"code":"  it('should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus('/%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":2306,"column":96},"line":2306,"code":"  it('should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":2312,"column":105},"line":2312,"code":"  it('should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":2318,"column":114},"line":2318,"code":"  it('should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":2324,"column":123},"line":2324,"code":"  it('should prevent traversing with /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255ctest-file.txt","suites":[],"updatePoint":{"line":2330,"column":58},"line":2330,"code":"  it('should prevent traversing with /..%255ctest-file.txt', async () => {\n    await expectStatus('/..%255ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255c..%255ctest-file.txt","suites":[],"updatePoint":{"line":2334,"column":65},"line":2334,"code":"  it('should prevent traversing with /..%255c..%255ctest-file.txt', async () => {\n    await expectStatus('/..%255c..%255ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255c..%255c..%255ctest-file.txt","suites":[],"updatePoint":{"line":2338,"column":72},"line":2338,"code":"  it('should prevent traversing with /..%255c..%255c..%255ctest-file.txt', async () => {\n    await expectStatus('/..%255c..%255c..%255ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255c..%255c..%255c..%255ctest-file.txt","suites":[],"updatePoint":{"line":2342,"column":79},"line":2342,"code":"  it('should prevent traversing with /..%255c..%255c..%255c..%255ctest-file.txt', async () => {\n    await expectStatus('/..%255c..%255c..%255c..%255ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255c..%255c..%255c..%255c..%255ctest-file.txt","suites":[],"updatePoint":{"line":2346,"column":86},"line":2346,"code":"  it('should prevent traversing with /..%255c..%255c..%255c..%255c..%255ctest-file.txt', async () => {\n    await expectStatus('/..%255c..%255c..%255c..%255c..%255ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt","suites":[],"updatePoint":{"line":2350,"column":93},"line":2350,"code":"  it('should prevent traversing with /..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255c..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt","suites":[],"updatePoint":{"line":2356,"column":100},"line":2356,"code":"  it('should prevent traversing with /..%255c..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/..%255c..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%255c..%255c..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt","suites":[],"updatePoint":{"line":2362,"column":107},"line":2362,"code":"  it('should prevent traversing with /..%255c..%255c..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/..%255c..%255c..%255c..%255c..%255c..%255c..%255c..%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":2368,"column":63},"line":2368,"code":"  it('should prevent traversing with /%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus('/%252e%252e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":2372,"column":75},"line":2372,"code":"  it('should prevent traversing with /%252e%252e\\\\%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus('/%252e%252e\\\\%252e%252e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\%252e%252e\\%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":2376,"column":87},"line":2376,"code":"  it('should prevent traversing with /%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus('/%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":2380,"column":99},"line":2380,"code":"  it('should prevent traversing with /%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":2386,"column":111},"line":2386,"code":"  it('should prevent traversing with /%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":2392,"column":123},"line":2392,"code":"  it('should prevent traversing with /%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":2398,"column":135},"line":2398,"code":"  it('should prevent traversing with /%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\%252e%252e\\test-file.txt","suites":[],"updatePoint":{"line":2404,"column":147},"line":2404,"code":"  it('should prevent traversing with /%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\%252e%252e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":2410,"column":66},"line":2410,"code":"  it('should prevent traversing with /%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus('/%252e%252e%255ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255c%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":2414,"column":81},"line":2414,"code":"  it('should prevent traversing with /%252e%252e%255c%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus('/%252e%252e%255c%252e%252e%255ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":2418,"column":96},"line":2418,"code":"  it('should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":2424,"column":111},"line":2424,"code":"  it('should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":2430,"column":126},"line":2430,"code":"  it('should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":2436,"column":141},"line":2436,"code":"  it('should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":2442,"column":156},"line":2442,"code":"  it('should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt","suites":[],"updatePoint":{"line":2448,"column":171},"line":2448,"code":"  it('should prevent traversing with /%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt', async () => {\n    await expectStatus(\n      '/%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e%255ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\../test-file.txt","suites":[],"updatePoint":{"line":2454,"column":56},"line":2454,"code":"  it('should prevent traversing with /\\\\../test-file.txt', async () => {\n    await expectStatus('/\\\\../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\../\\../test-file.txt","suites":[],"updatePoint":{"line":2458,"column":61},"line":2458,"code":"  it('should prevent traversing with /\\\\../\\\\../test-file.txt', async () => {\n    await expectStatus('/\\\\../\\\\../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\../\\../\\../test-file.txt","suites":[],"updatePoint":{"line":2462,"column":66},"line":2462,"code":"  it('should prevent traversing with /\\\\../\\\\../\\\\../test-file.txt', async () => {\n    await expectStatus('/\\\\../\\\\../\\\\../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\../\\../\\../\\../test-file.txt","suites":[],"updatePoint":{"line":2466,"column":71},"line":2466,"code":"  it('should prevent traversing with /\\\\../\\\\../\\\\../\\\\../test-file.txt', async () => {\n    await expectStatus('/\\\\../\\\\../\\\\../\\\\../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\../\\../\\../\\../\\../test-file.txt","suites":[],"updatePoint":{"line":2470,"column":76},"line":2470,"code":"  it('should prevent traversing with /\\\\../\\\\../\\\\../\\\\../\\\\../test-file.txt', async () => {\n    await expectStatus('/\\\\../\\\\../\\\\../\\\\../\\\\../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\../\\../\\../\\../\\../\\../test-file.txt","suites":[],"updatePoint":{"line":2474,"column":81},"line":2474,"code":"  it('should prevent traversing with /\\\\../\\\\../\\\\../\\\\../\\\\../\\\\../test-file.txt', async () => {\n    await expectStatus('/\\\\../\\\\../\\\\../\\\\../\\\\../\\\\../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\../\\../\\../\\../\\../\\../\\../test-file.txt","suites":[],"updatePoint":{"line":2478,"column":86},"line":2478,"code":"  it('should prevent traversing with /\\\\../\\\\../\\\\../\\\\../\\\\../\\\\../\\\\../test-file.txt', async () => {\n    await expectStatus('/\\\\../\\\\../\\\\../\\\\../\\\\../\\\\../\\\\../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\../\\../\\../\\../\\../\\../\\../\\../test-file.txt","suites":[],"updatePoint":{"line":2482,"column":91},"line":2482,"code":"  it('should prevent traversing with /\\\\../\\\\../\\\\../\\\\../\\\\../\\\\../\\\\../\\\\../test-file.txt', async () => {\n    await expectStatus('/\\\\../\\\\../\\\\../\\\\../\\\\../\\\\../\\\\../\\\\../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with //..\\test-file.txt","suites":[],"updatePoint":{"line":2486,"column":56},"line":2486,"code":"  it('should prevent traversing with //..\\\\test-file.txt', async () => {\n    await expectStatus('//..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with //..\\/..\\test-file.txt","suites":[],"updatePoint":{"line":2490,"column":61},"line":2490,"code":"  it('should prevent traversing with //..\\\\/..\\\\test-file.txt', async () => {\n    await expectStatus('//..\\\\/..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with //..\\/..\\/..\\test-file.txt","suites":[],"updatePoint":{"line":2494,"column":66},"line":2494,"code":"  it('should prevent traversing with //..\\\\/..\\\\/..\\\\test-file.txt', async () => {\n    await expectStatus('//..\\\\/..\\\\/..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with //..\\/..\\/..\\/..\\test-file.txt","suites":[],"updatePoint":{"line":2498,"column":71},"line":2498,"code":"  it('should prevent traversing with //..\\\\/..\\\\/..\\\\/..\\\\test-file.txt', async () => {\n    await expectStatus('//..\\\\/..\\\\/..\\\\/..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with //..\\/..\\/..\\/..\\/..\\test-file.txt","suites":[],"updatePoint":{"line":2502,"column":76},"line":2502,"code":"  it('should prevent traversing with //..\\\\/..\\\\/..\\\\/..\\\\/..\\\\test-file.txt', async () => {\n    await expectStatus('//..\\\\/..\\\\/..\\\\/..\\\\/..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with //..\\/..\\/..\\/..\\/..\\/..\\test-file.txt","suites":[],"updatePoint":{"line":2506,"column":81},"line":2506,"code":"  it('should prevent traversing with //..\\\\/..\\\\/..\\\\/..\\\\/..\\\\/..\\\\test-file.txt', async () => {\n    await expectStatus('//..\\\\/..\\\\/..\\\\/..\\\\/..\\\\/..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with //..\\/..\\/..\\/..\\/..\\/..\\/..\\test-file.txt","suites":[],"updatePoint":{"line":2510,"column":86},"line":2510,"code":"  it('should prevent traversing with //..\\\\/..\\\\/..\\\\/..\\\\/..\\\\/..\\\\/..\\\\test-file.txt', async () => {\n    await expectStatus('//..\\\\/..\\\\/..\\\\/..\\\\/..\\\\/..\\\\/..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with //..\\/..\\/..\\/..\\/..\\/..\\/..\\/..\\test-file.txt","suites":[],"updatePoint":{"line":2514,"column":91},"line":2514,"code":"  it('should prevent traversing with //..\\\\/..\\\\/..\\\\/..\\\\/..\\\\/..\\\\/..\\\\/..\\\\test-file.txt', async () => {\n    await expectStatus('//..\\\\/..\\\\/..\\\\/..\\\\/..\\\\/..\\\\/..\\\\/..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../test-file.txt","suites":[],"updatePoint":{"line":2518,"column":1081},"line":2518,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../test-file.txt","suites":[],"updatePoint":{"line":2524,"column":1084},"line":2524,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../test-file.txt","suites":[],"updatePoint":{"line":2530,"column":1087},"line":2530,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../test-file.txt","suites":[],"updatePoint":{"line":2536,"column":1090},"line":2536,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../test-file.txt","suites":[],"updatePoint":{"line":2542,"column":1093},"line":2542,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../../test-file.txt","suites":[],"updatePoint":{"line":2548,"column":1096},"line":2548,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../../test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../../../test-file.txt","suites":[],"updatePoint":{"line":2554,"column":1099},"line":2554,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../../../test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../../../../test-file.txt","suites":[],"updatePoint":{"line":2560,"column":1102},"line":2560,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../../../../test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\..\\test-file.txt","suites":[],"updatePoint":{"line":2566,"column":1083},"line":2566,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2572,"column":1087},"line":2572,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2578,"column":1091},"line":2578,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2584,"column":1095},"line":2584,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2590,"column":1099},"line":2590,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\..\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2596,"column":1103},"line":2596,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\..\\..\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2602,"column":1107},"line":2602,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\..\\..\\..\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2608,"column":1111},"line":2608,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../test-file.txt","suites":[],"updatePoint":{"line":2614,"column":314},"line":2614,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../test-file.txt","suites":[],"updatePoint":{"line":2620,"column":317},"line":2620,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../test-file.txt","suites":[],"updatePoint":{"line":2626,"column":320},"line":2626,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../test-file.txt","suites":[],"updatePoint":{"line":2632,"column":323},"line":2632,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../test-file.txt","suites":[],"updatePoint":{"line":2638,"column":326},"line":2638,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../../test-file.txt","suites":[],"updatePoint":{"line":2644,"column":329},"line":2644,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../../test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../../../test-file.txt","suites":[],"updatePoint":{"line":2650,"column":332},"line":2650,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../../../test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../../../../test-file.txt","suites":[],"updatePoint":{"line":2656,"column":335},"line":2656,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../../../../test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/../../../../../../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\..\\test-file.txt","suites":[],"updatePoint":{"line":2662,"column":316},"line":2662,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2668,"column":320},"line":2668,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2674,"column":324},"line":2674,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2680,"column":328},"line":2680,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2686,"column":332},"line":2686,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\..\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2692,"column":336},"line":2692,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\..\\..\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2698,"column":340},"line":2698,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\..\\..\\..\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2704,"column":344},"line":2704,"code":"  it('should prevent traversing with /AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.../test-file.txt","suites":[],"updatePoint":{"line":2710,"column":55},"line":2710,"code":"  it('should prevent traversing with /.../test-file.txt', async () => {\n    await expectStatus('/.../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.../.../test-file.txt","suites":[],"updatePoint":{"line":2714,"column":59},"line":2714,"code":"  it('should prevent traversing with /.../.../test-file.txt', async () => {\n    await expectStatus('/.../.../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.../.../.../test-file.txt","suites":[],"updatePoint":{"line":2718,"column":63},"line":2718,"code":"  it('should prevent traversing with /.../.../.../test-file.txt', async () => {\n    await expectStatus('/.../.../.../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.../.../.../.../test-file.txt","suites":[],"updatePoint":{"line":2722,"column":67},"line":2722,"code":"  it('should prevent traversing with /.../.../.../.../test-file.txt', async () => {\n    await expectStatus('/.../.../.../.../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.../.../.../.../.../test-file.txt","suites":[],"updatePoint":{"line":2726,"column":71},"line":2726,"code":"  it('should prevent traversing with /.../.../.../.../.../test-file.txt', async () => {\n    await expectStatus('/.../.../.../.../.../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.../.../.../.../.../.../test-file.txt","suites":[],"updatePoint":{"line":2730,"column":75},"line":2730,"code":"  it('should prevent traversing with /.../.../.../.../.../.../test-file.txt', async () => {\n    await expectStatus('/.../.../.../.../.../.../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.../.../.../.../.../.../.../test-file.txt","suites":[],"updatePoint":{"line":2734,"column":79},"line":2734,"code":"  it('should prevent traversing with /.../.../.../.../.../.../.../test-file.txt', async () => {\n    await expectStatus('/.../.../.../.../.../.../.../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.../.../.../.../.../.../.../.../test-file.txt","suites":[],"updatePoint":{"line":2738,"column":83},"line":2738,"code":"  it('should prevent traversing with /.../.../.../.../.../.../.../.../test-file.txt', async () => {\n    await expectStatus('/.../.../.../.../.../.../.../.../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /...\\test-file.txt","suites":[],"updatePoint":{"line":2742,"column":56},"line":2742,"code":"  it('should prevent traversing with /...\\\\test-file.txt', async () => {\n    await expectStatus('/...\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /...\\...\\test-file.txt","suites":[],"updatePoint":{"line":2746,"column":61},"line":2746,"code":"  it('should prevent traversing with /...\\\\...\\\\test-file.txt', async () => {\n    await expectStatus('/...\\\\...\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /...\\...\\...\\test-file.txt","suites":[],"updatePoint":{"line":2750,"column":66},"line":2750,"code":"  it('should prevent traversing with /...\\\\...\\\\...\\\\test-file.txt', async () => {\n    await expectStatus('/...\\\\...\\\\...\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /...\\...\\...\\...\\test-file.txt","suites":[],"updatePoint":{"line":2754,"column":71},"line":2754,"code":"  it('should prevent traversing with /...\\\\...\\\\...\\\\...\\\\test-file.txt', async () => {\n    await expectStatus('/...\\\\...\\\\...\\\\...\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /...\\...\\...\\...\\...\\test-file.txt","suites":[],"updatePoint":{"line":2758,"column":76},"line":2758,"code":"  it('should prevent traversing with /...\\\\...\\\\...\\\\...\\\\...\\\\test-file.txt', async () => {\n    await expectStatus('/...\\\\...\\\\...\\\\...\\\\...\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /...\\...\\...\\...\\...\\...\\test-file.txt","suites":[],"updatePoint":{"line":2762,"column":81},"line":2762,"code":"  it('should prevent traversing with /...\\\\...\\\\...\\\\...\\\\...\\\\...\\\\test-file.txt', async () => {\n    await expectStatus('/...\\\\...\\\\...\\\\...\\\\...\\\\...\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /...\\...\\...\\...\\...\\...\\...\\test-file.txt","suites":[],"updatePoint":{"line":2766,"column":86},"line":2766,"code":"  it('should prevent traversing with /...\\\\...\\\\...\\\\...\\\\...\\\\...\\\\...\\\\test-file.txt', async () => {\n    await expectStatus('/...\\\\...\\\\...\\\\...\\\\...\\\\...\\\\...\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /...\\...\\...\\...\\...\\...\\...\\...\\test-file.txt","suites":[],"updatePoint":{"line":2770,"column":91},"line":2770,"code":"  it('should prevent traversing with /...\\\\...\\\\...\\\\...\\\\...\\\\...\\\\...\\\\...\\\\test-file.txt', async () => {\n    await expectStatus('/...\\\\...\\\\...\\\\...\\\\...\\\\...\\\\...\\\\...\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..../test-file.txt","suites":[],"updatePoint":{"line":2774,"column":56},"line":2774,"code":"  it('should prevent traversing with /..../test-file.txt', async () => {\n    await expectStatus('/..../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..../..../test-file.txt","suites":[],"updatePoint":{"line":2778,"column":61},"line":2778,"code":"  it('should prevent traversing with /..../..../test-file.txt', async () => {\n    await expectStatus('/..../..../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..../..../..../test-file.txt","suites":[],"updatePoint":{"line":2782,"column":66},"line":2782,"code":"  it('should prevent traversing with /..../..../..../test-file.txt', async () => {\n    await expectStatus('/..../..../..../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..../..../..../..../test-file.txt","suites":[],"updatePoint":{"line":2786,"column":71},"line":2786,"code":"  it('should prevent traversing with /..../..../..../..../test-file.txt', async () => {\n    await expectStatus('/..../..../..../..../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..../..../..../..../..../test-file.txt","suites":[],"updatePoint":{"line":2790,"column":76},"line":2790,"code":"  it('should prevent traversing with /..../..../..../..../..../test-file.txt', async () => {\n    await expectStatus('/..../..../..../..../..../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..../..../..../..../..../..../test-file.txt","suites":[],"updatePoint":{"line":2794,"column":81},"line":2794,"code":"  it('should prevent traversing with /..../..../..../..../..../..../test-file.txt', async () => {\n    await expectStatus('/..../..../..../..../..../..../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..../..../..../..../..../..../..../test-file.txt","suites":[],"updatePoint":{"line":2798,"column":86},"line":2798,"code":"  it('should prevent traversing with /..../..../..../..../..../..../..../test-file.txt', async () => {\n    await expectStatus('/..../..../..../..../..../..../..../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..../..../..../..../..../..../..../..../test-file.txt","suites":[],"updatePoint":{"line":2802,"column":91},"line":2802,"code":"  it('should prevent traversing with /..../..../..../..../..../..../..../..../test-file.txt', async () => {\n    await expectStatus('/..../..../..../..../..../..../..../..../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /....\\test-file.txt","suites":[],"updatePoint":{"line":2806,"column":57},"line":2806,"code":"  it('should prevent traversing with /....\\\\test-file.txt', async () => {\n    await expectStatus('/....\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /....\\....\\test-file.txt","suites":[],"updatePoint":{"line":2810,"column":63},"line":2810,"code":"  it('should prevent traversing with /....\\\\....\\\\test-file.txt', async () => {\n    await expectStatus('/....\\\\....\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /....\\....\\....\\test-file.txt","suites":[],"updatePoint":{"line":2814,"column":69},"line":2814,"code":"  it('should prevent traversing with /....\\\\....\\\\....\\\\test-file.txt', async () => {\n    await expectStatus('/....\\\\....\\\\....\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /....\\....\\....\\....\\test-file.txt","suites":[],"updatePoint":{"line":2818,"column":75},"line":2818,"code":"  it('should prevent traversing with /....\\\\....\\\\....\\\\....\\\\test-file.txt', async () => {\n    await expectStatus('/....\\\\....\\\\....\\\\....\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /....\\....\\....\\....\\....\\test-file.txt","suites":[],"updatePoint":{"line":2822,"column":81},"line":2822,"code":"  it('should prevent traversing with /....\\\\....\\\\....\\\\....\\\\....\\\\test-file.txt', async () => {\n    await expectStatus('/....\\\\....\\\\....\\\\....\\\\....\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /....\\....\\....\\....\\....\\....\\test-file.txt","suites":[],"updatePoint":{"line":2826,"column":87},"line":2826,"code":"  it('should prevent traversing with /....\\\\....\\\\....\\\\....\\\\....\\\\....\\\\test-file.txt', async () => {\n    await expectStatus('/....\\\\....\\\\....\\\\....\\\\....\\\\....\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /....\\....\\....\\....\\....\\....\\....\\test-file.txt","suites":[],"updatePoint":{"line":2830,"column":93},"line":2830,"code":"  it('should prevent traversing with /....\\\\....\\\\....\\\\....\\\\....\\\\....\\\\....\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/....\\\\....\\\\....\\\\....\\\\....\\\\....\\\\....\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /....\\....\\....\\....\\....\\....\\....\\....\\test-file.txt","suites":[],"updatePoint":{"line":2836,"column":99},"line":2836,"code":"  it('should prevent traversing with /....\\\\....\\\\....\\\\....\\\\....\\\\....\\\\....\\\\....\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/....\\\\....\\\\....\\\\....\\\\....\\\\....\\\\....\\\\....\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /........................................................................../test-file.txt","suites":[],"updatePoint":{"line":2842,"column":126},"line":2842,"code":"  it('should prevent traversing with /........................................................................../test-file.txt', async () => {\n    await expectStatus(\n      '/........................................................................../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /........................................................................../../test-file.txt","suites":[],"updatePoint":{"line":2848,"column":129},"line":2848,"code":"  it('should prevent traversing with /........................................................................../../test-file.txt', async () => {\n    await expectStatus(\n      '/........................................................................../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /........................................................................../../../test-file.txt","suites":[],"updatePoint":{"line":2854,"column":132},"line":2854,"code":"  it('should prevent traversing with /........................................................................../../../test-file.txt', async () => {\n    await expectStatus(\n      '/........................................................................../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /........................................................................../../../../test-file.txt","suites":[],"updatePoint":{"line":2860,"column":135},"line":2860,"code":"  it('should prevent traversing with /........................................................................../../../../test-file.txt', async () => {\n    await expectStatus(\n      '/........................................................................../../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /........................................................................../../../../../test-file.txt","suites":[],"updatePoint":{"line":2866,"column":138},"line":2866,"code":"  it('should prevent traversing with /........................................................................../../../../../test-file.txt', async () => {\n    await expectStatus(\n      '/........................................................................../../../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /........................................................................../../../../../../test-file.txt","suites":[],"updatePoint":{"line":2872,"column":141},"line":2872,"code":"  it('should prevent traversing with /........................................................................../../../../../../test-file.txt', async () => {\n    await expectStatus(\n      '/........................................................................../../../../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /........................................................................../../../../../../../test-file.txt","suites":[],"updatePoint":{"line":2878,"column":144},"line":2878,"code":"  it('should prevent traversing with /........................................................................../../../../../../../test-file.txt', async () => {\n    await expectStatus(\n      '/........................................................................../../../../../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /........................................................................../../../../../../../../test-file.txt","suites":[],"updatePoint":{"line":2884,"column":147},"line":2884,"code":"  it('should prevent traversing with /........................................................................../../../../../../../../test-file.txt', async () => {\n    await expectStatus(\n      '/........................................................................../../../../../../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..........................................................................\\test-file.txt","suites":[],"updatePoint":{"line":2890,"column":127},"line":2890,"code":"  it('should prevent traversing with /..........................................................................\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/..........................................................................\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..........................................................................\\..\\test-file.txt","suites":[],"updatePoint":{"line":2896,"column":131},"line":2896,"code":"  it('should prevent traversing with /..........................................................................\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/..........................................................................\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..........................................................................\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2902,"column":135},"line":2902,"code":"  it('should prevent traversing with /..........................................................................\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/..........................................................................\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..........................................................................\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2908,"column":139},"line":2908,"code":"  it('should prevent traversing with /..........................................................................\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/..........................................................................\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..........................................................................\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2914,"column":143},"line":2914,"code":"  it('should prevent traversing with /..........................................................................\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/..........................................................................\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..........................................................................\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2920,"column":147},"line":2920,"code":"  it('should prevent traversing with /..........................................................................\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/..........................................................................\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..........................................................................\\..\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2926,"column":151},"line":2926,"code":"  it('should prevent traversing with /..........................................................................\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/..........................................................................\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..........................................................................\\..\\..\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":2932,"column":155},"line":2932,"code":"  it('should prevent traversing with /..........................................................................\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/..........................................................................\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%u2215test-file.txt","suites":[],"updatePoint":{"line":2938,"column":59},"line":2938,"code":"  it('should prevent traversing with /..%u2215test-file.txt', async () => {\n    await expectStatus('/..%u2215test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%u2215..%u2215test-file.txt","suites":[],"updatePoint":{"line":2942,"column":67},"line":2942,"code":"  it('should prevent traversing with /..%u2215..%u2215test-file.txt', async () => {\n    await expectStatus('/..%u2215..%u2215test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%u2215..%u2215..%u2215test-file.txt","suites":[],"updatePoint":{"line":2946,"column":75},"line":2946,"code":"  it('should prevent traversing with /..%u2215..%u2215..%u2215test-file.txt', async () => {\n    await expectStatus('/..%u2215..%u2215..%u2215test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%u2215..%u2215..%u2215..%u2215test-file.txt","suites":[],"updatePoint":{"line":2950,"column":83},"line":2950,"code":"  it('should prevent traversing with /..%u2215..%u2215..%u2215..%u2215test-file.txt', async () => {\n    await expectStatus('/..%u2215..%u2215..%u2215..%u2215test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%u2215..%u2215..%u2215..%u2215..%u2215test-file.txt","suites":[],"updatePoint":{"line":2954,"column":91},"line":2954,"code":"  it('should prevent traversing with /..%u2215..%u2215..%u2215..%u2215..%u2215test-file.txt', async () => {\n    await expectStatus('/..%u2215..%u2215..%u2215..%u2215..%u2215test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%u2215..%u2215..%u2215..%u2215..%u2215..%u2215test-file.txt","suites":[],"updatePoint":{"line":2958,"column":99},"line":2958,"code":"  it('should prevent traversing with /..%u2215..%u2215..%u2215..%u2215..%u2215..%u2215test-file.txt', async () => {\n    await expectStatus(\n      '/..%u2215..%u2215..%u2215..%u2215..%u2215..%u2215test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%u2215..%u2215..%u2215..%u2215..%u2215..%u2215..%u2215test-file.txt","suites":[],"updatePoint":{"line":2964,"column":107},"line":2964,"code":"  it('should prevent traversing with /..%u2215..%u2215..%u2215..%u2215..%u2215..%u2215..%u2215test-file.txt', async () => {\n    await expectStatus(\n      '/..%u2215..%u2215..%u2215..%u2215..%u2215..%u2215..%u2215test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%u2215..%u2215..%u2215..%u2215..%u2215..%u2215..%u2215..%u2215test-file.txt","suites":[],"updatePoint":{"line":2970,"column":115},"line":2970,"code":"  it('should prevent traversing with /..%u2215..%u2215..%u2215..%u2215..%u2215..%u2215..%u2215..%u2215test-file.txt', async () => {\n    await expectStatus(\n      '/..%u2215..%u2215..%u2215..%u2215..%u2215..%u2215..%u2215..%u2215test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e/test-file.txt","suites":[],"updatePoint":{"line":2976,"column":64},"line":2976,"code":"  it('should prevent traversing with /%uff0e%uff0e/test-file.txt', async () => {\n    await expectStatus('/%uff0e%uff0e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e/%uff0e%uff0e/test-file.txt","suites":[],"updatePoint":{"line":2980,"column":77},"line":2980,"code":"  it('should prevent traversing with /%uff0e%uff0e/%uff0e%uff0e/test-file.txt', async () => {\n    await expectStatus('/%uff0e%uff0e/%uff0e%uff0e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/test-file.txt","suites":[],"updatePoint":{"line":2984,"column":90},"line":2984,"code":"  it('should prevent traversing with /%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/test-file.txt', async () => {\n    await expectStatus('/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/test-file.txt","suites":[],"updatePoint":{"line":2988,"column":103},"line":2988,"code":"  it('should prevent traversing with /%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/test-file.txt","suites":[],"updatePoint":{"line":2994,"column":116},"line":2994,"code":"  it('should prevent traversing with /%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/test-file.txt","suites":[],"updatePoint":{"line":3000,"column":129},"line":3000,"code":"  it('should prevent traversing with /%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/test-file.txt","suites":[],"updatePoint":{"line":3006,"column":142},"line":3006,"code":"  it('should prevent traversing with /%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/test-file.txt","suites":[],"updatePoint":{"line":3012,"column":155},"line":3012,"code":"  it('should prevent traversing with /%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/%uff0e%uff0e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e%u2215test-file.txt","suites":[],"updatePoint":{"line":3018,"column":69},"line":3018,"code":"  it('should prevent traversing with /%uff0e%uff0e%u2215test-file.txt', async () => {\n    await expectStatus('/%uff0e%uff0e%u2215test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e%u2215%uff0e%uff0e%u2215test-file.txt","suites":[],"updatePoint":{"line":3022,"column":87},"line":3022,"code":"  it('should prevent traversing with /%uff0e%uff0e%u2215%uff0e%uff0e%u2215test-file.txt', async () => {\n    await expectStatus('/%uff0e%uff0e%u2215%uff0e%uff0e%u2215test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215test-file.txt","suites":[],"updatePoint":{"line":3026,"column":105},"line":3026,"code":"  it('should prevent traversing with /%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215test-file.txt","suites":[],"updatePoint":{"line":3032,"column":123},"line":3032,"code":"  it('should prevent traversing with /%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215test-file.txt","suites":[],"updatePoint":{"line":3038,"column":141},"line":3038,"code":"  it('should prevent traversing with /%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215test-file.txt","suites":[],"updatePoint":{"line":3044,"column":159},"line":3044,"code":"  it('should prevent traversing with /%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215test-file.txt","suites":[],"updatePoint":{"line":3050,"column":177},"line":3050,"code":"  it('should prevent traversing with /%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215test-file.txt","suites":[],"updatePoint":{"line":3056,"column":195},"line":3056,"code":"  it('should prevent traversing with /%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%u2216test-file.txt","suites":[],"updatePoint":{"line":3062,"column":59},"line":3062,"code":"  it('should prevent traversing with /..%u2216test-file.txt', async () => {\n    await expectStatus('/..%u2216test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%u2216..%u2216test-file.txt","suites":[],"updatePoint":{"line":3066,"column":67},"line":3066,"code":"  it('should prevent traversing with /..%u2216..%u2216test-file.txt', async () => {\n    await expectStatus('/..%u2216..%u2216test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%u2216..%u2216..%u2216test-file.txt","suites":[],"updatePoint":{"line":3070,"column":75},"line":3070,"code":"  it('should prevent traversing with /..%u2216..%u2216..%u2216test-file.txt', async () => {\n    await expectStatus('/..%u2216..%u2216..%u2216test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%u2216..%u2216..%u2216..%u2216test-file.txt","suites":[],"updatePoint":{"line":3074,"column":83},"line":3074,"code":"  it('should prevent traversing with /..%u2216..%u2216..%u2216..%u2216test-file.txt', async () => {\n    await expectStatus('/..%u2216..%u2216..%u2216..%u2216test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%u2216..%u2216..%u2216..%u2216..%u2216test-file.txt","suites":[],"updatePoint":{"line":3078,"column":91},"line":3078,"code":"  it('should prevent traversing with /..%u2216..%u2216..%u2216..%u2216..%u2216test-file.txt', async () => {\n    await expectStatus('/..%u2216..%u2216..%u2216..%u2216..%u2216test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%u2216..%u2216..%u2216..%u2216..%u2216..%u2216test-file.txt","suites":[],"updatePoint":{"line":3082,"column":99},"line":3082,"code":"  it('should prevent traversing with /..%u2216..%u2216..%u2216..%u2216..%u2216..%u2216test-file.txt', async () => {\n    await expectStatus(\n      '/..%u2216..%u2216..%u2216..%u2216..%u2216..%u2216test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%u2216..%u2216..%u2216..%u2216..%u2216..%u2216..%u2216test-file.txt","suites":[],"updatePoint":{"line":3088,"column":107},"line":3088,"code":"  it('should prevent traversing with /..%u2216..%u2216..%u2216..%u2216..%u2216..%u2216..%u2216test-file.txt', async () => {\n    await expectStatus(\n      '/..%u2216..%u2216..%u2216..%u2216..%u2216..%u2216..%u2216test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%u2216..%u2216..%u2216..%u2216..%u2216..%u2216..%u2216..%u2216test-file.txt","suites":[],"updatePoint":{"line":3094,"column":115},"line":3094,"code":"  it('should prevent traversing with /..%u2216..%u2216..%u2216..%u2216..%u2216..%u2216..%u2216..%u2216test-file.txt', async () => {\n    await expectStatus(\n      '/..%u2216..%u2216..%u2216..%u2216..%u2216..%u2216..%u2216..%u2216test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%uEFC8test-file.txt","suites":[],"updatePoint":{"line":3100,"column":59},"line":3100,"code":"  it('should prevent traversing with /..%uEFC8test-file.txt', async () => {\n    await expectStatus('/..%uEFC8test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%uEFC8..%uEFC8test-file.txt","suites":[],"updatePoint":{"line":3104,"column":67},"line":3104,"code":"  it('should prevent traversing with /..%uEFC8..%uEFC8test-file.txt', async () => {\n    await expectStatus('/..%uEFC8..%uEFC8test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%uEFC8..%uEFC8..%uEFC8test-file.txt","suites":[],"updatePoint":{"line":3108,"column":75},"line":3108,"code":"  it('should prevent traversing with /..%uEFC8..%uEFC8..%uEFC8test-file.txt', async () => {\n    await expectStatus('/..%uEFC8..%uEFC8..%uEFC8test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%uEFC8..%uEFC8..%uEFC8..%uEFC8test-file.txt","suites":[],"updatePoint":{"line":3112,"column":83},"line":3112,"code":"  it('should prevent traversing with /..%uEFC8..%uEFC8..%uEFC8..%uEFC8test-file.txt', async () => {\n    await expectStatus('/..%uEFC8..%uEFC8..%uEFC8..%uEFC8test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8test-file.txt","suites":[],"updatePoint":{"line":3116,"column":91},"line":3116,"code":"  it('should prevent traversing with /..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8test-file.txt', async () => {\n    await expectStatus('/..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8test-file.txt","suites":[],"updatePoint":{"line":3120,"column":99},"line":3120,"code":"  it('should prevent traversing with /..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8test-file.txt', async () => {\n    await expectStatus(\n      '/..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8test-file.txt","suites":[],"updatePoint":{"line":3126,"column":107},"line":3126,"code":"  it('should prevent traversing with /..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8test-file.txt', async () => {\n    await expectStatus(\n      '/..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8test-file.txt","suites":[],"updatePoint":{"line":3132,"column":115},"line":3132,"code":"  it('should prevent traversing with /..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8test-file.txt', async () => {\n    await expectStatus(\n      '/..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8..%uEFC8test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%uF025test-file.txt","suites":[],"updatePoint":{"line":3138,"column":59},"line":3138,"code":"  it('should prevent traversing with /..%uF025test-file.txt', async () => {\n    await expectStatus('/..%uF025test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%uF025..%uF025test-file.txt","suites":[],"updatePoint":{"line":3142,"column":67},"line":3142,"code":"  it('should prevent traversing with /..%uF025..%uF025test-file.txt', async () => {\n    await expectStatus('/..%uF025..%uF025test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%uF025..%uF025..%uF025test-file.txt","suites":[],"updatePoint":{"line":3146,"column":75},"line":3146,"code":"  it('should prevent traversing with /..%uF025..%uF025..%uF025test-file.txt', async () => {\n    await expectStatus('/..%uF025..%uF025..%uF025test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%uF025..%uF025..%uF025..%uF025test-file.txt","suites":[],"updatePoint":{"line":3150,"column":83},"line":3150,"code":"  it('should prevent traversing with /..%uF025..%uF025..%uF025..%uF025test-file.txt', async () => {\n    await expectStatus('/..%uF025..%uF025..%uF025..%uF025test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%uF025..%uF025..%uF025..%uF025..%uF025test-file.txt","suites":[],"updatePoint":{"line":3154,"column":91},"line":3154,"code":"  it('should prevent traversing with /..%uF025..%uF025..%uF025..%uF025..%uF025test-file.txt', async () => {\n    await expectStatus('/..%uF025..%uF025..%uF025..%uF025..%uF025test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%uF025..%uF025..%uF025..%uF025..%uF025..%uF025test-file.txt","suites":[],"updatePoint":{"line":3158,"column":99},"line":3158,"code":"  it('should prevent traversing with /..%uF025..%uF025..%uF025..%uF025..%uF025..%uF025test-file.txt', async () => {\n    await expectStatus(\n      '/..%uF025..%uF025..%uF025..%uF025..%uF025..%uF025test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%uF025..%uF025..%uF025..%uF025..%uF025..%uF025..%uF025test-file.txt","suites":[],"updatePoint":{"line":3164,"column":107},"line":3164,"code":"  it('should prevent traversing with /..%uF025..%uF025..%uF025..%uF025..%uF025..%uF025..%uF025test-file.txt', async () => {\n    await expectStatus(\n      '/..%uF025..%uF025..%uF025..%uF025..%uF025..%uF025..%uF025test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%uF025..%uF025..%uF025..%uF025..%uF025..%uF025..%uF025..%uF025test-file.txt","suites":[],"updatePoint":{"line":3170,"column":115},"line":3170,"code":"  it('should prevent traversing with /..%uF025..%uF025..%uF025..%uF025..%uF025..%uF025..%uF025..%uF025test-file.txt', async () => {\n    await expectStatus(\n      '/..%uF025..%uF025..%uF025..%uF025..%uF025..%uF025..%uF025..%uF025test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e\\test-file.txt","suites":[],"updatePoint":{"line":3176,"column":65},"line":3176,"code":"  it('should prevent traversing with /%uff0e%uff0e\\\\test-file.txt', async () => {\n    await expectStatus('/%uff0e%uff0e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e\\%uff0e%uff0e\\test-file.txt","suites":[],"updatePoint":{"line":3180,"column":79},"line":3180,"code":"  it('should prevent traversing with /%uff0e%uff0e\\\\%uff0e%uff0e\\\\test-file.txt', async () => {\n    await expectStatus('/%uff0e%uff0e\\\\%uff0e%uff0e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e\\%uff0e%uff0e\\%uff0e%uff0e\\test-file.txt","suites":[],"updatePoint":{"line":3184,"column":93},"line":3184,"code":"  it('should prevent traversing with /%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e\\%uff0e%uff0e\\%uff0e%uff0e\\%uff0e%uff0e\\test-file.txt","suites":[],"updatePoint":{"line":3190,"column":107},"line":3190,"code":"  it('should prevent traversing with /%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e\\%uff0e%uff0e\\%uff0e%uff0e\\%uff0e%uff0e\\%uff0e%uff0e\\test-file.txt","suites":[],"updatePoint":{"line":3196,"column":121},"line":3196,"code":"  it('should prevent traversing with /%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e\\%uff0e%uff0e\\%uff0e%uff0e\\%uff0e%uff0e\\%uff0e%uff0e\\%uff0e%uff0e\\test-file.txt","suites":[],"updatePoint":{"line":3202,"column":135},"line":3202,"code":"  it('should prevent traversing with /%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e\\%uff0e%uff0e\\%uff0e%uff0e\\%uff0e%uff0e\\%uff0e%uff0e\\%uff0e%uff0e\\%uff0e%uff0e\\test-file.txt","suites":[],"updatePoint":{"line":3208,"column":149},"line":3208,"code":"  it('should prevent traversing with /%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e\\%uff0e%uff0e\\%uff0e%uff0e\\%uff0e%uff0e\\%uff0e%uff0e\\%uff0e%uff0e\\%uff0e%uff0e\\%uff0e%uff0e\\test-file.txt","suites":[],"updatePoint":{"line":3214,"column":163},"line":3214,"code":"  it('should prevent traversing with /%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\%uff0e%uff0e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e%u2216test-file.txt","suites":[],"updatePoint":{"line":3220,"column":69},"line":3220,"code":"  it('should prevent traversing with /%uff0e%uff0e%u2216test-file.txt', async () => {\n    await expectStatus('/%uff0e%uff0e%u2216test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e%u2216%uff0e%uff0e%u2216test-file.txt","suites":[],"updatePoint":{"line":3224,"column":87},"line":3224,"code":"  it('should prevent traversing with /%uff0e%uff0e%u2216%uff0e%uff0e%u2216test-file.txt', async () => {\n    await expectStatus('/%uff0e%uff0e%u2216%uff0e%uff0e%u2216test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216test-file.txt","suites":[],"updatePoint":{"line":3228,"column":105},"line":3228,"code":"  it('should prevent traversing with /%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216test-file.txt","suites":[],"updatePoint":{"line":3234,"column":123},"line":3234,"code":"  it('should prevent traversing with /%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216test-file.txt","suites":[],"updatePoint":{"line":3240,"column":141},"line":3240,"code":"  it('should prevent traversing with /%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216test-file.txt","suites":[],"updatePoint":{"line":3246,"column":159},"line":3246,"code":"  it('should prevent traversing with /%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216test-file.txt","suites":[],"updatePoint":{"line":3252,"column":177},"line":3252,"code":"  it('should prevent traversing with /%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216test-file.txt","suites":[],"updatePoint":{"line":3258,"column":195},"line":3258,"code":"  it('should prevent traversing with /%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216test-file.txt', async () => {\n    await expectStatus(\n      '/%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..0x2ftest-file.txt","suites":[],"updatePoint":{"line":3264,"column":57},"line":3264,"code":"  it('should prevent traversing with /..0x2ftest-file.txt', async () => {\n    await expectStatus('/..0x2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..0x2f..0x2ftest-file.txt","suites":[],"updatePoint":{"line":3268,"column":63},"line":3268,"code":"  it('should prevent traversing with /..0x2f..0x2ftest-file.txt', async () => {\n    await expectStatus('/..0x2f..0x2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..0x2f..0x2f..0x2ftest-file.txt","suites":[],"updatePoint":{"line":3272,"column":69},"line":3272,"code":"  it('should prevent traversing with /..0x2f..0x2f..0x2ftest-file.txt', async () => {\n    await expectStatus('/..0x2f..0x2f..0x2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..0x2f..0x2f..0x2f..0x2ftest-file.txt","suites":[],"updatePoint":{"line":3276,"column":75},"line":3276,"code":"  it('should prevent traversing with /..0x2f..0x2f..0x2f..0x2ftest-file.txt', async () => {\n    await expectStatus('/..0x2f..0x2f..0x2f..0x2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..0x2f..0x2f..0x2f..0x2f..0x2ftest-file.txt","suites":[],"updatePoint":{"line":3280,"column":81},"line":3280,"code":"  it('should prevent traversing with /..0x2f..0x2f..0x2f..0x2f..0x2ftest-file.txt', async () => {\n    await expectStatus('/..0x2f..0x2f..0x2f..0x2f..0x2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..0x2f..0x2f..0x2f..0x2f..0x2f..0x2ftest-file.txt","suites":[],"updatePoint":{"line":3284,"column":87},"line":3284,"code":"  it('should prevent traversing with /..0x2f..0x2f..0x2f..0x2f..0x2f..0x2ftest-file.txt', async () => {\n    await expectStatus('/..0x2f..0x2f..0x2f..0x2f..0x2f..0x2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..0x2f..0x2f..0x2f..0x2f..0x2f..0x2f..0x2ftest-file.txt","suites":[],"updatePoint":{"line":3288,"column":93},"line":3288,"code":"  it('should prevent traversing with /..0x2f..0x2f..0x2f..0x2f..0x2f..0x2f..0x2ftest-file.txt', async () => {\n    await expectStatus(\n      '/..0x2f..0x2f..0x2f..0x2f..0x2f..0x2f..0x2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..0x2f..0x2f..0x2f..0x2f..0x2f..0x2f..0x2f..0x2ftest-file.txt","suites":[],"updatePoint":{"line":3294,"column":99},"line":3294,"code":"  it('should prevent traversing with /..0x2f..0x2f..0x2f..0x2f..0x2f..0x2f..0x2f..0x2ftest-file.txt', async () => {\n    await expectStatus(\n      '/..0x2f..0x2f..0x2f..0x2f..0x2f..0x2f..0x2f..0x2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e/test-file.txt","suites":[],"updatePoint":{"line":3300,"column":60},"line":3300,"code":"  it('should prevent traversing with /0x2e0x2e/test-file.txt', async () => {\n    await expectStatus('/0x2e0x2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e/0x2e0x2e/test-file.txt","suites":[],"updatePoint":{"line":3304,"column":69},"line":3304,"code":"  it('should prevent traversing with /0x2e0x2e/0x2e0x2e/test-file.txt', async () => {\n    await expectStatus('/0x2e0x2e/0x2e0x2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e/0x2e0x2e/0x2e0x2e/test-file.txt","suites":[],"updatePoint":{"line":3308,"column":78},"line":3308,"code":"  it('should prevent traversing with /0x2e0x2e/0x2e0x2e/0x2e0x2e/test-file.txt', async () => {\n    await expectStatus('/0x2e0x2e/0x2e0x2e/0x2e0x2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/test-file.txt","suites":[],"updatePoint":{"line":3312,"column":87},"line":3312,"code":"  it('should prevent traversing with /0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/test-file.txt', async () => {\n    await expectStatus('/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/test-file.txt","suites":[],"updatePoint":{"line":3316,"column":96},"line":3316,"code":"  it('should prevent traversing with /0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/test-file.txt', async () => {\n    await expectStatus(\n      '/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/test-file.txt","suites":[],"updatePoint":{"line":3322,"column":105},"line":3322,"code":"  it('should prevent traversing with /0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/test-file.txt', async () => {\n    await expectStatus(\n      '/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/test-file.txt","suites":[],"updatePoint":{"line":3328,"column":114},"line":3328,"code":"  it('should prevent traversing with /0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/test-file.txt', async () => {\n    await expectStatus(\n      '/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/test-file.txt","suites":[],"updatePoint":{"line":3334,"column":123},"line":3334,"code":"  it('should prevent traversing with /0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/test-file.txt', async () => {\n    await expectStatus(\n      '/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/0x2e0x2e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e0x2ftest-file.txt","suites":[],"updatePoint":{"line":3340,"column":63},"line":3340,"code":"  it('should prevent traversing with /0x2e0x2e0x2ftest-file.txt', async () => {\n    await expectStatus('/0x2e0x2e0x2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e0x2f0x2e0x2e0x2ftest-file.txt","suites":[],"updatePoint":{"line":3344,"column":75},"line":3344,"code":"  it('should prevent traversing with /0x2e0x2e0x2f0x2e0x2e0x2ftest-file.txt', async () => {\n    await expectStatus('/0x2e0x2e0x2f0x2e0x2e0x2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2ftest-file.txt","suites":[],"updatePoint":{"line":3348,"column":87},"line":3348,"code":"  it('should prevent traversing with /0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2ftest-file.txt', async () => {\n    await expectStatus('/0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2ftest-file.txt","suites":[],"updatePoint":{"line":3352,"column":99},"line":3352,"code":"  it('should prevent traversing with /0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2ftest-file.txt', async () => {\n    await expectStatus(\n      '/0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2ftest-file.txt","suites":[],"updatePoint":{"line":3358,"column":111},"line":3358,"code":"  it('should prevent traversing with /0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2ftest-file.txt', async () => {\n    await expectStatus(\n      '/0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2ftest-file.txt","suites":[],"updatePoint":{"line":3364,"column":123},"line":3364,"code":"  it('should prevent traversing with /0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2ftest-file.txt', async () => {\n    await expectStatus(\n      '/0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2ftest-file.txt","suites":[],"updatePoint":{"line":3370,"column":135},"line":3370,"code":"  it('should prevent traversing with /0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2ftest-file.txt', async () => {\n    await expectStatus(\n      '/0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2ftest-file.txt","suites":[],"updatePoint":{"line":3376,"column":147},"line":3376,"code":"  it('should prevent traversing with /0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2ftest-file.txt', async () => {\n    await expectStatus(\n      '/0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2f0x2e0x2e0x2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..0x5ctest-file.txt","suites":[],"updatePoint":{"line":3382,"column":57},"line":3382,"code":"  it('should prevent traversing with /..0x5ctest-file.txt', async () => {\n    await expectStatus('/..0x5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..0x5c..0x5ctest-file.txt","suites":[],"updatePoint":{"line":3386,"column":63},"line":3386,"code":"  it('should prevent traversing with /..0x5c..0x5ctest-file.txt', async () => {\n    await expectStatus('/..0x5c..0x5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..0x5c..0x5c..0x5ctest-file.txt","suites":[],"updatePoint":{"line":3390,"column":69},"line":3390,"code":"  it('should prevent traversing with /..0x5c..0x5c..0x5ctest-file.txt', async () => {\n    await expectStatus('/..0x5c..0x5c..0x5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..0x5c..0x5c..0x5c..0x5ctest-file.txt","suites":[],"updatePoint":{"line":3394,"column":75},"line":3394,"code":"  it('should prevent traversing with /..0x5c..0x5c..0x5c..0x5ctest-file.txt', async () => {\n    await expectStatus('/..0x5c..0x5c..0x5c..0x5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..0x5c..0x5c..0x5c..0x5c..0x5ctest-file.txt","suites":[],"updatePoint":{"line":3398,"column":81},"line":3398,"code":"  it('should prevent traversing with /..0x5c..0x5c..0x5c..0x5c..0x5ctest-file.txt', async () => {\n    await expectStatus('/..0x5c..0x5c..0x5c..0x5c..0x5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..0x5c..0x5c..0x5c..0x5c..0x5c..0x5ctest-file.txt","suites":[],"updatePoint":{"line":3402,"column":87},"line":3402,"code":"  it('should prevent traversing with /..0x5c..0x5c..0x5c..0x5c..0x5c..0x5ctest-file.txt', async () => {\n    await expectStatus('/..0x5c..0x5c..0x5c..0x5c..0x5c..0x5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..0x5c..0x5c..0x5c..0x5c..0x5c..0x5c..0x5ctest-file.txt","suites":[],"updatePoint":{"line":3406,"column":93},"line":3406,"code":"  it('should prevent traversing with /..0x5c..0x5c..0x5c..0x5c..0x5c..0x5c..0x5ctest-file.txt', async () => {\n    await expectStatus(\n      '/..0x5c..0x5c..0x5c..0x5c..0x5c..0x5c..0x5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..0x5c..0x5c..0x5c..0x5c..0x5c..0x5c..0x5c..0x5ctest-file.txt","suites":[],"updatePoint":{"line":3412,"column":99},"line":3412,"code":"  it('should prevent traversing with /..0x5c..0x5c..0x5c..0x5c..0x5c..0x5c..0x5c..0x5ctest-file.txt', async () => {\n    await expectStatus(\n      '/..0x5c..0x5c..0x5c..0x5c..0x5c..0x5c..0x5c..0x5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e\\test-file.txt","suites":[],"updatePoint":{"line":3418,"column":61},"line":3418,"code":"  it('should prevent traversing with /0x2e0x2e\\\\test-file.txt', async () => {\n    await expectStatus('/0x2e0x2e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e\\0x2e0x2e\\test-file.txt","suites":[],"updatePoint":{"line":3422,"column":71},"line":3422,"code":"  it('should prevent traversing with /0x2e0x2e\\\\0x2e0x2e\\\\test-file.txt', async () => {\n    await expectStatus('/0x2e0x2e\\\\0x2e0x2e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e\\0x2e0x2e\\0x2e0x2e\\test-file.txt","suites":[],"updatePoint":{"line":3426,"column":81},"line":3426,"code":"  it('should prevent traversing with /0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\test-file.txt', async () => {\n    await expectStatus('/0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e\\0x2e0x2e\\0x2e0x2e\\0x2e0x2e\\test-file.txt","suites":[],"updatePoint":{"line":3430,"column":91},"line":3430,"code":"  it('should prevent traversing with /0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\test-file.txt', async () => {\n    await expectStatus('/0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e\\0x2e0x2e\\0x2e0x2e\\0x2e0x2e\\0x2e0x2e\\test-file.txt","suites":[],"updatePoint":{"line":3434,"column":101},"line":3434,"code":"  it('should prevent traversing with /0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e\\0x2e0x2e\\0x2e0x2e\\0x2e0x2e\\0x2e0x2e\\0x2e0x2e\\test-file.txt","suites":[],"updatePoint":{"line":3440,"column":111},"line":3440,"code":"  it('should prevent traversing with /0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e\\0x2e0x2e\\0x2e0x2e\\0x2e0x2e\\0x2e0x2e\\0x2e0x2e\\0x2e0x2e\\test-file.txt","suites":[],"updatePoint":{"line":3446,"column":121},"line":3446,"code":"  it('should prevent traversing with /0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e\\0x2e0x2e\\0x2e0x2e\\0x2e0x2e\\0x2e0x2e\\0x2e0x2e\\0x2e0x2e\\0x2e0x2e\\test-file.txt","suites":[],"updatePoint":{"line":3452,"column":131},"line":3452,"code":"  it('should prevent traversing with /0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\0x2e0x2e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e0x5ctest-file.txt","suites":[],"updatePoint":{"line":3458,"column":63},"line":3458,"code":"  it('should prevent traversing with /0x2e0x2e0x5ctest-file.txt', async () => {\n    await expectStatus('/0x2e0x2e0x5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e0x5c0x2e0x2e0x5ctest-file.txt","suites":[],"updatePoint":{"line":3462,"column":75},"line":3462,"code":"  it('should prevent traversing with /0x2e0x2e0x5c0x2e0x2e0x5ctest-file.txt', async () => {\n    await expectStatus('/0x2e0x2e0x5c0x2e0x2e0x5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5ctest-file.txt","suites":[],"updatePoint":{"line":3466,"column":87},"line":3466,"code":"  it('should prevent traversing with /0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5ctest-file.txt', async () => {\n    await expectStatus('/0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5ctest-file.txt","suites":[],"updatePoint":{"line":3470,"column":99},"line":3470,"code":"  it('should prevent traversing with /0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5ctest-file.txt', async () => {\n    await expectStatus(\n      '/0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5ctest-file.txt","suites":[],"updatePoint":{"line":3476,"column":111},"line":3476,"code":"  it('should prevent traversing with /0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5ctest-file.txt', async () => {\n    await expectStatus(\n      '/0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5ctest-file.txt","suites":[],"updatePoint":{"line":3482,"column":123},"line":3482,"code":"  it('should prevent traversing with /0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5ctest-file.txt', async () => {\n    await expectStatus(\n      '/0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5ctest-file.txt","suites":[],"updatePoint":{"line":3488,"column":135},"line":3488,"code":"  it('should prevent traversing with /0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5ctest-file.txt', async () => {\n    await expectStatus(\n      '/0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5ctest-file.txt","suites":[],"updatePoint":{"line":3494,"column":147},"line":3494,"code":"  it('should prevent traversing with /0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5ctest-file.txt', async () => {\n    await expectStatus(\n      '/0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5c0x2e0x2e0x5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%2ftest-file.txt","suites":[],"updatePoint":{"line":3500,"column":59},"line":3500,"code":"  it('should prevent traversing with /..%c0%2ftest-file.txt', async () => {\n    await expectStatus('/..%c0%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%2f..%c0%2ftest-file.txt","suites":[],"updatePoint":{"line":3504,"column":67},"line":3504,"code":"  it('should prevent traversing with /..%c0%2f..%c0%2ftest-file.txt', async () => {\n    await expectStatus('/..%c0%2f..%c0%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%2f..%c0%2f..%c0%2ftest-file.txt","suites":[],"updatePoint":{"line":3508,"column":75},"line":3508,"code":"  it('should prevent traversing with /..%c0%2f..%c0%2f..%c0%2ftest-file.txt', async () => {\n    await expectStatus('/..%c0%2f..%c0%2f..%c0%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%2f..%c0%2f..%c0%2f..%c0%2ftest-file.txt","suites":[],"updatePoint":{"line":3512,"column":83},"line":3512,"code":"  it('should prevent traversing with /..%c0%2f..%c0%2f..%c0%2f..%c0%2ftest-file.txt', async () => {\n    await expectStatus('/..%c0%2f..%c0%2f..%c0%2f..%c0%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2ftest-file.txt","suites":[],"updatePoint":{"line":3516,"column":91},"line":3516,"code":"  it('should prevent traversing with /..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2ftest-file.txt', async () => {\n    await expectStatus('/..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2ftest-file.txt","suites":[],"updatePoint":{"line":3520,"column":99},"line":3520,"code":"  it('should prevent traversing with /..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2ftest-file.txt","suites":[],"updatePoint":{"line":3526,"column":107},"line":3526,"code":"  it('should prevent traversing with /..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2ftest-file.txt","suites":[],"updatePoint":{"line":3532,"column":115},"line":3532,"code":"  it('should prevent traversing with /..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e/test-file.txt","suites":[],"updatePoint":{"line":3538,"column":64},"line":3538,"code":"  it('should prevent traversing with /%c0%2e%c0%2e/test-file.txt', async () => {\n    await expectStatus('/%c0%2e%c0%2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e/%c0%2e%c0%2e/test-file.txt","suites":[],"updatePoint":{"line":3542,"column":77},"line":3542,"code":"  it('should prevent traversing with /%c0%2e%c0%2e/%c0%2e%c0%2e/test-file.txt', async () => {\n    await expectStatus('/%c0%2e%c0%2e/%c0%2e%c0%2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/test-file.txt","suites":[],"updatePoint":{"line":3546,"column":90},"line":3546,"code":"  it('should prevent traversing with /%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/test-file.txt', async () => {\n    await expectStatus('/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/test-file.txt","suites":[],"updatePoint":{"line":3550,"column":103},"line":3550,"code":"  it('should prevent traversing with /%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/test-file.txt","suites":[],"updatePoint":{"line":3556,"column":116},"line":3556,"code":"  it('should prevent traversing with /%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/test-file.txt","suites":[],"updatePoint":{"line":3562,"column":129},"line":3562,"code":"  it('should prevent traversing with /%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/test-file.txt","suites":[],"updatePoint":{"line":3568,"column":142},"line":3568,"code":"  it('should prevent traversing with /%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/test-file.txt","suites":[],"updatePoint":{"line":3574,"column":155},"line":3574,"code":"  it('should prevent traversing with /%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/%c0%2e%c0%2e/test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e%c0%2ftest-file.txt","suites":[],"updatePoint":{"line":3580,"column":69},"line":3580,"code":"  it('should prevent traversing with /%c0%2e%c0%2e%c0%2ftest-file.txt', async () => {\n    await expectStatus('/%c0%2e%c0%2e%c0%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2ftest-file.txt","suites":[],"updatePoint":{"line":3584,"column":87},"line":3584,"code":"  it('should prevent traversing with /%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2ftest-file.txt', async () => {\n    await expectStatus('/%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2ftest-file.txt","suites":[],"updatePoint":{"line":3588,"column":105},"line":3588,"code":"  it('should prevent traversing with /%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2ftest-file.txt","suites":[],"updatePoint":{"line":3594,"column":123},"line":3594,"code":"  it('should prevent traversing with /%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2ftest-file.txt","suites":[],"updatePoint":{"line":3600,"column":141},"line":3600,"code":"  it('should prevent traversing with /%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2ftest-file.txt","suites":[],"updatePoint":{"line":3606,"column":159},"line":3606,"code":"  it('should prevent traversing with /%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2ftest-file.txt","suites":[],"updatePoint":{"line":3612,"column":177},"line":3612,"code":"  it('should prevent traversing with /%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2ftest-file.txt","suites":[],"updatePoint":{"line":3618,"column":195},"line":3618,"code":"  it('should prevent traversing with /%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2f%c0%2e%c0%2e%c0%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%5ctest-file.txt","suites":[],"updatePoint":{"line":3624,"column":59},"line":3624,"code":"  it('should prevent traversing with /..%c0%5ctest-file.txt', async () => {\n    await expectStatus('/..%c0%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%5c..%c0%5ctest-file.txt","suites":[],"updatePoint":{"line":3628,"column":67},"line":3628,"code":"  it('should prevent traversing with /..%c0%5c..%c0%5ctest-file.txt', async () => {\n    await expectStatus('/..%c0%5c..%c0%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%5c..%c0%5c..%c0%5ctest-file.txt","suites":[],"updatePoint":{"line":3632,"column":75},"line":3632,"code":"  it('should prevent traversing with /..%c0%5c..%c0%5c..%c0%5ctest-file.txt', async () => {\n    await expectStatus('/..%c0%5c..%c0%5c..%c0%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%5c..%c0%5c..%c0%5c..%c0%5ctest-file.txt","suites":[],"updatePoint":{"line":3636,"column":83},"line":3636,"code":"  it('should prevent traversing with /..%c0%5c..%c0%5c..%c0%5c..%c0%5ctest-file.txt', async () => {\n    await expectStatus('/..%c0%5c..%c0%5c..%c0%5c..%c0%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5ctest-file.txt","suites":[],"updatePoint":{"line":3640,"column":91},"line":3640,"code":"  it('should prevent traversing with /..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5ctest-file.txt', async () => {\n    await expectStatus('/..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5ctest-file.txt","suites":[],"updatePoint":{"line":3644,"column":99},"line":3644,"code":"  it('should prevent traversing with /..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5ctest-file.txt","suites":[],"updatePoint":{"line":3650,"column":107},"line":3650,"code":"  it('should prevent traversing with /..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5ctest-file.txt","suites":[],"updatePoint":{"line":3656,"column":115},"line":3656,"code":"  it('should prevent traversing with /..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5c..%c0%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e\\test-file.txt","suites":[],"updatePoint":{"line":3662,"column":65},"line":3662,"code":"  it('should prevent traversing with /%c0%2e%c0%2e\\\\test-file.txt', async () => {\n    await expectStatus('/%c0%2e%c0%2e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e\\%c0%2e%c0%2e\\test-file.txt","suites":[],"updatePoint":{"line":3666,"column":79},"line":3666,"code":"  it('should prevent traversing with /%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\test-file.txt', async () => {\n    await expectStatus('/%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e\\%c0%2e%c0%2e\\%c0%2e%c0%2e\\test-file.txt","suites":[],"updatePoint":{"line":3670,"column":93},"line":3670,"code":"  it('should prevent traversing with /%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e\\%c0%2e%c0%2e\\%c0%2e%c0%2e\\%c0%2e%c0%2e\\test-file.txt","suites":[],"updatePoint":{"line":3676,"column":107},"line":3676,"code":"  it('should prevent traversing with /%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e\\%c0%2e%c0%2e\\%c0%2e%c0%2e\\%c0%2e%c0%2e\\%c0%2e%c0%2e\\test-file.txt","suites":[],"updatePoint":{"line":3682,"column":121},"line":3682,"code":"  it('should prevent traversing with /%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e\\%c0%2e%c0%2e\\%c0%2e%c0%2e\\%c0%2e%c0%2e\\%c0%2e%c0%2e\\%c0%2e%c0%2e\\test-file.txt","suites":[],"updatePoint":{"line":3688,"column":135},"line":3688,"code":"  it('should prevent traversing with /%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e\\%c0%2e%c0%2e\\%c0%2e%c0%2e\\%c0%2e%c0%2e\\%c0%2e%c0%2e\\%c0%2e%c0%2e\\%c0%2e%c0%2e\\test-file.txt","suites":[],"updatePoint":{"line":3694,"column":149},"line":3694,"code":"  it('should prevent traversing with /%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e\\%c0%2e%c0%2e\\%c0%2e%c0%2e\\%c0%2e%c0%2e\\%c0%2e%c0%2e\\%c0%2e%c0%2e\\%c0%2e%c0%2e\\%c0%2e%c0%2e\\test-file.txt","suites":[],"updatePoint":{"line":3700,"column":163},"line":3700,"code":"  it('should prevent traversing with /%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\%c0%2e%c0%2e\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e%c0%5ctest-file.txt","suites":[],"updatePoint":{"line":3706,"column":69},"line":3706,"code":"  it('should prevent traversing with /%c0%2e%c0%2e%c0%5ctest-file.txt', async () => {\n    await expectStatus('/%c0%2e%c0%2e%c0%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5ctest-file.txt","suites":[],"updatePoint":{"line":3710,"column":87},"line":3710,"code":"  it('should prevent traversing with /%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5ctest-file.txt', async () => {\n    await expectStatus('/%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5ctest-file.txt","suites":[],"updatePoint":{"line":3714,"column":105},"line":3714,"code":"  it('should prevent traversing with /%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5ctest-file.txt","suites":[],"updatePoint":{"line":3720,"column":123},"line":3720,"code":"  it('should prevent traversing with /%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5ctest-file.txt","suites":[],"updatePoint":{"line":3726,"column":141},"line":3726,"code":"  it('should prevent traversing with /%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5ctest-file.txt","suites":[],"updatePoint":{"line":3732,"column":159},"line":3732,"code":"  it('should prevent traversing with /%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5ctest-file.txt","suites":[],"updatePoint":{"line":3738,"column":177},"line":3738,"code":"  it('should prevent traversing with /%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5ctest-file.txt","suites":[],"updatePoint":{"line":3744,"column":195},"line":3744,"code":"  it('should prevent traversing with /%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5c%c0%2e%c0%2e%c0%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with ////%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":3750,"column":63},"line":3750,"code":"  it('should prevent traversing with ////%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus('////%2e%2e%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with ////%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":3754,"column":72},"line":3754,"code":"  it('should prevent traversing with ////%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus('////%2e%2e%2f%2e%2e%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with ////%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":3758,"column":81},"line":3758,"code":"  it('should prevent traversing with ////%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus('////%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with ////%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":3762,"column":90},"line":3762,"code":"  it('should prevent traversing with ////%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus('////%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with ////%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":3766,"column":99},"line":3766,"code":"  it('should prevent traversing with ////%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus(\n      '////%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with ////%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":3772,"column":108},"line":3772,"code":"  it('should prevent traversing with ////%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus(\n      '////%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with ////%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":3778,"column":117},"line":3778,"code":"  it('should prevent traversing with ////%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus(\n      '////%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with ////%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt","suites":[],"updatePoint":{"line":3784,"column":126},"line":3784,"code":"  it('should prevent traversing with ////%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt', async () => {\n    await expectStatus(\n      '////%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\\\\\%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":3790,"column":66},"line":3790,"code":"  it('should prevent traversing with /\\\\\\\\\\\\%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus('/\\\\\\\\\\\\%2e%2e%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\\\\\%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":3794,"column":75},"line":3794,"code":"  it('should prevent traversing with /\\\\\\\\\\\\%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus('/\\\\\\\\\\\\%2e%2e%5c%2e%2e%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\\\\\%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":3798,"column":84},"line":3798,"code":"  it('should prevent traversing with /\\\\\\\\\\\\%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus('/\\\\\\\\\\\\%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\\\\\%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":3802,"column":93},"line":3802,"code":"  it('should prevent traversing with /\\\\\\\\\\\\%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/\\\\\\\\\\\\%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\\\\\%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":3808,"column":102},"line":3808,"code":"  it('should prevent traversing with /\\\\\\\\\\\\%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/\\\\\\\\\\\\%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\\\\\%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":3814,"column":111},"line":3814,"code":"  it('should prevent traversing with /\\\\\\\\\\\\%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/\\\\\\\\\\\\%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\\\\\%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":3820,"column":120},"line":3820,"code":"  it('should prevent traversing with /\\\\\\\\\\\\%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/\\\\\\\\\\\\%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\\\\\%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt","suites":[],"updatePoint":{"line":3826,"column":129},"line":3826,"code":"  it('should prevent traversing with /\\\\\\\\\\\\%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt', async () => {\n    await expectStatus(\n      '/\\\\\\\\\\\\%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5ctest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..//test-file.txt","suites":[],"updatePoint":{"line":3832,"column":55},"line":3832,"code":"  it('should prevent traversing with /..//test-file.txt', async () => {\n    await expectStatus('/..//test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..//..//test-file.txt","suites":[],"updatePoint":{"line":3836,"column":59},"line":3836,"code":"  it('should prevent traversing with /..//..//test-file.txt', async () => {\n    await expectStatus('/..//..//test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..//..//..//test-file.txt","suites":[],"updatePoint":{"line":3840,"column":63},"line":3840,"code":"  it('should prevent traversing with /..//..//..//test-file.txt', async () => {\n    await expectStatus('/..//..//..//test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..//..//..//..//test-file.txt","suites":[],"updatePoint":{"line":3844,"column":67},"line":3844,"code":"  it('should prevent traversing with /..//..//..//..//test-file.txt', async () => {\n    await expectStatus('/..//..//..//..//test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..//..//..//..//..//test-file.txt","suites":[],"updatePoint":{"line":3848,"column":71},"line":3848,"code":"  it('should prevent traversing with /..//..//..//..//..//test-file.txt', async () => {\n    await expectStatus('/..//..//..//..//..//test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..//..//..//..//..//..//test-file.txt","suites":[],"updatePoint":{"line":3852,"column":75},"line":3852,"code":"  it('should prevent traversing with /..//..//..//..//..//..//test-file.txt', async () => {\n    await expectStatus('/..//..//..//..//..//..//test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..//..//..//..//..//..//..//test-file.txt","suites":[],"updatePoint":{"line":3856,"column":79},"line":3856,"code":"  it('should prevent traversing with /..//..//..//..//..//..//..//test-file.txt', async () => {\n    await expectStatus('/..//..//..//..//..//..//..//test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..//..//..//..//..//..//..//..//test-file.txt","suites":[],"updatePoint":{"line":3860,"column":83},"line":3860,"code":"  it('should prevent traversing with /..//..//..//..//..//..//..//..//test-file.txt', async () => {\n    await expectStatus('/..//..//..//..//..//..//..//..//test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..///test-file.txt","suites":[],"updatePoint":{"line":3864,"column":56},"line":3864,"code":"  it('should prevent traversing with /..///test-file.txt', async () => {\n    await expectStatus('/..///test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..///..///test-file.txt","suites":[],"updatePoint":{"line":3868,"column":61},"line":3868,"code":"  it('should prevent traversing with /..///..///test-file.txt', async () => {\n    await expectStatus('/..///..///test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..///..///..///test-file.txt","suites":[],"updatePoint":{"line":3872,"column":66},"line":3872,"code":"  it('should prevent traversing with /..///..///..///test-file.txt', async () => {\n    await expectStatus('/..///..///..///test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..///..///..///..///test-file.txt","suites":[],"updatePoint":{"line":3876,"column":71},"line":3876,"code":"  it('should prevent traversing with /..///..///..///..///test-file.txt', async () => {\n    await expectStatus('/..///..///..///..///test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..///..///..///..///..///test-file.txt","suites":[],"updatePoint":{"line":3880,"column":76},"line":3880,"code":"  it('should prevent traversing with /..///..///..///..///..///test-file.txt', async () => {\n    await expectStatus('/..///..///..///..///..///test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..///..///..///..///..///..///test-file.txt","suites":[],"updatePoint":{"line":3884,"column":81},"line":3884,"code":"  it('should prevent traversing with /..///..///..///..///..///..///test-file.txt', async () => {\n    await expectStatus('/..///..///..///..///..///..///test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..///..///..///..///..///..///..///test-file.txt","suites":[],"updatePoint":{"line":3888,"column":86},"line":3888,"code":"  it('should prevent traversing with /..///..///..///..///..///..///..///test-file.txt', async () => {\n    await expectStatus('/..///..///..///..///..///..///..///test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..///..///..///..///..///..///..///..///test-file.txt","suites":[],"updatePoint":{"line":3892,"column":91},"line":3892,"code":"  it('should prevent traversing with /..///..///..///..///..///..///..///..///test-file.txt', async () => {\n    await expectStatus('/..///..///..///..///..///..///..///..///test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\\\test-file.txt","suites":[],"updatePoint":{"line":3896,"column":57},"line":3896,"code":"  it('should prevent traversing with /..\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\\\..\\\\test-file.txt","suites":[],"updatePoint":{"line":3900,"column":63},"line":3900,"code":"  it('should prevent traversing with /..\\\\\\\\..\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\\\\\..\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\\\..\\\\..\\\\test-file.txt","suites":[],"updatePoint":{"line":3904,"column":69},"line":3904,"code":"  it('should prevent traversing with /..\\\\\\\\..\\\\\\\\..\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\\\\\..\\\\\\\\..\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\\\..\\\\..\\\\..\\\\test-file.txt","suites":[],"updatePoint":{"line":3908,"column":75},"line":3908,"code":"  it('should prevent traversing with /..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt","suites":[],"updatePoint":{"line":3912,"column":81},"line":3912,"code":"  it('should prevent traversing with /..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt","suites":[],"updatePoint":{"line":3916,"column":87},"line":3916,"code":"  it('should prevent traversing with /..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt","suites":[],"updatePoint":{"line":3920,"column":93},"line":3920,"code":"  it('should prevent traversing with /..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt","suites":[],"updatePoint":{"line":3926,"column":99},"line":3926,"code":"  it('should prevent traversing with /..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\..\\\\\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\\\\\test-file.txt","suites":[],"updatePoint":{"line":3932,"column":59},"line":3932,"code":"  it('should prevent traversing with /..\\\\\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\\\\\..\\\\\\test-file.txt","suites":[],"updatePoint":{"line":3936,"column":67},"line":3936,"code":"  it('should prevent traversing with /..\\\\\\\\\\\\..\\\\\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\\\\\\\\\..\\\\\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\\\\\..\\\\\\..\\\\\\test-file.txt","suites":[],"updatePoint":{"line":3940,"column":75},"line":3940,"code":"  it('should prevent traversing with /..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\\\\\..\\\\\\..\\\\\\..\\\\\\test-file.txt","suites":[],"updatePoint":{"line":3944,"column":83},"line":3944,"code":"  it('should prevent traversing with /..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\\\\\..\\\\\\..\\\\\\..\\\\\\..\\\\\\test-file.txt","suites":[],"updatePoint":{"line":3948,"column":91},"line":3948,"code":"  it('should prevent traversing with /..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\\\\\..\\\\\\..\\\\\\..\\\\\\..\\\\\\..\\\\\\test-file.txt","suites":[],"updatePoint":{"line":3952,"column":99},"line":3952,"code":"  it('should prevent traversing with /..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\\\\\..\\\\\\..\\\\\\..\\\\\\..\\\\\\..\\\\\\..\\\\\\test-file.txt","suites":[],"updatePoint":{"line":3958,"column":107},"line":3958,"code":"  it('should prevent traversing with /..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\\\\\..\\\\\\..\\\\\\..\\\\\\..\\\\\\..\\\\\\..\\\\\\..\\\\\\test-file.txt","suites":[],"updatePoint":{"line":3964,"column":115},"line":3964,"code":"  it('should prevent traversing with /..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\..\\\\\\\\\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /./\\/./test-file.txt","suites":[],"updatePoint":{"line":3970,"column":58},"line":3970,"code":"  it('should prevent traversing with /./\\\\/./test-file.txt', async () => {\n    await expectStatus('/./\\\\/./test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /./\\/././\\/./test-file.txt","suites":[],"updatePoint":{"line":3974,"column":65},"line":3974,"code":"  it('should prevent traversing with /./\\\\/././\\\\/./test-file.txt', async () => {\n    await expectStatus('/./\\\\/././\\\\/./test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /./\\/././\\/././\\/./test-file.txt","suites":[],"updatePoint":{"line":3978,"column":72},"line":3978,"code":"  it('should prevent traversing with /./\\\\/././\\\\/././\\\\/./test-file.txt', async () => {\n    await expectStatus('/./\\\\/././\\\\/././\\\\/./test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /./\\/././\\/././\\/././\\/./test-file.txt","suites":[],"updatePoint":{"line":3982,"column":79},"line":3982,"code":"  it('should prevent traversing with /./\\\\/././\\\\/././\\\\/././\\\\/./test-file.txt', async () => {\n    await expectStatus('/./\\\\/././\\\\/././\\\\/././\\\\/./test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /./\\/././\\/././\\/././\\/././\\/./test-file.txt","suites":[],"updatePoint":{"line":3986,"column":86},"line":3986,"code":"  it('should prevent traversing with /./\\\\/././\\\\/././\\\\/././\\\\/././\\\\/./test-file.txt', async () => {\n    await expectStatus('/./\\\\/././\\\\/././\\\\/././\\\\/././\\\\/./test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /./\\/././\\/././\\/././\\/././\\/././\\/./test-file.txt","suites":[],"updatePoint":{"line":3990,"column":93},"line":3990,"code":"  it('should prevent traversing with /./\\\\/././\\\\/././\\\\/././\\\\/././\\\\/././\\\\/./test-file.txt', async () => {\n    await expectStatus(\n      '/./\\\\/././\\\\/././\\\\/././\\\\/././\\\\/././\\\\/./test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /./\\/././\\/././\\/././\\/././\\/././\\/././\\/./test-file.txt","suites":[],"updatePoint":{"line":3996,"column":100},"line":3996,"code":"  it('should prevent traversing with /./\\\\/././\\\\/././\\\\/././\\\\/././\\\\/././\\\\/././\\\\/./test-file.txt', async () => {\n    await expectStatus(\n      '/./\\\\/././\\\\/././\\\\/././\\\\/././\\\\/././\\\\/././\\\\/./test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /./\\/././\\/././\\/././\\/././\\/././\\/././\\/././\\/./test-file.txt","suites":[],"updatePoint":{"line":4002,"column":107},"line":4002,"code":"  it('should prevent traversing with /./\\\\/././\\\\/././\\\\/././\\\\/././\\\\/././\\\\/././\\\\/././\\\\/./test-file.txt', async () => {\n    await expectStatus(\n      '/./\\\\/././\\\\/././\\\\/././\\\\/././\\\\/././\\\\/././\\\\/././\\\\/./test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\/\\.\\test-file.txt","suites":[],"updatePoint":{"line":4008,"column":60},"line":4008,"code":"  it('should prevent traversing with /.\\\\/\\\\.\\\\test-file.txt', async () => {\n    await expectStatus('/.\\\\/\\\\.\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\/\\.\\.\\/\\.\\test-file.txt","suites":[],"updatePoint":{"line":4012,"column":69},"line":4012,"code":"  it('should prevent traversing with /.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\test-file.txt', async () => {\n    await expectStatus('/.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\/\\.\\.\\/\\.\\.\\/\\.\\test-file.txt","suites":[],"updatePoint":{"line":4016,"column":78},"line":4016,"code":"  it('should prevent traversing with /.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\test-file.txt', async () => {\n    await expectStatus('/.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\test-file.txt","suites":[],"updatePoint":{"line":4020,"column":87},"line":4020,"code":"  it('should prevent traversing with /.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\test-file.txt', async () => {\n    await expectStatus('/.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\test-file.txt","suites":[],"updatePoint":{"line":4024,"column":96},"line":4024,"code":"  it('should prevent traversing with /.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\test-file.txt","suites":[],"updatePoint":{"line":4030,"column":105},"line":4030,"code":"  it('should prevent traversing with /.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\test-file.txt","suites":[],"updatePoint":{"line":4036,"column":114},"line":4036,"code":"  it('should prevent traversing with /.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\test-file.txt","suites":[],"updatePoint":{"line":4042,"column":123},"line":4042,"code":"  it('should prevent traversing with /.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\.\\\\/\\\\.\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../test-file.txt","suites":[],"updatePoint":{"line":4048,"column":354},"line":4048,"code":"  it('should prevent traversing with /././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../test-file.txt', async () => {\n    await expectStatus(\n      '/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../../test-file.txt","suites":[],"updatePoint":{"line":4054,"column":357},"line":4054,"code":"  it('should prevent traversing with /././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../../test-file.txt', async () => {\n    await expectStatus(\n      '/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../../../test-file.txt","suites":[],"updatePoint":{"line":4060,"column":360},"line":4060,"code":"  it('should prevent traversing with /././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../../../test-file.txt', async () => {\n    await expectStatus(\n      '/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../../../../test-file.txt","suites":[],"updatePoint":{"line":4066,"column":363},"line":4066,"code":"  it('should prevent traversing with /././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../../../../test-file.txt', async () => {\n    await expectStatus(\n      '/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../../../../../test-file.txt","suites":[],"updatePoint":{"line":4072,"column":366},"line":4072,"code":"  it('should prevent traversing with /././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../../../../../test-file.txt', async () => {\n    await expectStatus(\n      '/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../../../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../../../../../../test-file.txt","suites":[],"updatePoint":{"line":4078,"column":369},"line":4078,"code":"  it('should prevent traversing with /././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../../../../../../test-file.txt', async () => {\n    await expectStatus(\n      '/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../../../../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../../../../../../../test-file.txt","suites":[],"updatePoint":{"line":4084,"column":372},"line":4084,"code":"  it('should prevent traversing with /././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../../../../../../../test-file.txt', async () => {\n    await expectStatus(\n      '/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../../../../../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../../../../../../../../test-file.txt","suites":[],"updatePoint":{"line":4090,"column":375},"line":4090,"code":"  it('should prevent traversing with /././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../../../../../../../../test-file.txt', async () => {\n    await expectStatus(\n      '/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././../../../../../../../../test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\..\\test-file.txt","suites":[],"updatePoint":{"line":4096,"column":505},"line":4096,"code":"  it('should prevent traversing with /.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":4102,"column":509},"line":4102,"code":"  it('should prevent traversing with /.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":4108,"column":513},"line":4108,"code":"  it('should prevent traversing with /.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":4114,"column":517},"line":4114,"code":"  it('should prevent traversing with /.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":4120,"column":521},"line":4120,"code":"  it('should prevent traversing with /.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\..\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":4126,"column":525},"line":4126,"code":"  it('should prevent traversing with /.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\..\\..\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":4132,"column":529},"line":4132,"code":"  it('should prevent traversing with /.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\..\\..\\..\\..\\..\\..\\..\\..\\test-file.txt","suites":[],"updatePoint":{"line":4138,"column":533},"line":4138,"code":"  it('should prevent traversing with /.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\.\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /./../test-file.txt","suites":[],"updatePoint":{"line":4144,"column":56},"line":4144,"code":"  it('should prevent traversing with /./../test-file.txt', async () => {\n    await expectStatus('/./../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /./.././../test-file.txt","suites":[],"updatePoint":{"line":4148,"column":61},"line":4148,"code":"  it('should prevent traversing with /./.././../test-file.txt', async () => {\n    await expectStatus('/./.././../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /./.././.././../test-file.txt","suites":[],"updatePoint":{"line":4152,"column":66},"line":4152,"code":"  it('should prevent traversing with /./.././.././../test-file.txt', async () => {\n    await expectStatus('/./.././.././../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /./.././.././.././../test-file.txt","suites":[],"updatePoint":{"line":4156,"column":71},"line":4156,"code":"  it('should prevent traversing with /./.././.././.././../test-file.txt', async () => {\n    await expectStatus('/./.././.././.././../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /./.././.././.././.././../test-file.txt","suites":[],"updatePoint":{"line":4160,"column":76},"line":4160,"code":"  it('should prevent traversing with /./.././.././.././.././../test-file.txt', async () => {\n    await expectStatus('/./.././.././.././.././../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /./.././.././.././.././.././../test-file.txt","suites":[],"updatePoint":{"line":4164,"column":81},"line":4164,"code":"  it('should prevent traversing with /./.././.././.././.././.././../test-file.txt', async () => {\n    await expectStatus('/./.././.././.././.././.././../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /./.././.././.././.././.././.././../test-file.txt","suites":[],"updatePoint":{"line":4168,"column":86},"line":4168,"code":"  it('should prevent traversing with /./.././.././.././.././.././.././../test-file.txt', async () => {\n    await expectStatus('/./.././.././.././.././.././.././../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /./.././.././.././.././.././.././.././../test-file.txt","suites":[],"updatePoint":{"line":4172,"column":91},"line":4172,"code":"  it('should prevent traversing with /./.././.././.././.././.././.././.././../test-file.txt', async () => {\n    await expectStatus('/./.././.././.././.././.././.././.././../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\..\\test-file.txt","suites":[],"updatePoint":{"line":4176,"column":58},"line":4176,"code":"  it('should prevent traversing with /.\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/.\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\..\\.\\..\\test-file.txt","suites":[],"updatePoint":{"line":4180,"column":65},"line":4180,"code":"  it('should prevent traversing with /.\\\\..\\\\.\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/.\\\\..\\\\.\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\..\\.\\..\\.\\..\\test-file.txt","suites":[],"updatePoint":{"line":4184,"column":72},"line":4184,"code":"  it('should prevent traversing with /.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\..\\.\\..\\.\\..\\.\\..\\test-file.txt","suites":[],"updatePoint":{"line":4188,"column":79},"line":4188,"code":"  it('should prevent traversing with /.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\..\\.\\..\\.\\..\\.\\..\\.\\..\\test-file.txt","suites":[],"updatePoint":{"line":4192,"column":86},"line":4192,"code":"  it('should prevent traversing with /.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\..\\.\\..\\.\\..\\.\\..\\.\\..\\.\\..\\test-file.txt","suites":[],"updatePoint":{"line":4196,"column":93},"line":4196,"code":"  it('should prevent traversing with /.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\..\\.\\..\\.\\..\\.\\..\\.\\..\\.\\..\\.\\..\\test-file.txt","suites":[],"updatePoint":{"line":4202,"column":100},"line":4202,"code":"  it('should prevent traversing with /.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\..\\.\\..\\.\\..\\.\\..\\.\\..\\.\\..\\.\\..\\.\\..\\test-file.txt","suites":[],"updatePoint":{"line":4208,"column":107},"line":4208,"code":"  it('should prevent traversing with /.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.//..//test-file.txt","suites":[],"updatePoint":{"line":4214,"column":58},"line":4214,"code":"  it('should prevent traversing with /.//..//test-file.txt', async () => {\n    await expectStatus('/.//..//test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.//..//.//..//test-file.txt","suites":[],"updatePoint":{"line":4218,"column":65},"line":4218,"code":"  it('should prevent traversing with /.//..//.//..//test-file.txt', async () => {\n    await expectStatus('/.//..//.//..//test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.//..//.//..//.//..//test-file.txt","suites":[],"updatePoint":{"line":4222,"column":72},"line":4222,"code":"  it('should prevent traversing with /.//..//.//..//.//..//test-file.txt', async () => {\n    await expectStatus('/.//..//.//..//.//..//test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.//..//.//..//.//..//.//..//test-file.txt","suites":[],"updatePoint":{"line":4226,"column":79},"line":4226,"code":"  it('should prevent traversing with /.//..//.//..//.//..//.//..//test-file.txt', async () => {\n    await expectStatus('/.//..//.//..//.//..//.//..//test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.//..//.//..//.//..//.//..//.//..//test-file.txt","suites":[],"updatePoint":{"line":4230,"column":86},"line":4230,"code":"  it('should prevent traversing with /.//..//.//..//.//..//.//..//.//..//test-file.txt', async () => {\n    await expectStatus('/.//..//.//..//.//..//.//..//.//..//test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.//..//.//..//.//..//.//..//.//..//.//..//test-file.txt","suites":[],"updatePoint":{"line":4234,"column":93},"line":4234,"code":"  it('should prevent traversing with /.//..//.//..//.//..//.//..//.//..//.//..//test-file.txt', async () => {\n    await expectStatus(\n      '/.//..//.//..//.//..//.//..//.//..//.//..//test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.//..//.//..//.//..//.//..//.//..//.//..//.//..//test-file.txt","suites":[],"updatePoint":{"line":4240,"column":100},"line":4240,"code":"  it('should prevent traversing with /.//..//.//..//.//..//.//..//.//..//.//..//.//..//test-file.txt', async () => {\n    await expectStatus(\n      '/.//..//.//..//.//..//.//..//.//..//.//..//.//..//test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.//..//.//..//.//..//.//..//.//..//.//..//.//..//.//..//test-file.txt","suites":[],"updatePoint":{"line":4246,"column":107},"line":4246,"code":"  it('should prevent traversing with /.//..//.//..//.//..//.//..//.//..//.//..//.//..//.//..//test-file.txt', async () => {\n    await expectStatus(\n      '/.//..//.//..//.//..//.//..//.//..//.//..//.//..//.//..//test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\\\..\\\\test-file.txt","suites":[],"updatePoint":{"line":4252,"column":62},"line":4252,"code":"  it('should prevent traversing with /.\\\\\\\\..\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/.\\\\\\\\..\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\\\..\\\\.\\\\..\\\\test-file.txt","suites":[],"updatePoint":{"line":4256,"column":73},"line":4256,"code":"  it('should prevent traversing with /.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\test-file.txt","suites":[],"updatePoint":{"line":4260,"column":84},"line":4260,"code":"  it('should prevent traversing with /.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\test-file.txt","suites":[],"updatePoint":{"line":4264,"column":95},"line":4264,"code":"  it('should prevent traversing with /.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\test-file.txt","suites":[],"updatePoint":{"line":4270,"column":106},"line":4270,"code":"  it('should prevent traversing with /.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\test-file.txt","suites":[],"updatePoint":{"line":4276,"column":117},"line":4276,"code":"  it('should prevent traversing with /.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\test-file.txt","suites":[],"updatePoint":{"line":4282,"column":128},"line":4282,"code":"  it('should prevent traversing with /.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\.\\\\..\\\\test-file.txt","suites":[],"updatePoint":{"line":4288,"column":139},"line":4288,"code":"  it('should prevent traversing with /.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\.\\\\\\\\..\\\\\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../test-file.txt","suites":[],"updatePoint":{"line":4294,"column":54},"line":4294,"code":"  it('should prevent traversing with /../test-file.txt', async () => {\n    await expectStatus('/../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../..//test-file.txt","suites":[],"updatePoint":{"line":4298,"column":58},"line":4298,"code":"  it('should prevent traversing with /../..//test-file.txt', async () => {\n    await expectStatus('/../..//test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../..//../test-file.txt","suites":[],"updatePoint":{"line":4302,"column":61},"line":4302,"code":"  it('should prevent traversing with /../..//../test-file.txt', async () => {\n    await expectStatus('/../..//../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../..//../..//test-file.txt","suites":[],"updatePoint":{"line":4306,"column":65},"line":4306,"code":"  it('should prevent traversing with /../..//../..//test-file.txt', async () => {\n    await expectStatus('/../..//../..//test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../..//../..//../test-file.txt","suites":[],"updatePoint":{"line":4310,"column":68},"line":4310,"code":"  it('should prevent traversing with /../..//../..//../test-file.txt', async () => {\n    await expectStatus('/../..//../..//../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../..//../..//../..//test-file.txt","suites":[],"updatePoint":{"line":4314,"column":72},"line":4314,"code":"  it('should prevent traversing with /../..//../..//../..//test-file.txt', async () => {\n    await expectStatus('/../..//../..//../..//test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../..//../..//../..//../test-file.txt","suites":[],"updatePoint":{"line":4318,"column":75},"line":4318,"code":"  it('should prevent traversing with /../..//../..//../..//../test-file.txt', async () => {\n    await expectStatus('/../..//../..//../..//../test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../..//../..//../..//../..//test-file.txt","suites":[],"updatePoint":{"line":4322,"column":79},"line":4322,"code":"  it('should prevent traversing with /../..//../..//../..//../..//test-file.txt', async () => {\n    await expectStatus('/../..//../..//../..//../..//test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\test-file.txt","suites":[],"updatePoint":{"line":4326,"column":55},"line":4326,"code":"  it('should prevent traversing with /..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\\\test-file.txt","suites":[],"updatePoint":{"line":4330,"column":61},"line":4330,"code":"  it('should prevent traversing with /..\\\\..\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\\\..\\test-file.txt","suites":[],"updatePoint":{"line":4334,"column":65},"line":4334,"code":"  it('should prevent traversing with /..\\\\..\\\\\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\\\..\\..\\\\test-file.txt","suites":[],"updatePoint":{"line":4338,"column":71},"line":4338,"code":"  it('should prevent traversing with /..\\\\..\\\\\\\\..\\\\..\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\\\\\..\\\\..\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\\\..\\..\\\\..\\test-file.txt","suites":[],"updatePoint":{"line":4342,"column":75},"line":4342,"code":"  it('should prevent traversing with /..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\\\..\\..\\\\..\\..\\\\test-file.txt","suites":[],"updatePoint":{"line":4346,"column":81},"line":4346,"code":"  it('should prevent traversing with /..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\..\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\..\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\\\..\\..\\\\..\\..\\\\..\\test-file.txt","suites":[],"updatePoint":{"line":4350,"column":85},"line":4350,"code":"  it('should prevent traversing with /..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\\\..\\..\\\\..\\..\\\\..\\..\\\\test-file.txt","suites":[],"updatePoint":{"line":4354,"column":91},"line":4354,"code":"  it('should prevent traversing with /..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\..\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\..\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..///test-file.txt","suites":[],"updatePoint":{"line":4358,"column":56},"line":4358,"code":"  it('should prevent traversing with /..///test-file.txt', async () => {\n    await expectStatus('/..///test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../..///test-file.txt","suites":[],"updatePoint":{"line":4362,"column":59},"line":4362,"code":"  it('should prevent traversing with /../..///test-file.txt', async () => {\n    await expectStatus('/../..///test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../..//..///test-file.txt","suites":[],"updatePoint":{"line":4366,"column":63},"line":4366,"code":"  it('should prevent traversing with /../..//..///test-file.txt', async () => {\n    await expectStatus('/../..//..///test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../..//../..///test-file.txt","suites":[],"updatePoint":{"line":4370,"column":66},"line":4370,"code":"  it('should prevent traversing with /../..//../..///test-file.txt', async () => {\n    await expectStatus('/../..//../..///test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../..//../..//..///test-file.txt","suites":[],"updatePoint":{"line":4374,"column":70},"line":4374,"code":"  it('should prevent traversing with /../..//../..//..///test-file.txt', async () => {\n    await expectStatus('/../..//../..//..///test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../..//../..//../..///test-file.txt","suites":[],"updatePoint":{"line":4378,"column":73},"line":4378,"code":"  it('should prevent traversing with /../..//../..//../..///test-file.txt', async () => {\n    await expectStatus('/../..//../..//../..///test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../..//../..//../..//..///test-file.txt","suites":[],"updatePoint":{"line":4382,"column":77},"line":4382,"code":"  it('should prevent traversing with /../..//../..//../..//..///test-file.txt', async () => {\n    await expectStatus('/../..//../..//../..//..///test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /../..//../..//../..//../..///test-file.txt","suites":[],"updatePoint":{"line":4386,"column":80},"line":4386,"code":"  it('should prevent traversing with /../..//../..//../..//../..///test-file.txt', async () => {\n    await expectStatus('/../..//../..//../..//../..///test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\\\\\test-file.txt","suites":[],"updatePoint":{"line":4390,"column":59},"line":4390,"code":"  it('should prevent traversing with /..\\\\\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\\\\\test-file.txt","suites":[],"updatePoint":{"line":4394,"column":63},"line":4394,"code":"  it('should prevent traversing with /..\\\\..\\\\\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\\\..\\\\\\test-file.txt","suites":[],"updatePoint":{"line":4398,"column":69},"line":4398,"code":"  it('should prevent traversing with /..\\\\..\\\\\\\\..\\\\\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\\\\\..\\\\\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\\\..\\..\\\\\\test-file.txt","suites":[],"updatePoint":{"line":4402,"column":73},"line":4402,"code":"  it('should prevent traversing with /..\\\\..\\\\\\\\..\\\\..\\\\\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\\\\\..\\\\..\\\\\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\\\..\\..\\\\..\\\\\\test-file.txt","suites":[],"updatePoint":{"line":4406,"column":79},"line":4406,"code":"  it('should prevent traversing with /..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\\\..\\..\\\\..\\..\\\\\\test-file.txt","suites":[],"updatePoint":{"line":4410,"column":83},"line":4410,"code":"  it('should prevent traversing with /..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\..\\\\\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\..\\\\\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\\\..\\..\\\\..\\..\\\\..\\\\\\test-file.txt","suites":[],"updatePoint":{"line":4414,"column":89},"line":4414,"code":"  it('should prevent traversing with /..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\\\\\\\\\test-file.txt', async () => {\n    await expectStatus('/..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\\\\\\\\\test-file.txt')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /..\\..\\\\..\\..\\\\..\\..\\\\..\\..\\\\\\test-file.txt","suites":[],"updatePoint":{"line":4418,"column":93},"line":4418,"code":"  it('should prevent traversing with /..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\..\\\\\\\\\\\\test-file.txt', async () => {\n    await expectStatus(\n      '/..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\..\\\\\\\\..\\\\..\\\\\\\\\\\\test-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\..%2f","suites":[],"updatePoint":{"line":4424,"column":45},"line":4424,"code":"  it('should prevent traversing with /\\\\..%2f', async () => {\n    await expectStatus('/\\\\..%2f')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\..%2f\\..%2f","suites":[],"updatePoint":{"line":4428,"column":52},"line":4428,"code":"  it('should prevent traversing with /\\\\..%2f\\\\..%2f', async () => {\n    await expectStatus('/\\\\..%2f\\\\..%2f')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\..%2f\\..%2f\\..%2f","suites":[],"updatePoint":{"line":4432,"column":59},"line":4432,"code":"  it('should prevent traversing with /\\\\..%2f\\\\..%2f\\\\..%2f', async () => {\n    await expectStatus('/\\\\..%2f\\\\..%2f\\\\..%2f')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\..%2f\\..%2f\\..%2f\\..%2f","suites":[],"updatePoint":{"line":4436,"column":66},"line":4436,"code":"  it('should prevent traversing with /\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f', async () => {\n    await expectStatus('/\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\..%2f\\..%2f\\..%2f\\..%2f\\..%2f","suites":[],"updatePoint":{"line":4440,"column":73},"line":4440,"code":"  it('should prevent traversing with /\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f', async () => {\n    await expectStatus('/\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\..%2f\\..%2f\\..%2f\\..%2f\\..%2f\\..%2f","suites":[],"updatePoint":{"line":4444,"column":80},"line":4444,"code":"  it('should prevent traversing with /\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f', async () => {\n    await expectStatus('/\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\..%2f\\..%2f\\..%2f\\..%2f\\..%2f\\..%2f\\..%2f","suites":[],"updatePoint":{"line":4448,"column":87},"line":4448,"code":"  it('should prevent traversing with /\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f', async () => {\n    await expectStatus('/\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f')\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prevent traversing with /\\..%2f\\..%2f\\..%2f\\..%2f\\..%2f\\..%2f\\..%2f\\..%2ftest-file.txt","suites":[],"updatePoint":{"line":4452,"column":107},"line":4452,"code":"  it('should prevent traversing with /\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2ftest-file.txt', async () => {\n    await expectStatus(\n      '/\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2f\\\\..%2ftest-file.txt'\n    )\n  })","file":"integration/file-serving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not route to the index page","suites":["FileSystemPublicRoutes"],"updatePoint":{"line":32,"column":40},"line":32,"code":"  it('should not route to the index page', async () => {\n    const res = await fetch('/')\n    expect(res.status).toBe(404)\n    const body = await res.text()\n    expect(body).toMatch(/404/)\n  })","file":"integration/filesystempublicroutes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should route to exportPathMap defined routes in development","suites":["FileSystemPublicRoutes"],"updatePoint":{"line":39,"column":65},"line":39,"code":"  it('should route to exportPathMap defined routes in development', async () => {\n    const res = await fetch('/exportpathmap-route')\n    expect(res.status).toBe(200)\n    const body = await res.text()\n    expect(body).toMatch(/exportpathmap was here/)\n  })","file":"integration/filesystempublicroutes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should still handle /_next routes","suites":["FileSystemPublicRoutes"],"updatePoint":{"line":46,"column":39},"line":46,"code":"  it('should still handle /_next routes', async () => {\n    await fetch('/exportpathmap-route') // make sure it's built\n    const pageFile = getPageFileFromBuildManifest(\n      appDir,\n      '/exportpathmap-route'\n    )\n    const res = await fetch(join('/_next', pageFile))\n    expect(res.status).toBe(200)\n    const body = await res.text()\n    expect(body).toMatch(/exportpathmap was here/)\n  })","file":"integration/filesystempublicroutes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should route to public folder files","suites":["FileSystemPublicRoutes"],"updatePoint":{"line":58,"column":41},"line":58,"code":"  it('should route to public folder files', async () => {\n    const res = await fetch('/hello.txt')\n    expect(res.status).toBe(200)\n    const body = await res.text()\n    expect(body).toMatch(/hello/)\n  })","file":"integration/filesystempublicroutes/test/index.test.js","skipped":false,"dir":"test"},{"name":"Throws an error when building with firebase dependency with worker_threads","suites":["Building Firebase"],"line":12,"code":"  it.skip('Throws an error when building with firebase dependency with worker_threads', async () => {","file":"integration/firebase-grpc/test/index.test.js","skipped":true,"dir":"test"},{"name":"Throws no error when building with firebase dependency without worker_threads","suites":["Building Firebase"],"updatePoint":{"line":24,"column":83},"line":24,"code":"  it('Throws no error when building with firebase dependency without worker_threads', async () => {\n    await fs.remove(nextConfig)\n    const results = await nextBuild(appDir, [], { stdout: true, stderr: true })\n    expect(results.stdout + results.stderr).not.toMatch(/Build error occurred/)\n    expect(results.stdout + results.stderr).not.toMatch(\n      /grpc_node\\.node\\. Module did not self-register\\./\n    )\n  })","file":"integration/firebase-grpc/test/index.test.js","skipped":false,"dir":"test"},{"name":"with-%s","suites":["Font Optimization"],"line":40,"code":"  describe.each([\n    [\n      'google',\n      [\n        'https://fonts.googleapis.com/css?family=Voces',\n        'https://fonts.googleapis.com/css2?family=Modak',\n        'https://fonts.googleapis.com/css2?family=Roboto:wght@700',\n        'https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap',\n      ],\n      [\n        /<style data-href=\"https:\\/\\/fonts\\.googleapis\\.com\\/css\\?family=Voces\">.*<\\/style>/,\n        /<style data-href=\"https:\\/\\/fonts\\.googleapis\\.com\\/css2\\?family=Modak\">.*<\\/style>/,\n        /<style data-href=\"https:\\/\\/fonts\\.googleapis\\.com\\/css2\\?family=Roboto:wght@700\">.*<\\/style>/,\n        /<style data-href=\"https:\\/\\/fonts.googleapis.com\\/css2\\?family=Roboto:wght@400;700;900&display=swap\">.*<\\/style>/,\n      ],\n      'https://fonts.gstatic.com',\n    ],\n    [\n      'typekit',\n      [\n        'https://use.typekit.net/plm1izr.css',\n        'https://use.typekit.net/erd0sed.css',\n        'https://use.typekit.net/ucs7mcf.css',\n        'https://use.typekit.net/ucs7mcf.css',\n      ],\n      [\n        /<style data-href=\"https:\\/\\/use.typekit.net\\/plm1izr.css\">.*<\\/style>/,\n        /<style data-href=\"https:\\/\\/use.typekit.net\\/erd0sed.css\">.*<\\/style>/,\n        /<style data-href=\"https:\\/\\/use.typekit.net\\/ucs7mcf.css\">.*<\\/style>/,\n        /<style data-href=\"https:\\/\\/use.typekit.net\\/ucs7mcf.css\">.*<\\/style>/,\n      ],\n      'https://use.typekit.net',\n    ],\n  ])(\n    'with-%s',\n    (\n      property,\n      [staticFont, staticHeadFont, starsFont, withFont],\n      [staticPattern, staticHeadPattern, starsPattern, withFontPattern],\n      preconnectUrl\n    ) => {\n      const appDir = join(fixturesDir, `with-${property}`)\n      const nextConfig = join(appDir, 'next.config.js')\n      let builtServerPagesDir\n      let builtPage\n      let appPort\n      let app\n\n      function runTests() {\n        it('should pass nonce to the inlined font definition', async () => {\n          const html = await renderViaHTTP(appPort, '/nonce')\n          const $ = cheerio.load(html)\n          expect(await fsExists(builtPage('font-manifest.json'))).toBe(true)\n\n          const link = $(\n            `link[rel=\"stylesheet\"][data-href=\"${staticHeadFont}\"]`\n          )\n\n          const style = $(`style[data-href=\"${staticHeadFont}\"]`)\n          const styleNonce = style.attr('nonce')\n\n          expect(link.length).toBe(0)\n          expect(styleNonce).toBe('VmVyY2Vs')\n        })\n\n        it('should only inline included fonts per page', async () => {\n          const html = await renderViaHTTP(appPort, '/with-font')\n          expect(await fsExists(builtPage('font-manifest.json'))).toBe(true)\n\n          const $ = cheerio.load(html)\n\n          expect($(`link[data-href=\"${withFont}\"]`).length).toBe(0)\n\n          expect(html).toMatch(withFontPattern)\n\n          const htmlWithoutFont = await renderViaHTTP(appPort, '/without-font')\n          const $2 = cheerio.load(htmlWithoutFont)\n\n          expect($2(`link[data-href=\"${withFont}\"]`).length).toBe(0)\n          expect(htmlWithoutFont).not.toMatch(withFontPattern)\n        })\n\n        it(`should inline the ${property} fonts for static pages`, async () => {\n          const html = await renderViaHTTP(appPort, '/index')\n          const $ = cheerio.load(html)\n          expect(await fsExists(builtPage('font-manifest.json'))).toBe(true)\n          expect(\n            $(`link[rel=stylesheet][data-href=\"${staticFont}\"]`).length\n          ).toBe(0)\n          expect(html).toMatch(staticPattern)\n        })\n\n        it(`should inline the ${property} fonts for static pages with Next/Head`, async () => {\n          const html = await renderViaHTTP(appPort, '/static-head')\n          const $ = cheerio.load(html)\n          expect(await fsExists(builtPage('font-manifest.json'))).toBe(true)\n          expect(\n            $(`link[rel=stylesheet][data-href=\"${staticHeadFont}\"]`).length\n          ).toBe(0)\n          expect(html).toMatch(staticHeadPattern)\n        })\n\n        it(`should inline the ${property} fonts for SSR pages`, async () => {\n          const html = await renderViaHTTP(appPort, '/stars')\n          const $ = cheerio.load(html)\n          expect(await fsExists(builtPage('font-manifest.json'))).toBe(true)\n          expect(\n            $(`link[rel=stylesheet][data-href=\"${starsFont}\"]`).length\n          ).toBe(0)\n          expect(html).toMatch(starsPattern)\n        })\n\n        it(`should add preconnect tag`, async () => {\n          const html = await renderViaHTTP(appPort, '/stars')\n          const $ = cheerio.load(html)\n          expect(\n            $(`link[rel=preconnect][href=\"${preconnectUrl}\"]`).length\n          ).toBe(1)\n        })\n\n        it('should skip this optimization for AMP pages', async () => {\n          const html = await renderViaHTTP(appPort, '/amp')\n          const $ = cheerio.load(html)\n          expect(await fsExists(builtPage('font-manifest.json'))).toBe(true)\n          expect($(`link[rel=stylesheet][href=\"${staticFont}\"]`).length).toBe(1)\n          expect(html).not.toMatch(staticPattern)\n        })\n\n        it('should work for fonts loaded on navigation', async () => {\n          let browser\n          try {\n            browser = await webdriver(appPort, '/')\n            await waitFor(1000)\n\n            const baseFont = await browser.elementByCss(\n              `style[data-href=\"${staticFont}\"]`\n            )\n            expect(baseFont).toBeDefined()\n\n            await browser.waitForElementByCss('#with-font')\n            await browser.click('#with-font')\n\n            await browser.waitForElementByCss('#with-font-container')\n            const pageFontCss = await browser.elementsByCss(\n              `style[data-href=\"${withFont}\"]`\n            )\n            expect(pageFontCss.length).toBe(0)\n            const pageFont = await browser.elementByCss(\n              `link[href=\"${withFont}\"]`\n            )\n            expect(pageFont).toBeDefined()\n          } finally {\n            if (browser) await browser.close()\n          }\n        })\n\n        it('should minify the css', async () => {\n          const snapshotJson = JSON.parse(\n            await fs.readFile(join(appDir, 'manifest-snapshot.json'), {\n              encoding: 'utf-8',\n            })\n          )\n          const testJson = JSON.parse(\n            await fs.readFile(builtPage('font-manifest.json'), {\n              encoding: 'utf-8',\n            })\n          )\n          const normalizeContent = (content) => {\n            return content.replace(/\\/v[\\d]{1,}\\//g, '/v0/')\n          }\n          const testCss = {}\n          testJson.forEach((fontDefinition) => {\n            testCss[fontDefinition.url] = normalizeContent(\n              fontDefinition.content\n            )\n          })\n          const snapshotCss = {}\n          snapshotJson.forEach((fontDefinition) => {\n            snapshotCss[fontDefinition.url] = normalizeContent(\n              fontDefinition.content\n            )\n          })\n\n          expect(testCss).toStrictEqual(snapshotCss)\n        })\n\n        // Re-run build to check if it works when build is cached\n        it('should work when build is cached', async () => {\n          await nextBuild(appDir)\n          const testJson = JSON.parse(\n            await fs.readFile(builtPage('font-manifest.json'), {\n              encoding: 'utf-8',\n            })\n          )\n          expect(testJson.length).toBeGreaterThan(0)\n        })\n      }\n\n      describe('Font optimization for SSR apps', () => {\n        beforeAll(async () => {\n          if (fs.pathExistsSync(join(appDir, '.next'))) {\n            await fs.remove(join(appDir, '.next'))\n          }\n          await nextBuild(appDir)\n          appPort = await findPort()\n          app = await nextStart(appDir, appPort)\n          builtServerPagesDir = join(appDir, '.next', 'server')\n          builtPage = (file) => join(builtServerPagesDir, file)\n        })\n        afterAll(() => killApp(app))\n        runTests()\n      })\n\n      describe('Font optimization for serverless apps', () => {\n        const origNextConfig = fs.readFileSync(nextConfig)\n\n        beforeAll(async () => {\n          await fs.writeFile(\n            nextConfig,\n            `module.exports = ({ target: 'serverless', cleanDistDir: false })`,\n            'utf8'\n          )\n          await nextBuild(appDir)\n          appPort = await findPort()\n          app = await nextStart(appDir, appPort)\n          builtServerPagesDir = join(appDir, '.next', 'serverless')\n          builtPage = (file) => join(builtServerPagesDir, file)\n        })\n        afterAll(async () => {\n          await fs.writeFile(nextConfig, origNextConfig)\n          await killApp(app)\n        })\n        runTests()\n      })\n\n      describe('Font optimization for emulated serverless apps', () => {\n        const origNextConfig = fs.readFileSync(nextConfig)\n\n        beforeAll(async () => {\n          await fs.writeFile(\n            nextConfig,\n            `module.exports = ({ target: 'experimental-serverless-trace', cleanDistDir: false })`,\n            'utf8'\n          )\n          await nextBuild(appDir)\n          appPort = await findPort()\n          app = await startServerlessEmulator(appDir, appPort)\n          builtServerPagesDir = join(appDir, '.next', 'serverless')\n          builtPage = (file) => join(builtServerPagesDir, file)\n        })\n        afterAll(async () => {\n          await fs.writeFile(nextConfig, origNextConfig)\n          await killApp(app)\n        })\n        runTests()\n      })\n\n      describe('Font optimization for unreachable font definitions.', () => {\n        beforeAll(async () => {\n          await nextBuild(appDir)\n          await fs.writeFile(\n            join(appDir, '.next', 'server', 'font-manifest.json'),\n            '[]',\n            'utf8'\n          )\n          appPort = await findPort()\n          app = await nextStart(appDir, appPort)\n          builtServerPagesDir = join(appDir, '.next', 'serverless')\n          builtPage = (file) => join(builtServerPagesDir, file)\n        })\n        afterAll(() => killApp(app))\n        it('should fallback to normal stylesheet if the contents of the fonts are unreachable', async () => {\n          const html = await renderViaHTTP(appPort, '/stars')\n          expect(await fsExists(builtPage('font-manifest.json'))).toBe(true)\n          expect(html).toContain(`<link rel=\"stylesheet\" href=\"${starsFont}\"/>`)\n        })\n        it('should not inline multiple fallback link tag', async () => {\n          await renderViaHTTP(appPort, '/stars')\n          // second render to make sure that the page is requested more than once.\n          const html = await renderViaHTTP(appPort, '/stars')\n          expect(await fsExists(builtPage('font-manifest.json'))).toBe(true)\n          expect(html).not.toContain(\n            `<link rel=\"stylesheet\" href=\"${staticFont}\"/><link rel=\"stylesheet\" href=\"${starsFont}\"/><link rel=\"stylesheet\" href=\"${staticFont}\"/><link rel=\"stylesheet\" href=\"${starsFont}\"/>`\n          )\n        })\n      })\n    }\n  )","file":"integration/font-optimization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should pass nonce to the inlined font definition","suites":["Font Optimization"],"updatePoint":{"line":89,"column":60},"line":89,"code":"        it('should pass nonce to the inlined font definition', async () => {\n          const html = await renderViaHTTP(appPort, '/nonce')\n          const $ = cheerio.load(html)\n          expect(await fsExists(builtPage('font-manifest.json'))).toBe(true)\n\n          const link = $(\n            `link[rel=\"stylesheet\"][data-href=\"${staticHeadFont}\"]`\n          )\n\n          const style = $(`style[data-href=\"${staticHeadFont}\"]`)\n          const styleNonce = style.attr('nonce')\n\n          expect(link.length).toBe(0)\n          expect(styleNonce).toBe('VmVyY2Vs')\n        })","file":"integration/font-optimization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should only inline included fonts per page","suites":["Font Optimization"],"updatePoint":{"line":105,"column":54},"line":105,"code":"        it('should only inline included fonts per page', async () => {\n          const html = await renderViaHTTP(appPort, '/with-font')\n          expect(await fsExists(builtPage('font-manifest.json'))).toBe(true)\n\n          const $ = cheerio.load(html)\n\n          expect($(`link[data-href=\"${withFont}\"]`).length).toBe(0)\n\n          expect(html).toMatch(withFontPattern)\n\n          const htmlWithoutFont = await renderViaHTTP(appPort, '/without-font')\n          const $2 = cheerio.load(htmlWithoutFont)\n\n          expect($2(`link[data-href=\"${withFont}\"]`).length).toBe(0)\n          expect(htmlWithoutFont).not.toMatch(withFontPattern)\n        })","file":"integration/font-optimization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should inline the  fonts for static pages","suites":["Font Optimization"],"updatePoint":{"line":122,"column":64},"line":122,"code":"        it(`should inline the ${property} fonts for static pages`, async () => {\n          const html = await renderViaHTTP(appPort, '/index')\n          const $ = cheerio.load(html)\n          expect(await fsExists(builtPage('font-manifest.json'))).toBe(true)\n          expect(\n            $(`link[rel=stylesheet][data-href=\"${staticFont}\"]`).length\n          ).toBe(0)\n          expect(html).toMatch(staticPattern)\n        })","file":"integration/font-optimization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should inline the  fonts for static pages with Next/Head","suites":["Font Optimization"],"updatePoint":{"line":132,"column":79},"line":132,"code":"        it(`should inline the ${property} fonts for static pages with Next/Head`, async () => {\n          const html = await renderViaHTTP(appPort, '/static-head')\n          const $ = cheerio.load(html)\n          expect(await fsExists(builtPage('font-manifest.json'))).toBe(true)\n          expect(\n            $(`link[rel=stylesheet][data-href=\"${staticHeadFont}\"]`).length\n          ).toBe(0)\n          expect(html).toMatch(staticHeadPattern)\n        })","file":"integration/font-optimization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should inline the  fonts for SSR pages","suites":["Font Optimization"],"updatePoint":{"line":142,"column":61},"line":142,"code":"        it(`should inline the ${property} fonts for SSR pages`, async () => {\n          const html = await renderViaHTTP(appPort, '/stars')\n          const $ = cheerio.load(html)\n          expect(await fsExists(builtPage('font-manifest.json'))).toBe(true)\n          expect(\n            $(`link[rel=stylesheet][data-href=\"${starsFont}\"]`).length\n          ).toBe(0)\n          expect(html).toMatch(starsPattern)\n        })","file":"integration/font-optimization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should add preconnect tag","suites":["Font Optimization"],"updatePoint":{"line":152,"column":37},"line":152,"code":"        it(`should add preconnect tag`, async () => {\n          const html = await renderViaHTTP(appPort, '/stars')\n          const $ = cheerio.load(html)\n          expect(\n            $(`link[rel=preconnect][href=\"${preconnectUrl}\"]`).length\n          ).toBe(1)\n        })","file":"integration/font-optimization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should skip this optimization for AMP pages","suites":["Font Optimization"],"updatePoint":{"line":160,"column":55},"line":160,"code":"        it('should skip this optimization for AMP pages', async () => {\n          const html = await renderViaHTTP(appPort, '/amp')\n          const $ = cheerio.load(html)\n          expect(await fsExists(builtPage('font-manifest.json'))).toBe(true)\n          expect($(`link[rel=stylesheet][href=\"${staticFont}\"]`).length).toBe(1)\n          expect(html).not.toMatch(staticPattern)\n        })","file":"integration/font-optimization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work for fonts loaded on navigation","suites":["Font Optimization"],"updatePoint":{"line":168,"column":54},"line":168,"code":"        it('should work for fonts loaded on navigation', async () => {\n          let browser\n          try {\n            browser = await webdriver(appPort, '/')\n            await waitFor(1000)\n\n            const baseFont = await browser.elementByCss(\n              `style[data-href=\"${staticFont}\"]`\n            )\n            expect(baseFont).toBeDefined()\n\n            await browser.waitForElementByCss('#with-font')\n            await browser.click('#with-font')\n\n            await browser.waitForElementByCss('#with-font-container')\n            const pageFontCss = await browser.elementsByCss(\n              `style[data-href=\"${withFont}\"]`\n            )\n            expect(pageFontCss.length).toBe(0)\n            const pageFont = await browser.elementByCss(\n              `link[href=\"${withFont}\"]`\n            )\n            expect(pageFont).toBeDefined()\n          } finally {\n            if (browser) await browser.close()\n          }\n        })","file":"integration/font-optimization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should minify the css","suites":["Font Optimization"],"updatePoint":{"line":196,"column":33},"line":196,"code":"        it('should minify the css', async () => {\n          const snapshotJson = JSON.parse(\n            await fs.readFile(join(appDir, 'manifest-snapshot.json'), {\n              encoding: 'utf-8',\n            })\n          )\n          const testJson = JSON.parse(\n            await fs.readFile(builtPage('font-manifest.json'), {\n              encoding: 'utf-8',\n            })\n          )\n          const normalizeContent = (content) => {\n            return content.replace(/\\/v[\\d]{1,}\\//g, '/v0/')\n          }\n          const testCss = {}\n          testJson.forEach((fontDefinition) => {\n            testCss[fontDefinition.url] = normalizeContent(\n              fontDefinition.content\n            )\n          })\n          const snapshotCss = {}\n          snapshotJson.forEach((fontDefinition) => {\n            snapshotCss[fontDefinition.url] = normalizeContent(\n              fontDefinition.content\n            )\n          })\n\n          expect(testCss).toStrictEqual(snapshotCss)\n        })","file":"integration/font-optimization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work when build is cached","suites":["Font Optimization"],"updatePoint":{"line":227,"column":44},"line":227,"code":"        it('should work when build is cached', async () => {\n          await nextBuild(appDir)\n          const testJson = JSON.parse(\n            await fs.readFile(builtPage('font-manifest.json'), {\n              encoding: 'utf-8',\n            })\n          )\n          expect(testJson.length).toBeGreaterThan(0)\n        })","file":"integration/font-optimization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fallback to normal stylesheet if the contents of the fonts are unreachable","suites":["Font Optimization","Font optimization for unreachable font definitions."],"updatePoint":{"line":311,"column":93},"line":311,"code":"        it('should fallback to normal stylesheet if the contents of the fonts are unreachable', async () => {\n          const html = await renderViaHTTP(appPort, '/stars')\n          expect(await fsExists(builtPage('font-manifest.json'))).toBe(true)\n          expect(html).toContain(`<link rel=\"stylesheet\" href=\"${starsFont}\"/>`)\n        })","file":"integration/font-optimization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not inline multiple fallback link tag","suites":["Font Optimization","Font optimization for unreachable font definitions."],"updatePoint":{"line":316,"column":56},"line":316,"code":"        it('should not inline multiple fallback link tag', async () => {\n          await renderViaHTTP(appPort, '/stars')\n          // second render to make sure that the page is requested more than once.\n          const html = await renderViaHTTP(appPort, '/stars')\n          expect(await fsExists(builtPage('font-manifest.json'))).toBe(true)\n          expect(html).not.toContain(\n            `<link rel=\"stylesheet\" href=\"${staticFont}\"/><link rel=\"stylesheet\" href=\"${starsFont}\"/><link rel=\"stylesheet\" href=\"${staticFont}\"/><link rel=\"stylesheet\" href=\"${starsFont}\"/>`\n          )\n        })","file":"integration/font-optimization/test/index.test.js","skipped":false,"dir":"test"},{"name":"Spread operator regression on <link>","suites":["Font Optimization","Font optimization for unreachable font definitions."],"updatePoint":{"line":329,"column":44},"line":329,"code":"  test('Spread operator regression on <link>', async () => {\n    const appDir = join(fixturesDir, 'spread-operator-regression')\n    const { code } = await nextBuild(appDir)\n    expect(code).toBe(0)\n  })","file":"integration/font-optimization/test/index.test.js","skipped":false,"dir":"test"},{"name":"makeStylesheetInert regression","suites":["Font Optimization","Font optimization for unreachable font definitions."],"updatePoint":{"line":335,"column":38},"line":335,"code":"  test('makeStylesheetInert regression', async () => {\n    const appDir = join(fixturesDir, 'make-stylesheet-inert-regression')\n    const { code } = await nextBuild(appDir)\n    expect(code).toBe(0)\n  })","file":"integration/font-optimization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should load momentjs","suites":["excludeDefaultMomentLocales"],"updatePoint":{"line":32,"column":26},"line":32,"code":"  it('should load momentjs', async () => {\n    const browser = await webdriver(appPort, '/')\n    expect(await browser.elementByCss('h1').text()).toMatch(/current time/i)\n    const locales = await browser.eval('moment.locales()')\n    expect(locales).toEqual(['en'])\n    expect(locales.length).toBe(1)\n    await browser.close()\n  })","file":"integration/future/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have gip in __NEXT_DATA__","suites":[],"updatePoint":{"line":19,"column":38},"line":19,"code":"  it('should have gip in __NEXT_DATA__', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(html)\n    expect(JSON.parse($('#__NEXT_DATA__').text()).gip).toBe(true)\n  })","file":"integration/getinitialprops/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have gip in __NEXT_DATA__ for non-GIP page","suites":[],"updatePoint":{"line":25,"column":59},"line":25,"code":"  it('should not have gip in __NEXT_DATA__ for non-GIP page', async () => {\n    const html = await renderViaHTTP(appPort, '/normal')\n    const $ = cheerio.load(html)\n    expect('gip' in JSON.parse($('#__NEXT_DATA__').text())).toBe(false)\n  })","file":"integration/getinitialprops/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct router.asPath for direct visit dynamic page","suites":[],"updatePoint":{"line":31,"column":69},"line":31,"code":"  it('should have correct router.asPath for direct visit dynamic page', async () => {\n    const html = await renderViaHTTP(appPort, '/blog/1')\n    const $ = cheerio.load(html)\n    expect($('#as-path').text()).toBe('/blog/1')\n  })","file":"integration/getinitialprops/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct router.asPath for direct visit dynamic page rewrite direct","suites":[],"updatePoint":{"line":37,"column":84},"line":37,"code":"  it('should have correct router.asPath for direct visit dynamic page rewrite direct', async () => {\n    const html = await renderViaHTTP(appPort, '/blog/post/1')\n    const $ = cheerio.load(html)\n    expect($('#as-path').text()).toBe('/blog/post/1')\n  })","file":"integration/getinitialprops/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build successfully","suites":[],"updatePoint":{"line":11,"column":31},"line":11,"code":"  it('should build successfully', async () => {\n    const { stdout, code } = await nextBuild(appDir, [], { stdout: true })\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/getserversideprops-export-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show error for GSSP during export","suites":[],"updatePoint":{"line":17,"column":46},"line":17,"code":"  it('should show error for GSSP during export', async () => {\n    const { stderr, code } = await nextExport(\n      appDir,\n      { outdir: join(appDir, 'out') },\n      { stderr: true }\n    )\n\n    expect(code).toBe(1)\n    expect(stderr).toMatch(\n      /pages with `getServerSideProps` can not be exported\\. See more info here: https/\n    )\n  })","file":"integration/getserversideprops-export-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":[],"updatePoint":{"line":41,"column":33},"line":41,"code":"  it('should compile successfully', async () => {\n    await fs.remove(join(appDir, '.next'))\n    const { code, stdout } = await nextBuild(appDir, [], {\n      stdout: true,\n    })\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/getserversideprops-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should start production application","suites":[],"updatePoint":{"line":51,"column":41},"line":51,"code":"  it('should start production application', async () => {\n    appPort = await findPort()\n    app = await startServer(appDir, appPort)\n  })","file":"integration/getserversideprops-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return page on first request","suites":[],"updatePoint":{"line":56,"column":41},"line":56,"code":"  it('should return page on first request', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    const { nextData, pre, routerData } = getData(html)\n    expect(nextData).toMatchObject({ isFallback: false })\n    expect(nextData.isPreview).toBeUndefined()\n    expect(pre).toBe('false and null')\n    expect(routerData.isPreview).toBe(false)\n  })","file":"integration/getserversideprops-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return page on second request","suites":[],"updatePoint":{"line":65,"column":42},"line":65,"code":"  it('should return page on second request', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    const { nextData, pre, routerData } = getData(html)\n    expect(nextData).toMatchObject({ isFallback: false })\n    expect(nextData.isPreview).toBeUndefined()\n    expect(pre).toBe('false and null')\n    expect(routerData.isPreview).toBe(false)\n  })","file":"integration/getserversideprops-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should enable preview mode","suites":[],"updatePoint":{"line":75,"column":32},"line":75,"code":"  it('should enable preview mode', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/preview', { lets: 'goooo' })\n    expect(res.status).toBe(200)\n\n    const originalCookies = res.headers.get('set-cookie').split(',')\n    const cookies = originalCookies.map(cookie.parse)\n\n    expect(originalCookies.every((c) => c.includes('; Secure;'))).toBe(true)\n\n    expect(cookies.length).toBe(2)\n    expect(cookies[0]).toMatchObject({ Path: '/', SameSite: 'None' })\n    expect(cookies[0]).toHaveProperty('__prerender_bypass')\n    expect(cookies[0]).not.toHaveProperty('Max-Age')\n    expect(cookies[1]).toMatchObject({ Path: '/', SameSite: 'None' })\n    expect(cookies[1]).toHaveProperty('__next_preview_data')\n    expect(cookies[1]).not.toHaveProperty('Max-Age')\n\n    previewCookieString =\n      cookie.serialize('__prerender_bypass', cookies[0].__prerender_bypass) +\n      '; ' +\n      cookie.serialize('__next_preview_data', cookies[1].__next_preview_data)\n  })","file":"integration/getserversideprops-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not return fallback page on preview request","suites":[],"updatePoint":{"line":98,"column":56},"line":98,"code":"  it('should not return fallback page on preview request', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/',\n      {},\n      { headers: { Cookie: previewCookieString } }\n    )\n    const html = await res.text()\n\n    const { nextData, pre, routerData } = getData(html)\n    expect(res.headers.get('cache-control')).toBe(\n      'private, no-cache, no-store, max-age=0, must-revalidate'\n    )\n    expect(nextData).toMatchObject({ isFallback: false, isPreview: true })\n    expect(pre).toBe('true and {\"lets\":\"goooo\"}')\n    expect(routerData.isPreview).toBe(true)\n  })","file":"integration/getserversideprops-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return correct caching headers for data preview request","suites":[],"updatePoint":{"line":116,"column":68},"line":116,"code":"  it('should return correct caching headers for data preview request', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${encodeURI(await getBuildId())}/index.json`,\n      {},\n      { headers: { Cookie: previewCookieString } }\n    )\n    const json = await res.json()\n\n    expect(res.headers.get('cache-control')).toBe(\n      'private, no-cache, no-store, max-age=0, must-revalidate'\n    )\n    expect(json).toMatchObject({\n      pageProps: {\n        preview: true,\n        previewData: { lets: 'goooo' },\n      },\n    })\n  })","file":"integration/getserversideprops-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return cookies to be expired on reset request","suites":[],"updatePoint":{"line":136,"column":58},"line":136,"code":"  it('should return cookies to be expired on reset request', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/api/reset',\n      {},\n      { headers: { Cookie: previewCookieString } }\n    )\n    expect(res.status).toBe(200)\n\n    const cookies = res.headers\n      .get('set-cookie')\n      .replace(/(=(?!Lax)\\w{3}),/g, '$1')\n      .split(',')\n      .map(cookie.parse)\n\n    expect(cookies.length).toBe(2)\n    expect(cookies[0]).toMatchObject({\n      Path: '/',\n      SameSite: 'None',\n      Expires: 'Thu 01 Jan 1970 00:00:00 GMT',\n    })\n    expect(cookies[0]).toHaveProperty('__prerender_bypass')\n    expect(cookies[0]).not.toHaveProperty('Max-Age')\n    expect(cookies[1]).toMatchObject({\n      Path: '/',\n      SameSite: 'None',\n      Expires: 'Thu 01 Jan 1970 00:00:00 GMT',\n    })\n    expect(cookies[1]).toHaveProperty('__next_preview_data')\n    expect(cookies[1]).not.toHaveProperty('Max-Age')\n  })","file":"integration/getserversideprops-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should throw error when setting too large of preview data","suites":[],"updatePoint":{"line":168,"column":63},"line":168,"code":"  it('should throw error when setting too large of preview data', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/preview?tooBig=true')\n    expect(res.status).toBe(500)\n    expect(await res.text()).toBe('too big')\n  })","file":"integration/getserversideprops-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should start development application","suites":["ServerSide Props Preview Mode","Development Mode"],"updatePoint":{"line":196,"column":44},"line":196,"code":"    it('should start development application', async () => {\n      appPort = await findPort()\n      app = await launchApp(appDir, appPort)\n    })","file":"integration/getserversideprops-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should enable preview mode","suites":["ServerSide Props Preview Mode","Development Mode"],"updatePoint":{"line":202,"column":34},"line":202,"code":"    it('should enable preview mode', async () => {\n      const res = await fetchViaHTTP(appPort, '/api/preview', { lets: 'goooo' })\n      expect(res.status).toBe(200)\n\n      const cookies = res.headers.get('set-cookie').split(',').map(cookie.parse)\n\n      expect(cookies.length).toBe(2)\n      previewCookieString =\n        cookie.serialize('__prerender_bypass', cookies[0].__prerender_bypass) +\n        '; ' +\n        cookie.serialize('__next_preview_data', cookies[1].__next_preview_data)\n    })","file":"integration/getserversideprops-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return cookies to be expired after dev server reboot","suites":["ServerSide Props Preview Mode","Development Mode"],"updatePoint":{"line":215,"column":67},"line":215,"code":"    it('should return cookies to be expired after dev server reboot', async () => {\n      await killApp(app)\n      app = await launchApp(appDir, appPort)\n\n      const res = await fetchViaHTTP(\n        appPort,\n        '/',\n        {},\n        { headers: { Cookie: previewCookieString } }\n      )\n      expect(res.status).toBe(200)\n\n      const body = await res.text()\n      // \"err\":{\"name\":\"TypeError\",\"message\":\"Cannot read property 'previewModeId' of undefined\"\n      expect(body).not.toContain('err')\n      expect(body).not.toContain('TypeError')\n      expect(body).not.toContain('previewModeId')\n\n      const cookies = res.headers\n        .get('set-cookie')\n        .replace(/(=(?!Lax)\\w{3}),/g, '$1')\n        .split(',')\n        .map(cookie.parse)\n\n      expect(cookies.length).toBe(2)\n    })","file":"integration/getserversideprops-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should start the client-side browser","suites":["ServerSide Props Preview Mode","Development Mode"],"updatePoint":{"line":244,"column":44},"line":244,"code":"    it('should start the client-side browser', async () => {\n      browser = await webdriver(\n        appPort,\n        '/api/preview?' + qs.stringify({ client: 'mode' })\n      )\n    })","file":"integration/getserversideprops-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fetch preview data on SSR","suites":["ServerSide Props Preview Mode","Development Mode"],"updatePoint":{"line":251,"column":40},"line":251,"code":"    it('should fetch preview data on SSR', async () => {\n      await browser.get(`http://localhost:${appPort}/`)\n      await browser.waitForElementByCss('#props-pre')\n      // expect(await browser.elementById('props-pre').text()).toBe('Has No Props')\n      // await new Promise(resolve => setTimeout(resolve, 2000))\n      expect(await browser.elementById('props-pre').text()).toBe(\n        'true and {\"client\":\"mode\"}'\n      )\n    })","file":"integration/getserversideprops-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fetch preview data on CST","suites":["ServerSide Props Preview Mode","Development Mode"],"updatePoint":{"line":261,"column":40},"line":261,"code":"    it('should fetch preview data on CST', async () => {\n      await browser.get(`http://localhost:${appPort}/to-index`)\n      await browser.waitForElementByCss('#to-index')\n      await browser.eval('window.itdidnotrefresh = \"hello\"')\n      await browser.elementById('to-index').click()\n      await browser.waitForElementByCss('#props-pre')\n      expect(await browser.eval('window.itdidnotrefresh')).toBe('hello')\n      expect(await browser.elementById('props-pre').text()).toBe(\n        'true and {\"client\":\"mode\"}'\n      )\n    })","file":"integration/getserversideprops-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fetch prerendered data","suites":["ServerSide Props Preview Mode","Development Mode"],"updatePoint":{"line":273,"column":37},"line":273,"code":"    it('should fetch prerendered data', async () => {\n      await browser.get(`http://localhost:${appPort}/api/reset`)\n\n      await browser.get(`http://localhost:${appPort}/`)\n      await browser.waitForElementByCss('#props-pre')\n      expect(await browser.elementById('props-pre').text()).toBe(\n        'false and null'\n      )\n    })","file":"integration/getserversideprops-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have gip or appGip in NEXT_DATA for page without getInitialProps","suites":[],"updatePoint":{"line":40,"column":81},"line":40,"code":"  it('should not have gip or appGip in NEXT_DATA for page without getInitialProps', async () => {\n    const data = await getData()\n    expect(data.gip).toBe(undefined)\n    expect(data.appGip).toBe(undefined)\n  })","file":"integration/gip-identifier/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have gip in NEXT_DATA for page with getInitialProps","suites":[],"updatePoint":{"line":46,"column":64},"line":46,"code":"  it('should have gip in NEXT_DATA for page with getInitialProps', async () => {\n    indexPageContent = await fs.readFile(indexPage, 'utf8')\n    await fs.writeFile(\n      indexPage,\n      `\n      const Page = () => 'hi'\n      Page.getInitialProps = () => ({ hello: 'world' })\n      export default Page\n    `\n    )\n    const data = await getData()\n    expect(data.gip).toBe(true)\n  })","file":"integration/gip-identifier/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have gip and appGip in NEXT_DATA for page with getInitialProps and _app with getInitialProps","suites":[],"updatePoint":{"line":60,"column":105},"line":60,"code":"  it('should have gip and appGip in NEXT_DATA for page with getInitialProps and _app with getInitialProps', async () => {\n    await fs.writeFile(\n      appPage,\n      `\n      const App = ({ Component, pageProps }) => <Component {...pageProps} />\n      App.getInitialProps = async (ctx) => {\n        let pageProps = {}\n        if (ctx.Component.getInitialProps) {\n          pageProps = await ctx.Component.getInitialProps(ctx.ctx)\n        }\n        return { pageProps }\n      }\n      export default App\n    `\n    )\n    const data = await getData()\n    expect(data.gip).toBe(true)\n    expect(data.appGip).toBe(true)\n  })","file":"integration/gip-identifier/test/index.test.js","skipped":false,"dir":"test"},{"name":"should only have appGip in NEXT_DATA for page without getInitialProps and _app with getInitialProps","suites":[],"updatePoint":{"line":80,"column":105},"line":80,"code":"  it('should only have appGip in NEXT_DATA for page without getInitialProps and _app with getInitialProps', async () => {\n    await fs.writeFile(indexPage, indexPageContent)\n    const data = await getData()\n    await fs.remove(appPage)\n    expect(data.gip).toBe(undefined)\n    expect(data.appGip).toBe(true)\n  })","file":"integration/gip-identifier/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail build from module not found","suites":["GSP build errors"],"updatePoint":{"line":18,"column":45},"line":18,"code":"  it('should fail build from module not found', async () => {\n    await writePage(`\n      __non_webpack_require__('a-cool-module')\n      \n      export function getStaticProps() {\n        return {\n          props: {}\n        }  \n      }\n      \n      export default function () {\n        return null\n      }\n    `)\n    const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n    expect(code).toBe(1)\n    expect(stderr).toContain('a-cool-module')\n  })","file":"integration/gsp-build-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail build from ENOENT in getStaticProps","suites":["GSP build errors"],"updatePoint":{"line":37,"column":53},"line":37,"code":"  it('should fail build from ENOENT in getStaticProps', async () => {\n    await writePage(`\n      \n      export function getStaticProps() {\n        require('fs').readFileSync('a-cool-file')\n        return {\n          props: {}\n        }  \n      }\n      \n      export default function () {\n        return null\n      }\n    `)\n    const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n    expect(code).toBe(1)\n    expect(stderr).toContain('a-cool-file')\n  })","file":"integration/gsp-build-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail build on normal error in getStaticProps","suites":["GSP build errors"],"updatePoint":{"line":56,"column":57},"line":56,"code":"  it('should fail build on normal error in getStaticProps', async () => {\n    await writePage(`\n      export function getStaticProps() {\n        throw new Error('a cool error')\n        return {\n          props: {}\n        }  \n      }\n      \n      export default function () {\n        return null\n      }\n    `)\n    const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n    expect(code).toBe(1)\n    expect(stderr).toContain('a cool error')\n  })","file":"integration/gsp-build-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail build from undefined error in getStaticProps","suites":["GSP build errors"],"updatePoint":{"line":74,"column":62},"line":74,"code":"  it('should fail build from undefined error in getStaticProps', async () => {\n    await writePage(`\n      export function getStaticProps() {\n        throw undefined\n        return {\n          props: {}\n        }  \n      }\n      \n      export default function () {\n        return null\n      }\n    `)\n    const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n    expect(code).toBe(1)\n    expect(stderr).toContain('undefined')\n  })","file":"integration/gsp-build-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail build from string error in getStaticProps","suites":["GSP build errors"],"updatePoint":{"line":92,"column":59},"line":92,"code":"  it('should fail build from string error in getStaticProps', async () => {\n    await writePage(`\n      export function getStaticProps() {\n        throw 'a string error'\n        return {\n          props: {}\n        }  \n      }\n      \n      export default function () {\n        return null\n      }\n    `)\n    const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n    expect(code).toBe(1)\n    expect(stderr).toContain('a string error')\n  })","file":"integration/gsp-build-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle non-serializable error in getStaticProps","suites":["GSP build errors"],"updatePoint":{"line":110,"column":60},"line":110,"code":"  it('should handle non-serializable error in getStaticProps', async () => {\n    await writePage(`\n      export function getStaticProps() {\n        const err = new Error('my custom error')\n        err.hello = 'world'\n        err.a = [1,2,3]\n        err.original = err\n        err.b = err.a\n        \n        throw err\n        \n        return {\n          props: {}\n        }  \n      }\n      \n      export default function () {\n        return null\n      }\n    `)\n    const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n    expect(code).toBe(1)\n    expect(stderr).toContain('my custom error')\n  })","file":"integration/gsp-build-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle non-serializable error in getStaticPaths","suites":["GSP build errors"],"updatePoint":{"line":135,"column":60},"line":135,"code":"  it('should handle non-serializable error in getStaticPaths', async () => {\n    await writePage(\n      `\n      export function getStaticProps() {\n        return {\n          props: {}\n        }  \n      }\n      \n      export function getStaticPaths() {\n        const err = new Error('my custom error')\n        err.hello = 'world'\n        err.a = [1,2,3]\n        err.original = err\n        err.b = err.a\n        \n        throw err\n        \n        return {\n          paths: [],\n          fallback: true\n        }\n      }\n      \n      export default function () {\n        return null\n      }\n    `,\n      join(pagesDir, '[slug].js')\n    )\n    const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n    expect(code).toBe(1)\n    expect(stderr).toContain('my custom error')\n  })","file":"integration/gsp-build-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"should support slug with different extensions","suites":["GS(S)P with file extension"],"updatePoint":{"line":31,"column":51},"line":31,"code":"  it('should support slug with different extensions', async () => {\n    const baseDir = join(appDir, '.next/server/pages')\n    fileNames.forEach((name) => {\n      const filePath = join(baseDir, name)\n      expect(fs.existsSync(filePath + '.html')).toBe(true)\n      expect(fs.existsSync(filePath + '.json')).toBe(true)\n    })\n  })","file":"integration/gsp-extension/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render properly for routes with extension","suites":["GS(S)P with file extension"],"updatePoint":{"line":40,"column":54},"line":40,"code":"  it('should render properly for routes with extension', async () => {\n    const paths = fileNames.map((name) => `/${name}`)\n    const contentPromises = paths.map((path) => renderViaHTTP(appPort, path))\n    const contents = await Promise.all(contentPromises)\n    contents.forEach((content, i) => expect(content).toContain(fileNames[i]))\n  })","file":"integration/gsp-extension/test/index.test.js","skipped":false,"dir":"test"},{"name":"should contain extension in name of json files in _next/data","suites":["GS(S)P with file extension"],"updatePoint":{"line":47,"column":66},"line":47,"code":"  it('should contain extension in name of json files in _next/data', async () => {\n    const buildId = await fs.readFile(join(appDir, '.next/BUILD_ID'), 'utf8')\n    const requests = fileNames.map((name) => {\n      const pathname = `/_next/data/${buildId}/${name}.json`\n      return fetchViaHTTP(appPort, pathname).then((r) => r.json())\n    })\n    const results = await Promise.all(requests)\n    results.forEach((result, i) =>\n      expect(result.pageProps.value).toBe(fileNames[i])\n    )\n  })","file":"integration/gsp-extension/test/index.test.js","skipped":false,"dir":"test"},{"name":"should merge _app pageProps and getServerSideProps props","suites":[],"updatePoint":{"line":22,"column":62},"line":22,"code":"  it('should merge _app pageProps and getServerSideProps props', async () => {\n    const html = await renderViaHTTP(appPort, '/gssp')\n    const $ = cheerio.load(html)\n    expect(JSON.parse($('p').text())).toEqual({ hi: 'hi', hello: 'world' })\n  })","file":"integration/gssp-pageProps-merge/test/index.test.js","skipped":false,"dir":"test"},{"name":"should merge _app pageProps and getStaticProps props","suites":[],"updatePoint":{"line":28,"column":58},"line":28,"code":"  it('should merge _app pageProps and getStaticProps props', async () => {\n    const html = await renderViaHTTP(appPort, '/gsp')\n    const $ = cheerio.load(html)\n    expect(JSON.parse($('p').text())).toEqual({ hi: 'hi', hello: 'world' })\n  })","file":"integration/gssp-pageProps-merge/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply temporary redirect when visited directly for GSSP page","suites":[],"updatePoint":{"line":27,"column":73},"line":27,"code":"  it('should apply temporary redirect when visited directly for GSSP page', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      `${basePath}/gssp-blog/redirect-1`,\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n    expect(res.status).toBe(307)\n\n    const { pathname } = url.parse(res.headers.get('location'))\n\n    expect(pathname).toBe(`${basePath}/404`)\n  })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply temporary redirect when visited directly basePath false for GSSP page","suites":[],"updatePoint":{"line":43,"column":88},"line":43,"code":"  it('should apply temporary redirect when visited directly basePath false for GSSP page', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      `${basePath}/gssp-blog/redirect-1-no-basepath-`,\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n    expect(res.status).toBe(307)\n\n    const text = await res.text()\n    expect(text).toEqual(`/404`)\n\n    const parsedUrl = url.parse(res.headers.get('location'))\n    expect(parsedUrl.pathname).toBe(`/404`)\n\n    const browser = await webdriver(appPort, `${basePath}`)\n    await browser.eval(`next.router.push('/gssp-blog/redirect-1-no-basepath-')`)\n    await check(\n      () => browser.eval('document.documentElement.innerHTML'),\n      /oops not found/\n    )\n\n    const parsedUrl2 = url.parse(await browser.eval('window.location.href'))\n    expect(parsedUrl2.pathname).toBe('/404')\n  })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply permanent redirect when visited directly for GSSP page","suites":[],"updatePoint":{"line":71,"column":73},"line":71,"code":"  it('should apply permanent redirect when visited directly for GSSP page', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      `${basePath}/gssp-blog/redirect-permanent`,\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n    expect(res.status).toBe(308)\n\n    const text = await res.text()\n    expect(text).toEqual(`${basePath}/404`)\n\n    const { pathname } = url.parse(res.headers.get('location'))\n\n    expect(pathname).toBe(`${basePath}/404`)\n    expect(res.headers.get('refresh')).toContain(`url=${basePath}/404`)\n  })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply statusCode 301 redirect when visited directly for GSSP page","suites":[],"updatePoint":{"line":91,"column":78},"line":91,"code":"  it('should apply statusCode 301 redirect when visited directly for GSSP page', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      `${basePath}/gssp-blog/redirect-statusCode-301`,\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n    expect(res.status).toBe(301)\n\n    const text = await res.text()\n    expect(text).toEqual(`${basePath}/404`)\n\n    const { pathname } = url.parse(res.headers.get('location'))\n\n    expect(pathname).toBe(`${basePath}/404`)\n    expect(res.headers.get('refresh')).toBe(null)\n  })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply statusCode 303 redirect when visited directly for GSSP page","suites":[],"updatePoint":{"line":111,"column":78},"line":111,"code":"  it('should apply statusCode 303 redirect when visited directly for GSSP page', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      `${basePath}/gssp-blog/redirect-statusCode-303`,\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n    expect(res.status).toBe(303)\n\n    const text = await res.text()\n    expect(text).toEqual(`${basePath}/404`)\n\n    const { pathname } = url.parse(res.headers.get('location'))\n\n    expect(pathname).toBe(`${basePath}/404`)\n    expect(res.headers.get('refresh')).toBe(null)\n  })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when fallback GSP page is visited directly (internal dynamic)","suites":[],"updatePoint":{"line":131,"column":89},"line":131,"code":"  it('should apply redirect when fallback GSP page is visited directly (internal dynamic)', async () => {\n    const browser = await webdriver(\n      appPort,\n      `${basePath}/gsp-blog/redirect-dest-_gsp-blog_first`,\n      {\n        retryWaitHydration: true,\n      }\n    )\n\n    await browser.waitForElementByCss('#gsp')\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props).toEqual({\n      params: {\n        post: 'first',\n      },\n    })\n    const initialHref = await browser.eval(() => window.initialHref)\n    const { pathname } = url.parse(initialHref)\n    expect(pathname).toBe(`${basePath}/gsp-blog/redirect-dest-_gsp-blog_first`)\n  })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when fallback GSP page is visited directly (internal dynamic) 2nd visit","suites":[],"updatePoint":{"line":154,"column":101},"line":154,"code":"    it('should apply redirect when fallback GSP page is visited directly (internal dynamic) 2nd visit', async () => {\n      const browser = await webdriver(\n        appPort,\n        `${basePath}/gsp-blog/redirect-dest-_gsp-blog_first`,\n        {\n          retryWaitHydration: true,\n        }\n      )\n\n      await browser.waitForElementByCss('#gsp')\n\n      const props = JSON.parse(await browser.elementByCss('#props').text())\n      expect(props).toEqual({\n        params: {\n          post: 'first',\n        },\n      })\n      const initialHref = await browser.eval(() => window.initialHref)\n      const { pathname } = url.parse(initialHref)\n      // since it was cached the initial value is now the redirect\n      // result\n      expect(pathname).toBe(`${basePath}/gsp-blog/first`)\n    })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when fallback GSP page is visited directly (internal normal)","suites":[],"updatePoint":{"line":179,"column":88},"line":179,"code":"  it('should apply redirect when fallback GSP page is visited directly (internal normal)', async () => {\n    const browser = await webdriver(\n      appPort,\n      `${basePath}/gsp-blog/redirect-dest-_`,\n      {\n        retryWaitHydration: true,\n      }\n    )\n\n    await browser.waitForElementByCss('#index')\n\n    const initialHref = await browser.eval(() => window.initialHref)\n    const { pathname } = url.parse(initialHref)\n    expect(pathname).toBe(`${basePath}/gsp-blog/redirect-dest-_`)\n  })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when fallback GSP page is visited directly (internal normal) 2nd visit","suites":[],"updatePoint":{"line":196,"column":100},"line":196,"code":"    it('should apply redirect when fallback GSP page is visited directly (internal normal) 2nd visit', async () => {\n      const browser = await webdriver(\n        appPort,\n        `${basePath}/gsp-blog/redirect-dest-_`,\n        {\n          retryWaitHydration: true,\n        }\n      )\n\n      await browser.waitForElementByCss('#index')\n\n      const initialHref = await browser.eval(() => window.initialHref)\n      const { pathname } = url.parse(initialHref)\n      expect(pathname).toBe(`${basePath}`)\n    })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when fallback GSP page is visited directly (external)","suites":[],"updatePoint":{"line":213,"column":81},"line":213,"code":"  it('should apply redirect when fallback GSP page is visited directly (external)', async () => {\n    const browser = await webdriver(\n      appPort,\n      `${basePath}/gsp-blog/redirect-dest-_missing`,\n      {\n        retryWaitHydration: true,\n      }\n    )\n\n    await check(\n      () => browser.eval(() => document.documentElement.innerHTML),\n      /oops not found/\n    )\n\n    const initialHref = await browser.eval(() => window.initialHref)\n    expect(initialHref).toBeFalsy()\n\n    const curUrl = await browser.url()\n    const { pathname } = url.parse(curUrl)\n    expect(pathname).toBe('/docs/missing')\n  })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when fallback GSP page is visited directly (external domain)","suites":[],"updatePoint":{"line":235,"column":88},"line":235,"code":"  it('should apply redirect when fallback GSP page is visited directly (external domain)', async () => {\n    const browser = await webdriver(\n      appPort,\n      `${basePath}/gsp-blog/redirect-dest-external`,\n      {\n        retryWaitHydration: true,\n      }\n    )\n\n    await check(\n      () => browser.eval(() => document.location.hostname),\n      'example.com'\n    )\n\n    const initialHref = await browser.eval(() => window.initialHref)\n    expect(initialHref).toBeFalsy()\n  })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when fallback GSSP page is visited directly (external domain)","suites":[],"updatePoint":{"line":253,"column":89},"line":253,"code":"  it('should apply redirect when fallback GSSP page is visited directly (external domain)', async () => {\n    const browser = await webdriver(\n      appPort,\n      `${basePath}/gssp-blog/redirect-dest-external`,\n      {\n        retryWaitHydration: true,\n      }\n    )\n\n    await check(\n      () => browser.eval(() => document.location.hostname),\n      'example.com'\n    )\n\n    const initialHref = await browser.eval(() => window.initialHref)\n    expect(initialHref).toBeFalsy()\n\n    const res = await fetchViaHTTP(\n      appPort,\n      `${basePath}/gssp-blog/redirect-dest-external`,\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n    expect(res.status).toBe(307)\n\n    const parsed = url.parse(res.headers.get('location'))\n    expect(parsed.hostname).toBe('example.com')\n    expect(parsed.pathname).toBe('/')\n  })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when GSSP page is navigated to client-side (internal dynamic)","suites":[],"updatePoint":{"line":285,"column":89},"line":285,"code":"  it('should apply redirect when GSSP page is navigated to client-side (internal dynamic)', async () => {\n    const browser = await webdriver(\n      appPort,\n      `${basePath}/gssp-blog/redirect-dest-_gssp-blog_first`,\n      {\n        retryWaitHydration: true,\n      }\n    )\n\n    await browser.waitForElementByCss('#gssp')\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props).toEqual({\n      params: {\n        post: 'first',\n      },\n    })\n  })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when GSSP page is navigated to client-side (internal normal)","suites":[],"updatePoint":{"line":304,"column":88},"line":304,"code":"  it('should apply redirect when GSSP page is navigated to client-side (internal normal)', async () => {\n    const browser = await webdriver(appPort, `${basePath}`, {\n      retryWaitHydration: true,\n    })\n\n    await browser.eval(`(function () {\n      window.next.router.push('/gssp-blog/redirect-dest-_another')\n    })()`)\n    await browser.waitForElementByCss('#another')\n\n    const text = await browser.elementByCss('#another').text()\n\n    expect(text).toEqual('another Page')\n  })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when GSSP page is navigated to client-side (external)","suites":[],"updatePoint":{"line":319,"column":81},"line":319,"code":"  it('should apply redirect when GSSP page is navigated to client-side (external)', async () => {\n    const browser = await webdriver(appPort, `${basePath}`, {\n      retryWaitHydration: true,\n    })\n\n    await browser.eval(`(function () {\n      window.next.router.push('/gssp-blog/redirect-dest-_gssp-blog_first')\n    })()`)\n    await browser.waitForElementByCss('#gssp')\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n\n    expect(props).toEqual({\n      params: {\n        post: 'first',\n      },\n    })\n  })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when GSP page is navigated to client-side (internal)","suites":[],"updatePoint":{"line":338,"column":80},"line":338,"code":"  it('should apply redirect when GSP page is navigated to client-side (internal)', async () => {\n    const browser = await webdriver(appPort, `${basePath}`, {\n      retryWaitHydration: true,\n    })\n\n    await browser.eval(`(function () {\n      window.next.router.push('/gsp-blog/redirect-dest-_another')\n    })()`)\n    await browser.waitForElementByCss('#another')\n\n    const text = await browser.elementByCss('#another').text()\n\n    expect(text).toEqual('another Page')\n  })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when GSP page is navigated to client-side (external)","suites":[],"updatePoint":{"line":353,"column":80},"line":353,"code":"  it('should apply redirect when GSP page is navigated to client-side (external)', async () => {\n    const browser = await webdriver(appPort, `${basePath}`, {\n      retryWaitHydration: true,\n    })\n\n    await browser.eval(`(function () {\n      window.next.router.push('/gsp-blog/redirect-dest-_gsp-blog_first')\n    })()`)\n    await browser.waitForElementByCss('#gsp')\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n\n    expect(props).toEqual({\n      params: {\n        post: 'first',\n      },\n    })\n  })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not replace history of the origin page when GSSP page is navigated to client-side (internal normal)","suites":[],"updatePoint":{"line":372,"column":112},"line":372,"code":"  it('should not replace history of the origin page when GSSP page is navigated to client-side (internal normal)', async () => {\n    const browser = await webdriver(\n      appPort,\n      `${basePath}/another?mark_as=root`,\n      {\n        retryWaitHydration: true,\n      }\n    )\n\n    await browser.eval(`(function () {\n      window.next.router.push('/')\n    })()`)\n    await browser.waitForElementByCss('#index')\n\n    await browser.eval(`(function () {\n      window.next.router.push('/gssp-blog/redirect-dest-_another')\n    })()`)\n    await browser.waitForElementByCss('#another')\n\n    await browser.eval(`(function () {\n      window.history.back()\n    })()`)\n\n    const curUrl = await browser.url()\n    const { path } = url.parse(curUrl)\n    expect(path).toEqual(`${basePath}`)\n  })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not replace history of the origin page when GSSP page is navigated to client-side (external)","suites":[],"updatePoint":{"line":400,"column":105},"line":400,"code":"  it('should not replace history of the origin page when GSSP page is navigated to client-side (external)', async () => {\n    const browser = await webdriver(\n      appPort,\n      `${basePath}/another?mark_as=root`,\n      {\n        retryWaitHydration: true,\n      }\n    )\n\n    await browser.eval(`(function () {\n      window.next.router.push('/')\n    })()`)\n    await browser.waitForElementByCss('#index')\n\n    await browser.eval(`(function () {\n      window.next.router.push('/gssp-blog/redirect-dest-_gssp-blog_first')\n    })()`)\n    await browser.waitForElementByCss('#gssp')\n\n    await browser.eval(`(function () {\n      window.history.back()\n    })()`)\n\n    const curUrl = await browser.url()\n    const { path } = url.parse(curUrl)\n    expect(path).toEqual(`${basePath}`)\n  })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not replace history of the origin page when GSP page is navigated to client-side (internal)","suites":[],"updatePoint":{"line":428,"column":104},"line":428,"code":"  it('should not replace history of the origin page when GSP page is navigated to client-side (internal)', async () => {\n    const browser = await webdriver(\n      appPort,\n      `${basePath}/another?mark_as=root`,\n      {\n        retryWaitHydration: true,\n      }\n    )\n\n    await browser.eval(`(function () {\n      window.next.router.push('/')\n    })()`)\n    await browser.waitForElementByCss('#index')\n\n    await browser.eval(`(function () {\n      window.next.router.push('/gsp-blog/redirect-dest-_another')\n    })()`)\n    await browser.waitForElementByCss('#another')\n\n    await browser.eval(`(function () {\n      window.history.back()\n    })()`)\n\n    const curUrl = await browser.url()\n    const { path } = url.parse(curUrl)\n    expect(path).toEqual(`${basePath}`)\n  })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not replace history of the origin page when GSP page is navigated to client-side (external)","suites":[],"updatePoint":{"line":456,"column":104},"line":456,"code":"  it('should not replace history of the origin page when GSP page is navigated to client-side (external)', async () => {\n    const browser = await webdriver(\n      appPort,\n      `${basePath}/another?mark_as=root`,\n      {\n        retryWaitHydration: true,\n      }\n    )\n\n    await browser.eval(`(function () {\n      window.next.router.push('/')\n    })()`)\n    await browser.waitForElementByCss('#index')\n\n    await browser.eval(`(function () {\n      window.next.router.push('/gsp-blog/redirect-dest-_gsp-blog_first')\n    })()`)\n    await browser.waitForElementByCss('#gsp')\n\n    await browser.eval(`(function () {\n      window.history.back()\n    })()`)\n\n    const curUrl = await browser.url()\n    const { path } = url.parse(curUrl)\n    expect(path).toEqual(`${basePath}`)\n  })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle redirect in raw serverless mode correctly","suites":["GS(S)P Redirect Support","serverless mode"],"updatePoint":{"line":534,"column":63},"line":534,"code":"    it('should handle redirect in raw serverless mode correctly', async () => {\n      server = http.createServer(async (req, res) => {\n        try {\n          console.log(req.url)\n          if (req.url.includes('/gsp-blog')) {\n            await require(join(\n              appDir,\n              '.next/serverless/pages/gsp-blog/[post].js'\n            )).render(req, res)\n          } else {\n            await require(join(\n              appDir,\n              './.next/serverless/pages/gssp-blog/[post].js'\n            )).render(req, res)\n          }\n        } catch (err) {\n          console.error('failed to render', err)\n          res.statusCode = 500\n          res.end('error')\n        }\n      })\n      const port = await findPort()\n\n      await new Promise((resolve, reject) => {\n        server.listen(port, (err) => (err ? reject(err) : resolve()))\n      })\n      console.log(`Raw serverless server listening at port ${port}`)\n\n      const res1 = await fetchViaHTTP(\n        port,\n        '/gsp-blog/redirect-dest-_gsp-blog_first',\n        undefined,\n        {\n          redirect: 'manual',\n        }\n      )\n      expect(res1.status).toBe(307)\n      const text1 = await res1.text()\n      expect(text1).toEqual(`${basePath}/gsp-blog/first`)\n      const parsed = url.parse(res1.headers.get('location'), true)\n      expect(parsed.pathname).toBe(`${basePath}/gsp-blog/first`)\n      expect(parsed.query).toEqual({})\n      expect(res1.headers.get('refresh')).toBe(null)\n\n      const res2 = await fetchViaHTTP(\n        port,\n        '/gsp-blog/redirect-permanent-dest-_gsp-blog_first',\n        undefined,\n        {\n          redirect: 'manual',\n        }\n      )\n      expect(res2.status).toBe(308)\n      const text2 = await res2.text()\n      expect(text2).toEqual(`${basePath}/gsp-blog/first`)\n      expect(res2.headers.get('refresh')).toContain(\n        `url=${basePath}/gsp-blog/first`\n      )\n      const parsed2 = url.parse(res2.headers.get('location'), true)\n      expect(parsed2.pathname).toBe(`${basePath}/gsp-blog/first`)\n      expect(parsed2.query).toEqual({})\n\n      const res3 = await fetchViaHTTP(\n        port,\n        '/gssp-blog/redirect-dest-_gssp-blog_first',\n        undefined,\n        {\n          redirect: 'manual',\n        }\n      )\n      expect(res3.status).toBe(307)\n      const text3 = await res3.text()\n      expect(text3).toEqual(`${basePath}/gssp-blog/first`)\n      expect(res3.headers.get('refresh')).toBe(null)\n      const parsed3 = url.parse(res3.headers.get('location'), true)\n      expect(parsed3.pathname).toBe(`${basePath}/gssp-blog/first`)\n      expect(parsed3.query).toEqual({})\n\n      const res4 = await fetchViaHTTP(\n        port,\n        '/gssp-blog/redirect-permanent-dest-_gssp-blog_first',\n        undefined,\n        {\n          redirect: 'manual',\n        }\n      )\n      expect(res4.status).toBe(308)\n      const text4 = await res4.text()\n      expect(text4).toEqual(`${basePath}/gssp-blog/first`)\n      expect(res4.headers.get('refresh')).toContain(\n        `url=${basePath}/gssp-blog/first`\n      )\n      const parsed4 = url.parse(res4.headers.get('location'), true)\n      expect(parsed4.pathname).toBe(`${basePath}/gssp-blog/first`)\n      expect(parsed4.query).toEqual({})\n    })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should error for redirect during prerendering","suites":["GS(S)P Redirect Support","serverless mode"],"updatePoint":{"line":634,"column":51},"line":634,"code":"  it('should error for redirect during prerendering', async () => {\n    await fs.mkdirp(join(appDir, 'pages/invalid'))\n    await fs.writeFile(\n      join(appDir, 'pages', 'invalid', '[slug].js'),\n      `\n        export default function Post(props) {\n          return \"hi\"\n        }\n\n        export const getStaticProps = ({ params }) => {\n          return {\n            redirect: {\n              permanent: true,\n              destination: '/another'\n            }\n          }\n        }\n\n        export const getStaticPaths = () => {\n          return {\n            paths: ['first', 'second'].map((slug) => ({ params: { slug } })),\n            fallback: true,\n          }\n        }\n      `\n    )\n    const { stdout, stderr } = await nextBuild(appDir, undefined, {\n      stdout: true,\n      stderr: true,\n    })\n    const output = stdout + stderr\n    await fs.remove(join(appDir, 'pages/invalid'))\n\n    expect(output).toContain(\n      '`redirect` can not be returned from getStaticProps during prerendering'\n    )\n  })","file":"integration/gssp-redirect-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should use a client-side navigation for a rewritten URL","suites":["getServerSideProps redirects"],"updatePoint":{"line":32,"column":61},"line":32,"code":"  it('should use a client-side navigation for a rewritten URL', async () => {\n    const browser = await webdriver(context.appPort, '/alias-to-main-content')\n\n    // During a browser navigation global variables are reset,\n    // So by checking that the __SAME_PAGE variable is still defined\n    // then the client-side navigation has happened\n    await browser.eval('window.__SAME_PAGE = true')\n\n    await browser.elementByCss('#link-with-rewritten-url').click()\n\n    // Wait until the new props are rendered\n    await browser.waitForElementByCss('.refreshed')\n\n    expect(await browser.eval('window.__SAME_PAGE')).toBe(true)\n  })","file":"integration/gssp-redirect-with-rewrites/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fallback to browser navigation for an unknown URL","suites":["getServerSideProps redirects"],"updatePoint":{"line":48,"column":62},"line":48,"code":"  it('should fallback to browser navigation for an unknown URL', async () => {\n    const browser = await webdriver(context.appPort, '/alias-to-main-content')\n\n    // then the client-side navigation has happened\n    await browser.eval('window.__SAME_PAGE = true')\n    await browser.elementByCss('#link-unknown-url').click()\n\n    // Wait until the page has be reloaded\n    await check(async () => {\n      const val = await browser.eval('window.__SAME_PAGE')\n      return val ? 'fail' : 'success'\n    }, 'success')\n  })","file":"integration/gssp-redirect-with-rewrites/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply temporary redirect when visited directly for GSSP page","suites":[],"updatePoint":{"line":24,"column":73},"line":24,"code":"  it('should apply temporary redirect when visited directly for GSSP page', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/gssp-blog/redirect-1',\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n    expect(res.status).toBe(307)\n\n    const { pathname } = url.parse(res.headers.get('location'))\n\n    expect(pathname).toBe('/404')\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply permanent redirect when visited directly for GSSP page","suites":[],"updatePoint":{"line":40,"column":73},"line":40,"code":"  it('should apply permanent redirect when visited directly for GSSP page', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/gssp-blog/redirect-permanent',\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n    expect(res.status).toBe(308)\n\n    const { pathname } = url.parse(res.headers.get('location'))\n\n    expect(pathname).toBe('/404')\n    expect(res.headers.get('refresh')).toMatch(/url=\\/404/)\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply statusCode 301 redirect when visited directly for GSSP page","suites":[],"updatePoint":{"line":57,"column":78},"line":57,"code":"  it('should apply statusCode 301 redirect when visited directly for GSSP page', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/gssp-blog/redirect-statusCode-301',\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n    expect(res.status).toBe(301)\n\n    const { pathname } = url.parse(res.headers.get('location'))\n\n    expect(pathname).toBe('/404')\n    expect(res.headers.get('refresh')).toBe(null)\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply statusCode 303 redirect when visited directly for GSSP page","suites":[],"updatePoint":{"line":74,"column":78},"line":74,"code":"  it('should apply statusCode 303 redirect when visited directly for GSSP page', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/gssp-blog/redirect-statusCode-303',\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n    expect(res.status).toBe(303)\n\n    const { pathname } = url.parse(res.headers.get('location'))\n\n    expect(pathname).toBe('/404')\n    expect(res.headers.get('refresh')).toBe(null)\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when fallback GSP page is visited directly (internal dynamic)","suites":[],"updatePoint":{"line":91,"column":89},"line":91,"code":"  it('should apply redirect when fallback GSP page is visited directly (internal dynamic)', async () => {\n    const browser = await webdriver(\n      appPort,\n      '/gsp-blog/redirect-dest-_gsp-blog_first',\n      {\n        retryWaitHydration: true,\n      }\n    )\n\n    await browser.waitForElementByCss('#gsp')\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props).toEqual({\n      params: {\n        post: 'first',\n      },\n    })\n    const initialHref = await browser.eval(() => window.initialHref)\n    const { pathname } = url.parse(initialHref)\n    expect(pathname).toBe('/gsp-blog/redirect-dest-_gsp-blog_first')\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when fallback blocking GSP page is visited directly (internal dynamic)","suites":[],"updatePoint":{"line":113,"column":98},"line":113,"code":"  it('should apply redirect when fallback blocking GSP page is visited directly (internal dynamic)', async () => {\n    const browser = await webdriver(\n      appPort,\n      '/gsp-blog-blocking/redirect-dest-_gsp-blog_first',\n      {\n        retryWaitHydration: true,\n      }\n    )\n\n    await browser.waitForElementByCss('#gsp')\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props).toEqual({\n      params: {\n        post: 'first',\n      },\n    })\n    const initialHref = await browser.eval(() => window.initialHref)\n    const { pathname } = url.parse(initialHref)\n    expect(pathname).toBe('/gsp-blog/first')\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when fallback blocking GSP page is visited directly (internal dynamic) second visit","suites":[],"updatePoint":{"line":135,"column":111},"line":135,"code":"  it('should apply redirect when fallback blocking GSP page is visited directly (internal dynamic) second visit', async () => {\n    const browser = await webdriver(\n      appPort,\n      '/gsp-blog-blocking/redirect-dest-_gsp-blog_first',\n      {\n        retryWaitHydration: true,\n      }\n    )\n\n    await browser.waitForElementByCss('#gsp')\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props).toEqual({\n      params: {\n        post: 'first',\n      },\n    })\n    const initialHref = await browser.eval(() => window.initialHref)\n    const { pathname } = url.parse(initialHref)\n    expect(pathname).toBe('/gsp-blog/first')\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when fallback blocking GSP page is visited directly (internal dynamic) with revalidate","suites":[],"updatePoint":{"line":157,"column":114},"line":157,"code":"  it('should apply redirect when fallback blocking GSP page is visited directly (internal dynamic) with revalidate', async () => {\n    const browser = await webdriver(\n      appPort,\n      '/gsp-blog-blocking/redirect-revalidate-dest-_gsp-blog_first',\n      {\n        retryWaitHydration: true,\n      }\n    )\n\n    await browser.waitForElementByCss('#gsp')\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props).toEqual({\n      params: {\n        post: 'first',\n      },\n    })\n    const initialHref = await browser.eval(() => window.initialHref)\n    const { pathname } = url.parse(initialHref)\n    expect(pathname).toBe('/gsp-blog/first')\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when fallback blocking GSP page is visited directly (internal dynamic) with revalidate second visit","suites":[],"updatePoint":{"line":179,"column":127},"line":179,"code":"  it('should apply redirect when fallback blocking GSP page is visited directly (internal dynamic) with revalidate second visit', async () => {\n    const browser = await webdriver(\n      appPort,\n      '/gsp-blog-blocking/redirect-revalidate-dest-_gsp-blog_first',\n      {\n        retryWaitHydration: true,\n      }\n    )\n\n    await browser.waitForElementByCss('#gsp')\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props).toEqual({\n      params: {\n        post: 'first',\n      },\n    })\n    const initialHref = await browser.eval(() => window.initialHref)\n    const { pathname } = url.parse(initialHref)\n    expect(pathname).toBe('/gsp-blog/first')\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when fallback GSP page is visited directly (internal dynamic) 2nd visit","suites":[],"updatePoint":{"line":202,"column":101},"line":202,"code":"    it('should apply redirect when fallback GSP page is visited directly (internal dynamic) 2nd visit', async () => {\n      const browser = await webdriver(\n        appPort,\n        '/gsp-blog/redirect-dest-_gsp-blog_first',\n        {\n          retryWaitHydration: true,\n        }\n      )\n\n      await browser.waitForElementByCss('#gsp')\n\n      const props = JSON.parse(await browser.elementByCss('#props').text())\n      expect(props).toEqual({\n        params: {\n          post: 'first',\n        },\n      })\n      const initialHref = await browser.eval(() => window.initialHref)\n      const { pathname } = url.parse(initialHref)\n      // since it was cached the initial value is now the redirect\n      // result\n      expect(pathname).toBe('/gsp-blog/first')\n    })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when fallback GSP page is visited directly (internal normal)","suites":[],"updatePoint":{"line":227,"column":88},"line":227,"code":"  it('should apply redirect when fallback GSP page is visited directly (internal normal)', async () => {\n    const browser = await webdriver(appPort, '/gsp-blog/redirect-dest-_', {\n      retryWaitHydration: true,\n    })\n\n    await browser.waitForElementByCss('#index')\n\n    const initialHref = await browser.eval(() => window.initialHref)\n    const { pathname } = url.parse(initialHref)\n    expect(pathname).toBe('/gsp-blog/redirect-dest-_')\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when fallback GSP page is visited directly (internal normal) 2nd visit","suites":[],"updatePoint":{"line":240,"column":100},"line":240,"code":"    it('should apply redirect when fallback GSP page is visited directly (internal normal) 2nd visit', async () => {\n      const browser = await webdriver(appPort, '/gsp-blog/redirect-dest-_', {\n        retryWaitHydration: true,\n      })\n\n      await browser.waitForElementByCss('#index')\n\n      const initialHref = await browser.eval(() => window.initialHref)\n      const { pathname } = url.parse(initialHref)\n      expect(pathname).toBe('/')\n    })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when fallback GSP page is visited directly (external)","suites":[],"updatePoint":{"line":253,"column":81},"line":253,"code":"  it('should apply redirect when fallback GSP page is visited directly (external)', async () => {\n    const browser = await webdriver(\n      appPort,\n      '/gsp-blog/redirect-dest-_missing',\n      {\n        retryWaitHydration: true,\n      }\n    )\n\n    await check(\n      () => browser.eval(() => document.documentElement.innerHTML),\n      /oops not found/\n    )\n\n    const initialHref = await browser.eval(() => window.initialHref)\n    expect(initialHref).toBeFalsy()\n\n    const curUrl = await browser.url()\n    const { pathname } = url.parse(curUrl)\n    expect(pathname).toBe('/missing')\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when fallback GSP page is visited directly (external domain)","suites":[],"updatePoint":{"line":275,"column":88},"line":275,"code":"  it('should apply redirect when fallback GSP page is visited directly (external domain)', async () => {\n    const browser = await webdriver(\n      appPort,\n      '/gsp-blog/redirect-dest-external',\n      {\n        retryWaitHydration: true,\n      }\n    )\n\n    await check(\n      () => browser.eval(() => document.location.hostname),\n      'example.com'\n    )\n\n    const initialHref = await browser.eval(() => window.initialHref)\n    expect(initialHref).toBeFalsy()\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when fallback GSSP page is visited directly (external domain)","suites":[],"updatePoint":{"line":293,"column":89},"line":293,"code":"  it('should apply redirect when fallback GSSP page is visited directly (external domain)', async () => {\n    const browser = await webdriver(\n      appPort,\n      '/gssp-blog/redirect-dest-external',\n      {\n        retryWaitHydration: true,\n      }\n    )\n\n    await check(\n      () => browser.eval(() => document.location.hostname),\n      'example.com'\n    )\n\n    const initialHref = await browser.eval(() => window.initialHref)\n    expect(initialHref).toBeFalsy()\n\n    const res = await fetchViaHTTP(\n      appPort,\n      '/gssp-blog/redirect-dest-external',\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n    expect(res.status).toBe(307)\n\n    const parsed = url.parse(res.headers.get('location'))\n    expect(parsed.hostname).toBe('example.com')\n    expect(parsed.pathname).toBe('/')\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when GSSP page is navigated to client-side (internal dynamic)","suites":[],"updatePoint":{"line":325,"column":89},"line":325,"code":"  it('should apply redirect when GSSP page is navigated to client-side (internal dynamic)', async () => {\n    const browser = await webdriver(\n      appPort,\n      '/gssp-blog/redirect-dest-_gssp-blog_first',\n      {\n        retryWaitHydration: true,\n      }\n    )\n\n    await browser.waitForElementByCss('#gssp')\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n    expect(props).toEqual({\n      params: {\n        post: 'first',\n      },\n    })\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when GSSP page is navigated to client-side (internal normal)","suites":[],"updatePoint":{"line":344,"column":88},"line":344,"code":"  it('should apply redirect when GSSP page is navigated to client-side (internal normal)', async () => {\n    const browser = await webdriver(appPort, '/', {\n      retryWaitHydration: true,\n    })\n\n    await browser.eval(`(function () {\n      window.next.router.push('/gssp-blog/redirect-dest-_another')\n    })()`)\n    await browser.waitForElementByCss('#another')\n\n    const text = await browser.elementByCss('#another').text()\n\n    expect(text).toEqual('another Page')\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when GSSP page is navigated to client-side (external)","suites":[],"updatePoint":{"line":359,"column":81},"line":359,"code":"  it('should apply redirect when GSSP page is navigated to client-side (external)', async () => {\n    const browser = await webdriver(appPort, '/', {\n      retryWaitHydration: true,\n    })\n\n    await browser.eval(`(function () {\n      window.next.router.push('/gssp-blog/redirect-dest-_gssp-blog_first')\n    })()`)\n    await browser.waitForElementByCss('#gssp')\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n\n    expect(props).toEqual({\n      params: {\n        post: 'first',\n      },\n    })\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when GSP page is navigated to client-side (internal)","suites":[],"updatePoint":{"line":378,"column":80},"line":378,"code":"  it('should apply redirect when GSP page is navigated to client-side (internal)', async () => {\n    const browser = await webdriver(appPort, '/', {\n      retryWaitHydration: true,\n    })\n\n    await browser.eval(`(function () {\n      window.next.router.push('/gsp-blog/redirect-dest-_another')\n    })()`)\n    await browser.waitForElementByCss('#another')\n\n    const text = await browser.elementByCss('#another').text()\n\n    expect(text).toEqual('another Page')\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply redirect when GSP page is navigated to client-side (external)","suites":[],"updatePoint":{"line":393,"column":80},"line":393,"code":"  it('should apply redirect when GSP page is navigated to client-side (external)', async () => {\n    const browser = await webdriver(appPort, '/', {\n      retryWaitHydration: true,\n    })\n\n    await browser.eval(`(function () {\n      window.next.router.push('/gsp-blog/redirect-dest-_gsp-blog_first')\n    })()`)\n    await browser.waitForElementByCss('#gsp')\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n\n    expect(props).toEqual({\n      params: {\n        post: 'first',\n      },\n    })\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not replace history of the origin page when GSSP page is navigated to client-side (internal normal)","suites":[],"updatePoint":{"line":412,"column":112},"line":412,"code":"  it('should not replace history of the origin page when GSSP page is navigated to client-side (internal normal)', async () => {\n    const browser = await webdriver(appPort, '/another?mark_as=root', {\n      retryWaitHydration: true,\n    })\n\n    await browser.eval(`(function () {\n      window.next.router.push('/')\n    })()`)\n    await browser.waitForElementByCss('#index')\n\n    await browser.eval(`(function () {\n      window.next.router.push('/gssp-blog/redirect-dest-_another')\n    })()`)\n    await browser.waitForElementByCss('#another')\n\n    await browser.eval(`(function () {\n      window.history.back()\n    })()`)\n\n    const curUrl = await browser.url()\n    const { path } = url.parse(curUrl)\n    expect(path).toEqual('/')\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not replace history of the origin page when GSSP page is navigated to client-side (external)","suites":[],"updatePoint":{"line":436,"column":105},"line":436,"code":"  it('should not replace history of the origin page when GSSP page is navigated to client-side (external)', async () => {\n    const browser = await webdriver(appPort, '/another?mark_as=root', {\n      retryWaitHydration: true,\n    })\n\n    await browser.eval(`(function () {\n      window.next.router.push('/')\n    })()`)\n    await browser.waitForElementByCss('#index')\n\n    await browser.eval(`(function () {\n      window.next.router.push('/gssp-blog/redirect-dest-_gssp-blog_first')\n    })()`)\n    await browser.waitForElementByCss('#gssp')\n\n    await browser.eval(`(function () {\n      window.history.back()\n    })()`)\n\n    const curUrl = await browser.url()\n    const { path } = url.parse(curUrl)\n    expect(path).toEqual('/')\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not replace history of the origin page when GSP page is navigated to client-side (internal)","suites":[],"updatePoint":{"line":460,"column":104},"line":460,"code":"  it('should not replace history of the origin page when GSP page is navigated to client-side (internal)', async () => {\n    const browser = await webdriver(appPort, '/another?mark_as=root', {\n      retryWaitHydration: true,\n    })\n\n    await browser.eval(`(function () {\n      window.next.router.push('/')\n    })()`)\n    await browser.waitForElementByCss('#index')\n\n    await browser.eval(`(function () {\n      window.next.router.push('/gsp-blog/redirect-dest-_another')\n    })()`)\n    await browser.waitForElementByCss('#another')\n\n    await browser.eval(`(function () {\n      window.history.back()\n    })()`)\n\n    const curUrl = await browser.url()\n    const { path } = url.parse(curUrl)\n    expect(path).toEqual('/')\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not replace history of the origin page when GSP page is navigated to client-side (external)","suites":[],"updatePoint":{"line":484,"column":104},"line":484,"code":"  it('should not replace history of the origin page when GSP page is navigated to client-side (external)', async () => {\n    const browser = await webdriver(appPort, '/another?mark_as=root', {\n      retryWaitHydration: true,\n    })\n\n    await browser.eval(`(function () {\n      window.next.router.push('/')\n    })()`)\n    await browser.waitForElementByCss('#index')\n\n    await browser.eval(`(function () {\n      window.next.router.push('/gsp-blog/redirect-dest-_gsp-blog_first')\n    })()`)\n    await browser.waitForElementByCss('#gsp')\n\n    await browser.eval(`(function () {\n      window.history.back()\n    })()`)\n\n    const curUrl = await browser.url()\n    const { path } = url.parse(curUrl)\n    expect(path).toEqual('/')\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have errors in output","suites":["GS(S)P Redirect Support","production mode"],"updatePoint":{"line":540,"column":40},"line":540,"code":"    it('should not have errors in output', async () => {\n      expect(output).not.toContain('Failed to update prerender files')\n    })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle redirect in raw serverless mode correctly","suites":["GS(S)P Redirect Support","serverless mode"],"updatePoint":{"line":571,"column":63},"line":571,"code":"    it('should handle redirect in raw serverless mode correctly', async () => {\n      server = http.createServer(async (req, res) => {\n        try {\n          console.log(req.url)\n          if (req.url.includes('/gsp-blog')) {\n            await require(join(\n              appDir,\n              '.next/serverless/pages/gsp-blog/[post].js'\n            )).render(req, res)\n          } else {\n            await require(join(\n              appDir,\n              './.next/serverless/pages/gssp-blog/[post].js'\n            )).render(req, res)\n          }\n        } catch (err) {\n          console.error('failed to render', err)\n          res.statusCode = 500\n          res.end('error')\n        }\n      })\n      const port = await findPort()\n\n      await new Promise((resolve, reject) => {\n        server.listen(port, (err) => (err ? reject(err) : resolve()))\n      })\n      console.log(`Raw serverless server listening at port ${port}`)\n\n      const res1 = await fetchViaHTTP(\n        port,\n        '/gsp-blog/redirect-dest-_gsp-blog_first',\n        undefined,\n        {\n          redirect: 'manual',\n        }\n      )\n      expect(res1.status).toBe(307)\n      const parsed = url.parse(res1.headers.get('location'), true)\n      expect(parsed.pathname).toBe('/gsp-blog/first')\n      expect(parsed.query).toEqual({})\n      expect(res1.headers.get('refresh')).toBe(null)\n\n      const res2 = await fetchViaHTTP(\n        port,\n        '/gsp-blog/redirect-permanent-dest-_gsp-blog_first',\n        undefined,\n        {\n          redirect: 'manual',\n        }\n      )\n      expect(res2.status).toBe(308)\n      expect(res2.headers.get('refresh')).toMatch(/url=\\/gsp-blog\\/first/)\n      const parsed2 = url.parse(res2.headers.get('location'), true)\n      expect(parsed2.pathname).toBe('/gsp-blog/first')\n      expect(parsed2.query).toEqual({})\n\n      const res3 = await fetchViaHTTP(\n        port,\n        '/gssp-blog/redirect-dest-_gssp-blog_first',\n        undefined,\n        {\n          redirect: 'manual',\n        }\n      )\n      expect(res3.status).toBe(307)\n      expect(res3.headers.get('refresh')).toBe(null)\n      const parsed3 = url.parse(res3.headers.get('location'), true)\n      expect(parsed3.pathname).toBe('/gssp-blog/first')\n      expect(parsed3.query).toEqual({})\n\n      const res4 = await fetchViaHTTP(\n        port,\n        '/gssp-blog/redirect-permanent-dest-_gssp-blog_first',\n        undefined,\n        {\n          redirect: 'manual',\n        }\n      )\n      expect(res4.status).toBe(308)\n      expect(res4.headers.get('refresh')).toMatch(/url=\\/gssp-blog\\/first/)\n      const parsed4 = url.parse(res4.headers.get('location'), true)\n      expect(parsed4.pathname).toBe('/gssp-blog/first')\n      expect(parsed4.query).toEqual({})\n    })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"should error for redirect during prerendering","suites":["GS(S)P Redirect Support","serverless mode"],"updatePoint":{"line":659,"column":51},"line":659,"code":"  it('should error for redirect during prerendering', async () => {\n    await fs.mkdirp(join(appDir, 'pages/invalid'))\n    await fs.writeFile(\n      join(appDir, 'pages', 'invalid', '[slug].js'),\n      `\n        export default function Post(props) {\n          return \"hi\"\n        }\n\n        export const getStaticProps = ({ params }) => {\n          return {\n            redirect: {\n              permanent: true,\n              destination: '/another'\n            }\n          }\n        }\n\n        export const getStaticPaths = () => {\n          return {\n            paths: ['first', 'second'].map((slug) => ({ params: { slug } })),\n            fallback: true,\n          }\n        }\n      `\n    )\n    const { stdout, stderr } = await nextBuild(appDir, undefined, {\n      stdout: true,\n      stderr: true,\n    })\n    const output = stdout + stderr\n    await fs.remove(join(appDir, 'pages/invalid'))\n\n    expect(output).toContain(\n      '`redirect` can not be returned from getStaticProps during prerendering'\n    )\n  })","file":"integration/gssp-redirect/test/index.test.js","skipped":false,"dir":"test"},{"name":"Fails softly with descriptive error","suites":["Handle non-page in pages when target: serverless"],"updatePoint":{"line":9,"column":41},"line":9,"code":"  it('Fails softly with descriptive error', async () => {\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n\n    expect(stderr).toMatch(\n      /found page without a React Component as default export in/\n    )\n    expect(stderr).toMatch(/pages\\/invalid/)\n  })","file":"integration/handle-non-page-in-pages/test/index.test.js","skipped":false,"dir":"test"},{"name":"Does not crash workers","suites":["Handles Errors During Export"],"updatePoint":{"line":9,"column":28},"line":9,"code":"  it('Does not crash workers', async () => {\n    const { stdout, stderr } = await nextBuild(appDir, [], {\n      stdout: true,\n      stderr: true,\n    })\n\n    expect(stdout + stderr).not.toMatch(/ERR_IPC_CHANNEL_CLOSED/)\n    expect(stderr).toContain('Export encountered errors on following paths')\n    expect(stderr).toContain('/page')\n    expect(stderr).toContain('/page-1')\n    expect(stderr).toContain('/page-2')\n    expect(stderr).toContain('/page-3')\n    expect(stderr).toContain('/page-13')\n    expect(stderr).toContain('/blog/[slug]: /blog/first')\n    expect(stderr).toContain('/blog/[slug]: /blog/second')\n    expect(stderr).toContain('/custom-error')\n    expect(stderr).toContain('custom error message')\n  })","file":"integration/handles-export-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work for .js files","suites":["first-line hashbang (#!) parse"],"updatePoint":{"line":20,"column":33},"line":20,"code":"    it('should work for .js files', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n      expect(html).toMatch('JS: 123')\n    })","file":"integration/hashbang/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work for .mjs files","suites":["first-line hashbang (#!) parse"],"updatePoint":{"line":25,"column":34},"line":25,"code":"    it('should work for .mjs files', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n      expect(html).toMatch('MJS: 456')\n    })","file":"integration/hashbang/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work for .cjs files","suites":["first-line hashbang (#!) parse"],"updatePoint":{"line":30,"column":34},"line":30,"code":"    it('should work for .cjs files', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n      expect(html).toMatch('CJS: 789')\n    })","file":"integration/hashbang/test/index.test.js","skipped":false,"dir":"test"},{"name":"correctly measures hydrate followed by render","suites":["hydrate/render ordering"],"updatePoint":{"line":19,"column":51},"line":19,"code":"  it('correctly measures hydrate followed by render', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.waitForElementByCss('#to-other')\n    await browser.elementByCss('#to-other').click()\n    await browser.waitForElementByCss('#on-other')\n\n    const beacons = (await browser.eval('window.__BEACONS'))\n      .map(([, value]) => Object.fromEntries(new URLSearchParams(value)))\n      .filter((p) => p.label === 'custom')\n    expect(beacons).toMatchObject([\n      { name: 'Next.js-hydration' },\n      { name: 'Next.js-render' },\n      { name: 'Next.js-route-change-to-render' },\n    ])\n\n    await browser.close()\n  })","file":"integration/hydrate-then-render/test/index.test.js","skipped":false,"dir":"test"},{"name":"hydrates correctly for normal page","suites":[],"updatePoint":{"line":20,"column":40},"line":20,"code":"  it('hydrates correctly for normal page', async () => {\n    const browser = await webdriver(appPort, '/')\n    expect(await browser.eval('window.didHydrate')).toBe(true)\n  })","file":"integration/hydration/test/index.test.js","skipped":false,"dir":"test"},{"name":"hydrates correctly for //","suites":[],"updatePoint":{"line":25,"column":31},"line":25,"code":"  it('hydrates correctly for //', async () => {\n    const browser = await webdriver(appPort, '//')\n    expect(await browser.eval('window.didHydrate')).toBe(true)\n  })","file":"integration/hydration/test/index.test.js","skipped":false,"dir":"test"},{"name":"should be able to navigate after loading //","suites":[],"updatePoint":{"line":30,"column":49},"line":30,"code":"  it('should be able to navigate after loading //', async () => {\n    const browser = await webdriver(appPort, '//')\n    await browser.eval('window.beforeNav = true')\n    await browser.eval('window.next.router.push(\"/details\")')\n    await check(\n      () => browser.eval('document.documentElement.innerHTML'),\n      /details/\n    )\n    expect(await browser.eval('window.beforeNav')).toBe(true)\n  })","file":"integration/hydration/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct props for blocking notFound","suites":["i18n Support basePath","serverless mode"],"updatePoint":{"line":92,"column":55},"line":92,"code":"    it('should have correct props for blocking notFound', async () => {\n      const serverFile = getPageFileFromPagesManifest(\n        appDir,\n        '/not-found/blocking-fallback/[slug]'\n      )\n      const appPort = await findPort()\n      const mod = require(join(appDir, '.next/serverless', serverFile))\n\n      const server = http.createServer(async (req, res) => {\n        try {\n          await mod.render(req, res)\n        } catch (err) {\n          res.statusCode = 500\n          res.end('internal err')\n        }\n      })\n\n      await new Promise((resolve, reject) => {\n        server.listen(appPort, (err) => (err ? reject(err) : resolve()))\n      })\n      console.log('listening on', appPort)\n\n      const res = await fetchViaHTTP(\n        appPort,\n        `${ctx.basePath}/nl/not-found/blocking-fallback/first`\n      )\n      server.close()\n\n      expect(res.status).toBe(404)\n\n      const $ = cheerio.load(await res.text())\n      const props = JSON.parse($('#props').text())\n\n      expect($('#not-found').text().length > 0).toBe(true)\n      expect(props).toEqual({\n        is404: true,\n        locale: 'nl',\n        locales,\n        defaultLocale: 'en-US',\n      })\n    })","file":"integration/i18n-support-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve rewrites correctly","suites":["i18n Support basePath","serverless mode"],"updatePoint":{"line":134,"column":41},"line":134,"code":"    it('should resolve rewrites correctly', async () => {\n      const serverFile = getPageFileFromPagesManifest(appDir, '/another')\n      const appPort = await findPort()\n      const mod = require(join(appDir, '.next/serverless', serverFile))\n\n      const server = http.createServer(async (req, res) => {\n        try {\n          await mod.render(req, res)\n        } catch (err) {\n          res.statusCode = 500\n          res.end('internal err')\n        }\n      })\n\n      await new Promise((resolve, reject) => {\n        server.listen(appPort, (err) => (err ? reject(err) : resolve()))\n      })\n      console.log('listening on', appPort)\n\n      const requests = await Promise.all(\n        [\n          '/en-US/rewrite-1',\n          '/nl/rewrite-2',\n          '/fr/rewrite-3',\n          '/en-US/rewrite-4',\n          '/fr/rewrite-4',\n        ].map((path) =>\n          fetchViaHTTP(appPort, `${ctx.basePath}${path}`, undefined, {\n            redirect: 'manual',\n          })\n        )\n      )\n\n      server.close()\n\n      const checks = [\n        ['en-US', '/rewrite-1'],\n        ['nl', '/rewrite-2'],\n        ['nl', '/rewrite-3'],\n        ['en-US', '/rewrite-4'],\n        ['fr', '/rewrite-4'],\n      ]\n\n      for (let i = 0; i < requests.length; i++) {\n        const res = requests[i]\n        const [locale, asPath] = checks[i]\n        const $ = cheerio.load(await res.text())\n        expect($('html').attr('lang')).toBe(locale)\n        expect($('#router-locale').text()).toBe(locale)\n        expect($('#router-pathname').text()).toBe('/another')\n        expect($('#router-as-path').text()).toBe(asPath)\n      }\n    })","file":"integration/i18n-support-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have localeDetection in routes-manifest","suites":["i18n Support basePath","with localeDetection disabled"],"updatePoint":{"line":205,"column":54},"line":205,"code":"    it('should have localeDetection in routes-manifest', async () => {\n      const routesManifest = await fs.readJSON(\n        join(appDir, '.next/routes-manifest.json')\n      )\n\n      expect(routesManifest.i18n).toEqual({\n        localeDetection: false,\n        locales: [\n          'en-US',\n          'nl-NL',\n          'nl-BE',\n          'nl',\n          'fr-BE',\n          'fr',\n          'en',\n          'go',\n          'go-BE',\n          'do',\n          'do-BE',\n        ],\n        defaultLocale: 'en-US',\n        domains: [\n          {\n            http: true,\n            domain: 'example.do',\n            defaultLocale: 'do',\n            locales: ['do-BE'],\n          },\n          {\n            domain: 'example.com',\n            defaultLocale: 'go',\n            locales: ['go-BE'],\n          },\n        ],\n      })\n    })","file":"integration/i18n-support-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not detect locale from accept-language","suites":["i18n Support basePath","with localeDetection disabled"],"updatePoint":{"line":242,"column":53},"line":242,"code":"    it('should not detect locale from accept-language', async () => {\n      const res = await fetchViaHTTP(\n        ctx.appPort,\n        `${ctx.basePath || '/'}`,\n        {},\n        {\n          redirect: 'manual',\n          headers: {\n            'accept-language': 'fr',\n          },\n        }\n      )\n\n      expect(res.status).toBe(200)\n      const $ = cheerio.load(await res.text())\n      expect($('html').attr('lang')).toBe('en-US')\n      expect($('#router-locale').text()).toBe('en-US')\n      expect(JSON.parse($('#router-locales').text())).toEqual(locales)\n      expect($('#router-pathname').text()).toBe('/')\n      expect($('#router-as-path').text()).toBe('/')\n    })","file":"integration/i18n-support-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should set locale from detected path","suites":["i18n Support basePath","with localeDetection disabled"],"updatePoint":{"line":264,"column":44},"line":264,"code":"    it('should set locale from detected path', async () => {\n      for (const locale of locales) {\n        const res = await fetchViaHTTP(\n          ctx.appPort,\n          `${ctx.basePath}/${locale}`,\n          {},\n          {\n            redirect: 'manual',\n            headers: {\n              'accept-language': 'en-US,en;q=0.9',\n            },\n          }\n        )\n\n        expect(res.status).toBe(200)\n        const $ = cheerio.load(await res.text())\n        expect($('html').attr('lang')).toBe(locale)\n        expect($('#router-locale').text()).toBe(locale)\n        expect(JSON.parse($('#router-locales').text())).toEqual(locales)\n        expect($('#router-pathname').text()).toBe('/')\n        expect($('#router-as-path').text()).toBe('/')\n      }\n    })","file":"integration/i18n-support-base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should output prerendered index routes correctly","suites":[],"updatePoint":{"line":31,"column":56},"line":31,"code":"    it('should output prerendered index routes correctly', async () => {\n      expect(await fs.exists(join(buildPagesDir, 'pages/en-US.html'))).toBe(\n        true\n      )\n      expect(await fs.exists(join(buildPagesDir, 'pages/en-US.json'))).toBe(\n        true\n      )\n      expect(await fs.exists(join(buildPagesDir, 'pages/fr.html'))).toBe(true)\n      expect(await fs.exists(join(buildPagesDir, 'pages/fr.json'))).toBe(true)\n    })","file":"integration/i18n-support-catchall/test/index.test.js","skipped":false,"dir":"test"},{"name":"should load the index route correctly SSR","suites":[],"updatePoint":{"line":43,"column":47},"line":43,"code":"  it('should load the index route correctly SSR', async () => {\n    const res = await fetchViaHTTP(appPort, '/', undefined, {\n      redirect: 'manual',\n    })\n    expect(res.status).toBe(200)\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n\n    expect($('#router-locale').text()).toBe('en-US')\n    expect($('#router-default-locale').text()).toBe('en-US')\n    expect($('#router-pathname').text()).toBe('/[[...slug]]')\n    expect($('#router-as-path').text()).toBe('/')\n    expect(JSON.parse($('#props').text())).toEqual({\n      params: {},\n      locale: 'en-US',\n      locales,\n      defaultLocale: 'en-US',\n    })\n    expect(JSON.parse($('#router-locales').text())).toEqual(locales)\n  })","file":"integration/i18n-support-catchall/test/index.test.js","skipped":false,"dir":"test"},{"name":"should load the index route correctly CSR","suites":[],"updatePoint":{"line":65,"column":47},"line":65,"code":"  it('should load the index route correctly CSR', async () => {\n    const browser = await webdriver(appPort, '/')\n\n    expect(await browser.elementByCss('#router-locale').text()).toBe('en-US')\n    expect(await browser.elementByCss('#router-default-locale').text()).toBe(\n      'en-US'\n    )\n    expect(await browser.elementByCss('#router-pathname').text()).toBe(\n      '/[[...slug]]'\n    )\n    expect(await browser.elementByCss('#router-as-path').text()).toBe('/')\n    expect(\n      JSON.parse(await browser.elementByCss('#router-locales').text())\n    ).toEqual(locales)\n    expect(JSON.parse(await browser.elementByCss('#props').text())).toEqual({\n      params: {},\n      locale: 'en-US',\n      locales,\n      defaultLocale: 'en-US',\n    })\n  })","file":"integration/i18n-support-catchall/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate to other locale index and back","suites":[],"updatePoint":{"line":87,"column":52},"line":87,"code":"  it('should navigate to other locale index and back', async () => {\n    const browser = await webdriver(appPort, '/')\n\n    await browser.elementByCss('#to-locale-index').click()\n\n    await check(() => browser.eval('window.location.pathname'), '/nl-NL')\n\n    expect(await browser.elementByCss('#router-locale').text()).toBe('nl-NL')\n    expect(await browser.elementByCss('#router-default-locale').text()).toBe(\n      'en-US'\n    )\n    expect(await browser.elementByCss('#router-pathname').text()).toBe(\n      '/[[...slug]]'\n    )\n    expect(await browser.elementByCss('#router-as-path').text()).toBe('/')\n    expect(\n      JSON.parse(await browser.elementByCss('#router-locales').text())\n    ).toEqual(locales)\n    expect(JSON.parse(await browser.elementByCss('#props').text())).toEqual({\n      params: {},\n      locale: 'nl-NL',\n      locales,\n      defaultLocale: 'en-US',\n    })\n\n    await browser.back()\n\n    await check(() => browser.elementByCss('#router-locale').text(), 'en-US')\n\n    expect(await browser.elementByCss('#router-locale').text()).toBe('en-US')\n    expect(await browser.elementByCss('#router-default-locale').text()).toBe(\n      'en-US'\n    )\n    expect(await browser.elementByCss('#router-pathname').text()).toBe(\n      '/[[...slug]]'\n    )\n    expect(await browser.elementByCss('#router-as-path').text()).toBe('/')\n    expect(\n      JSON.parse(await browser.elementByCss('#router-locales').text())\n    ).toEqual(locales)\n    expect(JSON.parse(await browser.elementByCss('#props').text())).toEqual({\n      params: {},\n      locale: 'en-US',\n      locales,\n      defaultLocale: 'en-US',\n    })\n  })","file":"integration/i18n-support-catchall/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate to other locale page and back","suites":[],"updatePoint":{"line":135,"column":51},"line":135,"code":"  it('should navigate to other locale page and back', async () => {\n    const browser = await webdriver(appPort, '/')\n\n    await browser.elementByCss('#to-locale-another').click()\n\n    await check(\n      () => browser.eval('window.location.pathname'),\n      '/nl-NL/another'\n    )\n\n    expect(await browser.elementByCss('#router-locale').text()).toBe('nl-NL')\n    expect(await browser.elementByCss('#router-default-locale').text()).toBe(\n      'en-US'\n    )\n    expect(await browser.elementByCss('#router-pathname').text()).toBe(\n      '/[[...slug]]'\n    )\n    expect(await browser.elementByCss('#router-as-path').text()).toBe(\n      '/another'\n    )\n    expect(\n      JSON.parse(await browser.elementByCss('#router-locales').text())\n    ).toEqual(locales)\n    expect(JSON.parse(await browser.elementByCss('#props').text())).toEqual({\n      params: {\n        slug: ['another'],\n      },\n      locale: 'nl-NL',\n      locales,\n      defaultLocale: 'en-US',\n    })\n\n    await browser.back()\n\n    await check(() => browser.elementByCss('#router-locale').text(), 'en-US')\n\n    expect(await browser.elementByCss('#router-locale').text()).toBe('en-US')\n    expect(await browser.elementByCss('#router-default-locale').text()).toBe(\n      'en-US'\n    )\n    expect(await browser.elementByCss('#router-pathname').text()).toBe(\n      '/[[...slug]]'\n    )\n    expect(await browser.elementByCss('#router-as-path').text()).toBe('/')\n    expect(\n      JSON.parse(await browser.elementByCss('#router-locales').text())\n    ).toEqual(locales)\n    expect(JSON.parse(await browser.elementByCss('#props').text())).toEqual({\n      params: {},\n      locale: 'en-US',\n      locales,\n      defaultLocale: 'en-US',\n    })\n  })","file":"integration/i18n-support-catchall/test/index.test.js","skipped":false,"dir":"test"},{"name":"should preload data correctly","suites":[],"updatePoint":{"line":191,"column":37},"line":191,"code":"    it('should preload data correctly', async () => {\n      const browser = await webdriver(appPort, '/')\n\n      await browser.eval(`(function() {\n        document.querySelector('#to-def-locale-index').scrollIntoView()\n        document.querySelector('#to-def-locale-another').scrollIntoView()\n        document.querySelector('#to-locale-index').scrollIntoView()\n        document.querySelector('#to-locale-another').scrollIntoView()\n        document.querySelector('#to-fr-locale-another').scrollIntoView()\n        document.querySelector('#to-fr-locale-index').scrollIntoView()\n      })()`)\n\n      await check(async () => {\n        const hrefs = await browser.eval(`Object.keys(window.next.router.sdc)`)\n        hrefs.sort()\n\n        console.log({ hrefs })\n\n        assert.deepEqual(\n          hrefs.map((href) =>\n            new URL(href).pathname.replace(/^\\/_next\\/data\\/[^/]+/, '')\n          ),\n          [\n            '/en-US.json',\n            '/en-US/another.json',\n            '/fr.json',\n            '/fr/another.json',\n            '/nl-NL.json',\n            '/nl-NL/another.json',\n          ]\n        )\n        return 'yes'\n      }, 'yes')\n    })","file":"integration/i18n-support-catchall/test/index.test.js","skipped":false,"dir":"test"},{"name":"should normalize locale items in route-matches","suites":["i18n Support Root Catch-all","serverless mode"],"updatePoint":{"line":268,"column":54},"line":268,"code":"    it('should normalize locale items in route-matches', async () => {\n      const server = http.createServer(async (req, res) => {\n        try {\n          await require(join(\n            appDir,\n            '.next/serverless',\n            getPageFileFromPagesManifest(appDir, '/[[...slug]]')\n          )).render(req, res)\n        } catch (err) {\n          console.error(err)\n          res.statusCode = 500\n          res.end('internal server error')\n        }\n      })\n      const port = await findPort()\n      await new Promise((resolve, reject) => {\n        server.listen(port, (err) => (err ? reject(err) : resolve()))\n      })\n      console.log(`Listening at ::${port}`)\n\n      const res = await fetchViaHTTP(port, '/[[...slug]]', undefined, {\n        headers: {\n          'x-vercel-id': 'hi',\n          'x-now-route-matches': qs.stringify({\n            1: 'nl-NL',\n          }),\n        },\n        redirect: 'manual',\n      })\n      const res2 = await fetchViaHTTP(port, '/[[...slug]]', undefined, {\n        headers: {\n          'x-vercel-id': 'hi',\n          'x-now-route-matches': qs.stringify({\n            slug: 'eN',\n          }),\n        },\n        redirect: 'manual',\n      })\n      const res3 = await fetchViaHTTP(port, '/fr/[[...slug]]', undefined, {\n        headers: {\n          'x-vercel-id': 'hi',\n          'x-now-route-matches': qs.stringify({\n            slug: 'hello',\n          }),\n        },\n        redirect: 'manual',\n      })\n\n      const res4 = await fetchViaHTTP(port, '/fr', undefined, {\n        redirect: 'manual',\n      })\n\n      server.close()\n\n      expect(res.status).toBe(200)\n      expect(res2.status).toBe(200)\n      expect(res3.status).toBe(200)\n      expect(res4.status).toBe(200)\n\n      const $ = cheerio.load(await res.text())\n      const $2 = cheerio.load(await res2.text())\n      const $3 = cheerio.load(await res3.text())\n\n      expect($('#router-locale').text()).toBe('nl-NL')\n      expect($('#router-pathname').text()).toBe('/[[...slug]]')\n      expect($('#router-as-path').text()).toBe('/')\n      expect($('#router-default-locale').text()).toBe('en-US')\n      expect(JSON.parse($('#router-query').text())).toEqual({})\n      expect(JSON.parse($('#router-locales').text())).toEqual(locales)\n      expect(JSON.parse($('#props').text())).toEqual({\n        locale: 'nl-NL',\n        defaultLocale: 'en-US',\n        locales,\n        params: {},\n      })\n\n      expect($2('#router-locale').text()).toBe('en')\n      expect($2('#router-pathname').text()).toBe('/[[...slug]]')\n      expect($2('#router-as-path').text()).toBe('/')\n      expect($2('#router-default-locale').text()).toBe('en-US')\n      expect(JSON.parse($2('#router-query').text())).toEqual({})\n      expect(JSON.parse($2('#router-locales').text())).toEqual(locales)\n      expect(JSON.parse($2('#props').text())).toEqual({\n        locale: 'en',\n        defaultLocale: 'en-US',\n        locales,\n        params: {},\n      })\n\n      expect($3('#router-locale').text()).toBe('fr')\n      expect($3('#router-pathname').text()).toBe('/[[...slug]]')\n      expect($3('#router-as-path').text()).toBe('/hello')\n      expect($3('#router-default-locale').text()).toBe('en-US')\n      expect(JSON.parse($3('#router-query').text())).toEqual({\n        slug: ['hello'],\n      })\n      expect(JSON.parse($3('#router-locales').text())).toEqual(locales)\n      expect(JSON.parse($3('#props').text())).toEqual({\n        locale: 'fr',\n        defaultLocale: 'en-US',\n        locales,\n        params: {\n          slug: ['hello'],\n        },\n      })\n    })","file":"integration/i18n-support-catchall/test/index.test.js","skipped":false,"dir":"test"},{"name":"should localized [slug] routes render correctly","suites":[],"updatePoint":{"line":19,"column":53},"line":19,"code":"  it('should localized [slug] routes render correctly', async () => {\n    for (const locale of locales) {\n      const browser = await webdriver(\n        appPort,\n        `${locale === 'en' ? '' : `/${locale}`}/my-custom-path-1`\n      )\n\n      expect(JSON.parse(await browser.elementByCss('#props').text())).toEqual({\n        locale,\n        params: {\n          slug: 'my-custom-path-1',\n        },\n        title: 'my-custom-path-1',\n      })\n    }\n  })","file":"integration/i18n-support-custom-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"handle custom http status maintaining locale props in custom _error page","suites":[],"updatePoint":{"line":36,"column":78},"line":36,"code":"  it('handle custom http status maintaining locale props in custom _error page', async () => {\n    for (const locale of locales) {\n      const browser = await webdriver(\n        appPort,\n        `${locale === 'en' ? '' : `/${locale}`}/my-custom-gone-path`\n      )\n\n      expect(\n        JSON.parse(await browser.elementByCss('#error-props').text())\n      ).toEqual(\n        expect.objectContaining({\n          locale,\n          statusCode: 410,\n        })\n      )\n    }\n  })","file":"integration/i18n-support-custom-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"handle default http status maintaining locale props in custom _error page","suites":[],"updatePoint":{"line":54,"column":79},"line":54,"code":"  it('handle default http status maintaining locale props in custom _error page', async () => {\n    for (const locale of locales) {\n      const browser = await webdriver(\n        appPort,\n        `${locale === 'en' ? '' : `/${locale}`}/my-custom-gone-path/other-path`\n      )\n\n      expect(\n        JSON.parse(await browser.elementByCss('#error-props').text())\n      ).toEqual(\n        expect.objectContaining({\n          locale,\n          statusCode: 404,\n        })\n      )\n    }\n  })","file":"integration/i18n-support-custom-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work also on client side routing","suites":[],"updatePoint":{"line":72,"column":45},"line":72,"code":"  it('should work also on client side routing', async () => {\n    for (const locale of locales) {\n      const browser = await webdriver(\n        appPort,\n        `${locale === 'en' ? '' : `/${locale}`}/my-custom-path-1`\n      )\n\n      expect(JSON.parse(await browser.elementByCss('#props').text())).toEqual(\n        expect.objectContaining({\n          locale,\n          params: { slug: 'my-custom-path-1' },\n          title: 'my-custom-path-1',\n        })\n      )\n\n      await browser.eval('window.next.router.push(\"/my-custom-path-2\")')\n\n      expect(JSON.parse(await browser.elementByCss('#props').text())).toEqual(\n        expect.objectContaining({\n          locale,\n          params: { slug: 'my-custom-path-2' },\n          title: 'my-custom-path-2',\n        })\n      )\n\n      await browser.eval('window.next.router.push(\"/my-custom-gone-path\")')\n\n      expect(\n        JSON.parse(await browser.elementByCss('#error-props').text())\n      ).toEqual(\n        expect.objectContaining({\n          locale,\n        })\n      )\n    }\n  })","file":"integration/i18n-support-custom-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not rewrite for index page","suites":[],"updatePoint":{"line":22,"column":39},"line":22,"code":"  it('should not rewrite for index page', async () => {\n    for (const [pathname, query] of [\n      ['/', {}],\n      ['/en', {}],\n      ['/fr', {}],\n      ['/', { hello: 'world' }],\n      ['/en', { hello: 'world' }],\n      ['/fr', { hello: 'world' }],\n    ]) {\n      const asPath = url.format({ pathname, query })\n      const browser = await webdriver(appPort, asPath)\n\n      expect(JSON.parse(await browser.elementByCss('#router').text())).toEqual({\n        index: true,\n        pathname: '/',\n        asPath: url.format({ pathname: '/', query }),\n        query,\n      })\n      await waitFor(1000)\n\n      expect(JSON.parse(await browser.elementByCss('#router').text())).toEqual({\n        index: true,\n        pathname: '/',\n        asPath: url.format({ pathname: '/', query }),\n        query,\n      })\n    }\n  })","file":"integration/i18n-support-fallback-rewrite-legacy/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not rewrite for dynamic page","suites":[],"updatePoint":{"line":51,"column":41},"line":51,"code":"  it('should not rewrite for dynamic page', async () => {\n    for (const [pathname, query] of [\n      ['/dynamic/first', {}],\n      ['/en/dynamic/first', {}],\n      ['/fr/dynamic/first', {}],\n      ['/dynamic/first', { hello: 'world' }],\n      ['/en/dynamic/first', { hello: 'world' }],\n      ['/fr/dynamic/first', { hello: 'world' }],\n    ]) {\n      const asPath = url.format({ pathname, query })\n      const browser = await webdriver(appPort, asPath)\n\n      expect(JSON.parse(await browser.elementByCss('#router').text())).toEqual({\n        dynamic: true,\n        pathname: '/dynamic/[slug]',\n        asPath: url.format({ pathname: '/dynamic/first', query }),\n        query: {\n          ...query,\n          slug: 'first',\n        },\n      })\n      await waitFor(1000)\n\n      expect(JSON.parse(await browser.elementByCss('#router').text())).toEqual({\n        dynamic: true,\n        pathname: '/dynamic/[slug]',\n        asPath: url.format({ pathname: '/dynamic/first', query }),\n        query: {\n          ...query,\n          slug: 'first',\n        },\n      })\n    }\n  })","file":"integration/i18n-support-fallback-rewrite-legacy/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not rewrite for index page","suites":[],"updatePoint":{"line":22,"column":39},"line":22,"code":"  it('should not rewrite for index page', async () => {\n    for (const [pathname, query] of [\n      ['/', {}],\n      ['/en', {}],\n      ['/fr', {}],\n      ['/', { hello: 'world' }],\n      ['/en', { hello: 'world' }],\n      ['/fr', { hello: 'world' }],\n    ]) {\n      const asPath = url.format({ pathname, query })\n      const browser = await webdriver(appPort, asPath)\n\n      expect(JSON.parse(await browser.elementByCss('#router').text())).toEqual({\n        index: true,\n        pathname: '/',\n        asPath: url.format({ pathname: '/', query }),\n        query,\n      })\n      await waitFor(1000)\n\n      expect(JSON.parse(await browser.elementByCss('#router').text())).toEqual({\n        index: true,\n        pathname: '/',\n        asPath: url.format({ pathname: '/', query }),\n        query,\n      })\n    }\n  })","file":"integration/i18n-support-fallback-rewrite/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not rewrite for dynamic page","suites":[],"updatePoint":{"line":51,"column":41},"line":51,"code":"  it('should not rewrite for dynamic page', async () => {\n    for (const [pathname, query] of [\n      ['/dynamic/first', {}],\n      ['/en/dynamic/first', {}],\n      ['/fr/dynamic/first', {}],\n      ['/dynamic/first', { hello: 'world' }],\n      ['/en/dynamic/first', { hello: 'world' }],\n      ['/fr/dynamic/first', { hello: 'world' }],\n    ]) {\n      const asPath = url.format({ pathname, query })\n      const browser = await webdriver(appPort, asPath)\n\n      expect(JSON.parse(await browser.elementByCss('#router').text())).toEqual({\n        dynamic: true,\n        pathname: '/dynamic/[slug]',\n        asPath: url.format({ pathname: '/dynamic/first', query }),\n        query: {\n          ...query,\n          slug: 'first',\n        },\n      })\n      await waitFor(1000)\n\n      expect(JSON.parse(await browser.elementByCss('#router').text())).toEqual({\n        dynamic: true,\n        pathname: '/dynamic/[slug]',\n        asPath: url.format({ pathname: '/dynamic/first', query }),\n        query: {\n          ...query,\n          slug: 'first',\n        },\n      })\n    }\n  })","file":"integration/i18n-support-fallback-rewrite/test/index.test.js","skipped":false,"dir":"test"},{"name":"should rewrite index route correctly","suites":[],"updatePoint":{"line":23,"column":42},"line":23,"code":"  it('should rewrite index route correctly', async () => {\n    for (const locale of locales) {\n      const html = await renderViaHTTP(\n        appPort,\n        `/${locale === 'en' ? '' : locale}`\n      )\n      const $ = cheerio.load(html)\n\n      expect(JSON.parse($('#props').text())).toEqual({\n        params: {\n          slug: ['company', 'about-us'],\n        },\n        locale,\n        hello: 'world',\n      })\n    }\n  })","file":"integration/i18n-support-index-rewrite/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle index rewrite on client correctly","suites":[],"updatePoint":{"line":41,"column":53},"line":41,"code":"  it('should handle index rewrite on client correctly', async () => {\n    for (const locale of locales) {\n      const browser = await webdriver(\n        appPort,\n        `${locale === 'en' ? '' : `/${locale}`}/hello`\n      )\n\n      expect(JSON.parse(await browser.elementByCss('#props').text())).toEqual({\n        params: {\n          slug: ['hello'],\n        },\n        locale,\n        hello: 'world',\n      })\n      await browser.eval(`(function() {\n        window.beforeNav = 1\n        window.next.router.push('/')\n      })()`)\n\n      await check(async () => {\n        const html = await browser.eval('document.documentElement.innerHTML')\n        const props = JSON.parse(cheerio.load(html)('#props').text())\n        assert.deepEqual(props, {\n          params: {\n            slug: ['company', 'about-us'],\n          },\n          locale,\n          hello: 'world',\n        })\n        return 'success'\n      }, 'success')\n\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n    }\n  })","file":"integration/i18n-support-index-rewrite/test/index.test.js","skipped":false,"dir":"test"},{"name":"should update props on locale change with same hash","suites":[],"updatePoint":{"line":19,"column":57},"line":19,"code":"  it('should update props on locale change with same hash', async () => {\n    const browser = await webdriver(appPort, `/about#hash`)\n\n    await browser.elementByCss('#change-locale').click()\n\n    await check(() => browser.eval('window.location.pathname'), '/fr/about')\n    await check(() => browser.eval('window.location.hash'), '#hash')\n\n    expect(await browser.elementByCss('#router-locale').text()).toBe('fr')\n    expect(await browser.elementByCss('#props-locale').text()).toBe('fr')\n\n    await browser.elementByCss('#change-locale').click()\n\n    await check(() => browser.eval('window.location.pathname'), '/about')\n    await check(() => browser.eval('window.location.hash'), '#hash')\n\n    expect(await browser.elementByCss('#router-locale').text()).toBe('en')\n    expect(await browser.elementByCss('#props-locale').text()).toBe('en')\n  })","file":"integration/i18n-support-same-page-hash-change/test/index.test.js","skipped":false,"dir":"test"},{"name":"should update props on locale change with same hash (dynamic page)","suites":[],"updatePoint":{"line":39,"column":72},"line":39,"code":"  it('should update props on locale change with same hash (dynamic page)', async () => {\n    const browser = await webdriver(appPort, `/posts/a#hash`)\n\n    await browser.elementByCss('#change-locale').click()\n\n    await check(() => browser.eval('window.location.pathname'), '/fr/posts/a')\n    await check(() => browser.eval('window.location.hash'), '#hash')\n\n    expect(await browser.elementByCss('#router-locale').text()).toBe('fr')\n    expect(await browser.elementByCss('#props-locale').text()).toBe('fr')\n\n    await browser.elementByCss('#change-locale').click()\n\n    await check(() => browser.eval('window.location.pathname'), '/posts/a')\n    await check(() => browser.eval('window.location.hash'), '#hash')\n\n    expect(await browser.elementByCss('#router-locale').text()).toBe('en')\n    expect(await browser.elementByCss('#props-locale').text()).toBe('en')\n  })","file":"integration/i18n-support-same-page-hash-change/test/index.test.js","skipped":false,"dir":"test"},{"name":"should trigger hash change events","suites":[],"updatePoint":{"line":59,"column":39},"line":59,"code":"  it('should trigger hash change events', async () => {\n    const browser = await webdriver(appPort, `/about#hash`)\n\n    await check(() => browser.eval('window.location.hash'), '#hash')\n\n    await browser.elementByCss('#hash-change').click()\n\n    await check(() => browser.eval('window.hashChangeStart'), 'yes')\n    await check(() => browser.eval('window.hashChangeComplete'), 'yes')\n\n    await check(() => browser.eval('window.location.hash'), '#newhash')\n  })","file":"integration/i18n-support-same-page-hash-change/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have pre-rendered /500 correctly","suites":["i18n Support","production mode"],"updatePoint":{"line":80,"column":47},"line":80,"code":"    it('should have pre-rendered /500 correctly', async () => {\n      for (const locale of locales) {\n        const content = await fs.readFile(\n          join(appDir, '.next/server/pages/', locale, '500.html'),\n          'utf8'\n        )\n        expect(content).toContain('500')\n        expect(content).toMatch(/internal server error/i)\n      }\n    })","file":"integration/i18n-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct props for blocking notFound","suites":["i18n Support","serverless mode"],"updatePoint":{"line":109,"column":55},"line":109,"code":"    it('should have correct props for blocking notFound', async () => {\n      const serverFile = getPageFileFromPagesManifest(\n        appDir,\n        '/not-found/blocking-fallback/[slug]'\n      )\n      const appPort = await findPort()\n      const mod = require(join(appDir, '.next/serverless', serverFile))\n\n      const server = http.createServer(async (req, res) => {\n        try {\n          await mod.render(req, res)\n        } catch (err) {\n          res.statusCode = 500\n          res.end('internal err')\n        }\n      })\n\n      await new Promise((resolve, reject) => {\n        server.listen(appPort, (err) => (err ? reject(err) : resolve()))\n      })\n      console.log('listening on', appPort)\n\n      const res = await fetchViaHTTP(\n        appPort,\n        '/nl/not-found/blocking-fallback/first'\n      )\n      server.close()\n\n      expect(res.status).toBe(404)\n\n      const $ = cheerio.load(await res.text())\n      const props = JSON.parse($('#props').text())\n\n      expect($('#not-found').text().length > 0).toBe(true)\n      expect(props).toEqual({\n        is404: true,\n        locale: 'nl',\n        locales,\n        defaultLocale: 'en-US',\n      })\n    })","file":"integration/i18n-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve rewrites correctly","suites":["i18n Support","serverless mode"],"updatePoint":{"line":151,"column":41},"line":151,"code":"    it('should resolve rewrites correctly', async () => {\n      const serverFile = getPageFileFromPagesManifest(appDir, '/another')\n      const appPort = await findPort()\n      const mod = require(join(appDir, '.next/serverless', serverFile))\n\n      const server = http.createServer(async (req, res) => {\n        try {\n          await mod.render(req, res)\n        } catch (err) {\n          res.statusCode = 500\n          res.end('internal err')\n        }\n      })\n\n      await new Promise((resolve, reject) => {\n        server.listen(appPort, (err) => (err ? reject(err) : resolve()))\n      })\n      console.log('listening on', appPort)\n\n      const requests = await Promise.all(\n        [\n          '/en-US/rewrite-1',\n          '/nl/rewrite-2',\n          '/fr/rewrite-3',\n          '/en-US/rewrite-4',\n          '/fr/rewrite-4',\n        ].map((path) =>\n          fetchViaHTTP(appPort, `${ctx.basePath}${path}`, undefined, {\n            redirect: 'manual',\n          })\n        )\n      )\n\n      server.close()\n\n      const checks = [\n        ['en-US', '/rewrite-1'],\n        ['nl', '/rewrite-2'],\n        ['nl', '/rewrite-3'],\n        ['en-US', '/rewrite-4'],\n        ['fr', '/rewrite-4'],\n      ]\n\n      for (let i = 0; i < requests.length; i++) {\n        const res = requests[i]\n        const [locale, asPath] = checks[i]\n        const $ = cheerio.load(await res.text())\n        expect($('html').attr('lang')).toBe(locale)\n        expect($('#router-locale').text()).toBe(locale)\n        expect($('#router-pathname').text()).toBe('/another')\n        expect($('#router-as-path').text()).toBe(asPath)\n      }\n    })","file":"integration/i18n-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have localeDetection in routes-manifest","suites":["i18n Support","with localeDetection disabled"],"updatePoint":{"line":222,"column":54},"line":222,"code":"    it('should have localeDetection in routes-manifest', async () => {\n      const routesManifest = await fs.readJSON(\n        join(appDir, '.next/routes-manifest.json')\n      )\n\n      expect(routesManifest.i18n).toEqual({\n        localeDetection: false,\n        locales: [\n          'en-US',\n          'nl-NL',\n          'nl-BE',\n          'nl',\n          'fr-BE',\n          'fr',\n          'en',\n          'go',\n          'go-BE',\n          'do',\n          'do-BE',\n        ],\n        defaultLocale: 'en-US',\n        domains: [\n          {\n            http: true,\n            domain: 'example.do',\n            defaultLocale: 'do',\n            locales: ['do-BE'],\n          },\n          {\n            domain: 'example.com',\n            defaultLocale: 'go',\n            locales: ['go-BE'],\n          },\n        ],\n      })\n    })","file":"integration/i18n-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not detect locale from accept-language","suites":["i18n Support","with localeDetection disabled"],"updatePoint":{"line":259,"column":53},"line":259,"code":"    it('should not detect locale from accept-language', async () => {\n      const res = await fetchViaHTTP(\n        ctx.appPort,\n        '/',\n        {},\n        {\n          redirect: 'manual',\n          headers: {\n            'accept-language': 'fr',\n          },\n        }\n      )\n\n      expect(res.status).toBe(200)\n      const $ = cheerio.load(await res.text())\n      expect($('html').attr('lang')).toBe('en-US')\n      expect($('#router-locale').text()).toBe('en-US')\n      expect(JSON.parse($('#router-locales').text())).toEqual(locales)\n      expect($('#router-pathname').text()).toBe('/')\n      expect($('#router-as-path').text()).toBe('/')\n    })","file":"integration/i18n-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should ignore the invalid accept-language header","suites":["i18n Support","with localeDetection disabled"],"updatePoint":{"line":281,"column":56},"line":281,"code":"    it('should ignore the invalid accept-language header', async () => {\n      nextConfig.replace('localeDetection: false', 'localeDetection: true')\n      const res = await fetchViaHTTP(\n        ctx.appPort,\n        '/',\n        {},\n        {\n          headers: {\n            'accept-language': 'ldfir;',\n          },\n        }\n      )\n\n      expect(res.status).toBe(200)\n      const $ = cheerio.load(await res.text())\n      expect($('html').attr('lang')).toBe('en-US')\n      expect($('#router-locale').text()).toBe('en-US')\n      expect(JSON.parse($('#router-locales').text())).toEqual(locales)\n      expect($('#router-pathname').text()).toBe('/')\n      expect($('#router-as-path').text()).toBe('/')\n    })","file":"integration/i18n-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should set locale from detected path","suites":["i18n Support","with localeDetection disabled"],"updatePoint":{"line":303,"column":44},"line":303,"code":"    it('should set locale from detected path', async () => {\n      for (const locale of nonDomainLocales) {\n        const res = await fetchViaHTTP(\n          ctx.appPort,\n          `/${locale}`,\n          {},\n          {\n            redirect: 'manual',\n            headers: {\n              'accept-language': 'en-US,en;q=0.9',\n            },\n          }\n        )\n\n        expect(res.status).toBe(200)\n        const $ = cheerio.load(await res.text())\n        expect($('html').attr('lang')).toBe(locale)\n        expect($('#router-locale').text()).toBe(locale)\n        expect(JSON.parse($('#router-locales').text())).toEqual(locales)\n        expect($('#router-pathname').text()).toBe('/')\n        expect($('#router-as-path').text()).toBe('/')\n      }\n    })","file":"integration/i18n-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should preload all locales data correctly","suites":["i18n Support","with trailingSlash: true"],"updatePoint":{"line":331,"column":53},"line":331,"code":"        it('should preload all locales data correctly', async () => {\n          const browser = await webdriver(\n            curCtx.appPort,\n            `${curCtx.basePath}/mixed`\n          )\n\n          await browser.eval(`(function() {\n            document.querySelector('#to-gsp-en-us').scrollIntoView()\n            document.querySelector('#to-gsp-nl-nl').scrollIntoView()\n            document.querySelector('#to-gsp-fr').scrollIntoView()\n          })()`)\n\n          await check(async () => {\n            const hrefs = await browser.eval(\n              `Object.keys(window.next.router.sdc)`\n            )\n            hrefs.sort()\n\n            assert.deepEqual(\n              hrefs.map((href) =>\n                new URL(href).pathname\n                  .replace(ctx.basePath, '')\n                  .replace(/^\\/_next\\/data\\/[^/]+/, '')\n              ),\n              ['/en-US/gsp.json', '/fr.json', '/fr/gsp.json', '/nl-NL/gsp.json']\n            )\n            return 'yes'\n          }, 'yes')\n        })","file":"integration/i18n-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should redirect correctly","suites":["i18n Support","with trailingSlash: true"],"updatePoint":{"line":362,"column":35},"line":362,"code":"      it('should redirect correctly', async () => {\n        for (const locale of nonDomainLocales) {\n          const res = await fetchViaHTTP(curCtx.appPort, '/', undefined, {\n            redirect: 'manual',\n            headers: {\n              'accept-language': locale,\n            },\n          })\n\n          if (locale === 'en-US') {\n            expect(res.status).toBe(200)\n          } else {\n            expect(res.status).toBe(307)\n\n            const parsed = url.parse(res.headers.get('location'), true)\n            expect(parsed.pathname).toBe(`/${locale}`)\n            expect(parsed.query).toEqual({})\n          }\n        }\n      })","file":"integration/i18n-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should serve pages correctly with locale prefix","suites":["i18n Support","with trailingSlash: true"],"updatePoint":{"line":383,"column":57},"line":383,"code":"      it('should serve pages correctly with locale prefix', async () => {\n        for (const locale of nonDomainLocales) {\n          for (const [pathname, asPath] of [\n            ['/', '/'],\n            ['/links', '/links/'],\n            ['/auto-export', '/auto-export/'],\n            ['/gsp', '/gsp/'],\n            ['/gsp/fallback/[slug]', '/gsp/fallback/always/'],\n            ['/gssp', '/gssp/'],\n            ['/gssp/[slug]', '/gssp/first/'],\n          ]) {\n            const res = await fetchViaHTTP(\n              curCtx.appPort,\n              `${locale === 'en-US' ? '' : `/${locale}`}${asPath}`,\n              undefined,\n              {\n                redirect: 'manual',\n              }\n            )\n            expect(res.status).toBe(200)\n\n            const $ = cheerio.load(await res.text())\n\n            expect($('#router-pathname').text()).toBe(pathname)\n            expect($('#router-as-path').text()).toBe(asPath)\n            expect($('#router-locale').text()).toBe(locale)\n            expect(JSON.parse($('#router-locales').text())).toEqual(locales)\n            expect($('#router-default-locale').text()).toBe('en-US')\n          }\n        }\n      })","file":"integration/i18n-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return 404 error for repeating locales","suites":["i18n Support","with trailingSlash: true"],"updatePoint":{"line":415,"column":55},"line":415,"code":"      it('should return 404 error for repeating locales', async () => {\n        const defaultLocale = 'en-US'\n        for (const locale of nonDomainLocales) {\n          for (const asPath of [\n            '/gsp/fallback/always/',\n            '/post/comment/',\n            '/gssp/first/',\n          ]) {\n            const res = await fetchViaHTTP(\n              curCtx.appPort,\n              `/${locale}/${defaultLocale}${asPath}`,\n              undefined,\n              {\n                redirect: 'manual',\n              }\n            )\n            expect(res.status).toBe(404)\n            const $ = cheerio.load(await res.text())\n            const props = JSON.parse($('#props').text())\n            expect($('#not-found').text().length > 0).toBe(true)\n            expect(props).toEqual({\n              is404: true,\n              locale,\n              locales,\n              defaultLocale,\n            })\n          }\n        }\n      })","file":"integration/i18n-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate between pages correctly","suites":["i18n Support","with trailingSlash: true"],"updatePoint":{"line":445,"column":49},"line":445,"code":"      it('should navigate between pages correctly', async () => {\n        for (const locale of nonDomainLocales) {\n          const localePath = `/${locale !== 'en-US' ? `${locale}/` : ''}`\n          const browser = await webdriver(curCtx.appPort, localePath)\n\n          await browser.eval('window.beforeNav = 1')\n          await browser.elementByCss('#to-gsp').click()\n          await browser.waitForElementByCss('#gsp')\n\n          expect(await browser.elementByCss('#router-pathname').text()).toBe(\n            '/gsp'\n          )\n          expect(await browser.elementByCss('#router-as-path').text()).toBe(\n            '/gsp/'\n          )\n          expect(await browser.elementByCss('#router-locale').text()).toBe(\n            locale\n          )\n          expect(await browser.eval('window.beforeNav')).toBe(1)\n          expect(await browser.eval('window.location.pathname')).toBe(\n            `${localePath}gsp/`\n          )\n\n          await browser.back().waitForElementByCss('#index')\n\n          expect(await browser.elementByCss('#router-pathname').text()).toBe(\n            '/'\n          )\n          expect(await browser.elementByCss('#router-as-path').text()).toBe('/')\n          expect(await browser.elementByCss('#router-locale').text()).toBe(\n            locale\n          )\n          expect(await browser.eval('window.beforeNav')).toBe(1)\n          expect(await browser.eval('window.location.pathname')).toBe(\n            `${localePath}`\n          )\n\n          await browser.elementByCss('#to-gssp-slug').click()\n          await browser.waitForElementByCss('#gssp')\n\n          expect(await browser.elementByCss('#router-pathname').text()).toBe(\n            '/gssp/[slug]'\n          )\n          expect(await browser.elementByCss('#router-as-path').text()).toBe(\n            '/gssp/first/'\n          )\n          expect(await browser.elementByCss('#router-locale').text()).toBe(\n            locale\n          )\n          expect(await browser.eval('window.beforeNav')).toBe(1)\n          expect(await browser.eval('window.location.pathname')).toBe(\n            `${localePath}gssp/first/`\n          )\n\n          await browser.back().waitForElementByCss('#index')\n          await browser.elementByCss('#to-api-post').click()\n\n          await browser.waitForCondition(\n            'window.location.pathname === \"/api/post/asdf/\"'\n          )\n          const body = await browser.elementByCss('body').text()\n          const json = JSON.parse(body)\n          expect(json.post).toBe(true)\n        }\n      })","file":"integration/i18n-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show proper error for duplicate defaultLocales","suites":["i18n Support","with trailingSlash: true","production mode"],"updatePoint":{"line":553,"column":59},"line":553,"code":"  it('should show proper error for duplicate defaultLocales', async () => {\n    nextConfig.write(`\n      module.exports = {\n        i18n: {\n          locales: ['en', 'fr', 'nl'],\n          defaultLocale: 'en',\n          domains: [\n            {\n              domain: 'example.com',\n              defaultLocale: 'en'\n            },\n            {\n              domain: 'fr.example.com',\n              defaultLocale: 'fr',\n            },\n            {\n              domain: 'french.example.com',\n              defaultLocale: 'fr',\n            }\n          ]\n        }\n      }\n    `)\n\n    const { code, stderr } = await nextBuild(appDir, undefined, {\n      stderr: true,\n    })\n    nextConfig.restore()\n    expect(code).toBe(1)\n    expect(stderr).toContain(\n      'Both fr.example.com and french.example.com configured the defaultLocale fr but only one can'\n    )\n  })","file":"integration/i18n-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show proper error for duplicate locales","suites":["i18n Support","with trailingSlash: true","production mode"],"updatePoint":{"line":587,"column":52},"line":587,"code":"  it('should show proper error for duplicate locales', async () => {\n    nextConfig.write(`\n      module.exports = {\n        i18n: {\n          locales: ['en', 'fr', 'nl', 'eN', 'fr'],\n          defaultLocale: 'en',\n        }\n      }\n    `)\n\n    const { code, stderr } = await nextBuild(appDir, undefined, {\n      stderr: true,\n    })\n    nextConfig.restore()\n    expect(code).toBe(1)\n    expect(stderr).toContain(\n      'Specified i18n.locales contains the following duplicate locales:'\n    )\n    expect(stderr).toContain(`eN, fr`)\n  })","file":"integration/i18n-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should include assetPrefix when placeholder=blur during next dev","suites":["Image Component assetPrefix Tests","dev mode"],"updatePoint":{"line":26,"column":72},"line":26,"code":"    it('should include assetPrefix when placeholder=blur during next dev', async () => {\n      let browser\n      try {\n        browser = await webdriver(appPort, '/')\n        const id = 'test1'\n        const bgImage = await browser.eval(\n          `document.getElementById('${id}').style['background-image']`\n        )\n        expect(bgImage).toMatch(\n          /\\/_next\\/image\\?url=https%3A%2F%2Fexample.com%2Fpre%2F_next%2Fstatic%2Fmedia%2Ftest(.+).jpg&w=8&q=70/\n        )\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/image-component/asset-prefix/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should use base64 data url with placeholder=blur during next start","suites":["Image Component assetPrefix Tests","server mode"],"updatePoint":{"line":53,"column":74},"line":53,"code":"    it('should use base64 data url with placeholder=blur during next start', async () => {\n      let browser\n      try {\n        browser = await webdriver(appPort, '/')\n        const id = 'test1'\n        const bgImage = await browser.eval(\n          `document.getElementById('${id}').style['background-image']`\n        )\n        expect(bgImage).toMatch('data:image/jpeg;base64')\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/image-component/asset-prefix/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should load the images","suites":[],"updatePoint":{"line":65,"column":28},"line":65,"code":"  it('should load the images', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/docs')\n\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById('basic-image').naturalWidth`\n        )\n\n        if (result === 0) {\n          throw new Error('Incorrectly loaded image')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n\n      expect(\n        await hasImageMatchingUrl(\n          browser,\n          `http://localhost:${appPort}/docs/_next/image?url=%2Fdocs%2Ftest.jpg&w=828&q=75`\n        )\n      ).toBe(true)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/base-path/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should update the image on src change","suites":[],"updatePoint":{"line":95,"column":43},"line":95,"code":"  it('should update the image on src change', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/docs/update')\n\n      await check(\n        () => browser.eval(`document.getElementById(\"update-image\").src`),\n        /test\\.jpg/\n      )\n\n      await browser.eval(`document.getElementById(\"toggle\").click()`)\n\n      await check(\n        () => browser.eval(`document.getElementById(\"update-image\").src`),\n        /test\\.png/\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/base-path/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should work when using flexbox","suites":[],"updatePoint":{"line":118,"column":36},"line":118,"code":"  it('should work when using flexbox', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/docs/flex')\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById('basic-image').width`\n        )\n        if (result === 0) {\n          throw new Error('Incorrectly loaded image')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/base-path/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should work with layout-fixed so resizing window does not resize image","suites":[],"updatePoint":{"line":139,"column":76},"line":139,"code":"  it('should work with layout-fixed so resizing window does not resize image', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/docs/layout-fixed')\n      const width = 1200\n      const height = 700\n      const delta = 250\n      const id = 'fixed1'\n      expect(await getSrc(browser, id)).toBe(\n        '/docs/_next/image?url=%2Fdocs%2Fwide.png&w=3840&q=75'\n      )\n      expect(await browser.elementById(id).getAttribute('srcset')).toBe(\n        '/docs/_next/image?url=%2Fdocs%2Fwide.png&w=1200&q=75 1x, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=3840&q=75 2x'\n      )\n      expect(await browser.elementById(id).getAttribute('sizes')).toBeFalsy()\n      await browser.setDimensions({\n        width: width + delta,\n        height: height + delta,\n      })\n      expect(await getComputed(browser, id, 'width')).toBe(width)\n      expect(await getComputed(browser, id, 'height')).toBe(height)\n      await browser.setDimensions({\n        width: width - delta,\n        height: height - delta,\n      })\n      expect(await getComputed(browser, id, 'width')).toBe(width)\n      expect(await getComputed(browser, id, 'height')).toBe(height)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/base-path/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should work with layout-intrinsic so resizing window maintains image aspect ratio","suites":[],"updatePoint":{"line":173,"column":87},"line":173,"code":"  it('should work with layout-intrinsic so resizing window maintains image aspect ratio', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/docs/layout-intrinsic')\n      const width = 1200\n      const height = 700\n      const delta = 250\n      const id = 'intrinsic1'\n      expect(await getSrc(browser, id)).toBe(\n        '/docs/_next/image?url=%2Fdocs%2Fwide.png&w=3840&q=75'\n      )\n      expect(await browser.elementById(id).getAttribute('srcset')).toBe(\n        '/docs/_next/image?url=%2Fdocs%2Fwide.png&w=1200&q=75 1x, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=3840&q=75 2x'\n      )\n      expect(await browser.elementById(id).getAttribute('sizes')).toBeFalsy()\n      await browser.setDimensions({\n        width: width + delta,\n        height: height + delta,\n      })\n      expect(await getComputed(browser, id, 'width')).toBe(width)\n      expect(await getComputed(browser, id, 'height')).toBe(height)\n      await browser.setDimensions({\n        width: width - delta,\n        height: height - delta,\n      })\n      const newWidth = await getComputed(browser, id, 'width')\n      const newHeight = await getComputed(browser, id, 'height')\n      expect(newWidth).toBeLessThan(width)\n      expect(newHeight).toBeLessThan(height)\n      expect(getRatio(newWidth, newHeight)).toBeCloseTo(\n        getRatio(width, height),\n        1\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/base-path/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should work with layout-responsive so resizing window maintains image aspect ratio","suites":[],"updatePoint":{"line":213,"column":88},"line":213,"code":"  it('should work with layout-responsive so resizing window maintains image aspect ratio', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/docs/layout-responsive')\n      const width = 1200\n      const height = 700\n      const delta = 250\n      const id = 'responsive1'\n      expect(await getSrc(browser, id)).toBe(\n        '/docs/_next/image?url=%2Fdocs%2Fwide.png&w=3840&q=75'\n      )\n      expect(await browser.elementById(id).getAttribute('srcset')).toBe(\n        '/docs/_next/image?url=%2Fdocs%2Fwide.png&w=640&q=75 640w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=750&q=75 750w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=828&q=75 828w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=1080&q=75 1080w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=1200&q=75 1200w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=1920&q=75 1920w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=2048&q=75 2048w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=3840&q=75 3840w'\n      )\n      expect(await browser.elementById(id).getAttribute('sizes')).toBe('100vw')\n      await browser.setDimensions({\n        width: width + delta,\n        height: height + delta,\n      })\n      expect(await getComputed(browser, id, 'width')).toBeGreaterThan(width)\n      expect(await getComputed(browser, id, 'height')).toBeGreaterThan(height)\n      await browser.setDimensions({\n        width: width - delta,\n        height: height - delta,\n      })\n      const newWidth = await getComputed(browser, id, 'width')\n      const newHeight = await getComputed(browser, id, 'height')\n      expect(newWidth).toBeLessThan(width)\n      expect(newHeight).toBeLessThan(height)\n      expect(getRatio(newWidth, newHeight)).toBeCloseTo(\n        getRatio(width, height),\n        1\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/base-path/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should work with layout-fill to fill the parent but NOT stretch with viewport","suites":[],"updatePoint":{"line":253,"column":83},"line":253,"code":"  it('should work with layout-fill to fill the parent but NOT stretch with viewport', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/docs/layout-fill')\n      const width = 600\n      const height = 350\n      const delta = 150\n      const id = 'fill1'\n      expect(await getSrc(browser, id)).toBe(\n        '/docs/_next/image?url=%2Fdocs%2Fwide.png&w=3840&q=75'\n      )\n      expect(await browser.elementById(id).getAttribute('srcset')).toBe(\n        '/docs/_next/image?url=%2Fdocs%2Fwide.png&w=640&q=75 640w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=750&q=75 750w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=828&q=75 828w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=1080&q=75 1080w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=1200&q=75 1200w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=1920&q=75 1920w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=2048&q=75 2048w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=3840&q=75 3840w'\n      )\n      expect(await browser.elementById(id).getAttribute('sizes')).toBe('100vw')\n      await browser.setDimensions({\n        width: width + delta,\n        height: height + delta,\n      })\n      expect(await getComputed(browser, id, 'width')).toBe(width)\n      expect(await getComputed(browser, id, 'height')).toBe(height)\n      await browser.setDimensions({\n        width: width - delta,\n        height: height - delta,\n      })\n      const newWidth = await getComputed(browser, id, 'width')\n      const newHeight = await getComputed(browser, id, 'height')\n      expect(newWidth).toBe(width)\n      expect(newHeight).toBe(height)\n      expect(getRatio(newWidth, newHeight)).toBeCloseTo(\n        getRatio(width, height),\n        1\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/base-path/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should work with layout-fill to fill the parent and stretch with viewport","suites":[],"updatePoint":{"line":293,"column":79},"line":293,"code":"  it('should work with layout-fill to fill the parent and stretch with viewport', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/docs/layout-fill')\n      const id = 'fill2'\n      const width = await getComputed(browser, id, 'width')\n      const height = await getComputed(browser, id, 'height')\n      await browser.eval(`document.getElementById(\"${id}\").scrollIntoView()`)\n      expect(await getSrc(browser, id)).toBe(\n        '/docs/_next/image?url=%2Fdocs%2Fwide.png&w=3840&q=75'\n      )\n      expect(await browser.elementById(id).getAttribute('srcset')).toBe(\n        '/docs/_next/image?url=%2Fdocs%2Fwide.png&w=640&q=75 640w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=750&q=75 750w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=828&q=75 828w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=1080&q=75 1080w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=1200&q=75 1200w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=1920&q=75 1920w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=2048&q=75 2048w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=3840&q=75 3840w'\n      )\n      expect(await browser.elementById(id).getAttribute('sizes')).toBe('100vw')\n      expect(await getComputed(browser, id, 'width')).toBe(width)\n      expect(await getComputed(browser, id, 'height')).toBe(height)\n      const delta = 150\n      const largeWidth = Number(width) + delta\n      const largeHeight = Number(height) + delta\n      await browser.setDimensions({\n        width: largeWidth,\n        height: largeHeight,\n      })\n      expect(await getComputed(browser, id, 'width')).toBe(largeWidth)\n      expect(await getComputed(browser, id, 'height')).toBe(largeHeight)\n      const smallWidth = Number(width) - delta\n      const smallHeight = Number(height) - delta\n      await browser.setDimensions({\n        width: smallWidth,\n        height: smallHeight,\n      })\n      expect(await getComputed(browser, id, 'width')).toBe(smallWidth)\n      expect(await getComputed(browser, id, 'height')).toBe(smallHeight)\n\n      const objectFit = await browser.eval(\n        `document.getElementById(\"${id}\").style.objectFit`\n      )\n      const objectPosition = await browser.eval(\n        `document.getElementById(\"${id}\").style.objectPosition`\n      )\n      expect(objectFit).toBe('cover')\n      expect(objectPosition).toBe('left center')\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/base-path/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should work with sizes and automatically use layout-responsive","suites":[],"updatePoint":{"line":343,"column":68},"line":343,"code":"  it('should work with sizes and automatically use layout-responsive', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/docs/sizes')\n      const width = 1200\n      const height = 700\n      const delta = 250\n      const id = 'sizes1'\n      expect(await getSrc(browser, id)).toBe(\n        '/docs/_next/image?url=%2Fdocs%2Fwide.png&w=3840&q=75'\n      )\n      expect(await browser.elementById(id).getAttribute('srcset')).toBe(\n        '/docs/_next/image?url=%2Fdocs%2Fwide.png&w=16&q=75 16w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=32&q=75 32w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=48&q=75 48w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=64&q=75 64w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=96&q=75 96w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=128&q=75 128w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=256&q=75 256w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=384&q=75 384w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=640&q=75 640w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=750&q=75 750w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=828&q=75 828w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=1080&q=75 1080w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=1200&q=75 1200w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=1920&q=75 1920w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=2048&q=75 2048w, /docs/_next/image?url=%2Fdocs%2Fwide.png&w=3840&q=75 3840w'\n      )\n      expect(await browser.elementById(id).getAttribute('sizes')).toBe(\n        '(max-width: 2048px) 1200px, 3840px'\n      )\n      await browser.setDimensions({\n        width: width + delta,\n        height: height + delta,\n      })\n      expect(await getComputed(browser, id, 'width')).toBeGreaterThan(width)\n      expect(await getComputed(browser, id, 'height')).toBeGreaterThan(height)\n      await browser.setDimensions({\n        width: width - delta,\n        height: height - delta,\n      })\n      const newWidth = await getComputed(browser, id, 'width')\n      const newHeight = await getComputed(browser, id, 'height')\n      expect(newWidth).toBeLessThan(width)\n      expect(newHeight).toBeLessThan(height)\n      expect(getRatio(newWidth, newHeight)).toBeCloseTo(\n        getRatio(width, height),\n        1\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/base-path/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show missing src error","suites":[],"updatePoint":{"line":386,"column":37},"line":386,"code":"    it('should show missing src error', async () => {\n      const browser = await webdriver(appPort, '/docs/missing-src')\n\n      expect(await hasRedbox(browser)).toBe(false)\n\n      await check(async () => {\n        return (await browser.log()).map((log) => log.message).join('\\n')\n      }, /Image is missing required \"src\" property/gm)\n    })","file":"integration/image-component/base-path/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show invalid src error","suites":[],"updatePoint":{"line":396,"column":37},"line":396,"code":"    it('should show invalid src error', async () => {\n      const browser = await webdriver(appPort, '/docs/invalid-src')\n\n      expect(await hasRedbox(browser)).toBe(true)\n      expect(await getRedboxHeader(browser)).toContain(\n        'Invalid src prop (https://google.com/test.png) on `next/image`, hostname \"google.com\" is not configured under images in your `next.config.js`'\n      )\n    })","file":"integration/image-component/base-path/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show invalid src error when protocol-relative","suites":[],"updatePoint":{"line":405,"column":60},"line":405,"code":"    it('should show invalid src error when protocol-relative', async () => {\n      const browser = await webdriver(\n        appPort,\n        '/docs/invalid-src-proto-relative'\n      )\n\n      expect(await hasRedbox(browser)).toBe(true)\n      expect(await getRedboxHeader(browser)).toContain(\n        'Failed to parse src \"//assets.example.com/img.jpg\" on `next/image`, protocol-relative URL (//) must be changed to an absolute URL (http:// or https://)'\n      )\n    })","file":"integration/image-component/base-path/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should correctly ignore prose styles","suites":[],"updatePoint":{"line":418,"column":42},"line":418,"code":"  it('should correctly ignore prose styles', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/docs/prose')\n\n      const id = 'prose-image'\n\n      // Wait for image to load:\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById(${JSON.stringify(id)}).naturalWidth`\n        )\n\n        if (result < 1) {\n          throw new Error('Image not ready')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n\n      await waitFor(1000)\n\n      const computedWidth = await getComputed(browser, id, 'width')\n      const computedHeight = await getComputed(browser, id, 'height')\n      expect(getRatio(computedWidth, computedHeight)).toBeCloseTo(1, 1)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/base-path/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should correctly rotate image","suites":[],"updatePoint":{"line":452,"column":37},"line":452,"code":"    it('should correctly rotate image', async () => {\n      let browser\n      try {\n        browser = await webdriver(appPort, '/docs/rotated')\n\n        const id = 'exif-rotation-image'\n\n        // Wait for image to load:\n        await check(async () => {\n          const result = await browser.eval(\n            `document.getElementById(${JSON.stringify(id)}).naturalWidth`\n          )\n\n          if (result < 1) {\n            throw new Error('Image not ready')\n          }\n\n          return 'result-correct'\n        }, /result-correct/)\n\n        await waitFor(1000)\n\n        const computedWidth = await getComputed(browser, id, 'width')\n        const computedHeight = await getComputed(browser, id, 'height')\n        expect(getRatio(computedWidth, computedHeight)).toBeCloseTo(0.5625, 1)\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/image-component/base-path/test/index.test.ts","skipped":false,"dir":"test"},{"name":"Should allow an image with a static src to omit height and width","suites":[],"updatePoint":{"line":23,"column":70},"line":23,"code":"  it('Should allow an image with a static src to omit height and width', async () => {\n    expect(await browser.elementById('basic-static')).toBeTruthy()\n    expect(await browser.elementById('blur-png')).toBeTruthy()\n    expect(await browser.elementById('blur-webp')).toBeTruthy()\n    expect(await browser.elementById('blur-avif')).toBeTruthy()\n    expect(await browser.elementById('blur-jpg')).toBeTruthy()\n    expect(await browser.elementById('static-svg')).toBeTruthy()\n    expect(await browser.elementById('static-gif')).toBeTruthy()\n    expect(await browser.elementById('static-bmp')).toBeTruthy()\n    expect(await browser.elementById('static-ico')).toBeTruthy()\n    expect(await browser.elementById('static-unoptimized')).toBeTruthy()\n  })","file":"integration/image-component/base-path/test/static.test.ts","skipped":false,"dir":"test"},{"name":"Should use immutable cache-control header for static import","suites":[],"updatePoint":{"line":35,"column":65},"line":35,"code":"  it('Should use immutable cache-control header for static import', async () => {\n    await browser.eval(\n      `document.getElementById(\"basic-static\").scrollIntoView()`\n    )\n    await waitFor(1000)\n    const url = await browser.eval(\n      `document.getElementById(\"basic-static\").src`\n    )\n    const res = await fetch(url)\n    expect(res.headers.get('cache-control')).toBe(\n      'public, max-age=315360000, immutable'\n    )\n  })","file":"integration/image-component/base-path/test/static.test.ts","skipped":false,"dir":"test"},{"name":"Should use immutable cache-control header even when unoptimized","suites":[],"updatePoint":{"line":50,"column":71},"line":50,"code":"    it('Should use immutable cache-control header even when unoptimized', async () => {\n      await browser.eval(\n        `document.getElementById(\"static-unoptimized\").scrollIntoView()`\n      )\n      await waitFor(1000)\n      const url = await browser.eval(\n        `document.getElementById(\"static-unoptimized\").src`\n      )\n      const res = await fetch(url)\n      expect(res.headers.get('cache-control')).toBe(\n        'public, max-age=31536000, immutable'\n      )\n    })","file":"integration/image-component/base-path/test/static.test.ts","skipped":false,"dir":"test"},{"name":"Should automatically provide an image height and width","suites":[],"updatePoint":{"line":64,"column":60},"line":64,"code":"  it('Should automatically provide an image height and width', async () => {\n    expect(html).toContain('width:400px;height:300px')\n  })","file":"integration/image-component/base-path/test/static.test.ts","skipped":false,"dir":"test"},{"name":"Should allow provided width and height to override intrinsic","suites":[],"updatePoint":{"line":67,"column":66},"line":67,"code":"  it('Should allow provided width and height to override intrinsic', async () => {\n    expect(html).toContain('width:200px;height:200px')\n    expect(html).not.toContain('width:400px;height:400px')\n  })","file":"integration/image-component/base-path/test/static.test.ts","skipped":false,"dir":"test"},{"name":"Should add a blur placeholder to statically imported jpg","suites":[],"updatePoint":{"line":71,"column":62},"line":71,"code":"  it('Should add a blur placeholder to statically imported jpg', async () => {\n    expect(html).toContain(\n      `style=\"position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(${\n        isDev\n          ? '&quot;/docs/_next/image?url=%2Fdocs%2F_next%2Fstatic%2Fmedia%2Ftest.fab2915d.jpg&amp;w=8&amp;q=70&quot;'\n          : '&quot;data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/sBCgoKCgoKCwwMCw8QDhAPFhQTExQWIhgaGBoYIjMgJSAgJSAzLTcsKSw3LVFAODhAUV5PSk9ecWVlcY+Ij7u7+//CABEIAAYACAMBIgACEQEDEQH/xAAnAAEBAAAAAAAAAAAAAAAAAAAABwEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAAmgP/xAAcEAACAQUBAAAAAAAAAAAAAAASFBMAAQMFERX/2gAIAQEAAT8AZ1HjrKZX55JysIc4Ff/EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Af//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Af//Z&quot;'\n      })`\n    )\n  })","file":"integration/image-component/base-path/test/static.test.ts","skipped":false,"dir":"test"},{"name":"Should add a blur placeholder to statically imported png","suites":[],"updatePoint":{"line":80,"column":62},"line":80,"code":"  it('Should add a blur placeholder to statically imported png', async () => {\n    expect(html).toContain(\n      `style=\"position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(${\n        isDev\n          ? '&quot;/docs/_next/image?url=%2Fdocs%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&amp;w=8&amp;q=70&quot;'\n          : '&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAICAAAAAAZhBqgAAAAJklEQVR42mNgkmBkYGXgZGBoY2Co/lPAcOf/dYaCzHwGEBAVEwUAZZIG0TbWicQAAAAASUVORK5CYII=&quot;'\n      })`\n    )\n  })","file":"integration/image-component/base-path/test/static.test.ts","skipped":false,"dir":"test"},{"name":"should throw build error when import statement is used with missing file","suites":["Build Error Tests for basePath"],"updatePoint":{"line":92,"column":78},"line":92,"code":"  it('should throw build error when import statement is used with missing file', async () => {\n    await indexPage.replace(\n      '../public/foo/test-rect.jpg',\n      '../public/foo/test-rect-broken.jpg'\n    )\n\n    const { stderr } = await nextBuild(appDir, undefined, { stderr: true })\n    await indexPage.restore()\n\n    expect(stderr).toContain(\n      \"Module not found: Can't resolve '../public/foo/test-rect-broken.jpg\"\n    )\n    // should contain the importing module\n    expect(stderr).toContain('./pages/static-img.js')\n  })","file":"integration/image-component/base-path/test/static.test.ts","skipped":false,"dir":"test"},{"name":"should render an image tag","suites":[],"updatePoint":{"line":22,"column":32},"line":22,"code":"  it('should render an image tag', async () => {\n    await waitFor(1000)\n    expect(await browser.hasElementByCssSelector('img')).toBeTruthy()\n  })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should support passing through arbitrary attributes","suites":[],"updatePoint":{"line":26,"column":57},"line":26,"code":"  it('should support passing through arbitrary attributes', async () => {\n    expect(\n      await browser.hasElementByCssSelector('img#attribute-test')\n    ).toBeTruthy()\n    expect(\n      await browser.elementByCss('img#attribute-test').getAttribute('data-demo')\n    ).toBe('demo-value')\n  })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should modify src with the loader","suites":[],"updatePoint":{"line":34,"column":39},"line":34,"code":"  it('should modify src with the loader', async () => {\n    expect(await browser.elementById('basic-image').getAttribute('src')).toBe(\n      'https://example.com/myaccount/foo.jpg?auto=format&fit=max&w=1024&q=60'\n    )\n  })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should correctly generate src even if preceding slash is included in prop","suites":[],"updatePoint":{"line":39,"column":79},"line":39,"code":"  it('should correctly generate src even if preceding slash is included in prop', async () => {\n    expect(\n      await browser.elementById('preceding-slash-image').getAttribute('src')\n    ).toBe(\n      'https://example.com/myaccount/fooslash.jpg?auto=format&fit=max&w=1024'\n    )\n  })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should add a srcset based on the loader","suites":[],"updatePoint":{"line":46,"column":45},"line":46,"code":"  it('should add a srcset based on the loader', async () => {\n    expect(\n      await browser.elementById('basic-image').getAttribute('srcset')\n    ).toBe(\n      'https://example.com/myaccount/foo.jpg?auto=format&fit=max&w=480&q=60 1x, https://example.com/myaccount/foo.jpg?auto=format&fit=max&w=1024&q=60 2x'\n    )\n  })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should add a srcset even with preceding slash in prop","suites":[],"updatePoint":{"line":53,"column":59},"line":53,"code":"  it('should add a srcset even with preceding slash in prop', async () => {\n    expect(\n      await browser.elementById('preceding-slash-image').getAttribute('srcset')\n    ).toBe(\n      'https://example.com/myaccount/fooslash.jpg?auto=format&fit=max&w=480 1x, https://example.com/myaccount/fooslash.jpg?auto=format&fit=max&w=1024 2x'\n    )\n  })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should use imageSizes when width matches, not deviceSizes from next.config.js","suites":[],"updatePoint":{"line":60,"column":83},"line":60,"code":"  it('should use imageSizes when width matches, not deviceSizes from next.config.js', async () => {\n    expect(await browser.elementById('icon-image-16').getAttribute('src')).toBe(\n      'https://example.com/myaccount/icon.png?auto=format&fit=max&w=32'\n    )\n    expect(\n      await browser.elementById('icon-image-16').getAttribute('srcset')\n    ).toBe(\n      'https://example.com/myaccount/icon.png?auto=format&fit=max&w=16 1x, https://example.com/myaccount/icon.png?auto=format&fit=max&w=32 2x'\n    )\n    expect(await browser.elementById('icon-image-32').getAttribute('src')).toBe(\n      'https://example.com/myaccount/icon.png?auto=format&fit=max&w=64'\n    )\n    expect(\n      await browser.elementById('icon-image-32').getAttribute('srcset')\n    ).toBe(\n      'https://example.com/myaccount/icon.png?auto=format&fit=max&w=32 1x, https://example.com/myaccount/icon.png?auto=format&fit=max&w=64 2x'\n    )\n  })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should support the unoptimized attribute","suites":[],"updatePoint":{"line":78,"column":46},"line":78,"code":"  it('should support the unoptimized attribute', async () => {\n    expect(\n      await browser.elementById('unoptimized-image').getAttribute('src')\n    ).toBe('https://arbitraryurl.com/foo.jpg')\n  })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not add a srcset if unoptimized attribute present","suites":[],"updatePoint":{"line":83,"column":62},"line":83,"code":"  it('should not add a srcset if unoptimized attribute present', async () => {\n    expect(\n      await browser.elementById('unoptimized-image').getAttribute('srcset')\n    ).toBeFalsy()\n  })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should keep auto parameter if already set","suites":[],"updatePoint":{"line":88,"column":47},"line":88,"code":"  it('should keep auto parameter if already set', async () => {\n    expect(\n      await browser.elementById('image-with-param-auto').getAttribute('src')\n    ).toBe('https://example.com/myaccount/foo.png?auto=compress&fit=max&w=1024')\n  })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should keep width parameter if already set","suites":[],"updatePoint":{"line":93,"column":48},"line":93,"code":"  it('should keep width parameter if already set', async () => {\n    expect(\n      await browser.elementById('image-with-param-width').getAttribute('src')\n    ).toBe('https://example.com/myaccount/foo.png?auto=format&w=500&fit=max')\n  })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should keep fit parameter if already set","suites":[],"updatePoint":{"line":98,"column":46},"line":98,"code":"  it('should keep fit parameter if already set', async () => {\n    expect(\n      await browser.elementById('image-with-param-fit').getAttribute('src')\n    ).toBe(\n      'https://example.com/myaccount/foo.png?auto=format&fit=crop&w=300&h=300'\n    )\n  })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have loaded the first image immediately","suites":[],"updatePoint":{"line":108,"column":52},"line":108,"code":"  it('should have loaded the first image immediately', async () => {\n    expect(await browser.elementById('lazy-top').getAttribute('src')).toBe(\n      'https://example.com/myaccount/lazy1.jpg?auto=format&fit=max&w=2000'\n    )\n    expect(await browser.elementById('lazy-top').getAttribute('srcset')).toBe(\n      'https://example.com/myaccount/lazy1.jpg?auto=format&fit=max&w=1024 1x, https://example.com/myaccount/lazy1.jpg?auto=format&fit=max&w=2000 2x'\n    )\n  })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not have loaded the second image immediately","suites":[],"updatePoint":{"line":116,"column":57},"line":116,"code":"  it('should not have loaded the second image immediately', async () => {\n    expect(await browser.elementById('lazy-mid').getAttribute('src')).toBe(\n      emptyImage\n    )\n    expect(\n      await browser.elementById('lazy-mid').getAttribute('srcset')\n    ).toBeFalsy()\n  })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should pass through classes on a lazy loaded image","suites":[],"updatePoint":{"line":124,"column":56},"line":124,"code":"  it('should pass through classes on a lazy loaded image', async () => {\n    expect(await browser.elementById('lazy-mid').getAttribute('class')).toBe(\n      'exampleclass'\n    )\n  })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should load the second image after scrolling down","suites":[],"updatePoint":{"line":129,"column":55},"line":129,"code":"  it('should load the second image after scrolling down', async () => {\n    let viewportHeight = await browser.eval(`window.innerHeight`)\n    let topOfMidImage = await browser.eval(\n      `document.getElementById('lazy-mid').parentElement.offsetTop`\n    )\n    let buffer = 150\n    await browser.eval(\n      `window.scrollTo(0, ${topOfMidImage - (viewportHeight + buffer)})`\n    )\n\n    await check(() => {\n      return browser.elementById('lazy-mid').getAttribute('src')\n    }, 'https://example.com/myaccount/lazy2.jpg?auto=format&fit=max&w=1024')\n\n    await check(() => {\n      return browser.elementById('lazy-mid').getAttribute('srcset')\n    }, 'https://example.com/myaccount/lazy2.jpg?auto=format&fit=max&w=480 1x, https://example.com/myaccount/lazy2.jpg?auto=format&fit=max&w=1024 2x')\n  })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not have loaded the third image after scrolling down","suites":[],"updatePoint":{"line":147,"column":65},"line":147,"code":"  it('should not have loaded the third image after scrolling down', async () => {\n    expect(await browser.elementById('lazy-bottom').getAttribute('src')).toBe(\n      emptyImage\n    )\n    expect(\n      await browser.elementById('lazy-bottom').getAttribute('srcset')\n    ).toBeFalsy()\n  })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should load the third image, which is unoptimized, after scrolling further down","suites":[],"updatePoint":{"line":155,"column":85},"line":155,"code":"  it('should load the third image, which is unoptimized, after scrolling further down', async () => {\n    let viewportHeight = await browser.eval(`window.innerHeight`)\n    let topOfBottomImage = await browser.eval(\n      `document.getElementById('lazy-bottom').parentElement.offsetTop`\n    )\n    let buffer = 150\n    await browser.eval(\n      `window.scrollTo(0, ${topOfBottomImage - (viewportHeight + buffer)})`\n    )\n    await waitFor(200)\n    expect(await browser.elementById('lazy-bottom').getAttribute('src')).toBe(\n      'https://www.otherhost.com/lazy3.jpg'\n    )\n    expect(\n      await browser.elementById('lazy-bottom').getAttribute('srcset')\n    ).toBeFalsy()\n  })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should load the fourth image lazily after scrolling down","suites":[],"updatePoint":{"line":172,"column":62},"line":172,"code":"  it('should load the fourth image lazily after scrolling down', async () => {\n    expect(\n      await browser.elementById('lazy-without-attribute').getAttribute('src')\n    ).toBe(emptyImage)\n    expect(\n      await browser.elementById('lazy-without-attribute').getAttribute('srcset')\n    ).toBeFalsy()\n    let viewportHeight = await browser.eval(`window.innerHeight`)\n    let topOfBottomImage = await browser.eval(\n      `document.getElementById('lazy-without-attribute').parentElement.offsetTop`\n    )\n    let buffer = 150\n    await browser.eval(\n      `window.scrollTo(0, ${topOfBottomImage - (viewportHeight + buffer)})`\n    )\n    await waitFor(200)\n    expect(\n      await browser.elementById('lazy-without-attribute').getAttribute('src')\n    ).toBe('https://example.com/myaccount/lazy4.jpg?auto=format&fit=max&w=1600')\n    expect(\n      await browser.elementById('lazy-without-attribute').getAttribute('srcset')\n    ).toBe(\n      'https://example.com/myaccount/lazy4.jpg?auto=format&fit=max&w=1024 1x, https://example.com/myaccount/lazy4.jpg?auto=format&fit=max&w=1600 2x'\n    )\n  })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should load the fifth image eagerly, without scrolling","suites":[],"updatePoint":{"line":198,"column":60},"line":198,"code":"  it('should load the fifth image eagerly, without scrolling', async () => {\n    expect(await browser.elementById('eager-loading').getAttribute('src')).toBe(\n      'https://example.com/myaccount/lazy5.jpg?auto=format&fit=max&w=2000'\n    )\n    expect(\n      await browser.elementById('eager-loading').getAttribute('srcset')\n    ).toBeTruthy()\n  })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should load the sixth image, which has lazyBoundary property after scrolling down","suites":[],"updatePoint":{"line":207,"column":87},"line":207,"code":"  it('should load the sixth image, which has lazyBoundary property after scrolling down', async () => {\n    expect(await browser.elementById('lazy-boundary').getAttribute('src')).toBe(\n      emptyImage\n    )\n    expect(\n      await browser.elementById('lazy-boundary').getAttribute('srcset')\n    ).toBeFalsy()\n    let viewportHeight = await browser.eval(`window.innerHeight`)\n    let topOfBottomImage = await browser.eval(\n      `document.getElementById('lazy-boundary').parentElement.offsetTop`\n    )\n    let buffer = 450\n    await browser.eval(\n      `window.scrollTo(0, ${topOfBottomImage - (viewportHeight + buffer)})`\n    )\n\n    await check(() => {\n      return browser.eval(\n        'document.querySelector(\"#lazy-boundary\").getAttribute(\"src\")'\n      )\n    }, 'https://example.com/myaccount/lazy6.jpg?auto=format&fit=max&w=1600')\n\n    await check(() => {\n      return browser.eval(\n        'document.querySelector(\"#lazy-boundary\").getAttribute(\"srcset\")'\n      )\n    }, 'https://example.com/myaccount/lazy6.jpg?auto=format&fit=max&w=1024 1x, https://example.com/myaccount/lazy6.jpg?auto=format&fit=max&w=1600 2x')\n  })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should add a preload tag for a priority image","suites":["Image Component Tests","SSR Image Component Tests"],"updatePoint":{"line":281,"column":53},"line":281,"code":"    it('should add a preload tag for a priority image', async () => {\n      expect(\n        await hasPreloadLinkMatchingUrl(\n          'https://example.com/myaccount/withpriority.png?auto=format&fit=max&w=1024&q=60'\n        )\n      ).toBe(true)\n    })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should add a preload tag for a priority image with preceding slash","suites":["Image Component Tests","SSR Image Component Tests"],"updatePoint":{"line":288,"column":74},"line":288,"code":"    it('should add a preload tag for a priority image with preceding slash', async () => {\n      expect(\n        await hasPreloadLinkMatchingUrl(\n          'https://example.com/myaccount/fooslash.jpg?auto=format&fit=max&w=1024'\n        )\n      ).toBe(true)\n    })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should add a preload tag for a priority image, with arbitrary host","suites":["Image Component Tests","SSR Image Component Tests"],"updatePoint":{"line":295,"column":74},"line":295,"code":"    it('should add a preload tag for a priority image, with arbitrary host', async () => {\n      expect(\n        await hasPreloadLinkMatchingUrl(\n          'https://arbitraryurl.com/withpriority3.png'\n        )\n      ).toBe(true)\n    })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should add a preload tag for a priority image, with quality","suites":["Image Component Tests","SSR Image Component Tests"],"updatePoint":{"line":302,"column":67},"line":302,"code":"    it('should add a preload tag for a priority image, with quality', async () => {\n      expect(\n        await hasPreloadLinkMatchingUrl(\n          'https://example.com/myaccount/withpriority.png?auto=format&fit=max&w=1024&q=60'\n        )\n      ).toBe(true)\n    })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not create any preload tags higher up the page than CSS preload tags","suites":["Image Component Tests","SSR Image Component Tests"],"updatePoint":{"line":309,"column":83},"line":309,"code":"    it('should not create any preload tags higher up the page than CSS preload tags', async () => {\n      expect(await hasImagePreloadBeforeCSSPreload()).toBe(false)\n    })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should add data-nimg data attribute based on layout","suites":["Image Component Tests","SSR Image Component Tests"],"updatePoint":{"line":312,"column":59},"line":312,"code":"    it('should add data-nimg data attribute based on layout', async () => {\n      expect(\n        await browser.elementById('image-with-sizes').getAttribute('data-nimg')\n      ).toBe('responsive')\n      expect(\n        await browser.elementById('basic-image').getAttribute('data-nimg')\n      ).toBe('intrinsic')\n    })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not pass config to custom loader prop","suites":["Image Component Tests","SSR Image Component Tests"],"updatePoint":{"line":320,"column":52},"line":320,"code":"    it('should not pass config to custom loader prop', async () => {\n      browser = await webdriver(appPort, '/loader-prop')\n      expect(\n        await browser.elementById('loader-prop-img').getAttribute('src')\n      ).toBe('https://example.vercel.sh/success/foo.jpg?width=1024')\n      expect(\n        await browser.elementById('loader-prop-img').getAttribute('srcset')\n      ).toBe(\n        'https://example.vercel.sh/success/foo.jpg?width=480 1x, https://example.vercel.sh/success/foo.jpg?width=1024 2x'\n      )\n    })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should NOT add a preload tag for a priority image","suites":["Image Component Tests","Client-side Image Component Tests"],"line":342,"code":"    it.skip('should NOT add a preload tag for a priority image', async () => {","file":"integration/image-component/basic/test/index.test.ts","skipped":true,"dir":"test"},{"name":"should only be loaded once if `sizes` is set","suites":["Image Component Tests","Client-side Image Component Tests"],"updatePoint":{"line":349,"column":52},"line":349,"code":"    it('should only be loaded once if `sizes` is set', async () => {\n      const numRequests = await browser.eval(`(function() {\n        const entries = window.performance.getEntries()\n        return entries.filter(function(entry) {\n          return entry.name.includes('test-sizes.jpg')\n        }).length\n      })()`)\n\n      expect(numRequests).toBe(1)\n    })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"Should not log an error when an unregistered host is used in production","suites":["Image Component Tests","Client-side Image Component Tests","Client-side Errors"],"updatePoint":{"line":373,"column":81},"line":373,"code":"      it('Should not log an error when an unregistered host is used in production', async () => {\n        const foundError = await browser.eval('window.gotHostError')\n        expect(foundError).toBe(false)\n      })","file":"integration/image-component/basic/test/index.test.ts","skipped":false,"dir":"test"},{"name":"Should use a custom resolver for image URL","suites":[],"updatePoint":{"line":13,"column":48},"line":13,"code":"  it('Should use a custom resolver for image URL', async () => {\n    expect(await browser.elementById('basic-image').getAttribute('src')).toBe(\n      'https://customresolver.com/foo.jpg?w~~1024,q~~60'\n    )\n  })","file":"integration/image-component/custom-resolver/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should add a srcset based on the custom resolver","suites":[],"updatePoint":{"line":18,"column":54},"line":18,"code":"  it('should add a srcset based on the custom resolver', async () => {\n    expect(\n      await browser.elementById('basic-image').getAttribute('srcset')\n    ).toBe(\n      'https://customresolver.com/foo.jpg?w~~480,q~~60 1x, https://customresolver.com/foo.jpg?w~~1024,q~~60 2x'\n    )\n  })","file":"integration/image-component/custom-resolver/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should support the unoptimized attribute","suites":[],"updatePoint":{"line":25,"column":46},"line":25,"code":"  it('should support the unoptimized attribute', async () => {\n    expect(\n      await browser.elementById('unoptimized-image').getAttribute('src')\n    ).toBe('https://arbitraryurl.com/foo.jpg')\n  })","file":"integration/image-component/custom-resolver/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should load the images","suites":[],"updatePoint":{"line":73,"column":28},"line":73,"code":"  it('should load the images', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById('basic-image').naturalWidth`\n        )\n\n        if (result === 0) {\n          throw new Error('Incorrectly loaded image')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n\n      expect(\n        await hasImageMatchingUrl(\n          browser,\n          `http://localhost:${appPort}/_next/image?url=%2Ftest.jpg&w=828&q=75`\n        )\n      ).toBe(true)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should preload priority images","suites":[],"updatePoint":{"line":103,"column":36},"line":103,"code":"  it('should preload priority images', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/priority')\n\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById('basic-image').naturalWidth`\n        )\n\n        if (result === 0) {\n          throw new Error('Incorrectly loaded image')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n\n      const links = await browser.elementsByCss('link[rel=preload][as=image]')\n      const entries = []\n      for (const link of links) {\n        const imagesrcset = await link.getAttribute('imagesrcset')\n        const imagesizes = await link.getAttribute('imagesizes')\n        entries.push({ imagesrcset, imagesizes })\n      }\n      expect(entries).toEqual([\n        {\n          imagesizes: '',\n          imagesrcset:\n            '/_next/image?url=%2Ftest.jpg&w=640&q=75 1x, /_next/image?url=%2Ftest.jpg&w=828&q=75 2x',\n        },\n        {\n          imagesizes: '100vw',\n          imagesrcset:\n            '/_next/image?url=%2Fwide.png&w=640&q=75 640w, /_next/image?url=%2Fwide.png&w=750&q=75 750w, /_next/image?url=%2Fwide.png&w=828&q=75 828w, /_next/image?url=%2Fwide.png&w=1080&q=75 1080w, /_next/image?url=%2Fwide.png&w=1200&q=75 1200w, /_next/image?url=%2Fwide.png&w=1920&q=75 1920w, /_next/image?url=%2Fwide.png&w=2048&q=75 2048w, /_next/image?url=%2Fwide.png&w=3840&q=75 3840w',\n        },\n      ])\n\n      // When priority={true}, we should _not_ set loading=\"lazy\"\n      expect(\n        await browser.elementById('basic-image').getAttribute('loading')\n      ).toBe(null)\n      expect(\n        await browser.elementById('load-eager').getAttribute('loading')\n      ).toBe(null)\n      expect(\n        await browser.elementById('responsive1').getAttribute('loading')\n      ).toBe(null)\n      expect(\n        await browser.elementById('responsive2').getAttribute('loading')\n      ).toBe(null)\n\n      const warnings = (await browser.log())\n        .map((log) => log.message)\n        .join('\\n')\n      expect(warnings).not.toMatch(\n        /was detected as the Largest Contentful Paint/gm\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not pass through user-provided srcset (causing a flash)","suites":[],"updatePoint":{"line":167,"column":68},"line":167,"code":"  it('should not pass through user-provided srcset (causing a flash)', async () => {\n    const html = await renderViaHTTP(appPort, '/drop-srcset')\n    const $html = cheerio.load(html)\n\n    const els = [].slice.apply($html('img'))\n    expect(els.length).toBe(2)\n\n    const [el, noscriptEl] = els\n    expect(noscriptEl.attribs.src).toBeDefined()\n    expect(noscriptEl.attribs.srcset).toBeDefined()\n\n    expect(el.attribs.src).toBeDefined()\n    expect(el.attribs.srcset).toBeUndefined()\n    expect(el.attribs.srcSet).toBeUndefined()\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should update the image on src change","suites":[],"updatePoint":{"line":183,"column":43},"line":183,"code":"  it('should update the image on src change', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/update')\n\n      await check(\n        () => browser.eval(`document.getElementById(\"update-image\").src`),\n        /test\\.jpg/\n      )\n\n      await browser.eval(`document.getElementById(\"toggle\").click()`)\n\n      await check(\n        () => browser.eval(`document.getElementById(\"update-image\").src`),\n        /test\\.png/\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should callback onLoadingComplete when image is fully loaded","suites":[],"updatePoint":{"line":206,"column":66},"line":206,"code":"  it('should callback onLoadingComplete when image is fully loaded', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/on-loading-complete')\n\n      await browser.eval(\n        `document.getElementById(\"footer\").scrollIntoView({behavior: \"smooth\"})`\n      )\n\n      await check(\n        () => browser.eval(`document.getElementById(\"img1\").currentSrc`),\n        /test(.*)jpg/\n      )\n      await check(\n        () => browser.eval(`document.getElementById(\"img2\").currentSrc`),\n        /test(.*).png/\n      )\n      await check(\n        () => browser.eval(`document.getElementById(\"img3\").currentSrc`),\n        /test\\.svg/\n      )\n      await check(\n        () => browser.eval(`document.getElementById(\"img4\").currentSrc`),\n        /test(.*)ico/\n      )\n      await check(\n        () => browser.eval(`document.getElementById(\"msg1\").textContent`),\n        'loaded 1 img1 with dimensions 128x128'\n      )\n      await check(\n        () => browser.eval(`document.getElementById(\"msg2\").textContent`),\n        'loaded 1 img2 with dimensions 400x400'\n      )\n      await check(\n        () => browser.eval(`document.getElementById(\"msg3\").textContent`),\n        'loaded 1 img3 with dimensions 266x266'\n      )\n      await check(\n        () => browser.eval(`document.getElementById(\"msg4\").textContent`),\n        'loaded 1 img4 with dimensions 21x21'\n      )\n      await check(\n        () => browser.eval(`document.getElementById(\"msg5\").textContent`),\n        'loaded 1 img5 with dimensions 3x5'\n      )\n      await check(\n        () => browser.eval(`document.getElementById(\"msg6\").textContent`),\n        'loaded 1 img6 with dimensions 3x5'\n      )\n      await check(\n        () => browser.eval(`document.getElementById(\"msg7\").textContent`),\n        'loaded 1 img7 with dimensions 400x400'\n      )\n      await check(\n        () => browser.eval(`document.getElementById(\"msg8\").textContent`),\n        'loaded 1 img8 with dimensions 640x373'\n      )\n      await check(\n        () =>\n          browser.eval(\n            `document.getElementById(\"img8\").getAttribute(\"data-nimg\")`\n          ),\n        'intrinsic'\n      )\n      await check(\n        () => browser.eval(`document.getElementById(\"img8\").currentSrc`),\n        /wide.png/\n      )\n      await browser.eval('document.getElementById(\"toggle\").click()')\n      await check(\n        () => browser.eval(`document.getElementById(\"msg8\").textContent`),\n        'loaded 2 img8 with dimensions 400x300'\n      )\n      await check(\n        () =>\n          browser.eval(\n            `document.getElementById(\"img8\").getAttribute(\"data-nimg\")`\n          ),\n        'fixed'\n      )\n      await check(\n        () => browser.eval(`document.getElementById(\"img8\").currentSrc`),\n        /test-rect.jpg/\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should callback native onLoad in most cases","suites":[],"updatePoint":{"line":297,"column":49},"line":297,"code":"  it('should callback native onLoad in most cases', async () => {\n    let browser = await webdriver(appPort, '/on-load')\n\n    await browser.eval(\n      `document.getElementById(\"footer\").scrollIntoView({behavior: \"smooth\"})`\n    )\n\n    await check(\n      () => browser.eval(`document.getElementById(\"img1\").currentSrc`),\n      /test(.*)jpg/\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"img2\").currentSrc`),\n      /test(.*).png/\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"img3\").currentSrc`),\n      /test\\.svg/\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"img4\").currentSrc`),\n      /test(.*)ico/\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg1\").textContent`),\n      'loaded 1 img1 with native onLoad'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg2\").textContent`),\n      'loaded 1 img2 with native onLoad'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg3\").textContent`),\n      'loaded 1 img3 with native onLoad'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg4\").textContent`),\n      'loaded 1 img4 with native onLoad'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg8\").textContent`),\n      'loaded 1 img8 with native onLoad'\n    )\n    await check(\n      () =>\n        browser.eval(\n          `document.getElementById(\"img8\").getAttribute(\"data-nimg\")`\n        ),\n      'intrinsic'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"img8\").currentSrc`),\n      /wide.png/\n    )\n    await browser.eval('document.getElementById(\"toggle\").click()')\n    // The normal `onLoad()` is triggered by lazy placeholder image\n    // so ideally this would be \"2\" instead of \"3\" count\n    await check(\n      () => browser.eval(`document.getElementById(\"msg8\").textContent`),\n      'loaded 3 img8 with native onLoad'\n    )\n    await check(\n      () =>\n        browser.eval(\n          `document.getElementById(\"img8\").getAttribute(\"data-nimg\")`\n        ),\n      'fixed'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"img8\").currentSrc`),\n      /test-rect.jpg/\n    )\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should callback native onError when error occured while loading image","suites":[],"updatePoint":{"line":371,"column":75},"line":371,"code":"  it('should callback native onError when error occured while loading image', async () => {\n    let browser = await webdriver(appPort, '/on-error')\n\n    await check(\n      () => browser.eval(`document.getElementById(\"img1\").currentSrc`),\n      /test\\.png/\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"img2\").currentSrc`),\n      //This is an empty data url\n      /nonexistent-img\\.png/\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg1\").textContent`),\n      'no error occured'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg2\").textContent`),\n      'error occured while loading img2'\n    )\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should work with image with blob src","suites":[],"updatePoint":{"line":393,"column":42},"line":393,"code":"  it('should work with image with blob src', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/blob')\n\n      await check(\n        () => browser.eval(`document.getElementById(\"blob-image\").src`),\n        /^blob:/\n      )\n      await check(\n        () => browser.eval(`document.getElementById(\"blob-image\").srcset`),\n        ''\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should work when using flexbox","suites":[],"updatePoint":{"line":413,"column":36},"line":413,"code":"  it('should work when using flexbox', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/flex')\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById('basic-image').width`\n        )\n        if (result === 0) {\n          throw new Error('Incorrectly loaded image')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should work with layout-fixed so resizing window does not resize image","suites":[],"updatePoint":{"line":434,"column":76},"line":434,"code":"  it('should work with layout-fixed so resizing window does not resize image', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/layout-fixed')\n      const width = 1200\n      const height = 700\n      const delta = 250\n      const id = 'fixed1'\n      expect(await getSrc(browser, id)).toBe(\n        '/_next/image?url=%2Fwide.png&w=3840&q=75'\n      )\n      expect(await browser.elementById(id).getAttribute('srcset')).toBe(\n        '/_next/image?url=%2Fwide.png&w=1200&q=75 1x, /_next/image?url=%2Fwide.png&w=3840&q=75 2x'\n      )\n      expect(await browser.elementById(id).getAttribute('sizes')).toBeFalsy()\n      await browser.setDimensions({\n        width: width + delta,\n        height: height + delta,\n      })\n      expect(await getComputed(browser, id, 'width')).toBe(width)\n      expect(await getComputed(browser, id, 'height')).toBe(height)\n      await browser.setDimensions({\n        width: width - delta,\n        height: height - delta,\n      })\n      expect(await getComputed(browser, id, 'width')).toBe(width)\n      expect(await getComputed(browser, id, 'height')).toBe(height)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should work with layout-intrinsic so resizing window maintains image aspect ratio","suites":[],"updatePoint":{"line":468,"column":87},"line":468,"code":"  it('should work with layout-intrinsic so resizing window maintains image aspect ratio', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/layout-intrinsic')\n      const width = 1200\n      const height = 700\n      const delta = 250\n      const id = 'intrinsic1'\n      expect(await getSrc(browser, id)).toBe(\n        '/_next/image?url=%2Fwide.png&w=3840&q=75'\n      )\n      expect(await browser.elementById(id).getAttribute('srcset')).toBe(\n        '/_next/image?url=%2Fwide.png&w=1200&q=75 1x, /_next/image?url=%2Fwide.png&w=3840&q=75 2x'\n      )\n      expect(await browser.elementById(id).getAttribute('sizes')).toBeFalsy()\n      await browser.setDimensions({\n        width: width + delta,\n        height: height + delta,\n      })\n      expect(await getComputed(browser, id, 'width')).toBe(width)\n      expect(await getComputed(browser, id, 'height')).toBe(height)\n      await browser.setDimensions({\n        width: width - delta,\n        height: height - delta,\n      })\n      const newWidth = await getComputed(browser, id, 'width')\n      const newHeight = await getComputed(browser, id, 'height')\n      expect(newWidth).toBeLessThan(width)\n      expect(newHeight).toBeLessThan(height)\n      expect(getRatio(newWidth, newHeight)).toBeCloseTo(\n        getRatio(width, height),\n        1\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should work with layout-responsive so resizing window maintains image aspect ratio","suites":[],"updatePoint":{"line":508,"column":88},"line":508,"code":"  it('should work with layout-responsive so resizing window maintains image aspect ratio', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/layout-responsive')\n      const width = 1200\n      const height = 700\n      const delta = 250\n      const id = 'responsive1'\n      expect(await getSrc(browser, id)).toBe(\n        '/_next/image?url=%2Fwide.png&w=3840&q=75'\n      )\n      expect(await browser.elementById(id).getAttribute('srcset')).toBe(\n        '/_next/image?url=%2Fwide.png&w=640&q=75 640w, /_next/image?url=%2Fwide.png&w=750&q=75 750w, /_next/image?url=%2Fwide.png&w=828&q=75 828w, /_next/image?url=%2Fwide.png&w=1080&q=75 1080w, /_next/image?url=%2Fwide.png&w=1200&q=75 1200w, /_next/image?url=%2Fwide.png&w=1920&q=75 1920w, /_next/image?url=%2Fwide.png&w=2048&q=75 2048w, /_next/image?url=%2Fwide.png&w=3840&q=75 3840w'\n      )\n      expect(await browser.elementById(id).getAttribute('sizes')).toBe('100vw')\n      await browser.setDimensions({\n        width: width + delta,\n        height: height + delta,\n      })\n      expect(await getComputed(browser, id, 'width')).toBeGreaterThan(width)\n      expect(await getComputed(browser, id, 'height')).toBeGreaterThan(height)\n      await browser.setDimensions({\n        width: width - delta,\n        height: height - delta,\n      })\n      const newWidth = await getComputed(browser, id, 'width')\n      const newHeight = await getComputed(browser, id, 'height')\n      expect(newWidth).toBeLessThan(width)\n      expect(newHeight).toBeLessThan(height)\n      expect(getRatio(newWidth, newHeight)).toBeCloseTo(\n        getRatio(width, height),\n        1\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should work with layout-fill to fill the parent but NOT stretch with viewport","suites":[],"updatePoint":{"line":548,"column":83},"line":548,"code":"  it('should work with layout-fill to fill the parent but NOT stretch with viewport', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/layout-fill')\n      const width = 600\n      const height = 350\n      const delta = 150\n      const id = 'fill1'\n      expect(await getSrc(browser, id)).toBe(\n        '/_next/image?url=%2Fwide.png&w=3840&q=75'\n      )\n      expect(await browser.elementById(id).getAttribute('srcset')).toBe(\n        '/_next/image?url=%2Fwide.png&w=640&q=75 640w, /_next/image?url=%2Fwide.png&w=750&q=75 750w, /_next/image?url=%2Fwide.png&w=828&q=75 828w, /_next/image?url=%2Fwide.png&w=1080&q=75 1080w, /_next/image?url=%2Fwide.png&w=1200&q=75 1200w, /_next/image?url=%2Fwide.png&w=1920&q=75 1920w, /_next/image?url=%2Fwide.png&w=2048&q=75 2048w, /_next/image?url=%2Fwide.png&w=3840&q=75 3840w'\n      )\n      expect(await browser.elementById(id).getAttribute('sizes')).toBe('100vw')\n      await browser.setDimensions({\n        width: width + delta,\n        height: height + delta,\n      })\n      expect(await getComputed(browser, id, 'width')).toBe(width)\n      expect(await getComputed(browser, id, 'height')).toBe(height)\n      await browser.setDimensions({\n        width: width - delta,\n        height: height - delta,\n      })\n      const newWidth = await getComputed(browser, id, 'width')\n      const newHeight = await getComputed(browser, id, 'height')\n      expect(newWidth).toBe(width)\n      expect(newHeight).toBe(height)\n      expect(getRatio(newWidth, newHeight)).toBeCloseTo(\n        getRatio(width, height),\n        1\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should work with layout-fill to fill the parent and stretch with viewport","suites":[],"updatePoint":{"line":588,"column":79},"line":588,"code":"  it('should work with layout-fill to fill the parent and stretch with viewport', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/layout-fill')\n      const id = 'fill2'\n      const width = await getComputed(browser, id, 'width')\n      const height = await getComputed(browser, id, 'height')\n      await browser.eval(`document.getElementById(\"${id}\").scrollIntoView()`)\n      expect(await getSrc(browser, id)).toBe(\n        '/_next/image?url=%2Fwide.png&w=3840&q=75'\n      )\n\n      await check(() => {\n        return browser.eval(\n          `document.querySelector('#${id}').getAttribute('srcset')`\n        )\n      }, '/_next/image?url=%2Fwide.png&w=640&q=75 640w, /_next/image?url=%2Fwide.png&w=750&q=75 750w, /_next/image?url=%2Fwide.png&w=828&q=75 828w, /_next/image?url=%2Fwide.png&w=1080&q=75 1080w, /_next/image?url=%2Fwide.png&w=1200&q=75 1200w, /_next/image?url=%2Fwide.png&w=1920&q=75 1920w, /_next/image?url=%2Fwide.png&w=2048&q=75 2048w, /_next/image?url=%2Fwide.png&w=3840&q=75 3840w')\n\n      expect(await browser.elementById(id).getAttribute('sizes')).toBe('100vw')\n      expect(await getComputed(browser, id, 'width')).toBe(width)\n      expect(await getComputed(browser, id, 'height')).toBe(height)\n      const delta = 150\n      const largeWidth = Number(width) + delta\n      const largeHeight = Number(height) + delta\n      await browser.setDimensions({\n        width: largeWidth,\n        height: largeHeight,\n      })\n      expect(await getComputed(browser, id, 'width')).toBe(largeWidth)\n      expect(await getComputed(browser, id, 'height')).toBe(largeHeight)\n      const smallWidth = Number(width) - delta\n      const smallHeight = Number(height) - delta\n      await browser.setDimensions({\n        width: smallWidth,\n        height: smallHeight,\n      })\n      expect(await getComputed(browser, id, 'width')).toBe(smallWidth)\n      expect(await getComputed(browser, id, 'height')).toBe(smallHeight)\n\n      const objectFit = await browser.eval(\n        `document.getElementById(\"${id}\").style.objectFit`\n      )\n      const objectPosition = await browser.eval(\n        `document.getElementById(\"${id}\").style.objectPosition`\n      )\n      expect(objectFit).toBe('cover')\n      expect(objectPosition).toBe('left center')\n      await browser.eval(`document.getElementById(\"fill3\").scrollIntoView()`)\n      await check(() => {\n        return browser.eval(\n          `document.querySelector('#fill3').getAttribute('srcset')`\n        )\n      }, '/_next/image?url=%2Fwide.png&w=256&q=75 256w, /_next/image?url=%2Fwide.png&w=384&q=75 384w, /_next/image?url=%2Fwide.png&w=640&q=75 640w, /_next/image?url=%2Fwide.png&w=750&q=75 750w, /_next/image?url=%2Fwide.png&w=828&q=75 828w, /_next/image?url=%2Fwide.png&w=1080&q=75 1080w, /_next/image?url=%2Fwide.png&w=1200&q=75 1200w, /_next/image?url=%2Fwide.png&w=1920&q=75 1920w, /_next/image?url=%2Fwide.png&w=2048&q=75 2048w, /_next/image?url=%2Fwide.png&w=3840&q=75 3840w')\n\n      await browser.eval(`document.getElementById(\"fill4\").scrollIntoView()`)\n      await check(() => {\n        return browser.eval(\n          `document.querySelector('#fill4').getAttribute('srcset')`\n        )\n      }, '/_next/image?url=%2Fwide.png&w=16&q=75 16w, /_next/image?url=%2Fwide.png&w=32&q=75 32w, /_next/image?url=%2Fwide.png&w=48&q=75 48w, /_next/image?url=%2Fwide.png&w=64&q=75 64w, /_next/image?url=%2Fwide.png&w=96&q=75 96w, /_next/image?url=%2Fwide.png&w=128&q=75 128w, /_next/image?url=%2Fwide.png&w=256&q=75 256w, /_next/image?url=%2Fwide.png&w=384&q=75 384w, /_next/image?url=%2Fwide.png&w=640&q=75 640w, /_next/image?url=%2Fwide.png&w=750&q=75 750w, /_next/image?url=%2Fwide.png&w=828&q=75 828w, /_next/image?url=%2Fwide.png&w=1080&q=75 1080w, /_next/image?url=%2Fwide.png&w=1200&q=75 1200w, /_next/image?url=%2Fwide.png&w=1920&q=75 1920w, /_next/image?url=%2Fwide.png&w=2048&q=75 2048w, /_next/image?url=%2Fwide.png&w=3840&q=75 3840w')\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should work with sizes and automatically use layout-responsive","suites":[],"updatePoint":{"line":655,"column":68},"line":655,"code":"  it('should work with sizes and automatically use layout-responsive', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/sizes')\n      const width = 1200\n      const height = 700\n      const delta = 250\n      const id = 'sizes1'\n      expect(await getSrc(browser, id)).toBe(\n        '/_next/image?url=%2Fwide.png&w=3840&q=75'\n      )\n      expect(await browser.elementById(id).getAttribute('srcset')).toBe(\n        '/_next/image?url=%2Fwide.png&w=16&q=75 16w, /_next/image?url=%2Fwide.png&w=32&q=75 32w, /_next/image?url=%2Fwide.png&w=48&q=75 48w, /_next/image?url=%2Fwide.png&w=64&q=75 64w, /_next/image?url=%2Fwide.png&w=96&q=75 96w, /_next/image?url=%2Fwide.png&w=128&q=75 128w, /_next/image?url=%2Fwide.png&w=256&q=75 256w, /_next/image?url=%2Fwide.png&w=384&q=75 384w, /_next/image?url=%2Fwide.png&w=640&q=75 640w, /_next/image?url=%2Fwide.png&w=750&q=75 750w, /_next/image?url=%2Fwide.png&w=828&q=75 828w, /_next/image?url=%2Fwide.png&w=1080&q=75 1080w, /_next/image?url=%2Fwide.png&w=1200&q=75 1200w, /_next/image?url=%2Fwide.png&w=1920&q=75 1920w, /_next/image?url=%2Fwide.png&w=2048&q=75 2048w, /_next/image?url=%2Fwide.png&w=3840&q=75 3840w'\n      )\n      expect(await browser.elementById(id).getAttribute('sizes')).toBe(\n        '(max-width: 2048px) 1200px, 3840px'\n      )\n      await browser.setDimensions({\n        width: width + delta,\n        height: height + delta,\n      })\n      expect(await getComputed(browser, id, 'width')).toBeGreaterThan(width)\n      expect(await getComputed(browser, id, 'height')).toBeGreaterThan(height)\n      await browser.setDimensions({\n        width: width - delta,\n        height: height - delta,\n      })\n      const newWidth = await getComputed(browser, id, 'width')\n      const newHeight = await getComputed(browser, id, 'height')\n      expect(newWidth).toBeLessThan(width)\n      expect(newHeight).toBeLessThan(height)\n      expect(getRatio(newWidth, newHeight)).toBeCloseTo(\n        getRatio(width, height),\n        1\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should handle the styles prop appropriately","suites":[],"updatePoint":{"line":697,"column":49},"line":697,"code":"  it('should handle the styles prop appropriately', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/style-prop')\n\n      expect(\n        await browser.elementById('with-styles').getAttribute('style')\n      ).toBe(\n        'border-radius:10px;padding:0;position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%'\n      )\n      expect(\n        await browser\n          .elementById('with-overlapping-styles-intrinsic')\n          .getAttribute('style')\n      ).toBe(\n        'width:0;border-radius:10px;margin:auto;position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;display:block;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%'\n      )\n\n      expect(\n        await browser\n          .elementById('without-styles-responsive')\n          .getAttribute('style')\n      ).toBe(\n        'position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%'\n      )\n\n      if (mode === 'dev') {\n        await waitFor(1000)\n        const warnings = (await browser.log())\n          .map((log) => log.message)\n          .join('\\n')\n        expect(warnings).toMatch(\n          /Image with src \\/test.png is assigned the following styles, which are overwritten by automatically-generated styles: padding/gm\n        )\n        expect(warnings).toMatch(\n          /Image with src \\/test.jpg is assigned the following styles, which are overwritten by automatically-generated styles: width, margin/gm\n        )\n        expect(warnings).not.toMatch(\n          /Image with src \\/test.webp is assigned the following styles/gm\n        )\n      }\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show missing src error","suites":[],"updatePoint":{"line":746,"column":37},"line":746,"code":"    it('should show missing src error', async () => {\n      const browser = await webdriver(appPort, '/missing-src')\n\n      expect(await hasRedbox(browser)).toBe(false)\n\n      await check(async () => {\n        return (await browser.log()).map((log) => log.message).join('\\n')\n      }, /Image is missing required \"src\" property/gm)\n    })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show invalid src error","suites":[],"updatePoint":{"line":756,"column":37},"line":756,"code":"    it('should show invalid src error', async () => {\n      const browser = await webdriver(appPort, '/invalid-src')\n\n      expect(await hasRedbox(browser)).toBe(true)\n      expect(await getRedboxHeader(browser)).toContain(\n        'Invalid src prop (https://google.com/test.png) on `next/image`, hostname \"google.com\" is not configured under images in your `next.config.js`'\n      )\n    })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show invalid src error when protocol-relative","suites":[],"updatePoint":{"line":765,"column":60},"line":765,"code":"    it('should show invalid src error when protocol-relative', async () => {\n      const browser = await webdriver(appPort, '/invalid-src-proto-relative')\n\n      expect(await hasRedbox(browser)).toBe(true)\n      expect(await getRedboxHeader(browser)).toContain(\n        'Failed to parse src \"//assets.example.com/img.jpg\" on `next/image`, protocol-relative URL (//) must be changed to an absolute URL (http:// or https://)'\n      )\n    })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show error when string src and placeholder=blur and blurDataURL is missing","suites":[],"updatePoint":{"line":774,"column":89},"line":774,"code":"    it('should show error when string src and placeholder=blur and blurDataURL is missing', async () => {\n      const browser = await webdriver(appPort, '/invalid-placeholder-blur')\n\n      expect(await hasRedbox(browser)).toBe(true)\n      expect(await getRedboxHeader(browser)).toContain(\n        `Image with src \"/test.png\" has \"placeholder='blur'\" property but is missing the \"blurDataURL\" property.`\n      )\n    })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show error when not numeric string width or height","suites":[],"updatePoint":{"line":783,"column":65},"line":783,"code":"    it('should show error when not numeric string width or height', async () => {\n      const browser = await webdriver(appPort, '/invalid-width-or-height')\n\n      expect(await hasRedbox(browser)).toBe(true)\n      expect(await getRedboxHeader(browser)).toContain(\n        `Image with src \"/test.jpg\" has invalid \"width\" or \"height\" property. These should be numeric values.`\n      )\n    })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show error when static import and placeholder=blur and blurDataUrl is missing","suites":[],"updatePoint":{"line":792,"column":92},"line":792,"code":"    it('should show error when static import and placeholder=blur and blurDataUrl is missing', async () => {\n      const browser = await webdriver(\n        appPort,\n        '/invalid-placeholder-blur-static'\n      )\n\n      expect(await hasRedbox(browser)).toBe(true)\n      expect(await getRedboxHeader(browser)).toMatch(\n        /Image with src \"(.*)bmp\" has \"placeholder='blur'\" property but is missing the \"blurDataURL\" property/\n      )\n    })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should warn when img with layout=responsive is inside flex container","suites":[],"updatePoint":{"line":804,"column":76},"line":804,"code":"    it('should warn when img with layout=responsive is inside flex container', async () => {\n      const browser = await webdriver(appPort, '/layout-responsive-inside-flex')\n      await browser.eval(`document.getElementById(\"img\").scrollIntoView()`)\n      await check(async () => {\n        return (await browser.log()).map((log) => log.message).join('\\n')\n      }, /Image with src (.*)jpg(.*) may not render properly as a child of a flex container. Consider wrapping the image with a div to configure the width/gm)\n      expect(await hasRedbox(browser)).toBe(false)\n    })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should warn when img with layout=fill is inside a container without position relative","suites":[],"updatePoint":{"line":813,"column":93},"line":813,"code":"    it('should warn when img with layout=fill is inside a container without position relative', async () => {\n      const browser = await webdriver(\n        appPort,\n        '/layout-fill-inside-nonrelative'\n      )\n      await browser.eval(`document.querySelector(\"footer\").scrollIntoView()`)\n      await waitFor(1000)\n      const warnings = (await browser.log())\n        .map((log) => log.message)\n        .join('\\n')\n      expect(warnings).toMatch(\n        /Image with src (.*)jpg(.*) may not render properly with a parent using position:\"static\". Consider changing the parent style to position:\"relative\"/gm\n      )\n      expect(warnings).not.toMatch(\n        /Image with src (.*)png(.*) may not render properly/gm\n      )\n      expect(warnings).not.toMatch(\n        /Image with src (.*)avif(.*) may not render properly/gm\n      )\n      expect(warnings).not.toMatch(\n        /Image with src (.*)webp(.*) may not render properly/gm\n      )\n      expect(await hasRedbox(browser)).toBe(false)\n    })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should warn when using a very small image with placeholder=blur","suites":[],"updatePoint":{"line":838,"column":71},"line":838,"code":"    it('should warn when using a very small image with placeholder=blur', async () => {\n      const browser = await webdriver(appPort, '/small-img-import')\n\n      const warnings = (await browser.log())\n        .map((log) => log.message)\n        .join('\\n')\n      expect(await hasRedbox(browser)).toBe(false)\n      expect(warnings).toMatch(\n        /Image with src (.*)jpg(.*) is smaller than 40x40. Consider removing(.*)/gm\n      )\n    })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not warn when Image is child of p","suites":[],"updatePoint":{"line":850,"column":48},"line":850,"code":"    it('should not warn when Image is child of p', async () => {\n      const browser = await webdriver(appPort, '/inside-paragraph')\n\n      const warnings = (await browser.log())\n        .map((log) => log.message)\n        .join('\\n')\n      expect(await hasRedbox(browser)).toBe(false)\n      expect(warnings).not.toMatch(\n        /Expected server HTML to contain a matching/gm\n      )\n      expect(warnings).not.toMatch(/cannot appear as a descendant/gm)\n    })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should warn when priority prop is missing on LCP image","suites":[],"updatePoint":{"line":863,"column":62},"line":863,"code":"    it('should warn when priority prop is missing on LCP image', async () => {\n      let browser\n      try {\n        browser = await webdriver(appPort, '/priority-missing-warning')\n        // Wait for image to load:\n        await check(async () => {\n          const result = await browser.eval(\n            `document.getElementById('responsive').naturalWidth`\n          )\n          if (result < 1) {\n            throw new Error('Image not ready')\n          }\n          return 'done'\n        }, 'done')\n        await waitFor(1000)\n        const warnings = (await browser.log())\n          .map((log) => log.message)\n          .join('\\n')\n        expect(await hasRedbox(browser)).toBe(false)\n        expect(warnings).toMatch(\n          /Image with src (.*)wide.png(.*) was detected as the Largest Contentful Paint/gm\n        )\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should warn when loader is missing width","suites":[],"updatePoint":{"line":892,"column":48},"line":892,"code":"    it('should warn when loader is missing width', async () => {\n      const browser = await webdriver(appPort, '/invalid-loader')\n      await browser.eval(`document.querySelector(\"footer\").scrollIntoView()`)\n      const warnings = (await browser.log())\n        .map((log) => log.message)\n        .join('\\n')\n      expect(await hasRedbox(browser)).toBe(false)\n      expect(warnings).toMatch(\n        /Image with src (.*)png(.*) has a \"loader\" property that does not implement width/gm\n      )\n      expect(warnings).not.toMatch(\n        /Image with src (.*)jpg(.*) has a \"loader\" property that does not implement width/gm\n      )\n      expect(warnings).not.toMatch(\n        /Image with src (.*)webp(.*) has a \"loader\" property that does not implement width/gm\n      )\n      expect(warnings).not.toMatch(\n        /Image with src (.*)gif(.*) has a \"loader\" property that does not implement width/gm\n      )\n      expect(warnings).not.toMatch(\n        /Image with src (.*)tiff(.*) has a \"loader\" property that does not implement width/gm\n      )\n    })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should warn when using sizes with incorrect layout","suites":[],"updatePoint":{"line":916,"column":58},"line":916,"code":"    it('should warn when using sizes with incorrect layout', async () => {\n      const browser = await webdriver(appPort, '/invalid-sizes')\n      await browser.eval(`document.querySelector(\"footer\").scrollIntoView()`)\n      const warnings = (await browser.log())\n        .map((log) => log.message)\n        .join('\\n')\n      expect(await hasRedbox(browser)).toBe(false)\n      expect(warnings).toMatch(\n        /Image with src (.*)png(.*) has \"sizes\" property but it will be ignored/gm\n      )\n      expect(warnings).toMatch(\n        /Image with src (.*)jpg(.*) has \"sizes\" property but it will be ignored/gm\n      )\n      expect(warnings).not.toMatch(\n        /Image with src (.*)webp(.*) has \"sizes\" property but it will be ignored/gm\n      )\n      expect(warnings).not.toMatch(\n        /Image with src (.*)gif(.*) has \"sizes\" property but it will be ignored/gm\n      )\n    })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not warn when svg, even if with loader prop or without","suites":[],"updatePoint":{"line":937,"column":69},"line":937,"code":"    it('should not warn when svg, even if with loader prop or without', async () => {\n      const browser = await webdriver(appPort, '/loader-svg')\n      await browser.eval(`document.querySelector(\"footer\").scrollIntoView()`)\n      const warnings = (await browser.log())\n        .map((log) => log.message)\n        .join('\\n')\n      expect(await hasRedbox(browser)).toBe(false)\n      expect(warnings).not.toMatch(\n        /Image with src (.*) has a \"loader\" property that does not implement width/gm\n      )\n      expect(await browser.elementById('with-loader').getAttribute('src')).toBe(\n        '/test.svg?size=256'\n      )\n      expect(\n        await browser.elementById('with-loader').getAttribute('srcset')\n      ).toBe('/test.svg?size=128 1x, /test.svg?size=256 2x')\n      expect(\n        await browser.elementById('without-loader').getAttribute('src')\n      ).toBe('/test.svg')\n      expect(\n        await browser.elementById('without-loader').getAttribute('srcset')\n      ).toBe('/test.svg 1x, /test.svg 2x')\n    })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should warn at most once even after state change","suites":[],"updatePoint":{"line":961,"column":56},"line":961,"code":"    it('should warn at most once even after state change', async () => {\n      const browser = await webdriver(appPort, '/warning-once')\n      await browser.eval(`document.querySelector(\"footer\").scrollIntoView()`)\n      await browser.eval(`document.querySelector(\"button\").click()`)\n      await browser.eval(`document.querySelector(\"button\").click()`)\n      const count = await browser.eval(\n        `document.querySelector(\"button\").textContent`\n      )\n      expect(count).toBe('Count: 2')\n      await check(async () => {\n        const result = await browser.eval(\n          'document.getElementById(\"w\").naturalWidth'\n        )\n        if (result < 1) {\n          throw new Error('Image not loaded')\n        }\n        return 'done'\n      }, 'done')\n      await waitFor(1000)\n      const warnings = (await browser.log())\n        .map((log) => log.message)\n        .filter((log) => log.startsWith('Image with src'))\n      expect(warnings[0]).toMatch(\n        'Image with src \"/test.png\" has \"sizes\" property but it will be ignored.'\n      )\n      expect(warnings[1]).toMatch(\n        'Image with src \"/test.png\" was detected as the Largest Contentful Paint (LCP).'\n      )\n      expect(warnings.length).toBe(2)\n    })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not create an image folder in server/chunks","suites":[],"updatePoint":{"line":993,"column":58},"line":993,"code":"    it('should not create an image folder in server/chunks', async () => {\n      expect(\n        existsSync(join(appDir, '.next/server/chunks/static/media'))\n      ).toBeFalsy()\n    })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should correctly ignore prose styles","suites":[],"updatePoint":{"line":1000,"column":42},"line":1000,"code":"  it('should correctly ignore prose styles', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/prose')\n\n      const id = 'prose-image'\n\n      // Wait for image to load:\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById(${JSON.stringify(id)}).naturalWidth`\n        )\n\n        if (result < 1) {\n          throw new Error('Image not ready')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n\n      await waitFor(1000)\n\n      const computedWidth = await getComputed(browser, id, 'width')\n      const computedHeight = await getComputed(browser, id, 'height')\n      expect(getRatio(computedWidth, computedHeight)).toBeCloseTo(1, 1)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should apply style inheritance for img elements but not wrapper elements","suites":[],"updatePoint":{"line":1032,"column":78},"line":1032,"code":"  it('should apply style inheritance for img elements but not wrapper elements', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/style-inheritance')\n\n      await browser.eval(\n        `document.querySelector(\"footer\").scrollIntoView({behavior: \"smooth\"})`\n      )\n\n      const imagesWithIds = await browser.eval(`\n        function foo() {\n          const imgs = document.querySelectorAll(\"img[id]\");\n          for (let img of imgs) {\n            const br = window.getComputedStyle(img).getPropertyValue(\"border-radius\");\n            if (!br) return 'no-border-radius';\n            if (br !== '139px') return br;\n          }\n          return true;\n        }()\n      `)\n      expect(imagesWithIds).toBe(true)\n\n      const allSpans = await browser.eval(`\n        function foo() {\n          const spans = document.querySelectorAll(\"span\");\n          for (let span of spans) {\n            const m = window.getComputedStyle(span).getPropertyValue(\"margin\");\n            if (m && m !== '0px') return m;\n          }\n          return false;\n        }()\n      `)\n      expect(allSpans).toBe(false)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should apply filter style after image loads","suites":[],"updatePoint":{"line":1072,"column":49},"line":1072,"code":"  it('should apply filter style after image loads', async () => {\n    const browser = await webdriver(appPort, '/style-filter')\n    await check(() => getSrc(browser, 'img-plain'), /^\\/_next\\/image/)\n    await check(() => getSrc(browser, 'img-blur'), /^\\/_next\\/image/)\n    await waitFor(1000)\n\n    expect(await getComputedStyle(browser, 'img-plain', 'filter')).toBe(\n      'opacity(0.5)'\n    )\n    expect(\n      await getComputedStyle(browser, 'img-plain', 'background-size')\n    ).toBe('30%')\n    expect(\n      await getComputedStyle(browser, 'img-plain', 'background-image')\n    ).toMatch('iVBORw0KGgo=')\n    expect(\n      await getComputedStyle(browser, 'img-plain', 'background-position')\n    ).toBe('1px 2px')\n\n    expect(await getComputedStyle(browser, 'img-blur', 'filter')).toBe(\n      'opacity(0.5)'\n    )\n    expect(await getComputedStyle(browser, 'img-blur', 'background-size')).toBe(\n      '30%'\n    )\n    expect(\n      await getComputedStyle(browser, 'img-blur', 'background-image')\n    ).toMatch('iVBORw0KGgo=')\n    expect(\n      await getComputedStyle(browser, 'img-blur', 'background-position')\n    ).toBe('1px 2px')\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should correctly rotate image","suites":[],"updatePoint":{"line":1107,"column":37},"line":1107,"code":"    it('should correctly rotate image', async () => {\n      let browser\n      try {\n        browser = await webdriver(appPort, '/rotated')\n\n        const id = 'exif-rotation-image'\n\n        // Wait for image to load:\n        await check(async () => {\n          const result = await browser.eval(\n            `document.getElementById(${JSON.stringify(id)}).naturalWidth`\n          )\n\n          if (result < 1) {\n            throw new Error('Image not ready')\n          }\n\n          return 'result-correct'\n        }, /result-correct/)\n\n        await waitFor(1000)\n\n        const computedWidth = await getComputed(browser, id, 'width')\n        const computedHeight = await getComputed(browser, id, 'height')\n        expect(getRatio(computedWidth, computedHeight)).toBeCloseTo(0.5625, 1)\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have blurry placeholder when enabled","suites":[],"updatePoint":{"line":1140,"column":49},"line":1140,"code":"  it('should have blurry placeholder when enabled', async () => {\n    const html = await renderViaHTTP(appPort, '/blurry-placeholder')\n    const $html = cheerio.load(html)\n\n    $html('noscript > img').attr('id', 'unused')\n\n    expect($html('#blurry-placeholder')[0].attribs.style).toContain(\n      `background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400' viewBox='0 0 400 400'%3E%3Cfilter id='blur' filterUnits='userSpaceOnUse' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='20' edgeMode='duplicate' /%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1' /%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23blur)' href='data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAMDAwMDAwQEBAQFBQUFBQcHBgYHBwsICQgJCAsRCwwLCwwLEQ8SDw4PEg8bFRMTFRsfGhkaHyYiIiYwLTA+PlT/wAALCAAKAAoBAREA/8QAMwABAQEAAAAAAAAAAAAAAAAAAAcJEAABAwUAAwAAAAAAAAAAAAAFAAYRAQMEEyEVMlH/2gAIAQEAAD8Az1bLPaxhiuk0QdeCOLDtHixN2dmd2bsc5FPX7VTREX//2Q==' x='0' y='0' height='100%25' width='100%25'/%3E%3C/svg%3E\")`\n    )\n\n    expect($html('#blurry-placeholder')[0].attribs.style).toContain(\n      `background-position:0% 0%`\n    )\n\n    expect(\n      $html('#blurry-placeholder-tall-centered')[0].attribs.style\n    ).toContain(`background-position:center`)\n\n    expect($html('#blurry-placeholder-with-lazy')[0].attribs.style).toContain(\n      `background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400' viewBox='0 0 400 400'%3E%3Cfilter id='blur' filterUnits='userSpaceOnUse' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='20' edgeMode='duplicate' /%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1' /%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23blur)' href='data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAMDAwMDAwQEBAQFBQUFBQcHBgYHBwsICQgJCAsRCwwLCwwLEQ8SDw4PEg8bFRMTFRsfGhkaHyYiIiYwLTA+PlT/wAALCAAKAAoBAREA/8QAMwABAQEAAAAAAAAAAAAAAAAAAAcJEAABAwUAAwAAAAAAAAAAAAAFAAYRAQMEEyEVMlH/2gAIAQEAAD8Az1bLPaxhiuk0QdeCOLDtHixN2dmd2bsc5FPX7VTREX//2Q==' x='0' y='0' height='100%25' width='100%25'/%3E%3C/svg%3E\")`\n    )\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not use blurry placeholder for <noscript> image","suites":[],"updatePoint":{"line":1163,"column":60},"line":1163,"code":"  it('should not use blurry placeholder for <noscript> image', async () => {\n    const html = await renderViaHTTP(appPort, '/blurry-placeholder')\n    const $html = cheerio.load(html)\n    const style = $html('noscript > img')[0].attribs.style\n\n    expect(style).not.toContain(`background-position`)\n    expect(style).not.toContain(`background-size`)\n    expect(style).not.toContain(\n      `background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400' viewBox='0 0 400 400'%3E%3Cfilter id='blur' filterUnits='userSpaceOnUse' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='20' edgeMode='duplicate' /%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1' /%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23blur)' href='data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAMDAwMDAwQEBAQFBQUFBQcHBgYHBwsICQgJCAsRCwwLCwwLEQ8SDw4PEg8bFRMTFRsfGhkaHyYiIiYwLTA+PlT/wAALCAAKAAoBAREA/8QAMwABAQEAAAAAAAAAAAAAAAAAAAcJEAABAwUAAwAAAAAAAAAAAAAFAAYRAQMEEyEVMlH/2gAIAQEAAD8Az1bLPaxhiuk0QdeCOLDtHixN2dmd2bsc5FPX7VTREX//2Q==' x='0' y='0' height='100%25' width='100%25'/%3E%3C/svg%3E\")`\n    )\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should remove blurry placeholder after image loads","suites":[],"updatePoint":{"line":1175,"column":56},"line":1175,"code":"  it('should remove blurry placeholder after image loads', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/blurry-placeholder')\n      await check(\n        async () =>\n          await getComputedStyle(\n            browser,\n            'blurry-placeholder',\n            'background-image'\n          ),\n        'none'\n      )\n\n      expect(\n        await getComputedStyle(\n          browser,\n          'blurry-placeholder-with-lazy',\n          'background-image'\n        )\n      ).toBe(\n        `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400' viewBox='0 0 400 400'%3E%3Cfilter id='blur' filterUnits='userSpaceOnUse' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='20' edgeMode='duplicate' /%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1' /%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23blur)' href='data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAMDAwMDAwQEBAQFBQUFBQcHBgYHBwsICQgJCAsRCwwLCwwLEQ8SDw4PEg8bFRMTFRsfGhkaHyYiIiYwLTA+PlT/wAALCAAKAAoBAREA/8QAMwABAQEAAAAAAAAAAAAAAAAAAAcJEAABAwUAAwAAAAAAAAAAAAAFAAYRAQMEEyEVMlH/2gAIAQEAAD8Az1bLPaxhiuk0QdeCOLDtHixN2dmd2bsc5FPX7VTREX//2Q==' x='0' y='0' height='100%25' width='100%25'/%3E%3C/svg%3E\")`\n      )\n\n      await browser.eval('document.getElementById(\"spacer\").remove()')\n\n      await check(\n        async () =>\n          await getComputedStyle(\n            browser,\n            'blurry-placeholder-with-lazy',\n            'background-image'\n          ),\n        'none'\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should re-lazyload images after src changes","suites":[],"updatePoint":{"line":1217,"column":49},"line":1217,"code":"  it('should re-lazyload images after src changes', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/lazy-src-change')\n      // image should not be loaded as it is out of viewport\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById('basic-image').naturalWidth`\n        )\n\n        if (result >= 400) {\n          throw new Error('Incorrectly loaded image')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n\n      // Move image into viewport\n      await browser.eval(\n        'document.getElementById(\"spacer\").style.display = \"none\"'\n      )\n\n      // image should be loaded by now\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById('basic-image').naturalWidth`\n        )\n\n        if (result < 400) {\n          throw new Error('Incorrectly loaded image')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n\n      await check(\n        () => browser.eval(`document.getElementById(\"basic-image\").currentSrc`),\n        /test\\.jpg/\n      )\n\n      // Make image out of viewport again\n      await browser.eval(\n        'document.getElementById(\"spacer\").style.display = \"block\"'\n      )\n      // Toggle image's src\n      await browser.eval(\n        'document.getElementById(\"button-change-image-src\").click()'\n      )\n      // \"new\" image should be lazy loaded\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById('basic-image').naturalWidth`\n        )\n\n        if (result >= 400) {\n          throw new Error('Incorrectly loaded image')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n\n      // Move image into viewport again\n      await browser.eval(\n        'document.getElementById(\"spacer\").style.display = \"none\"'\n      )\n      // \"new\" image should be loaded by now\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById('basic-image').naturalWidth`\n        )\n\n        if (result < 400) {\n          throw new Error('Incorrectly loaded image')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n\n      await check(\n        () => browser.eval(`document.getElementById(\"basic-image\").currentSrc`),\n        /test\\.png/\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should initially load only two of four images using lazyroot","suites":[],"updatePoint":{"line":1306,"column":66},"line":1306,"code":"  it('should initially load only two of four images using lazyroot', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/lazy-withref')\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById('myImage1').naturalWidth`\n        )\n\n        if (result >= 400) {\n          throw new Error('Incorrectly loaded image')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById('myImage4').naturalWidth`\n        )\n\n        if (result >= 400) {\n          throw new Error('Incorrectly loaded image')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById('myImage2').naturalWidth`\n        )\n\n        if (result < 400) {\n          throw new Error('Incorrectly loaded image')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById('myImage3').naturalWidth`\n        )\n\n        if (result < 400) {\n          throw new Error('Incorrectly loaded image')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n\n      expect(\n        await hasImageMatchingUrl(\n          browser,\n          `http://localhost:${appPort}/_next/image?url=%2Ftest.jpg&w=828&q=75`\n        )\n      ).toBe(false)\n      expect(\n        await hasImageMatchingUrl(\n          browser,\n          `http://localhost:${appPort}/_next/image?url=%2Ftest.png&w=828&q=75`\n        )\n      ).toBe(true)\n      expect(\n        await hasImageMatchingUrl(\n          browser,\n          `http://localhost:${appPort}/test.svg`\n        )\n      ).toBe(true)\n      expect(\n        await hasImageMatchingUrl(\n          browser,\n          `http://localhost:${appPort}/_next/image?url=%2Ftest.webp&w=828&q=75`\n        )\n      ).toBe(false)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should be valid HTML","suites":[],"updatePoint":{"line":1389,"column":26},"line":1389,"code":"  it('should be valid HTML', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/valid-html-w3c')\n      await waitFor(1000)\n      expect(await browser.hasElementByCssSelector('img')).toBeTruthy()\n      const url = await browser.url()\n      const result = (await validateHTML({\n        url,\n        format: 'json',\n        isLocal: true,\n        validator: 'whatwg',\n      })) as any\n      expect(result.isValid).toBe(true)\n      expect(result.errors).toEqual([])\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-component/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"Should allow an image with a static src to omit height and width","suites":[],"updatePoint":{"line":22,"column":70},"line":22,"code":"  it('Should allow an image with a static src to omit height and width', async () => {\n    expect(await browser.elementById('basic-static')).toBeTruthy()\n    expect(await browser.elementById('blur-png')).toBeTruthy()\n    expect(await browser.elementById('blur-webp')).toBeTruthy()\n    expect(await browser.elementById('blur-avif')).toBeTruthy()\n    expect(await browser.elementById('blur-jpg')).toBeTruthy()\n    expect(await browser.elementById('static-svg')).toBeTruthy()\n    expect(await browser.elementById('static-gif')).toBeTruthy()\n    expect(await browser.elementById('static-bmp')).toBeTruthy()\n    expect(await browser.elementById('static-ico')).toBeTruthy()\n    expect(await browser.elementById('static-unoptimized')).toBeTruthy()\n  })","file":"integration/image-component/default/test/static.test.ts","skipped":false,"dir":"test"},{"name":"Should use immutable cache-control header for static import","suites":[],"updatePoint":{"line":34,"column":65},"line":34,"code":"  it('Should use immutable cache-control header for static import', async () => {\n    await browser.eval(\n      `document.getElementById(\"basic-static\").scrollIntoView()`\n    )\n    await waitFor(1000)\n    const url = await browser.eval(\n      `document.getElementById(\"basic-static\").src`\n    )\n    const res = await fetch(url)\n    expect(res.headers.get('cache-control')).toBe(\n      'public, max-age=315360000, immutable'\n    )\n  })","file":"integration/image-component/default/test/static.test.ts","skipped":false,"dir":"test"},{"name":"Should use immutable cache-control header even when unoptimized","suites":[],"updatePoint":{"line":47,"column":69},"line":47,"code":"  it('Should use immutable cache-control header even when unoptimized', async () => {\n    await browser.eval(\n      `document.getElementById(\"static-unoptimized\").scrollIntoView()`\n    )\n    await waitFor(1000)\n    const url = await browser.eval(\n      `document.getElementById(\"static-unoptimized\").src`\n    )\n    const res = await fetch(url)\n    expect(res.headers.get('cache-control')).toBe(\n      'public, max-age=31536000, immutable'\n    )\n  })","file":"integration/image-component/default/test/static.test.ts","skipped":false,"dir":"test"},{"name":"Should automatically provide an image height and width","suites":[],"updatePoint":{"line":60,"column":60},"line":60,"code":"  it('Should automatically provide an image height and width', async () => {\n    expect(html).toContain('width:400px;height:300px')\n  })","file":"integration/image-component/default/test/static.test.ts","skipped":false,"dir":"test"},{"name":"Should allow provided width and height to override intrinsic","suites":[],"updatePoint":{"line":63,"column":66},"line":63,"code":"  it('Should allow provided width and height to override intrinsic', async () => {\n    expect(html).toContain('width:200px;height:200px')\n    expect(html).not.toContain('width:400px;height:400px')\n  })","file":"integration/image-component/default/test/static.test.ts","skipped":false,"dir":"test"},{"name":"Should add a blur placeholder to statically imported jpg","suites":[],"updatePoint":{"line":67,"column":62},"line":67,"code":"  it('Should add a blur placeholder to statically imported jpg', async () => {\n    expect(html).toContain(\n      `style=\"position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/sBCgoKCgoKCwwMCw8QDhAPFhQTExQWIhgaGBoYIjMgJSAgJSAzLTcsKSw3LVFAODhAUV5PSk9ecWVlcY+Ij7u7+//CABEIAAYACAMBIgACEQEDEQH/xAAnAAEBAAAAAAAAAAAAAAAAAAAABwEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAAmgP/xAAcEAACAQUBAAAAAAAAAAAAAAASFBMAAQMFERX/2gAIAQEAAT8AZ1HjrKZX55JysIc4Ff/EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Af//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Af//Z&quot;)\"`\n    )\n  })","file":"integration/image-component/default/test/static.test.ts","skipped":false,"dir":"test"},{"name":"Should add a blur placeholder to statically imported png","suites":[],"updatePoint":{"line":72,"column":62},"line":72,"code":"  it('Should add a blur placeholder to statically imported png', async () => {\n    expect(html).toContain(\n      `style=\"position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAAAAADhZOFXAAAAOklEQVR42iWGsQkAIBDE0iuIdiLOJjiGIzjiL/Meb4okiNYIlLjK3hJMzCQG1/0qmXXOUkjAV+m9wAMe3QiV6Ne8VgAAAABJRU5ErkJggg==&quot;)`\n    )\n  })","file":"integration/image-component/default/test/static.test.ts","skipped":false,"dir":"test"},{"name":"should throw build error when import statement is used with missing file","suites":["Build Error Tests"],"updatePoint":{"line":80,"column":78},"line":80,"code":"  it('should throw build error when import statement is used with missing file', async () => {\n    await indexPage.replace(\n      '../public/foo/test-rect.jpg',\n      '../public/foo/test-rect-broken.jpg'\n    )\n\n    const { stderr } = await nextBuild(appDir, undefined, { stderr: true })\n    await indexPage.restore()\n\n    expect(stderr).toContain(\n      \"Module not found: Can't resolve '../public/foo/test-rect-broken.jpg\"\n    )\n    // should contain the importing module\n    expect(stderr).toContain('./pages/static-img.js')\n    // should contain a import trace\n    expect(stderr).not.toContain('Import trace for requested module')\n  })","file":"integration/image-component/default/test/static.test.ts","skipped":false,"dir":"test"},{"name":"should apply image config for node_modules","suites":[],"updatePoint":{"line":19,"column":48},"line":19,"code":"  it('should apply image config for node_modules', async () => {\n    browser = await webdriver(appPort, '/image-from-node-modules')\n    expect(\n      await browser.elementById('image-from-node-modules').getAttribute('src')\n    ).toMatch('i.imgur.com')\n  })","file":"integration/image-component/image-from-node-modules/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should automatically load images if observer does not exist","suites":["Image Component No IntersectionObserver test","SSR Lazy Loading Tests"],"updatePoint":{"line":26,"column":67},"line":26,"code":"    it('should automatically load images if observer does not exist', async () => {\n      browser = await webdriver(appPort, '/no-observer')\n\n      // Make sure the IntersectionObserver is mocked to null during the test\n      await check(() => {\n        return browser.eval('IntersectionObserver')\n      }, /null/)\n\n      expect(\n        await browser.elementById('lazy-no-observer').getAttribute('src')\n      ).toBe(\n        'https://example.com/myaccount/foox.jpg?auto=format&fit=max&w=2000'\n      )\n      expect(\n        await browser.elementById('lazy-no-observer').getAttribute('srcset')\n      ).toBe(\n        'https://example.com/myaccount/foox.jpg?auto=format&fit=max&w=1024 1x, https://example.com/myaccount/foox.jpg?auto=format&fit=max&w=2000 2x'\n      )\n    })","file":"integration/image-component/no-intersection-observer-fallback/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should automatically load images if observer does not exist","suites":["Image Component No IntersectionObserver test","Client-side Lazy Loading Tests"],"updatePoint":{"line":48,"column":67},"line":48,"code":"    it('should automatically load images if observer does not exist', async () => {\n      browser = await webdriver(appPort, '/')\n\n      // Make sure the IntersectionObserver is mocked to null during the test\n      await check(() => {\n        return browser.eval('IntersectionObserver')\n      }, /null/)\n\n      await browser.waitForElementByCss('#link-no-observer').click()\n\n      await waitFor(1000)\n      expect(\n        await browser.elementById('lazy-no-observer').getAttribute('src')\n      ).toBe(\n        'https://example.com/myaccount/foox.jpg?auto=format&fit=max&w=2000'\n      )\n      expect(\n        await browser.elementById('lazy-no-observer').getAttribute('srcset')\n      ).toBe(\n        'https://example.com/myaccount/foox.jpg?auto=format&fit=max&w=1024 1x, https://example.com/myaccount/foox.jpg?auto=format&fit=max&w=2000 2x'\n      )\n    })","file":"integration/image-component/no-intersection-observer-fallback/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should use local API for noscript img#basic-image src attribute","suites":["Noscript Tests","Noscript page source tests"],"updatePoint":{"line":25,"column":71},"line":25,"code":"    it('should use local API for noscript img#basic-image src attribute', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n      const $ = cheerio.load(html)\n\n      expect($('noscript > img#basic-image').attr('src')).toMatch(\n        /^\\/_next\\/image/\n      )\n    })","file":"integration/image-component/noscript/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should use loader url for noscript img#image-with-loader src attribute","suites":["Noscript Tests","Noscript page source tests"],"updatePoint":{"line":33,"column":78},"line":33,"code":"    it('should use loader url for noscript img#image-with-loader src attribute', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n      const $ = cheerio.load(html)\n\n      expect($('noscript > img#image-with-loader').attr('src')).toMatch(\n        /^https:\\/\\/customresolver.com/\n      )\n    })","file":"integration/image-component/noscript/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not cancel requests for images","suites":["react-virtualized wrapping next/image","production"],"updatePoint":{"line":63,"column":45},"line":63,"code":"    it('should not cancel requests for images', async () => {\n      // TODO: this test doesnt work unless we can set `disableCache: true`\n      let browser = await webdriver(appPort, '/', {\n        disableCache: true,\n      })\n      expect(cancelCount).toBe(0)\n      await browser.eval('window.scrollTo({ top: 100, behavior: \"smooth\" })')\n      await waitFor(100)\n      expect(cancelCount).toBe(0)\n      await browser.eval('window.scrollTo({ top: 200, behavior: \"smooth\" })')\n      await waitFor(200)\n      expect(cancelCount).toBe(0)\n      await browser.eval('window.scrollTo({ top: 300, behavior: \"smooth\" })')\n      await waitFor(300)\n      expect(cancelCount).toBe(0)\n    })","file":"integration/image-component/react-virtualized/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not fail to build invalid usage of the Image component","suites":["svgo-webpack with Image Component","next build"],"updatePoint":{"line":19,"column":69},"line":19,"code":"    it('should not fail to build invalid usage of the Image component', async () => {\n      const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n      expect(stderr).toBeFalsy()\n      expect(code).toBe(0)\n    })","file":"integration/image-component/svgo-webpack/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should print error when invalid Image usage","suites":["svgo-webpack with Image Component","next dev"],"updatePoint":{"line":41,"column":51},"line":41,"code":"    it('should print error when invalid Image usage', async () => {\n      await renderViaHTTP(appPort, '/', {})\n      expect(devOutput.stderr).toBeFalsy()\n    })","file":"integration/image-component/svgo-webpack/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should include trailing slash when trailingSlash is set on config file during next dev","suites":["Image Component Trailing Slash Tests","dev mode"],"updatePoint":{"line":26,"column":94},"line":26,"code":"    it('should include trailing slash when trailingSlash is set on config file during next dev', async () => {\n      expect.assertions(1)\n      let browser\n\n      try {\n        browser = await webdriver(appPort, '/')\n        const id = 'test1'\n        const srcImage = await browser.eval(\n          `document.getElementById('${id}').src`\n        )\n        expect(srcImage).toMatch(\n          /\\/_next\\/image\\/\\?url=%2F_next%2Fstatic%2Fmedia%2Ftest(.+).jpg&w=828&q=75/\n        )\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/image-component/trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should include trailing slash when trailingSlash is set on config file during next start","suites":["Image Component Trailing Slash Tests","server mode"],"updatePoint":{"line":55,"column":96},"line":55,"code":"    it('should include trailing slash when trailingSlash is set on config file during next start', async () => {\n      expect.assertions(1)\n      let browser\n      try {\n        browser = await webdriver(appPort, '/')\n        const id = 'test1'\n        const srcImage = await browser.eval(\n          `document.getElementById('${id}').src`\n        )\n        expect(srcImage).toMatch(\n          /\\/_next\\/image\\/\\?url=%2F_next%2Fstatic%2Fmedia%2Ftest(.+).jpg&w=828&q=75/\n        )\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/image-component/trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should fail to build invalid usage of the Image component","suites":["TypeScript Image Component","next build"],"updatePoint":{"line":25,"column":65},"line":25,"code":"    it('should fail to build invalid usage of the Image component', async () => {\n      const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n      expect(stderr).toMatch(/Failed to compile/)\n      expect(stderr).toMatch(/is not assignable to type/)\n      expect(code).toBe(1)\n      const envTypes = await fs.readFile(join(appDir, 'next-env.d.ts'), 'utf8')\n      expect(envTypes).toContain('image-types/global')\n    })","file":"integration/image-component/typescript/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should remove global image types when disabled","suites":["TypeScript Image Component","next build"],"updatePoint":{"line":34,"column":54},"line":34,"code":"    it('should remove global image types when disabled', async () => {\n      const content = await fs.readFile(nextConfig, 'utf8')\n      await fs.writeFile(\n        nextConfig,\n        content.replace('// disableStaticImages', 'disableStaticImages')\n      )\n      const { code, stderr } = await nextBuild(appDir, [], { stderr: true })\n      expect(stderr).toMatch(/Failed to compile/)\n      expect(stderr).toMatch(/is not assignable to type/)\n      expect(code).toBe(1)\n      await fs.writeFile(nextConfig, content)\n      const envTypes = await fs.readFile(join(appDir, 'next-env.d.ts'), 'utf8')\n      expect(envTypes).not.toContain('image-types/global')\n    })","file":"integration/image-component/typescript/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have image types when enabled","suites":["TypeScript Image Component","next dev"],"updatePoint":{"line":61,"column":44},"line":61,"code":"    it('should have image types when enabled', async () => {\n      const envTypes = await fs.readFile(join(appDir, 'next-env.d.ts'), 'utf8')\n      expect(envTypes).toContain('image-types/global')\n    })","file":"integration/image-component/typescript/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should render the valid Image usage and not print error","suites":["TypeScript Image Component","next dev"],"updatePoint":{"line":66,"column":63},"line":66,"code":"    it('should render the valid Image usage and not print error', async () => {\n      const html = await renderViaHTTP(appPort, '/valid', {})\n      expect(html).toMatch(/This is valid usage of the Image component/)\n      expect(output).not.toMatch(/Error: Image/)\n    })","file":"integration/image-component/typescript/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should print error when invalid Image usage","suites":["TypeScript Image Component","next dev"],"updatePoint":{"line":72,"column":51},"line":72,"code":"    it('should print error when invalid Image usage', async () => {\n      await renderViaHTTP(appPort, '/invalid', {})\n      expect(output).toMatch(/Error: Image/)\n    })","file":"integration/image-component/typescript/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should remove global image types when disabled (dev)","suites":["TypeScript Image Component","next dev"],"updatePoint":{"line":78,"column":58},"line":78,"code":"  it('should remove global image types when disabled (dev)', async () => {\n    const content = await fs.readFile(nextConfig, 'utf8')\n    await fs.writeFile(\n      nextConfig,\n      content.replace('// disableStaticImages', 'disableStaticImages')\n    )\n    const app = await launchApp(appDir, await findPort(), [])\n    await killApp(app)\n    await fs.writeFile(nextConfig, content)\n    const envTypes = await fs.readFile(join(appDir, 'next-env.d.ts'), 'utf8')\n    expect(envTypes).not.toContain('image-types/global')\n  })","file":"integration/image-component/typescript/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should load static unicode image","suites":[],"updatePoint":{"line":21,"column":38},"line":21,"code":"  it('should load static unicode image', async () => {\n    const src = await browser.elementById('static').getAttribute('src')\n    expect(src).toMatch(\n      /_next%2Fstatic%2Fmedia%2F%C3%A4%C3%B6%C3%BC%C5%A1%C4%8D%C5%99%C3%AD(.+)png/\n    )\n    const fullSrc = new URL(src, `http://localhost:${appPort}`)\n    const res = await fetch(fullSrc)\n    expect(res.status).toBe(200)\n  })","file":"integration/image-component/unicode/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should load internal unicode image","suites":[],"updatePoint":{"line":31,"column":40},"line":31,"code":"  it('should load internal unicode image', async () => {\n    const src = await browser.elementById('internal').getAttribute('src')\n    expect(src).toMatch(\n      '/_next/image?url=%2F%C3%A4%C3%B6%C3%BC%C5%A1%C4%8D%C5%99%C3%AD.png'\n    )\n    const fullSrc = new URL(src, `http://localhost:${appPort}`)\n    const res = await fetch(fullSrc)\n    expect(res.status).toBe(200)\n  })","file":"integration/image-component/unicode/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should load external unicode image","suites":[],"updatePoint":{"line":41,"column":40},"line":41,"code":"  it('should load external unicode image', async () => {\n    const src = await browser.elementById('external').getAttribute('src')\n    expect(src).toMatch(\n      '/_next/image?url=https%3A%2F%2Fimage-optimization-test.vercel.app%2F%C3%A4%C3%B6%C3%BC%C5%A1%C4%8D%C5%99%C3%AD.png'\n    )\n    const fullSrc = new URL(src, `http://localhost:${appPort}`)\n    const res = await fetch(fullSrc)\n    expect(res.status).toBe(200)\n  })","file":"integration/image-component/unicode/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should load internal image with space","suites":[],"updatePoint":{"line":51,"column":43},"line":51,"code":"  it('should load internal image with space', async () => {\n    const src = await browser.elementById('internal-space').getAttribute('src')\n    expect(src).toMatch('/_next/image?url=%2Fhello%2520world.jpg')\n    const fullSrc = new URL(src, `http://localhost:${appPort}`)\n    const res = await fetch(fullSrc)\n    expect(res.status).toBe(200)\n  })","file":"integration/image-component/unicode/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should load external image with space","suites":[],"updatePoint":{"line":59,"column":43},"line":59,"code":"  it('should load external image with space', async () => {\n    const src = await browser.elementById('external-space').getAttribute('src')\n    expect(src).toMatch(\n      '/_next/image?url=https%3A%2F%2Fimage-optimization-test.vercel.app%2Fhello%2520world.jpg'\n    )\n    const fullSrc = new URL(src, `http://localhost:${appPort}`)\n    const res = await fetch(fullSrc)\n    expect(res.status).toBe(200)\n  })","file":"integration/image-component/unicode/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not optimize any image","suites":[],"updatePoint":{"line":19,"column":35},"line":19,"code":"  it('should not optimize any image', async () => {\n    const browser = await webdriver(appPort, '/')\n\n    expect(\n      await browser.elementById('internal-image').getAttribute('src')\n    ).toMatch('data:')\n    expect(\n      await browser.elementById('static-image').getAttribute('src')\n    ).toMatch('data:')\n    expect(\n      await browser.elementById('external-image').getAttribute('src')\n    ).toMatch('data:')\n    expect(await browser.elementById('eager-image').getAttribute('src')).toBe(\n      '/test.webp'\n    )\n\n    expect(\n      await browser.elementById('internal-image').getAttribute('srcset')\n    ).toBeNull()\n    expect(\n      await browser.elementById('static-image').getAttribute('srcset')\n    ).toBeNull()\n    expect(\n      await browser.elementById('external-image').getAttribute('srcset')\n    ).toBeNull()\n    expect(\n      await browser.elementById('eager-image').getAttribute('srcset')\n    ).toBeNull()\n\n    await check(async () => {\n      await browser.eval(\n        `window.scrollTo(0, 0); document.getElementById(\"external-image\").scrollIntoView()`\n      )\n      return browser.eval(\n        `document.getElementById(\"external-image\").currentSrc`\n      )\n    }, 'https://image-optimization-test.vercel.app/test.jpg')\n\n    await check(async () => {\n      await browser.eval(\n        `window.scrollTo(0, 0); document.getElementById(\"internal-image\").scrollIntoView()`\n      )\n      return browser.elementById('internal-image').getAttribute('src')\n    }, '/test.png')\n\n    await check(async () => {\n      await browser.eval(\n        `window.scrollTo(0, 0); document.getElementById(\"static-image\").scrollIntoView()`\n      )\n      return browser.elementById('static-image').getAttribute('src')\n    }, /test(.*)jpg/)\n\n    await check(async () => {\n      await browser.eval(\n        `window.scrollTo(0, 0); document.getElementById(\"external-image\").scrollIntoView()`\n      )\n      return browser.elementById('external-image').getAttribute('src')\n    }, 'https://image-optimization-test.vercel.app/test.jpg')\n\n    await check(async () => {\n      await browser.eval(\n        `window.scrollTo(0, 0); document.getElementById(\"eager-image\").scrollIntoView()`\n      )\n      return browser.elementById('eager-image').getAttribute('src')\n    }, '/test.webp')\n\n    expect(\n      await browser.elementById('internal-image').getAttribute('srcset')\n    ).toBeNull()\n    expect(\n      await browser.elementById('static-image').getAttribute('srcset')\n    ).toBeNull()\n    expect(\n      await browser.elementById('external-image').getAttribute('srcset')\n    ).toBeNull()\n    expect(\n      await browser.elementById('eager-image').getAttribute('srcset')\n    ).toBeNull()\n  })","file":"integration/image-component/unoptimized/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should include assetPrefix when placeholder=blur during next dev","suites":["Image Component assetPrefix Tests","dev mode"],"updatePoint":{"line":26,"column":72},"line":26,"code":"    it('should include assetPrefix when placeholder=blur during next dev', async () => {\n      const browser = await webdriver(appPort, '/')\n      const id = 'test1'\n      const bgImage = await browser.eval(\n        `document.getElementById('${id}').style['background-image']`\n      )\n      expect(bgImage).toMatch(\n        /\\/_next\\/image\\?url=https%3A%2F%2Fexample\\.vercel\\.sh%2Fpre%2F_next%2Fstatic%2Fmedia%2Ftest(.+).jpg&w=8&q=70/\n      )\n    })","file":"integration/image-future/asset-prefix/test/index.test.js","skipped":false,"dir":"test"},{"name":"should use base64 data url with placeholder=blur during next start","suites":["Image Component assetPrefix Tests","server mode"],"updatePoint":{"line":46,"column":74},"line":46,"code":"    it('should use base64 data url with placeholder=blur during next start', async () => {\n      let browser = await webdriver(appPort, '/')\n      const id = 'test1'\n      const bgImage = await browser.eval(\n        `document.getElementById('${id}').style['background-image']`\n      )\n      expect(bgImage).toMatch('data:image/jpeg;base64')\n    })","file":"integration/image-future/asset-prefix/test/index.test.js","skipped":false,"dir":"test"},{"name":"should load the images","suites":[],"updatePoint":{"line":55,"column":28},"line":55,"code":"  it('should load the images', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/docs')\n\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById('basic-image').naturalWidth`\n        )\n\n        if (result === 0) {\n          throw new Error('Incorrectly loaded image')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n\n      expect(\n        await hasImageMatchingUrl(\n          browser,\n          `http://localhost:${appPort}/docs/_next/image?url=%2Fdocs%2Ftest.jpg&w=828&q=75`\n        )\n      ).toBe(true)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-future/base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should update the image on src change","suites":[],"updatePoint":{"line":85,"column":43},"line":85,"code":"  it('should update the image on src change', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/docs/update')\n\n      await check(\n        () => browser.eval(`document.getElementById(\"update-image\").src`),\n        /test\\.jpg/\n      )\n\n      await browser.eval(`document.getElementById(\"toggle\").click()`)\n\n      await check(\n        () => browser.eval(`document.getElementById(\"update-image\").src`),\n        /test\\.png/\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-future/base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work when using flexbox","suites":[],"updatePoint":{"line":108,"column":36},"line":108,"code":"  it('should work when using flexbox', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/docs/flex')\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById('basic-image').width`\n        )\n        if (result === 0) {\n          throw new Error('Incorrectly loaded image')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-future/base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show missing src error","suites":[],"updatePoint":{"line":130,"column":37},"line":130,"code":"    it('should show missing src error', async () => {\n      const browser = await webdriver(appPort, '/docs/missing-src')\n\n      expect(await hasRedbox(browser)).toBe(false)\n\n      await check(async () => {\n        return (await browser.log('browser'))\n          .map((log) => log.message)\n          .join('\\n')\n      }, /Image is missing required \"src\" property/gm)\n    })","file":"integration/image-future/base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show invalid src error","suites":[],"updatePoint":{"line":142,"column":37},"line":142,"code":"    it('should show invalid src error', async () => {\n      const browser = await webdriver(appPort, '/docs/invalid-src')\n\n      expect(await hasRedbox(browser)).toBe(true)\n      expect(await getRedboxHeader(browser)).toContain(\n        'Invalid src prop (https://google.com/test.png) on `next/image`, hostname \"google.com\" is not configured under images in your `next.config.js`'\n      )\n    })","file":"integration/image-future/base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show invalid src error when protocol-relative","suites":[],"updatePoint":{"line":151,"column":60},"line":151,"code":"    it('should show invalid src error when protocol-relative', async () => {\n      const browser = await webdriver(\n        appPort,\n        '/docs/invalid-src-proto-relative'\n      )\n\n      expect(await hasRedbox(browser)).toBe(true)\n      expect(await getRedboxHeader(browser)).toContain(\n        'Failed to parse src \"//assets.example.com/img.jpg\" on `next/image`, protocol-relative URL (//) must be changed to an absolute URL (http:// or https://)'\n      )\n    })","file":"integration/image-future/base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should correctly ignore prose styles","suites":[],"updatePoint":{"line":164,"column":42},"line":164,"code":"  it('should correctly ignore prose styles', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/docs/prose')\n\n      const id = 'prose-image'\n\n      // Wait for image to load:\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById(${JSON.stringify(id)}).naturalWidth`\n        )\n\n        if (result < 1) {\n          throw new Error('Image not ready')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n\n      await waitFor(1000)\n\n      const computedWidth = await getComputed(browser, id, 'width')\n      const computedHeight = await getComputed(browser, id, 'height')\n      expect(getRatio(computedWidth, computedHeight)).toBeCloseTo(1, 1)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-future/base-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"Should allow an image with a static src to omit height and width","suites":[],"updatePoint":{"line":25,"column":70},"line":25,"code":"  it('Should allow an image with a static src to omit height and width', async () => {\n    expect(await browser.elementById('basic-static')).toBeTruthy()\n    expect(await browser.elementById('blur-png')).toBeTruthy()\n    expect(await browser.elementById('blur-webp')).toBeTruthy()\n    expect(await browser.elementById('blur-avif')).toBeTruthy()\n    expect(await browser.elementById('blur-jpg')).toBeTruthy()\n    expect(await browser.elementById('static-svg')).toBeTruthy()\n    expect(await browser.elementById('static-gif')).toBeTruthy()\n    expect(await browser.elementById('static-bmp')).toBeTruthy()\n    expect(await browser.elementById('static-ico')).toBeTruthy()\n    expect(await browser.elementById('static-unoptimized')).toBeTruthy()\n  })","file":"integration/image-future/base-path/test/static.test.js","skipped":false,"dir":"test"},{"name":"Should use immutable cache-control header for static import","suites":[],"updatePoint":{"line":39,"column":67},"line":39,"code":"    it('Should use immutable cache-control header for static import', async () => {\n      await browser.eval(\n        `document.getElementById(\"basic-static\").scrollIntoView()`\n      )\n      await waitFor(1000)\n      const url = await browser.eval(\n        `document.getElementById(\"basic-static\").src`\n      )\n      const res = await fetch(url)\n      expect(res.headers.get('cache-control')).toBe(\n        'public, max-age=315360000, immutable'\n      )\n    })","file":"integration/image-future/base-path/test/static.test.js","skipped":false,"dir":"test"},{"name":"Should use immutable cache-control header even when unoptimized","suites":[],"updatePoint":{"line":53,"column":71},"line":53,"code":"    it('Should use immutable cache-control header even when unoptimized', async () => {\n      await browser.eval(\n        `document.getElementById(\"static-unoptimized\").scrollIntoView()`\n      )\n      await waitFor(1000)\n      const url = await browser.eval(\n        `document.getElementById(\"static-unoptimized\").src`\n      )\n      const res = await fetch(url)\n      expect(res.headers.get('cache-control')).toBe(\n        'public, max-age=31536000, immutable'\n      )\n    })","file":"integration/image-future/base-path/test/static.test.js","skipped":false,"dir":"test"},{"name":"Should automatically provide an image height and width","suites":[],"updatePoint":{"line":67,"column":60},"line":67,"code":"  it('Should automatically provide an image height and width', async () => {\n    const img = $('#basic-non-static')\n    expect(img.attr('width')).toBe('400')\n    expect(img.attr('height')).toBe('300')\n  })","file":"integration/image-future/base-path/test/static.test.js","skipped":false,"dir":"test"},{"name":"should use width and height prop to override import","suites":[],"updatePoint":{"line":72,"column":57},"line":72,"code":"  it('should use width and height prop to override import', async () => {\n    const img = $('#defined-width-and-height')\n    expect(img.attr('width')).toBe('150')\n    expect(img.attr('height')).toBe('150')\n  })","file":"integration/image-future/base-path/test/static.test.js","skipped":false,"dir":"test"},{"name":"should use height prop to adjust both width and height","suites":[],"updatePoint":{"line":77,"column":60},"line":77,"code":"  it('should use height prop to adjust both width and height', async () => {\n    const img = $('#defined-height-only')\n    expect(img.attr('width')).toBe('600')\n    expect(img.attr('height')).toBe('350')\n  })","file":"integration/image-future/base-path/test/static.test.js","skipped":false,"dir":"test"},{"name":"should use width prop to adjust both width and height","suites":[],"updatePoint":{"line":82,"column":59},"line":82,"code":"  it('should use width prop to adjust both width and height', async () => {\n    const img = $('#defined-width-only')\n    expect(img.attr('width')).toBe('400')\n    expect(img.attr('height')).toBe('233')\n  })","file":"integration/image-future/base-path/test/static.test.js","skipped":false,"dir":"test"},{"name":"Should add a blur placeholder a statically imported jpg","suites":[],"updatePoint":{"line":88,"column":61},"line":88,"code":"  it('Should add a blur placeholder a statically imported jpg', async () => {\n    const style = $('#basic-static').attr('style')\n    if (isDev) {\n      expect(style).toBe(\n        `color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(\"/docs/_next/image?url=%2Fdocs%2F_next%2Fstatic%2Fmedia%2Ftest-rect.f323a148.jpg&w=8&q=70\")`\n      )\n    } else {\n      expect(style).toBe(\n        `color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' viewBox='0 0 8 6'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='1'/%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'/%3E%3C/feComponentTransfer%3E%%3C/filter%3E%3Cimage filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' href='data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/sBCgoKCgoKCwwMCw8QDhAPFhQTExQWIhgaGBoYIjMgJSAgJSAzLTcsKSw3LVFAODhAUV5PSk9ecWVlcY+Ij7u7+//CABEIAAYACAMBIgACEQEDEQH/xAAnAAEBAAAAAAAAAAAAAAAAAAAABwEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAAmgP/xAAcEAACAQUBAAAAAAAAAAAAAAASFBMAAQMFERX/2gAIAQEAAT8AZ1HjrKZX55JysIc4Ff/EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Af//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Af//Z'/%3E%3C/svg%3E\")`\n      )\n    }\n  })","file":"integration/image-future/base-path/test/static.test.js","skipped":false,"dir":"test"},{"name":"Should add a blur placeholder a statically imported png","suites":[],"updatePoint":{"line":101,"column":61},"line":101,"code":"  it('Should add a blur placeholder a statically imported png', async () => {\n    const style = $('#blur-png').attr('style')\n    if (isDev) {\n      expect(style).toBe(\n        `color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(\"/docs/_next/image?url=%2Fdocs%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=8&q=70\")`\n      )\n    } else {\n      expect(style).toBe(\n        `color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' viewBox='0 0 8 8'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='1'/%3E%3C/filter%3E%3Cimage filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAAAAADhZOFXAAAAOklEQVR42iWGsQkAIBDE0iuIdiLOJjiGIzjiL/Meb4okiNYIlLjK3hJMzCQG1/0qmXXOUkjAV+m9wAMe3QiV6Ne8VgAAAABJRU5ErkJggg=='/%3E%3C/svg%3E\")`\n      )\n    }\n  })","file":"integration/image-future/base-path/test/static.test.js","skipped":false,"dir":"test"},{"name":"should throw build error when import statement is used with missing file","suites":["Build Error Tests"],"updatePoint":{"line":116,"column":78},"line":116,"code":"  it('should throw build error when import statement is used with missing file', async () => {\n    await indexPage.replace(\n      '../public/foo/test-rect.jpg',\n      '../public/foo/test-rect-broken.jpg'\n    )\n\n    const { stderr } = await nextBuild(appDir, undefined, { stderr: true })\n    await indexPage.restore()\n\n    expect(stderr).toContain(\n      \"Module not found: Can't resolve '../public/foo/test-rect-broken.jpg\"\n    )\n    // should contain the importing module\n    expect(stderr).toContain('./pages/static-img.js')\n    // should contain a import trace\n    expect(stderr).not.toContain('Import trace for requested module')\n  })","file":"integration/image-future/base-path/test/static.test.js","skipped":false,"dir":"test"},{"name":"should load the images","suites":[],"updatePoint":{"line":73,"column":28},"line":73,"code":"  it('should load the images', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById('basic-image').naturalWidth`\n        )\n\n        if (result === 0) {\n          throw new Error('Incorrectly loaded image')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n\n      expect(\n        await hasImageMatchingUrl(\n          browser,\n          `http://localhost:${appPort}/_next/image?url=%2Ftest.jpg&w=828&q=75`\n        )\n      ).toBe(true)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should preload priority images","suites":[],"updatePoint":{"line":103,"column":36},"line":103,"code":"  it('should preload priority images', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/priority')\n\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById('basic-image').naturalWidth`\n        )\n\n        if (result === 0) {\n          throw new Error('Incorrectly loaded image')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n\n      const links = await browser.elementsByCss('link[rel=preload][as=image]')\n      const entries = []\n      for (const link of links) {\n        const imagesrcset = await link.getAttribute('imagesrcset')\n        const imagesizes = await link.getAttribute('imagesizes')\n        entries.push({ imagesrcset, imagesizes })\n      }\n      expect(entries).toEqual([\n        {\n          imagesizes: '',\n          imagesrcset:\n            '/_next/image?url=%2Ftest.jpg&w=640&q=75 1x, /_next/image?url=%2Ftest.jpg&w=828&q=75 2x',\n        },\n        {\n          imagesizes: '100vw',\n          imagesrcset:\n            '/_next/image?url=%2Fwide.png&w=640&q=75 640w, /_next/image?url=%2Fwide.png&w=750&q=75 750w, /_next/image?url=%2Fwide.png&w=828&q=75 828w, /_next/image?url=%2Fwide.png&w=1080&q=75 1080w, /_next/image?url=%2Fwide.png&w=1200&q=75 1200w, /_next/image?url=%2Fwide.png&w=1920&q=75 1920w, /_next/image?url=%2Fwide.png&w=2048&q=75 2048w, /_next/image?url=%2Fwide.png&w=3840&q=75 3840w',\n        },\n      ])\n\n      // When priority={true}, we should _not_ set loading=\"lazy\"\n      expect(\n        await browser.elementById('basic-image').getAttribute('loading')\n      ).toBe(null)\n      expect(\n        await browser.elementById('load-eager').getAttribute('loading')\n      ).toBe('eager')\n      expect(\n        await browser.elementById('responsive1').getAttribute('loading')\n      ).toBe(null)\n      expect(\n        await browser.elementById('responsive2').getAttribute('loading')\n      ).toBe(null)\n\n      const warnings = (await browser.log('browser'))\n        .map((log) => log.message)\n        .join('\\n')\n      expect(warnings).not.toMatch(\n        /was detected as the Largest Contentful Paint/gm\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not pass through user-provided srcset (causing a flash)","suites":[],"updatePoint":{"line":167,"column":68},"line":167,"code":"  it('should not pass through user-provided srcset (causing a flash)', async () => {\n    const html = await renderViaHTTP(appPort, '/drop-srcset')\n    const $html = cheerio.load(html)\n\n    const els = [].slice.apply($html('img'))\n    expect(els.length).toBe(1)\n\n    const [el] = els\n\n    expect(el.attribs.src).not.toBe('/truck.jpg')\n    expect(el.attribs.srcset).not.toBe(\n      '/truck375.jpg 375w, /truck640.jpg 640w, /truck.jpg'\n    )\n    expect(el.attribs.srcSet).not.toBe(\n      '/truck375.jpg 375w, /truck640.jpg 640w, /truck.jpg'\n    )\n  })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should update the image on src change","suites":[],"updatePoint":{"line":185,"column":43},"line":185,"code":"  it('should update the image on src change', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/update')\n\n      await check(\n        () => browser.eval(`document.getElementById(\"update-image\").src`),\n        /test\\.jpg/\n      )\n\n      await browser.eval(`document.getElementById(\"toggle\").click()`)\n\n      await check(\n        () => browser.eval(`document.getElementById(\"update-image\").src`),\n        /test\\.png/\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should callback onLoadingComplete when image is fully loaded","suites":[],"updatePoint":{"line":208,"column":66},"line":208,"code":"  it('should callback onLoadingComplete when image is fully loaded', async () => {\n    let browser = await webdriver(appPort, '/on-loading-complete')\n\n    await browser.eval(\n      `document.getElementById(\"footer\").scrollIntoView({behavior: \"smooth\"})`\n    )\n\n    await check(\n      () => browser.eval(`document.getElementById(\"img1\").currentSrc`),\n      /test(.*)jpg/\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"img2\").currentSrc`),\n      /test(.*).png/\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"img3\").currentSrc`),\n      /test\\.svg/\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"img4\").currentSrc`),\n      /test(.*)ico/\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg1\").textContent`),\n      'loaded 1 img1 with dimensions 128x128'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg2\").textContent`),\n      'loaded 1 img2 with dimensions 400x400'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg3\").textContent`),\n      'loaded 1 img3 with dimensions 400x400'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg4\").textContent`),\n      'loaded 1 img4 with dimensions 32x32'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg5\").textContent`),\n      'loaded 1 img5 with dimensions 3x5'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg6\").textContent`),\n      'loaded 1 img6 with dimensions 3x5'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg7\").textContent`),\n      'loaded 1 img7 with dimensions 400x400'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg8\").textContent`),\n      'loaded 1 img8 with dimensions 640x373'\n    )\n    await check(\n      () =>\n        browser.eval(\n          `document.getElementById(\"img8\").getAttribute(\"data-nimg\")`\n        ),\n      'future'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"img8\").currentSrc`),\n      /wide.png/\n    )\n    await browser.eval('document.getElementById(\"toggle\").click()')\n    await check(\n      () => browser.eval(`document.getElementById(\"msg8\").textContent`),\n      'loaded 2 img8 with dimensions 400x300'\n    )\n    await check(\n      () =>\n        browser.eval(\n          `document.getElementById(\"img8\").getAttribute(\"data-nimg\")`\n        ),\n      'future'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"img8\").currentSrc`),\n      /test-rect.jpg/\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg9\").textContent`),\n      'loaded 1 img9 with dimensions 400x400'\n    )\n  })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should callback native onLoad in most cases","suites":[],"updatePoint":{"line":296,"column":49},"line":296,"code":"  it('should callback native onLoad in most cases', async () => {\n    let browser = await webdriver(appPort, '/on-load')\n\n    await browser.eval('document.getElementById(\"toggle\").click()')\n\n    await browser.eval(\n      `document.getElementById(\"footer\").scrollIntoView({behavior: \"smooth\"})`\n    )\n\n    await check(\n      () => browser.eval(`document.getElementById(\"msg1\").textContent`),\n      'loaded img1 with native onLoad'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg2\").textContent`),\n      'loaded img2 with native onLoad'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg3\").textContent`),\n      'loaded img3 with native onLoad'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg4\").textContent`),\n      'loaded img4 with native onLoad'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg5\").textContent`),\n      'loaded img5 with native onLoad'\n    )\n    await check(\n      () =>\n        browser.eval(\n          `document.getElementById(\"img5\").getAttribute(\"data-nimg\")`\n        ),\n      'future'\n    )\n\n    await check(\n      () => browser.eval(`document.getElementById(\"img1\").currentSrc`),\n      /test(.*)jpg/\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"img2\").currentSrc`),\n      /test(.*).png/\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"img3\").currentSrc`),\n      /test\\.svg/\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"img4\").currentSrc`),\n      /test(.*)ico/\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"img5\").currentSrc`),\n      /wide.png/\n    )\n  })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should callback native onError when error occured while loading image","suites":[],"updatePoint":{"line":355,"column":75},"line":355,"code":"  it('should callback native onError when error occured while loading image', async () => {\n    let browser = await webdriver(appPort, '/on-error')\n    await browser.eval(\n      `document.getElementById(\"img1\").scrollIntoView({behavior: \"smooth\"})`\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg1\").textContent`),\n      'no error occured for img1'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"img1\").style.color`),\n      'transparent'\n    )\n    await browser.eval(\n      `document.getElementById(\"img2\").scrollIntoView({behavior: \"smooth\"})`\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"msg2\").textContent`),\n      'no error occured for img2'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"img2\").style.color`),\n      'transparent'\n    )\n    await browser.eval(`document.getElementById(\"toggle\").click()`)\n    await check(\n      () => browser.eval(`document.getElementById(\"msg2\").textContent`),\n      'error occured while loading img2'\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"img2\").style.color`),\n      ''\n    )\n  })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should callback native onError even when error before hydration","suites":[],"updatePoint":{"line":390,"column":69},"line":390,"code":"  it('should callback native onError even when error before hydration', async () => {\n    let browser = await webdriver(appPort, '/on-error-before-hydration')\n    await check(\n      () => browser.eval(`document.getElementById(\"msg\").textContent`),\n      'error state'\n    )\n  })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should work with image with blob src","suites":[],"updatePoint":{"line":398,"column":42},"line":398,"code":"  it('should work with image with blob src', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/blob')\n\n      await check(\n        () => browser.eval(`document.getElementById(\"blob-image\").src`),\n        /^blob:/\n      )\n      await check(\n        () => browser.eval(`document.getElementById(\"blob-image\").srcset`),\n        ''\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should work when using flexbox","suites":[],"updatePoint":{"line":418,"column":36},"line":418,"code":"  it('should work when using flexbox', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/flex')\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById('basic-image').width`\n        )\n        if (result === 0) {\n          throw new Error('Incorrectly loaded image')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should work with sizes and automatically use responsive srcset","suites":[],"updatePoint":{"line":439,"column":68},"line":439,"code":"  it('should work with sizes and automatically use responsive srcset', async () => {\n    const browser = await webdriver(appPort, '/sizes')\n    const id = 'sizes1'\n    expect(await getSrc(browser, id)).toBe(\n      '/_next/image?url=%2Fwide.png&w=3840&q=75'\n    )\n    expect(await browser.elementById(id).getAttribute('srcset')).toBe(\n      '/_next/image?url=%2Fwide.png&w=16&q=75 16w, /_next/image?url=%2Fwide.png&w=32&q=75 32w, /_next/image?url=%2Fwide.png&w=48&q=75 48w, /_next/image?url=%2Fwide.png&w=64&q=75 64w, /_next/image?url=%2Fwide.png&w=96&q=75 96w, /_next/image?url=%2Fwide.png&w=128&q=75 128w, /_next/image?url=%2Fwide.png&w=256&q=75 256w, /_next/image?url=%2Fwide.png&w=384&q=75 384w, /_next/image?url=%2Fwide.png&w=640&q=75 640w, /_next/image?url=%2Fwide.png&w=750&q=75 750w, /_next/image?url=%2Fwide.png&w=828&q=75 828w, /_next/image?url=%2Fwide.png&w=1080&q=75 1080w, /_next/image?url=%2Fwide.png&w=1200&q=75 1200w, /_next/image?url=%2Fwide.png&w=1920&q=75 1920w, /_next/image?url=%2Fwide.png&w=2048&q=75 2048w, /_next/image?url=%2Fwide.png&w=3840&q=75 3840w'\n    )\n    expect(await browser.elementById(id).getAttribute('sizes')).toBe(\n      '(max-width: 2048px) 1200px, 3840px'\n    )\n  })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should render no wrappers or sizers","suites":[],"updatePoint":{"line":453,"column":41},"line":453,"code":"  it('should render no wrappers or sizers', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/wrapper-div')\n\n      const numberOfChildren = await browser.eval(\n        `document.getElementById('image-container1').children.length`\n      )\n      expect(numberOfChildren).toBe(1)\n      const childElementType = await browser.eval(\n        `document.getElementById('image-container1').children[0].nodeName`\n      )\n      expect(childElementType).toBe('IMG')\n\n      expect(await browser.elementById('img1').getAttribute('style')).toBe(\n        'color:transparent'\n      )\n      expect(await browser.elementById('img1').getAttribute('height')).toBe(\n        '700'\n      )\n      expect(await browser.elementById('img1').getAttribute('width')).toBe(\n        '1200'\n      )\n      expect(await browser.elementById('img1').getAttribute('srcset')).toBe(\n        `/_next/image?url=%2Fwide.png&w=1200&q=75 1x, /_next/image?url=%2Fwide.png&w=3840&q=75 2x`\n      )\n      expect(await browser.elementById('img1').getAttribute('loading')).toBe(\n        'eager'\n      )\n\n      expect(await browser.elementById('img2').getAttribute('style')).toBe(\n        'color:transparent;padding-left:4rem;width:100%;object-position:30% 30%'\n      )\n      expect(await browser.elementById('img2').getAttribute('height')).toBe(\n        '700'\n      )\n      expect(await browser.elementById('img2').getAttribute('width')).toBe(\n        '1200'\n      )\n      expect(await browser.elementById('img2').getAttribute('srcset')).toBe(\n        `/_next/image?url=%2Fwide.png&w=16&q=75 16w, /_next/image?url=%2Fwide.png&w=32&q=75 32w, /_next/image?url=%2Fwide.png&w=48&q=75 48w, /_next/image?url=%2Fwide.png&w=64&q=75 64w, /_next/image?url=%2Fwide.png&w=96&q=75 96w, /_next/image?url=%2Fwide.png&w=128&q=75 128w, /_next/image?url=%2Fwide.png&w=256&q=75 256w, /_next/image?url=%2Fwide.png&w=384&q=75 384w, /_next/image?url=%2Fwide.png&w=640&q=75 640w, /_next/image?url=%2Fwide.png&w=750&q=75 750w, /_next/image?url=%2Fwide.png&w=828&q=75 828w, /_next/image?url=%2Fwide.png&w=1080&q=75 1080w, /_next/image?url=%2Fwide.png&w=1200&q=75 1200w, /_next/image?url=%2Fwide.png&w=1920&q=75 1920w, /_next/image?url=%2Fwide.png&w=2048&q=75 2048w, /_next/image?url=%2Fwide.png&w=3840&q=75 3840w`\n      )\n      expect(await browser.elementById('img2').getAttribute('loading')).toBe(\n        'lazy'\n      )\n\n      expect(await browser.elementById('img3').getAttribute('style')).toBe(\n        'color:transparent'\n      )\n      expect(await browser.elementById('img3').getAttribute('srcset')).toBe(\n        `/_next/image?url=%2Ftest.png&w=640&q=75 1x, /_next/image?url=%2Ftest.png&w=828&q=75 2x`\n      )\n      if (mode === 'dev') {\n        await waitFor(1000)\n        const warnings = (await browser.log('browser'))\n          .map((log) => log.message)\n          .join('\\n')\n        expect(warnings).toMatch(\n          /Image with src \"\\/wide.png\" has either width or height modified, but not the other./gm\n        )\n        expect(warnings).not.toMatch(\n          /Image with src \"\\/test.png\" has either width or height modified, but not the other./gm\n        )\n      }\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should lazy load with placeholder=blur","suites":[],"updatePoint":{"line":524,"column":44},"line":524,"code":"  it('should lazy load with placeholder=blur', async () => {\n    const browser = await webdriver(appPort, '/placeholder-blur')\n\n    // blur1\n    expect(await browser.elementById('blur1').getAttribute('src')).toBe(\n      '/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.fab2915d.jpg&w=828&q=75'\n    )\n    expect(await browser.elementById('blur1').getAttribute('srcset')).toBe(\n      '/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.fab2915d.jpg&w=640&q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.fab2915d.jpg&w=828&q=75 2x'\n    )\n    expect(await browser.elementById('blur1').getAttribute('loading')).toBe(\n      'lazy'\n    )\n    expect(await browser.elementById('blur1').getAttribute('sizes')).toBeNull()\n    expect(await browser.elementById('blur1').getAttribute('style')).toMatch(\n      'color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;'\n    )\n    expect(await browser.elementById('blur1').getAttribute('height')).toBe(\n      '400'\n    )\n    expect(await browser.elementById('blur1').getAttribute('width')).toBe('400')\n    await browser.eval(\n      `document.getElementById(\"blur1\").scrollIntoView({behavior: \"smooth\"})`\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"blur1\").currentSrc`),\n      /test(.*)jpg/\n    )\n    expect(await browser.elementById('blur1').getAttribute('src')).toBe(\n      '/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.fab2915d.jpg&w=828&q=75'\n    )\n    expect(await browser.elementById('blur1').getAttribute('srcset')).toBe(\n      '/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.fab2915d.jpg&w=640&q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.fab2915d.jpg&w=828&q=75 2x'\n    )\n    expect(await browser.elementById('blur1').getAttribute('loading')).toBe(\n      'lazy'\n    )\n    expect(await browser.elementById('blur1').getAttribute('sizes')).toBeNull()\n    expect(await browser.elementById('blur1').getAttribute('style')).toBe(\n      'color: transparent;'\n    )\n    expect(await browser.elementById('blur1').getAttribute('height')).toBe(\n      '400'\n    )\n    expect(await browser.elementById('blur1').getAttribute('width')).toBe('400')\n\n    // blur2\n    expect(await browser.elementById('blur2').getAttribute('src')).toBe(\n      '/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=3840&q=75'\n    )\n    expect(await browser.elementById('blur2').getAttribute('srcset')).toBe(\n      '/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=384&q=75 384w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=640&q=75 640w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=750&q=75 750w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=828&q=75 828w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=1080&q=75 1080w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=1200&q=75 1200w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=1920&q=75 1920w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=2048&q=75 2048w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=3840&q=75 3840w'\n    )\n    expect(await browser.elementById('blur2').getAttribute('sizes')).toBe(\n      '50vw'\n    )\n    expect(await browser.elementById('blur2').getAttribute('loading')).toBe(\n      'lazy'\n    )\n    expect(await browser.elementById('blur2').getAttribute('style')).toMatch(\n      'color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat'\n    )\n    expect(await browser.elementById('blur2').getAttribute('height')).toBe(\n      '400'\n    )\n    expect(await browser.elementById('blur2').getAttribute('width')).toBe('400')\n    await browser.eval(\n      `document.getElementById(\"blur2\").scrollIntoView({behavior: \"smooth\"})`\n    )\n    await check(\n      () => browser.eval(`document.getElementById(\"blur2\").currentSrc`),\n      /test(.*)png/\n    )\n    expect(await browser.elementById('blur2').getAttribute('src')).toBe(\n      '/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=3840&q=75'\n    )\n    expect(await browser.elementById('blur2').getAttribute('srcset')).toBe(\n      '/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=384&q=75 384w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=640&q=75 640w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=750&q=75 750w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=828&q=75 828w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=1080&q=75 1080w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=1200&q=75 1200w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=1920&q=75 1920w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=2048&q=75 2048w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=3840&q=75 3840w'\n    )\n    expect(await browser.elementById('blur2').getAttribute('sizes')).toBe(\n      '50vw'\n    )\n    expect(await browser.elementById('blur2').getAttribute('loading')).toBe(\n      'lazy'\n    )\n    expect(await browser.elementById('blur2').getAttribute('style')).toBe(\n      'color: transparent;'\n    )\n    expect(await browser.elementById('blur2').getAttribute('height')).toBe(\n      '400'\n    )\n    expect(await browser.elementById('blur2').getAttribute('width')).toBe('400')\n  })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should handle the styles prop appropriately","suites":[],"updatePoint":{"line":618,"column":49},"line":618,"code":"  it('should handle the styles prop appropriately', async () => {\n    const browser = await webdriver(appPort, '/style-prop')\n\n    expect(await browser.elementById('with-styles').getAttribute('style')).toBe(\n      'color:transparent;border-radius:10px;padding:10px'\n    )\n    expect(\n      await browser.elementById('with-overlapping-styles').getAttribute('style')\n    ).toBe('color:transparent;width:10px;border-radius:10px;margin:15px')\n    expect(\n      await browser.elementById('without-styles').getAttribute('style')\n    ).toBe('color:transparent')\n  })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show missing src error","suites":[],"updatePoint":{"line":633,"column":37},"line":633,"code":"    it('should show missing src error', async () => {\n      const browser = await webdriver(appPort, '/missing-src')\n\n      expect(await hasRedbox(browser)).toBe(false)\n\n      await check(async () => {\n        return (await browser.log()).map((log) => log.message).join('\\n')\n      }, /Image is missing required \"src\" property/gm)\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show invalid src error","suites":[],"updatePoint":{"line":643,"column":37},"line":643,"code":"    it('should show invalid src error', async () => {\n      const browser = await webdriver(appPort, '/invalid-src')\n\n      expect(await hasRedbox(browser)).toBe(true)\n      expect(await getRedboxHeader(browser)).toContain(\n        'Invalid src prop (https://google.com/test.png) on `next/image`, hostname \"google.com\" is not configured under images in your `next.config.js`'\n      )\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show invalid src error when protocol-relative","suites":[],"updatePoint":{"line":652,"column":60},"line":652,"code":"    it('should show invalid src error when protocol-relative', async () => {\n      const browser = await webdriver(appPort, '/invalid-src-proto-relative')\n\n      expect(await hasRedbox(browser)).toBe(true)\n      expect(await getRedboxHeader(browser)).toContain(\n        'Failed to parse src \"//assets.example.com/img.jpg\" on `next/image`, protocol-relative URL (//) must be changed to an absolute URL (http:// or https://)'\n      )\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show error when string src and placeholder=blur and blurDataURL is missing","suites":[],"updatePoint":{"line":661,"column":89},"line":661,"code":"    it('should show error when string src and placeholder=blur and blurDataURL is missing', async () => {\n      const browser = await webdriver(appPort, '/invalid-placeholder-blur')\n\n      expect(await hasRedbox(browser)).toBe(true)\n      expect(await getRedboxHeader(browser)).toContain(\n        `Image with src \"/test.png\" has \"placeholder='blur'\" property but is missing the \"blurDataURL\" property.`\n      )\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show error when invalid width prop","suites":[],"updatePoint":{"line":670,"column":49},"line":670,"code":"    it('should show error when invalid width prop', async () => {\n      const browser = await webdriver(appPort, '/invalid-width')\n\n      expect(await hasRedbox(browser)).toBe(true)\n      expect(await getRedboxHeader(browser)).toContain(\n        `Image with src \"/test.jpg\" has invalid \"width\" property. Expected a numeric value in pixels but received \"100%\".`\n      )\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show error when invalid height prop","suites":[],"updatePoint":{"line":679,"column":50},"line":679,"code":"    it('should show error when invalid height prop', async () => {\n      const browser = await webdriver(appPort, '/invalid-height')\n\n      expect(await hasRedbox(browser)).toBe(true)\n      expect(await getRedboxHeader(browser)).toContain(\n        `Image with src \"/test.jpg\" has invalid \"height\" property. Expected a numeric value in pixels but received \"50vh\".`\n      )\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show missing alt error","suites":[],"updatePoint":{"line":688,"column":37},"line":688,"code":"    it('should show missing alt error', async () => {\n      const browser = await webdriver(appPort, '/missing-alt')\n\n      expect(await hasRedbox(browser)).toBe(false)\n\n      await check(async () => {\n        return (await browser.log()).map((log) => log.message).join('\\n')\n      }, /Image is missing required \"alt\" property/gm)\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show error when missing width prop","suites":[],"updatePoint":{"line":698,"column":49},"line":698,"code":"    it('should show error when missing width prop', async () => {\n      const browser = await webdriver(appPort, '/missing-width')\n\n      expect(await hasRedbox(browser)).toBe(true)\n      expect(await getRedboxHeader(browser)).toContain(\n        `Image with src \"/test.jpg\" is missing required \"width\" property.`\n      )\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show error when missing height prop","suites":[],"updatePoint":{"line":707,"column":50},"line":707,"code":"    it('should show error when missing height prop', async () => {\n      const browser = await webdriver(appPort, '/missing-height')\n\n      expect(await hasRedbox(browser)).toBe(true)\n      expect(await getRedboxHeader(browser)).toContain(\n        `Image with src \"/test.jpg\" is missing required \"height\" property.`\n      )\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show error when width prop on fill image","suites":[],"updatePoint":{"line":716,"column":55},"line":716,"code":"    it('should show error when width prop on fill image', async () => {\n      const browser = await webdriver(appPort, '/invalid-fill-width')\n\n      expect(await hasRedbox(browser)).toBe(true)\n      expect(await getRedboxHeader(browser)).toContain(\n        `Image with src \"/wide.png\" has both \"width\" and \"fill\" properties.`\n      )\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show error when CSS position changed on fill image","suites":[],"updatePoint":{"line":725,"column":65},"line":725,"code":"    it('should show error when CSS position changed on fill image', async () => {\n      const browser = await webdriver(appPort, '/invalid-fill-position')\n\n      expect(await hasRedbox(browser)).toBe(true)\n      expect(await getRedboxHeader(browser)).toContain(\n        `Image with src \"/wide.png\" has both \"fill\" and \"style.position\" properties. Images with \"fill\" always use position absolute - it cannot be modified.`\n      )\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show error when static import and placeholder=blur and blurDataUrl is missing","suites":[],"updatePoint":{"line":734,"column":92},"line":734,"code":"    it('should show error when static import and placeholder=blur and blurDataUrl is missing', async () => {\n      const browser = await webdriver(\n        appPort,\n        '/invalid-placeholder-blur-static'\n      )\n\n      expect(await hasRedbox(browser)).toBe(true)\n      expect(await getRedboxHeader(browser)).toMatch(\n        /Image with src \"(.*)bmp\" has \"placeholder='blur'\" property but is missing the \"blurDataURL\" property/\n      )\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should warn when using a very small image with placeholder=blur","suites":[],"updatePoint":{"line":746,"column":71},"line":746,"code":"    it('should warn when using a very small image with placeholder=blur', async () => {\n      const browser = await webdriver(appPort, '/small-img-import')\n\n      const warnings = (await browser.log())\n        .map((log) => log.message)\n        .join('\\n')\n      expect(await hasRedbox(browser)).toBe(false)\n      expect(warnings).toMatch(\n        /Image with src (.*)jpg(.*) is smaller than 40x40. Consider removing(.*)/gm\n      )\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not warn when Image is child of p","suites":[],"updatePoint":{"line":758,"column":48},"line":758,"code":"    it('should not warn when Image is child of p', async () => {\n      const browser = await webdriver(appPort, '/inside-paragraph')\n\n      const warnings = (await browser.log())\n        .map((log) => log.message)\n        .join('\\n')\n      expect(await hasRedbox(browser)).toBe(false)\n      expect(warnings).not.toMatch(\n        /Expected server HTML to contain a matching/gm\n      )\n      expect(warnings).not.toMatch(/cannot appear as a descendant/gm)\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should warn when priority prop is missing on LCP image","suites":[],"updatePoint":{"line":771,"column":62},"line":771,"code":"    it('should warn when priority prop is missing on LCP image', async () => {\n      let browser\n      try {\n        browser = await webdriver(appPort, '/priority-missing-warning')\n        // Wait for image to load:\n        await check(async () => {\n          const result = await browser.eval(\n            `document.getElementById('responsive').naturalWidth`\n          )\n          if (result < 1) {\n            throw new Error('Image not ready')\n          }\n          return 'done'\n        }, 'done')\n        await waitFor(1000)\n        const warnings = (await browser.log('browser'))\n          .map((log) => log.message)\n          .join('\\n')\n        expect(await hasRedbox(browser)).toBe(false)\n        expect(warnings).toMatch(\n          /Image with src (.*)wide.png(.*) was detected as the Largest Contentful Paint/gm\n        )\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should warn when loader is missing width","suites":[],"updatePoint":{"line":800,"column":48},"line":800,"code":"    it('should warn when loader is missing width', async () => {\n      const browser = await webdriver(appPort, '/invalid-loader')\n      await browser.eval(`document.querySelector(\"footer\").scrollIntoView()`)\n      const warnings = (await browser.log())\n        .map((log) => log.message)\n        .join('\\n')\n      expect(await hasRedbox(browser)).toBe(false)\n      expect(warnings).toMatch(\n        /Image with src (.*)png(.*) has a \"loader\" property that does not implement width/gm\n      )\n      expect(warnings).not.toMatch(\n        /Image with src (.*)jpg(.*) has a \"loader\" property that does not implement width/gm\n      )\n      expect(warnings).not.toMatch(\n        /Image with src (.*)webp(.*) has a \"loader\" property that does not implement width/gm\n      )\n      expect(warnings).not.toMatch(\n        /Image with src (.*)gif(.*) has a \"loader\" property that does not implement width/gm\n      )\n      expect(warnings).not.toMatch(\n        /Image with src (.*)tiff(.*) has a \"loader\" property that does not implement width/gm\n      )\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not warn when svg, even if with loader prop or without","suites":[],"updatePoint":{"line":824,"column":69},"line":824,"code":"    it('should not warn when svg, even if with loader prop or without', async () => {\n      const browser = await webdriver(appPort, '/loader-svg')\n      await browser.eval(`document.querySelector(\"footer\").scrollIntoView()`)\n      const warnings = (await browser.log())\n        .map((log) => log.message)\n        .join('\\n')\n      expect(await hasRedbox(browser)).toBe(false)\n      expect(warnings).not.toMatch(\n        /Image with src (.*) has a \"loader\" property that does not implement width/gm\n      )\n      expect(await browser.elementById('with-loader').getAttribute('src')).toBe(\n        '/test.svg?size=256'\n      )\n      expect(\n        await browser.elementById('with-loader').getAttribute('srcset')\n      ).toBe('/test.svg?size=128 1x, /test.svg?size=256 2x')\n      expect(\n        await browser.elementById('without-loader').getAttribute('src')\n      ).toBe('/test.svg')\n      expect(\n        await browser.elementById('without-loader').getAttribute('srcset')\n      ).toBe('/test.svg 1x, /test.svg 2x')\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should warn at most once even after state change","suites":[],"updatePoint":{"line":848,"column":56},"line":848,"code":"    it('should warn at most once even after state change', async () => {\n      const browser = await webdriver(appPort, '/warning-once')\n      await browser.eval(`document.querySelector(\"footer\").scrollIntoView()`)\n      await browser.eval(`document.querySelector(\"button\").click()`)\n      await browser.eval(`document.querySelector(\"button\").click()`)\n      const count = await browser.eval(\n        `document.querySelector(\"button\").textContent`\n      )\n      expect(count).toBe('Count: 2')\n      await check(async () => {\n        const result = await browser.eval(\n          'document.getElementById(\"w\").naturalWidth'\n        )\n        if (result < 1) {\n          throw new Error('Image not loaded')\n        }\n        return 'done'\n      }, 'done')\n      await waitFor(1000)\n      const warnings = (await browser.log())\n        .map((log) => log.message)\n        .filter((log) => log.startsWith('Image with src'))\n      expect(warnings[0]).toMatch(\n        'Image with src \"/test.png\" was detected as the Largest Contentful Paint (LCP).'\n      )\n      expect(warnings.length).toBe(1)\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should show console error for objectFit and objectPosition","suites":[],"updatePoint":{"line":876,"column":66},"line":876,"code":"    it('should show console error for objectFit and objectPosition', async () => {\n      const browser = await webdriver(appPort, '/invalid-objectfit')\n\n      expect(await hasRedbox(browser)).toBe(false)\n\n      await check(async () => {\n        return (await browser.log()).map((log) => log.message).join('\\n')\n      }, /Image has unknown prop \"objectFit\"/gm)\n\n      await check(async () => {\n        return (await browser.log()).map((log) => log.message).join('\\n')\n      }, /Image has unknown prop \"objectPosition\"/gm)\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not create an image folder in server/chunks","suites":[],"updatePoint":{"line":891,"column":58},"line":891,"code":"    it('should not create an image folder in server/chunks', async () => {\n      expect(\n        existsSync(join(appDir, '.next/server/chunks/static/media'))\n      ).toBeFalsy()\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should correctly ignore prose styles","suites":[],"updatePoint":{"line":898,"column":42},"line":898,"code":"  it('should correctly ignore prose styles', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/prose')\n\n      const id = 'prose-image'\n\n      // Wait for image to load:\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById(${JSON.stringify(id)}).naturalWidth`\n        )\n\n        if (result < 1) {\n          throw new Error('Image not ready')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n\n      await waitFor(1000)\n\n      const computedWidth = await getComputed(browser, id, 'width')\n      const computedHeight = await getComputed(browser, id, 'height')\n      expect(getRatio(computedWidth, computedHeight)).toBeCloseTo(1, 1)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should apply style inheritance for img elements but not wrapper elements","suites":[],"updatePoint":{"line":930,"column":78},"line":930,"code":"  it('should apply style inheritance for img elements but not wrapper elements', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/style-inheritance')\n\n      await browser.eval(\n        `document.querySelector(\"footer\").scrollIntoView({behavior: \"smooth\"})`\n      )\n\n      const imagesWithIds = await browser.eval(`\n        function foo() {\n          const imgs = document.querySelectorAll(\"img[id]\");\n          for (let img of imgs) {\n            const br = window.getComputedStyle(img).getPropertyValue(\"border-radius\");\n            if (!br) return 'no-border-radius';\n            if (br !== '139px') return br;\n          }\n          return true;\n        }()\n      `)\n      expect(imagesWithIds).toBe(true)\n\n      const allSpans = await browser.eval(`\n        function foo() {\n          const spans = document.querySelectorAll(\"span\");\n          for (let span of spans) {\n            const m = window.getComputedStyle(span).getPropertyValue(\"margin\");\n            if (m && m !== '0px') return m;\n          }\n          return false;\n        }()\n      `)\n      expect(allSpans).toBe(false)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should apply filter style after image loads","suites":[],"updatePoint":{"line":970,"column":49},"line":970,"code":"  it('should apply filter style after image loads', async () => {\n    const browser = await webdriver(appPort, '/style-filter')\n    await check(() => getSrc(browser, 'img-plain'), /^\\/_next\\/image/)\n    await check(() => getSrc(browser, 'img-blur'), /^\\/_next\\/image/)\n    await waitFor(1000)\n\n    expect(await getComputedStyle(browser, 'img-plain', 'filter')).toBe(\n      'opacity(0.5)'\n    )\n    expect(\n      await getComputedStyle(browser, 'img-plain', 'background-size')\n    ).toBe('30%')\n    expect(\n      await getComputedStyle(browser, 'img-plain', 'background-image')\n    ).toMatch('iVBORw0KGgo=')\n    expect(\n      await getComputedStyle(browser, 'img-plain', 'background-position')\n    ).toBe('1px 2px')\n\n    expect(await getComputedStyle(browser, 'img-blur', 'filter')).toBe(\n      'opacity(0.5)'\n    )\n    expect(await getComputedStyle(browser, 'img-blur', 'background-size')).toBe(\n      '30%'\n    )\n    expect(\n      await getComputedStyle(browser, 'img-blur', 'background-image')\n    ).toMatch('iVBORw0KGgo=')\n    expect(\n      await getComputedStyle(browser, 'img-blur', 'background-position')\n    ).toBe('1px 2px')\n  })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should include a data-attribute on fill images","suites":["Fill-mode tests"],"updatePoint":{"line":1007,"column":54},"line":1007,"code":"    it('should include a data-attribute on fill images', async () => {\n      expect(\n        await browser.elementById('fill-image-1').getAttribute('data-nimg')\n      ).toBe('future-fill')\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should add position:absolute to fill images","suites":["Fill-mode tests"],"updatePoint":{"line":1012,"column":51},"line":1012,"code":"    it('should add position:absolute to fill images', async () => {\n      expect(await getComputedStyle(browser, 'fill-image-1', 'position')).toBe(\n        'absolute'\n      )\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should add 100% width and height to fill images","suites":["Fill-mode tests"],"updatePoint":{"line":1017,"column":55},"line":1017,"code":"    it('should add 100% width and height to fill images', async () => {\n      expect(\n        await browser.eval(\n          `document.getElementById(\"fill-image-1\").style.height`\n        )\n      ).toBe('100%')\n      expect(\n        await browser.eval(\n          `document.getElementById(\"fill-image-1\").style.width`\n        )\n      ).toBe('100%')\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should add position styles to fill images","suites":["Fill-mode tests"],"updatePoint":{"line":1029,"column":49},"line":1029,"code":"    it('should add position styles to fill images', async () => {\n      expect(\n        await browser.eval(\n          `document.getElementById(\"fill-image-1\").getAttribute('style')`\n        )\n      ).toBe(\n        'position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent'\n      )\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not log incorrect warnings","suites":["Fill-mode tests"],"updatePoint":{"line":1039,"column":43},"line":1039,"code":"      it('should not log incorrect warnings', async () => {\n        await waitFor(1000)\n        const warnings = (await browser.log('browser'))\n          .map((log) => log.message)\n          .join('\\n')\n        expect(warnings).not.toMatch(/Image with src (.*) has \"fill\"/gm)\n        expect(warnings).not.toMatch(\n          /Image with src (.*) is smaller than 40x40. Consider removing(.*)/gm\n        )\n      })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should log warnings when using fill mode incorrectly","suites":["Fill-mode tests"],"updatePoint":{"line":1049,"column":62},"line":1049,"code":"      it('should log warnings when using fill mode incorrectly', async () => {\n        browser = await webdriver(appPort, '/fill-warnings')\n        await waitFor(1000)\n        const warnings = (await browser.log('browser'))\n          .map((log) => log.message)\n          .join('\\n')\n        expect(warnings).toContain(\n          'Image with src \"/wide.png\" has \"fill\" and parent element with invalid \"position\". Provided \"static\" should be one of absolute,fixed,relative.'\n        )\n        expect(warnings).toContain(\n          'Image with src \"/wide.png\" has \"fill\" and a height value of 0. This is likely because the parent element of the image has not been styled to have a set height.'\n        )\n        expect(warnings).toContain(\n          'Image with src \"/wide.png\" has \"fill\" but is missing \"sizes\" prop. Please add it to improve page performance. Read more:'\n        )\n      })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should correctly rotate image","suites":["Fill-mode tests"],"updatePoint":{"line":1069,"column":37},"line":1069,"code":"    it('should correctly rotate image', async () => {\n      const browser = await webdriver(appPort, '/rotated')\n\n      const id = 'exif-rotation-image'\n\n      // Wait for image to load:\n      await check(async () => {\n        const result = await browser.eval(\n          `document.getElementById(${JSON.stringify(id)}).naturalWidth`\n        )\n\n        if (result === 0) {\n          throw new Error('Image not ready')\n        }\n\n        return 'result-correct'\n      }, /result-correct/)\n\n      await waitFor(500)\n\n      const computedWidth = await getComputed(browser, id, 'width')\n      const computedHeight = await getComputed(browser, id, 'height')\n      expect(getRatio(computedHeight, computedWidth)).toBeCloseTo(0.75, 1)\n    })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have blurry placeholder when enabled","suites":["Fill-mode tests"],"updatePoint":{"line":1095,"column":49},"line":1095,"code":"  it('should have blurry placeholder when enabled', async () => {\n    const html = await renderViaHTTP(appPort, '/blurry-placeholder')\n    const $html = cheerio.load(html)\n\n    $html('noscript > img').attr('id', 'unused')\n\n    expect($html('#blurry-placeholder-raw')[0].attribs.style).toContain(\n      `color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' viewBox='0 0 400 400'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3C/filter%3E%3Cimage filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8P4nhDwAGuAKPn6cicwAAAABJRU5ErkJggg=='/%3E%3C/svg%3E\")`\n    )\n\n    expect($html('#blurry-placeholder-with-lazy')[0].attribs.style).toContain(\n      `color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' viewBox='0 0 400 400'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3C/filter%3E%3Cimage filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mO0/8/wBwAE/wI85bEJ6gAAAABJRU5ErkJggg=='/%3E%3C/svg%3E\")`\n    )\n  })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should remove blurry placeholder after image loads","suites":["Fill-mode tests"],"updatePoint":{"line":1110,"column":56},"line":1110,"code":"  it('should remove blurry placeholder after image loads', async () => {\n    const browser = await webdriver(appPort, '/blurry-placeholder')\n    await check(\n      async () =>\n        await getComputedStyle(\n          browser,\n          'blurry-placeholder-raw',\n          'background-image'\n        ),\n      'none'\n    )\n    expect(\n      await getComputedStyle(\n        browser,\n        'blurry-placeholder-with-lazy',\n        'background-image'\n      )\n    ).toBe(\n      `url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' viewBox='0 0 400 400'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3C/filter%3E%3Cimage filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mO0/8/wBwAE/wI85bEJ6gAAAABJRU5ErkJggg=='/%3E%3C/svg%3E\")`\n    )\n\n    await browser.eval('document.getElementById(\"spacer\").remove()')\n\n    await check(\n      async () =>\n        await getComputedStyle(\n          browser,\n          'blurry-placeholder-with-lazy',\n          'background-image'\n        ),\n      'none'\n    )\n  })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should be valid HTML","suites":["Fill-mode tests"],"updatePoint":{"line":1144,"column":26},"line":1144,"code":"  it('should be valid HTML', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/valid-html-w3c')\n      await waitFor(1000)\n      expect(await browser.hasElementByCssSelector('img')).toBeTruthy()\n      const url = await browser.url()\n      const result = (await validateHTML({\n        url,\n        format: 'json',\n        isLocal: true,\n        validator: 'whatwg',\n      })) as any\n      expect(result.isValid).toBe(true)\n      expect(result.errors).toEqual([])\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/image-future/default/test/index.test.ts","skipped":false,"dir":"test"},{"name":"Should allow an image with a static src to omit height and width","suites":[],"updatePoint":{"line":25,"column":70},"line":25,"code":"  it('Should allow an image with a static src to omit height and width', async () => {\n    expect(await browser.elementById('basic-static')).toBeTruthy()\n    expect(await browser.elementById('blur-png')).toBeTruthy()\n    expect(await browser.elementById('blur-webp')).toBeTruthy()\n    expect(await browser.elementById('blur-avif')).toBeTruthy()\n    expect(await browser.elementById('blur-jpg')).toBeTruthy()\n    expect(await browser.elementById('static-svg')).toBeTruthy()\n    expect(await browser.elementById('static-gif')).toBeTruthy()\n    expect(await browser.elementById('static-bmp')).toBeTruthy()\n    expect(await browser.elementById('static-ico')).toBeTruthy()\n    expect(await browser.elementById('static-svg-fill')).toBeTruthy()\n    expect(await browser.elementById('static-gif-fill')).toBeTruthy()\n    expect(await browser.elementById('static-bmp-fill')).toBeTruthy()\n    expect(await browser.elementById('static-ico-fill')).toBeTruthy()\n    expect(await browser.elementById('static-unoptimized')).toBeTruthy()\n  })","file":"integration/image-future/default/test/static.test.ts","skipped":false,"dir":"test"},{"name":"Should use immutable cache-control header for static import","suites":[],"updatePoint":{"line":44,"column":67},"line":44,"code":"    it('Should use immutable cache-control header for static import', async () => {\n      await browser.eval(\n        `document.getElementById(\"basic-static\").scrollIntoView()`\n      )\n      await waitFor(1000)\n      const url = await browser.eval(\n        `document.getElementById(\"basic-static\").src`\n      )\n      const res = await fetch(url)\n      expect(res.headers.get('cache-control')).toBe(\n        'public, max-age=315360000, immutable'\n      )\n    })","file":"integration/image-future/default/test/static.test.ts","skipped":false,"dir":"test"},{"name":"Should use immutable cache-control header even when unoptimized","suites":[],"updatePoint":{"line":58,"column":71},"line":58,"code":"    it('Should use immutable cache-control header even when unoptimized', async () => {\n      await browser.eval(\n        `document.getElementById(\"static-unoptimized\").scrollIntoView()`\n      )\n      await waitFor(1000)\n      const url = await browser.eval(\n        `document.getElementById(\"static-unoptimized\").src`\n      )\n      const res = await fetch(url)\n      expect(res.headers.get('cache-control')).toBe(\n        'public, max-age=31536000, immutable'\n      )\n    })","file":"integration/image-future/default/test/static.test.ts","skipped":false,"dir":"test"},{"name":"Should automatically provide an image height and width","suites":[],"updatePoint":{"line":72,"column":60},"line":72,"code":"  it('Should automatically provide an image height and width', async () => {\n    const img = $('#basic-non-static')\n    expect(img.attr('width')).toBe('400')\n    expect(img.attr('height')).toBe('300')\n  })","file":"integration/image-future/default/test/static.test.ts","skipped":false,"dir":"test"},{"name":"should use width and height prop to override import","suites":[],"updatePoint":{"line":77,"column":57},"line":77,"code":"  it('should use width and height prop to override import', async () => {\n    const img = $('#defined-width-and-height')\n    expect(img.attr('width')).toBe('150')\n    expect(img.attr('height')).toBe('150')\n  })","file":"integration/image-future/default/test/static.test.ts","skipped":false,"dir":"test"},{"name":"should use height prop to adjust both width and height","suites":[],"updatePoint":{"line":82,"column":60},"line":82,"code":"  it('should use height prop to adjust both width and height', async () => {\n    const img = $('#defined-height-only')\n    expect(img.attr('width')).toBe('600')\n    expect(img.attr('height')).toBe('350')\n  })","file":"integration/image-future/default/test/static.test.ts","skipped":false,"dir":"test"},{"name":"should use width prop to adjust both width and height","suites":[],"updatePoint":{"line":87,"column":59},"line":87,"code":"  it('should use width prop to adjust both width and height', async () => {\n    const img = $('#defined-width-only')\n    expect(img.attr('width')).toBe('400')\n    expect(img.attr('height')).toBe('233')\n  })","file":"integration/image-future/default/test/static.test.ts","skipped":false,"dir":"test"},{"name":"Should add a blur placeholder a statically imported jpg","suites":[],"updatePoint":{"line":93,"column":61},"line":93,"code":"  it('Should add a blur placeholder a statically imported jpg', async () => {\n    const style = $('#basic-static').attr('style')\n    if (isDev) {\n      expect(style).toBe(\n        `color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(\"/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest-rect.f323a148.jpg&w=8&q=70\")`\n      )\n    } else {\n      expect(style).toBe(\n        `color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' viewBox='0 0 8 6'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='1'/%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'/%3E%3C/feComponentTransfer%3E%%3C/filter%3E%3Cimage filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' href='data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/sBCgoKCgoKCwwMCw8QDhAPFhQTExQWIhgaGBoYIjMgJSAgJSAzLTcsKSw3LVFAODhAUV5PSk9ecWVlcY+Ij7u7+//CABEIAAYACAMBIgACEQEDEQH/xAAnAAEBAAAAAAAAAAAAAAAAAAAABwEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAAmgP/xAAcEAACAQUBAAAAAAAAAAAAAAASFBMAAQMFERX/2gAIAQEAAT8AZ1HjrKZX55JysIc4Ff/EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Af//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Af//Z'/%3E%3C/svg%3E\")`\n      )\n    }\n  })","file":"integration/image-future/default/test/static.test.ts","skipped":false,"dir":"test"},{"name":"Should add a blur placeholder a statically imported png","suites":[],"updatePoint":{"line":106,"column":61},"line":106,"code":"  it('Should add a blur placeholder a statically imported png', async () => {\n    const style = $('#blur-png').attr('style')\n    if (isDev) {\n      expect(style).toBe(\n        `color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(\"/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=8&q=70\")`\n      )\n    } else {\n      expect(style).toBe(\n        `color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' viewBox='0 0 8 8'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='1'/%3E%3C/filter%3E%3Cimage filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAAAAADhZOFXAAAAOklEQVR42iWGsQkAIBDE0iuIdiLOJjiGIzjiL/Meb4okiNYIlLjK3hJMzCQG1/0qmXXOUkjAV+m9wAMe3QiV6Ne8VgAAAABJRU5ErkJggg=='/%3E%3C/svg%3E\")`\n      )\n    }\n  })","file":"integration/image-future/default/test/static.test.ts","skipped":false,"dir":"test"},{"name":"Should add a blur placeholder a statically imported png with fill","suites":[],"updatePoint":{"line":119,"column":71},"line":119,"code":"  it('Should add a blur placeholder a statically imported png with fill', async () => {\n    const style = $('#blur-png-fill').attr('style')\n    if (isDev) {\n      expect(style).toBe(\n        `position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(\"/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ftest.3f1a293b.png&w=8&q=70\")`\n      )\n    } else {\n      expect(style).toBe(\n        `position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' viewBox='0 0 8 8'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='1'/%3E%3C/filter%3E%3Cimage filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAAAAADhZOFXAAAAOklEQVR42iWGsQkAIBDE0iuIdiLOJjiGIzjiL/Meb4okiNYIlLjK3hJMzCQG1/0qmXXOUkjAV+m9wAMe3QiV6Ne8VgAAAABJRU5ErkJggg=='/%3E%3C/svg%3E\")`\n      )\n    }\n  })","file":"integration/image-future/default/test/static.test.ts","skipped":false,"dir":"test"},{"name":"should throw build error when import statement is used with missing file","suites":["Build Error Tests"],"updatePoint":{"line":134,"column":78},"line":134,"code":"  it('should throw build error when import statement is used with missing file', async () => {\n    await indexPage.replace(\n      '../public/foo/test-rect.jpg',\n      '../public/foo/test-rect-broken.jpg'\n    )\n\n    const { stderr } = await nextBuild(appDir, undefined, { stderr: true })\n    await indexPage.restore()\n\n    expect(stderr).toContain(\n      \"Module not found: Can't resolve '../public/foo/test-rect-broken.jpg\"\n    )\n    // should contain the importing module\n    expect(stderr).toContain('./pages/static-img.js')\n    // should contain a import trace\n    expect(stderr).not.toContain('Import trace for requested module')\n  })","file":"integration/image-future/default/test/static.test.ts","skipped":false,"dir":"test"},{"name":"should apply image config for node_modules","suites":[],"line":20,"code":"  it.skip('should apply image config for node_modules', async () => {","file":"integration/image-future/image-from-node-modules/test/index.test.ts","skipped":true,"dir":"test"},{"name":"should not cancel requests for images","suites":["react-virtualized wrapping next/image","production"],"updatePoint":{"line":63,"column":45},"line":63,"code":"    it('should not cancel requests for images', async () => {\n      // TODO: this test doesnt work unless we can set `disableCache: true`\n      let browser = await webdriver(appPort, '/', {\n        disableCache: true,\n      })\n      expect(cancelCount).toBe(0)\n      await browser.eval('window.scrollTo({ top: 100, behavior: \"smooth\" })')\n      await waitFor(100)\n      expect(cancelCount).toBe(0)\n      await browser.eval('window.scrollTo({ top: 200, behavior: \"smooth\" })')\n      await waitFor(200)\n      expect(cancelCount).toBe(0)\n      await browser.eval('window.scrollTo({ top: 300, behavior: \"smooth\" })')\n      await waitFor(300)\n      expect(cancelCount).toBe(0)\n    })","file":"integration/image-future/react-virtualized/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not fail to build invalid usage of the Image component","suites":["svgo-webpack with Image Component","next build"],"updatePoint":{"line":19,"column":69},"line":19,"code":"    it('should not fail to build invalid usage of the Image component', async () => {\n      const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n      const errors = stderr\n        .split('\\n')\n        .filter((line) => line && !line.startsWith('warn  -'))\n      expect(errors).toEqual([])\n      expect(code).toBe(0)\n    })","file":"integration/image-future/svgo-webpack/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should print error when invalid Image usage","suites":["svgo-webpack with Image Component","next dev"],"updatePoint":{"line":44,"column":51},"line":44,"code":"    it('should print error when invalid Image usage', async () => {\n      await renderViaHTTP(appPort, '/', {})\n      const errors = devOutput.stderr\n        .split('\\n')\n        .filter((line) => line && !line.startsWith('warn  -'))\n      expect(errors).toEqual([])\n    })","file":"integration/image-future/svgo-webpack/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should include trailing slash when trailingSlash is set on config file during next dev","suites":["Image Component Trailing Slash Tests","dev mode"],"updatePoint":{"line":26,"column":94},"line":26,"code":"    it('should include trailing slash when trailingSlash is set on config file during next dev', async () => {\n      expect.assertions(1)\n      let browser\n\n      try {\n        browser = await webdriver(appPort, '/')\n        const id = 'test1'\n        const srcImage = await browser.eval(\n          `document.getElementById('${id}').src`\n        )\n        expect(srcImage).toMatch(\n          /\\/_next\\/image\\/\\?url=%2F_next%2Fstatic%2Fmedia%2Ftest(.+).jpg&w=828&q=75/\n        )\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/image-future/trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should include trailing slash when trailingSlash is set on config file during next start","suites":["Image Component Trailing Slash Tests","server mode"],"updatePoint":{"line":55,"column":96},"line":55,"code":"    it('should include trailing slash when trailingSlash is set on config file during next start', async () => {\n      expect.assertions(1)\n      let browser\n      try {\n        browser = await webdriver(appPort, '/')\n        const id = 'test1'\n        const srcImage = await browser.eval(\n          `document.getElementById('${id}').src`\n        )\n        expect(srcImage).toMatch(\n          /\\/_next\\/image\\/\\?url=%2F_next%2Fstatic%2Fmedia%2Ftest(.+).jpg&w=828&q=75/\n        )\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/image-future/trailing-slash/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should fail to build invalid usage of the Image component","suites":["TypeScript Image Component","next build"],"updatePoint":{"line":25,"column":65},"line":25,"code":"    it('should fail to build invalid usage of the Image component', async () => {\n      const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n      expect(stderr).toMatch(/Failed to compile/)\n      expect(stderr).toMatch(/is not assignable to type/)\n      expect(code).toBe(1)\n      const envTypes = await fs.readFile(join(appDir, 'next-env.d.ts'), 'utf8')\n      expect(envTypes).toContain('image-types/global')\n    })","file":"integration/image-future/typescript/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should remove global image types when disabled","suites":["TypeScript Image Component","next build"],"updatePoint":{"line":34,"column":54},"line":34,"code":"    it('should remove global image types when disabled', async () => {\n      const content = await fs.readFile(nextConfig, 'utf8')\n      await fs.writeFile(\n        nextConfig,\n        content.replace('// disableStaticImages', 'disableStaticImages')\n      )\n      const { code, stderr } = await nextBuild(appDir, [], { stderr: true })\n      expect(stderr).toMatch(/Failed to compile/)\n      expect(stderr).toMatch(/is not assignable to type/)\n      expect(code).toBe(1)\n      await fs.writeFile(nextConfig, content)\n      const envTypes = await fs.readFile(join(appDir, 'next-env.d.ts'), 'utf8')\n      expect(envTypes).not.toContain('image-types/global')\n    })","file":"integration/image-future/typescript/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have image types when enabled","suites":["TypeScript Image Component","next dev"],"updatePoint":{"line":61,"column":44},"line":61,"code":"    it('should have image types when enabled', async () => {\n      const envTypes = await fs.readFile(join(appDir, 'next-env.d.ts'), 'utf8')\n      expect(envTypes).toContain('image-types/global')\n    })","file":"integration/image-future/typescript/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should render the valid Image usage and not print error","suites":["TypeScript Image Component","next dev"],"updatePoint":{"line":66,"column":63},"line":66,"code":"    it('should render the valid Image usage and not print error', async () => {\n      const html = await renderViaHTTP(appPort, '/valid', {})\n      expect(html).toMatch(/This is valid usage of the Image component/)\n      expect(output).not.toMatch(/Error: Image/)\n    })","file":"integration/image-future/typescript/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should print error when invalid Image usage","suites":["TypeScript Image Component","next dev"],"updatePoint":{"line":72,"column":51},"line":72,"code":"    it('should print error when invalid Image usage', async () => {\n      await renderViaHTTP(appPort, '/invalid', {})\n      expect(output).toMatch(/Error: Image/)\n    })","file":"integration/image-future/typescript/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should remove global image types when disabled (dev)","suites":["TypeScript Image Component","next dev"],"updatePoint":{"line":78,"column":58},"line":78,"code":"  it('should remove global image types when disabled (dev)', async () => {\n    const content = await fs.readFile(nextConfig, 'utf8')\n    await fs.writeFile(\n      nextConfig,\n      content.replace('// disableStaticImages', 'disableStaticImages')\n    )\n    const app = await launchApp(appDir, await findPort(), [])\n    await killApp(app)\n    await fs.writeFile(nextConfig, content)\n    const envTypes = await fs.readFile(join(appDir, 'next-env.d.ts'), 'utf8')\n    expect(envTypes).not.toContain('image-types/global')\n  })","file":"integration/image-future/typescript/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should load static unicode image","suites":[],"updatePoint":{"line":21,"column":38},"line":21,"code":"  it('should load static unicode image', async () => {\n    const src = await browser.elementById('static').getAttribute('src')\n    expect(src).toMatch(\n      /_next%2Fstatic%2Fmedia%2F%C3%A4%C3%B6%C3%BC%C5%A1%C4%8D%C5%99%C3%AD(.+)png/\n    )\n    const fullSrc = new URL(src, `http://localhost:${appPort}`)\n    const res = await fetch(fullSrc)\n    expect(res.status).toBe(200)\n  })","file":"integration/image-future/unicode/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should load internal unicode image","suites":[],"updatePoint":{"line":31,"column":40},"line":31,"code":"  it('should load internal unicode image', async () => {\n    const src = await browser.elementById('internal').getAttribute('src')\n    expect(src).toMatch(\n      '/_next/image?url=%2F%C3%A4%C3%B6%C3%BC%C5%A1%C4%8D%C5%99%C3%AD.png'\n    )\n    const fullSrc = new URL(src, `http://localhost:${appPort}`)\n    const res = await fetch(fullSrc)\n    expect(res.status).toBe(200)\n  })","file":"integration/image-future/unicode/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should load external unicode image","suites":[],"updatePoint":{"line":41,"column":40},"line":41,"code":"  it('should load external unicode image', async () => {\n    const src = await browser.elementById('external').getAttribute('src')\n    expect(src).toMatch(\n      '/_next/image?url=https%3A%2F%2Fimage-optimization-test.vercel.app%2F%C3%A4%C3%B6%C3%BC%C5%A1%C4%8D%C5%99%C3%AD.png'\n    )\n    const fullSrc = new URL(src, `http://localhost:${appPort}`)\n    const res = await fetch(fullSrc)\n    expect(res.status).toBe(200)\n  })","file":"integration/image-future/unicode/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should load internal image with space","suites":[],"updatePoint":{"line":51,"column":43},"line":51,"code":"  it('should load internal image with space', async () => {\n    const src = await browser.elementById('internal-space').getAttribute('src')\n    expect(src).toMatch('/_next/image?url=%2Fhello%2520world.jpg')\n    const fullSrc = new URL(src, `http://localhost:${appPort}`)\n    const res = await fetch(fullSrc)\n    expect(res.status).toBe(200)\n  })","file":"integration/image-future/unicode/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should load external image with space","suites":[],"updatePoint":{"line":59,"column":43},"line":59,"code":"  it('should load external image with space', async () => {\n    const src = await browser.elementById('external-space').getAttribute('src')\n    expect(src).toMatch(\n      '/_next/image?url=https%3A%2F%2Fimage-optimization-test.vercel.app%2Fhello%2520world.jpg'\n    )\n    const fullSrc = new URL(src, `http://localhost:${appPort}`)\n    const res = await fetch(fullSrc)\n    expect(res.status).toBe(200)\n  })","file":"integration/image-future/unicode/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not optimize any image","suites":[],"updatePoint":{"line":19,"column":35},"line":19,"code":"  it('should not optimize any image', async () => {\n    const browser = await webdriver(appPort, '/')\n\n    expect(\n      await browser.elementById('internal-image').getAttribute('src')\n    ).toBe('/test.png')\n    expect(\n      await browser.elementById('static-image').getAttribute('src')\n    ).toMatch(/test(.*)jpg/)\n    expect(\n      await browser.elementById('external-image').getAttribute('src')\n    ).toBe('https://image-optimization-test.vercel.app/test.jpg')\n    expect(await browser.elementById('eager-image').getAttribute('src')).toBe(\n      '/test.webp'\n    )\n\n    expect(\n      await browser.elementById('internal-image').getAttribute('srcset')\n    ).toBeNull()\n    expect(\n      await browser.elementById('static-image').getAttribute('srcset')\n    ).toBeNull()\n    expect(\n      await browser.elementById('external-image').getAttribute('srcset')\n    ).toBeNull()\n    expect(\n      await browser.elementById('eager-image').getAttribute('srcset')\n    ).toBeNull()\n\n    await browser.eval(\n      `document.getElementById(\"internal-image\").scrollIntoView({behavior: \"smooth\"})`\n    )\n    await browser.eval(\n      `document.getElementById(\"static-image\").scrollIntoView({behavior: \"smooth\"})`\n    )\n    await browser.eval(\n      `document.getElementById(\"external-image\").scrollIntoView({behavior: \"smooth\"})`\n    )\n    await browser.eval(\n      `document.getElementById(\"eager-image\").scrollIntoView({behavior: \"smooth\"})`\n    )\n\n    await check(\n      () =>\n        browser.eval(`document.getElementById(\"external-image\").currentSrc`),\n      'https://image-optimization-test.vercel.app/test.jpg'\n    )\n\n    expect(\n      await browser.elementById('internal-image').getAttribute('src')\n    ).toBe('/test.png')\n    expect(\n      await browser.elementById('static-image').getAttribute('src')\n    ).toMatch(/test(.*)jpg/)\n    expect(\n      await browser.elementById('external-image').getAttribute('src')\n    ).toBe('https://image-optimization-test.vercel.app/test.jpg')\n    expect(await browser.elementById('eager-image').getAttribute('src')).toBe(\n      '/test.webp'\n    )\n\n    expect(\n      await browser.elementById('internal-image').getAttribute('srcset')\n    ).toBeNull()\n    expect(\n      await browser.elementById('static-image').getAttribute('srcset')\n    ).toBeNull()\n    expect(\n      await browser.elementById('external-image').getAttribute('srcset')\n    ).toBeNull()\n    expect(\n      await browser.elementById('eager-image').getAttribute('srcset')\n    ).toBeNull()\n  })","file":"integration/image-future/unoptimized/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should error when domains length exceeds 50","suites":["Image Optimizer","config checks"],"updatePoint":{"line":26,"column":51},"line":26,"code":"    it('should error when domains length exceeds 50', async () => {\n      await nextConfig.replace(\n        '{ /* replaceme */ }',\n        JSON.stringify({\n          images: {\n            domains: new Array(51).fill('google.com'),\n          },\n        })\n      )\n      let stderr = ''\n\n      app = await launchApp(appDir, await findPort(), {\n        onStderr(msg) {\n          stderr += msg || ''\n        },\n      })\n      await waitFor(1000)\n      await killApp(app).catch(() => {})\n      await nextConfig.restore()\n\n      expect(stderr).toContain(\n        'Specified images.domains exceeds length of 50, received length (51), please reduce the length of the array to continue'\n      )\n    })","file":"integration/image-optimizer/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should error when remotePatterns length exceeds 50","suites":["Image Optimizer","config checks"],"updatePoint":{"line":51,"column":58},"line":51,"code":"    it('should error when remotePatterns length exceeds 50', async () => {\n      await nextConfig.replace(\n        '{ /* replaceme */ }',\n        JSON.stringify({\n          images: {\n            remotePatterns: Array.from({ length: 51 }).map((_) => ({\n              hostname: 'example.com',\n            })),\n          },\n        })\n      )\n      let stderr = ''\n\n      app = await launchApp(appDir, await findPort(), {\n        onStderr(msg) {\n          stderr += msg || ''\n        },\n      })\n      await waitFor(1000)\n      await killApp(app).catch(() => {})\n      await nextConfig.restore()\n\n      expect(stderr).toContain(\n        'Specified images.remotePatterns exceeds length of 50, received length (51), please reduce the length of the array to continue'\n      )\n    })","file":"integration/image-optimizer/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should error when remotePatterns has invalid prop","suites":["Image Optimizer","config checks"],"updatePoint":{"line":78,"column":57},"line":78,"code":"    it('should error when remotePatterns has invalid prop', async () => {\n      await nextConfig.replace(\n        '{ /* replaceme */ }',\n        JSON.stringify({\n          images: {\n            remotePatterns: [{ hostname: 'example.com', foo: 'bar' }],\n          },\n        })\n      )\n      let stderr = ''\n\n      app = await launchApp(appDir, await findPort(), {\n        onStderr(msg) {\n          stderr += msg || ''\n        },\n      })\n      await waitFor(1000)\n      await killApp(app).catch(() => {})\n      await nextConfig.restore()\n\n      expect(stderr).toContain(\n        'Invalid images.remotePatterns values:\\n{\"hostname\":\"example.com\",\"foo\":\"bar\"}'\n      )\n    })","file":"integration/image-optimizer/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should error when remotePatterns is missing hostname","suites":["Image Optimizer","config checks"],"updatePoint":{"line":103,"column":60},"line":103,"code":"    it('should error when remotePatterns is missing hostname', async () => {\n      await nextConfig.replace(\n        '{ /* replaceme */ }',\n        JSON.stringify({\n          images: {\n            remotePatterns: [{ protocol: 'https' }],\n          },\n        })\n      )\n      let stderr = ''\n\n      app = await launchApp(appDir, await findPort(), {\n        onStderr(msg) {\n          stderr += msg || ''\n        },\n      })\n      await waitFor(1000)\n      await killApp(app).catch(() => {})\n      await nextConfig.restore()\n\n      expect(stderr).toContain(\n        'Invalid images.remotePatterns values:\\n{\"protocol\":\"https\"}'\n      )\n    })","file":"integration/image-optimizer/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should error when sizes length exceeds 25","suites":["Image Optimizer","config checks"],"updatePoint":{"line":128,"column":49},"line":128,"code":"    it('should error when sizes length exceeds 25', async () => {\n      await nextConfig.replace(\n        '{ /* replaceme */ }',\n        JSON.stringify({\n          images: {\n            deviceSizes: new Array(51).fill(1024),\n          },\n        })\n      )\n      let stderr = ''\n\n      app = await launchApp(appDir, await findPort(), {\n        onStderr(msg) {\n          stderr += msg || ''\n        },\n      })\n      await waitFor(1000)\n      await killApp(app).catch(() => {})\n      await nextConfig.restore()\n\n      expect(stderr).toContain(\n        'Specified images.deviceSizes exceeds length of 25, received length (51), please reduce the length of the array to continue'\n      )\n    })","file":"integration/image-optimizer/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should error when deviceSizes contains invalid widths","suites":["Image Optimizer","config checks"],"updatePoint":{"line":153,"column":61},"line":153,"code":"    it('should error when deviceSizes contains invalid widths', async () => {\n      await nextConfig.replace(\n        '{ /* replaceme */ }',\n        JSON.stringify({\n          images: {\n            deviceSizes: [0, 12000, 64, 128, 256],\n          },\n        })\n      )\n      let stderr = ''\n\n      app = await launchApp(appDir, await findPort(), {\n        onStderr(msg) {\n          stderr += msg || ''\n        },\n      })\n      await waitFor(1000)\n      await killApp(app).catch(() => {})\n      await nextConfig.restore()\n\n      expect(stderr).toContain(\n        'Specified images.deviceSizes should be an Array of numbers that are between 1 and 10000, received invalid values (0, 12000)'\n      )\n    })","file":"integration/image-optimizer/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should error when imageSizes contains invalid widths","suites":["Image Optimizer","config checks"],"updatePoint":{"line":178,"column":60},"line":178,"code":"    it('should error when imageSizes contains invalid widths', async () => {\n      await nextConfig.replace(\n        '{ /* replaceme */ }',\n        JSON.stringify({\n          images: {\n            imageSizes: [0, 16, 64, 12000],\n          },\n        })\n      )\n      let stderr = ''\n\n      app = await launchApp(appDir, await findPort(), {\n        onStderr(msg) {\n          stderr += msg || ''\n        },\n      })\n      await waitFor(1000)\n      await killApp(app).catch(() => {})\n      await nextConfig.restore()\n\n      expect(stderr).toContain(\n        'Specified images.imageSizes should be an Array of numbers that are between 1 and 10000, received invalid values (0, 12000)'\n      )\n    })","file":"integration/image-optimizer/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should error when loader contains invalid value","suites":["Image Optimizer","config checks"],"updatePoint":{"line":203,"column":55},"line":203,"code":"    it('should error when loader contains invalid value', async () => {\n      await nextConfig.replace(\n        '{ /* replaceme */ }',\n        JSON.stringify({\n          images: {\n            loader: 'notreal',\n          },\n        })\n      )\n      let stderr = ''\n\n      app = await launchApp(appDir, await findPort(), {\n        onStderr(msg) {\n          stderr += msg || ''\n        },\n      })\n      await waitFor(1000)\n      await killApp(app).catch(() => {})\n      await nextConfig.restore()\n\n      expect(stderr).toContain(\n        'Specified images.loader should be one of (default, imgix, cloudinary, akamai, custom), received invalid value (notreal)'\n      )\n    })","file":"integration/image-optimizer/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should error when loader=custom but loader prop is undefined","suites":["Image Optimizer","config checks"],"updatePoint":{"line":228,"column":68},"line":228,"code":"    it('should error when loader=custom but loader prop is undefined', async () => {\n      await nextConfig.replace(\n        '{ /* replaceme */ }',\n        JSON.stringify({\n          images: {\n            loader: 'custom',\n          },\n        })\n      )\n      let output = ''\n      const appPort = await findPort()\n      app = await launchApp(appDir, appPort, {\n        onStderr(msg) {\n          output += msg || ''\n        },\n        onStdout(msg) {\n          output += msg || ''\n        },\n      })\n      await renderViaHTTP(appPort, '/', {})\n      await killApp(app).catch(() => {})\n      await nextConfig.restore()\n      expect(output).toMatch(\n        /Error: Image with src \"(.+)\" is missing \"loader\" prop/\n      )\n    })","file":"integration/image-optimizer/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should error when images.formats contains invalid values","suites":["Image Optimizer","config checks"],"updatePoint":{"line":255,"column":64},"line":255,"code":"    it('should error when images.formats contains invalid values', async () => {\n      await nextConfig.replace(\n        '{ /* replaceme */ }',\n        JSON.stringify({\n          images: {\n            formats: ['image/avif', 'jpeg'],\n          },\n        })\n      )\n      let stderr = ''\n\n      app = await launchApp(appDir, await findPort(), {\n        onStderr(msg) {\n          stderr += msg || ''\n        },\n      })\n      await waitFor(1000)\n      await killApp(app).catch(() => {})\n      await nextConfig.restore()\n\n      expect(stderr).toContain(\n        `Specified images.formats should be an Array of mime type strings, received invalid values (jpeg)`\n      )\n    })","file":"integration/image-optimizer/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should error when images.loader is assigned but images.path is not","suites":["Image Optimizer","config checks"],"updatePoint":{"line":280,"column":74},"line":280,"code":"    it('should error when images.loader is assigned but images.path is not', async () => {\n      await nextConfig.replace(\n        '{ /* replaceme */ }',\n        JSON.stringify({\n          images: {\n            loader: 'imgix',\n          },\n        })\n      )\n      let stderr = ''\n\n      app = await launchApp(appDir, await findPort(), {\n        onStderr(msg) {\n          stderr += msg || ''\n        },\n      })\n      await waitFor(1000)\n      await killApp(app).catch(() => {})\n      await nextConfig.restore()\n\n      expect(stderr).toContain(\n        `Specified images.loader property (imgix) also requires images.path property to be assigned to a URL prefix.`\n      )\n    })","file":"integration/image-optimizer/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should error when images.dangerouslyAllowSVG is not a boolean","suites":["Image Optimizer","config checks"],"updatePoint":{"line":305,"column":69},"line":305,"code":"    it('should error when images.dangerouslyAllowSVG is not a boolean', async () => {\n      await nextConfig.replace(\n        '{ /* replaceme */ }',\n        JSON.stringify({\n          images: {\n            dangerouslyAllowSVG: 'foo',\n          },\n        })\n      )\n      let stderr = ''\n\n      app = await launchApp(appDir, await findPort(), {\n        onStderr(msg) {\n          stderr += msg || ''\n        },\n      })\n      await waitFor(1000)\n      await killApp(app).catch(() => {})\n      await nextConfig.restore()\n\n      expect(stderr).toContain(\n        `Specified images.dangerouslyAllowSVG should be a boolean`\n      )\n    })","file":"integration/image-optimizer/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should error when images.contentSecurityPolicy is not a string","suites":["Image Optimizer","config checks"],"updatePoint":{"line":330,"column":70},"line":330,"code":"    it('should error when images.contentSecurityPolicy is not a string', async () => {\n      await nextConfig.replace(\n        '{ /* replaceme */ }',\n        JSON.stringify({\n          images: {\n            contentSecurityPolicy: 1,\n          },\n        })\n      )\n      let stderr = ''\n\n      app = await launchApp(appDir, await findPort(), {\n        onStderr(msg) {\n          stderr += msg || ''\n        },\n      })\n      await waitFor(1000)\n      await killApp(app).catch(() => {})\n      await nextConfig.restore()\n\n      expect(stderr).toContain(\n        `Specified images.contentSecurityPolicy should be a string`\n      )\n    })","file":"integration/image-optimizer/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should return successful response for original loader","suites":["Image Optimizer","Server support for trailingSlash in next.config.js"],"updatePoint":{"line":425,"column":61},"line":425,"code":"    it('should return successful response for original loader', async () => {\n      let res\n      const query = { url: '/test.png', w: 8, q: 70 }\n      res = await fetchViaHTTP(appPort, '/_next/image/', query)\n      expect(res.status).toBe(200)\n    })","file":"integration/image-optimizer/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should set max-age header","suites":["Image Optimizer","Server support for headers in next.config.js"],"updatePoint":{"line":467,"column":33},"line":467,"code":"    it('should set max-age header', async () => {\n      const query = { url: '/test.png', w: size, q: 75 }\n      const opts = { headers: { accept: 'image/webp' } }\n      const res = await fetchViaHTTP(appPort, '/_next/image', query, opts)\n      expect(res.status).toBe(200)\n      expect(res.headers.get('Cache-Control')).toBe(\n        `public, max-age=86400, must-revalidate`\n      )\n      expect(res.headers.get('Content-Disposition')).toBe(\n        `inline; filename=\"test.webp\"`\n      )\n\n      await check(async () => {\n        const files = await fsToJson(imagesDir)\n\n        let found = false\n        const maxAge = '86400'\n\n        Object.keys(files).forEach((dir) => {\n          if (\n            Object.keys(files[dir]).some((file) => file.includes(`${maxAge}.`))\n          ) {\n            found = true\n          }\n        })\n        return found ? 'success' : 'failed'\n      }, 'success')\n    })","file":"integration/image-optimizer/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should not set max-age header when not matching next.config.js","suites":["Image Optimizer","Server support for headers in next.config.js"],"updatePoint":{"line":496,"column":70},"line":496,"code":"    it('should not set max-age header when not matching next.config.js', async () => {\n      const query = { url: '/test.jpg', w: size, q: 75 }\n      const opts = { headers: { accept: 'image/webp' } }\n      const res = await fetchViaHTTP(appPort, '/_next/image', query, opts)\n      expect(res.status).toBe(200)\n      expect(res.headers.get('Cache-Control')).toBe(\n        `public, max-age=60, must-revalidate`\n      )\n      expect(res.headers.get('Content-Disposition')).toBe(\n        `inline; filename=\"test.webp\"`\n      )\n    })","file":"integration/image-optimizer/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should 404 when loader is not default","suites":["Image Optimizer","dev support next.config.js cloudinary loader"],"updatePoint":{"line":530,"column":45},"line":530,"code":"    it('should 404 when loader is not default', async () => {\n      const size = 384 // defaults defined in server/config.ts\n      const query = { w: size, q: 90, url: '/test.svg' }\n      const opts = { headers: { accept: 'image/webp' } }\n      const res = await fetchViaHTTP(appPort, '/_next/image', query, opts)\n      expect(res.status).toBe(404)\n    })","file":"integration/image-optimizer/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should return response when image is served from an external rewrite","suites":["Image Optimizer","External rewrite support with for serving static content in images"],"updatePoint":{"line":565,"column":76},"line":565,"code":"    it('should return response when image is served from an external rewrite', async () => {\n      await cleanImagesDir({ imagesDir })\n\n      const query = { url: '/next-js/next-js-bg.png', w: 64, q: 75 }\n      const opts = { headers: { accept: 'image/webp' } }\n      const res = await fetchViaHTTP(appPort, '/_next/image', query, opts)\n      expect(res.status).toBe(200)\n      expect(res.headers.get('Content-Type')).toBe('image/webp')\n      expect(res.headers.get('Cache-Control')).toBe(\n        `public, max-age=31536000, must-revalidate`\n      )\n      expect(res.headers.get('Vary')).toBe('Accept')\n      expect(res.headers.get('Content-Disposition')).toBe(\n        `inline; filename=\"next-js-bg.webp\"`\n      )\n\n      await check(async () => {\n        const files = await fsToJson(imagesDir)\n\n        let found = false\n        const maxAge = '31536000'\n\n        Object.keys(files).forEach((dir) => {\n          if (\n            Object.keys(files[dir]).some((file) => file.includes(`${maxAge}.`))\n          ) {\n            found = true\n          }\n        })\n        return found ? 'success' : 'failed'\n      }, 'success')\n      await expectWidth(res, 64)\n    })","file":"integration/image-optimizer/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should support width 8 per BLUR_IMG_SIZE with next dev","suites":["Image Optimizer","dev support for dynamic blur placeholder"],"updatePoint":{"line":620,"column":62},"line":620,"code":"    it('should support width 8 per BLUR_IMG_SIZE with next dev', async () => {\n      const query = { url: '/test.png', w: 8, q: 70 }\n      const opts = { headers: { accept: 'image/webp' } }\n      const res = await fetchViaHTTP(appPort, '/_next/image', query, opts)\n      expect(res.status).toBe(200)\n      await expectWidth(res, 8)\n    })","file":"integration/image-optimizer/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should handle json assertions","suites":[],"updatePoint":{"line":7,"column":35},"line":7,"code":"  it('should handle json assertions', async () => {\n    const esHtml = await renderViaHTTP(context.appPort, '/es')\n    const tsHtml = await renderViaHTTP(context.appPort, '/ts')\n    expect(esHtml).toContain('foo')\n    expect(tsHtml).toContain('foo')\n  })","file":"integration/import-assertion/test/index.test.js","skipped":false,"dir":"test"},{"name":"should ssr page /","suites":[],"updatePoint":{"line":24,"column":23},"line":24,"code":"  it('should ssr page /', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(html)\n    expect($('#page').text()).toBe('index')\n  })","file":"integration/index-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"should client render page /","suites":[],"updatePoint":{"line":30,"column":33},"line":30,"code":"  it('should client render page /', async () => {\n    const browser = await webdriver(appPort, '/')\n    try {\n      const text = await browser.elementByCss('#page').text()\n      expect(text).toBe('index')\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/index-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"should follow link to /","suites":[],"updatePoint":{"line":40,"column":29},"line":40,"code":"  it('should follow link to /', async () => {\n    const browser = await webdriver(appPort, '/links')\n    try {\n      await browser.elementByCss('#link1').click()\n      await waitFor(1000)\n      await check(() => browser.elementByCss('#page').text(), /^index$/)\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/index-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"should ssr page /index","suites":[],"updatePoint":{"line":51,"column":28},"line":51,"code":"  it('should ssr page /index', async () => {\n    const html = await renderViaHTTP(appPort, '/index')\n    const $ = cheerio.load(html)\n    expect($('#page').text()).toBe('index > index')\n  })","file":"integration/index-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"should client render page /index","suites":[],"updatePoint":{"line":57,"column":38},"line":57,"code":"  it('should client render page /index', async () => {\n    const browser = await webdriver(appPort, '/index')\n    try {\n      const text = await browser.elementByCss('#page').text()\n      expect(text).toBe('index > index')\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/index-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"should follow link to /index","suites":[],"updatePoint":{"line":67,"column":34},"line":67,"code":"  it('should follow link to /index', async () => {\n    const browser = await webdriver(appPort, '/links')\n    try {\n      await browser.elementByCss('#link2').click()\n      await waitFor(1000)\n      await check(() => browser.elementByCss('#page').text(), /^index > index$/)\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/index-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"should ssr page /index/user","suites":[],"updatePoint":{"line":78,"column":33},"line":78,"code":"  it('should ssr page /index/user', async () => {\n    const html = await renderViaHTTP(appPort, '/index/user')\n    const $ = cheerio.load(html)\n    expect($('#page').text()).toBe('index > user')\n  })","file":"integration/index-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"should client render page /index/user","suites":[],"updatePoint":{"line":84,"column":43},"line":84,"code":"  it('should client render page /index/user', async () => {\n    const browser = await webdriver(appPort, '/index/user')\n    try {\n      const text = await browser.elementByCss('#page').text()\n      expect(text).toBe('index > user')\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/index-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"should follow link to /index/user","suites":[],"updatePoint":{"line":94,"column":39},"line":94,"code":"  it('should follow link to /index/user', async () => {\n    const browser = await webdriver(appPort, '/links')\n    try {\n      await browser.elementByCss('#link5').click()\n      await waitFor(1000)\n      await check(() => browser.elementByCss('#page').text(), /^index > user$/)\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/index-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"should ssr page /index/project","suites":[],"updatePoint":{"line":105,"column":36},"line":105,"code":"  it('should ssr page /index/project', async () => {\n    const html = await renderViaHTTP(appPort, '/index/project')\n    const $ = cheerio.load(html)\n    expect($('#page').text()).toBe('index > project')\n  })","file":"integration/index-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"should client render page /index/project","suites":[],"updatePoint":{"line":111,"column":46},"line":111,"code":"  it('should client render page /index/project', async () => {\n    const browser = await webdriver(appPort, '/index/project')\n    try {\n      const text = await browser.elementByCss('#page').text()\n      expect(text).toBe('index > project')\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/index-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"should follow link to /index/project","suites":[],"updatePoint":{"line":121,"column":42},"line":121,"code":"  it('should follow link to /index/project', async () => {\n    const browser = await webdriver(appPort, '/links')\n    try {\n      await browser.elementByCss('#link6').click()\n      await waitFor(1000)\n      await check(\n        () => browser.elementByCss('#page').text(),\n        /^index > project$/\n      )\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/index-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"should ssr page /index/index","suites":[],"updatePoint":{"line":135,"column":34},"line":135,"code":"  it('should ssr page /index/index', async () => {\n    const html = await renderViaHTTP(appPort, '/index/index')\n    const $ = cheerio.load(html)\n    expect($('#page').text()).toBe('index > index > index')\n  })","file":"integration/index-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"should client render page /index/index","suites":[],"updatePoint":{"line":141,"column":44},"line":141,"code":"  it('should client render page /index/index', async () => {\n    const browser = await webdriver(appPort, '/index/index')\n    try {\n      const text = await browser.elementByCss('#page').text()\n      expect(text).toBe('index > index > index')\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/index-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"should follow link to /index/index","suites":[],"updatePoint":{"line":151,"column":40},"line":151,"code":"  it('should follow link to /index/index', async () => {\n    const browser = await webdriver(appPort, '/links')\n    try {\n      await browser.elementByCss('#link3').click()\n      await waitFor(1000)\n      await check(\n        () => browser.elementByCss('#page').text(),\n        /^index > index > index$/\n      )\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/index-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"should 404 on /index/index/index","suites":[],"updatePoint":{"line":165,"column":38},"line":165,"code":"  it('should 404 on /index/index/index', async () => {\n    const response = await fetchViaHTTP(appPort, '/index/index/index')\n    expect(response.status).toBe(404)\n  })","file":"integration/index-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not find a link to /index/index/index","suites":[],"updatePoint":{"line":170,"column":50},"line":170,"code":"  it('should not find a link to /index/index/index', async () => {\n    const browser = await webdriver(appPort, '/links')\n    try {\n      await browser.elementByCss('#link4').click()\n      await waitFor(1000)\n      await check(() => browser.elementByCss('h1').text(), /404/)\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/index-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"Has correct initial ref values","suites":[],"updatePoint":{"line":18,"column":36},"line":18,"code":"  it('Has correct initial ref values', async () => {\n    const browser = await webdriver(appPort, '/')\n    expect(await browser.elementByCss('#ref-val').text()).toContain('76px')\n  })","file":"integration/initial-ref/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not error without usage of assetPrefix","suites":["Handles valid/invalid assetPrefix"],"updatePoint":{"line":16,"column":51},"line":16,"code":"  it('should not error without usage of assetPrefix', async () => {\n    await fs.writeFile(\n      nextConfigPath,\n      `module.exports = {\n      }`\n    )\n\n    const { stderr } = await nextBuild(appDir, undefined, { stderr: true })\n    expect(stderr).not.toMatch(/Specified assetPrefix is not a string/)\n  })","file":"integration/invalid-config-values/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not error when assetPrefix is a string","suites":["Handles valid/invalid assetPrefix"],"updatePoint":{"line":27,"column":51},"line":27,"code":"  it('should not error when assetPrefix is a string', async () => {\n    await fs.writeFile(\n      nextConfigPath,\n      `module.exports = {\n        assetPrefix: '/hello'\n      }`\n    )\n\n    const { stderr } = await nextBuild(appDir, undefined, { stderr: true })\n    expect(stderr).not.toMatch(/Specified assetPrefix is not a string/)\n  })","file":"integration/invalid-config-values/test/index.test.js","skipped":false,"dir":"test"},{"name":"should error when empty headers array is present on header item","suites":[],"updatePoint":{"line":26,"column":69},"line":26,"code":"  it('should error when empty headers array is present on header item', async () => {\n    await writeConfig(\n      [\n        {\n          source: `/:path*`,\n          headers: [],\n        },\n      ],\n      'headers'\n    )\n    const stderr = await getStderr()\n\n    expect(stderr).toContain(\n      '`headers` field cannot be empty for route {\"source\":\"/:path*\"'\n    )\n  })","file":"integration/invalid-custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should error when source and destination length is exceeded","suites":[],"updatePoint":{"line":43,"column":65},"line":43,"code":"  it('should error when source and destination length is exceeded', async () => {\n    await writeConfig(\n      [\n        {\n          source: `/${Array(4096).join('a')}`,\n          destination: `/another`,\n          permanent: false,\n        },\n        {\n          source: `/`,\n          destination: `/${Array(4096).join('a')}`,\n          permanent: false,\n        },\n      ],\n      'redirects'\n    )\n    const stderr = await getStderr()\n\n    expect(stderr).toContain(\n      '`source` exceeds max built length of 4096 for route {\"source\":\"/aaaaaaaaaaaaaaaaaa'\n    )\n    expect(stderr).toContain(\n      '`destination` exceeds max built length of 4096 for route {\"source\":\"/\",\"destination\":\"/aaaa'\n    )\n  })","file":"integration/invalid-custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should error during next build for invalid redirects","suites":[],"updatePoint":{"line":69,"column":58},"line":69,"code":"  it('should error during next build for invalid redirects', async () => {\n    await writeConfig(\n      [\n        {\n          // missing destination\n          source: '/hello',\n          permanent: false,\n        },\n        {\n          // invalid source\n          source: 123,\n          destination: '/another',\n          permanent: false,\n        },\n        {\n          // invalid statusCode type\n          source: '/hello',\n          destination: '/another',\n          statusCode: '301',\n        },\n        {\n          // invalid statusCode\n          source: '/hello',\n          destination: '/another',\n          statusCode: 404,\n        },\n        {\n          // invalid permanent value\n          source: '/hello',\n          destination: '/another',\n          permanent: 'yes',\n        },\n        {\n          // unnamed in destination\n          source: '/hello/world/(.*)',\n          destination: '/:0',\n          permanent: true,\n        },\n        // invalid objects\n        null,\n        'string',\n\n        // invalid has items\n        {\n          source: '/hello',\n          destination: '/another',\n          has: [\n            {\n              type: 'cookiee',\n              key: 'loggedIn',\n            },\n          ],\n          permanent: false,\n        },\n        {\n          source: '/hello',\n          destination: '/another',\n          permanent: false,\n          has: [\n            {\n              type: 'headerr',\n            },\n            {\n              type: 'queryr',\n              key: 'hello',\n            },\n          ],\n        },\n      ],\n      'redirects'\n    )\n    const stderr = await getStderr()\n\n    expect(stderr).toContain(\n      `\\`destination\\` is missing for route {\"source\":\"/hello\",\"permanent\":false}`\n    )\n\n    expect(stderr).toContain(\n      `\\`source\\` is not a string for route {\"source\":123,\"destination\":\"/another\",\"permanent\":false}`\n    )\n\n    expect(stderr).toContain(\n      `\\`statusCode\\` is not undefined or valid statusCode for route {\"source\":\"/hello\",\"destination\":\"/another\",\"statusCode\":\"301\"}`\n    )\n\n    expect(stderr).toContain(\n      `\\`statusCode\\` is not undefined or valid statusCode for route {\"source\":\"/hello\",\"destination\":\"/another\",\"statusCode\":404}`\n    )\n\n    expect(stderr).toContain(\n      `\\`permanent\\` is not set to \\`true\\` or \\`false\\` for route {\"source\":\"/hello\",\"destination\":\"/another\",\"permanent\":\"yes\"}`\n    )\n\n    expect(stderr).toContain(\n      `\\`destination\\` has unnamed params :0 for route {\"source\":\"/hello/world/(.*)\",\"destination\":\"/:0\",\"permanent\":true}`\n    )\n\n    expect(stderr).toContain(\n      `The route null is not a valid object with \\`source\\` and \\`destination\\``\n    )\n\n    expect(stderr).toContain(\n      `The route \"string\" is not a valid object with \\`source\\` and \\`destination\\``\n    )\n\n    expect(stderr).toContain('Invalid `has` item:')\n    expect(stderr).toContain(\n      `invalid type \"cookiee\" for {\"type\":\"cookiee\",\"key\":\"loggedIn\"}`\n    )\n    expect(stderr).toContain(\n      `invalid \\`has\\` item found for route {\"source\":\"/hello\",\"destination\":\"/another\",\"has\":[{\"type\":\"cookiee\",\"key\":\"loggedIn\"}],\"permanent\":false}`\n    )\n\n    expect(stderr).toContain('Invalid `has` items:')\n    expect(stderr).toContain(\n      `invalid type \"headerr\", invalid key \"undefined\" for {\"type\":\"headerr\"}`\n    )\n    expect(stderr).toContain(\n      `invalid type \"queryr\" for {\"type\":\"queryr\",\"key\":\"hello\"}`\n    )\n    expect(stderr).toContain(\n      `invalid \\`has\\` items found for route {\"source\":\"/hello\",\"destination\":\"/another\",\"permanent\":false,\"has\":[{\"type\":\"headerr\"},{\"type\":\"queryr\",\"key\":\"hello\"}]}`\n    )\n    expect(stderr).toContain(`Valid \\`has\\` object shape is {`)\n\n    expect(stderr).toContain('Invalid redirects found')\n  })","file":"integration/invalid-custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should error during next build for invalid rewrites","suites":[],"updatePoint":{"line":197,"column":57},"line":197,"code":"  it('should error during next build for invalid rewrites', async () => {\n    await writeConfig(\n      [\n        {\n          // missing destination\n          source: '/hello',\n        },\n        {\n          // invalid source\n          source: 123,\n          destination: '/another',\n        },\n        {\n          // extra field\n          source: '/hello',\n          destination: '/another',\n          headers: 'not-allowed',\n        },\n        {\n          // missing forward slash in source\n          source: 'hello',\n          destination: '/another',\n        },\n        {\n          // missing forward slash in destination\n          source: '/hello',\n          destination: 'another',\n        },\n        {\n          source: '/feedback/(?!general)',\n          destination: '/feedback/general',\n        },\n        {\n          // unnamed in destination\n          source: '/hello/world/(.*)',\n          destination: '/:0',\n        },\n        {\n          // basePath with relative destination\n          source: '/hello',\n          destination: '/world',\n          basePath: false,\n        },\n        // invalid objects\n        null,\n        'string',\n\n        // invalid has items\n        {\n          source: '/hello',\n          destination: '/another',\n          has: [\n            {\n              type: 'cookiee',\n              key: 'loggedIn',\n            },\n          ],\n        },\n        {\n          source: '/hello',\n          destination: '/another',\n          has: [\n            {\n              type: 'headerr',\n            },\n            {\n              type: 'queryr',\n              key: 'hello',\n            },\n          ],\n        },\n      ],\n      'rewrites'\n    )\n    const stderr = await getStderr()\n\n    expect(stderr).toContain(\n      `\\`destination\\` is missing for route {\"source\":\"/hello\"}`\n    )\n\n    expect(stderr).toContain(\n      `\\`source\\` is not a string for route {\"source\":123,\"destination\":\"/another\"}`\n    )\n\n    expect(stderr).toContain(\n      `invalid field: headers for route {\"source\":\"/hello\",\"destination\":\"/another\",\"headers\":\"not-allowed\"}`\n    )\n\n    expect(stderr).toContain(\n      `\\`source\\` does not start with / for route {\"source\":\"hello\",\"destination\":\"/another\"}`\n    )\n\n    expect(stderr).toContain(\n      `\\`destination\\` does not start with \\`/\\`, \\`http://\\`, or \\`https://\\` for route {\"source\":\"/hello\",\"destination\":\"another\"}`\n    )\n\n    expect(stderr).toContain(\n      `Error parsing \\`/feedback/(?!general)\\` https://nextjs.org/docs/messages/invalid-route-source`\n    )\n\n    expect(stderr).toContain(\n      `\\`destination\\` has unnamed params :0 for route {\"source\":\"/hello/world/(.*)\",\"destination\":\"/:0\"}`\n    )\n\n    expect(stderr).toContain(\n      `The route null is not a valid object with \\`source\\` and \\`destination\\``\n    )\n\n    expect(stderr).toContain(\n      `The route \"string\" is not a valid object with \\`source\\` and \\`destination\\``\n    )\n\n    expect(stderr).toContain(`Reason: Pattern cannot start with \"?\" at 11`)\n    expect(stderr).toContain(`/feedback/(?!general)`)\n\n    expect(stderr).not.toContain(\n      'Valid redirect statusCode values are 301, 302, 303, 307, 308'\n    )\n\n    expect(stderr).toContain(\n      `The route /hello rewrites urls outside of the basePath. Please use a destination that starts with \\`http://\\` or \\`https://\\` https://nextjs.org/docs/messages/invalid-external-rewrite`\n    )\n\n    expect(stderr).toContain('Invalid `has` item:')\n    expect(stderr).toContain(\n      `invalid type \"cookiee\" for {\"type\":\"cookiee\",\"key\":\"loggedIn\"}`\n    )\n    expect(stderr).toContain(\n      `invalid \\`has\\` item found for route {\"source\":\"/hello\",\"destination\":\"/another\",\"has\":[{\"type\":\"cookiee\",\"key\":\"loggedIn\"}]}`\n    )\n\n    expect(stderr).toContain('Invalid `has` items:')\n    expect(stderr).toContain(\n      `invalid type \"headerr\", invalid key \"undefined\" for {\"type\":\"headerr\"}`\n    )\n    expect(stderr).toContain(\n      `invalid type \"queryr\" for {\"type\":\"queryr\",\"key\":\"hello\"}`\n    )\n    expect(stderr).toContain(\n      `invalid \\`has\\` items found for route {\"source\":\"/hello\",\"destination\":\"/another\",\"has\":[{\"type\":\"headerr\"},{\"type\":\"queryr\",\"key\":\"hello\"}]}`\n    )\n    expect(stderr).toContain(`Valid \\`has\\` object shape is {`)\n\n    expect(stderr).toContain('Invalid rewrites found')\n  })","file":"integration/invalid-custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should error during next build for invalid headers","suites":[],"updatePoint":{"line":343,"column":56},"line":343,"code":"  it('should error during next build for invalid headers', async () => {\n    await writeConfig(\n      [\n        {\n          // missing source\n          headers: [\n            {\n              'x-first': 'first',\n            },\n          ],\n        },\n        {\n          // invalid headers value\n          source: '/hello',\n          headers: {\n            'x-first': 'first',\n          },\n        },\n        {\n          source: '/again',\n          headers: [\n            {\n              // missing key\n              value: 'idk',\n            },\n          ],\n        },\n        {\n          source: '/again',\n          headers: [\n            {\n              // missing value\n              key: 'idk',\n            },\n          ],\n        },\n        {\n          // non-allowed destination\n          source: '/again',\n          destination: '/another',\n          headers: [\n            {\n              key: 'x-first',\n              value: 'idk',\n            },\n          ],\n        },\n        {\n          // valid one\n          source: '/valid-header',\n          headers: [\n            {\n              key: 'x-first',\n              value: 'first',\n            },\n            {\n              key: 'x-another',\n              value: 'again',\n            },\n          ],\n        },\n        // invalid objects\n        null,\n        'string',\n\n        // invalid has items\n        {\n          source: '/hello',\n          has: [\n            {\n              type: 'cookiee',\n              key: 'loggedIn',\n            },\n          ],\n          headers: [\n            {\n              key: 'x-hello',\n              value: 'world',\n            },\n          ],\n        },\n        {\n          source: '/hello',\n          has: [\n            {\n              type: 'headerr',\n            },\n            {\n              type: 'queryr',\n              key: 'hello',\n            },\n          ],\n          headers: [\n            {\n              key: 'x-hello',\n              value: 'world',\n            },\n          ],\n        },\n      ],\n      'headers'\n    )\n    const stderr = await getStderr()\n\n    expect(stderr).toContain(\n      '`source` is missing, `key` in header item must be string for route {\"headers\":[{\"x-first\":\"first\"}]}'\n    )\n\n    expect(stderr).toContain(\n      '`headers` field must be an array for route {\"source\":\"/hello\",\"headers\":{\"x-first\":\"first\"}}'\n    )\n\n    expect(stderr).toContain(\n      '`key` in header item must be string for route {\"source\":\"/again\",\"headers\":[{\"value\":\"idk\"}]}'\n    )\n\n    expect(stderr).toContain(\n      '`value` in header item must be string for route {\"source\":\"/again\",\"headers\":[{\"key\":\"idk\"}]}'\n    )\n\n    expect(stderr).toContain(\n      'invalid field: destination for route {\"source\":\"/again\",\"destination\":\"/another\",\"headers\":[{\"key\":\"x-first\",\"value\":\"idk\"}]}'\n    )\n\n    expect(stderr).toContain(\n      `The route null is not a valid object with \\`source\\` and \\`headers\\``\n    )\n\n    expect(stderr).toContain(\n      `The route \"string\" is not a valid object with \\`source\\` and \\`headers\\``\n    )\n\n    expect(stderr).toContain('Invalid `has` item:')\n    expect(stderr).toContain(\n      `invalid type \"cookiee\" for {\"type\":\"cookiee\",\"key\":\"loggedIn\"}`\n    )\n    expect(stderr).toContain(\n      `invalid \\`has\\` item found for route {\"source\":\"/hello\",\"has\":[{\"type\":\"cookiee\",\"key\":\"loggedIn\"}],\"headers\":[{\"key\":\"x-hello\",\"value\":\"world\"}]}`\n    )\n\n    expect(stderr).toContain('Invalid `has` items:')\n    expect(stderr).toContain(\n      `invalid type \"headerr\", invalid key \"undefined\" for {\"type\":\"headerr\"}`\n    )\n    expect(stderr).toContain(\n      `invalid type \"queryr\" for {\"type\":\"queryr\",\"key\":\"hello\"}`\n    )\n    expect(stderr).toContain(\n      `invalid \\`has\\` items found for route {\"source\":\"/hello\",\"has\":[{\"type\":\"headerr\"},{\"type\":\"queryr\",\"key\":\"hello\"}],\"headers\":[{\"key\":\"x-hello\",\"value\":\"world\"}]}`\n    )\n    expect(stderr).toContain(`Valid \\`has\\` object shape is {`)\n\n    expect(stderr).not.toContain('/valid-header')\n  })","file":"integration/invalid-custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show formatted error for redirect source parse fail","suites":[],"updatePoint":{"line":498,"column":64},"line":498,"code":"  it('should show formatted error for redirect source parse fail', async () => {\n    await writeConfig(\n      [\n        {\n          source: '/feedback/(?!general)',\n          destination: '/feedback/general',\n          permanent: false,\n        },\n        {\n          source: '/learning/?',\n          destination: '/learning',\n          permanent: true,\n        },\n      ],\n      'redirects'\n    )\n\n    const stderr = await getStderr()\n\n    expect(stderr).toContain(\n      `Error parsing \\`/feedback/(?!general)\\` https://nextjs.org/docs/messages/invalid-route-source`\n    )\n    expect(stderr).toContain(`Reason: Pattern cannot start with \"?\" at 11`)\n    expect(stderr).toContain(`/feedback/(?!general)`)\n\n    expect(stderr).toContain(\n      `Error parsing \\`/learning/?\\` https://nextjs.org/docs/messages/invalid-route-source`\n    )\n    expect(stderr).toContain(`Reason: Unexpected MODIFIER at 10, expected END`)\n    expect(stderr).toContain(`/learning/?`)\n  })","file":"integration/invalid-custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show valid error when non-array is returned from rewrites","suites":[],"updatePoint":{"line":530,"column":70},"line":530,"code":"  it('should show valid error when non-array is returned from rewrites', async () => {\n    await writeConfig(\n      {\n        source: '/feedback/(?!general)',\n        destination: '/feedback/general',\n      },\n      'rewrites'\n    )\n\n    const stderr = await getStderr()\n\n    expect(stderr).toContain(`rewrites must return an array, received object`)\n  })","file":"integration/invalid-custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show valid error when non-array is returned from redirects","suites":[],"updatePoint":{"line":544,"column":71},"line":544,"code":"  it('should show valid error when non-array is returned from redirects', async () => {\n    await writeConfig(false, 'redirects')\n\n    const stderr = await getStderr()\n\n    expect(stderr).toContain(`redirects must return an array, received boolean`)\n  })","file":"integration/invalid-custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show valid error when non-array is returned from headers","suites":[],"updatePoint":{"line":552,"column":69},"line":552,"code":"  it('should show valid error when non-array is returned from headers', async () => {\n    await writeConfig(undefined, 'headers')\n\n    const stderr = await getStderr()\n\n    expect(stderr).toContain(`headers must return an array, received undefined`)\n  })","file":"integration/invalid-custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show valid error when segments not in source are used in destination","suites":[],"updatePoint":{"line":560,"column":81},"line":560,"code":"  it('should show valid error when segments not in source are used in destination', async () => {\n    await writeConfig(\n      [\n        {\n          source: '/feedback/:type',\n          destination: '/feedback/:id',\n        },\n      ],\n      'rewrites'\n    )\n\n    const stderr = await getStderr()\n\n    expect(stderr).toContain(\n      `\\`destination\\` has segments not in \\`source\\` or \\`has\\` (id) for route {\"source\":\"/feedback/:type\",\"destination\":\"/feedback/:id\"}`\n    )\n  })","file":"integration/invalid-custom-routes/test/index.test.js","skipped":false,"dir":"test"},{"name":"Should fail to build when no next.config.js","suites":["Invalid static image import in _document"],"updatePoint":{"line":13,"column":49},"line":13,"code":"  it('Should fail to build when no next.config.js', async () => {\n    const { code, stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n    })\n    expect(code).not.toBe(0)\n    expect(stderr).toContain('Failed to compile')\n    expect(stderr).toMatch(\n      /Images.*cannot.*be imported within.*pages[\\\\/]_document\\.js/\n    )\n    expect(stderr).toMatch(/Location:.*pages[\\\\/]_document\\.js/)\n  })","file":"integration/invalid-document-image-import/test/index.test.js","skipped":false,"dir":"test"},{"name":"Should fail to build when disableStaticImages in next.config.js","suites":["Invalid static image import in _document"],"updatePoint":{"line":25,"column":69},"line":25,"code":"  it('Should fail to build when disableStaticImages in next.config.js', async () => {\n    nextConfig.write(`\n      module.exports = {\n        images: {\n          disableStaticImages: true\n        }\n      }\n    `)\n    const { code, stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n    })\n    expect(code).not.toBe(0)\n    expect(stderr).toMatch(\n      /You may need an appropriate loader to handle this file type, currently no loaders are configured to process this file/\n    )\n    expect(stderr).not.toMatch(\n      /Images.*cannot.*be imported within.*pages[\\\\/]_document\\.js/\n    )\n  })","file":"integration/invalid-document-image-import/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not show error in production when mailto: is used as href on Link","suites":["Invalid hrefs","production mode"],"updatePoint":{"line":95,"column":78},"line":95,"code":"    it('does not show error in production when mailto: is used as href on Link', async () => {\n      await noError('/first')\n    })","file":"integration/invalid-href/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not show error in production when https://google.com is used as href on Link","suites":["Invalid hrefs","production mode"],"updatePoint":{"line":99,"column":89},"line":99,"code":"    it('does not show error in production when https://google.com is used as href on Link', async () => {\n      await noError('/second')\n    })","file":"integration/invalid-href/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not show error when internal href is used with external as","suites":["Invalid hrefs","production mode"],"updatePoint":{"line":103,"column":71},"line":103,"code":"    it('does not show error when internal href is used with external as', async () => {\n      await noError('/invalid-relative', true)\n    })","file":"integration/invalid-href/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows error when dynamic route mismatch is used on Link","suites":["Invalid hrefs","production mode"],"updatePoint":{"line":107,"column":63},"line":107,"code":"    it('shows error when dynamic route mismatch is used on Link', async () => {\n      const browser = await webdriver(appPort, '/dynamic-route-mismatch')\n      try {\n        await browser.eval(`(function() {\n          window.caughtErrors = []\n          window.addEventListener('unhandledrejection', (error) => {\n            window.caughtErrors.push(error.reason.message)\n          })\n        })()`)\n        await browser.elementByCss('a').click()\n        await waitFor(500)\n        const errors = await browser.eval('window.caughtErrors')\n        expect(\n          errors.find((err) =>\n            err.includes(\n              'The provided `as` value (/blog/post-1) is incompatible with the `href` value (/[post]). Read more: https://nextjs.org/docs/messages/incompatible-href-as'\n            )\n          )\n        ).toBeTruthy()\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/invalid-href/test/index.test.js","skipped":false,"dir":"test"},{"name":"doesn't fail on invalid url","suites":["Invalid hrefs","production mode"],"updatePoint":{"line":131,"column":35},"line":131,"code":"    it(\"doesn't fail on invalid url\", async () => {\n      await noError('/third')\n    })","file":"integration/invalid-href/test/index.test.js","skipped":false,"dir":"test"},{"name":"renders a link with invalid href","suites":["Invalid hrefs","production mode"],"updatePoint":{"line":135,"column":40},"line":135,"code":"    it('renders a link with invalid href', async () => {\n      const res = await fetchViaHTTP(appPort, '/third')\n      const $ = cheerio.load(await res.text())\n      expect($('#click-me').attr('href')).toBe('https://')\n    })","file":"integration/invalid-href/test/index.test.js","skipped":false,"dir":"test"},{"name":"renders a link with mailto: href","suites":["Invalid hrefs","production mode"],"updatePoint":{"line":141,"column":40},"line":141,"code":"    it('renders a link with mailto: href', async () => {\n      const res = await fetchViaHTTP(appPort, '/first')\n      const $ = cheerio.load(await res.text())\n      expect($('#click-me').attr('href')).toBe('mailto:idk@idk.com')\n    })","file":"integration/invalid-href/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not show error when mailto: is used as href on Link","suites":["Invalid hrefs","dev mode"],"updatePoint":{"line":155,"column":64},"line":155,"code":"    it('does not show error when mailto: is used as href on Link', async () => {\n      await noError('/first')\n    })","file":"integration/invalid-href/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not show error when https://google.com is used as href on Link","suites":["Invalid hrefs","dev mode"],"updatePoint":{"line":159,"column":75},"line":159,"code":"    it('does not show error when https://google.com is used as href on Link', async () => {\n      await noError('/second')\n    })","file":"integration/invalid-href/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows error when dynamic route mismatch is used on Link","suites":["Invalid hrefs","dev mode"],"updatePoint":{"line":163,"column":63},"line":163,"code":"    it('shows error when dynamic route mismatch is used on Link', async () => {\n      await showsError(\n        '/dynamic-route-mismatch',\n        /The provided `as` value \\(\\/blog\\/post-1\\) is incompatible with the `href` value \\(\\/\\[post\\]\\)/,\n        true\n      )\n    })","file":"integration/invalid-href/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows error when internal href is used with external as","suites":["Invalid hrefs","dev mode"],"updatePoint":{"line":171,"column":63},"line":171,"code":"    it('shows error when internal href is used with external as', async () => {\n      await showsError(\n        '/invalid-relative',\n        /Invalid href: \"\\/second\" and as: \"mailto:hello@example\\.com\", received relative href and external as/,\n        true\n      )\n    })","file":"integration/invalid-href/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not throw error when dynamic route mismatch is used on Link and params are manually provided","suites":["Invalid hrefs","dev mode"],"updatePoint":{"line":179,"column":105},"line":179,"code":"    it('does not throw error when dynamic route mismatch is used on Link and params are manually provided', async () => {\n      await noError('/dynamic-route-mismatch-manual', true)\n    })","file":"integration/invalid-href/test/index.test.js","skipped":false,"dir":"test"},{"name":"doesn't fail on invalid url","suites":["Invalid hrefs","dev mode"],"updatePoint":{"line":183,"column":35},"line":183,"code":"    it(\"doesn't fail on invalid url\", async () => {\n      await noError('/third')\n    })","file":"integration/invalid-href/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows warning when dynamic route mismatch is used on Link","suites":["Invalid hrefs","dev mode"],"updatePoint":{"line":187,"column":65},"line":187,"code":"    it('shows warning when dynamic route mismatch is used on Link', async () => {\n      await showsError(\n        '/dynamic-route-mismatch',\n        /Mismatching `as` and `href` failed to manually provide the params: post in the `href`'s `query`/,\n        true,\n        true\n      )\n    })","file":"integration/invalid-href/test/index.test.js","skipped":false,"dir":"test"},{"name":"should error when source length is exceeded","suites":[],"updatePoint":{"line":30,"column":49},"line":30,"code":"  it('should error when source length is exceeded', async () => {\n    await writeMiddleware([{ source: `/${Array(4096).join('a')}` }])\n    const stderr = await getStderr()\n    expect(stderr).toContain(\n      '`source` exceeds max built length of 4096 for route {\"source\":\"/aaaaaaaaaaaaaaaaaa'\n    )\n  })","file":"integration/invalid-middleware-matchers/test/index.test.js","skipped":false,"dir":"test"},{"name":"should error during next build for invalid matchers","suites":[],"updatePoint":{"line":38,"column":57},"line":38,"code":"  it('should error during next build for invalid matchers', async () => {\n    await writeMiddleware([\n      {\n        // missing source\n      },\n      {\n        // invalid source\n        source: 123,\n      },\n      // missing forward slash in source\n      'hello',\n      {\n        // extra field\n        source: '/hello',\n        destination: '/not-allowed',\n      },\n\n      // invalid objects\n      null,\n      // invalid has items\n      {\n        source: '/hello',\n        has: [\n          {\n            type: 'cookiee',\n            key: 'loggedIn',\n          },\n        ],\n      },\n      {\n        source: '/hello',\n        has: [\n          {\n            type: 'headerr',\n          },\n          {\n            type: 'queryr',\n            key: 'hello',\n          },\n        ],\n      },\n      {\n        source: '/hello',\n        basePath: false,\n      },\n      {\n        source: '/hello',\n        locale: true,\n      },\n    ])\n    const stderr = await getStderr()\n\n    expect(stderr).toContain(`\\`source\\` is missing for route {}`)\n\n    expect(stderr).toContain(\n      `\\`source\\` is not a string for route {\"source\":123}`\n    )\n\n    expect(stderr).toContain(\n      `\\`source\\` does not start with / for route {\"source\":\"hello\"}`\n    )\n\n    expect(stderr).toContain(\n      `invalid field: destination for route {\"source\":\"/hello\",\"destination\":\"/not-allowed\"}`\n    )\n\n    expect(stderr).toContain(\n      `The route null is not a valid object with \\`source\\``\n    )\n\n    expect(stderr).toContain('Invalid `has` item:')\n    expect(stderr).toContain(\n      `invalid type \"cookiee\" for {\"type\":\"cookiee\",\"key\":\"loggedIn\"}`\n    )\n    expect(stderr).toContain(\n      `invalid \\`has\\` item found for route {\"source\":\"/hello\",\"has\":[{\"type\":\"cookiee\",\"key\":\"loggedIn\"}]}`\n    )\n\n    expect(stderr).toContain('Invalid `has` items:')\n    expect(stderr).toContain(\n      `invalid type \"headerr\", invalid key \"undefined\" for {\"type\":\"headerr\"}`\n    )\n    expect(stderr).toContain(\n      `invalid type \"queryr\" for {\"type\":\"queryr\",\"key\":\"hello\"}`\n    )\n    expect(stderr).toContain(\n      `invalid \\`has\\` items found for route {\"source\":\"/hello\",\"has\":[{\"type\":\"headerr\"},{\"type\":\"queryr\",\"key\":\"hello\"}]}`\n    )\n    expect(stderr).toContain(`Valid \\`has\\` object shape is {`)\n    expect(stderr).toContain(\n      `invalid field: basePath for route {\"source\":\"/hello\",\"basePath\":false}`\n    )\n    expect(stderr).toContain(\n      '`locale` must be undefined or false for route {\"source\":\"/hello\",\"locale\":true}'\n    )\n  })","file":"integration/invalid-middleware-matchers/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show error for invalid mulit-match","suites":[],"updatePoint":{"line":19,"column":47},"line":19,"code":"  it('should show error for invalid mulit-match', async () => {\n    await renderViaHTTP(appPort, '/random')\n    expect(stderr).toContain(\n      'To use a multi-match in the destination you must add'\n    )\n    expect(stderr).toContain(\n      'https://nextjs.org/docs/messages/invalid-multi-match'\n    )\n  })","file":"integration/invalid-multi-match/test/index.test.js","skipped":false,"dir":"test"},{"name":"Fails softly with descriptive error","suites":["Invalid Page automatic static optimization"],"updatePoint":{"line":10,"column":41},"line":10,"code":"  it('Fails softly with descriptive error', async () => {\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n\n    expect(stderr).toMatch(\n      /Build optimization failed: found pages without a React Component as default export in/\n    )\n    expect(stderr).toMatch(/pages\\/invalid/)\n    expect(stderr).toMatch(/pages\\/also-invalid/)\n  })","file":"integration/invalid-page-automatic-static-optimization/test/index.test.js","skipped":false,"dir":"test"},{"name":"handles non-error correctly","suites":["Invalid Page automatic static optimization"],"updatePoint":{"line":20,"column":33},"line":20,"code":"  it('handles non-error correctly', async () => {\n    const testPage = path.join(appDir, 'pages/[slug].js')\n    await fs.rename(path.join(appDir, 'pages'), path.join(appDir, 'pages-bak'))\n\n    await fs.ensureDir(path.join(appDir, 'pages'))\n    await fs.writeFile(\n      testPage,\n      `\n      export default function Page() {\n        return <p>hello world</p>\n      }\n      \n      export function getStaticPaths() {\n        throw 'invalid API token'\n      }\n      \n      export function getStaticProps() {\n        return {\n          props: {\n            hello: 'world'\n          }\n        }\n      }\n    `\n    )\n\n    try {\n      const { stderr } = await nextBuild(appDir, [], { stderr: true })\n      expect(stderr).toMatch(/invalid API token/)\n      expect(stderr).not.toMatch(/without a React Component/)\n    } finally {\n      await fs.remove(path.join(appDir, 'pages'))\n      await fs.rename(\n        path.join(appDir, 'pages-bak'),\n        path.join(appDir, 'pages')\n      )\n    }\n  })","file":"integration/invalid-page-automatic-static-optimization/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show error initially","suites":["Invalid revalidate values"],"updatePoint":{"line":30,"column":37},"line":30,"code":"  it('should not show error initially', async () => {\n    const html = await renderViaHTTP(appPort, '/ssg')\n    expect(html).toContain('a-ok')\n  })","file":"integration/invalid-revalidate-values/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show error for false revalidate value","suites":["Invalid revalidate values"],"updatePoint":{"line":35,"column":54},"line":35,"code":"  it('should not show error for false revalidate value', async () => {\n    pageFile.replace('revalidate: 1', 'revalidate: false')\n\n    try {\n      for (let i = 0; i < 3; i++) {\n        await waitFor(1000)\n        const html = await renderViaHTTP(appPort, '/ssg')\n        expect(html).toContain('a-ok')\n      }\n    } finally {\n      pageFile.restore()\n    }\n  })","file":"integration/invalid-revalidate-values/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show error for true revalidate value","suites":["Invalid revalidate values"],"updatePoint":{"line":49,"column":53},"line":49,"code":"  it('should not show error for true revalidate value', async () => {\n    pageFile.replace('revalidate: 1', 'revalidate: true')\n\n    try {\n      for (let i = 0; i < 3; i++) {\n        await waitFor(1000)\n        const html = await renderViaHTTP(appPort, '/ssg')\n        expect(html).toContain('a-ok')\n      }\n    } finally {\n      pageFile.restore()\n    }\n  })","file":"integration/invalid-revalidate-values/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show error for string revalidate value","suites":["Invalid revalidate values"],"updatePoint":{"line":63,"column":51},"line":63,"code":"  it('should show error for string revalidate value', async () => {\n    pageFile.replace('revalidate: 1', 'revalidate: \"1\"')\n\n    try {\n      await check(\n        () => renderViaHTTP(appPort, '/ssg'),\n        /A page's revalidate option must be seconds expressed as a natural number. Mixed numbers and strings cannot be used. Received/\n      )\n    } finally {\n      pageFile.restore()\n    }\n  })","file":"integration/invalid-revalidate-values/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show error for null revalidate value","suites":["Invalid revalidate values"],"updatePoint":{"line":76,"column":49},"line":76,"code":"  it('should show error for null revalidate value', async () => {\n    pageFile.replace('revalidate: 1', 'revalidate: null')\n\n    try {\n      await check(\n        () => renderViaHTTP(appPort, '/ssg'),\n        /A page's revalidate option must be seconds expressed as a natural number. Mixed numbers and strings cannot be used. Received/\n      )\n    } finally {\n      pageFile.restore()\n    }\n  })","file":"integration/invalid-revalidate-values/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show error for float revalidate value","suites":["Invalid revalidate values"],"updatePoint":{"line":89,"column":50},"line":89,"code":"  it('should show error for float revalidate value', async () => {\n    pageFile.replace('revalidate: 1', 'revalidate: 1.1')\n\n    try {\n      await check(\n        () => renderViaHTTP(appPort, '/ssg'),\n        /A page's revalidate option must be seconds expressed as a natural number for \\/ssg. Mixed numbers, such as/\n      )\n    } finally {\n      pageFile.restore()\n    }\n  })","file":"integration/invalid-revalidate-values/test/index.test.js","skipped":false,"dir":"test"},{"name":"next() called with no parameters should throw error","suites":["Invalid server options"],"updatePoint":{"line":8,"column":59},"line":8,"code":"  test('next() called with no parameters should throw error', () => {\n    expect(() => next()).toThrowError(\n      'The server has not been instantiated properly. https://nextjs.org/docs/messages/invalid-server-options'\n    )\n  })","file":"integration/invalid-server-options/test/index.test.js","skipped":false,"dir":"test"},{"name":"next() called with undefined parameter should throw error","suites":["Invalid server options"],"updatePoint":{"line":14,"column":65},"line":14,"code":"  test('next() called with undefined parameter should throw error', () => {\n    expect(() => next(undefined)).toThrowError(\n      'The server has not been instantiated properly. https://nextjs.org/docs/messages/invalid-server-options'\n    )\n  })","file":"integration/invalid-server-options/test/index.test.js","skipped":false,"dir":"test"},{"name":"next() called with null parameter should throw error","suites":["Invalid server options"],"updatePoint":{"line":20,"column":60},"line":20,"code":"  test('next() called with null parameter should throw error', () => {\n    expect(() => next(null)).toThrowError(\n      'The server has not been instantiated properly. https://nextjs.org/docs/messages/invalid-server-options'\n    )\n  })","file":"integration/invalid-server-options/test/index.test.js","skipped":false,"dir":"test"},{"name":"next() called with dev as string should send warning","suites":["Invalid server options"],"updatePoint":{"line":26,"column":60},"line":26,"code":"  test('next() called with dev as string should send warning', () => {\n    const consoleSpy = jest.spyOn(console, 'warn')\n    const dev = 'string'\n    next({ dev, dir })\n\n    expect(consoleSpy).toHaveBeenCalledWith(warningMessage)\n  })","file":"integration/invalid-server-options/test/index.test.js","skipped":false,"dir":"test"},{"name":"next() called with dev as number should send warning","suites":["Invalid server options"],"updatePoint":{"line":34,"column":60},"line":34,"code":"  test('next() called with dev as number should send warning', () => {\n    const consoleSpy = jest.spyOn(console, 'warn')\n    const dev = 123\n    next({ dev, dir })\n\n    expect(consoleSpy).toHaveBeenCalledWith(warningMessage)\n  })","file":"integration/invalid-server-options/test/index.test.js","skipped":false,"dir":"test"},{"name":"next() called with dev as array should send warning","suites":["Invalid server options"],"updatePoint":{"line":42,"column":59},"line":42,"code":"  test('next() called with dev as array should send warning', () => {\n    const consoleSpy = jest.spyOn(console, 'warn')\n    const dev = ['array']\n    next({ dev, dir })\n\n    expect(consoleSpy).toHaveBeenCalledWith(warningMessage)\n  })","file":"integration/invalid-server-options/test/index.test.js","skipped":false,"dir":"test"},{"name":"next() called with dev as object should send warning","suites":["Invalid server options"],"updatePoint":{"line":50,"column":60},"line":50,"code":"  test('next() called with dev as object should send warning', () => {\n    const consoleSpy = jest.spyOn(console, 'warn')\n    const dev = { test: 'goes here' }\n    next({ dev, dir })\n\n    expect(consoleSpy).toHaveBeenCalledWith(warningMessage)\n  })","file":"integration/invalid-server-options/test/index.test.js","skipped":false,"dir":"test"},{"name":"next() called with dev as function should send warning","suites":["Invalid server options"],"updatePoint":{"line":58,"column":62},"line":58,"code":"  test('next() called with dev as function should send warning', () => {\n    const consoleSpy = jest.spyOn(console, 'warn')\n    const dev = () => console.log('test')\n    next({ dev, dir })\n\n    expect(consoleSpy).toHaveBeenCalledWith(warningMessage)\n  })","file":"integration/invalid-server-options/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page","suites":["TypeScript Features","default behavior"],"updatePoint":{"line":41,"column":30},"line":41,"code":"    it('should render the page', async () => {\n      const $ = await get$('/hello')\n      expect($('body').text()).toMatch(/World/)\n    })","file":"integration/jsconfig-baseurl/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct module not found error","suites":["TypeScript Features","default behavior"],"updatePoint":{"line":46,"column":50},"line":46,"code":"    it('should have correct module not found error', async () => {\n      const basicPage = join(appDir, 'pages/hello.js')\n      const contents = await fs.readFile(basicPage, 'utf8')\n\n      await fs.writeFile(\n        basicPage,\n        contents.replace('components/world', 'components/worldd')\n      )\n      await renderViaHTTP(appPort, '/hello')\n\n      const found = await check(\n        () => output,\n        /Module not found: Can't resolve 'components\\/worldd'/,\n        false\n      )\n      await fs.writeFile(basicPage, contents)\n      expect(found).toBe(true)\n    })","file":"integration/jsconfig-baseurl/test/index.test.js","skipped":false,"dir":"test"},{"name":"should trace correctly","suites":["TypeScript Features","should build"],"updatePoint":{"line":70,"column":30},"line":70,"code":"    it('should trace correctly', async () => {\n      const helloTrace = await fs.readJSON(\n        join(appDir, '.next/server/pages/hello.js.nft.json')\n      )\n      const appTrace = await fs.readJSON(\n        join(appDir, '.next/server/pages/_app.js.nft.json')\n      )\n      expect(\n        appTrace.files.some((file) => file.includes('node_modules/next'))\n      ).toBe(true)\n      expect(\n        helloTrace.files.some((file) => file.includes('components/world.js'))\n      ).toBe(false)\n      expect(\n        helloTrace.files.some((file) => file.includes('react/index.js'))\n      ).toBe(true)\n    })","file":"integration/jsconfig-baseurl/test/index.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["Empty JSConfig Support"],"updatePoint":{"line":8,"column":35},"line":8,"code":"  test('should compile successfully', async () => {\n    const { code, stdout } = await nextBuild(appDir, [], {\n      stdout: true,\n    })\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/jsconfig-empty/test/index.test.js","skipped":false,"dir":"test"},{"name":"should alias components","suites":["default behavior"],"updatePoint":{"line":44,"column":31},"line":44,"code":"    it('should alias components', async () => {\n      const $ = await get$('/basic-alias')\n      expect($('body').text()).toMatch(/World/)\n    })","file":"integration/jsconfig-paths/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve the first item in the array first","suites":["default behavior"],"updatePoint":{"line":49,"column":56},"line":49,"code":"    it('should resolve the first item in the array first', async () => {\n      const $ = await get$('/resolve-order')\n      expect($('body').text()).toMatch(/Hello from a/)\n    })","file":"integration/jsconfig-paths/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve the second item as fallback","suites":["default behavior"],"updatePoint":{"line":54,"column":50},"line":54,"code":"    it('should resolve the second item as fallback', async () => {\n      const $ = await get$('/resolve-fallback')\n      expect($('body').text()).toMatch(/Hello from only b/)\n    })","file":"integration/jsconfig-paths/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve a single matching alias","suites":["default behavior"],"updatePoint":{"line":59,"column":46},"line":59,"code":"    it('should resolve a single matching alias', async () => {\n      const $ = await get$('/single-alias')\n      expect($('body').text()).toMatch(/Hello/)\n    })","file":"integration/jsconfig-paths/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve a wildcard alias","suites":["default behavior"],"updatePoint":{"line":64,"column":39},"line":64,"code":"    it('should resolve a wildcard alias', async () => {\n      const $ = await get$('/wildcard-alias')\n      expect($('body').text()).toMatch(/world/)\n    })","file":"integration/jsconfig-paths/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct module not found error","suites":["default behavior"],"updatePoint":{"line":69,"column":50},"line":69,"code":"    it('should have correct module not found error', async () => {\n      const basicPage = join(appDir, 'pages/basic-alias.js')\n      const contents = await fs.readFile(basicPage, 'utf8')\n\n      await fs.writeFile(basicPage, contents.replace('@c/world', '@c/worldd'))\n      await renderViaHTTP(appPort, '/basic-alias')\n\n      const found = await check(\n        () => output,\n        /Module not found: Can't resolve '@c\\/worldd'/,\n        false\n      )\n      await fs.writeFile(basicPage, contents)\n      expect(found).toBe(true)\n    })","file":"integration/jsconfig-paths/test/index.test.js","skipped":false,"dir":"test"},{"name":"should trace correctly","suites":["should build"],"updatePoint":{"line":90,"column":30},"line":90,"code":"    it('should trace correctly', async () => {\n      const appTrace = await fs.readJSON(\n        join(appDir, '.next/server/pages/_app.js.nft.json')\n      )\n      const singleAliasTrace = await fs.readJSON(\n        join(appDir, '.next/server/pages/single-alias.js.nft.json')\n      )\n      const wildcardAliasTrace = await fs.readJSON(\n        join(appDir, '.next/server/pages/wildcard-alias.js.nft.json')\n      )\n      const resolveOrderTrace = await fs.readJSON(\n        join(appDir, '.next/server/pages/resolve-order.js.nft.json')\n      )\n      const resolveFallbackTrace = await fs.readJSON(\n        join(appDir, '.next/server/pages/resolve-fallback.js.nft.json')\n      )\n      const basicAliasTrace = await fs.readJSON(\n        join(appDir, '.next/server/pages/basic-alias.js.nft.json')\n      )\n      expect(\n        appTrace.files.some((file) => file.includes('node_modules/next'))\n      ).toBe(true)\n      expect(\n        singleAliasTrace.files.some((file) =>\n          file.includes('components/hello.js')\n        )\n      ).toBe(false)\n      expect(\n        wildcardAliasTrace.files.some((file) =>\n          file.includes('mypackage/myfile.js')\n        )\n      ).toBe(true)\n      expect(\n        wildcardAliasTrace.files.some((file) =>\n          file.includes('mypackage/data.js')\n        )\n      ).toBe(false)\n      expect(\n        resolveOrderTrace.files.some((file) => file.includes('lib/a/api.js'))\n      ).toBe(false)\n      expect(\n        resolveOrderTrace.files.some((file) =>\n          file.includes('mypackage/data.js')\n        )\n      ).toBe(true)\n      expect(\n        resolveFallbackTrace.files.some((file) =>\n          file.includes('lib/b/b-only.js')\n        )\n      ).toBe(false)\n      expect(\n        basicAliasTrace.files.some((file) =>\n          file.includes('components/world.js')\n        )\n      ).toBe(false)\n    })","file":"integration/jsconfig-paths/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build normally","suites":["jsconfig.json"],"updatePoint":{"line":10,"column":27},"line":10,"code":"  it('should build normally', async () => {\n    const res = await await nextBuild(appDir, [], { stdout: true })\n    expect(res.stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/jsconfig/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail on invalid jsconfig.json","suites":["jsconfig.json"],"updatePoint":{"line":15,"column":42},"line":15,"code":"  it('should fail on invalid jsconfig.json', async () => {\n    const jsconfigPath = join(appDir, 'jsconfig.json')\n    const originalJsconfig = await fs.readFile(jsconfigPath, {\n      encoding: 'utf-8',\n    })\n    await fs.writeFile(jsconfigPath, '{', {\n      encoding: 'utf-8',\n    })\n    try {\n      const res = await nextBuild(appDir, [], { stderr: true })\n      expect(res.stderr).toMatch(/Error: Failed to parse \"/)\n      expect(res.stderr).toMatch(/JSON5: invalid end of input at 1:2/)\n    } finally {\n      await fs.writeFile(jsconfigPath, originalJsconfig, {\n        encoding: 'utf-8',\n      })\n    }\n  })","file":"integration/jsconfig/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail with original error","suites":["JSON Serialization"],"updatePoint":{"line":10,"column":39},"line":10,"code":"  test('should fail with original error', async () => {\n    const { code, stderr } = await nextBuild(appDir, [], { stderr: true })\n    expect(code).toBe(1)\n    expect(stderr).toContain('Do not know how to serialize a BigInt')\n  })","file":"integration/json-serialize-original-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should support `node-gently` packages","suites":["Legacy Packages"],"updatePoint":{"line":31,"column":43},"line":31,"code":"  it('should support `node-gently` packages', async () => {\n    const res = await renderViaHTTP(appPort, '/api/hello')\n    expect(res).toMatch(/hello world/i)\n  })","file":"integration/legacy-pkg-gently/test/index.test.js","skipped":false,"dir":"test"},{"name":"should error when legacy unstable_getStaticProps","suites":[],"updatePoint":{"line":29,"column":54},"line":29,"code":"  it('should error when legacy unstable_getStaticProps', async () => {\n    const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n    expect(code).toBe(1)\n    expect(stderr).toContain(\n      `unstable_getStaticProps was replaced with getStaticProps. Please update your code.`\n    )\n  })","file":"integration/legacy-ssg-methods-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should error when legacy unstable_getServerProps","suites":[],"updatePoint":{"line":37,"column":54},"line":37,"code":"  it('should error when legacy unstable_getServerProps', async () => {\n    await fs.writeFile(\n      indexPage,\n      origIndexPage.replace('getStaticProps', 'getServerProps')\n    )\n\n    const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n\n    expect(code).toBe(1)\n    expect(stderr).toContain(\n      `unstable_getServerProps was replaced with getServerSideProps. Please update your code.`\n    )\n  })","file":"integration/legacy-ssg-methods-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should error when legacy unstable_getStaticPaths","suites":[],"updatePoint":{"line":51,"column":54},"line":51,"code":"  it('should error when legacy unstable_getStaticPaths', async () => {\n    await fs.writeFile(\n      indexPage,\n      origIndexPage.replace('getStaticProps', 'getStaticPaths')\n    )\n\n    const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n\n    expect(code).toBe(1)\n    expect(stderr).toContain(\n      `unstable_getStaticPaths was replaced with getStaticPaths. Please update your code.`\n    )\n  })","file":"integration/legacy-ssg-methods-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have a race condition with a click handler","suites":[],"updatePoint":{"line":53,"column":59},"line":53,"code":"  it('should not have a race condition with a click handler', async () => {\n    const browser = await webdriver(appPort, '/click-away-race-condition')\n    await browser.elementByCss('#click-me').click()\n    await browser.waitForElementByCss('#the-menu')\n  })","file":"integration/link-ref/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show error for function component with forwardRef","suites":["Invalid hrefs","dev mode"],"updatePoint":{"line":70,"column":68},"line":70,"code":"    it('should not show error for function component with forwardRef', async () => {\n      await noError('/function')\n    })","file":"integration/link-ref/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show error for class component as child of next/link","suites":["Invalid hrefs","dev mode"],"updatePoint":{"line":74,"column":71},"line":74,"code":"    it('should not show error for class component as child of next/link', async () => {\n      await noError('/class')\n    })","file":"integration/link-ref/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle child ref with React.createRef","suites":["Invalid hrefs","dev mode"],"updatePoint":{"line":78,"column":52},"line":78,"code":"    it('should handle child ref with React.createRef', async () => {\n      await noError('/child-ref')\n    })","file":"integration/link-ref/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle child ref that is a function","suites":["Invalid hrefs","dev mode"],"updatePoint":{"line":82,"column":50},"line":82,"code":"    it('should handle child ref that is a function', async () => {\n      await noError('/child-ref-func')\n    })","file":"integration/link-ref/test/index.test.js","skipped":false,"dir":"test"},{"name":"should preload with forwardRef","suites":["Invalid hrefs","production mode"],"updatePoint":{"line":97,"column":38},"line":97,"code":"    it('should preload with forwardRef', async () => {\n      await didPrefetch('/function')\n    })","file":"integration/link-ref/test/index.test.js","skipped":false,"dir":"test"},{"name":"should preload with child ref with React.createRef","suites":["Invalid hrefs","production mode"],"updatePoint":{"line":101,"column":58},"line":101,"code":"    it('should preload with child ref with React.createRef', async () => {\n      await didPrefetch('/child-ref')\n    })","file":"integration/link-ref/test/index.test.js","skipped":false,"dir":"test"},{"name":"should preload with child ref with function","suites":["Invalid hrefs","production mode"],"updatePoint":{"line":105,"column":51},"line":105,"code":"    it('should preload with child ref with function', async () => {\n      await didPrefetch('/child-ref-func')\n    })","file":"integration/link-ref/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on SSR","suites":["Link Component with Encoding","spaces"],"updatePoint":{"line":20,"column":40},"line":20,"code":"    it('should have correct query on SSR', async () => {\n      const browser = await webdriver(\n        appPort,\n        encodeURI('/single/hello world ')\n      )\n      try {\n        const text = await browser.elementByCss('#query-content').text()\n        expect(text).toMatchInlineSnapshot(`\"{\\\\\"slug\\\\\":\\\\\"hello world \\\\\"}\"`)\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/link-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on Router#push","suites":["Link Component with Encoding","spaces"],"updatePoint":{"line":33,"column":48},"line":33,"code":"    it('should have correct query on Router#push', async () => {\n      const browser = await webdriver(appPort, '/')\n      try {\n        await waitFor(2000)\n        await browser.eval(\n          `window.next.router.push(\n            { pathname: '/single/[slug]' },\n            { pathname: encodeURI('/single/hello world ') }\n          )`\n        )\n        await check(() => browser.hasElementByCssSelector('#query-content'), {\n          test(val) {\n            return Boolean(val)\n          },\n        })\n        const text = await browser.elementByCss('#query-content').text()\n        expect(text).toMatchInlineSnapshot(`\"{\\\\\"slug\\\\\":\\\\\"hello world \\\\\"}\"`)\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/link-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on simple client-side <Link>","suites":["Link Component with Encoding","spaces"],"updatePoint":{"line":55,"column":62},"line":55,"code":"    it('should have correct query on simple client-side <Link>', async () => {\n      const browser = await webdriver(appPort, '/')\n      try {\n        await waitFor(2000)\n        await browser.elementByCss('#single-spaces').click()\n        await check(() => browser.hasElementByCssSelector('#query-content'), {\n          test(val) {\n            return Boolean(val)\n          },\n        })\n        const text = await browser.elementByCss('#query-content').text()\n        expect(text).toMatchInlineSnapshot(`\"{\\\\\"slug\\\\\":\\\\\"hello world \\\\\"}\"`)\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/link-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on SSR","suites":["Link Component with Encoding","percent"],"updatePoint":{"line":74,"column":40},"line":74,"code":"    it('should have correct query on SSR', async () => {\n      const browser = await webdriver(appPort, encodeURI('/single/hello%world'))\n      try {\n        const text = await browser.elementByCss('#query-content').text()\n        expect(text).toMatchInlineSnapshot(`\"{\\\\\"slug\\\\\":\\\\\"hello%world\\\\\"}\"`)\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/link-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on Router#push","suites":["Link Component with Encoding","percent"],"updatePoint":{"line":84,"column":48},"line":84,"code":"    it('should have correct query on Router#push', async () => {\n      const browser = await webdriver(appPort, '/')\n      try {\n        await waitFor(2000)\n        await browser.eval(\n          `window.next.router.push(\n            { pathname: '/single/[slug]' },\n            { pathname: encodeURI('/single/hello%world') }\n          )`\n        )\n        await check(() => browser.hasElementByCssSelector('#query-content'), {\n          test(val) {\n            return Boolean(val)\n          },\n        })\n        const text = await browser.elementByCss('#query-content').text()\n        expect(text).toMatchInlineSnapshot(`\"{\\\\\"slug\\\\\":\\\\\"hello%world\\\\\"}\"`)\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/link-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on simple client-side <Link>","suites":["Link Component with Encoding","percent"],"updatePoint":{"line":106,"column":62},"line":106,"code":"    it('should have correct query on simple client-side <Link>', async () => {\n      const browser = await webdriver(appPort, '/')\n      try {\n        await waitFor(2000)\n        await browser.elementByCss('#single-percent').click()\n        await check(() => browser.hasElementByCssSelector('#query-content'), {\n          test(val) {\n            return Boolean(val)\n          },\n        })\n        const text = await browser.elementByCss('#query-content').text()\n        expect(text).toMatchInlineSnapshot(`\"{\\\\\"slug\\\\\":\\\\\"hello%world\\\\\"}\"`)\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/link-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on SSR","suites":["Link Component with Encoding","forward slash"],"updatePoint":{"line":125,"column":40},"line":125,"code":"    it('should have correct query on SSR', async () => {\n      const browser = await webdriver(\n        appPort,\n        `/single/hello${encodeURIComponent('/')}world`\n      )\n      try {\n        const text = await browser.elementByCss('#query-content').text()\n        expect(text).toMatchInlineSnapshot(`\"{\\\\\"slug\\\\\":\\\\\"hello/world\\\\\"}\"`)\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/link-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on Router#push","suites":["Link Component with Encoding","forward slash"],"updatePoint":{"line":138,"column":48},"line":138,"code":"    it('should have correct query on Router#push', async () => {\n      const browser = await webdriver(appPort, '/')\n      try {\n        await waitFor(2000)\n        await browser.eval(\n          `window.next.router.push(\n            { pathname: '/single/[slug]' },\n            { pathname: '/single/hello${encodeURIComponent('/')}world' }\n          )`\n        )\n        await check(() => browser.hasElementByCssSelector('#query-content'), {\n          test(val) {\n            return Boolean(val)\n          },\n        })\n        const text = await browser.elementByCss('#query-content').text()\n        expect(text).toMatchInlineSnapshot(`\"{\\\\\"slug\\\\\":\\\\\"hello/world\\\\\"}\"`)\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/link-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on simple client-side <Link>","suites":["Link Component with Encoding","forward slash"],"updatePoint":{"line":160,"column":62},"line":160,"code":"    it('should have correct query on simple client-side <Link>', async () => {\n      const browser = await webdriver(appPort, '/')\n      try {\n        await waitFor(2000)\n        await browser.elementByCss('#single-slash').click()\n        await check(() => browser.hasElementByCssSelector('#query-content'), {\n          test(val) {\n            return Boolean(val)\n          },\n        })\n        const text = await browser.elementByCss('#query-content').text()\n        expect(text).toMatchInlineSnapshot(`\"{\\\\\"slug\\\\\":\\\\\"hello/world\\\\\"}\"`)\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/link-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on SSR","suites":["Link Component with Encoding","double quote"],"updatePoint":{"line":179,"column":40},"line":179,"code":"    it('should have correct query on SSR', async () => {\n      const browser = await webdriver(\n        appPort,\n        `/single/hello${encodeURIComponent('\"')}world`\n      )\n      try {\n        const text = await browser.elementByCss('#query-content').text()\n        expect(JSON.parse(text)).toMatchInlineSnapshot(`\n          Object {\n            \"slug\": \"hello\\\\\"world\",\n          }\n        `)\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/link-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on Router#push","suites":["Link Component with Encoding","double quote"],"updatePoint":{"line":196,"column":48},"line":196,"code":"    it('should have correct query on Router#push', async () => {\n      const browser = await webdriver(appPort, '/')\n      try {\n        await waitFor(2000)\n        await browser.eval(\n          `window.next.router.push(\n            { pathname: '/single/[slug]' },\n            { pathname: '/single/hello${encodeURIComponent('\"')}world' }\n          )`\n        )\n        await check(() => browser.hasElementByCssSelector('#query-content'), {\n          test(val) {\n            return Boolean(val)\n          },\n        })\n        const text = await browser.elementByCss('#query-content').text()\n        expect(JSON.parse(text)).toMatchInlineSnapshot(`\n          Object {\n            \"slug\": \"hello\\\\\"world\",\n          }\n        `)\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/link-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on simple client-side <Link>","suites":["Link Component with Encoding","double quote"],"updatePoint":{"line":222,"column":62},"line":222,"code":"    it('should have correct query on simple client-side <Link>', async () => {\n      const browser = await webdriver(appPort, '/')\n      try {\n        await waitFor(2000)\n        await browser.elementByCss('#single-double-quote').click()\n        await check(() => browser.hasElementByCssSelector('#query-content'), {\n          test(val) {\n            return Boolean(val)\n          },\n        })\n        const text = await browser.elementByCss('#query-content').text()\n        expect(JSON.parse(text)).toMatchInlineSnapshot(`\n          Object {\n            \"slug\": \"hello\\\\\"world\",\n          }\n        `)\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/link-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on SSR","suites":["Link Component with Encoding","colon"],"updatePoint":{"line":245,"column":40},"line":245,"code":"    it('should have correct query on SSR', async () => {\n      const browser = await webdriver(\n        appPort,\n        `/single/hello${encodeURIComponent(':')}world`\n      )\n      try {\n        const text = await browser.elementByCss('#query-content').text()\n        expect(text).toMatchInlineSnapshot(`\"{\\\\\"slug\\\\\":\\\\\"hello:world\\\\\"}\"`)\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/link-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on Router#push","suites":["Link Component with Encoding","colon"],"updatePoint":{"line":258,"column":48},"line":258,"code":"    it('should have correct query on Router#push', async () => {\n      const browser = await webdriver(appPort, '/')\n      try {\n        await waitFor(2000)\n        await browser.eval(\n          `window.next.router.push(\n            { pathname: '/single/[slug]' },\n            { pathname: '/single/hello${encodeURIComponent(':')}world' }\n          )`\n        )\n        await check(() => browser.hasElementByCssSelector('#query-content'), {\n          test(val) {\n            return Boolean(val)\n          },\n        })\n        const text = await browser.elementByCss('#query-content').text()\n        expect(text).toMatchInlineSnapshot(`\"{\\\\\"slug\\\\\":\\\\\"hello:world\\\\\"}\"`)\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/link-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on simple client-side <Link>","suites":["Link Component with Encoding","colon"],"updatePoint":{"line":280,"column":62},"line":280,"code":"    it('should have correct query on simple client-side <Link>', async () => {\n      const browser = await webdriver(appPort, '/')\n      try {\n        await waitFor(2000)\n        await browser.elementByCss('#single-colon').click()\n        await check(() => browser.hasElementByCssSelector('#query-content'), {\n          test(val) {\n            return Boolean(val)\n          },\n        })\n        const text = await browser.elementByCss('#query-content').text()\n        expect(text).toMatchInlineSnapshot(`\"{\\\\\"slug\\\\\":\\\\\"hello:world\\\\\"}\"`)\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/link-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct parsing of url query params","suites":["Link Component with Encoding","colon"],"updatePoint":{"line":297,"column":55},"line":297,"code":"    it('should have correct parsing of url query params', async () => {\n      const browser = await webdriver(appPort, '/')\n      try {\n        await browser.waitForElementByCss('#url-param').click()\n        const content = await browser\n          .waitForElementByCss('#query-content')\n          .text()\n        const query = JSON.parse(content)\n        expect(query).toHaveProperty('id', 'http://example.com/')\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/link-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not throw when rendered","suites":["Link without a router","dev mode"],"updatePoint":{"line":25,"column":38},"line":25,"code":"    it('should not throw when rendered', () => {\n      jest.useFakeTimers()\n\n      act(() => {\n        render(<Hello />, container)\n      })\n\n      act(() => {\n        jest.runAllTimers()\n      })\n\n      expect(container.textContent).toBe('Click me')\n    })","file":"integration/link-without-router/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not throw when rendered","suites":["Link without a router","production mode"],"updatePoint":{"line":41,"column":38},"line":41,"code":"    it('should not throw when rendered', () => {\n      jest.useFakeTimers()\n\n      act(() => {\n        render(<Hello />, container)\n      })\n\n      act(() => {\n        jest.runAllTimers()\n      })\n\n      expect(container.textContent).toBe('Click me')\n    })","file":"integration/link-without-router/test/index.test.js","skipped":false,"dir":"test"},{"name":"given a middleware $title","suites":["Middleware validation during build"],"line":16,"code":"  describe.each([\n    {\n      title: 'returning a text body',\n      code: `export default function () {\n              return new Response('this is not allowed')\n            }`,\n    },\n    {\n      title: 'building body with JSON.stringify',\n      code: `export default function () {\n              return new Response(JSON.stringify({ error: 'this is not allowed' }))\n            }`,\n    },\n    {\n      title: 'building response body with a variable',\n      code: `export default function () {\n              const body = 'this is not allowed, but hard to detect with AST'\n              return new Response(body)\n            }`,\n    },\n    {\n      title: 'building response body with custom code',\n      code: `function buildResponse() {\n              return JSON.stringify({ message: 'this is not allowed, but hard to detect with AST' })\n            }\n\n            export default function () {\n              return new Response(buildResponse())\n            }`,\n    },\n    {\n      title: 'returning a text body with NextResponse',\n      code: `import { NextResponse } from 'next/server'\n            export default function () {\n              return new NextResponse('this is not allowed')\n            }`,\n    },\n  ])('given a middleware $title', ({ code }) => {\n    beforeAll(() => writeFile(middlewareFile, code))\n\n    it('throws an error', async () => {\n      const { stderr, code } = await nextBuild(appDir, [], {\n        stderr: true,\n        stdout: true,\n      })\n      expect(stderr).toMatch(middlewareError)\n      expect(code).toBe(1)\n    })\n  })","file":"integration/middleware-build-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"throws an error","suites":["Middleware validation during build"],"updatePoint":{"line":56,"column":23},"line":56,"code":"    it('throws an error', async () => {\n      const { stderr, code } = await nextBuild(appDir, [], {\n        stderr: true,\n        stdout: true,\n      })\n      expect(stderr).toMatch(middlewareError)\n      expect(code).toBe(1)\n    })","file":"integration/middleware-build-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"given a middleware $title","suites":["Middleware validation during build"],"line":66,"code":"  describe.each([\n    {\n      title: 'returning a null body',\n      code: `export default function () {\n              return new Response(null)\n            }`,\n    },\n    {\n      title: 'returning an undefined body',\n      code: `export default function () {\n              return new Response(undefined)\n            }`,\n    },\n  ])('given a middleware $title', ({ code }) => {\n    beforeAll(() => writeFile(middlewareFile, code))\n\n    it('builds successfully', async () => {\n      const { stderr, code } = await nextBuild(appDir, [], {\n        stderr: true,\n        stdout: true,\n      })\n      expect(stderr).not.toMatch(middlewareError)\n      expect(code).toBe(0)\n    })\n  })","file":"integration/middleware-build-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"builds successfully","suites":["Middleware validation during build"],"updatePoint":{"line":82,"column":27},"line":82,"code":"    it('builds successfully', async () => {\n      const { stderr, code } = await nextBuild(appDir, [], {\n        stderr: true,\n        stdout: true,\n      })\n      expect(stderr).not.toMatch(middlewareError)\n      expect(code).toBe(0)\n    })","file":"integration/middleware-build-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"logs the error correctly","suites":["Middleware development errors","when middleware throws synchronously"],"updatePoint":{"line":56,"column":32},"line":56,"code":"    it('logs the error correctly', async () => {\n      await fetchViaHTTP(context.appPort, '/')\n      const output = stripAnsi(context.logs.output)\n      expect(output).toMatch(\n        new RegExp(\n          `error - \\\\(middleware\\\\)/middleware.js \\\\(\\\\d+:\\\\d+\\\\) @ Object.__WEBPACK_DEFAULT_EXPORT__ \\\\[as handler\\\\]\\nerror - boom`,\n          'm'\n        )\n      )\n      expect(output).not.toContain(\n        'webpack-internal:///(middleware)/./middleware.js'\n      )\n    })","file":"integration/middleware-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"renders the error correctly and recovers","suites":["Middleware development errors","when middleware throws synchronously"],"updatePoint":{"line":70,"column":48},"line":70,"code":"    it('renders the error correctly and recovers', async () => {\n      const browser = await webdriver(context.appPort, '/')\n      expect(await hasRedbox(browser, true)).toBe(true)\n      context.middleware.write(`export default function () {}`)\n      await hasRedbox(browser, false)\n    })","file":"integration/middleware-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"logs the error correctly","suites":["Middleware development errors","when middleware contains an unhandled rejection"],"updatePoint":{"line":91,"column":32},"line":91,"code":"    it('logs the error correctly', async () => {\n      await fetchViaHTTP(context.appPort, '/')\n      const output = stripAnsi(context.logs.output)\n      expect(output).toMatch(\n        new RegExp(\n          `error - \\\\(middleware\\\\)/middleware.js \\\\(\\\\d+:\\\\d+\\\\) @ throwError\\nerror - unhandledRejection: async boom!`,\n          'm'\n        )\n      )\n      expect(output).not.toContain(\n        'webpack-internal:///(middleware)/./middleware.js'\n      )\n    })","file":"integration/middleware-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not render the error","suites":["Middleware development errors","when middleware contains an unhandled rejection"],"updatePoint":{"line":105,"column":33},"line":105,"code":"    it('does not render the error', async () => {\n      const browser = await webdriver(context.appPort, '/')\n      expect(await hasRedbox(browser, false)).toBe(false)\n      expect(await browser.elementByCss('#page-title')).toBeTruthy()\n    })","file":"integration/middleware-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"logs the error correctly","suites":["Middleware development errors","when running invalid dynamic code with eval"],"updatePoint":{"line":122,"column":32},"line":122,"code":"    it('logs the error correctly', async () => {\n      await fetchViaHTTP(context.appPort, '/')\n      const output = stripAnsi(context.logs.output)\n      expect(output).toMatch(\n        new RegExp(\n          `error - \\\\(middleware\\\\)/middleware.js \\\\(\\\\d+:\\\\d+\\\\) @ eval\\nerror - test is not defined`,\n          'm'\n        )\n      )\n      expect(output).not.toContain(\n        'webpack-internal:///(middleware)/./middleware.js'\n      )\n    })","file":"integration/middleware-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"renders the error correctly and recovers","suites":["Middleware development errors","when running invalid dynamic code with eval"],"updatePoint":{"line":136,"column":48},"line":136,"code":"    it('renders the error correctly and recovers', async () => {\n      const browser = await webdriver(context.appPort, '/')\n      expect(await hasRedbox(browser, true)).toBe(true)\n      expect(await getRedboxSource(browser)).toContain(`eval('test')`)\n      context.middleware.write(`export default function () {}`)\n      await hasRedbox(browser, false)\n    })","file":"integration/middleware-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"logs the error correctly","suites":["Middleware development errors","when throwing while loading the module"],"updatePoint":{"line":155,"column":32},"line":155,"code":"    it('logs the error correctly', async () => {\n      await fetchViaHTTP(context.appPort, '/')\n      const output = stripAnsi(context.logs.output)\n      expect(output).toMatch(\n        new RegExp(\n          `error - \\\\(middleware\\\\)/middleware.js \\\\(\\\\d+:\\\\d+\\\\) @ <unknown>\\nerror - booooom!`,\n          'm'\n        )\n      )\n      expect(output).not.toContain(\n        'webpack-internal:///(middleware)/./middleware.js'\n      )\n    })","file":"integration/middleware-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"renders the error correctly and recovers","suites":["Middleware development errors","when throwing while loading the module"],"updatePoint":{"line":169,"column":48},"line":169,"code":"    it('renders the error correctly and recovers', async () => {\n      const browser = await webdriver(context.appPort, '/')\n      expect(await hasRedbox(browser, true)).toBe(true)\n      expect(await getRedboxSource(browser)).toContain(\n        `throw new Error('booooom!')`\n      )\n      context.middleware.write(`export default function () {}`)\n      await hasRedbox(browser, false)\n    })","file":"integration/middleware-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"logs the error correctly","suites":["Middleware development errors","when there is an unhandled rejection while loading the module"],"updatePoint":{"line":193,"column":32},"line":193,"code":"    it('logs the error correctly', async () => {\n      await fetchViaHTTP(context.appPort, '/')\n      const output = stripAnsi(context.logs.output)\n      expect(output).toMatch(\n        new RegExp(\n          `error - \\\\(middleware\\\\)/middleware.js \\\\(\\\\d+:\\\\d+\\\\) @ eval\\nerror - unhandledRejection: you shall see me`,\n          'm'\n        )\n      )\n      expect(output).not.toContain(\n        'webpack-internal:///(middleware)/./middleware.js'\n      )\n    })","file":"integration/middleware-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not render the error","suites":["Middleware development errors","when there is an unhandled rejection while loading the module"],"updatePoint":{"line":207,"column":33},"line":207,"code":"    it('does not render the error', async () => {\n      const browser = await webdriver(context.appPort, '/')\n      expect(await hasRedbox(browser, false)).toBe(false)\n      expect(await browser.elementByCss('#page-title')).toBeTruthy()\n    })","file":"integration/middleware-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"logs the error correctly","suites":["Middleware development errors","when there is an unhandled rejection while loading a dependency"],"updatePoint":{"line":225,"column":32},"line":225,"code":"    it('logs the error correctly', async () => {\n      await fetchViaHTTP(context.appPort, '/')\n      const output = stripAnsi(context.logs.output)\n      expect(output).toMatch(\n        new RegExp(\n          `error - \\\\(middleware\\\\)/lib/unhandled.js \\\\(\\\\d+:\\\\d+\\\\) @ Timeout.eval \\\\[as _onTimeout\\\\]\\nerror - uncaughtException: This file asynchronously fails while loading`,\n          'm'\n        )\n      )\n      expect(output).not.toContain(\n        'webpack-internal:///(middleware)/./middleware.js'\n      )\n    })","file":"integration/middleware-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not render the error","suites":["Middleware development errors","when there is an unhandled rejection while loading a dependency"],"updatePoint":{"line":239,"column":33},"line":239,"code":"    it('does not render the error', async () => {\n      const browser = await webdriver(context.appPort, '/')\n      expect(await hasRedbox(browser, false)).toBe(false)\n      expect(await browser.elementByCss('#page-title')).toBeTruthy()\n    })","file":"integration/middleware-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"logs the error correctly","suites":["Middleware development errors","when there is a compilation error from boot"],"updatePoint":{"line":251,"column":32},"line":251,"code":"    it('logs the error correctly', async () => {\n      await fetchViaHTTP(context.appPort, '/')\n      expect(context.logs.output).toContain(`Expected '{', got '}'`)\n      expect(context.logs.output.split(`Expected '{', got '}'`).length).toEqual(\n        2\n      )\n    })","file":"integration/middleware-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"renders the error correctly and recovers","suites":["Middleware development errors","when there is a compilation error from boot"],"updatePoint":{"line":259,"column":48},"line":259,"code":"    it('renders the error correctly and recovers', async () => {\n      const browser = await webdriver(context.appPort, '/')\n      expect(await hasRedbox(browser, true)).toBe(true)\n      expect(\n        await browser\n          .elementByCss('#nextjs__container_build_error_label')\n          .text()\n      ).toEqual('Failed to compile')\n      context.middleware.write(`export default function () {}`)\n      await hasRedbox(browser, false)\n      expect(await browser.elementByCss('#page-title')).toBeTruthy()\n    })","file":"integration/middleware-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"logs the error correctly","suites":["Middleware development errors","when there is a compilation error after boot"],"updatePoint":{"line":278,"column":32},"line":278,"code":"    it('logs the error correctly', async () => {\n      await fetchViaHTTP(context.appPort, '/')\n      context.middleware.write(`export default function () }`)\n      await check(() => {\n        expect(context.logs.output).toContain(`Expected '{', got '}'`)\n        expect(\n          context.logs.output.split(`Expected '{', got '}'`).length\n        ).toEqual(2)\n        return 'success'\n      }, 'success')\n    })","file":"integration/middleware-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"renders the error correctly and recovers","suites":["Middleware development errors","when there is a compilation error after boot"],"updatePoint":{"line":290,"column":48},"line":290,"code":"    it('renders the error correctly and recovers', async () => {\n      const browser = await webdriver(context.appPort, '/')\n      expect(await hasRedbox(browser, false)).toBe(false)\n      context.middleware.write(`export default function () }`)\n      expect(await hasRedbox(browser, true)).toBe(true)\n      context.middleware.write(`export default function () {}`)\n      expect(await hasRedbox(browser, false)).toBe(false)\n      expect(await browser.elementByCss('#page-title')).toBeTruthy()\n    })","file":"integration/middleware-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"sends response correctly","suites":["Middleware development errors","when middleware is removed"],"updatePoint":{"line":61,"column":32},"line":61,"code":"    it('sends response correctly', async () => {\n      await assertMiddlewareFetch(false)\n      await assertMiddlewareRender(false)\n\n      // assert no extra message on stderr\n      expect(context.logs.stderr).toBe('')\n    })","file":"integration/middleware-dev-update/test/index.test.js","skipped":false,"dir":"test"},{"name":"sends response correctly","suites":["Middleware development errors","when middleware is removed and re-added"],"updatePoint":{"line":78,"column":32},"line":78,"code":"    it('sends response correctly', async () => {\n      await assertMiddlewareFetch(true)\n      await assertMiddlewareRender(true)\n    })","file":"integration/middleware-dev-update/test/index.test.js","skipped":false,"dir":"test"},{"name":"sends response correctly","suites":["Middleware development errors","when middleware is added"],"updatePoint":{"line":91,"column":32},"line":91,"code":"    it('sends response correctly', async () => {\n      await retry(() => assertMiddlewareFetch(true))\n      await assertMiddlewareRender(true)\n    })","file":"integration/middleware-dev-update/test/index.test.js","skipped":false,"dir":"test"},{"name":"sends response correctly","suites":["Middleware development errors","when matcher is added"],"updatePoint":{"line":120,"column":32},"line":120,"code":"    it('sends response correctly', async () => {\n      await retry(() => assertMiddlewareFetch(true, '/asdf'))\n      await retry(() => assertMiddlewareRender(true, '/asdf'))\n    })","file":"integration/middleware-dev-update/test/index.test.js","skipped":false,"dir":"test"},{"name":"warns about nested middleware being not allowed","suites":["Middleware importing Node.js modules","dev mode"],"updatePoint":{"line":43,"column":55},"line":43,"code":"    it('warns about nested middleware being not allowed', async () => {\n      const res = await fetchViaHTTP(context.appPort, '/about')\n      expect(res.status).toBe(200)\n      context.logs.stderr.includes('Nested Middleware is not allowed, found:')\n      context.logs.stderr.includes('pages/about/_middleware')\n      context.logs.stderr.includes('pages/api/_middleware')\n    })","file":"integration/middleware-nested-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"fails when there is a not allowed middleware","suites":["Middleware importing Node.js modules","production mode"],"updatePoint":{"line":53,"column":52},"line":53,"code":"    it('fails when there is a not allowed middleware', async () => {\n      const buildResult = await nextBuild(context.appDir, undefined, {\n        stderr: true,\n        stdout: true,\n      })\n      expect(buildResult.stderr).toContain(\n        'Nested Middleware is not allowed, found:'\n      )\n      expect(buildResult.stderr).toContain('pages/about/_middleware')\n      expect(buildResult.stderr).toContain('pages/api/_middleware')\n    })","file":"integration/middleware-nested-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not show a warning and allows overriding","suites":["Middleware overriding a Node.js API","dev mode"],"updatePoint":{"line":35,"column":53},"line":35,"code":"    it('does not show a warning and allows overriding', async () => {\n      const res = await fetchViaHTTP(context.appPort, '/')\n      await waitFor(500)\n      expect(res.status).toBe(200)\n      expect(output).toContain('fixed-value')\n      expect(output).not.toContain('TypeError')\n      expect(output).not.toContain('A Node.js API is used (process.env')\n      expect(output).not.toContain('A Node.js API is used (process.cwd')\n    })","file":"integration/middleware-overrides-node.js-api/test/index.test.ts","skipped":false,"dir":"test"},{"name":"prefetch correctly for unexistent routes","suites":["Middleware Production Prefetch"],"updatePoint":{"line":54,"column":46},"line":54,"code":"  it(`prefetch correctly for unexistent routes`, async () => {\n    const browser = await webdriver(context.appPort, `/`)\n    await browser.elementByCss('#made-up-link').moveTo()\n    await check(async () => {\n      const scripts = await browser.elementsByCss('script')\n      const attrs = await Promise.all(\n        scripts.map((script) => script.getAttribute('src'))\n      )\n      return attrs.find((src) => src.includes('/ssg-page')) ? 'yes' : 'nope'\n    }, 'yes')\n  })","file":"integration/middleware-prefetch/tests/index.test.js","skipped":false,"dir":"test"},{"name":"prefetches data when it is ssg","suites":["Middleware Production Prefetch"],"updatePoint":{"line":66,"column":36},"line":66,"code":"  it(`prefetches data when it is ssg`, async () => {\n    const browser = await webdriver(context.appPort, `/`)\n    await browser.elementByCss('#made-up-link').moveTo()\n    await check(async () => {\n      const hrefs = await browser.eval(`Object.keys(window.next.router.sdc)`)\n      const mapped = hrefs.map((href) =>\n        new URL(href).pathname.replace(/^\\/_next\\/data\\/[^/]+/, '')\n      )\n      assert.deepEqual(mapped, ['/index.json'])\n      return 'yes'\n    }, 'yes')\n  })","file":"integration/middleware-prefetch/tests/index.test.js","skipped":false,"dir":"test"},{"name":"prefetches provided path even if it will be rewritten","suites":["Middleware Production Prefetch"],"updatePoint":{"line":79,"column":59},"line":79,"code":"  it(`prefetches provided path even if it will be rewritten`, async () => {\n    const browser = await webdriver(context.appPort, `/`)\n    await browser.elementByCss('#ssg-page-2').moveTo()\n    await check(async () => {\n      const scripts = await browser.elementsByCss('script')\n      const attrs = await Promise.all(\n        scripts.map((script) => script.getAttribute('src'))\n      )\n      return attrs.find((src) => src.includes('/ssg-page-2')) ? 'yes' : 'nope'\n    }, 'yes')\n  })","file":"integration/middleware-prefetch/tests/index.test.js","skipped":false,"dir":"test"},{"name":"loads an runs src middleware","suites":[],"updatePoint":{"line":23,"column":34},"line":23,"code":"  it('loads an runs src middleware', async () => {\n    const response = await fetchViaHTTP(appPort, '/post-1')\n    expect(response.headers.has(srcHeader)).toBe(false)\n    expect(response.headers.has(`${srcHeader}-TS`)).toBe(true)\n  })","file":"integration/middleware-src/test/index.test.js","skipped":false,"dir":"test"},{"name":"loads and runs only root middleware","suites":[],"updatePoint":{"line":31,"column":41},"line":31,"code":"  it('loads and runs only root middleware', async () => {\n    const response = await fetchViaHTTP(appPort, '/post-1')\n    expect(response.headers.has(srcHeader)).toBe(false)\n    expect(response.headers.has(`${srcHeader}-TS`)).toBe(false)\n    expect(response.headers.has(rootHeader)).toBe(false)\n    expect(response.headers.has(`${rootHeader}-TS`)).toBe(true)\n  })","file":"integration/middleware-src/test/index.test.js","skipped":false,"dir":"test"},{"name":"$title","suites":[],"line":75,"code":"describe.each([\n  {\n    title: 'Middleware in src/ folder',\n    setup() {},\n    teardown() {},\n    runTest: runSingleMiddlewareTests,\n  },\n  {\n    title: 'Middleware in src/ and / folders',\n    setup: writeRootMiddleware,\n    teardown: removeRootMiddleware,\n    runTest: runDoubleMiddlewareTests,\n  },\n])('$title', ({ setup, teardown, runTest }) => {\n  beforeAll(() => setup())\n  afterAll(() => teardown())\n\n  describe('dev mode', () => {\n    beforeAll(async () => {\n      appPort = await findPort()\n      app = await launchApp(appDir, appPort)\n    })\n    afterAll(() => killApp(app))\n\n    runTest()\n  })\n\n  describe('production mode', () => {\n    beforeAll(async () => {\n      await nextBuild(appDir)\n      appPort = await findPort()\n      app = await nextStart(appDir, appPort)\n    })\n    afterAll(() => killApp(app))\n\n    runTest()\n  })\n})","file":"integration/middleware-src/test/index.test.js","skipped":false,"dir":"test"},{"name":"should detect missing Html component","suites":["Missing _document components error"],"updatePoint":{"line":39,"column":42},"line":39,"code":"  it('should detect missing Html component', async () => {\n    await checkMissing(\n      ['<Html />'],\n      `\n      import Document, { Head, Main, NextScript } from 'next/document'\n\n      class MyDocument extends Document {\n        render() {\n          return (\n            <html>\n              <Head />\n              <body>\n                <Main />\n                <NextScript />\n              </body>\n            </html>\n          )\n        }\n      }\n\n      export default MyDocument\n    `\n    )\n  })","file":"integration/missing-document-component-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should detect missing Head component","suites":["Missing _document components error"],"updatePoint":{"line":64,"column":42},"line":64,"code":"  it('should detect missing Head component', async () => {\n    await checkMissing(\n      ['<Head />'],\n      `\n      import Document, { Html, Main, NextScript } from 'next/document'\n\n      class MyDocument extends Document {\n        render() {\n          return (\n            <Html>\n              <body>\n                <Main />\n                <NextScript />\n              </body>\n            </Html>\n          )\n        }\n      }\n\n      export default MyDocument\n    `\n    )\n  })","file":"integration/missing-document-component-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should detect missing Main component","suites":["Missing _document components error"],"updatePoint":{"line":88,"column":42},"line":88,"code":"  it('should detect missing Main component', async () => {\n    await checkMissing(\n      ['<Main />'],\n      `\n      import Document, { Html, Head, NextScript } from 'next/document'\n\n      class MyDocument extends Document {\n        render() {\n          return (\n            <Html>\n              <Head />\n              <body>\n                <NextScript />\n              </body>\n            </Html>\n          )\n        }\n      }\n\n      export default MyDocument\n    `\n    )\n  })","file":"integration/missing-document-component-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should detect missing NextScript component","suites":["Missing _document components error"],"updatePoint":{"line":112,"column":48},"line":112,"code":"  it('should detect missing NextScript component', async () => {\n    await checkMissing(\n      ['<NextScript />'],\n      `\n      import Document, { Html, Head, Main } from 'next/document'\n\n      class MyDocument extends Document {\n        render() {\n          return (\n            <Html>\n              <body>\n                <Main />\n              </body>\n            </Html>\n          )\n        }\n      }\n\n      export default MyDocument\n    `\n    )\n  })","file":"integration/missing-document-component-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should detect multiple missing document components","suites":["Missing _document components error"],"updatePoint":{"line":135,"column":56},"line":135,"code":"  it('should detect multiple missing document components', async () => {\n    await checkMissing(\n      ['<Head />', '<NextScript />'],\n      `\n      import Document, { Html, Main } from 'next/document'\n\n      class MyDocument extends Document {\n        render() {\n          return (\n            <Html>\n              <body>\n                <Main />\n              </body>\n            </Html>\n          )\n        }\n      }\n\n      export default MyDocument\n    `\n    )\n  })","file":"integration/missing-document-component-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should error with getStaticProps but no default export","suites":["Mixed getStaticProps and getServerSideProps error"],"updatePoint":{"line":13,"column":60},"line":13,"code":"  it('should error with getStaticProps but no default export', async () => {\n    // TODO: remove after investigating why dev swc build fails here\n    await fs.writeFile(\n      join(appDir, '.babelrc'),\n      '{ \"presets\": [\"next/babel\"] }'\n    )\n    await fs.move(indexPage, indexPageBak)\n    await fs.writeFile(\n      indexPage,\n      `\n      export function getStaticProps() {\n        return {\n          props: {}\n        }\n      }\n    `\n    )\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n    await fs.remove(join(appDir, '.babelrc'))\n    await fs.remove(indexPage)\n    await fs.move(indexPageBak, indexPage)\n    expect(stderr).toContain(\n      'found page without a React Component as default export in'\n    )\n  })","file":"integration/mixed-ssg-serverprops-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should error when exporting both getStaticProps and getServerSideProps","suites":["Mixed getStaticProps and getServerSideProps error"],"updatePoint":{"line":39,"column":76},"line":39,"code":"  it('should error when exporting both getStaticProps and getServerSideProps', async () => {\n    // TODO: remove after investigating why dev swc build fails here\n    await fs.writeFile(\n      join(appDir, '.babelrc'),\n      '{ \"presets\": [\"next/babel\"] }'\n    )\n    const { stderr } = await nextBuild(appDir, [], { stderr: true })\n    await fs.remove(join(appDir, '.babelrc'))\n    expect(stderr).toContain(SERVER_PROPS_SSG_CONFLICT)\n  })","file":"integration/mixed-ssg-serverprops-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should error when exporting both getStaticPaths and getServerSideProps","suites":["Mixed getStaticProps and getServerSideProps error"],"updatePoint":{"line":50,"column":76},"line":50,"code":"  it('should error when exporting both getStaticPaths and getServerSideProps', async () => {\n    // TODO: remove after investigating why dev swc build fails here\n    await fs.writeFile(\n      join(appDir, '.babelrc'),\n      '{ \"presets\": [\"next/babel\"] }'\n    )\n    await fs.move(indexPage, indexPageBak)\n    await fs.writeFile(\n      indexPage,\n      `\n      export const getStaticPaths = async () => {\n        return {\n          props: { world: 'world' }, fallback: true\n        }\n      }\n\n      export const getServerSideProps = async () => {\n        return {\n          props: { world: 'world' }\n        }\n      }\n\n      export default ({ world }) => <p>Hello {world}</p>\n    `\n    )\n    const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n    await fs.remove(join(appDir, '.babelrc'))\n    await fs.remove(indexPage)\n    await fs.move(indexPageBak, indexPage)\n    expect(code).toBe(1)\n    expect(stderr).toContain(SERVER_PROPS_SSG_CONFLICT)\n  })","file":"integration/mixed-ssg-serverprops-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should error when exporting getStaticPaths on a non-dynamic page","suites":["Mixed getStaticProps and getServerSideProps error"],"updatePoint":{"line":83,"column":70},"line":83,"code":"  it('should error when exporting getStaticPaths on a non-dynamic page', async () => {\n    await fs.move(indexPage, indexPageBak)\n    await fs.writeFile(\n      indexPage,\n      `\n      export const getStaticPaths = async () => {\n        return {\n          props: { world: 'world' }, fallback: true\n        }\n      }\n\n      export default ({ world }) => <p>Hello {world}</p>\n    `\n    )\n    const { stderr, code } = await nextBuild(appDir, [], { stderr: true })\n\n    await fs.remove(indexPage)\n    await fs.move(indexPageBak, indexPage)\n    expect(code).toBe(1)\n    expect(stderr).toContain(\n      \"getStaticPaths is only allowed for dynamic SSG pages and was found on '/'.\"\n    )\n  })","file":"integration/mixed-ssg-serverprops-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should load page correctly","suites":[],"updatePoint":{"line":18,"column":32},"line":18,"code":"  it('should load page correctly', async () => {\n    const browser = await webdriver(appPort, '/')\n\n    expect(\n      await browser\n        .elementByCss('#__next div:nth-child(2)')\n        .getComputedCss('background-color')\n    ).toContain('221, 221, 221')\n\n    expect(await browser.eval('document.documentElement.innerHTML')).toContain(\n      'Where does it come from?'\n    )\n  })","file":"integration/next-dynamic-css/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render server value","suites":[],"updatePoint":{"line":22,"column":32},"line":22,"code":"  it('should render server value', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toMatch(/the-server-value/i)\n    expect(html).toMatch(/the-second-server-value/i)\n  })","file":"integration/next-dynamic-lazy-compilation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render dynamic server rendered values before hydration","suites":[],"updatePoint":{"line":28,"column":67},"line":28,"code":"  it('should render dynamic server rendered values before hydration', async () => {\n    const browser = await webdriver(appPort, '/')\n    const text = await browser.elementByCss('#before-hydration').text()\n\n    expect(text).toBe('Index<!-- -->1<!-- -->2<!-- -->3<!-- -->4<!-- -->4')\n    expect(await browser.eval('window.caughtErrors')).toBe('')\n  })","file":"integration/next-dynamic-lazy-compilation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render dynamic server rendered values on client mount","suites":[],"updatePoint":{"line":36,"column":66},"line":36,"code":"  it('should render dynamic server rendered values on client mount', async () => {\n    const browser = await webdriver(appPort, '/')\n    const text = await browser.elementByCss('#first-render').text()\n\n    expect(text).toBe('Index<!-- -->1<!-- -->2<!-- -->3<!-- -->4<!-- -->4')\n    expect(await browser.eval('window.caughtErrors')).toBe('')\n  })","file":"integration/next-dynamic-lazy-compilation/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render server-side","suites":["next/dynamic with suspense"],"updatePoint":{"line":24,"column":31},"line":24,"code":"  it('should render server-side', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toContain('Next.js Example')\n    expect(html).toContain('Thing')\n  })","file":"integration/next-dynamic-with-suspense/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should render client-side","suites":["next/dynamic with suspense"],"updatePoint":{"line":30,"column":31},"line":30,"code":"  it('should render client-side', async () => {\n    const browser = await webdriver(appPort, '/')\n    const warnings = (await browser.log()).map((log) => log.message).join('\\n')\n\n    expect(await hasRedbox(browser)).toBe(false)\n    expect(warnings).toMatch(\n      /\"ssr: false\" is ignored by next\\/dynamic because you can not enable \"suspense\" while disabling \"ssr\" at the same time/gim\n    )\n\n    await browser.close()\n  })","file":"integration/next-dynamic-with-suspense/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should render server value","suites":[],"updatePoint":{"line":22,"column":32},"line":22,"code":"  it('should render server value', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toMatch(/the-server-value/i)\n  })","file":"integration/next-dynamic/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render dynamic server rendered values on client mount","suites":[],"updatePoint":{"line":27,"column":66},"line":27,"code":"  it('should render dynamic server rendered values on client mount', async () => {\n    const browser = await webdriver(appPort, '/')\n    const text = await browser.elementByCss('#first-render').text()\n\n    // Failure case is 'Index<!-- -->3<!-- --><!-- -->'\n    expect(text).toBe('Index<!-- -->1<!-- -->2<!-- -->3<!-- -->4<!-- -->4')\n    expect(await browser.eval('window.caughtErrors')).toBe('')\n\n    // should not print \"invalid-dynamic-suspense\" warning in browser's console\n    const logs = (await browser.log()).map((log) => log.message).join('\\n')\n    expect(logs).not.toContain(\n      'https://nextjs.org/docs/messages/invalid-dynamic-suspense'\n    )\n  })","file":"integration/next-dynamic/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show compile error on page refresh","suites":["no duplicate compile error output"],"updatePoint":{"line":16,"column":51},"line":16,"code":"  it('should not show compile error on page refresh', async () => {\n    let stderr = ''\n\n    const appPort = await findPort()\n    const app = await launchApp(appDir, appPort, {\n      env: { __NEXT_TEST_WITH_DEVTOOL: true },\n      onStderr(msg) {\n        stderr += msg || ''\n      },\n    })\n\n    const browser = await webdriver(appPort, '/')\n\n    await browser.waitForElementByCss('#a')\n\n    const f = new File(join(appDir, 'pages', 'index.js'))\n    f.replace('<div id=\"a\">hello</div>', '<div id=\"a\"!>hello</div>')\n\n    try {\n      // Wait for compile error:\n      expect(await hasRedbox(browser, true)).toBe(true)\n\n      await browser.refresh()\n\n      // Wait for compile error to re-appear:\n      expect(await hasRedbox(browser, true)).toBe(true)\n    } finally {\n      f.restore()\n    }\n\n    // Wait for compile error to disappear:\n    await check(\n      () => hasRedbox(browser, false).then((r) => (r ? 'yes' : 'no')),\n      /no/\n    )\n    await browser.waitForElementByCss('#a')\n\n    function getRegexCount(str, regex) {\n      return (str.match(regex) || []).length\n    }\n\n    const correctMessagesRegex = /Caused by:/g\n    const totalMessagesRegex = /Unexpected token/g\n\n    const correctMessages = getRegexCount(stderr, correctMessagesRegex)\n    const totalMessages = getRegexCount(stderr, totalMessagesRegex)\n\n    expect(correctMessages).toBeGreaterThanOrEqual(1)\n    expect(correctMessages).toBe(totalMessages)\n\n    await killApp(app)\n  })","file":"integration/no-duplicate-compile-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not error for all server-side pages build","suites":["no-op export"],"updatePoint":{"line":26,"column":54},"line":26,"code":"  it('should not error for all server-side pages build', async () => {\n    await addPage(\n      '_error.js',\n      `\n      import React from 'react'\n      export default class Error extends React.Component {\n        static async getInitialProps() {\n          return {\n            props: {\n              statusCode: 'oops'\n            }\n          }\n        }\n        render() {\n          return 'error page'\n        }\n      }\n    `\n    )\n    await addPage(\n      '[slug].js',\n      `\n      export const getStaticProps = () => {\n        return {\n          props: {}\n        }\n      }\n      export const getStaticPaths = () => {\n        return {\n          paths: [],\n          fallback: false\n        }\n      }\n      export default function Page() {\n        return 'page'\n      }\n    `\n    )\n    const result = await nextBuild(appDir, undefined, {\n      stderr: 'log',\n      stdout: 'log',\n    })\n    expect(result.code).toBe(0)\n  })","file":"integration/no-op-export/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not error for empty exportPathMap","suites":["no-op export"],"updatePoint":{"line":71,"column":46},"line":71,"code":"  it('should not error for empty exportPathMap', async () => {\n    await addPage(\n      'index.js',\n      `\n      export default function Index() {\n        return 'hello world'\n      }\n    `\n    )\n    await fs.writeFile(\n      nextConfig,\n      `\n      module.exports = {\n        exportPathMap() {\n          return {}\n        }\n      }\n    `\n    )\n    const buildResult = await nextBuild(appDir, undefined, {\n      stderr: 'log',\n      stdout: 'log',\n    })\n    expect(buildResult.code).toBe(0)\n\n    const exportResult = await nextExport(appDir, {\n      outdir: join(appDir, 'out'),\n    })\n    expect(exportResult.code).toBe(0)\n  })","file":"integration/no-op-export/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show error when a Next prop is returned in _app.getInitialProps","suites":["Dynamic require"],"updatePoint":{"line":16,"column":76},"line":16,"code":"  it('should show error when a Next prop is returned in _app.getInitialProps', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toMatch(/\\/cant-override-next-props/)\n  })","file":"integration/no-override-next-props/test/index.test.js","skipped":false,"dir":"test"},{"name":"should load auto-export page correctly","suites":[],"updatePoint":{"line":18,"column":44},"line":18,"code":"  it('should load auto-export page correctly', async () => {\n    const browser = await webdriver(appPort, '/')\n    expect(await browser.elementByCss('#index').text()).toBe('index')\n    expect(await browser.eval('window.uncaughtErrors')).toEqual([])\n  })","file":"integration/no-page-props/test/index.test.js","skipped":false,"dir":"test"},{"name":"should load getStaticProps page correctly","suites":[],"updatePoint":{"line":24,"column":47},"line":24,"code":"  it('should load getStaticProps page correctly', async () => {\n    const browser = await webdriver(appPort, '/gsp')\n    expect(await browser.elementByCss('#gsp').text()).toBe('getStaticProps')\n    expect(await browser.eval('window.uncaughtErrors')).toEqual([])\n  })","file":"integration/no-page-props/test/index.test.js","skipped":false,"dir":"test"},{"name":"should load getServerSideProps page correctly","suites":[],"updatePoint":{"line":30,"column":51},"line":30,"code":"  it('should load getServerSideProps page correctly', async () => {\n    const browser = await webdriver(appPort, '/gssp')\n    expect(await browser.elementByCss('#gssp').text()).toBe(\n      'getServerSideProps'\n    )\n    expect(await browser.eval('window.uncaughtErrors')).toEqual([])\n  })","file":"integration/no-page-props/test/index.test.js","skipped":false,"dir":"test"},{"name":"should load 404 page correctly","suites":[],"updatePoint":{"line":38,"column":36},"line":38,"code":"  it('should load 404 page correctly', async () => {\n    const browser = await webdriver(appPort, '/non-existent')\n    expect(await browser.elementByCss('h2').text()).toBe(\n      'Application error: a client-side exception has occurred (see the browser console for more information).'\n    )\n    expect(await browser.eval('window.uncaughtErrors')).toEqual([])\n  })","file":"integration/no-page-props/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate between pages correctly","suites":[],"updatePoint":{"line":46,"column":45},"line":46,"code":"  it('should navigate between pages correctly', async () => {\n    const browser = await webdriver(appPort, '/')\n\n    await browser.eval('window.beforeNav = \"hi\"')\n    await browser.elementByCss('#to-gsp').click()\n    await browser.waitForElementByCss('#gsp')\n\n    expect(await browser.elementByCss('#gsp').text()).toBe('getStaticProps')\n    expect(await browser.eval('window.beforeNav')).toBe('hi')\n\n    await browser.back()\n    await browser.waitForElementByCss('#index')\n    expect(await browser.eval('window.beforeNav')).toBe('hi')\n\n    await browser.elementByCss('#to-gssp').click()\n    await browser.waitForElementByCss('#gssp')\n\n    expect(await browser.elementByCss('#gssp').text()).toBe(\n      'getServerSideProps'\n    )\n    expect(await browser.eval('window.beforeNav')).toBe('hi')\n\n    await browser.back()\n    await browser.waitForElementByCss('#index')\n    expect(await browser.eval('window.beforeNav')).toBe('hi')\n\n    await browser.elementByCss('#to-404').click()\n    await browser.waitForElementByCss('h2')\n    expect(await browser.eval('window.beforeNav')).toBeFalsy()\n    expect(await browser.elementByCss('h2').text()).toBe(\n      'Application error: a client-side exception has occurred (see the browser console for more information).'\n    )\n    expect(await browser.eval('window.uncaughtErrors')).toEqual([])\n  })","file":"integration/no-page-props/test/index.test.js","skipped":false,"dir":"test"},{"name":"should send keep-alive for json API","suites":["node-fetch-keep-alive","production"],"updatePoint":{"line":69,"column":43},"line":69,"code":"    it('should send keep-alive for json API', async () => {\n      const res = await fetchViaHTTP(appPort, '/api/json')\n      const obj = await res.json()\n      expect(obj).toEqual({ connection: 'keep-alive' })\n    })","file":"integration/node-fetch-keep-alive/test/index.test.js","skipped":false,"dir":"test"},{"name":"should send keep-alive for getStaticProps","suites":["node-fetch-keep-alive","production"],"updatePoint":{"line":75,"column":49},"line":75,"code":"    it('should send keep-alive for getStaticProps', async () => {\n      const browser = await webdriver(appPort, '/ssg')\n      const props = await browser.elementById('props').text()\n      const obj = JSON.parse(props)\n      expect(obj).toEqual({ connection: 'keep-alive' })\n      await browser.close()\n    })","file":"integration/node-fetch-keep-alive/test/index.test.js","skipped":false,"dir":"test"},{"name":"should send keep-alive for getStaticPaths","suites":["node-fetch-keep-alive","production"],"updatePoint":{"line":83,"column":49},"line":83,"code":"    it('should send keep-alive for getStaticPaths', async () => {\n      const browser = await webdriver(appPort, '/blog/first')\n      const props = await browser.elementById('props').text()\n      const obj = JSON.parse(props)\n      expect(obj).toEqual({ slug: 'first' })\n      await browser.close()\n    })","file":"integration/node-fetch-keep-alive/test/index.test.js","skipped":false,"dir":"test"},{"name":"should send keep-alive for getServerSideProps","suites":["node-fetch-keep-alive","production"],"updatePoint":{"line":91,"column":53},"line":91,"code":"    it('should send keep-alive for getServerSideProps', async () => {\n      const browser = await webdriver(appPort, '/ssr')\n      const props = await browser.elementById('props').text()\n      const obj = JSON.parse(props)\n      expect(obj).toEqual({ connection: 'keep-alive' })\n      await browser.close()\n    })","file":"integration/node-fetch-keep-alive/test/index.test.js","skipped":false,"dir":"test"},{"name":"Externalized non-Next dist-using package","suites":["Non-Next externalization"],"updatePoint":{"line":12,"column":46},"line":12,"code":"  it('Externalized non-Next dist-using package', async () => {\n    const content = readNextBuildServerPageFile(appDir, '/')\n    expect(content).not.toContain('BrokenExternalMarker')\n  })","file":"integration/non-next-dist-exclude/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show the warning with no NODE_ENV set","suites":["Non-Standard NODE_ENV"],"updatePoint":{"line":36,"column":54},"line":36,"code":"  it('should not show the warning with no NODE_ENV set', async () => {\n    let output = ''\n\n    app = await launchApp(appDir, await findPort(), {\n      onStderr(msg) {\n        output += msg || ''\n      },\n    })\n    await waitFor(2000)\n    await killApp(app)\n    expect(output).not.toContain(warningText)\n  })","file":"integration/non-standard-node-env-warning/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show the warning with NODE_ENV set to valid value","suites":["Non-Standard NODE_ENV"],"updatePoint":{"line":49,"column":66},"line":49,"code":"  it('should not show the warning with NODE_ENV set to valid value', async () => {\n    let output = ''\n\n    app = await launchApp(appDir, await findPort(), {\n      env: {\n        NODE_ENV: 'development',\n      },\n      onStderr(msg) {\n        output += msg || ''\n      },\n    })\n    await waitFor(2000)\n    await killApp(app)\n    expect(output).not.toContain(warningText)\n  })","file":"integration/non-standard-node-env-warning/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show the warning with NODE_ENV set to valid value (custom server)","suites":["Non-Standard NODE_ENV"],"updatePoint":{"line":65,"column":82},"line":65,"code":"  it('should not show the warning with NODE_ENV set to valid value (custom server)', async () => {\n    let output = ''\n\n    app = await startServer(\n      {\n        NODE_ENV: 'development',\n      },\n      {\n        onStderr(msg) {\n          output += msg || ''\n        },\n      }\n    )\n    await waitFor(2000)\n    await killApp(app)\n    expect(output).not.toContain(warningText)\n  })","file":"integration/non-standard-node-env-warning/test/index.test.js","skipped":false,"dir":"test"},{"name":"should still DCE NODE_ENV specific code","suites":["Non-Standard NODE_ENV"],"updatePoint":{"line":83,"column":45},"line":83,"code":"  it('should still DCE NODE_ENV specific code', async () => {\n    await nextBuild(appDir, undefined, {\n      env: {\n        NODE_ENV: 'test',\n      },\n    })\n\n    const staticFiles = glob.sync('**/*.js', {\n      cwd: join(appDir, '.next/static'),\n    })\n    expect(staticFiles.length).toBeGreaterThan(0)\n\n    for (const file of staticFiles) {\n      const content = await fs.readFile(\n        join(appDir, '.next/static', file),\n        'utf8'\n      )\n      if (content.match(/cannot find module(?! for page)/i)) {\n        throw new Error(`${file} contains module not found error`)\n      }\n    }\n  })","file":"integration/non-standard-node-env-warning/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show the warning with NODE_ENV set to invalid value","suites":["Non-Standard NODE_ENV"],"updatePoint":{"line":106,"column":64},"line":106,"code":"  it('should show the warning with NODE_ENV set to invalid value', async () => {\n    let output = ''\n\n    app = await launchApp(appDir, await findPort(), {\n      env: {\n        NODE_ENV: 'abc',\n      },\n      onStderr(msg) {\n        output += msg || ''\n      },\n    })\n    await waitFor(2000)\n    await killApp(app)\n    expect(output).toContain(warningText)\n  })","file":"integration/non-standard-node-env-warning/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show the warning with NODE_ENV set to invalid value (custom server)","suites":["Non-Standard NODE_ENV"],"updatePoint":{"line":122,"column":80},"line":122,"code":"  it('should show the warning with NODE_ENV set to invalid value (custom server)', async () => {\n    let output = ''\n\n    app = await startServer(\n      {\n        NODE_ENV: 'abc',\n      },\n      {\n        onStderr(msg) {\n          output += msg || ''\n        },\n      }\n    )\n    await waitFor(2000)\n    await killApp(app)\n    expect(output).toContain(warningText)\n  })","file":"integration/non-standard-node-env-warning/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show the warning with NODE_ENV set to production with next dev","suites":["Non-Standard NODE_ENV"],"updatePoint":{"line":140,"column":75},"line":140,"code":"  it('should show the warning with NODE_ENV set to production with next dev', async () => {\n    let output = ''\n\n    app = await launchApp(appDir, await findPort(), {\n      env: {\n        NODE_ENV: 'production',\n      },\n      onStderr(msg) {\n        output += msg || ''\n      },\n    })\n    await waitFor(2000)\n    await killApp(app)\n    expect(output).toContain(warningText)\n  })","file":"integration/non-standard-node-env-warning/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show the warning with NODE_ENV set to development with next build","suites":["Non-Standard NODE_ENV"],"updatePoint":{"line":156,"column":78},"line":156,"code":"  it('should show the warning with NODE_ENV set to development with next build', async () => {\n    const { stderr } = await nextBuild(appDir, [], {\n      env: {\n        NODE_ENV: 'development',\n      },\n      stderr: true,\n    })\n    expect(stderr).toContain(warningText)\n  })","file":"integration/non-standard-node-env-warning/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show the warning with NODE_ENV set to development with next start","suites":["Non-Standard NODE_ENV"],"updatePoint":{"line":166,"column":78},"line":166,"code":"  it('should show the warning with NODE_ENV set to development with next start', async () => {\n    let output = ''\n\n    await nextBuild(appDir)\n    app = await nextStart(appDir, await findPort(), {\n      env: {\n        NODE_ENV: 'development',\n      },\n      onStderr(msg) {\n        output += msg || ''\n      },\n    })\n    await waitFor(2000)\n    await killApp(app)\n    expect(output).toContain(warningText)\n  })","file":"integration/non-standard-node-env-warning/test/index.test.js","skipped":false,"dir":"test"},{"name":"should revalidate page when notFund returned during build","suites":[],"updatePoint":{"line":23,"column":63},"line":23,"code":"  it('should revalidate page when notFund returned during build', async () => {\n    let res = await fetchViaHTTP(appPort, '/initial-not-found/first')\n    let $ = cheerio.load(await res.text())\n    expect(res.status).toBe(404)\n    expect($('#not-found').text()).toBe('404 page')\n\n    res = await fetchViaHTTP(appPort, '/initial-not-found/second')\n    $ = cheerio.load(await res.text())\n    expect(res.status).toBe(404)\n    expect($('#not-found').text()).toBe('404 page')\n\n    res = await fetchViaHTTP(appPort, '/initial-not-found')\n    $ = cheerio.load(await res.text())\n    expect(res.status).toBe(404)\n    expect($('#not-found').text()).toBe('404 page')\n\n    await fs.writeFile(dataFile, '200')\n\n    // wait for revalidation period\n    await waitFor(1500)\n    await fetchViaHTTP(appPort, '/initial-not-found/first')\n    await fetchViaHTTP(appPort, '/initial-not-found/second')\n    await fetchViaHTTP(appPort, '/initial-not-found')\n\n    // wait for revalidation to occur in background\n    try {\n      await check(async () => {\n        res = await fetchViaHTTP(appPort, '/initial-not-found/first')\n        $ = cheerio.load(await res.text())\n\n        return res.status === 200 && $('#data').text() === '200'\n          ? 'success'\n          : `${res.status} - ${$('#data').text()}`\n      }, 'success')\n\n      await check(async () => {\n        res = await fetchViaHTTP(appPort, '/initial-not-found/second')\n        $ = cheerio.load(await res.text())\n\n        return res.status === 200 && $('#data').text() === '200'\n          ? 'success'\n          : `${res.status} - ${$('#data').text()}`\n      }, 'success')\n\n      await check(async () => {\n        res = await fetchViaHTTP(appPort, '/initial-not-found')\n        $ = cheerio.load(await res.text())\n\n        return res.status === 200 && $('#data').text() === '200'\n          ? 'success'\n          : `${res.status} - ${$('#data').text()}`\n      }, 'success')\n    } finally {\n      await fs.writeFile(dataFile, '404')\n    }\n  })","file":"integration/not-found-revalidate/test/index.test.js","skipped":false,"dir":"test"},{"name":"should revalidate after notFound is returned for fallback: blocking","suites":[],"updatePoint":{"line":80,"column":73},"line":80,"code":"  it('should revalidate after notFound is returned for fallback: blocking', async () => {\n    let res = await fetchViaHTTP(appPort, '/fallback-blocking/hello')\n    let $ = cheerio.load(await res.text())\n\n    const privateCache =\n      'private, no-cache, no-store, max-age=0, must-revalidate'\n    expect(res.headers.get('cache-control')).toBe(privateCache)\n    expect(res.status).toBe(404)\n    expect(JSON.parse($('#props').text()).notFound).toBe(true)\n\n    await waitFor(1000)\n    res = await fetchViaHTTP(appPort, '/fallback-blocking/hello')\n    $ = cheerio.load(await res.text())\n\n    expect(res.headers.get('cache-control')).toBe(privateCache)\n    expect(res.status).toBe(404)\n    expect(JSON.parse($('#props').text()).notFound).toBe(true)\n\n    await waitFor(1000)\n    res = await fetchViaHTTP(appPort, '/fallback-blocking/hello')\n    $ = cheerio.load(await res.text())\n\n    const props = JSON.parse($('#props').text())\n    expect(res.headers.get('cache-control')).toBe(\n      's-maxage=1, stale-while-revalidate'\n    )\n    expect(res.status).toBe(200)\n    expect(props.found).toBe(true)\n    expect(props.params).toEqual({ slug: 'hello' })\n    expect(isNaN(props.random)).toBe(false)\n\n    await waitFor(1000)\n    res = await fetchViaHTTP(appPort, '/fallback-blocking/hello')\n    $ = cheerio.load(await res.text())\n\n    const props2 = JSON.parse($('#props').text())\n    expect(res.headers.get('cache-control')).toBe(\n      's-maxage=1, stale-while-revalidate'\n    )\n    expect(res.status).toBe(200)\n    expect(props2.found).toBe(true)\n    expect(props2.params).toEqual({ slug: 'hello' })\n    expect(isNaN(props2.random)).toBe(false)\n\n    await waitFor(1000)\n    res = await fetchViaHTTP(appPort, '/fallback-blocking/hello')\n    $ = cheerio.load(await res.text())\n\n    const props3 = JSON.parse($('#props').text())\n    expect(res.headers.get('cache-control')).toBe(\n      's-maxage=1, stale-while-revalidate'\n    )\n    expect(res.status).toBe(200)\n    expect(props3.found).toBe(true)\n    expect(props3.params).toEqual({ slug: 'hello' })\n    expect(isNaN(props3.random)).toBe(false)\n    expect(props3.random).not.toBe(props.random)\n  })","file":"integration/not-found-revalidate/test/index.test.js","skipped":false,"dir":"test"},{"name":"should revalidate after notFound is returned for fallback: true","suites":[],"updatePoint":{"line":139,"column":69},"line":139,"code":"  it('should revalidate after notFound is returned for fallback: true', async () => {\n    const browser = await webdriver(appPort, '/fallback-true/world')\n\n    await browser.waitForElementByCss('#not-found')\n\n    await waitFor(1000)\n    let res = await fetchViaHTTP(appPort, '/fallback-true/world')\n    let $ = cheerio.load(await res.text())\n\n    expect(res.headers.get('cache-control')).toBe(\n      'private, no-cache, no-store, max-age=0, must-revalidate'\n    )\n    expect(res.status).toBe(404)\n    expect(JSON.parse($('#props').text()).notFound).toBe(true)\n\n    await waitFor(1000)\n    res = await fetchViaHTTP(appPort, '/fallback-true/world')\n    $ = cheerio.load(await res.text())\n\n    const props = JSON.parse($('#props').text())\n    expect(res.headers.get('cache-control')).toBe(\n      's-maxage=1, stale-while-revalidate'\n    )\n    expect(res.status).toBe(200)\n    expect(props.found).toBe(true)\n    expect(props.params).toEqual({ slug: 'world' })\n    expect(isNaN(props.random)).toBe(false)\n\n    await waitFor(1000)\n    res = await fetchViaHTTP(appPort, '/fallback-true/world')\n    $ = cheerio.load(await res.text())\n\n    const props2 = JSON.parse($('#props').text())\n    expect(res.headers.get('cache-control')).toBe(\n      's-maxage=1, stale-while-revalidate'\n    )\n    expect(res.status).toBe(200)\n    expect(props2.found).toBe(true)\n    expect(props2.params).toEqual({ slug: 'world' })\n    expect(isNaN(props2.random)).toBe(false)\n\n    await waitFor(1000)\n    res = await fetchViaHTTP(appPort, '/fallback-true/world')\n    $ = cheerio.load(await res.text())\n\n    const props3 = JSON.parse($('#props').text())\n    expect(res.headers.get('cache-control')).toBe(\n      's-maxage=1, stale-while-revalidate'\n    )\n    expect(res.status).toBe(200)\n    expect(props3.found).toBe(true)\n    expect(props3.params).toEqual({ slug: 'world' })\n    expect(isNaN(props3.random)).toBe(false)\n    expect(props3.random).not.toBe(props.random)\n  })","file":"integration/not-found-revalidate/test/index.test.js","skipped":false,"dir":"test"},{"name":"should ignore configs set to `undefined` in next.config.js","suites":[],"updatePoint":{"line":12,"column":64},"line":12,"code":"  it('should ignore configs set to `undefined` in next.config.js', async () => {\n    await fs.writeFile(\n      nextConfig,\n      `\n        module.exports = {\n          target: undefined,\n          env: undefined,\n          webpack: undefined,\n          pageExtensions: undefined,\n          amp: {\n            canonicalBase: undefined,\n          },\n        }\n      `\n    )\n\n    const stdout = await getStdout()\n\n    expect(stdout).toMatch(/compiled .*successfully/i)\n  })","file":"integration/nullish-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"should ignore configs set to `null` in next.config.js","suites":[],"updatePoint":{"line":33,"column":59},"line":33,"code":"  it('should ignore configs set to `null` in next.config.js', async () => {\n    await fs.writeFile(\n      nextConfig,\n      `\n        module.exports = {\n          target: null,\n          env: null,\n          webpack: null,\n          pageExtensions: null,\n          amp: {\n            canonicalBase: null,\n          },\n        }\n      `\n    )\n\n    const stdout = await getStdout()\n\n    expect(stdout).toMatch(/compiled .*successfully/i)\n  })","file":"integration/nullish-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"should successfully build for a JavaScript file","suites":["Numeric Separator Support"],"updatePoint":{"line":9,"column":53},"line":9,"code":"  it('should successfully build for a JavaScript file', async () => {\n    const { code, stdout, stderr } = await nextBuild(appDir, [], {\n      stdout: true,\n      stderr: true,\n    })\n\n    expect(code).toBe(0)\n\n    expect(stdout).toContain('Compiled successfully')\n    expect(stderr).not.toContain('Failed to compile')\n  })","file":"integration/numeric-sep/test/index.test.js","skipped":false,"dir":"test"},{"name":"should pass","suites":["On Demand Entries"],"updatePoint":{"line":46,"column":17},"line":46,"code":"  it('should pass', () => {})","file":"integration/ondemand/test/index.test.js","skipped":false,"dir":"test"},{"name":"should compile pages for SSR","suites":["On Demand Entries"],"updatePoint":{"line":75,"column":34},"line":75,"code":"  it('should compile pages for SSR', async () => {\n    // The buffer of built page uses the on-demand-entries-ping to know which pages should be\n    // buffered. Therefore, we need to double each render call with a ping.\n    const pageContent = await renderViaHTTP(context.appPort, '/')\n    await doPing('/')\n    expect(pageContent.includes('Index Page')).toBeTruthy()\n  })","file":"integration/ondemand/test/index.test.js","skipped":false,"dir":"test"},{"name":"should compile pages for JSON page requests","suites":["On Demand Entries"],"updatePoint":{"line":83,"column":49},"line":83,"code":"  it('should compile pages for JSON page requests', async () => {\n    await renderViaHTTP(context.appPort, '/about')\n    const pageFile = getPageFileFromBuildManifest(appDir, '/about')\n    const pageContent = await renderViaHTTP(\n      context.appPort,\n      join('/_next', pageFile)\n    )\n    expect(pageContent.includes('About Page')).toBeTruthy()\n  })","file":"integration/ondemand/test/index.test.js","skipped":false,"dir":"test"},{"name":"should dispose inactive pages","suites":["On Demand Entries"],"updatePoint":{"line":93,"column":35},"line":93,"code":"  it('should dispose inactive pages', async () => {\n    await renderViaHTTP(context.appPort, '/')\n    await doPing('/')\n\n    // Render two pages after the index, since the server keeps at least two pages\n    await renderViaHTTP(context.appPort, '/about')\n    await doPing('/about')\n\n    await renderViaHTTP(context.appPort, '/third')\n    await doPing('/third')\n\n    // Wait maximum of jest.setTimeout checking\n    // for disposing /about\n    for (let i = 0; i < 30; ++i) {\n      await waitFor(1000 * 1)\n      try {\n        const buildManifest = getBuildManifest(appDir)\n        // Assert that the two lastly demanded page are not disposed\n        expect(buildManifest.pages['/']).toBeUndefined()\n        expect(buildManifest.pages['/about']).toBeDefined()\n        expect(buildManifest.pages['/third']).toBeDefined()\n        return\n      } catch (err) {\n        continue\n      }\n    }\n  })","file":"integration/ondemand/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate to pages with dynamic imports","suites":["On Demand Entries"],"updatePoint":{"line":121,"column":51},"line":121,"code":"  it('should navigate to pages with dynamic imports', async () => {\n    let browser\n    try {\n      browser = await webdriver(context.appPort, '/nav')\n\n      await browser.eval('document.getElementById(\"to-dynamic\").click()')\n\n      await check(async () => {\n        const text = await getBrowserBodyText(browser)\n        return text\n      }, /Hello/)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/ondemand/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page","suites":[],"updatePoint":{"line":23,"column":28},"line":23,"code":"  it('should render the page', async () => {\n    const html = await renderViaHTTP(context.appPort, url)\n    expect(html).toMatch(/Hello World/)\n  })","file":"integration/optimized-loading/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have JS preload links","suites":[],"updatePoint":{"line":28,"column":38},"line":28,"code":"  it('should not have JS preload links', async () => {\n    const html = await renderViaHTTP(context.appPort, url)\n    const $ = cheerio.load(html)\n    expect($('link[rel=preload]').length).toBe(0)\n  })","file":"integration/optimized-loading/test/index.test.js","skipped":false,"dir":"test"},{"name":"should load scripts with defer in head","suites":[],"updatePoint":{"line":34,"column":44},"line":34,"code":"  it('should load scripts with defer in head', async () => {\n    const html = await renderViaHTTP(context.appPort, url)\n    const $ = cheerio.load(html)\n    expect($('script[async]').length).toBe(0)\n    expect($('head script[defer]').length).toBeGreaterThan(0)\n  })","file":"integration/optimized-loading/test/index.test.js","skipped":false,"dir":"test"},{"name":"should support optional chaining","suites":[],"updatePoint":{"line":20,"column":38},"line":20,"code":"  it('should support optional chaining', async () => {\n    const html = await renderViaHTTP(appPort, '/optional-chaining')\n    expect(html).toMatch(/result1:.*?nothing/)\n    expect(html).toMatch(/result2:.*?something/)\n  })","file":"integration/optional-chaining-nullish-coalescing/test/index.test.js","skipped":false,"dir":"test"},{"name":"should support nullish coalescing","suites":[],"updatePoint":{"line":26,"column":39},"line":26,"code":"  it('should support nullish coalescing', async () => {\n    const html = await renderViaHTTP(appPort, '/nullish-coalescing')\n    expect(html).toMatch(/result1:.*?fallback/)\n    expect(html).not.toMatch(/result2:.*?fallback/)\n  })","file":"integration/optional-chaining-nullish-coalescing/test/index.test.js","skipped":false,"dir":"test"},{"name":"builds without error when export const config is used outside page","suites":["Page Config"],"updatePoint":{"line":20,"column":72},"line":20,"code":"  it('builds without error when export const config is used outside page', async () => {\n    const { stderr } = await nextBuild(appDir, undefined, { stderr: true })\n    expect(stderr).not.toMatch(/Failed to compile\\./)\n  })","file":"integration/page-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows valid error when page config is a string","suites":["Page Config"],"updatePoint":{"line":25,"column":52},"line":25,"code":"  it('shows valid error when page config is a string', async () => {\n    const reset = await uncommentExport('invalid/string-config.js')\n\n    try {\n      const { stderr } = await nextBuild(appDir, undefined, { stderr: true })\n      expect(stderr).toMatch(/\\/invalid-page-config/)\n    } finally {\n      await reset()\n    }\n  })","file":"integration/page-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows valid error when page config has no init","suites":["Page Config"],"updatePoint":{"line":36,"column":52},"line":36,"code":"  it('shows valid error when page config has no init', async () => {\n    const reset = await uncommentExport('invalid/no-init.js')\n\n    try {\n      const { stderr } = await nextBuild(appDir, undefined, { stderr: true })\n      expect(stderr).toMatch(/\\/invalid-page-config/)\n    } finally {\n      await reset()\n    }\n  })","file":"integration/page-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows error when page config has spread properties","suites":["Page Config"],"updatePoint":{"line":47,"column":56},"line":47,"code":"  it('shows error when page config has spread properties', async () => {\n    const reset = await uncommentExport('invalid/spread-config.js')\n\n    try {\n      const { stderr } = await nextBuild(appDir, undefined, { stderr: true })\n      expect(stderr).toMatch(/\\/invalid-page-config/)\n    } finally {\n      await reset()\n    }\n  })","file":"integration/page-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows error when page config has invalid properties","suites":["Page Config"],"updatePoint":{"line":58,"column":57},"line":58,"code":"  it('shows error when page config has invalid properties', async () => {\n    const reset = await uncommentExport('invalid/invalid-property.js')\n\n    try {\n      const { stderr } = await nextBuild(appDir, undefined, { stderr: true })\n      expect(stderr).toMatch(/\\/invalid-page-config/)\n    } finally {\n      await reset()\n    }\n  })","file":"integration/page-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows error when page config has invalid property value","suites":["Page Config"],"updatePoint":{"line":69,"column":61},"line":69,"code":"  it('shows error when page config has invalid property value', async () => {\n    const reset = await uncommentExport('invalid/invalid-value.js')\n\n    try {\n      const { stderr } = await nextBuild(appDir, undefined, { stderr: true })\n      expect(stderr).toMatch(/\\/invalid-page-config/)\n    } finally {\n      await reset()\n    }\n  })","file":"integration/page-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows error when page config is export from","suites":["Page Config"],"updatePoint":{"line":80,"column":49},"line":80,"code":"  it('shows error when page config is export from', async () => {\n    const reset = await uncommentExport('invalid/export-from.js')\n\n    try {\n      const { stderr } = await nextBuild(appDir, undefined, { stderr: true })\n      expect(stderr).toMatch(/\\/invalid-page-config/)\n    } finally {\n      await reset()\n    }\n  })","file":"integration/page-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows error when page config is imported and exported","suites":["Page Config"],"updatePoint":{"line":91,"column":59},"line":91,"code":"  it('shows error when page config is imported and exported', async () => {\n    const reset = await uncommentExport('invalid/import-export.js')\n\n    try {\n      const { stderr } = await nextBuild(appDir, undefined, { stderr: true })\n      expect(stderr).toMatch(/\\/invalid-page-config/)\n    } finally {\n      await reset()\n    }\n  })","file":"integration/page-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"should use the default pageExtensions if set to undefined","suites":["Page Extensions"],"updatePoint":{"line":11,"column":63},"line":11,"code":"  it('should use the default pageExtensions if set to undefined', async () => {\n    await fs.writeFile(\n      nextConfig,\n      `module.exports = { pageExtensions: undefined }`\n    )\n\n    const { stdout } = await runNextCommand(['build', appDir], { stdout: true })\n\n    await fs.remove(nextConfig)\n\n    expect(stdout).toContain('Compiled successfully')\n  })","file":"integration/page-extensions/test/index.test.js","skipped":false,"dir":"test"},{"name":"should throw if pageExtensions is an empty array","suites":["Page Extensions"],"updatePoint":{"line":24,"column":54},"line":24,"code":"  it('should throw if pageExtensions is an empty array', async () => {\n    await fs.writeFile(nextConfig, `module.exports = { pageExtensions: [] }`)\n\n    const { stderr } = await runNextCommand(['build', appDir], { stderr: true })\n\n    await fs.remove(nextConfig)\n\n    expect(stderr).toContain(\n      'Specified pageExtensions is an empty array. Please update it with the relevant extensions or remove it'\n    )\n  })","file":"integration/page-extensions/test/index.test.js","skipped":false,"dir":"test"},{"name":"should throw if pageExtensions has invalid extensions","suites":["Page Extensions"],"updatePoint":{"line":36,"column":59},"line":36,"code":"  it('should throw if pageExtensions has invalid extensions', async () => {\n    await fs.writeFile(\n      nextConfig,\n      `module.exports = { pageExtensions: ['js', 123] }`\n    )\n\n    const { stderr } = await runNextCommand(['build', appDir], { stderr: true })\n\n    await fs.remove(nextConfig)\n\n    expect(stderr).toContain(\n      'Specified pageExtensions is not an array of strings, found \"123\" of type \"number\". Please update this config or remove it'\n    )\n  })","file":"integration/page-extensions/test/index.test.js","skipped":false,"dir":"test"},{"name":"should throw if @zeit/next-typescript is used","suites":["Page Extensions"],"updatePoint":{"line":51,"column":51},"line":51,"code":"  it('should throw if @zeit/next-typescript is used', async () => {\n    await fs.writeFile(\n      nextConfig,\n      `const withTypescript = require('@zeit/next-typescript')\n      module.exports = withTypescript()\n      `\n    )\n\n    const { stderr } = await runNextCommand(['build', appDir], { stderr: true })\n\n    await fs.remove(nextConfig)\n\n    expect(stderr).toContain(\n      '@zeit/next-typescript is no longer needed since Next.js has built-in support for TypeScript now'\n    )\n  })","file":"integration/page-extensions/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not throw if .d.ts file inside the pages folder","suites":["Page Extensions"],"updatePoint":{"line":68,"column":60},"line":68,"code":"  it('should not throw if .d.ts file inside the pages folder', async () => {\n    await fs.writeFile(\n      nextConfig,\n      `module.exports = { pageExtensions: ['js', 'ts', 'tsx'] }`\n    )\n\n    const { stdout } = await runNextCommand(['build', appDir], { stdout: true })\n\n    await fs.remove(nextConfig)\n\n    expect(stdout).toContain('Compiled successfully')\n  })","file":"integration/page-extensions/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render an MDX page correctly","suites":["Configuration","MDX Plugin support"],"updatePoint":{"line":18,"column":43},"line":18,"code":"    it('should render an MDX page correctly', async () => {\n      expect(await renderViaHTTP(context.appPort, '/')).toMatch(/Hello MDX/)\n    })","file":"integration/plugin-mdx/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render an MDX page with component correctly","suites":["Configuration","MDX Plugin support"],"updatePoint":{"line":22,"column":58},"line":22,"code":"    it('should render an MDX page with component correctly', async () => {\n      expect(await renderViaHTTP(context.appPort, '/button')).toMatch(\n        /Look, a button!/\n      )\n    })","file":"integration/plugin-mdx/test/index.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["Polyfilling (minimal)"],"updatePoint":{"line":14,"column":33},"line":14,"code":"  it('should compile successfully', async () => {\n    const { code, stdout } = await nextBuild(appDir, [], {\n      stdout: true,\n    })\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/polyfilling-minimal/test/index.test.js","skipped":false,"dir":"test"},{"name":"should alias fetch","suites":["Polyfills"],"updatePoint":{"line":30,"column":24},"line":30,"code":"  it('should alias fetch', async () => {\n    const browser = await webdriver(appPort, '/fetch')\n    const text = await browser.elementByCss('#test-status').text()\n\n    expect(text).toBe('pass')\n\n    await browser.close()\n  })","file":"integration/polyfills/test/index.test.js","skipped":false,"dir":"test"},{"name":"should allow using process.env when there is an element with `id` of `process`","suites":["Polyfills"],"updatePoint":{"line":39,"column":84},"line":39,"code":"  it('should allow using process.env when there is an element with `id` of `process`', async () => {\n    const browser = await webdriver(appPort, '/process')\n    const text = await browser.elementByCss('#process').text()\n\n    expect(text).toBe('Hello, stranger')\n\n    await browser.close()\n  })","file":"integration/polyfills/test/index.test.js","skipped":false,"dir":"test"},{"name":"should contain generated page count in output","suites":["Polyfills"],"updatePoint":{"line":48,"column":51},"line":48,"code":"  it('should contain generated page count in output', async () => {\n    expect(output).toContain('Generating static pages (0/5)')\n    expect(output).toContain('Generating static pages (5/5)')\n    // we should only have 1 segment and the initial message logged out\n    expect(output.match(/Generating static pages/g).length).toBe(5)\n  })","file":"integration/polyfills/test/index.test.js","skipped":false,"dir":"test"},{"name":"should serve on the configured port","suites":[],"updatePoint":{"line":18,"column":41},"line":18,"code":"  it('should serve on the configured port', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toContain('hello from index')\n  })","file":"integration/port-env-var/test/index.test.js","skipped":false,"dir":"test"},{"name":"should de-dupe inflight SSG requests","suites":["Prefetching Links in viewport"],"updatePoint":{"line":58,"column":42},"line":58,"code":"  it('should de-dupe inflight SSG requests', async () => {\n    nextDataRequests = []\n    const browser = await webdriver(appPort, '/')\n    await browser.eval(function navigate() {\n      window.next.router.push('/ssg/slow')\n      window.next.router.push('/ssg/slow')\n      window.next.router.push('/ssg/slow')\n    })\n    await browser.waitForElementByCss('#content')\n    expect(\n      nextDataRequests.filter((reqUrl) => reqUrl.includes('/ssg/slow.json'))\n        .length\n    ).toBe(2)\n  })","file":"integration/preload-viewport/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle timed out prefetch correctly","suites":["Prefetching Links in viewport"],"updatePoint":{"line":73,"column":48},"line":73,"code":"  it('should handle timed out prefetch correctly', async () => {\n    try {\n      stallJs = true\n      const browser = await webdriver(appPort, '/')\n\n      await browser.elementByCss('#scroll-to-another').click()\n      // wait for preload to timeout\n      await waitFor(6 * 1000)\n\n      await browser\n        .elementByCss('#link-another')\n        .click()\n        .waitForElementByCss('#another')\n\n      expect(await browser.elementByCss('#another').text()).toBe('Hello world')\n    } finally {\n      stallJs = false\n    }\n  })","file":"integration/preload-viewport/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prefetch with link in viewport onload","suites":["Prefetching Links in viewport"],"updatePoint":{"line":93,"column":50},"line":93,"code":"  it('should prefetch with link in viewport onload', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      const links = await browser.elementsByCss('link[rel=prefetch]')\n      let found = false\n\n      for (const link of links) {\n        const href = await link.getAttribute('href')\n        if (href.includes('first')) {\n          found = true\n          break\n        }\n      }\n      expect(found).toBe(true)\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/preload-viewport/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prefetch rewritten href with link in viewport onload","suites":["Prefetching Links in viewport"],"updatePoint":{"line":113,"column":65},"line":113,"code":"  it('should prefetch rewritten href with link in viewport onload', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/rewrite-prefetch')\n      const links = await browser.elementsByCss('link[rel=prefetch]')\n      let found = false\n\n      for (const link of links) {\n        const href = await link.getAttribute('href')\n        if (href.includes('%5Bslug%5D')) {\n          found = true\n          break\n        }\n      }\n      expect(found).toBe(true)\n\n      const hrefs = await browser.eval(`Object.keys(window.next.router.sdc)`)\n      expect(hrefs.map((href) => new URL(href).pathname)).toEqual([\n        '/_next/data/test-build/ssg/dynamic/one.json',\n      ])\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/preload-viewport/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prefetch with link in viewport when href changes","suites":["Prefetching Links in viewport"],"updatePoint":{"line":138,"column":61},"line":138,"code":"  it('should prefetch with link in viewport when href changes', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.elementByCss('button').click()\n      await waitFor(2 * 1000)\n\n      const links = await browser.elementsByCss('link[rel=prefetch]')\n      let foundFirst = false\n      let foundAnother = false\n\n      for (const link of links) {\n        const href = await link.getAttribute('href')\n        if (href.includes('another')) foundAnother = true\n        if (href.includes('first')) foundFirst = true\n      }\n      expect(foundFirst).toBe(true)\n      expect(foundAnother).toBe(true)\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/preload-viewport/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prefetch with link in viewport on scroll","suites":["Prefetching Links in viewport"],"updatePoint":{"line":161,"column":53},"line":161,"code":"  it('should prefetch with link in viewport on scroll', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.elementByCss('#scroll-to-another').click()\n      await waitFor(2 * 1000)\n\n      const links = await browser.elementsByCss('link[rel=prefetch]')\n      let found = false\n\n      for (const link of links) {\n        const href = await link.getAttribute('href')\n        if (href.includes('another')) {\n          found = true\n          break\n        }\n      }\n      expect(found).toBe(true)\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/preload-viewport/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prefetch with link in viewport and inject script on hover","suites":["Prefetching Links in viewport"],"updatePoint":{"line":184,"column":70},"line":184,"code":"  it('should prefetch with link in viewport and inject script on hover', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.elementByCss('#scroll-to-another').click()\n      await waitFor(2 * 1000)\n\n      const links = await browser.elementsByCss('link[rel=prefetch]')\n      let foundLink = false\n\n      for (const link of links) {\n        const href = await link.getAttribute('href')\n        if (href.includes('another')) {\n          foundLink = true\n          break\n        }\n      }\n      expect(foundLink).toBe(true)\n\n      await browser.elementByCss('#link-another').moveTo()\n      await waitFor(2 * 1000)\n\n      const scripts = await browser.elementsByCss(\n        // Mouse hover is a high-priority fetch\n        'script:not([async])'\n      )\n      let scriptFound = false\n      for (const aScript of scripts) {\n        const href = await aScript.getAttribute('src')\n        if (href.includes('another')) {\n          scriptFound = true\n          break\n        }\n      }\n      expect(scriptFound).toBe(true)\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/preload-viewport/test/index.test.js","skipped":false,"dir":"test"},{"name":"should inject script on hover with prefetching disabled","suites":["Prefetching Links in viewport"],"updatePoint":{"line":224,"column":61},"line":224,"code":"  it('should inject script on hover with prefetching disabled', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/prefetch-disabled')\n      await waitFor(2 * 1000)\n\n      const links = await browser.elementsByCss('link[rel=prefetch]')\n      let foundLink = false\n\n      for (const link of links) {\n        const href = await link.getAttribute('href')\n        if (href.includes('another')) {\n          foundLink = true\n          break\n        }\n      }\n      expect(foundLink).toBe(false)\n\n      async function hasAnotherScript() {\n        const scripts = await browser.elementsByCss(\n          // Mouse hover is a high-priority fetch\n          'script:not([async])'\n        )\n        let scriptFound = false\n        for (const aScript of scripts) {\n          const href = await aScript.getAttribute('src')\n          if (href.includes('another')) {\n            scriptFound = true\n            break\n          }\n        }\n        return scriptFound\n      }\n\n      expect(await hasAnotherScript()).toBe(false)\n      await browser.elementByCss('#link-another').moveTo()\n      await waitFor(2 * 1000)\n      expect(await hasAnotherScript()).toBe(true)\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/preload-viewport/test/index.test.js","skipped":false,"dir":"test"},{"name":"should inject script on hover with prefetching disabled and fetch data","suites":["Prefetching Links in viewport"],"updatePoint":{"line":267,"column":76},"line":267,"code":"  it('should inject script on hover with prefetching disabled and fetch data', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/prefetch-disabled-ssg')\n\n      async function hasSsgScript() {\n        const scripts = await browser.elementsByCss(\n          // Mouse hover is a high-priority fetch\n          'script:not([async])'\n        )\n        let scriptFound = false\n        for (const aScript of scripts) {\n          const href = await aScript.getAttribute('src')\n          if (href.includes('basic')) {\n            scriptFound = true\n            break\n          }\n        }\n        return scriptFound\n      }\n\n      await waitFor(2 * 1000)\n      expect(await hasSsgScript()).toBe(false)\n      const hrefs = await browser.eval(`Object.keys(window.next.router.sdc)`)\n      expect(hrefs.map((href) => new URL(href).pathname)).toEqual([])\n      await browser.elementByCss('#link-ssg').moveTo()\n      await waitFor(2 * 1000)\n      expect(await hasSsgScript()).toBe(true)\n      const hrefs2 = await browser.eval(`Object.keys(window.next.router.sdc)`)\n      expect(hrefs2.map((href) => new URL(href).pathname)).toEqual([\n        '/_next/data/test-build/ssg/basic.json',\n      ])\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/preload-viewport/test/index.test.js","skipped":false,"dir":"test"},{"name":"should inject a <script> tag when onMouseEnter (even with invalid ref)","suites":["Prefetching Links in viewport"],"updatePoint":{"line":304,"column":76},"line":304,"code":"  it('should inject a <script> tag when onMouseEnter (even with invalid ref)', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/invalid-ref')\n      await browser.elementByCss('#btn-link').moveTo()\n      await waitFor(2 * 1000)\n\n      const scripts = await browser.elementsByCss(\n        // Mouse hover is a high-priority fetch\n        'script:not([async])'\n      )\n      let scriptFound = false\n      for (const aScript of scripts) {\n        const href = await aScript.getAttribute('src')\n        if (href.includes('another')) {\n          scriptFound = true\n          break\n        }\n      }\n      expect(scriptFound).toBe(true)\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/preload-viewport/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have unhandledRejection when failing to prefetch on link","suites":["Prefetching Links in viewport"],"updatePoint":{"line":329,"column":73},"line":329,"code":"  it('should not have unhandledRejection when failing to prefetch on link', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.eval(`(function() {\n      window.addEventListener('unhandledrejection', function (err) {\n        window.hadUnhandledReject = true;\n      })\n      window.next.router.push('/invalid-prefetch');\n    })()`)\n\n    expect(await browser.eval('window.hadUnhandledReject')).toBeFalsy()\n\n    await browser.waitForElementByCss('#invalid-link')\n    await browser.elementByCss('#invalid-link').moveTo()\n    expect(await browser.eval('window.hadUnhandledReject')).toBeFalsy()\n  })","file":"integration/preload-viewport/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not prefetch when prefetch is explicitly set to false","suites":["Prefetching Links in viewport"],"updatePoint":{"line":345,"column":66},"line":345,"code":"  it('should not prefetch when prefetch is explicitly set to false', async () => {\n    const browser = await webdriver(appPort, '/opt-out')\n\n    const links = await browser.elementsByCss('link[rel=prefetch]')\n    let found = false\n\n    for (const link of links) {\n      const href = await link.getAttribute('href')\n      if (href.includes('another')) {\n        found = true\n        break\n      }\n    }\n    expect(found).toBe(false)\n  })","file":"integration/preload-viewport/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not prefetch already loaded scripts","suites":["Prefetching Links in viewport"],"updatePoint":{"line":361,"column":48},"line":361,"code":"  it('should not prefetch already loaded scripts', async () => {\n    const browser = await webdriver(appPort, '/')\n\n    const scriptSrcs = await browser.eval(`(function() {\n      return Array.from(document.querySelectorAll('script'))\n        .map(function(el) {\n          return el.src && new URL(el.src).pathname\n        }).filter(Boolean)\n    })()`)\n\n    await browser.eval('next.router.prefetch(\"/\")')\n\n    const linkHrefs = await browser.eval(`(function() {\n      return Array.from(document.querySelectorAll('link'))\n        .map(function(el) {\n          return el.href && new URL(el.href).pathname\n        }).filter(Boolean)\n    })()`)\n\n    console.log({ linkHrefs, scriptSrcs })\n    expect(scriptSrcs.some((src) => src.includes('pages/index-'))).toBe(true)\n    expect(linkHrefs.some((href) => href.includes('pages/index-'))).toBe(false)\n  })","file":"integration/preload-viewport/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not duplicate prefetches","suites":["Prefetching Links in viewport"],"updatePoint":{"line":385,"column":37},"line":385,"code":"  it('should not duplicate prefetches', async () => {\n    const browser = await webdriver(appPort, '/multi-prefetch')\n\n    const links = await browser.elementsByCss('link[rel=prefetch]')\n\n    const hrefs = []\n    for (const link of links) {\n      const href = await link.getAttribute('href')\n      hrefs.push(href)\n    }\n    hrefs.sort()\n\n    // Ensure no duplicates\n    expect(hrefs).toEqual([...new Set(hrefs)])\n\n    // Verify encoding\n    expect(hrefs.some((e) => e.includes(`%5Bhello%5D-`))).toBe(true)\n  })","file":"integration/preload-viewport/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not add an another observer for a prefetched page","suites":["Prefetching Links in viewport"],"updatePoint":{"line":404,"column":62},"line":404,"code":"  it('should not add an another observer for a prefetched page', async () => {\n    // info: both `/` and `/de-duped` ref the `/first` page, which we don't\n    // want to be re-fetched/re-observed.\n    const browser = await webdriver(appPort, '/')\n    await browser.eval(`(function() {\n      window.calledPrefetch = false\n      window.next.router.prefetch = function() {\n        window.calledPrefetch = true\n        return Promise.resolve()\n      }\n      window.next.router.push('/de-duped')\n    })()`)\n    await waitFor(2 * 1000)\n    const calledPrefetch = await browser.eval(`window.calledPrefetch`)\n    expect(calledPrefetch).toBe(false)\n  })","file":"integration/preload-viewport/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prefetch with a different asPath for a prefetched page","suites":["Prefetching Links in viewport"],"updatePoint":{"line":421,"column":67},"line":421,"code":"  it('should prefetch with a different asPath for a prefetched page', async () => {\n    // info: both `/` and `/not-de-duped` ref the `/first` page, which we want\n    // to see prefetched twice.\n    const browser = await webdriver(appPort, '/')\n    await browser.eval(`(function() {\n      window.calledPrefetch = false\n      window.next.router.prefetch = function() {\n        window.calledPrefetch = true\n        return Promise.resolve()\n      }\n      window.next.router.push('/not-de-duped')\n    })()`)\n    await waitFor(2 * 1000)\n    const calledPrefetch = await browser.eval(`window.calledPrefetch`)\n    expect(calledPrefetch).toBe(true)\n  })","file":"integration/preload-viewport/test/index.test.js","skipped":false,"dir":"test"},{"name":"should correctly omit pre-generated dynamic pages from SSG manifest","suites":["Prefetching Links in viewport"],"updatePoint":{"line":438,"column":73},"line":438,"code":"  it('should correctly omit pre-generated dynamic pages from SSG manifest', async () => {\n    const content = await readFile(\n      join(appDir, '.next', 'static', 'test-build', '_ssgManifest.js'),\n      'utf8'\n    )\n\n    let self = {}\n    // eslint-disable-next-line no-eval\n    eval(content)\n    expect([...self.__SSG_MANIFEST].sort()).toMatchInlineSnapshot(`\n      Array [\n        \"/[...rest]\",\n        \"/ssg/basic\",\n        \"/ssg/catch-all/[...slug]\",\n        \"/ssg/dynamic-nested/[slug1]/[slug2]\",\n        \"/ssg/dynamic/[slug]\",\n        \"/ssg/slow\",\n      ]\n    `)\n  })","file":"integration/preload-viewport/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prefetch data files","suites":["Prefetching Links in viewport"],"updatePoint":{"line":459,"column":32},"line":459,"code":"  it('should prefetch data files', async () => {\n    const browser = await webdriver(appPort, '/ssg/fixture')\n    await waitFor(2 * 1000) // wait for prefetching to occur\n\n    const hrefs = await browser.eval(`Object.keys(window.next.router.sdc)`)\n    hrefs.sort()\n\n    expect(hrefs.map((href) => new URL(href).pathname)).toEqual([\n      '/_next/data/test-build/ssg/basic.json',\n      '/_next/data/test-build/ssg/catch-all/foo.json',\n      '/_next/data/test-build/ssg/catch-all/foo/bar.json',\n      '/_next/data/test-build/ssg/catch-all/one.json',\n      '/_next/data/test-build/ssg/catch-all/one/two.json',\n      '/_next/data/test-build/ssg/dynamic-nested/foo/bar.json',\n      '/_next/data/test-build/ssg/dynamic-nested/one/two.json',\n      '/_next/data/test-build/ssg/dynamic/one.json',\n      '/_next/data/test-build/ssg/dynamic/two.json',\n    ])\n  })","file":"integration/preload-viewport/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prefetch data files when mismatched","suites":["Prefetching Links in viewport"],"updatePoint":{"line":479,"column":48},"line":479,"code":"  it('should prefetch data files when mismatched', async () => {\n    const browser = await webdriver(appPort, '/ssg/fixture/mismatch')\n    await waitFor(2 * 1000) // wait for prefetching to occur\n\n    const hrefs = await browser.eval(`Object.keys(window.next.router.sdc)`)\n    hrefs.sort()\n\n    expect(hrefs.map((href) => new URL(href).pathname)).toEqual([\n      '/_next/data/test-build/ssg/catch-all/foo.json',\n      '/_next/data/test-build/ssg/catch-all/foo/bar.json',\n      '/_next/data/test-build/ssg/catch-all/one.json',\n      '/_next/data/test-build/ssg/catch-all/one/two.json',\n      '/_next/data/test-build/ssg/dynamic-nested/foo/bar.json',\n      '/_next/data/test-build/ssg/dynamic-nested/one/two.json',\n      '/_next/data/test-build/ssg/dynamic/one.json',\n      '/_next/data/test-build/ssg/dynamic/two.json',\n    ])\n  })","file":"integration/preload-viewport/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have normalized asPath for fallback page","suites":["Fallback asPath normalizing"],"updatePoint":{"line":33,"column":53},"line":33,"code":"  it('should have normalized asPath for fallback page', async () => {\n    const html = await fetchViaHTTP(appPort, '/blog/[post]', undefined, {\n      headers: {\n        'x-now-route-matches': '1=post-1',\n        'x-vercel-id': 'hi',\n      },\n    }).then((res) => res.text())\n\n    const $ = cheerio.load(html)\n    const asPath = $('#as-path').text()\n    const query = JSON.parse($('#query').text())\n    const params = JSON.parse($('#params').text())\n\n    expect(asPath).toBe('/blog/post-1')\n    expect(query).toEqual({ post: 'post-1' })\n    expect(params).toEqual({ post: 'post-1' })\n  })","file":"integration/prerender-fallback-aspath/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have normalized asPath for fallback page with entry directory","suites":["Fallback asPath normalizing"],"updatePoint":{"line":51,"column":74},"line":51,"code":"  it('should have normalized asPath for fallback page with entry directory', async () => {\n    const html = await fetchViaHTTP(\n      appPort,\n      '/web-app/blog/[post]',\n      undefined,\n      {\n        headers: {\n          'x-now-route-matches': '1=post-abc',\n          'x-vercel-id': 'hi',\n        },\n      }\n    ).then((res) => res.text())\n\n    const $ = cheerio.load(html)\n    const asPath = $('#as-path').text()\n    const query = JSON.parse($('#query').text())\n    const params = JSON.parse($('#params').text())\n\n    expect(asPath).toBe('/web-app/blog/post-abc')\n    expect(query).toEqual({ post: 'post-abc' })\n    expect(params).toEqual({ post: 'post-abc' })\n  })","file":"integration/prerender-fallback-aspath/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have normalized asPath for fallback page multi-params","suites":["Fallback asPath normalizing"],"updatePoint":{"line":74,"column":66},"line":74,"code":"  it('should have normalized asPath for fallback page multi-params', async () => {\n    const html = await fetchViaHTTP(\n      appPort,\n      '/blog/[post]/[comment]',\n      undefined,\n      {\n        headers: {\n          'x-now-route-matches': '1=post-1&2=comment-2',\n          'x-vercel-id': 'hi',\n        },\n      }\n    ).then((res) => res.text())\n\n    const $ = cheerio.load(html)\n    const asPath = $('#as-path').text()\n    const query = JSON.parse($('#query').text())\n    const params = JSON.parse($('#params').text())\n\n    expect(asPath).toBe('/blog/post-1/comment-2')\n    expect(query).toEqual({ post: 'post-1', comment: 'comment-2' })\n    expect(params).toEqual({ post: 'post-1', comment: 'comment-2' })\n  })","file":"integration/prerender-fallback-aspath/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have normalized asPath for fallback page with entry directory multi-params","suites":["Fallback asPath normalizing"],"updatePoint":{"line":97,"column":87},"line":97,"code":"  it('should have normalized asPath for fallback page with entry directory multi-params', async () => {\n    const html = await fetchViaHTTP(\n      appPort,\n      '/web-app/blog/[post]/[comment]',\n      undefined,\n      {\n        headers: {\n          'x-now-route-matches': '1=post-abc&2=comment-cba',\n          'x-vercel-id': 'hi',\n        },\n      }\n    ).then((res) => res.text())\n\n    const $ = cheerio.load(html)\n    const asPath = $('#as-path').text()\n    const query = JSON.parse($('#query').text())\n    const params = JSON.parse($('#params').text())\n\n    expect(asPath).toBe('/web-app/blog/post-abc/comment-cba')\n    expect(query).toEqual({ post: 'post-abc', comment: 'comment-cba' })\n    expect(params).toEqual({ post: 'post-abc', comment: 'comment-cba' })\n  })","file":"integration/prerender-fallback-aspath/test/index.test.js","skipped":false,"dir":"test"},{"name":"should output paths correctly","suites":[],"updatePoint":{"line":59,"column":37},"line":59,"code":"    it('should output paths correctly', async () => {\n      for (const path of prerenderedPaths) {\n        for (const mode of modePaths) {\n          console.log('checking output', { path, mode })\n          expect(await fs.exists(join(pagesDir, mode, path + '.html'))).toBe(\n            true\n          )\n          expect(await fs.exists(join(pagesDir, mode, path + '.json'))).toBe(\n            true\n          )\n        }\n      }\n    })","file":"integration/prerender-fallback-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle non-prerendered paths correctly","suites":[],"updatePoint":{"line":73,"column":53},"line":73,"code":"    it('should handle non-prerendered paths correctly', async () => {\n      const prerenderedPaths = [\n        '%2Fanother-post%2F',\n        '+another-post+',\n        '%3Fanother-post%3F',\n        '&another-post&',\n        '商業日語商業日語',\n      ]\n\n      const urlPaths = [\n        '%2Fanother-post%2F',\n        '%2Banother-post%2B',\n        '%3Fanother-post%3F',\n        '%26another-post%26',\n        encodeURIComponent('商業日語商業日語'),\n      ]\n\n      for (const mode of modePaths) {\n        for (let i = 0; i < urlPaths.length; i++) {\n          const testSlug = urlPaths[i]\n          const path = prerenderedPaths[i]\n\n          const res = await fetchViaHTTP(\n            appPort,\n            `/_next/data/${buildId}/${mode}/${testSlug}.json`\n          )\n\n          if (mode === 'fallback-false') {\n            expect(res.status).toBe(404)\n          } else {\n            expect(res.status).toBe(200)\n\n            const { pageProps: props } = await res.json()\n\n            expect(props.params).toEqual({\n              slug: decodeURIComponent(testSlug),\n            })\n\n            if (!isDev) {\n              // we don't block on writing incremental data to the\n              // disk so use check\n              await check(\n                () =>\n                  fs\n                    .exists(join(pagesDir, mode, path + '.html'))\n                    .then((res) => (res ? 'yes' : 'no')),\n                'yes'\n              )\n              await check(\n                () =>\n                  fs\n                    .exists(join(pagesDir, mode, path + '.json'))\n                    .then((res) => (res ? 'yes' : 'no')),\n                'yes'\n              )\n            }\n\n            const browser = await webdriver(appPort, `/${mode}/${testSlug}`)\n\n            expect(\n              JSON.parse(await browser.elementByCss('#props').text()).params\n            ).toEqual({\n              slug: decodeURIComponent(testSlug),\n            })\n\n            const browserRouter = JSON.parse(\n              await browser.elementByCss('#router').text()\n            )\n\n            expect(browserRouter.pathname).toBe(`/${mode}/[slug]`)\n            expect(browserRouter.asPath).toBe(`/${mode}/${testSlug}`)\n            expect(browserRouter.query).toEqual({\n              slug: decodeURIComponent(testSlug),\n            })\n          }\n        }\n      }\n    })","file":"integration/prerender-fallback-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should respond with the prerendered pages correctly","suites":[],"updatePoint":{"line":153,"column":57},"line":153,"code":"  it('should respond with the prerendered pages correctly', async () => {\n    for (let i = 0; i < urlPaths.length; i++) {\n      const testSlug = urlPaths[i]\n\n      for (const mode of modePaths) {\n        const res = await fetchViaHTTP(\n          appPort,\n          `/${mode}/${testSlug}`,\n          undefined,\n          {\n            redirect: 'manual',\n          }\n        )\n\n        console.log('checking', { mode, testSlug })\n\n        expect(res.status).toBe(200)\n\n        const $ = cheerio.load(await res.text())\n\n        expect(JSON.parse($('#props').text()).params).toEqual({\n          slug: decodeURIComponent(testSlug),\n        })\n        const router = JSON.parse($('#router').text())\n\n        expect(router.pathname).toBe(`/${mode}/[slug]`)\n        expect(router.asPath).toBe(`/${mode}/${testSlug}`)\n        expect(router.query).toEqual({\n          slug: decodeURIComponent(testSlug),\n        })\n      }\n    }\n  })","file":"integration/prerender-fallback-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should respond with the prerendered data correctly","suites":[],"updatePoint":{"line":187,"column":56},"line":187,"code":"  it('should respond with the prerendered data correctly', async () => {\n    for (const path of urlPaths) {\n      for (const mode of modePaths) {\n        const res = await fetchViaHTTP(\n          appPort,\n          `/_next/data/${buildId}/${mode}/${path}.json`,\n          undefined,\n          {\n            redirect: 'manual',\n          }\n        )\n        expect(res.status).toBe(200)\n\n        const { pageProps: props } = await res.json()\n\n        expect(props.params).toEqual({\n          slug: decodeURIComponent(path),\n        })\n      }\n    }\n  })","file":"integration/prerender-fallback-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render correctly in the browser for prerender paths","suites":[],"updatePoint":{"line":209,"column":64},"line":209,"code":"  it('should render correctly in the browser for prerender paths', async () => {\n    for (let i = 0; i < urlPaths.length; i++) {\n      const testSlug = urlPaths[i]\n\n      for (const mode of modePaths) {\n        const browser = await webdriver(appPort, `/${mode}/${testSlug}`)\n\n        expect(\n          JSON.parse(await browser.elementByCss('#props').text()).params\n        ).toEqual({\n          slug: decodeURIComponent(testSlug),\n        })\n\n        const browserRouter = JSON.parse(\n          await browser.elementByCss('#router').text()\n        )\n\n        expect(browserRouter.pathname).toBe(`/${mode}/[slug]`)\n        expect(browserRouter.asPath).toBe(`/${mode}/${testSlug}`)\n        expect(browserRouter.query).toEqual({\n          slug: decodeURIComponent(testSlug),\n        })\n      }\n    }\n  })","file":"integration/prerender-fallback-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate client-side correctly with interpolating","suites":[],"updatePoint":{"line":235,"column":62},"line":235,"code":"  it('should navigate client-side correctly with interpolating', async () => {\n    for (const mode of modePaths) {\n      const testSlug = urlPaths[0]\n      const browser = await webdriver(appPort, `/${mode}/${testSlug}`)\n\n      expect(\n        JSON.parse(await browser.elementByCss('#props').text()).params\n      ).toEqual({\n        slug: decodeURIComponent(testSlug),\n      })\n\n      const browserRouter = JSON.parse(\n        await browser.elementByCss('#router').text()\n      )\n\n      expect(browserRouter.pathname).toBe(`/${mode}/[slug]`)\n      expect(browserRouter.asPath).toBe(`/${mode}/${testSlug}`)\n      expect(browserRouter.query).toEqual({\n        slug: decodeURIComponent(testSlug),\n      })\n\n      await browser.eval('window.beforeNav = 1')\n\n      for (const nextSlug of urlPaths) {\n        if (nextSlug === testSlug) continue\n\n        await browser.eval(`(function() {\n          window.next.router.push({\n            pathname: '/${mode}/[slug]',\n            query: { slug: '${decodeURIComponent(nextSlug)}' }\n          })\n        })()`)\n\n        await check(async () => {\n          const browserRouter = JSON.parse(\n            await browser.elementByCss('#router').text()\n          )\n          return browserRouter.asPath === `/${mode}/${nextSlug}`\n            ? 'success'\n            : 'fail'\n        }, 'success')\n\n        expect(await browser.eval('window.beforeNav')).toBe(1)\n      }\n    }\n  })","file":"integration/prerender-fallback-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate client-side correctly with string href","suites":[],"updatePoint":{"line":282,"column":60},"line":282,"code":"  it('should navigate client-side correctly with string href', async () => {\n    for (const mode of modePaths) {\n      const testSlug = urlPaths[0]\n      const browser = await webdriver(appPort, `/${mode}/${testSlug}`)\n\n      expect(\n        JSON.parse(await browser.elementByCss('#props').text()).params\n      ).toEqual({\n        slug: decodeURIComponent(testSlug),\n      })\n\n      const browserRouter = JSON.parse(\n        await browser.elementByCss('#router').text()\n      )\n\n      expect(browserRouter.pathname).toBe(`/${mode}/[slug]`)\n      expect(browserRouter.asPath).toBe(`/${mode}/${testSlug}`)\n      expect(browserRouter.query).toEqual({\n        slug: decodeURIComponent(testSlug),\n      })\n\n      await browser.eval('window.beforeNav = 1')\n\n      for (const nextSlug of urlPaths) {\n        if (nextSlug === testSlug) continue\n\n        await browser.eval(`(function() {\n          window.next.router.push('/${mode}/${nextSlug}')\n        })()`)\n\n        await check(async () => {\n          const browserRouter = JSON.parse(\n            await browser.elementByCss('#router').text()\n          )\n          return browserRouter.asPath === `/${mode}/${nextSlug}`\n            ? 'success'\n            : 'fail'\n        }, 'success')\n\n        expect(await browser.eval('window.beforeNav')).toBe(1)\n      }\n    }\n  })","file":"integration/prerender-fallback-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail the build","suites":["Invalid Prerender Catchall Params"],"updatePoint":{"line":9,"column":27},"line":9,"code":"  it('should fail the build', async () => {\n    const out = await nextBuild(appDir, [], { stderr: true })\n    expect(out.stderr).toMatch(`Build error occurred`)\n    expect(out.stderr).toMatch(\n      'A required parameter (slug) was not provided as an array in getStaticPaths for /[...slug]'\n    )\n  })","file":"integration/prerender-invalid-catchall-params/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail the build","suites":["Legacy Prerender","handles old getStaticParams"],"updatePoint":{"line":10,"column":29},"line":10,"code":"    it('should fail the build', async () => {\n      const out = await nextBuild(appDir, [], { stderr: true })\n      expect(out.stderr).toMatch(`Build error occurred`)\n      expect(out.stderr).toMatch('Additional keys were returned from')\n      expect(out.stderr).toMatch('return { params: { foo: ..., post: ... } }')\n      expect(out.stderr).toMatch('Keys that need to be moved: foo, baz.')\n    })","file":"integration/prerender-invalid-paths/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail the build in server mode","suites":["Legacy Prerender","handles old getStaticParams"],"updatePoint":{"line":12,"column":44},"line":12,"code":"    it('should fail the build in server mode', async () => {\n      const out = await nextBuild(appDir, [], { stderr: true })\n      expect(out.stderr).toMatch(`Build error occurred`)\n      expect(out.stderr).toMatch(\n        'unstable_getStaticParams was replaced with getStaticPaths. Please update your code.'\n      )\n    })","file":"integration/prerender-legacy/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail the build in serverless mode","suites":["Legacy Prerender","handles old getStaticParams"],"updatePoint":{"line":20,"column":48},"line":20,"code":"    it('should fail the build in serverless mode', async () => {\n      await fs.writeFile(\n        nextConfig,\n        `module.exports = { target: 'serverless' }`\n      )\n      const out = await nextBuild(appDir, [], { stderr: true })\n      await fs.remove(nextConfig)\n      expect(out.stderr).toMatch(`Build error occurred`)\n      expect(out.stderr).toMatch(\n        'unstable_getStaticParams was replaced with getStaticPaths. Please update your code.'\n      )\n    })","file":"integration/prerender-legacy/test/index.test.js","skipped":false,"dir":"test"},{"name":"[] should not revalidate when set to false","suites":[],"updatePoint":{"line":23,"column":56},"line":23,"code":"  it(`[${route}] should not revalidate when set to false`, async () => {\n    const fileName = join(\n      appDir,\n      '.next',\n      serverless ? 'serverless' : 'server',\n      getPageFileFromPagesManifest(appDir, routePath)\n    )\n    const initialHtml = await renderViaHTTP(appPort, route)\n    const initialFileHtml = await fs.readFile(fileName, 'utf8')\n\n    let newHtml = await renderViaHTTP(appPort, route)\n    expect(initialHtml).toBe(newHtml)\n    expect(await fs.readFile(fileName, 'utf8')).toBe(initialFileHtml)\n\n    await waitFor(500)\n\n    newHtml = await renderViaHTTP(appPort, route)\n    expect(initialHtml).toBe(newHtml)\n    expect(await fs.readFile(fileName, 'utf8')).toBe(initialFileHtml)\n\n    await waitFor(500)\n\n    newHtml = await renderViaHTTP(appPort, route)\n    expect(initialHtml).toBe(newHtml)\n    expect(await fs.readFile(fileName, 'utf8')).toBe(initialFileHtml)\n\n    expect(stderr).not.toContain('GSP was re-run')\n  })","file":"integration/prerender-no-revalidate/test/index.test.js","skipped":false,"dir":"test"},{"name":"[] should not revalidate /_next/data when set to false","suites":[],"updatePoint":{"line":52,"column":68},"line":52,"code":"  it(`[${route}] should not revalidate /_next/data when set to false`, async () => {\n    const fileName = join(\n      appDir,\n      '.next',\n      serverless ? 'serverless' : 'server',\n      getPageFileFromPagesManifest(appDir, routePath)\n    )\n    const route = join(`/_next/data/${buildId}`, `${routePath}.json`)\n\n    const initialData = JSON.parse(await renderViaHTTP(appPort, route))\n    const initialFileJson = await fs.readFile(fileName, 'utf8')\n\n    expect(JSON.parse(await renderViaHTTP(appPort, route))).toEqual(initialData)\n    expect(await fs.readFile(fileName, 'utf8')).toBe(initialFileJson)\n    await waitFor(500)\n\n    expect(JSON.parse(await renderViaHTTP(appPort, route))).toEqual(initialData)\n    expect(await fs.readFile(fileName, 'utf8')).toBe(initialFileJson)\n    await waitFor(500)\n\n    expect(JSON.parse(await renderViaHTTP(appPort, route))).toEqual(initialData)\n    expect(await fs.readFile(fileName, 'utf8')).toBe(initialFileJson)\n\n    expect(stderr).not.toContain('GSP was re-run')\n  })","file":"integration/prerender-no-revalidate/test/index.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":[],"updatePoint":{"line":41,"column":33},"line":41,"code":"  it('should compile successfully', async () => {\n    await fs.remove(join(appDir, '.next'))\n    const { code, stdout } = await nextBuild(appDir, [], {\n      stdout: true,\n    })\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should start production application","suites":[],"updatePoint":{"line":51,"column":41},"line":51,"code":"  it('should start production application', async () => {\n    appPort = await findPort()\n    app = await startServer(appDir, appPort)\n  })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return prerendered page on first request","suites":[],"updatePoint":{"line":56,"column":53},"line":56,"code":"  it('should return prerendered page on first request', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    const { nextData, pre, routerData } = getData(html)\n    expect(nextData).toMatchObject({ isFallback: false })\n    expect(nextData.isPreview).toBeUndefined()\n    expect(pre).toBe('false and null')\n    expect(routerData.isPreview).toBe(false)\n  })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return prerendered page on second request","suites":[],"updatePoint":{"line":65,"column":54},"line":65,"code":"  it('should return prerendered page on second request', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    const { nextData, pre, routerData } = getData(html)\n    expect(nextData).toMatchObject({ isFallback: false })\n    expect(nextData.isPreview).toBeUndefined()\n    expect(pre).toBe('false and null')\n    expect(routerData.isPreview).toBe(false)\n  })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should throw error when setting too large of preview data","suites":[],"updatePoint":{"line":74,"column":63},"line":74,"code":"  it('should throw error when setting too large of preview data', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/preview?tooBig=true')\n    expect(res.status).toBe(500)\n    expect(await res.text()).toBe('too big')\n  })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should enable preview mode","suites":[],"updatePoint":{"line":81,"column":32},"line":81,"code":"  it('should enable preview mode', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/preview', { lets: 'goooo' })\n    expect(res.status).toBe(200)\n\n    const originalCookies = res.headers.get('set-cookie').split(',')\n    const cookies = originalCookies.map(cookie.parse)\n\n    expect(originalCookies.every((c) => c.includes('; Secure;'))).toBe(true)\n\n    expect(cookies.length).toBe(2)\n    expect(cookies[0]).toMatchObject({ Path: '/', SameSite: 'None' })\n    expect(cookies[0]).toHaveProperty('__prerender_bypass')\n    expect(cookies[0]).not.toHaveProperty('Max-Age')\n    expect(cookies[1]).toMatchObject({ Path: '/', SameSite: 'None' })\n    expect(cookies[1]).toHaveProperty('__next_preview_data')\n    expect(cookies[1]).not.toHaveProperty('Max-Age')\n\n    previewCookieString =\n      cookie.serialize('__prerender_bypass', cookies[0].__prerender_bypass) +\n      '; ' +\n      cookie.serialize('__next_preview_data', cookies[1].__next_preview_data)\n  })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should expire cookies with a maxAge","suites":[],"updatePoint":{"line":104,"column":41},"line":104,"code":"  it('should expire cookies with a maxAge', async () => {\n    const expiry = '60'\n    const res = await fetchViaHTTP(appPort, '/api/preview', {\n      cookieMaxAge: expiry,\n    })\n    expect(res.status).toBe(200)\n\n    const originalCookies = res.headers.get('set-cookie').split(',')\n    const cookies = originalCookies.map(cookie.parse)\n\n    expect(originalCookies.every((c) => c.includes('; Secure;'))).toBe(true)\n\n    expect(cookies.length).toBe(2)\n    expect(cookies[0]).toMatchObject({ Path: '/', SameSite: 'None' })\n    expect(cookies[0]).toHaveProperty('__prerender_bypass')\n    expect(cookies[0]['Max-Age']).toBe(expiry)\n    expect(cookies[1]).toMatchObject({ Path: '/', SameSite: 'None' })\n    expect(cookies[1]).toHaveProperty('__next_preview_data')\n    expect(cookies[1]['Max-Age']).toBe(expiry)\n  })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should set custom path cookies","suites":[],"updatePoint":{"line":124,"column":36},"line":124,"code":"  it('should set custom path cookies', async () => {\n    const path = '/path'\n    const res = await fetchViaHTTP(appPort, '/api/preview', {\n      cookiePath: path,\n    })\n    expect(res.status).toBe(200)\n\n    const originalCookies = res.headers.get('set-cookie').split(',')\n    const cookies = originalCookies.map(cookie.parse)\n\n    expect(originalCookies.every((c) => c.includes('; Secure;'))).toBe(true)\n\n    expect(cookies.length).toBe(2)\n    expect(cookies[0]).toMatchObject({ Path: path, SameSite: 'None' })\n    expect(cookies[0]).toHaveProperty('__prerender_bypass')\n    expect(cookies[0]['Path']).toBe(path)\n    expect(cookies[0]).toMatchObject({ Path: path, SameSite: 'None' })\n    expect(cookies[1]).toHaveProperty('__next_preview_data')\n    expect(cookies[1]['Path']).toBe(path)\n  })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not return fallback page on preview request","suites":[],"updatePoint":{"line":144,"column":56},"line":144,"code":"  it('should not return fallback page on preview request', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/',\n      {},\n      { headers: { Cookie: previewCookieString } }\n    )\n    const html = await res.text()\n\n    const { nextData, pre, routerData } = getData(html)\n    expect(res.headers.get('cache-control')).toBe(\n      'private, no-cache, no-store, max-age=0, must-revalidate'\n    )\n    expect(nextData).toMatchObject({ isFallback: false, isPreview: true })\n    expect(pre).toBe('true and {\"lets\":\"goooo\"}')\n    expect(routerData.isPreview).toBe(true)\n  })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return correct caching headers for data preview request","suites":[],"updatePoint":{"line":162,"column":68},"line":162,"code":"  it('should return correct caching headers for data preview request', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${encodeURI(await getBuildId())}/index.json`,\n      {},\n      { headers: { Cookie: previewCookieString } }\n    )\n    const json = await res.json()\n\n    expect(res.headers.get('cache-control')).toBe(\n      'private, no-cache, no-store, max-age=0, must-revalidate'\n    )\n    expect(json).toMatchObject({\n      pageProps: {\n        preview: true,\n        previewData: { lets: 'goooo' },\n      },\n    })\n  })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return cookies to be expired on reset request","suites":[],"updatePoint":{"line":182,"column":58},"line":182,"code":"  it('should return cookies to be expired on reset request', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/api/reset',\n      {},\n      { headers: { Cookie: previewCookieString } }\n    )\n    expect(res.status).toBe(200)\n\n    const cookies = res.headers\n      .get('set-cookie')\n      .replace(/(=(?!Lax)\\w{3}),/g, '$1')\n      .split(',')\n      .map(cookie.parse)\n\n    expect(cookies.length).toBe(2)\n    expect(cookies[0]).toMatchObject({\n      Path: '/',\n      SameSite: 'None',\n      Expires: 'Thu 01 Jan 1970 00:00:00 GMT',\n    })\n    expect(cookies[0]).toHaveProperty('__prerender_bypass')\n    expect(cookies[0]).not.toHaveProperty('Max-Age')\n    expect(cookies[1]).toMatchObject({\n      Path: '/',\n      SameSite: 'None',\n      Expires: 'Thu 01 Jan 1970 00:00:00 GMT',\n    })\n    expect(cookies[1]).toHaveProperty('__next_preview_data')\n    expect(cookies[1]).not.toHaveProperty('Max-Age')\n  })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return cookies to be expired on reset request with path specified","suites":[],"updatePoint":{"line":214,"column":78},"line":214,"code":"  it('should return cookies to be expired on reset request with path specified', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/api/reset',\n      { cookiePath: '/blog' },\n      { headers: { Cookie: previewCookieString } }\n    )\n    expect(res.status).toBe(200)\n\n    const cookies = res.headers\n      .get('set-cookie')\n      .replace(/(=(?!Lax)\\w{3}),/g, '$1')\n      .split(',')\n      .map(cookie.parse)\n\n    expect(cookies.length).toBe(2)\n    expect(cookies[0]).toMatchObject({\n      Path: '/blog',\n      SameSite: 'None',\n      Expires: 'Thu 01 Jan 1970 00:00:00 GMT',\n    })\n    expect(cookies[0]).toHaveProperty('__prerender_bypass')\n    expect(cookies[0]).not.toHaveProperty('Max-Age')\n    expect(cookies[1]).toMatchObject({\n      Path: '/blog',\n      SameSite: 'None',\n      Expires: 'Thu 01 Jan 1970 00:00:00 GMT',\n    })\n    expect(cookies[1]).toHaveProperty('__next_preview_data')\n    expect(cookies[1]).not.toHaveProperty('Max-Age')\n  })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should pass undefined to API routes when not in preview","suites":[],"updatePoint":{"line":246,"column":61},"line":246,"code":"  it('should pass undefined to API routes when not in preview', async () => {\n    const res = await fetchViaHTTP(appPort, `/api/read`)\n    const json = await res.json()\n\n    expect(json).toMatchObject({})\n  })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should pass the preview data to API routes","suites":[],"updatePoint":{"line":252,"column":48},"line":252,"code":"  it('should pass the preview data to API routes', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/api/read',\n      {},\n      { headers: { Cookie: previewCookieString } }\n    )\n    const json = await res.json()\n\n    expect(json).toMatchObject({\n      preview: true,\n      previewData: { lets: 'goooo' },\n    })\n  })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should start development application","suites":["Prerender Preview Mode","Development Mode"],"updatePoint":{"line":289,"column":44},"line":289,"code":"    it('should start development application', async () => {\n      appPort = await findPort()\n      app = await launchApp(appDir, appPort)\n    })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should enable preview mode","suites":["Prerender Preview Mode","Development Mode"],"updatePoint":{"line":295,"column":34},"line":295,"code":"    it('should enable preview mode', async () => {\n      const res = await fetchViaHTTP(appPort, '/api/preview', { lets: 'goooo' })\n      expect(res.status).toBe(200)\n\n      const cookies = res.headers.get('set-cookie').split(',').map(cookie.parse)\n\n      expect(cookies.length).toBe(2)\n      previewCookieString =\n        cookie.serialize('__prerender_bypass', cookies[0].__prerender_bypass) +\n        '; ' +\n        cookie.serialize('__next_preview_data', cookies[1].__next_preview_data)\n    })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return cookies to be expired after dev server reboot","suites":["Prerender Preview Mode","Development Mode"],"updatePoint":{"line":308,"column":67},"line":308,"code":"    it('should return cookies to be expired after dev server reboot', async () => {\n      await killApp(app)\n      app = await launchApp(appDir, appPort)\n\n      const res = await fetchViaHTTP(\n        appPort,\n        '/',\n        {},\n        { headers: { Cookie: previewCookieString } }\n      )\n      expect(res.status).toBe(200)\n\n      const body = await res.text()\n      // \"err\":{\"name\":\"TypeError\",\"message\":\"Cannot read property 'previewModeId' of undefined\"\n      expect(body).not.toContain('err')\n      expect(body).not.toContain('TypeError')\n      expect(body).not.toContain('previewModeId')\n\n      const cookies = res.headers\n        .get('set-cookie')\n        .replace(/(=(?!Lax)\\w{3}),/g, '$1')\n        .split(',')\n        .map(cookie.parse)\n\n      expect(cookies.length).toBe(2)\n    })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should start the client-side browser","suites":["Prerender Preview Mode","Development Mode"],"updatePoint":{"line":337,"column":44},"line":337,"code":"    it('should start the client-side browser', async () => {\n      browser = await webdriver(\n        appPort,\n        '/api/preview?' + qs.stringify({ client: 'mode' })\n      )\n    })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fetch preview data on SSR","suites":["Prerender Preview Mode","Development Mode"],"updatePoint":{"line":344,"column":40},"line":344,"code":"    it('should fetch preview data on SSR', async () => {\n      await browser.get(`http://localhost:${appPort}/`)\n      await browser.waitForElementByCss('#props-pre')\n      // expect(await browser.elementById('props-pre').text()).toBe('Has No Props')\n      // await new Promise(resolve => setTimeout(resolve, 2000))\n      expect(await browser.elementById('props-pre').text()).toBe(\n        'true and {\"client\":\"mode\"}'\n      )\n    })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fetch preview data on CST","suites":["Prerender Preview Mode","Development Mode"],"updatePoint":{"line":354,"column":40},"line":354,"code":"    it('should fetch preview data on CST', async () => {\n      await browser.get(`http://localhost:${appPort}/to-index`)\n      await browser.waitForElementByCss('#to-index')\n      await browser.eval('window.itdidnotrefresh = \"hello\"')\n      await browser.elementById('to-index').click()\n      await browser.waitForElementByCss('#props-pre')\n      expect(await browser.eval('window.itdidnotrefresh')).toBe('hello')\n      expect(await browser.elementById('props-pre').text()).toBe(\n        'true and {\"client\":\"mode\"}'\n      )\n    })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fetch prerendered data","suites":["Prerender Preview Mode","Development Mode"],"updatePoint":{"line":366,"column":37},"line":366,"code":"    it('should fetch prerendered data', async () => {\n      await browser.get(`http://localhost:${appPort}/api/reset`)\n\n      await browser.get(`http://localhost:${appPort}/`)\n      await browser.waitForElementByCss('#props-pre')\n      expect(await browser.elementById('props-pre').text()).toBe(\n        'false and null'\n      )\n    })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fetch live static props with preview active","suites":["Prerender Preview Mode","Development Mode"],"updatePoint":{"line":376,"column":58},"line":376,"code":"    it('should fetch live static props with preview active', async () => {\n      await browser.get(`http://localhost:${appPort}/`)\n\n      await browser.waitForElementByCss('#ssg-random')\n      const initialRandom = await browser.elementById('ssg-random').text()\n\n      // reload static props with router.replace\n      await browser.elementById('reload-props').click()\n\n      // wait for route change to complete and set updated state\n      await browser.waitForElementByCss('#ssg-reloaded')\n\n      // assert that the random number from static props has changed (thus, was re-evaluated)\n      expect(await browser.elementById('ssg-random').text()).not.toBe(\n        initialRandom\n      )\n    })","file":"integration/prerender-preview/test/index.test.js","skipped":false,"dir":"test"},{"name":"[] should regenerate page when revalidate time exceeded","suites":[],"updatePoint":{"line":21,"column":69},"line":21,"code":"  it(`[${route}] should regenerate page when revalidate time exceeded`, async () => {\n    const fileName = join(\n      appDir,\n      '.next',\n      'server',\n      getPageFileFromPagesManifest(appDir, routePath).replace('.js', '.html')\n    )\n    const initialHtmlFile = await fs.readFile(fileName, 'utf8')\n\n    await waitFor(1000) // Wait revalidate duration\n\n    expect(await renderViaHTTP(appPort, route)).toBe(initialHtmlFile)\n\n    await waitFor(500) // Wait for regeneration to occur\n\n    const regeneratedFileHtml = await fs.readFile(fileName, 'utf8')\n    expect(regeneratedFileHtml).not.toBe(initialHtmlFile)\n    expect(await renderViaHTTP(appPort, route)).toBe(regeneratedFileHtml)\n  })","file":"integration/prerender-revalidate/test/index.test.js","skipped":false,"dir":"test"},{"name":"[] should regenerate /_next/data when revalidate time exceeded","suites":[],"updatePoint":{"line":41,"column":76},"line":41,"code":"  it(`[${route}] should regenerate /_next/data when revalidate time exceeded`, async () => {\n    const fileName = join(\n      appDir,\n      '.next',\n      'server',\n      getPageFileFromPagesManifest(appDir, routePath).replace('.js', '.json')\n    )\n    const route = join(`/_next/data/${buildId}`, `${routePath}.json`)\n    const initialFileJson = await fs.readFile(fileName, 'utf8')\n\n    await waitFor(1000) // Wait revalidate duration\n\n    expect(JSON.parse(await renderViaHTTP(appPort, route))).toEqual(\n      JSON.parse(initialFileJson)\n    )\n\n    await waitFor(500) // Wait for regeneration to occur\n\n    const regeneratedFileJson = await fs.readFile(fileName, 'utf8')\n    expect(regeneratedFileJson).not.toBe(initialFileJson)\n    expect(JSON.parse(await renderViaHTTP(appPort, route))).toEqual(\n      JSON.parse(regeneratedFileJson)\n    )\n  })","file":"integration/prerender-revalidate/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate between pages successfully","suites":[],"updatePoint":{"line":26,"column":48},"line":26,"code":"  it('should navigate between pages successfully', async () => {\n    const toBuild = [\n      '/',\n      '/another',\n      '/something',\n      '/normal',\n      '/blog/post-1',\n      '/blog/post-1/comment-1',\n      '/catchall/first',\n    ]\n\n    await waitFor(2500)\n\n    await Promise.all(toBuild.map((pg) => renderViaHTTP(appPort, pg)))\n\n    const browser = await webdriver(appPort, '/')\n    let text = await browser.elementByCss('p').text()\n    expect(text).toMatch(/hello.*?world/)\n\n    // go to /another\n    async function goFromHomeToAnother() {\n      await browser.eval('window.beforeAnother = true')\n      await browser.elementByCss('#another').click()\n      await browser.waitForElementByCss('#home')\n      text = await browser.elementByCss('p').text()\n      expect(await browser.eval('window.beforeAnother')).toBe(true)\n      expect(text).toMatch(/hello.*?world/)\n    }\n    await goFromHomeToAnother()\n\n    // go to /\n    async function goFromAnotherToHome() {\n      await browser.eval('window.didTransition = 1')\n      await browser.elementByCss('#home').click()\n      await browser.waitForElementByCss('#another')\n      text = await browser.elementByCss('p').text()\n      expect(text).toMatch(/hello.*?world/)\n      expect(await browser.eval('window.didTransition')).toBe(1)\n    }\n    await goFromAnotherToHome()\n\n    // Client-side SSG data caching test\n    // eslint-disable-next-line no-lone-blocks\n    {\n      // Let revalidation period lapse\n      await waitFor(2000)\n\n      // Trigger revalidation (visit page)\n      await goFromHomeToAnother()\n      const snapTime = await browser.elementByCss('#anotherTime').text()\n\n      // Wait for revalidation to finish\n      await waitFor(2000)\n\n      // Re-visit page\n      await goFromAnotherToHome()\n      await goFromHomeToAnother()\n\n      const nextTime = await browser.elementByCss('#anotherTime').text()\n      if (dev) {\n        expect(snapTime).not.toMatch(nextTime)\n      } else {\n        expect(snapTime).toMatch(nextTime)\n      }\n\n      // Reset to Home for next test\n      await goFromAnotherToHome()\n    }\n\n    // go to /something\n    await browser.elementByCss('#something').click()\n    await browser.waitForElementByCss('#home')\n    text = await browser.elementByCss('p').text()\n    expect(text).toMatch(/hello.*?world/)\n    expect(await browser.eval('window.didTransition')).toBe(1)\n\n    // go to /\n    await browser.elementByCss('#home').click()\n    await browser.waitForElementByCss('#post-1')\n\n    // go to /blog/post-1\n    await browser.elementByCss('#post-1').click()\n    await browser.waitForElementByCss('#home')\n    text = await browser.elementByCss('p').text()\n    expect(text).toMatch(/Post:.*?post-1/)\n    expect(await browser.eval('window.didTransition')).toBe(1)\n\n    // go to /\n    await browser.elementByCss('#home').click()\n    await browser.waitForElementByCss('#comment-1')\n\n    // go to /index\n    await browser.elementByCss('#to-nested-index').click()\n    await browser.waitForElementByCss('#home')\n    text = await browser.elementByCss('p').text()\n    expect(text).toMatch(/hello nested index/)\n\n    // go to /\n    await browser.elementByCss('#home').click()\n    await browser.waitForElementByCss('#comment-1')\n\n    // go to /catchall-optional\n    await browser.elementByCss('#catchall-optional-root').click()\n    await browser.waitForElementByCss('#home')\n    text = await browser.elementByCss('p').text()\n    expect(text).toMatch(/Catch all: \\[\\]/)\n    expect(await browser.eval('window.didTransition')).toBe(1)\n\n    // go to /\n    await browser.elementByCss('#home').click()\n    await browser.waitForElementByCss('#comment-1')\n\n    // go to /dynamic/[first]\n    await browser.elementByCss('#dynamic-first').click()\n    await browser.waitForElementByCss('#home')\n    text = await browser.elementByCss('#param').text()\n    expect(text).toMatch(/Hi \\[first\\]!/)\n    expect(await browser.eval('window.didTransition')).toBe(1)\n\n    // go to /\n    await browser.elementByCss('#home').click()\n    await browser.waitForElementByCss('#comment-1')\n\n    // go to /dynamic/[second]\n    await browser.elementByCss('#dynamic-second').click()\n    await browser.waitForElementByCss('#home')\n    text = await browser.elementByCss('#param').text()\n    expect(text).toMatch(/Hi \\[second\\]!/)\n    expect(await browser.eval('window.didTransition')).toBe(1)\n\n    // go to /\n    await browser.elementByCss('#home').click()\n    await browser.waitForElementByCss('#comment-1')\n\n    // go to /catchall-explicit/[first]/[second]\n    await browser.elementByCss('#catchall-explicit-string').click()\n    await browser.waitForElementByCss('#home')\n    text = await browser.elementByCss('#catchall').text()\n    expect(text).toMatch(/Hi \\[first\\] \\[second\\]/)\n    expect(await browser.eval('window.didTransition')).toBe(1)\n\n    // go to /\n    await browser.elementByCss('#home').click()\n    await browser.waitForElementByCss('#comment-1')\n\n    // go to /catchall-explicit/[first]/[second]\n    await browser.elementByCss('#catchall-explicit-object').click()\n    await browser.waitForElementByCss('#home')\n    text = await browser.elementByCss('#catchall').text()\n    expect(text).toMatch(/Hi \\[third\\] \\[fourth\\]/)\n    expect(await browser.eval('window.didTransition')).toBe(1)\n\n    // go to /\n    await browser.elementByCss('#home').click()\n    await browser.waitForElementByCss('#comment-1')\n\n    // go to /catchall-optional/value\n    await browser.elementByCss('#catchall-optional-value').click()\n    await browser.waitForElementByCss('#home')\n    text = await browser.elementByCss('p').text()\n    expect(text).toMatch(/Catch all: \\[value\\]/)\n    expect(await browser.eval('window.didTransition')).toBe(1)\n\n    // go to /\n    await browser.elementByCss('#home').click()\n    await browser.waitForElementByCss('#comment-1')\n\n    // go to /blog/post-1/comment-1\n    await browser.elementByCss('#comment-1').click()\n    await browser.waitForElementByCss('#home')\n    text = await browser.elementByCss('p:nth-child(2)').text()\n    expect(text).toMatch(/Comment:.*?comment-1/)\n    expect(await browser.eval('window.didTransition')).toBe(1)\n\n    // go to /catchall/first\n    await browser.elementByCss('#home').click()\n    await browser.waitForElementByCss('#to-catchall')\n    await browser.elementByCss('#to-catchall').click()\n    await browser.waitForElementByCss('#catchall')\n    text = await browser.elementByCss('#catchall').text()\n    expect(text).toMatch(/Hi.*?first/)\n    expect(await browser.eval('window.didTransition')).toBe(1)\n\n    await browser.close()\n  })","file":"integration/prerender/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with firebase import and getStaticPaths","suites":["SSG Prerender","dev mode getStaticPaths"],"updatePoint":{"line":233,"column":59},"line":233,"code":"    it('should work with firebase import and getStaticPaths', async () => {\n      const html = await renderViaHTTP(appPort, '/blog/post-1')\n      expect(html).toContain('post-1')\n      expect(html).not.toContain('Error: Failed to load')\n\n      const html2 = await renderViaHTTP(appPort, '/blog/post-1')\n      expect(html2).toContain('post-1')\n      expect(html2).not.toContain('Error: Failed to load')\n    })","file":"integration/prerender/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not cache getStaticPaths errors","suites":["SSG Prerender","dev mode getStaticPaths"],"updatePoint":{"line":243,"column":46},"line":243,"code":"    it('should not cache getStaticPaths errors', async () => {\n      const errMsg = /The `fallback` key must be returned from getStaticPaths/\n      await check(() => renderViaHTTP(appPort, '/blog/post-1'), /post-1/)\n\n      const blogPage = join(appDir, 'pages/blog/[post]/index.js')\n      const origContent = await fs.readFile(blogPage, 'utf8')\n      await fs.writeFile(\n        blogPage,\n        origContent.replace('fallback: true,', '/* fallback: true, */')\n      )\n\n      try {\n        await check(() => renderViaHTTP(appPort, '/blog/post-1'), errMsg)\n\n        await fs.writeFile(blogPage, origContent)\n        await check(() => renderViaHTTP(appPort, '/blog/post-1'), /post-1/)\n      } finally {\n        await fs.writeFile(blogPage, origContent)\n      }\n    })","file":"integration/prerender/test/index.test.js","skipped":false,"dir":"test"},{"name":"should copy prerender files and honor exportTrailingSlash","suites":["SSG Prerender","export mode"],"updatePoint":{"line":359,"column":65},"line":359,"code":"    it('should copy prerender files and honor exportTrailingSlash', async () => {\n      const routes = [\n        '/another',\n        '/something',\n        '/blog/post-1',\n        '/blog/post-2/comment-2',\n      ]\n\n      for (const route of routes) {\n        await fs.access(join(exportDir, `${route}/index.html`))\n        await fs.access(join(exportDir, '_next/data', buildId, `${route}.json`))\n      }\n    })","file":"integration/prerender/test/index.test.js","skipped":false,"dir":"test"},{"name":"should get preview cookie correctly","suites":[],"updatePoint":{"line":38,"column":41},"line":38,"code":"  it('should get preview cookie correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/enable')\n    previewCookie = ''\n\n    expect(res.headers.get('set-cookie')).toMatch(\n      /(__prerender_bypass|__next_preview_data)/\n    )\n\n    res.headers\n      .get('set-cookie')\n      .split(',')\n      .forEach((c) => {\n        c = cookie.parse(c)\n        const isBypass = c.__prerender_bypass\n\n        if (isBypass || c.__next_preview_data) {\n          if (previewCookie) previewCookie += '; '\n\n          previewCookie += `${\n            isBypass ? '__prerender_bypass' : '__next_preview_data'\n          }=${c[isBypass ? '__prerender_bypass' : '__next_preview_data']}`\n        }\n      })\n  })","file":"integration/preview-fallback/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not write preview index SSG page to cache","suites":[],"updatePoint":{"line":63,"column":54},"line":63,"code":"  it('should not write preview index SSG page to cache', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    const props = JSON.parse(cheerio.load(html)('#props').text())\n\n    expect(props).toEqual({\n      preview: false,\n      previewData: null,\n    })\n\n    const res = await fetchViaHTTP(appPort, '/', undefined, {\n      headers: {\n        cookie: previewCookie,\n      },\n    })\n\n    const previewHtml = await res.text()\n    const previewProps = JSON.parse(cheerio.load(previewHtml)('#props').text())\n    expect(previewProps).toEqual({\n      preview: true,\n      previewData: {},\n    })\n\n    if (!isDev) {\n      const fsHtml = await fs.readFile(getCacheFile('index.html', serverless))\n      const fsProps = JSON.parse(cheerio.load(fsHtml)('#props').text())\n\n      expect(fsProps).toEqual({\n        preview: false,\n        previewData: null,\n      })\n    }\n    const html2 = await renderViaHTTP(appPort, '/')\n    const props2 = JSON.parse(cheerio.load(html2)('#props').text())\n\n    expect(props2).toEqual({\n      preview: false,\n      previewData: null,\n    })\n  })","file":"integration/preview-fallback/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not write preview dynamic prerendered SSG page to cache no fallback","suites":[],"updatePoint":{"line":103,"column":80},"line":103,"code":"  it('should not write preview dynamic prerendered SSG page to cache no fallback', async () => {\n    const html = await renderViaHTTP(appPort, '/no-fallback/first')\n    const props = JSON.parse(cheerio.load(html)('#props').text())\n\n    expect(props).toEqual({\n      preview: false,\n      previewData: null,\n      params: { post: 'first' },\n    })\n\n    const res = await fetchViaHTTP(appPort, '/no-fallback/first', undefined, {\n      headers: {\n        cookie: previewCookie,\n      },\n    })\n\n    const previewHtml = await res.text()\n    const previewProps = JSON.parse(cheerio.load(previewHtml)('#props').text())\n    expect(previewProps).toEqual({\n      preview: true,\n      previewData: {},\n      params: { post: 'first' },\n    })\n\n    if (!isDev) {\n      const fsHtml = await fs.readFile(\n        getCacheFile('no-fallback/first.html', serverless)\n      )\n      const fsProps = JSON.parse(cheerio.load(fsHtml)('#props').text())\n\n      expect(fsProps).toEqual({\n        preview: false,\n        previewData: null,\n        params: { post: 'first' },\n      })\n    }\n    const html2 = await renderViaHTTP(appPort, '/no-fallback/first')\n    const props2 = JSON.parse(cheerio.load(html2)('#props').text())\n\n    expect(props2).toEqual({\n      preview: false,\n      previewData: null,\n      params: { post: 'first' },\n    })\n  })","file":"integration/preview-fallback/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not write preview dynamic SSG page to cache no fallback","suites":[],"updatePoint":{"line":149,"column":68},"line":149,"code":"  it('should not write preview dynamic SSG page to cache no fallback', async () => {\n    const res1 = await fetchViaHTTP(appPort, '/no-fallback/second')\n    expect(res1.status).toBe(404)\n\n    const res = await fetchViaHTTP(appPort, '/no-fallback/second', undefined, {\n      headers: {\n        cookie: previewCookie,\n      },\n    })\n\n    const previewHtml = await res.text()\n    const previewProps = JSON.parse(cheerio.load(previewHtml)('#props').text())\n    expect(previewProps).toEqual({\n      preview: true,\n      previewData: {},\n      params: { post: 'second' },\n    })\n\n    if (!isDev) {\n      expect(\n        await fs.exists(getCacheFile('no-fallback/second.html', serverless))\n      ).toBe(false)\n    }\n\n    const res2 = await fetchViaHTTP(appPort, '/no-fallback/second')\n    expect(res2.status).toBe(404)\n  })","file":"integration/preview-fallback/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not write preview dynamic prerendered SSG page to cache with fallback","suites":[],"updatePoint":{"line":177,"column":82},"line":177,"code":"  it('should not write preview dynamic prerendered SSG page to cache with fallback', async () => {\n    const html = await renderViaHTTP(appPort, '/fallback/first')\n    const props = JSON.parse(cheerio.load(html)('#props').text())\n\n    expect(props).toEqual({\n      preview: false,\n      previewData: null,\n      params: { post: 'first' },\n    })\n\n    const res = await fetchViaHTTP(appPort, '/fallback/first', undefined, {\n      headers: {\n        cookie: previewCookie,\n      },\n    })\n\n    const previewHtml = await res.text()\n    const previewProps = JSON.parse(cheerio.load(previewHtml)('#props').text())\n    expect(previewProps).toEqual({\n      preview: true,\n      previewData: {},\n      params: { post: 'first' },\n    })\n\n    if (!isDev) {\n      const fsHtml = await fs.readFile(\n        getCacheFile('fallback/first.html', serverless)\n      )\n      const fsProps = JSON.parse(cheerio.load(fsHtml)('#props').text())\n\n      expect(fsProps).toEqual({\n        preview: false,\n        previewData: null,\n        params: { post: 'first' },\n      })\n    }\n    const html2 = await renderViaHTTP(appPort, '/fallback/first')\n    const props2 = JSON.parse(cheerio.load(html2)('#props').text())\n\n    expect(props2).toEqual({\n      preview: false,\n      previewData: null,\n      params: { post: 'first' },\n    })\n  })","file":"integration/preview-fallback/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not write preview dynamic non-prerendered SSG page to cache with fallback","suites":[],"updatePoint":{"line":223,"column":86},"line":223,"code":"  it('should not write preview dynamic non-prerendered SSG page to cache with fallback', async () => {\n    let browser = await webdriver(appPort, '/fallback/second')\n\n    await check(async () => {\n      const props = JSON.parse(await browser.elementByCss('#props').text())\n      return props.params ? 'pass' : 'fail'\n    }, 'pass')\n\n    const props = JSON.parse(await browser.elementByCss('#props').text())\n\n    expect(props).toEqual({\n      preview: false,\n      previewData: null,\n      params: { post: 'second' },\n    })\n\n    const res = await fetchViaHTTP(appPort, '/fallback/second', undefined, {\n      headers: {\n        cookie: previewCookie,\n      },\n    })\n\n    const previewHtml = await res.text()\n    const previewProps = JSON.parse(cheerio.load(previewHtml)('#props').text())\n    expect(previewProps).toEqual({\n      preview: true,\n      previewData: {},\n      params: { post: 'second' },\n    })\n\n    if (!isDev) {\n      const fsHtml = await fs.readFile(\n        getCacheFile('fallback/second.html', serverless)\n      )\n      const fsProps = JSON.parse(cheerio.load(fsHtml)('#props').text())\n\n      expect(fsProps).toEqual({\n        preview: false,\n        previewData: null,\n        params: { post: 'second' },\n      })\n    }\n\n    browser = await webdriver(appPort, '/fallback/second')\n\n    await check(async () => {\n      const props = JSON.parse(await browser.elementByCss('#props').text())\n      return props.params ? 'pass' : 'fail'\n    }, 'pass')\n\n    const props2 = JSON.parse(await browser.elementByCss('#props').text())\n\n    expect(props2).toEqual({\n      preview: false,\n      previewData: null,\n      params: { post: 'second' },\n    })\n  })","file":"integration/preview-fallback/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show missing env value when its not missing public","suites":["process.env stubbing","dev mode","server side"],"updatePoint":{"line":74,"column":71},"line":74,"code":"      it('should not show missing env value when its not missing public', async () => {\n        await checkMissing('/not-missing', 'NEXT_PUBLIC_HI')\n      })","file":"integration/process-env-stub/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show missing env value when its not missing runtime","suites":["process.env stubbing","dev mode","server side"],"updatePoint":{"line":78,"column":72},"line":78,"code":"      it('should not show missing env value when its not missing runtime', async () => {\n        await checkMissing('/also-not-missing', 'I_SHOULD_BE_HERE')\n      })","file":"integration/process-env-stub/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show missing env value when its missing normal","suites":["process.env stubbing","dev mode","server side"],"updatePoint":{"line":82,"column":63},"line":82,"code":"      it('should show missing env value when its missing normal', async () => {\n        await checkMissing('/missing', 'hi', true)\n      })","file":"integration/process-env-stub/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show missing env value when its missing GSP","suites":["process.env stubbing","dev mode","server side"],"updatePoint":{"line":86,"column":60},"line":86,"code":"      it('should show missing env value when its missing GSP', async () => {\n        await checkMissing('/missing-gsp', 'SECRET', true)\n      })","file":"integration/process-env-stub/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show missing env value when its missing GSSP","suites":["process.env stubbing","dev mode","server side"],"updatePoint":{"line":90,"column":61},"line":90,"code":"      it('should show missing env value when its missing GSSP', async () => {\n        await checkMissing('/missing-gssp', 'SECRET', true)\n      })","file":"integration/process-env-stub/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show missing env value when its missing API","suites":["process.env stubbing","dev mode","server side"],"updatePoint":{"line":94,"column":60},"line":94,"code":"      it('should show missing env value when its missing API', async () => {\n        await checkMissing('/api/hi', 'where_is_it', true)\n      })","file":"integration/process-env-stub/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show missing env value when its not missing public","suites":["process.env stubbing","dev mode","client side"],"updatePoint":{"line":100,"column":71},"line":100,"code":"      it('should not show missing env value when its not missing public', async () => {\n        await checkMissingClient('/not-missing', 'NEXT_PUBLIC_HI')\n      })","file":"integration/process-env-stub/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show missing env value when its missing runtime","suites":["process.env stubbing","dev mode","client side"],"updatePoint":{"line":104,"column":64},"line":104,"code":"      it('should show missing env value when its missing runtime', async () => {\n        await checkMissingClient('/also-not-missing', 'I_SHOULD_BE_HERE', true)\n      })","file":"integration/process-env-stub/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show missing env value when its missing normal","suites":["process.env stubbing","dev mode","client side"],"updatePoint":{"line":108,"column":63},"line":108,"code":"      it('should show missing env value when its missing normal', async () => {\n        await checkMissingClient('/missing', 'hi', true)\n      })","file":"integration/process-env-stub/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show missing env value when its not missing public","suites":["process.env stubbing","production mode","server side"],"updatePoint":{"line":128,"column":71},"line":128,"code":"      it('should not show missing env value when its not missing public', async () => {\n        await checkMissing('/not-missing', 'NEXT_PUBLIC_HI')\n      })","file":"integration/process-env-stub/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show missing env value when its not missing runtime","suites":["process.env stubbing","production mode","server side"],"updatePoint":{"line":132,"column":72},"line":132,"code":"      it('should not show missing env value when its not missing runtime', async () => {\n        await checkMissing('/also-not-missing', 'I_SHOULD_BE_HERE')\n      })","file":"integration/process-env-stub/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show missing env value when its missing normal","suites":["process.env stubbing","production mode","server side"],"updatePoint":{"line":136,"column":67},"line":136,"code":"      it('should not show missing env value when its missing normal', async () => {\n        await checkMissing('/missing', 'hi')\n      })","file":"integration/process-env-stub/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show missing env value when its missing GSP","suites":["process.env stubbing","production mode","server side"],"updatePoint":{"line":140,"column":64},"line":140,"code":"      it('should not show missing env value when its missing GSP', async () => {\n        await checkMissing('/missing-gsp', 'SECRET')\n      })","file":"integration/process-env-stub/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show missing env value when its missing GSSP","suites":["process.env stubbing","production mode","server side"],"updatePoint":{"line":144,"column":65},"line":144,"code":"      it('should not show missing env value when its missing GSSP', async () => {\n        await checkMissing('/missing-gssp', 'SECRET')\n      })","file":"integration/process-env-stub/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show missing env value when its missing API","suites":["process.env stubbing","production mode","server side"],"updatePoint":{"line":148,"column":64},"line":148,"code":"      it('should not show missing env value when its missing API', async () => {\n        await checkMissing('/api/hi', 'where_is_it')\n      })","file":"integration/process-env-stub/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show missing env value when its not missing public","suites":["process.env stubbing","production mode","client side"],"updatePoint":{"line":154,"column":71},"line":154,"code":"      it('should not show missing env value when its not missing public', async () => {\n        await checkMissingClient('/not-missing', 'NEXT_PUBLIC_HI')\n      })","file":"integration/process-env-stub/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show missing env value when its missing runtime","suites":["process.env stubbing","production mode","client side"],"updatePoint":{"line":158,"column":68},"line":158,"code":"      it('should not show missing env value when its missing runtime', async () => {\n        await checkMissingClient('/also-not-missing', 'I_SHOULD_BE_HERE')\n      })","file":"integration/process-env-stub/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show missing env value when its missing normal","suites":["process.env stubbing","production mode","client side"],"updatePoint":{"line":162,"column":67},"line":162,"code":"      it('should not show missing env value when its missing normal', async () => {\n        await checkMissingClient('/missing', 'hi')\n      })","file":"integration/process-env-stub/test/index.test.js","skipped":false,"dir":"test"},{"name":"includes sourcemaps for all browser files","suites":[],"updatePoint":{"line":12,"column":47},"line":12,"code":"  it('includes sourcemaps for all browser files', async () => {\n    const browserFiles = await recursiveReadDir(\n      join(appDir, '.next', 'static'),\n      /.*/\n    )\n    const jsFiles = browserFiles.filter(\n      (file) => file.endsWith('.js') && file.includes('/pages/')\n    )\n\n    jsFiles.forEach((file) => {\n      expect(browserFiles.includes(`${file}.map`)).toBe(true)\n    })\n  })","file":"integration/production-browser-sourcemaps/test/index.test.js","skipped":false,"dir":"test"},{"name":"correctly generated the source map","suites":[],"updatePoint":{"line":26,"column":40},"line":26,"code":"  it('correctly generated the source map', async () => {\n    const map = JSON.parse(\n      await fs.readFile(\n        join(\n          appDir,\n          '.next',\n          (await getPageFileFromBuildManifest(appDir, '/static')) + '.map'\n        ),\n        'utf8'\n      )\n    )\n\n    expect(map.sources).toContainEqual(\n      expect.stringMatching(/pages[/\\\\]static\\.js/)\n    )\n    expect(map.names).toContainEqual('StaticPage')\n  })","file":"integration/production-browser-sourcemaps/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page","suites":["Production Custom Build Directory","With basic usage"],"updatePoint":{"line":14,"column":30},"line":14,"code":"    it('should render the page', async () => {\n      const result = await runNextCommand(['build', 'build'], {\n        cwd: join(__dirname, '..'),\n        stdout: true,\n        stderr: true,\n      })\n      expect(result.stderr).toBe('')\n\n      const app = nextServer({\n        dir: join(__dirname, '../build'),\n        dev: false,\n        quiet: true,\n      })\n\n      const server = await startApp(app)\n      const appPort = server.address().port\n\n      const html = await renderViaHTTP(appPort, '/')\n      expect(html).toMatch(/Hello World/)\n\n      await stopApp(server)\n    })","file":"integration/production-build-dir/test/index.test.js","skipped":false,"dir":"test"},{"name":"should add the custom buildid","suites":["Production Config Usage","with generateBuildId"],"updatePoint":{"line":27,"column":37},"line":27,"code":"    it('should add the custom buildid', async () => {\n      const browser = await webdriver(appPort, '/')\n      const text = await browser.elementByCss('#mounted').text()\n      expect(text).toMatch(/ComponentDidMount executed on client\\./)\n\n      const html = await browser.eval('document.documentElement.innerHTML')\n      expect(html).toMatch('custom-buildid')\n      await browser.close()\n    })","file":"integration/production-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail with leading __ in env key","suites":["Production Config Usage","env"],"updatePoint":{"line":39,"column":46},"line":39,"code":"    it('should fail with leading __ in env key', async () => {\n      const result = await runNextCommand(['build', appDir], {\n        env: { ENABLE_ENV_FAIL_UNDERSCORE: true },\n        stdout: true,\n        stderr: true,\n      })\n\n      expect(result.stderr).toMatch(/The key \"__NEXT_MY_VAR\" under/)\n    })","file":"integration/production-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail with NODE_ in env key","suites":["Production Config Usage","env"],"updatePoint":{"line":49,"column":41},"line":49,"code":"    it('should fail with NODE_ in env key', async () => {\n      const result = await runNextCommand(['build', appDir], {\n        env: { ENABLE_ENV_FAIL_NODE: true },\n        stdout: true,\n        stderr: true,\n      })\n\n      expect(result.stderr).toMatch(/The key \"NODE_ENV\" under/)\n    })","file":"integration/production-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail with NEXT_RUNTIME in env key","suites":["Production Config Usage","env"],"updatePoint":{"line":59,"column":48},"line":59,"code":"    it('should fail with NEXT_RUNTIME in env key', async () => {\n      const result = await runNextCommand(['build', appDir], {\n        env: { ENABLE_ENV_NEXT_PRESERVED: true },\n        stdout: true,\n        stderr: true,\n      })\n\n      expect(result.stderr).toMatch(/The key \"NEXT_RUNTIME\" under/)\n    })","file":"integration/production-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"should allow __ within env key","suites":["Production Config Usage","env"],"updatePoint":{"line":69,"column":38},"line":69,"code":"    it('should allow __ within env key', async () => {\n      const result = await runNextCommand(['build', appDir], {\n        env: { ENABLE_ENV_WITH_UNDERSCORES: true },\n        stdout: true,\n        stderr: true,\n      })\n\n      expect(result.stderr).not.toMatch(/The key \"SOME__ENV__VAR\" under/)\n    })","file":"integration/production-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate forward and back correctly","suites":["Production Usage"],"updatePoint":{"line":23,"column":48},"line":23,"code":"  it('should navigate forward and back correctly', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.eval('window.beforeNav = true')\n    await browser.elementByCss('#to-another').click()\n    // waitForElement doesn't seem to work properly in safari 10\n    await waitFor(2000)\n    expect(await browser.eval('window.beforeNav')).toBe(true)\n    await browser.elementByCss('#to-index').click()\n    await waitFor(2000)\n    expect(await browser.eval('window.beforeNav')).toBe(true)\n  })","file":"integration/production-nav/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show error when there is no production build","suites":["Production Usage without production build"],"updatePoint":{"line":11,"column":57},"line":11,"code":"  it('should show error when there is no production build', async () => {\n    await expect(async () => {\n      const srv = nextServer({\n        dir: appDir,\n        dev: false,\n        quiet: true,\n      })\n      await srv.prepare()\n    }).rejects.toThrow(/Could not find a production build in the/)\n  })","file":"integration/production-start-no-build/test/index.test.js","skipped":false,"dir":"test"},{"name":"should contain generated page count in output","suites":["Production Usage with swcMinify"],"updatePoint":{"line":60,"column":51},"line":60,"code":"  it('should contain generated page count in output', async () => {\n    const pageCount = 40\n    expect(output).toContain(`Generating static pages (0/${pageCount})`)\n    expect(output).toContain(\n      `Generating static pages (${pageCount}/${pageCount})`\n    )\n    // we should only have 4 segments and the initial message logged out\n    expect(output.match(/Generating static pages/g).length).toBe(5)\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should output traces","suites":["Production Usage with swcMinify"],"updatePoint":{"line":70,"column":26},"line":70,"code":"  it('should output traces', async () => {\n    const serverTrace = await fs.readJSON(\n      join(appDir, '.next/next-server.js.nft.json')\n    )\n\n    expect(serverTrace.version).toBe(1)\n    expect(\n      serverTrace.files.some((file) =>\n        file.includes('next/dist/shared/lib/page-path/normalize-page-path.js')\n      )\n    ).toBe(true)\n    expect(\n      serverTrace.files.some((file) =>\n        file.includes('next/dist/shared/lib/page-path/normalize-page-path.js')\n      )\n    ).toBe(true)\n    expect(\n      serverTrace.files.some((file) =>\n        file.includes('next/dist/server/render.js')\n      )\n    ).toBe(true)\n    expect(\n      serverTrace.files.some((file) =>\n        file.includes('next/dist/server/load-components.js')\n      )\n    ).toBe(true)\n\n    if (process.platform !== 'win32') {\n      expect(\n        serverTrace.files.some((file) =>\n          file.includes('next/dist/compiled/webpack/bundle5.js')\n        )\n      ).toBe(false)\n      expect(\n        serverTrace.files.some((file) => file.includes('node_modules/sharp'))\n      ).toBe(false)\n    }\n\n    const checks = [\n      {\n        page: '/_app',\n        tests: [\n          /webpack-runtime\\.js/,\n          /node_modules\\/react\\/index\\.js/,\n          /node_modules\\/react\\/package\\.json/,\n          /node_modules\\/react\\/cjs\\/react\\.production\\.min\\.js/,\n        ],\n        notTests: [/\\0/, /\\?/, /!/],\n      },\n      {\n        page: '/client-error',\n        tests: [\n          /webpack-runtime\\.js/,\n          /chunks\\/.*?\\.js/,\n          /node_modules\\/react\\/index\\.js/,\n          /node_modules\\/react\\/package\\.json/,\n          /node_modules\\/react\\/cjs\\/react\\.production\\.min\\.js/,\n          /node_modules\\/next/,\n          /next\\/link\\.js/,\n          /next\\/dist\\/shared\\/lib\\/router\\/utils\\/resolve-rewrites\\.js/,\n          /next\\/error\\.js/,\n        ],\n        notTests: [/\\0/, /\\?/, /!/],\n      },\n      {\n        page: '/dynamic',\n        tests: [\n          /webpack-runtime\\.js/,\n          /chunks\\/.*?\\.js/,\n          /node_modules\\/react\\/index\\.js/,\n          /node_modules\\/react\\/package\\.json/,\n          /node_modules\\/react\\/cjs\\/react\\.production\\.min\\.js/,\n          /node_modules\\/next/,\n          /next\\/link\\.js/,\n          /next\\/dist\\/shared\\/lib\\/router\\/utils\\/resolve-rewrites\\.js/,\n        ],\n        notTests: [/\\0/, /\\?/, /!/],\n      },\n      {\n        page: '/index',\n        tests: [\n          /webpack-runtime\\.js/,\n          /chunks\\/.*?\\.js/,\n          /node_modules\\/react\\/index\\.js/,\n          /node_modules\\/react\\/package\\.json/,\n          /node_modules\\/react\\/cjs\\/react\\.production\\.min\\.js/,\n          /node_modules\\/next/,\n          /next\\/link\\.js/,\n          /next\\/dist\\/shared\\/lib\\/router\\/utils\\/resolve-rewrites\\.js/,\n          /node_modules\\/nanoid\\/index\\.js/,\n          /node_modules\\/nanoid\\/url-alphabet\\/index\\.js/,\n          /node_modules\\/es5-ext\\/array\\/#\\/clear\\.js/,\n        ],\n        notTests: [\n          /next\\/dist\\/pages\\/_error\\.js/,\n          /next\\/error\\.js/,\n          /\\0/,\n          /\\?/,\n          /!/,\n        ],\n      },\n      {\n        page: '/counter',\n        tests: [\n          /webpack-runtime\\.js/,\n          /chunks\\/.*?\\.js/,\n          /node_modules\\/react\\/index\\.js/,\n          /node_modules\\/react\\/package\\.json/,\n          /node_modules\\/react\\/cjs\\/react\\.production\\.min\\.js/,\n          /node_modules\\/react\\/cjs\\/react\\.development\\.js/,\n          /node_modules\\/next/,\n          /next\\/router\\.js/,\n          /next\\/dist\\/shared\\/lib\\/router\\/utils\\/resolve-rewrites\\.js/,\n        ],\n        notTests: [/\\0/, /\\?/, /!/],\n      },\n      {\n        page: '/next-import',\n        tests: [\n          /webpack-runtime\\.js/,\n          /chunks\\/.*?\\.js/,\n          /node_modules\\/react\\/index\\.js/,\n          /node_modules\\/react\\/package\\.json/,\n          /node_modules\\/react\\/cjs\\/react\\.production\\.min\\.js/,\n          /node_modules\\/next/,\n          /next\\/link\\.js/,\n          /next\\/dist\\/shared\\/lib\\/router\\/utils\\/resolve-rewrites\\.js/,\n        ],\n        notTests: [\n          /next\\/dist\\/server\\/next\\.js/,\n          /next\\/dist\\/bin/,\n          /\\0/,\n          /\\?/,\n          /!/,\n        ],\n      },\n    ]\n\n    for (const check of checks) {\n      const contents = await fs.readFile(\n        join(appDir, '.next/server/pages/', check.page + '.js.nft.json'),\n        'utf8'\n      )\n      const { version, files } = JSON.parse(contents)\n      expect(version).toBe(1)\n      expect([...new Set(files)].length).toBe(files.length)\n\n      expect(\n        check.tests.every((item) => {\n          if (files.some((file) => item.test(file))) {\n            return true\n          }\n          console.error(`Failed to find ${item} in`, files)\n          return false\n        })\n      ).toBe(true)\n\n      if (sep === '/') {\n        expect(\n          check.notTests.some((item) => {\n            if (files.some((file) => item.test(file))) {\n              console.error(`Found unexpected ${item} in`, files)\n              return true\n            }\n            return false\n          })\n        ).toBe(false)\n      }\n    }\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should not contain currentScript usage for publicPath","suites":["Production Usage with swcMinify"],"updatePoint":{"line":241,"column":59},"line":241,"code":"  it('should not contain currentScript usage for publicPath', async () => {\n    const globResult = await glob('webpack-*.js', {\n      cwd: join(appDir, '.next/static/chunks'),\n    })\n\n    if (!globResult || globResult.length !== 1) {\n      throw new Error('could not find webpack-hash.js chunk')\n    }\n\n    const content = await fs.readFile(\n      join(appDir, '.next/static/chunks', globResult[0]),\n      'utf8'\n    )\n\n    expect(content).not.toContain('.currentScript')\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should render the page","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":259,"column":30},"line":259,"code":"    it('should render the page', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n      expect(html).toMatch(/Hello World/)\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should handle bad Promise polyfill","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":265,"column":44},"line":265,"code":"      it('should handle bad Promise polyfill', async () => {\n        const browser = await webdriver(appPort, '/bad-promise')\n        expect(await browser.eval('window.didRender')).toBe(true)\n      })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should polyfill RegExp successfully","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":270,"column":45},"line":270,"code":"      it('should polyfill RegExp successfully', async () => {\n        const browser = await webdriver(appPort, '/regexp-polyfill')\n        expect(await browser.eval('window.didRender')).toBe(true)\n        // wait a second for the script to be loaded\n        await waitFor(1000)\n\n        expect(await browser.eval('window.isSticky')).toBe(true)\n        expect(await browser.eval('window.isMatch1')).toBe(true)\n        expect(await browser.eval('window.isMatch2')).toBe(false)\n      })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should polyfill Node.js modules","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":282,"column":39},"line":282,"code":"    it('should polyfill Node.js modules', async () => {\n      const browser = await webdriver(appPort, '/node-browser-polyfills')\n      await browser.waitForCondition('window.didRender')\n\n      const data = await browser\n        .waitForElementByCss('#node-browser-polyfills')\n        .text()\n      const parsedData = JSON.parse(data)\n\n      expect(parsedData.vm).toBe(105)\n      expect(parsedData.hash).toBe(\n        'a07a23e124ae01399e287505c2f7b2e69006540de08562de5ddd01fc7bbef3a5'\n      )\n      expect(parsedData.path).toBe('/hello/world/test.txt')\n      expect(parsedData.buffer).toBe('hello world')\n      expect(parsedData.stream).toBe(true)\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should allow etag header support","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":300,"column":40},"line":300,"code":"    it('should allow etag header support', async () => {\n      const url = `http://localhost:${appPort}/`\n      const etag = (await fetch(url)).headers.get('ETag')\n\n      const headers = { 'If-None-Match': etag }\n      const res2 = await fetch(url, { headers })\n      expect(res2.status).toBe(304)\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should allow etag header support with getStaticProps","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":309,"column":60},"line":309,"code":"    it('should allow etag header support with getStaticProps', async () => {\n      const url = `http://localhost:${appPort}/fully-static`\n      const etag = (await fetch(url)).headers.get('ETag')\n\n      const headers = { 'If-None-Match': etag }\n      const res2 = await fetch(url, { headers })\n      expect(res2.status).toBe(304)\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should allow etag header support with getServerSideProps","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":318,"column":64},"line":318,"code":"    it('should allow etag header support with getServerSideProps', async () => {\n      const url = `http://localhost:${appPort}/fully-dynamic`\n      const etag = (await fetch(url)).headers.get('ETag')\n\n      const headers = { 'If-None-Match': etag }\n      const res2 = await fetch(url, { headers })\n      expect(res2.status).toBe(304)\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should have X-Powered-By header support","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":327,"column":47},"line":327,"code":"    it('should have X-Powered-By header support', async () => {\n      const url = `http://localhost:${appPort}/`\n      const header = (await fetch(url)).headers.get('X-Powered-By')\n\n      expect(header).toBe('Next.js')\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should render 404 for routes that do not exist","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":334,"column":54},"line":334,"code":"    it('should render 404 for routes that do not exist', async () => {\n      const url = `http://localhost:${appPort}/abcdefghijklmno`\n      const res = await fetch(url)\n      const text = await res.text()\n      const $html = cheerio.load(text)\n      expect($html('html').text()).toMatch(/404/)\n      expect(text).toMatch(/\"statusCode\":404/)\n      expect(res.status).toBe(404)\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should render 404 for /_next/static route","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":344,"column":49},"line":344,"code":"    it('should render 404 for /_next/static route', async () => {\n      const html = await renderViaHTTP(appPort, '/_next/static')\n      expect(html).toMatch(/This page could not be found/)\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should render 200 for POST on page","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":349,"column":42},"line":349,"code":"    it('should render 200 for POST on page', async () => {\n      const res = await fetch(`http://localhost:${appPort}/about`, {\n        method: 'POST',\n      })\n      expect(res.status).toBe(200)\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should render 404 for POST on missing page","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":356,"column":50},"line":356,"code":"    it('should render 404 for POST on missing page', async () => {\n      const res = await fetch(`http://localhost:${appPort}/fake-page`, {\n        method: 'POST',\n      })\n      expect(res.status).toBe(404)\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should render 404 for _next routes that do not exist","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":363,"column":60},"line":363,"code":"    it('should render 404 for _next routes that do not exist', async () => {\n      const url = `http://localhost:${appPort}/_next/abcdef`\n      const res = await fetch(url)\n      expect(res.status).toBe(404)\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should render 404 even if the HTTP method is not GET or HEAD","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":369,"column":68},"line":369,"code":"    it('should render 404 even if the HTTP method is not GET or HEAD', async () => {\n      const url = `http://localhost:${appPort}/_next/abcdef`\n      const methods = ['POST', 'PUT', 'DELETE']\n      for (const method of methods) {\n        const res = await fetch(url, { method })\n        expect(res.status).toBe(404)\n      }\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should render 404 for dotfiles in /static","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":378,"column":49},"line":378,"code":"    it('should render 404 for dotfiles in /static', async () => {\n      const url = `http://localhost:${appPort}/static/.env`\n      const res = await fetch(url)\n      expect(res.status).toBe(404)\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should return 405 method on static then GET and HEAD","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":384,"column":60},"line":384,"code":"    it('should return 405 method on static then GET and HEAD', async () => {\n      const res = await fetch(\n        `http://localhost:${appPort}/static/data/item.txt`,\n        {\n          method: 'POST',\n        }\n      )\n      expect(res.headers.get('allow').includes('GET')).toBe(true)\n      expect(res.status).toBe(405)\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should return 412 on static file when If-Unmodified-Since is provided and file is modified","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":395,"column":98},"line":395,"code":"    it('should return 412 on static file when If-Unmodified-Since is provided and file is modified', async () => {\n      const buildManifest = require(join(\n        __dirname,\n        '../.next/build-manifest.json'\n      ))\n\n      const files = buildManifest.pages['/']\n\n      for (const file of files) {\n        const res = await fetch(`http://localhost:${appPort}/_next/${file}`, {\n          method: 'GET',\n          headers: { 'if-unmodified-since': 'Fri, 12 Jul 2019 20:00:13 GMT' },\n        })\n        expect(res.status).toBe(412)\n      }\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should return 200 on static file if If-Unmodified-Since is invalid date","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":412,"column":79},"line":412,"code":"    it('should return 200 on static file if If-Unmodified-Since is invalid date', async () => {\n      const buildManifest = require(join(\n        __dirname,\n        '../.next/build-manifest.json'\n      ))\n\n      const files = buildManifest.pages['/']\n\n      for (const file of files) {\n        const res = await fetch(`http://localhost:${appPort}/_next/${file}`, {\n          method: 'GET',\n          headers: { 'if-unmodified-since': 'nextjs' },\n        })\n        expect(res.status).toBe(200)\n      }\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should set Content-Length header","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":429,"column":40},"line":429,"code":"    it('should set Content-Length header', async () => {\n      const url = `http://localhost:${appPort}`\n      const res = await fetch(url)\n      expect(res.headers.get('Content-Length')).toBeDefined()\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should set Cache-Control header","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":435,"column":39},"line":435,"code":"    it('should set Cache-Control header', async () => {\n      const buildManifest = require(join('../.next', BUILD_MANIFEST))\n      const reactLoadableManifest = require(join(\n        '../.next',\n        REACT_LOADABLE_MANIFEST\n      ))\n      const url = `http://localhost:${appPort}/_next/`\n\n      const resources = new Set()\n\n      const manifestKey = Object.keys(reactLoadableManifest).find((item) => {\n        return item\n          .replace(/\\\\/g, '/')\n          .endsWith('dynamic/css.js -> ../../components/dynamic-css/with-css')\n      })\n\n      // test dynamic chunk\n      reactLoadableManifest[manifestKey].files.forEach((f) => {\n        resources.add(url + f)\n      })\n\n      // test main.js runtime etc\n      for (const item of buildManifest.pages['/']) {\n        resources.add(url + item)\n      }\n\n      const cssStaticAssets = await recursiveReadDir(\n        join(__dirname, '..', '.next', 'static'),\n        /\\.css$/\n      )\n      expect(cssStaticAssets.length).toBeGreaterThanOrEqual(1)\n      expect(cssStaticAssets[0]).toMatch(/[\\\\/]css[\\\\/]/)\n      const mediaStaticAssets = await recursiveReadDir(\n        join(__dirname, '..', '.next', 'static'),\n        /\\.svg$/\n      )\n      expect(mediaStaticAssets.length).toBeGreaterThanOrEqual(1)\n      expect(mediaStaticAssets[0]).toMatch(/[\\\\/]media[\\\\/]/)\n      ;[...cssStaticAssets, ...mediaStaticAssets].forEach((asset) => {\n        resources.add(`${url}static${asset.replace(/\\\\+/g, '/')}`)\n      })\n\n      const responses = await Promise.all(\n        [...resources].map((resource) => fetch(resource))\n      )\n\n      responses.forEach((res) => {\n        try {\n          expect(res.headers.get('Cache-Control')).toBe(\n            'public, max-age=31536000, immutable'\n          )\n        } catch (err) {\n          err.message = res.url + ' ' + err.message\n          throw err\n        }\n      })\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should set correct Cache-Control header for static 404s","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":493,"column":63},"line":493,"code":"    it('should set correct Cache-Control header for static 404s', async () => {\n      // this is to fix where 404 headers are set to 'public, max-age=31536000, immutable'\n      const res = await fetch(\n        `http://localhost:${appPort}/_next//static/common/bad-static.js`\n      )\n\n      expect(res.status).toBe(404)\n      expect(res.headers.get('Cache-Control')).toBe(\n        'no-cache, no-store, max-age=0, must-revalidate'\n      )\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should block special pages","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":505,"column":34},"line":505,"code":"    it('should block special pages', async () => {\n      const urls = ['/_document', '/_app']\n      for (const url of urls) {\n        const html = await renderViaHTTP(appPort, url)\n        expect(html).toMatch(/404/)\n      }\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should not contain customServer in NEXT_DATA","suites":["Production Usage with swcMinify","With basic usage"],"updatePoint":{"line":513,"column":52},"line":513,"code":"    it('should not contain customServer in NEXT_DATA', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n      const $ = cheerio.load(html)\n      expect('customServer' in JSON.parse($('#__NEXT_DATA__').text())).toBe(\n        false\n      )\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should work with pages/api/index.js","suites":["Production Usage with swcMinify","API routes"],"updatePoint":{"line":523,"column":43},"line":523,"code":"    it('should work with pages/api/index.js', async () => {\n      const url = `http://localhost:${appPort}/api`\n      const res = await fetch(url)\n      const body = await res.text()\n      expect(body).toEqual('API index works')\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should work with pages/api/hello.js","suites":["Production Usage with swcMinify","API routes"],"updatePoint":{"line":530,"column":43},"line":530,"code":"    it('should work with pages/api/hello.js', async () => {\n      const url = `http://localhost:${appPort}/api/hello`\n      const res = await fetch(url)\n      const body = await res.text()\n      expect(body).toEqual('API hello works')\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should work with dynamic params and search string","suites":["Production Usage with swcMinify","API routes"],"updatePoint":{"line":537,"column":57},"line":537,"code":"    it('should work with dynamic params and search string', async () => {\n      const url = `http://localhost:${appPort}/api/post-1?val=1`\n      const res = await fetch(url)\n      const body = await res.json()\n\n      expect(body).toEqual({ val: '1', post: 'post-1' })\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should navigate via client side","suites":["Production Usage with swcMinify","With navigation"],"updatePoint":{"line":547,"column":39},"line":547,"code":"    it('should navigate via client side', async () => {\n      const browser = await webdriver(appPort, '/')\n      const text = await browser\n        .elementByCss('a')\n        .click()\n        .waitForElementByCss('.about-page')\n        .elementByCss('div')\n        .text()\n\n      expect(text).toBe('About Page')\n      await browser.close()\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should navigate to nested index via client side","suites":["Production Usage with swcMinify","With navigation"],"updatePoint":{"line":560,"column":55},"line":560,"code":"    it('should navigate to nested index via client side', async () => {\n      const browser = await webdriver(appPort, '/another')\n      const text = await browser\n        .elementByCss('a')\n        .click()\n        .waitForElementByCss('.index-page')\n        .elementByCss('p')\n        .text()\n\n      expect(text).toBe('Hello World')\n      await browser.close()\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should set title by routeChangeComplete event","suites":["Production Usage with swcMinify","With navigation"],"updatePoint":{"line":573,"column":53},"line":573,"code":"    it('should set title by routeChangeComplete event', async () => {\n      const browser = await webdriver(appPort, '/')\n      await browser.eval(function setup() {\n        window.next.router.events.on(\n          'routeChangeComplete',\n          function handler(url) {\n            window.routeChangeTitle = document.title\n            window.routeChangeUrl = url\n          }\n        )\n        window.next.router.push('/with-title')\n      })\n      await browser.waitForElementByCss('#with-title')\n\n      const title = await browser.eval(`window.routeChangeTitle`)\n      const url = await browser.eval(`window.routeChangeUrl`)\n      expect(title).toBe('hello from title')\n      expect(url).toBe('/with-title')\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should reload page successfully (on bad link)","suites":["Production Usage with swcMinify","With navigation"],"updatePoint":{"line":593,"column":53},"line":593,"code":"    it('should reload page successfully (on bad link)', async () => {\n      const browser = await webdriver(appPort, '/to-nonexistent')\n      await browser.eval(function setup() {\n        window.__DATA_BE_GONE = 'true'\n      })\n      await browser.waitForElementByCss('#to-nonexistent-page')\n      await browser.click('#to-nonexistent-page')\n      await browser.waitForElementByCss('.about-page')\n\n      const oldData = await browser.eval(`window.__DATA_BE_GONE`)\n      expect(oldData).toBeFalsy()\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should reload page successfully (on bad data fetch)","suites":["Production Usage with swcMinify","With navigation"],"updatePoint":{"line":606,"column":59},"line":606,"code":"    it('should reload page successfully (on bad data fetch)', async () => {\n      const browser = await webdriver(appPort, '/to-shadowed-page')\n      await browser.eval(function setup() {\n        window.__DATA_BE_GONE = 'true'\n      })\n      await browser.waitForElementByCss('#to-shadowed-page').click()\n      await browser.waitForElementByCss('.about-page')\n\n      const oldData = await browser.eval(`window.__DATA_BE_GONE`)\n      expect(oldData).toBeFalsy()\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should navigate to external site and back","suites":["Production Usage with swcMinify","With navigation"],"updatePoint":{"line":619,"column":47},"line":619,"code":"  it('should navigate to external site and back', async () => {\n    const browser = await webdriver(appPort, '/external-and-back')\n    const initialText = await browser.elementByCss('p').text()\n    expect(initialText).toBe('server')\n\n    await browser\n      .elementByCss('a')\n      .click()\n      .waitForElementByCss('input')\n      .back()\n      .waitForElementByCss('p')\n\n    await waitFor(1000)\n    const newText = await browser.elementByCss('p').text()\n    expect(newText).toBe('server')\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should navigate to page with CSS and back","suites":["Production Usage with swcMinify","With navigation"],"updatePoint":{"line":636,"column":47},"line":636,"code":"  it('should navigate to page with CSS and back', async () => {\n    const browser = await webdriver(appPort, '/css-and-back')\n    const initialText = await browser.elementByCss('p').text()\n    expect(initialText).toBe('server')\n\n    await browser\n      .elementByCss('a')\n      .click()\n      .waitForElementByCss('input')\n      .back()\n      .waitForElementByCss('p')\n\n    await waitFor(1000)\n    const newText = await browser.elementByCss('p').text()\n    expect(newText).toBe('client')\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should navigate to external site and back (with query)","suites":["Production Usage with swcMinify","With navigation"],"updatePoint":{"line":653,"column":60},"line":653,"code":"  it('should navigate to external site and back (with query)', async () => {\n    const browser = await webdriver(appPort, '/external-and-back?hello=world')\n    const initialText = await browser.elementByCss('p').text()\n    expect(initialText).toBe('server')\n\n    await browser\n      .elementByCss('a')\n      .click()\n      .waitForElementByCss('input')\n      .back()\n      .waitForElementByCss('p')\n\n    await waitFor(1000)\n    const newText = await browser.elementByCss('p').text()\n    expect(newText).toBe('server')\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should change query correctly","suites":["Production Usage with swcMinify","With navigation"],"updatePoint":{"line":670,"column":35},"line":670,"code":"  it('should change query correctly', async () => {\n    const browser = await webdriver(appPort, '/query?id=0')\n    let id = await browser.elementByCss('#q0').text()\n    expect(id).toBe('0')\n\n    await browser.elementByCss('#first').click().waitForElementByCss('#q1')\n\n    id = await browser.elementByCss('#q1').text()\n    expect(id).toBe('1')\n\n    await browser.elementByCss('#second').click().waitForElementByCss('#q2')\n\n    id = await browser.elementByCss('#q2').text()\n    expect(id).toBe('2')\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should render a server side error on the client side","suites":["Production Usage with swcMinify","Runtime errors"],"updatePoint":{"line":687,"column":60},"line":687,"code":"    it('should render a server side error on the client side', async () => {\n      const browser = await webdriver(appPort, '/error-in-ssr-render')\n      await waitFor(2000)\n      const text = await browser.elementByCss('body').text()\n      // this makes sure we don't leak the actual error to the client side in production\n      expect(text).toMatch(/Internal Server Error\\./)\n      const headingText = await browser.elementByCss('h1').text()\n      // This makes sure we render statusCode on the client side correctly\n      expect(headingText).toBe('500')\n      await browser.close()\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should render a client side component error","suites":["Production Usage with swcMinify","Runtime errors"],"updatePoint":{"line":699,"column":51},"line":699,"code":"    it('should render a client side component error', async () => {\n      const browser = await webdriver(appPort, '/error-in-browser-render')\n      await waitFor(2000)\n      const text = await browser.elementByCss('body').text()\n      expect(text).toMatch(\n        /Application error: a client-side exception has occurred/\n      )\n      await browser.close()\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should call getInitialProps on _error page during a client side component error","suites":["Production Usage with swcMinify","Runtime errors"],"updatePoint":{"line":709,"column":87},"line":709,"code":"    it('should call getInitialProps on _error page during a client side component error', async () => {\n      const browser = await webdriver(\n        appPort,\n        '/error-in-browser-render-status-code'\n      )\n      await waitFor(2000)\n      const text = await browser.elementByCss('body').text()\n      expect(text).toMatch(/This page could not be found\\./)\n      await browser.close()\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should handle already finished responses","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":722,"column":48},"line":722,"code":"    it('should handle already finished responses', async () => {\n      const html = await renderViaHTTP(appPort, '/finish-response')\n      expect(html).toBe('hi')\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should allow to access /static/ and /_next/","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":727,"column":51},"line":727,"code":"    it('should allow to access /static/ and /_next/', async () => {\n      // This is a test case which prevent the following issue happening again.\n      // See: https://github.com/vercel/next.js/issues/2617\n      await renderViaHTTP(appPort, '/_next/')\n      await renderViaHTTP(appPort, '/static/')\n      const data = await renderViaHTTP(appPort, '/static/data/item.txt')\n      expect(data).toBe('item')\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"Should allow access to public files","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":736,"column":43},"line":736,"code":"    it('Should allow access to public files', async () => {\n      const data = await renderViaHTTP(appPort, '/data/data.txt')\n      const file = await renderViaHTTP(appPort, '/file')\n      const legacy = await renderViaHTTP(appPort, '/static/legacy.txt')\n      expect(data).toBe('data')\n      expect(file).toBe('test')\n      expect(legacy).toMatch(`new static folder`)\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should reload the page on page script error","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":750,"column":53},"line":750,"code":"      it('should reload the page on page script error', async () => {\n        const browser = await webdriver(appPort, '/counter')\n        const counter = await browser\n          .elementByCss('#increase')\n          .click()\n          .click()\n          .elementByCss('#counter')\n          .text()\n        expect(counter).toBe('Counter: 2')\n\n        // When we go to the 404 page, it'll do a hard reload.\n        // So, it's possible for the front proxy to load a page from another zone.\n        // Since the page is reloaded, when we go back to the counter page again,\n        // previous counter value should be gone.\n        const counterAfter404Page = await browser\n          .elementByCss('#no-such-page')\n          .click()\n          .waitForElementByCss('h1')\n          .back()\n          .waitForElementByCss('#counter-page')\n          .elementByCss('#counter')\n          .text()\n        expect(counterAfter404Page).toBe('Counter: 0')\n\n        await browser.close()\n      })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should have default runtime values when not defined","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":778,"column":59},"line":778,"code":"    it('should have default runtime values when not defined', async () => {\n      const html = await renderViaHTTP(appPort, '/runtime-config')\n      expect(html).toMatch(/found public config/)\n      expect(html).toMatch(/found server config/)\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should not have runtimeConfig in __NEXT_DATA__","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":784,"column":54},"line":784,"code":"    it('should not have runtimeConfig in __NEXT_DATA__', async () => {\n      const html = await renderViaHTTP(appPort, '/runtime-config')\n      const $ = cheerio.load(html)\n      const script = $('#__NEXT_DATA__').html()\n      expect(script).not.toMatch(/runtimeConfig/)\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should add autoExport for auto pre-rendered pages","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":791,"column":57},"line":791,"code":"    it('should add autoExport for auto pre-rendered pages', async () => {\n      for (const page of ['/', '/about']) {\n        const html = await renderViaHTTP(appPort, page)\n        const $ = cheerio.load(html)\n        const data = JSON.parse($('#__NEXT_DATA__').html())\n        expect(data.autoExport).toBe(true)\n      }\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should not add autoExport for non pre-rendered pages","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":800,"column":60},"line":800,"code":"    it('should not add autoExport for non pre-rendered pages', async () => {\n      for (const page of ['/query']) {\n        const html = await renderViaHTTP(appPort, page)\n        const $ = cheerio.load(html)\n        const data = JSON.parse($('#__NEXT_DATA__').html())\n        expect(!!data.autoExport).toBe(false)\n      }\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should add prefetch tags when Link prefetch prop is used","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":809,"column":64},"line":809,"code":"    it('should add prefetch tags when Link prefetch prop is used', async () => {\n      const browser = await webdriver(appPort, '/prefetch')\n\n      if (browserName === 'internet explorer') {\n        // IntersectionObserver isn't present so we need to trigger manually\n        await waitFor(1000)\n        await browser.eval(`(function() {\n          window.next.router.prefetch('/')\n          window.next.router.prefetch('/process-env')\n          window.next.router.prefetch('/counter')\n          window.next.router.prefetch('/about')\n        })()`)\n      }\n\n      await waitFor(2000)\n\n      if (browserName === 'safari') {\n        const elements = await browser.elementsByCss('link[rel=preload]')\n        // optimized preloading uses defer instead of preloading and prefetches\n        // aren't generated client-side since safari does not support prefetch\n        expect(elements.length).toBe(0)\n      } else {\n        const elements = await browser.elementsByCss('link[rel=prefetch]')\n        expect(elements.length).toBe(4)\n\n        for (const element of elements) {\n          const rel = await element.getAttribute('rel')\n          const as = await element.getAttribute('as')\n          expect(rel).toBe('prefetch')\n          expect(as).toBe('script')\n        }\n      }\n      await browser.close()\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"It does not add a timestamp to link tags with prefetch attribute","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":846,"column":72},"line":846,"code":"    it('It does not add a timestamp to link tags with prefetch attribute', async () => {\n      const browser = await webdriver(appPort, '/prefetch')\n      const links = await browser.elementsByCss('link[rel=prefetch]')\n\n      for (const element of links) {\n        const href = await element.getAttribute('href')\n        expect(href).not.toMatch(/\\?ts=/)\n      }\n      const scripts = await browser.elementsByCss('script[src]')\n\n      for (const element of scripts) {\n        const src = await element.getAttribute('src')\n        expect(src).not.toMatch(/\\?ts=/)\n      }\n      await browser.close()\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should reload the page on page script error with prefetch","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":864,"column":67},"line":864,"code":"      it('should reload the page on page script error with prefetch', async () => {\n        const browser = await webdriver(appPort, '/counter')\n        if (global.browserName !== 'chrome') return\n        const counter = await browser\n          .elementByCss('#increase')\n          .click()\n          .click()\n          .elementByCss('#counter')\n          .text()\n        expect(counter).toBe('Counter: 2')\n\n        // Let the browser to prefetch the page and error it on the console.\n        await waitFor(3000)\n\n        // When we go to the 404 page, it'll do a hard reload.\n        // So, it's possible for the front proxy to load a page from another zone.\n        // Since the page is reloaded, when we go back to the counter page again,\n        // previous counter value should be gone.\n        const counterAfter404Page = await browser\n          .elementByCss('#no-such-page-prefetch')\n          .click()\n          .waitForElementByCss('h1')\n          .back()\n          .waitForElementByCss('#counter-page')\n          .elementByCss('#counter')\n          .text()\n        expect(counterAfter404Page).toBe('Counter: 0')\n\n        await browser.close()\n      })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should not expose the compiled page file in development","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":897,"column":61},"line":897,"code":"  it('should not expose the compiled page file in development', async () => {\n    const url = `http://localhost:${appPort}`\n    await fetch(`${url}/stateless`) // make sure the stateless page is built\n    const clientSideJsRes = await fetch(\n      `${url}/_next/development/static/development/pages/stateless.js`\n    )\n    expect(clientSideJsRes.status).toBe(404)\n    const clientSideJsBody = await clientSideJsRes.text()\n    expect(clientSideJsBody).toMatch(/404/)\n\n    const serverSideJsRes = await fetch(\n      `${url}/_next/development/server/static/development/pages/stateless.js`\n    )\n    expect(serverSideJsRes.status).toBe(404)\n    const serverSideJsBody = await serverSideJsRes.text()\n    expect(serverSideJsBody).toMatch(/404/)\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should not put backslashes in pages-manifest.json","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":915,"column":55},"line":915,"code":"  it('should not put backslashes in pages-manifest.json', () => {\n    // Whatever platform you build on, pages-manifest.json should use forward slash (/)\n    // See: https://github.com/vercel/next.js/issues/4920\n    const pagesManifest = require(join('..', '.next', 'server', PAGES_MANIFEST))\n\n    for (let key of Object.keys(pagesManifest)) {\n      expect(key).not.toMatch(/\\\\/)\n      expect(pagesManifest[key]).not.toMatch(/\\\\/)\n    }\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should handle failed param decoding","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":926,"column":41},"line":926,"code":"  it('should handle failed param decoding', async () => {\n    const html = await renderViaHTTP(appPort, '/invalid-param/%DE~%C7%1fY/')\n    expect(html).toMatch(/400/)\n    expect(html).toMatch(/Bad Request/)\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should replace static pages with HTML files","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":932,"column":49},"line":932,"code":"  it('should replace static pages with HTML files', async () => {\n    const pages = ['/about', '/another', '/counter', '/dynamic', '/prefetch']\n    for (const page of pages) {\n      const file = getPageFileFromPagesManifest(appDir, page)\n\n      expect(file.endsWith('.html')).toBe(true)\n    }\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should not replace non-static pages with HTML files","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":941,"column":57},"line":941,"code":"  it('should not replace non-static pages with HTML files', async () => {\n    const pages = ['/api', '/external-and-back', '/finish-response']\n\n    for (const page of pages) {\n      const file = getPageFileFromPagesManifest(appDir, page)\n\n      expect(file.endsWith('.js')).toBe(true)\n    }\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should handle AMP correctly in IE","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":951,"column":39},"line":951,"code":"  it('should handle AMP correctly in IE', async () => {\n    const browser = await webdriver(appPort, '/some-amp')\n    const text = await browser.elementByCss('p').text()\n    expect(text).toBe('Not AMP')\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should warn when prefetch is true","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":957,"column":39},"line":957,"code":"  it('should warn when prefetch is true', async () => {\n    if (global.browserName !== 'chrome') return\n    let browser\n    try {\n      browser = await webdriver(appPort, '/development-logs')\n      const browserLogs = await browser.log('browser')\n      let found = false\n      browserLogs.forEach((log) => {\n        if (log.message.includes('Next.js auto-prefetches automatically')) {\n          found = true\n        }\n      })\n      expect(found).toBe(false)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should not emit profiling events","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":977,"column":38},"line":977,"code":"  it('should not emit profiling events', async () => {\n    expect(existsSync(join(appDir, '.next', 'profile-events.json'))).toBe(false)\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should not emit stats","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":981,"column":27},"line":981,"code":"  it('should not emit stats', async () => {\n    expect(existsSync(join(appDir, '.next', 'next-stats.json'))).toBe(false)\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should contain the Next.js version in window export","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":985,"column":57},"line":985,"code":"  it('should contain the Next.js version in window export', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/about')\n      const version = await browser.eval('window.next.version')\n      expect(version).toBeTruthy()\n      expect(version).toBe(require('next/package.json').version)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should clear all core performance marks","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":999,"column":45},"line":999,"code":"  it('should clear all core performance marks', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/fully-dynamic')\n\n      const currentPerfMarks = await browser.eval(\n        `window.performance.getEntriesByType('mark')`\n      )\n      const allPerfMarks = [\n        'beforeRender',\n        'afterHydrate',\n        'afterRender',\n        'routeChange',\n      ]\n\n      allPerfMarks.forEach((name) =>\n        expect(currentPerfMarks).not.toContainEqual(\n          expect.objectContaining({ name })\n        )\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should not clear custom performance marks","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":1026,"column":47},"line":1026,"code":"  it('should not clear custom performance marks', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/mark-in-head')\n\n      const customMarkFound = await browser.eval(\n        `window.performance.getEntriesByType('mark').filter(function(e) {\n          return e.name === 'custom-mark'\n        }).length === 1`\n      )\n      expect(customMarkFound).toBe(true)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should have defer on all script tags","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":1044,"column":42},"line":1044,"code":"  it('should have defer on all script tags', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(html)\n    let missing = false\n\n    for (const script of $('script').toArray()) {\n      // application/json doesn't need async\n      if (\n        script.attribs.type === 'application/json' ||\n        script.attribs.src.includes('polyfills')\n      ) {\n        continue\n      }\n\n      if (script.attribs.defer !== '' || script.attribs.async === '') {\n        missing = true\n      }\n    }\n    expect(missing).toBe(false)\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should only have one DOCTYPE","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":1065,"column":34},"line":1065,"code":"  it('should only have one DOCTYPE', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toMatch(/^<!DOCTYPE html><html/)\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should preserve query when hard navigating from page 404","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":1071,"column":64},"line":1071,"code":"    it('should preserve query when hard navigating from page 404', async () => {\n      const browser = await webdriver(appPort, '/')\n      await browser.eval(`(function() {\n        window.beforeNav = 1\n        window.next.router.push({\n          pathname: '/non-existent',\n          query: { hello: 'world' }\n        })\n      })()`)\n\n      await check(\n        () => browser.eval('document.documentElement.innerHTML'),\n        /page could not be found/\n      )\n\n      expect(await browser.eval('window.beforeNav')).toBeFalsy()\n      expect(await browser.eval('window.location.hash')).toBe('')\n      expect(await browser.eval('window.location.search')).toBe('?hello=world')\n      expect(await browser.eval('window.location.pathname')).toBe(\n        '/non-existent'\n      )\n    })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should remove placeholder for next/image correctly","suites":["Production Usage with swcMinify","Misc"],"updatePoint":{"line":1095,"column":56},"line":1095,"code":"  it('should remove placeholder for next/image correctly', async () => {\n    const browser = await webdriver(context.appPort, '/')\n\n    await browser.eval(`(function() {\n        window.beforeNav = 1\n        window.next.router.push('/static-image')\n      })()`)\n    await browser.waitForElementByCss('#static-image')\n\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n\n    await check(\n      () => browser.elementByCss('img').getComputedCss('background-image'),\n      'none'\n    )\n\n    await browser.eval(`(function() {\n        window.beforeNav = 1\n        window.next.router.push('/')\n      })()`)\n    await browser.waitForElementByCss('.index-page')\n    await waitFor(1000)\n\n    await browser.eval(`(function() {\n        window.beforeNav = 1\n        window.next.router.push('/static-image')\n      })()`)\n    await browser.waitForElementByCss('#static-image')\n\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n\n    await check(\n      () =>\n        browser\n          .elementByCss('#static-image')\n          .getComputedCss('background-image'),\n      'none'\n    )\n\n    for (let i = 0; i < 5; i++) {\n      expect(\n        await browser\n          .elementByCss('#static-image')\n          .getComputedCss('background-image')\n      ).toBe('none')\n      await waitFor(500)\n    }\n  })","file":"integration/production-swcminify/test/index.test.js","skipped":true,"dir":"test"},{"name":"should navigate through history after query update","suites":["Production Usage"],"updatePoint":{"line":71,"column":56},"line":71,"code":"  it('should navigate through history after query update', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.eval('window.next.router.push(\"/about?a=b\")')\n    await browser.waitForElementByCss('.about-page')\n    await browser.waitForCondition(`!!window.next.router.isReady`)\n\n    await browser.refresh()\n    await browser.waitForCondition(`!!window.next.router.isReady`)\n    await browser.back()\n    await browser.waitForElementByCss('.index-page')\n    await browser.forward()\n    await browser.waitForElementByCss('.about-page')\n    await browser.back()\n    await browser.waitForElementByCss('.index-page')\n    await browser.refresh()\n    await browser.waitForCondition(`!!window.next.router.isReady`)\n    await browser.forward()\n    await browser.waitForElementByCss('.about-page')\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle query/hash correctly during query updating $hash $search","suites":["Production Usage"],"line":92,"code":"    it.each([\n      { hash: '#hello?' },\n      { hash: '#?' },\n      { hash: '##' },\n      { hash: '##?' },\n      { hash: '##hello?' },\n      { hash: '##hello' },\n      { hash: '#hello?world' },\n      { search: '?hello=world', hash: '#a', query: { hello: 'world' } },\n      { search: '?hello', hash: '#a', query: { hello: '' } },\n      { search: '?hello=', hash: '#a', query: { hello: '' } },\n    ])(\n      'should handle query/hash correctly during query updating $hash $search',\n      async ({ hash, search, query }) => {\n        const browser = await webdriver(\n          appPort,\n          `/${search || ''}${hash || ''}`\n        )\n\n        await check(\n          () =>\n            browser.eval('window.next.router.isReady ? \"ready\" : \"not ready\"'),\n          'ready'\n        )\n        expect(await browser.eval('window.location.pathname')).toBe('/')\n        expect(await browser.eval('window.location.hash')).toBe(hash || '')\n        expect(await browser.eval('window.location.search')).toBe(search || '')\n        expect(await browser.eval('next.router.pathname')).toBe('/')\n        expect(\n          JSON.parse(await browser.eval('JSON.stringify(next.router.query)'))\n        ).toEqual(query || {})\n      }\n    )","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show target deprecation warning","suites":["Production Usage"],"updatePoint":{"line":127,"column":48},"line":127,"code":"  it('should not show target deprecation warning', () => {\n    expect(output).not.toContain(\n      'The `target` config is deprecated and will be removed in a future version'\n    )\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should respond with 405 for POST to static page","suites":["Production Usage"],"updatePoint":{"line":133,"column":53},"line":133,"code":"  it('should respond with 405 for POST to static page', async () => {\n    const res = await fetchViaHTTP(appPort, '/', undefined, {\n      method: 'POST',\n    })\n    expect(res.status).toBe(405)\n    expect(await res.text()).toContain('Method Not Allowed')\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should contain generated page count in output","suites":["Production Usage"],"updatePoint":{"line":141,"column":51},"line":141,"code":"  it('should contain generated page count in output', async () => {\n    const pageCount = 40\n    expect(output).toContain(`Generating static pages (0/${pageCount})`)\n    expect(output).toContain(\n      `Generating static pages (${pageCount}/${pageCount})`\n    )\n    // we should only have 4 segments and the initial message logged out\n    expect(output.match(/Generating static pages/g).length).toBe(5)\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should output traces","suites":["Production Usage"],"updatePoint":{"line":151,"column":26},"line":151,"code":"  it('should output traces', async () => {\n    const serverTrace = await fs.readJSON(\n      join(appDir, '.next/next-server.js.nft.json')\n    )\n\n    expect(serverTrace.version).toBe(1)\n    expect(\n      serverTrace.files.some((file) =>\n        file.includes('next/dist/server/send-payload/index.js')\n      )\n    ).toBe(true)\n    const repoRoot = join(__dirname, '../../../../')\n    expect(\n      serverTrace.files.some((file) => {\n        const fullPath = join(__dirname, '../.next', file)\n        if (!fullPath.startsWith(repoRoot)) {\n          console.error(`Found next-server trace file outside repo root`, {\n            repoRoot,\n            fullPath,\n            file,\n          })\n          return true\n        }\n        return false\n      })\n    ).toBe(false)\n    expect(\n      serverTrace.files.some((file) =>\n        file.includes('next/dist/shared/lib/page-path/normalize-page-path.js')\n      )\n    ).toBe(true)\n    expect(\n      serverTrace.files.some((file) =>\n        file.includes('next/dist/server/render.js')\n      )\n    ).toBe(true)\n    expect(\n      serverTrace.files.some((file) =>\n        file.includes('next/dist/server/load-components.js')\n      )\n    ).toBe(true)\n\n    if (process.platform !== 'win32') {\n      expect(\n        serverTrace.files.some((file) =>\n          file.includes('next/dist/compiled/webpack/bundle5.js')\n        )\n      ).toBe(false)\n      expect(\n        serverTrace.files.some((file) => file.includes('node_modules/sharp'))\n      ).toBe(false)\n    }\n\n    const checks = [\n      {\n        page: '/_app',\n        tests: [\n          /webpack-runtime\\.js/,\n          /node_modules\\/react\\/index\\.js/,\n          /node_modules\\/react\\/package\\.json/,\n          /node_modules\\/react\\/cjs\\/react\\.production\\.min\\.js/,\n        ],\n        notTests: [/\\0/, /\\?/, /!/],\n      },\n      {\n        page: '/client-error',\n        tests: [\n          /webpack-runtime\\.js/,\n          /chunks\\/.*?\\.js/,\n          /node_modules\\/react\\/index\\.js/,\n          /node_modules\\/react\\/package\\.json/,\n          /node_modules\\/react\\/cjs\\/react\\.production\\.min\\.js/,\n          /node_modules\\/next/,\n          /next\\/link\\.js/,\n          /next\\/dist\\/shared\\/lib\\/router\\/utils\\/resolve-rewrites\\.js/,\n          /next\\/error\\.js/,\n        ],\n        notTests: [/\\0/, /\\?/, /!/],\n      },\n      {\n        page: '/dynamic',\n        tests: [\n          /webpack-runtime\\.js/,\n          /chunks\\/.*?\\.js/,\n          /node_modules\\/react\\/index\\.js/,\n          /node_modules\\/react\\/package\\.json/,\n          /node_modules\\/react\\/cjs\\/react\\.production\\.min\\.js/,\n          /node_modules\\/next/,\n          /next\\/link\\.js/,\n          /next\\/dist\\/shared\\/lib\\/router\\/utils\\/resolve-rewrites\\.js/,\n        ],\n        notTests: [/\\0/, /\\?/, /!/],\n      },\n      {\n        page: '/index',\n        tests: [\n          /webpack-runtime\\.js/,\n          /chunks\\/.*?\\.js/,\n          /node_modules\\/react\\/index\\.js/,\n          /node_modules\\/react\\/package\\.json/,\n          /node_modules\\/react\\/cjs\\/react\\.production\\.min\\.js/,\n          /node_modules\\/next/,\n          /next\\/link\\.js/,\n          /next\\/dist\\/shared\\/lib\\/router\\/utils\\/resolve-rewrites\\.js/,\n          /node_modules\\/nanoid\\/index\\.js/,\n          /node_modules\\/nanoid\\/url-alphabet\\/index\\.js/,\n          /node_modules\\/es5-ext\\/array\\/#\\/clear\\.js/,\n        ],\n        notTests: [\n          /next\\/dist\\/pages\\/_error\\.js/,\n          /next\\/error\\.js/,\n          /\\0/,\n          /\\?/,\n          /!/,\n        ],\n      },\n      {\n        page: '/counter',\n        tests: [\n          /webpack-runtime\\.js/,\n          /chunks\\/.*?\\.js/,\n          /node_modules\\/react\\/index\\.js/,\n          /node_modules\\/react\\/package\\.json/,\n          /node_modules\\/react\\/cjs\\/react\\.production\\.min\\.js/,\n          /node_modules\\/react\\/cjs\\/react\\.development\\.js/,\n          /node_modules\\/next/,\n          /next\\/router\\.js/,\n          /next\\/dist\\/shared\\/lib\\/router\\/utils\\/resolve-rewrites\\.js/,\n        ],\n        notTests: [/\\0/, /\\?/, /!/],\n      },\n      {\n        page: '/next-import',\n        tests: [\n          /webpack-runtime\\.js/,\n          /chunks\\/.*?\\.js/,\n          /node_modules\\/react\\/index\\.js/,\n          /node_modules\\/react\\/package\\.json/,\n          /node_modules\\/react\\/cjs\\/react\\.production\\.min\\.js/,\n          /node_modules\\/next/,\n          /next\\/link\\.js/,\n          /next\\/dist\\/shared\\/lib\\/router\\/utils\\/resolve-rewrites\\.js/,\n        ],\n        notTests: [\n          /next\\/dist\\/server\\/next\\.js/,\n          /next\\/dist\\/bin/,\n          /\\0/,\n          /\\?/,\n          /!/,\n        ],\n      },\n      {\n        page: '/api',\n        tests: [/webpack-runtime\\.js/, /\\/logo\\.module\\.css/],\n        notTests: [\n          /next\\/dist\\/server\\/next\\.js/,\n          /next\\/dist\\/bin/,\n          /\\0/,\n          /\\?/,\n          /!/,\n        ],\n      },\n      {\n        page: '/api/readfile-dirname',\n        tests: [/webpack-api-runtime\\.js/, /static\\/data\\/item\\.txt/],\n        notTests: [\n          /next\\/dist\\/server\\/next\\.js/,\n          /next\\/dist\\/bin/,\n          /\\0/,\n          /\\?/,\n          /!/,\n        ],\n      },\n      {\n        page: '/api/readfile-processcwd',\n        tests: [/webpack-api-runtime\\.js/, /static\\/data\\/item\\.txt/],\n        notTests: [\n          /next\\/dist\\/server\\/next\\.js/,\n          /next\\/dist\\/bin/,\n          /\\0/,\n          /\\?/,\n          /!/,\n        ],\n      },\n    ]\n\n    for (const check of checks) {\n      const contents = await fs.readFile(\n        join(appDir, '.next/server/pages/', check.page + '.js.nft.json'),\n        'utf8'\n      )\n      const { version, files } = JSON.parse(contents)\n      expect(version).toBe(1)\n      expect([...new Set(files)].length).toBe(files.length)\n\n      expect(\n        check.tests.every((item) => {\n          if (files.some((file) => item.test(file))) {\n            return true\n          }\n          console.error(`Failed to find ${item} in`, files)\n          return false\n        })\n      ).toBe(true)\n\n      if (sep === '/') {\n        expect(\n          check.notTests.some((item) => {\n            if (files.some((file) => item.test(file))) {\n              console.error(`Found unexpected ${item} in`, files)\n              return true\n            }\n            return false\n          })\n        ).toBe(false)\n      }\n    }\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not contain currentScript usage for publicPath","suites":["Production Usage"],"updatePoint":{"line":370,"column":59},"line":370,"code":"  it('should not contain currentScript usage for publicPath', async () => {\n    const globResult = await glob('webpack-*.js', {\n      cwd: join(appDir, '.next/static/chunks'),\n    })\n\n    if (!globResult || globResult.length !== 1) {\n      throw new Error('could not find webpack-hash.js chunk')\n    }\n\n    const content = await fs.readFile(\n      join(appDir, '.next/static/chunks', globResult[0]),\n      'utf8'\n    )\n\n    expect(content).not.toContain('.currentScript')\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not contain amp, rsc APIs in main chunk","suites":["Production Usage"],"updatePoint":{"line":387,"column":52},"line":387,"code":"  it('should not contain amp, rsc APIs in main chunk', async () => {\n    const globResult = await glob('main-*.js', {\n      cwd: join(appDir, '.next/static/chunks'),\n    })\n\n    if (!globResult || globResult.length !== 1) {\n      throw new Error('could not find main js chunk')\n    }\n\n    const content = await fs.readFile(\n      join(appDir, '.next/static/chunks', globResult[0]),\n      'utf8'\n    )\n\n    expect(content).not.toContain('useAmp')\n    expect(content).not.toContain('useRefreshRoot')\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page","suites":["Production Usage","With basic usage"],"updatePoint":{"line":406,"column":30},"line":406,"code":"    it('should render the page', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n      expect(html).toMatch(/Hello World/)\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle bad Promise polyfill","suites":["Production Usage","With basic usage"],"updatePoint":{"line":412,"column":44},"line":412,"code":"      it('should handle bad Promise polyfill', async () => {\n        const browser = await webdriver(appPort, '/bad-promise')\n        expect(await browser.eval('window.didRender')).toBe(true)\n      })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should polyfill RegExp successfully","suites":["Production Usage","With basic usage"],"updatePoint":{"line":417,"column":45},"line":417,"code":"      it('should polyfill RegExp successfully', async () => {\n        const browser = await webdriver(appPort, '/regexp-polyfill')\n        expect(await browser.eval('window.didRender')).toBe(true)\n        // wait a second for the script to be loaded\n        await waitFor(1000)\n\n        expect(await browser.eval('window.isSticky')).toBe(true)\n        expect(await browser.eval('window.isMatch1')).toBe(true)\n        expect(await browser.eval('window.isMatch2')).toBe(false)\n      })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should polyfill Node.js modules","suites":["Production Usage","With basic usage"],"updatePoint":{"line":429,"column":39},"line":429,"code":"    it('should polyfill Node.js modules', async () => {\n      const browser = await webdriver(appPort, '/node-browser-polyfills')\n      await browser.waitForCondition('window.didRender')\n\n      const data = await browser\n        .waitForElementByCss('#node-browser-polyfills')\n        .text()\n      const parsedData = JSON.parse(data)\n\n      expect(parsedData.vm).toBe(105)\n      expect(parsedData.hash).toBe(\n        'b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9'\n      )\n      expect(parsedData.path).toBe('/hello/world/test.txt')\n      expect(parsedData.buffer).toBe('hello world')\n      expect(parsedData.stream).toBe(true)\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should allow etag header support","suites":["Production Usage","With basic usage"],"updatePoint":{"line":447,"column":40},"line":447,"code":"    it('should allow etag header support', async () => {\n      const url = `http://localhost:${appPort}`\n      const etag = (await fetchViaHTTP(url, '/')).headers.get('ETag')\n\n      const headers = { 'If-None-Match': etag }\n      const res2 = await fetchViaHTTP(url, '/', undefined, { headers })\n      expect(res2.status).toBe(304)\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should allow etag header support with getStaticProps","suites":["Production Usage","With basic usage"],"updatePoint":{"line":456,"column":60},"line":456,"code":"    it('should allow etag header support with getStaticProps', async () => {\n      const url = `http://localhost:${appPort}`\n      const etag = (await fetchViaHTTP(url, '/fully-static')).headers.get(\n        'ETag'\n      )\n\n      const headers = { 'If-None-Match': etag }\n      const res2 = await fetchViaHTTP(url, '/fully-static', undefined, {\n        headers,\n      })\n      expect(res2.status).toBe(304)\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should allow etag header support with getServerSideProps","suites":["Production Usage","With basic usage"],"line":471,"code":"    it.skip('should allow etag header support with getServerSideProps', async () => {","file":"integration/production/test/index.test.js","skipped":true,"dir":"test"},{"name":"should have X-Powered-By header support","suites":["Production Usage","With basic usage"],"updatePoint":{"line":484,"column":47},"line":484,"code":"    it('should have X-Powered-By header support', async () => {\n      const url = `http://localhost:${appPort}`\n      const header = (await fetchViaHTTP(url, '/')).headers.get('X-Powered-By')\n\n      expect(header).toBe('Next.js')\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render 404 for routes that do not exist","suites":["Production Usage","With basic usage"],"updatePoint":{"line":491,"column":54},"line":491,"code":"    it('should render 404 for routes that do not exist', async () => {\n      const url = `http://localhost:${appPort}`\n      const res = await fetchViaHTTP(url, '/abcdefghijklmno')\n      const text = await res.text()\n      const $html = cheerio.load(text)\n      expect($html('html').text()).toMatch(/404/)\n      expect(text).toMatch(/\"statusCode\":404/)\n      expect(res.status).toBe(404)\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render 404 for /_next/static route","suites":["Production Usage","With basic usage"],"updatePoint":{"line":501,"column":49},"line":501,"code":"    it('should render 404 for /_next/static route', async () => {\n      const html = await renderViaHTTP(appPort, '/_next/static')\n      expect(html).toMatch(/This page could not be found/)\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render 200 for POST on page","suites":["Production Usage","With basic usage"],"updatePoint":{"line":506,"column":42},"line":506,"code":"    it('should render 200 for POST on page', async () => {\n      const res = await fetchViaHTTP(\n        `http://localhost:${appPort}`,\n        '/fully-dynamic',\n        undefined,\n        {\n          method: 'POST',\n        }\n      )\n      expect(res.status).toBe(200)\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render 404 for POST on missing page","suites":["Production Usage","With basic usage"],"updatePoint":{"line":518,"column":50},"line":518,"code":"    it('should render 404 for POST on missing page', async () => {\n      const res = await fetchViaHTTP(\n        `http://localhost:${appPort}`,\n        '/fake-page',\n        undefined,\n        {\n          method: 'POST',\n        }\n      )\n      expect(res.status).toBe(404)\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render 404 for _next routes that do not exist","suites":["Production Usage","With basic usage"],"updatePoint":{"line":530,"column":60},"line":530,"code":"    it('should render 404 for _next routes that do not exist', async () => {\n      const url = `http://localhost:${appPort}`\n      const res = await fetchViaHTTP(url, '/_next/abcdef')\n      expect(res.status).toBe(404)\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render 404 even if the HTTP method is not GET or HEAD","suites":["Production Usage","With basic usage"],"updatePoint":{"line":536,"column":68},"line":536,"code":"    it('should render 404 even if the HTTP method is not GET or HEAD', async () => {\n      const url = `http://localhost:${appPort}`\n      const methods = ['POST', 'PUT', 'DELETE']\n      for (const method of methods) {\n        const res = await fetchViaHTTP(url, '/_next/abcdef', undefined, {\n          method,\n        })\n        expect(res.status).toBe(404)\n      }\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render 404 for dotfiles in /static","suites":["Production Usage","With basic usage"],"updatePoint":{"line":547,"column":49},"line":547,"code":"    it('should render 404 for dotfiles in /static', async () => {\n      const url = `http://localhost:${appPort}`\n      const res = await fetchViaHTTP(url, '/static/.env')\n      expect(res.status).toBe(404)\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return 405 method on static then GET and HEAD","suites":["Production Usage","With basic usage"],"updatePoint":{"line":553,"column":60},"line":553,"code":"    it('should return 405 method on static then GET and HEAD', async () => {\n      const res = await fetchViaHTTP(\n        `http://localhost:${appPort}`,\n        '/static/data/item.txt',\n        undefined,\n        {\n          method: 'POST',\n        }\n      )\n      expect(res.headers.get('allow').includes('GET')).toBe(true)\n      expect(res.status).toBe(405)\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return 412 on static file when If-Unmodified-Since is provided and file is modified","suites":["Production Usage","With basic usage"],"updatePoint":{"line":566,"column":98},"line":566,"code":"    it('should return 412 on static file when If-Unmodified-Since is provided and file is modified', async () => {\n      const buildManifest = require(join(\n        __dirname,\n        '../.next/build-manifest.json'\n      ))\n\n      const files = buildManifest.pages['/']\n\n      for (const file of files) {\n        const res = await fetchViaHTTP(\n          `http://localhost:${appPort}`,\n          `/_next/${file}`,\n          undefined,\n          {\n            method: 'GET',\n            headers: { 'if-unmodified-since': 'Fri, 12 Jul 2019 20:00:13 GMT' },\n          }\n        )\n        expect(res.status).toBe(412)\n      }\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return 200 on static file if If-Unmodified-Since is invalid date","suites":["Production Usage","With basic usage"],"updatePoint":{"line":588,"column":79},"line":588,"code":"    it('should return 200 on static file if If-Unmodified-Since is invalid date', async () => {\n      const buildManifest = require(join(\n        __dirname,\n        '../.next/build-manifest.json'\n      ))\n\n      const files = buildManifest.pages['/']\n\n      for (const file of files) {\n        const res = await fetchViaHTTP(\n          `http://localhost:${appPort}`,\n          `/_next/${file}`,\n          undefined,\n          {\n            method: 'GET',\n            headers: { 'if-unmodified-since': 'nextjs' },\n          }\n        )\n        expect(res.status).toBe(200)\n      }\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should set Content-Length header","suites":["Production Usage","With basic usage"],"updatePoint":{"line":610,"column":40},"line":610,"code":"    it('should set Content-Length header', async () => {\n      const url = `http://localhost:${appPort}`\n      const res = await fetchViaHTTP(url, '/')\n      expect(res.headers.get('Content-Length')).toBeDefined()\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should set Cache-Control header","suites":["Production Usage","With basic usage"],"updatePoint":{"line":616,"column":39},"line":616,"code":"    it('should set Cache-Control header', async () => {\n      const buildManifest = require(join('../.next', BUILD_MANIFEST))\n      const reactLoadableManifest = require(join(\n        '../.next',\n        REACT_LOADABLE_MANIFEST\n      ))\n      const url = `http://localhost:${appPort}`\n\n      const resources = new Set()\n\n      const manifestKey = Object.keys(reactLoadableManifest).find((item) => {\n        return item\n          .replace(/\\\\/g, '/')\n          .endsWith('dynamic/css.js -> ../../components/dynamic-css/with-css')\n      })\n\n      // test dynamic chunk\n      reactLoadableManifest[manifestKey].files.forEach((f) => {\n        resources.add('/' + f)\n      })\n\n      // test main.js runtime etc\n      for (const item of buildManifest.pages['/']) {\n        resources.add('/' + item)\n      }\n\n      const cssStaticAssets = await recursiveReadDir(\n        join(__dirname, '..', '.next', 'static'),\n        /\\.css$/\n      )\n      expect(cssStaticAssets.length).toBeGreaterThanOrEqual(1)\n      expect(cssStaticAssets[0]).toMatch(/[\\\\/]css[\\\\/]/)\n      const mediaStaticAssets = await recursiveReadDir(\n        join(__dirname, '..', '.next', 'static'),\n        /\\.svg$/\n      )\n      expect(mediaStaticAssets.length).toBeGreaterThanOrEqual(1)\n      expect(mediaStaticAssets[0]).toMatch(/[\\\\/]media[\\\\/]/)\n      ;[...cssStaticAssets, ...mediaStaticAssets].forEach((asset) => {\n        resources.add(`/static${asset.replace(/\\\\+/g, '/')}`)\n      })\n\n      const responses = await Promise.all(\n        [...resources].map((resource) =>\n          fetchViaHTTP(url, join('/_next', resource))\n        )\n      )\n\n      responses.forEach((res) => {\n        try {\n          expect(res.headers.get('Cache-Control')).toBe(\n            'public, max-age=31536000, immutable'\n          )\n        } catch (err) {\n          err.message = res.url + ' ' + err.message\n          throw err\n        }\n      })\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should set correct Cache-Control header for static 404s","suites":["Production Usage","With basic usage"],"updatePoint":{"line":676,"column":63},"line":676,"code":"    it('should set correct Cache-Control header for static 404s', async () => {\n      // this is to fix where 404 headers are set to 'public, max-age=31536000, immutable'\n      const res = await fetchViaHTTP(\n        `http://localhost:${appPort}`,\n        `/_next//static/common/bad-static.js`\n      )\n\n      expect(res.status).toBe(404)\n      expect(res.headers.get('Cache-Control')).toBe(\n        'no-cache, no-store, max-age=0, must-revalidate'\n      )\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should block special pages","suites":["Production Usage","With basic usage"],"updatePoint":{"line":689,"column":34},"line":689,"code":"    it('should block special pages', async () => {\n      const urls = ['/_document', '/_app']\n      for (const url of urls) {\n        const html = await renderViaHTTP(appPort, url)\n        expect(html).toMatch(/404/)\n      }\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not contain customServer in NEXT_DATA","suites":["Production Usage","With basic usage"],"updatePoint":{"line":697,"column":52},"line":697,"code":"    it('should not contain customServer in NEXT_DATA', async () => {\n      const html = await renderViaHTTP(appPort, '/')\n      const $ = cheerio.load(html)\n      expect('customServer' in JSON.parse($('#__NEXT_DATA__').text())).toBe(\n        false\n      )\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with pages/api/index.js","suites":["Production Usage","API routes"],"updatePoint":{"line":707,"column":43},"line":707,"code":"    it('should work with pages/api/index.js', async () => {\n      const url = `http://localhost:${appPort}`\n      const res = await fetchViaHTTP(url, `/api`)\n      const body = await res.text()\n      expect(body).toEqual('API index works')\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with pages/api/hello.js","suites":["Production Usage","API routes"],"updatePoint":{"line":714,"column":43},"line":714,"code":"    it('should work with pages/api/hello.js', async () => {\n      const url = `http://localhost:${appPort}`\n      const res = await fetchViaHTTP(url, `/api/hello`)\n      const body = await res.text()\n      expect(body).toEqual('API hello works')\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"does not work with pages/api/readfile-dirname.js","suites":["Production Usage","API routes"],"updatePoint":{"line":724,"column":56},"line":724,"code":"    it('does not work with pages/api/readfile-dirname.js', async () => {\n      const url = `http://localhost:${appPort}`\n      const res = await fetchViaHTTP(url, `/api/readfile-dirname`)\n      expect(res.status).toBe(500)\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with pages/api/readfile-processcwd.js","suites":["Production Usage","API routes"],"updatePoint":{"line":730,"column":57},"line":730,"code":"    it('should work with pages/api/readfile-processcwd.js', async () => {\n      const url = `http://localhost:${appPort}`\n      const res = await fetchViaHTTP(url, `/api/readfile-processcwd`)\n      const body = await res.text()\n      expect(body).toBe('item')\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should work with dynamic params and search string","suites":["Production Usage","API routes"],"updatePoint":{"line":737,"column":57},"line":737,"code":"    it('should work with dynamic params and search string', async () => {\n      const url = `http://localhost:${appPort}`\n      const res = await fetchViaHTTP(url, `/api/post-1?val=1`)\n      const body = await res.json()\n\n      expect(body).toEqual({ val: '1', post: 'post-1' })\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate via client side","suites":["Production Usage","With navigation"],"updatePoint":{"line":747,"column":39},"line":747,"code":"    it('should navigate via client side', async () => {\n      const browser = await webdriver(appPort, '/')\n      const text = await browser\n        .elementByCss('a')\n        .click()\n        .waitForElementByCss('.about-page')\n        .elementByCss('.about-page')\n        .text()\n\n      expect(text).toBe('About Page')\n      await browser.close()\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate to nested index via client side","suites":["Production Usage","With navigation"],"updatePoint":{"line":760,"column":55},"line":760,"code":"    it('should navigate to nested index via client side', async () => {\n      const browser = await webdriver(appPort, '/another')\n      await browser.eval('window.beforeNav = 1')\n\n      const text = await browser\n        .elementByCss('a')\n        .click()\n        .waitForElementByCss('.index-page')\n        .elementByCss('p')\n        .text()\n\n      expect(text).toBe('Hello World')\n      expect(await browser.eval('window.beforeNav')).toBe(1)\n      await browser.close()\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should set title by routeChangeComplete event","suites":["Production Usage","With navigation"],"updatePoint":{"line":776,"column":53},"line":776,"code":"    it('should set title by routeChangeComplete event', async () => {\n      const browser = await webdriver(appPort, '/')\n      await browser.eval(function setup() {\n        window.next.router.events.on(\n          'routeChangeComplete',\n          function handler(url) {\n            window.routeChangeTitle = document.title\n            window.routeChangeUrl = url\n          }\n        )\n        window.next.router.push('/with-title')\n      })\n      await browser.waitForElementByCss('#with-title')\n\n      const title = await browser.eval(`window.routeChangeTitle`)\n      const url = await browser.eval(`window.routeChangeUrl`)\n      expect(title).toBe('hello from title')\n      expect(url).toBe('/with-title')\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reload page successfully (on bad link)","suites":["Production Usage","With navigation"],"updatePoint":{"line":796,"column":53},"line":796,"code":"    it('should reload page successfully (on bad link)', async () => {\n      const browser = await webdriver(appPort, '/to-nonexistent')\n      await browser.eval(function setup() {\n        window.__DATA_BE_GONE = 'true'\n      })\n      await browser.waitForElementByCss('#to-nonexistent-page')\n      await browser.click('#to-nonexistent-page')\n      await browser.waitForElementByCss('.about-page')\n\n      const oldData = await browser.eval(`window.__DATA_BE_GONE`)\n      expect(oldData).toBeFalsy()\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reload page successfully (on bad data fetch)","suites":["Production Usage","With navigation"],"updatePoint":{"line":809,"column":59},"line":809,"code":"    it('should reload page successfully (on bad data fetch)', async () => {\n      const browser = await webdriver(appPort, '/to-shadowed-page')\n      await browser.eval(function setup() {\n        window.__DATA_BE_GONE = 'true'\n      })\n      await browser.waitForElementByCss('#to-shadowed-page').click()\n      await browser.waitForElementByCss('.about-page')\n\n      const oldData = await browser.eval(`window.__DATA_BE_GONE`)\n      expect(oldData).toBeFalsy()\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate to external site and back","suites":["Production Usage","With navigation"],"updatePoint":{"line":822,"column":47},"line":822,"code":"  it('should navigate to external site and back', async () => {\n    const browser = await webdriver(appPort, '/external-and-back')\n    const initialText = await browser.elementByCss('p').text()\n    expect(initialText).toBe('server')\n\n    await browser\n      .elementByCss('a')\n      .click()\n      .waitForElementByCss('input')\n      .back()\n      .waitForElementByCss('p')\n\n    await waitFor(1000)\n    const newText = await browser.elementByCss('p').text()\n    expect(newText).toBe('server')\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate to page with CSS and back","suites":["Production Usage","With navigation"],"updatePoint":{"line":839,"column":47},"line":839,"code":"  it('should navigate to page with CSS and back', async () => {\n    const browser = await webdriver(appPort, '/css-and-back')\n    const initialText = await browser.elementByCss('p').text()\n    expect(initialText).toBe('server')\n\n    await browser\n      .elementByCss('a')\n      .click()\n      .waitForElementByCss('input')\n      .back()\n      .waitForElementByCss('p')\n\n    await waitFor(1000)\n    const newText = await browser.elementByCss('p').text()\n    expect(newText).toBe('client')\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate to external site and back (with query)","suites":["Production Usage","With navigation"],"updatePoint":{"line":856,"column":60},"line":856,"code":"  it('should navigate to external site and back (with query)', async () => {\n    const browser = await webdriver(appPort, '/external-and-back?hello=world')\n    const initialText = await browser.elementByCss('p').text()\n    expect(initialText).toBe('server')\n\n    await browser\n      .elementByCss('a')\n      .click()\n      .waitForElementByCss('input')\n      .back()\n      .waitForElementByCss('p')\n\n    await waitFor(1000)\n    const newText = await browser.elementByCss('p').text()\n    expect(newText).toBe('server')\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should change query correctly","suites":["Production Usage","With navigation"],"updatePoint":{"line":873,"column":35},"line":873,"code":"  it('should change query correctly', async () => {\n    const browser = await webdriver(appPort, '/query?id=0')\n    let id = await browser.elementByCss('#q0').text()\n    expect(id).toBe('0')\n\n    await browser.elementByCss('#first').click().waitForElementByCss('#q1')\n\n    id = await browser.elementByCss('#q1').text()\n    expect(id).toBe('1')\n\n    await browser.elementByCss('#second').click().waitForElementByCss('#q2')\n\n    id = await browser.elementByCss('#q2').text()\n    expect(id).toBe('2')\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render a server side error on the client side","suites":["Production Usage","Runtime errors"],"updatePoint":{"line":890,"column":60},"line":890,"code":"    it('should render a server side error on the client side', async () => {\n      const browser = await webdriver(appPort, '/error-in-ssr-render')\n      await waitFor(2000)\n      const text = await browser.elementByCss('body').text()\n      // this makes sure we don't leak the actual error to the client side in production\n      expect(text).toMatch(/Internal Server Error\\./)\n      const headingText = await browser.elementByCss('h1').text()\n      // This makes sure we render statusCode on the client side correctly\n      expect(headingText).toBe('500')\n      await browser.close()\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render a client side component error","suites":["Production Usage","Runtime errors"],"updatePoint":{"line":902,"column":51},"line":902,"code":"    it('should render a client side component error', async () => {\n      const browser = await webdriver(appPort, '/error-in-browser-render')\n      await waitFor(2000)\n      const text = await browser.elementByCss('body').text()\n      expect(text).toMatch(\n        /Application error: a client-side exception has occurred/\n      )\n      await browser.close()\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should call getInitialProps on _error page during a client side component error","suites":["Production Usage","Runtime errors"],"updatePoint":{"line":912,"column":87},"line":912,"code":"    it('should call getInitialProps on _error page during a client side component error', async () => {\n      const browser = await webdriver(\n        appPort,\n        '/error-in-browser-render-status-code'\n      )\n      await waitFor(2000)\n      const text = await browser.elementByCss('body').text()\n      expect(text).toMatch(/This page could not be found\\./)\n      await browser.close()\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle already finished responses","suites":["Production Usage","Misc"],"updatePoint":{"line":925,"column":48},"line":925,"code":"    it('should handle already finished responses', async () => {\n      const html = await renderViaHTTP(appPort, '/finish-response')\n      expect(html).toBe('hi')\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should allow to access /static/ and /_next/","suites":["Production Usage","Misc"],"updatePoint":{"line":930,"column":51},"line":930,"code":"    it('should allow to access /static/ and /_next/', async () => {\n      // This is a test case which prevent the following issue happening again.\n      // See: https://github.com/vercel/next.js/issues/2617\n      await renderViaHTTP(appPort, '/_next/')\n      await renderViaHTTP(appPort, '/static/')\n      const data = await renderViaHTTP(appPort, '/static/data/item.txt')\n      expect(data).toBe('item')\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"Should allow access to public files","suites":["Production Usage","Misc"],"updatePoint":{"line":939,"column":43},"line":939,"code":"    it('Should allow access to public files', async () => {\n      const data = await renderViaHTTP(appPort, '/data/data.txt')\n      const file = await renderViaHTTP(appPort, '/file')\n      const legacy = await renderViaHTTP(appPort, '/static/legacy.txt')\n      expect(data).toBe('data')\n      expect(file).toBe('test')\n      expect(legacy).toMatch(`new static folder`)\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reload the page on page script error","suites":["Production Usage","Misc"],"updatePoint":{"line":953,"column":53},"line":953,"code":"      it('should reload the page on page script error', async () => {\n        const browser = await webdriver(appPort, '/counter')\n        const counter = await browser\n          .elementByCss('#increase')\n          .click()\n          .click()\n          .elementByCss('#counter')\n          .text()\n        expect(counter).toBe('Counter: 2')\n\n        // When we go to the 404 page, it'll do a hard reload.\n        // So, it's possible for the front proxy to load a page from another zone.\n        // Since the page is reloaded, when we go back to the counter page again,\n        // previous counter value should be gone.\n        const counterAfter404Page = await browser\n          .elementByCss('#no-such-page')\n          .click()\n          .waitForElementByCss('h1')\n          .back()\n          .waitForElementByCss('#counter-page')\n          .elementByCss('#counter')\n          .text()\n        expect(counterAfter404Page).toBe('Counter: 0')\n\n        await browser.close()\n      })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have default runtime values when not defined","suites":["Production Usage","Misc"],"updatePoint":{"line":981,"column":59},"line":981,"code":"    it('should have default runtime values when not defined', async () => {\n      const html = await renderViaHTTP(appPort, '/runtime-config')\n      expect(html).toMatch(/found public config/)\n      expect(html).toMatch(/found server config/)\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have runtimeConfig in __NEXT_DATA__","suites":["Production Usage","Misc"],"updatePoint":{"line":987,"column":54},"line":987,"code":"    it('should not have runtimeConfig in __NEXT_DATA__', async () => {\n      const html = await renderViaHTTP(appPort, '/runtime-config')\n      const $ = cheerio.load(html)\n      const script = $('#__NEXT_DATA__').html()\n      expect(script).not.toMatch(/runtimeConfig/)\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should add autoExport for auto pre-rendered pages","suites":["Production Usage","Misc"],"updatePoint":{"line":994,"column":57},"line":994,"code":"    it('should add autoExport for auto pre-rendered pages', async () => {\n      for (const page of ['/', '/about']) {\n        const html = await renderViaHTTP(appPort, page)\n        const $ = cheerio.load(html)\n        const data = JSON.parse($('#__NEXT_DATA__').html())\n        expect(data.autoExport).toBe(true)\n      }\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not add autoExport for non pre-rendered pages","suites":["Production Usage","Misc"],"updatePoint":{"line":1003,"column":60},"line":1003,"code":"    it('should not add autoExport for non pre-rendered pages', async () => {\n      for (const page of ['/query']) {\n        const html = await renderViaHTTP(appPort, page)\n        const $ = cheerio.load(html)\n        const data = JSON.parse($('#__NEXT_DATA__').html())\n        expect(!!data.autoExport).toBe(false)\n      }\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should add prefetch tags when Link prefetch prop is used","suites":["Production Usage","Misc"],"updatePoint":{"line":1012,"column":64},"line":1012,"code":"    it('should add prefetch tags when Link prefetch prop is used', async () => {\n      const browser = await webdriver(appPort, '/prefetch')\n\n      if (browserName === 'internet explorer') {\n        // IntersectionObserver isn't present so we need to trigger manually\n        await waitFor(1000)\n        await browser.eval(`(function() {\n          window.next.router.prefetch('/')\n          window.next.router.prefetch('/process-env')\n          window.next.router.prefetch('/counter')\n          window.next.router.prefetch('/about')\n        })()`)\n      }\n\n      await waitFor(2000)\n\n      if (browserName === 'safari') {\n        const elements = await browser.elementsByCss('link[rel=preload]')\n        // optimized preloading uses defer instead of preloading and prefetches\n        // aren't generated client-side since safari does not support prefetch\n        expect(elements.length).toBe(0)\n      } else {\n        const elements = await browser.elementsByCss('link[rel=prefetch]')\n        expect(elements.length).toBe(4)\n\n        for (const element of elements) {\n          const rel = await element.getAttribute('rel')\n          const as = await element.getAttribute('as')\n          expect(rel).toBe('prefetch')\n          expect(as).toBe('script')\n        }\n      }\n      await browser.close()\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"It does not add a timestamp to link tags with prefetch attribute","suites":["Production Usage","Misc"],"updatePoint":{"line":1049,"column":72},"line":1049,"code":"    it('It does not add a timestamp to link tags with prefetch attribute', async () => {\n      const browser = await webdriver(appPort, '/prefetch')\n      const links = await browser.elementsByCss('link[rel=prefetch]')\n\n      for (const element of links) {\n        const href = await element.getAttribute('href')\n        expect(href).not.toMatch(/\\?ts=/)\n      }\n      const scripts = await browser.elementsByCss('script[src]')\n\n      for (const element of scripts) {\n        const src = await element.getAttribute('src')\n        expect(src).not.toMatch(/\\?ts=/)\n      }\n      await browser.close()\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reload the page on page script error with prefetch","suites":["Production Usage","Misc"],"updatePoint":{"line":1067,"column":67},"line":1067,"code":"      it('should reload the page on page script error with prefetch', async () => {\n        const browser = await webdriver(appPort, '/counter')\n        if (global.browserName !== 'chrome') return\n        const counter = await browser\n          .elementByCss('#increase')\n          .click()\n          .click()\n          .elementByCss('#counter')\n          .text()\n        expect(counter).toBe('Counter: 2')\n\n        // Let the browser to prefetch the page and error it on the console.\n        await waitFor(3000)\n\n        // When we go to the 404 page, it'll do a hard reload.\n        // So, it's possible for the front proxy to load a page from another zone.\n        // Since the page is reloaded, when we go back to the counter page again,\n        // previous counter value should be gone.\n        const counterAfter404Page = await browser\n          .elementByCss('#no-such-page-prefetch')\n          .click()\n          .waitForElementByCss('h1')\n          .back()\n          .waitForElementByCss('#counter-page')\n          .elementByCss('#counter')\n          .text()\n        expect(counterAfter404Page).toBe('Counter: 0')\n\n        await browser.close()\n      })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not expose the compiled page file in development","suites":["Production Usage","Misc"],"updatePoint":{"line":1100,"column":61},"line":1100,"code":"  it('should not expose the compiled page file in development', async () => {\n    const url = `http://localhost:${appPort}`\n    await fetchViaHTTP(`${url}`, `/stateless`) // make sure the stateless page is built\n    const clientSideJsRes = await fetchViaHTTP(\n      `${url}`,\n      '/_next/development/static/development/pages/stateless.js'\n    )\n    expect(clientSideJsRes.status).toBe(404)\n    const clientSideJsBody = await clientSideJsRes.text()\n    expect(clientSideJsBody).toMatch(/404/)\n\n    const serverSideJsRes = await fetchViaHTTP(\n      `${url}`,\n      '/_next/development/server/static/development/pages/stateless.js'\n    )\n    expect(serverSideJsRes.status).toBe(404)\n    const serverSideJsBody = await serverSideJsRes.text()\n    expect(serverSideJsBody).toMatch(/404/)\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not put backslashes in pages-manifest.json","suites":["Production Usage","Misc"],"updatePoint":{"line":1120,"column":55},"line":1120,"code":"  it('should not put backslashes in pages-manifest.json', () => {\n    // Whatever platform you build on, pages-manifest.json should use forward slash (/)\n    // See: https://github.com/vercel/next.js/issues/4920\n    const pagesManifest = require(join('..', '.next', 'server', PAGES_MANIFEST))\n\n    for (let key of Object.keys(pagesManifest)) {\n      expect(key).not.toMatch(/\\\\/)\n      expect(pagesManifest[key]).not.toMatch(/\\\\/)\n    }\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle failed param decoding","suites":["Production Usage","Misc"],"updatePoint":{"line":1131,"column":41},"line":1131,"code":"  it('should handle failed param decoding', async () => {\n    const html = await renderViaHTTP(appPort, '/invalid-param/%DE~%C7%1fY/')\n    expect(html).toMatch(/400/)\n    expect(html).toMatch(/Bad Request/)\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should replace static pages with HTML files","suites":["Production Usage","Misc"],"updatePoint":{"line":1137,"column":49},"line":1137,"code":"  it('should replace static pages with HTML files', async () => {\n    const pages = ['/about', '/another', '/counter', '/dynamic', '/prefetch']\n    for (const page of pages) {\n      const file = getPageFileFromPagesManifest(appDir, page)\n\n      expect(file.endsWith('.html')).toBe(true)\n    }\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not replace non-static pages with HTML files","suites":["Production Usage","Misc"],"updatePoint":{"line":1146,"column":57},"line":1146,"code":"  it('should not replace non-static pages with HTML files', async () => {\n    const pages = ['/api', '/external-and-back', '/finish-response']\n\n    for (const page of pages) {\n      const file = getPageFileFromPagesManifest(appDir, page)\n\n      expect(file.endsWith('.js')).toBe(true)\n    }\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle AMP correctly in IE","suites":["Production Usage","Misc"],"updatePoint":{"line":1156,"column":39},"line":1156,"code":"  it('should handle AMP correctly in IE', async () => {\n    const browser = await webdriver(appPort, '/some-amp')\n    const text = await browser.elementByCss('p').text()\n    expect(text).toBe('Not AMP')\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should warn when prefetch is true","suites":["Production Usage","Misc"],"updatePoint":{"line":1162,"column":39},"line":1162,"code":"  it('should warn when prefetch is true', async () => {\n    if (global.browserName !== 'chrome') return\n    let browser\n    try {\n      browser = await webdriver(appPort, '/development-logs')\n      const browserLogs = await browser.log('browser')\n      let found = false\n      browserLogs.forEach((log) => {\n        if (log.message.includes('Next.js auto-prefetches automatically')) {\n          found = true\n        }\n      })\n      expect(found).toBe(false)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not emit profiling events","suites":["Production Usage","Misc"],"updatePoint":{"line":1182,"column":38},"line":1182,"code":"  it('should not emit profiling events', async () => {\n    expect(existsSync(join(appDir, '.next', 'profile-events.json'))).toBe(false)\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not emit stats","suites":["Production Usage","Misc"],"updatePoint":{"line":1186,"column":27},"line":1186,"code":"  it('should not emit stats', async () => {\n    expect(existsSync(join(appDir, '.next', 'next-stats.json'))).toBe(false)\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should contain the Next.js version in window export","suites":["Production Usage","Misc"],"updatePoint":{"line":1190,"column":57},"line":1190,"code":"  it('should contain the Next.js version in window export', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/about')\n      const version = await browser.eval('window.next.version')\n      expect(version).toBeTruthy()\n      expect(version).toBe(require('next/package.json').version)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should clear all core performance marks","suites":["Production Usage","Misc"],"updatePoint":{"line":1204,"column":45},"line":1204,"code":"  it('should clear all core performance marks', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/fully-dynamic')\n\n      const currentPerfMarks = await browser.eval(\n        `window.performance.getEntriesByType('mark')`\n      )\n      const allPerfMarks = [\n        'beforeRender',\n        'afterHydrate',\n        'afterRender',\n        'routeChange',\n      ]\n\n      allPerfMarks.forEach((name) =>\n        expect(currentPerfMarks).not.toContainEqual(\n          expect.objectContaining({ name })\n        )\n      )\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not clear custom performance marks","suites":["Production Usage","Misc"],"updatePoint":{"line":1231,"column":47},"line":1231,"code":"  it('should not clear custom performance marks', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/mark-in-head')\n\n      const customMarkFound = await browser.eval(\n        `window.performance.getEntriesByType('mark').filter(function(e) {\n          return e.name === 'custom-mark'\n        }).length === 1`\n      )\n      expect(customMarkFound).toBe(true)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have defer on all script tags","suites":["Production Usage","Misc"],"updatePoint":{"line":1249,"column":42},"line":1249,"code":"  it('should have defer on all script tags', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(html)\n    let missing = false\n\n    for (const script of $('script').toArray()) {\n      // application/json doesn't need async\n      if (\n        script.attribs.type === 'application/json' ||\n        script.attribs.src.includes('polyfills')\n      ) {\n        continue\n      }\n\n      if (script.attribs.defer !== '' || script.attribs.async === '') {\n        missing = true\n      }\n    }\n    expect(missing).toBe(false)\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should only have one DOCTYPE","suites":["Production Usage","Misc"],"updatePoint":{"line":1270,"column":34},"line":1270,"code":"  it('should only have one DOCTYPE', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toMatch(/^<!DOCTYPE html><html/)\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should preserve query when hard navigating from page 404","suites":["Production Usage","Misc"],"updatePoint":{"line":1276,"column":64},"line":1276,"code":"    it('should preserve query when hard navigating from page 404', async () => {\n      const browser = await webdriver(appPort, '/')\n      await browser.eval(`(function() {\n        window.beforeNav = 1\n        window.next.router.push({\n          pathname: '/non-existent',\n          query: { hello: 'world' }\n        })\n      })()`)\n\n      await check(\n        () => browser.eval('document.documentElement.innerHTML'),\n        /page could not be found/\n      )\n\n      expect(await browser.eval('window.beforeNav')).toBeFalsy()\n      expect(await browser.eval('window.location.hash')).toBe('')\n      expect(await browser.eval('window.location.search')).toBe('?hello=world')\n      expect(await browser.eval('window.location.pathname')).toBe(\n        '/non-existent'\n      )\n    })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should remove placeholder for next/image correctly","suites":["Production Usage","Misc"],"updatePoint":{"line":1300,"column":56},"line":1300,"code":"  it('should remove placeholder for next/image correctly', async () => {\n    const browser = await webdriver(context.appPort, '/')\n\n    await browser.eval(`(function() {\n        window.beforeNav = 1\n        window.next.router.push('/static-image')\n      })()`)\n    await browser.waitForElementByCss('#static-image')\n\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n\n    await check(\n      () => browser.elementByCss('img').getComputedCss('background-image'),\n      'none'\n    )\n\n    await browser.eval(`(function() {\n        window.beforeNav = 1\n        window.next.router.push('/')\n      })()`)\n    await browser.waitForElementByCss('.index-page')\n    await waitFor(1000)\n\n    await browser.eval(`(function() {\n        window.beforeNav = 1\n        window.next.router.push('/static-image')\n      })()`)\n    await browser.waitForElementByCss('#static-image')\n\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n\n    await check(\n      () =>\n        browser\n          .elementByCss('#static-image')\n          .getComputedCss('background-image'),\n      'none'\n    )\n\n    for (let i = 0; i < 5; i++) {\n      expect(\n        await browser\n          .elementByCss('#static-image')\n          .getComputedCss('background-image')\n      ).toBe('none')\n      await waitFor(500)\n    }\n  })","file":"integration/production/test/index.test.js","skipped":false,"dir":"test"},{"name":"should emit files","suites":["Profiling Usage","Profiling the build"],"updatePoint":{"line":22,"column":25},"line":22,"code":"    it('should emit files', async () => {\n      expect(fs.existsSync(profileEventsPath)).toBe(true)\n    })","file":"integration/profiling/test/index.test.js","skipped":true,"dir":"test"},{"name":"should have correct query on SSR","suites":["Query String with Encoding","new line"],"updatePoint":{"line":28,"column":40},"line":28,"code":"    it('should have correct query on SSR', async () => {\n      const browser = await webdriver(appPort, '/?test=abc%0A')\n      try {\n        const text = await browser.elementByCss('#query-content').text()\n        expect(text).toBe('{\"test\":\"abc\\\\n\"}')\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/query-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on Router#push","suites":["Query String with Encoding","new line"],"updatePoint":{"line":38,"column":48},"line":38,"code":"    it('should have correct query on Router#push', async () => {\n      const browser = await webdriver(appPort, '/')\n      try {\n        await browser.waitForCondition('!!window.next.router')\n        await browser.eval(\n          `window.next.router.push({pathname:'/',query:{abc:'def\\\\n'}})`\n        )\n        const text = await browser.waitForElementByCss('#query-content').text()\n        expect(text).toBe('{\"abc\":\"def\\\\n\"}')\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/query-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on simple client-side <Link>","suites":["Query String with Encoding","new line"],"updatePoint":{"line":52,"column":62},"line":52,"code":"    it('should have correct query on simple client-side <Link>', async () => {\n      const browser = await webdriver(appPort, '/newline')\n      try {\n        await browser.waitForElementByCss('#hello-lf').click()\n        const text = await browser.waitForElementByCss('#query-content').text()\n        expect(text).toBe('{\"another\":\"hello\\\\n\"}')\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/query-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on complex client-side <Link>","suites":["Query String with Encoding","new line"],"updatePoint":{"line":63,"column":63},"line":63,"code":"    it('should have correct query on complex client-side <Link>', async () => {\n      const browser = await webdriver(appPort, '/newline')\n      try {\n        await browser.waitForElementByCss('#hello-complex').click()\n        const text = await browser.waitForElementByCss('#query-content').text()\n        expect(text).toBe('{\"complex\":\"yes\\\\n\"}')\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/query-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on SSR","suites":["Query String with Encoding","trailing space"],"updatePoint":{"line":76,"column":40},"line":76,"code":"    it('should have correct query on SSR', async () => {\n      const browser = await webdriver(appPort, '/?test=abc%20')\n      try {\n        const text = await browser.elementByCss('#query-content').text()\n        expect(text).toBe('{\"test\":\"abc \"}')\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/query-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on Router#push","suites":["Query String with Encoding","trailing space"],"updatePoint":{"line":86,"column":48},"line":86,"code":"    it('should have correct query on Router#push', async () => {\n      const browser = await webdriver(appPort, '/')\n      try {\n        await browser.waitForCondition('!!window.next.router')\n        await browser.eval(\n          `window.next.router.push({pathname:'/',query:{abc:'def '}})`\n        )\n        const text = await browser.waitForElementByCss('#query-content').text()\n        expect(text).toBe('{\"abc\":\"def \"}')\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/query-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on simple client-side <Link>","suites":["Query String with Encoding","trailing space"],"updatePoint":{"line":100,"column":62},"line":100,"code":"    it('should have correct query on simple client-side <Link>', async () => {\n      const browser = await webdriver(appPort, '/space')\n      try {\n        await browser.waitForElementByCss('#hello-space').click()\n        const text = await browser.waitForElementByCss('#query-content').text()\n        expect(text).toBe('{\"another\":\"hello \"}')\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/query-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on complex client-side <Link>","suites":["Query String with Encoding","trailing space"],"updatePoint":{"line":111,"column":63},"line":111,"code":"    it('should have correct query on complex client-side <Link>', async () => {\n      const browser = await webdriver(appPort, '/space')\n      try {\n        await browser.waitForElementByCss('#hello-complex').click()\n        const text = await browser.waitForElementByCss('#query-content').text()\n        expect(text).toBe('{\"complex\":\"yes \"}')\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/query-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on SSR","suites":["Query String with Encoding","percent"],"updatePoint":{"line":124,"column":40},"line":124,"code":"    it('should have correct query on SSR', async () => {\n      const browser = await webdriver(appPort, '/?test=abc%25')\n      try {\n        const text = await browser.elementByCss('#query-content').text()\n        expect(text).toBe('{\"test\":\"abc%\"}')\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/query-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on Router#push","suites":["Query String with Encoding","percent"],"updatePoint":{"line":134,"column":48},"line":134,"code":"    it('should have correct query on Router#push', async () => {\n      const browser = await webdriver(appPort, '/')\n      try {\n        await browser.waitForCondition('!!window.next.router')\n        await browser.eval(\n          `window.next.router.push({pathname:'/',query:{abc:'def%'}})`\n        )\n        const text = await browser.waitForElementByCss('#query-content').text()\n        expect(text).toBe('{\"abc\":\"def%\"}')\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/query-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on simple client-side <Link>","suites":["Query String with Encoding","percent"],"updatePoint":{"line":148,"column":62},"line":148,"code":"    it('should have correct query on simple client-side <Link>', async () => {\n      const browser = await webdriver(appPort, '/percent')\n      try {\n        await browser.waitForElementByCss('#hello-percent').click()\n        const text = await browser.waitForElementByCss('#query-content').text()\n        expect(text).toBe('{\"another\":\"hello%\"}')\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/query-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on complex client-side <Link>","suites":["Query String with Encoding","percent"],"updatePoint":{"line":159,"column":63},"line":159,"code":"    it('should have correct query on complex client-side <Link>', async () => {\n      const browser = await webdriver(appPort, '/percent')\n      try {\n        await browser.waitForElementByCss('#hello-complex').click()\n        const text = await browser.waitForElementByCss('#query-content').text()\n        expect(text).toBe('{\"complex\":\"yes%\"}')\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/query-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on SSR","suites":["Query String with Encoding","plus"],"updatePoint":{"line":172,"column":40},"line":172,"code":"    it('should have correct query on SSR', async () => {\n      const browser = await webdriver(appPort, '/?test=abc%2B')\n      try {\n        const text = await browser.elementByCss('#query-content').text()\n        expect(text).toBe('{\"test\":\"abc+\"}')\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/query-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on Router#push","suites":["Query String with Encoding","plus"],"updatePoint":{"line":182,"column":48},"line":182,"code":"    it('should have correct query on Router#push', async () => {\n      const browser = await webdriver(appPort, '/')\n      try {\n        await browser.waitForCondition('!!window.next.router')\n        await browser.eval(\n          `window.next.router.push({pathname:'/',query:{abc:'def+'}})`\n        )\n        const text = await browser.waitForElementByCss('#query-content').text()\n        expect(text).toBe('{\"abc\":\"def+\"}')\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/query-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on simple client-side <Link>","suites":["Query String with Encoding","plus"],"updatePoint":{"line":196,"column":62},"line":196,"code":"    it('should have correct query on simple client-side <Link>', async () => {\n      const browser = await webdriver(appPort, '/plus')\n      try {\n        await browser.waitForElementByCss('#hello-plus').click()\n        const text = await browser.waitForElementByCss('#query-content').text()\n        expect(text).toBe('{\"another\":\"hello+\"}')\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/query-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct query on complex client-side <Link>","suites":["Query String with Encoding","plus"],"updatePoint":{"line":207,"column":63},"line":207,"code":"    it('should have correct query on complex client-side <Link>', async () => {\n      const browser = await webdriver(appPort, '/plus')\n      try {\n        await browser.waitForElementByCss('#hello-complex').click()\n        const text = await browser.waitForElementByCss('#query-content').text()\n        expect(text).toBe('{\"complex\":\"yes+\"}')\n      } finally {\n        await browser.close()\n      }\n    })","file":"integration/query-with-encoding/test/index.test.js","skipped":false,"dir":"test"},{"name":"shows error when a page re-export all exports","suites":["Re-export all exports from page is disallowed"],"updatePoint":{"line":8,"column":51},"line":8,"code":"  it('shows error when a page re-export all exports', async () => {\n    const { code, stderr } = await nextBuild(appDir, undefined, {\n      stderr: true,\n    })\n    expect(code).toBe(1)\n    expect(stderr).toMatch(/\\/export-all-in-page/)\n\n    expect(stderr.split('\\n\\n')[1]).toMatchInlineSnapshot(`\n      \"./pages/contact.js:3:1\n      Syntax error: Using \\`export * from '...'\\` in a page is disallowed. Please use \\`export { default } from '...'\\` instead.\n      Read more: https://nextjs.org/docs/messages/export-all-in-page\"\n    `)\n  })","file":"integration/re-export-all-exports-from-page-disallowed/test/index.test.js","skipped":false,"dir":"test"},{"name":"builds without error when no `export * from \"...\"` is used in pages","suites":["Re-export all exports from page is disallowed"],"updatePoint":{"line":22,"column":73},"line":22,"code":"  it('builds without error when no `export * from \"...\"` is used in pages', async () => {\n    const f = new File(join(appDir, 'pages', 'contact.js'))\n    f.replace(/^export \\*/gm, '// export *')\n    try {\n      const { code, stderr } = await nextBuild(appDir, undefined, {\n        stderr: true,\n      })\n      expect(code).toBe(0)\n      expect(stderr).not.toMatch(/\\/export-all-in-page/)\n    } finally {\n      f.restore()\n    }\n  })","file":"integration/re-export-all-exports-from-page-disallowed/test/index.test.js","skipped":false,"dir":"test"},{"name":"should install react 18 when `experimental.runtime` is enabled","suites":["Invalid react 18 webpack config"],"updatePoint":{"line":20,"column":68},"line":20,"code":"  it('should install react 18 when `experimental.runtime` is enabled', async () => {\n    writeNextConfig({\n      runtime: 'experimental-edge',\n    })\n    const { stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n      nodeArgs,\n      env: { __NEXT_REACT_CHANNEL: '17' },\n    })\n    nextConfig.restore()\n\n    expect(stderr).toContain(\n      '`experimental.runtime` requires React 18 to be installed.'\n    )\n  })","file":"integration/react-18-invalid-config/index.test.js","skipped":false,"dir":"test"},{"name":"suspense is not allowed in blocking rendering mode","suites":["React 17 with React 18 config"],"updatePoint":{"line":51,"column":56},"line":51,"code":"  it('suspense is not allowed in blocking rendering mode', async () => {\n    const { stderr, code } = await nextBuild(appDir, [], {\n      stderr: true,\n      nodeArgs,\n      env: {\n        __NEXT_REACT_CHANNEL: '17',\n      },\n    })\n    expect(stderr).toContain(\n      'Invalid suspense option usage in next/dynamic. Read more: https://nextjs.org/docs/messages/invalid-dynamic-suspense'\n    )\n    expect(code).toBe(1)\n  })","file":"integration/react-18-invalid-config/index.test.js","skipped":false,"dir":"test"},{"name":"should recover after undefined exported as default","suites":["Strict mode - dev"],"updatePoint":{"line":55,"column":62},"line":55,"code":"        it('should recover after undefined exported as default', async () => {\n          const browser = await webdriver(context.appPort, '/invalid')\n\n          expect(await hasRedbox(browser)).toBe(true)\n          expect(await getRedboxHeader(browser)).toMatch(\n            `Error: The default export is not a React Component in page: \"/invalid\"`\n          )\n        })","file":"integration/react-18/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have invalid config warning","suites":["Strict mode - dev"],"updatePoint":{"line":65,"column":48},"line":65,"code":"      it('should not have invalid config warning', async () => {\n        await renderViaHTTP(context.appPort, '/')\n        expect(context.stderr).not.toContain('not exist in this version')\n      })","file":"integration/react-18/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have used the react-dom profiling bundle","suites":["React Profiling Mode","without config enabled"],"updatePoint":{"line":23,"column":59},"line":23,"code":"    it('should not have used the react-dom profiling bundle', async () => {\n      const browser = await webdriver(appPort, '/')\n      const results = await browser.eval('window.profileResults')\n\n      expect(results).toBeFalsy()\n    })","file":"integration/react-profiling-mode/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have used the react-dom profiling bundle","suites":["React Profiling Mode","with config enabled"],"updatePoint":{"line":50,"column":55},"line":50,"code":"    it('should have used the react-dom profiling bundle', async () => {\n      const browser = await webdriver(appPort, '/')\n      const results = await browser.eval('window.profileResults')\n\n      expect(results.length).toBe(1)\n      expect(results[0] && results[0][0]).toBe('hello')\n    })","file":"integration/react-profiling-mode/test/index.test.js","skipped":false,"dir":"test"},{"name":"should detect changes to a page","suites":["Read-only source HMR"],"updatePoint":{"line":58,"column":37},"line":58,"code":"  it('should detect changes to a page', async () => {\n    let browser\n\n    try {\n      browser = await webdriver(appPort, '/hello')\n      await check(() => getBrowserBodyText(browser), /Hello World/)\n\n      const originalContent = await fs.readFile(pagePath, 'utf8')\n      const editedContent = originalContent.replace('Hello World', 'COOL page')\n\n      await writeReadOnlyFile(pagePath, editedContent)\n      await check(() => getBrowserBodyText(browser), /COOL page/)\n\n      await writeReadOnlyFile(pagePath, originalContent)\n      await check(() => getBrowserBodyText(browser), /Hello World/)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/read-only-source-hmr/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle page deletion and subsequent recreation","suites":["Read-only source HMR"],"updatePoint":{"line":80,"column":59},"line":80,"code":"  it('should handle page deletion and subsequent recreation', async () => {\n    let browser\n\n    try {\n      browser = await webdriver(appPort, '/hello')\n      await check(() => getBrowserBodyText(browser), /Hello World/)\n\n      const originalContent = await fs.readFile(pagePath, 'utf8')\n\n      await fs.remove(pagePath)\n\n      await writeReadOnlyFile(pagePath, originalContent)\n      await check(() => getBrowserBodyText(browser), /Hello World/)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/read-only-source-hmr/test/index.test.js","skipped":false,"dir":"test"},{"name":"should detect a new page","suites":["Read-only source HMR"],"updatePoint":{"line":100,"column":30},"line":100,"code":"  it('should detect a new page', async () => {\n    let browser\n    const newPagePath = join(appDir, 'pages/new.js')\n\n    try {\n      await writeReadOnlyFile(\n        newPagePath,\n        `\n        const New = () => <p>New page</p>\n  \n        export default New\n      `\n      )\n\n      browser = await webdriver(appPort, '/new')\n      await check(() => getBrowserBodyText(browser), /New page/)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n      await fs.remove(newPagePath)\n    }\n  })","file":"integration/read-only-source-hmr/test/index.test.js","skipped":false,"dir":"test"},{"name":"Does not relay any data","suites":["Analytics relayer (disabled)"],"updatePoint":{"line":29,"column":29},"line":29,"code":"  it('Does not relay any data', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.waitForElementByCss('h1')\n    const h1Text = await browser.elementByCss('h1').text()\n    const firstContentfulPaint = parseFloat(\n      await browser.eval('localStorage.getItem(\"FCP\")')\n    )\n\n    expect(h1Text).toMatch(/Foo!/)\n\n    expect(firstContentfulPaint).not.toBeNaN()\n    expect(firstContentfulPaint).toBeGreaterThan(0)\n\n    const beacons = (await browser.eval('window.__BEACONS')).map(([, value]) =>\n      Object.fromEntries(new URLSearchParams(value))\n    )\n\n    expect(beacons.length).toBe(0)\n\n    expect(stdout).not.toMatch('Next.js Analytics')\n\n    await browser.close()\n  })","file":"integration/relay-analytics-disabled/test/index.test.js","skipped":false,"dir":"test"},{"name":"Does not include the code","suites":["Analytics relayer (disabled)"],"updatePoint":{"line":53,"column":31},"line":53,"code":"  it('Does not include the code', async () => {\n    const pageFiles = [\n      ...new Set([\n        ...buildManifest.pages['/'].filter((file) => file.endsWith('.js')),\n        ...buildManifest.pages['/_app'].filter((file) => file.endsWith('.js')),\n      ]),\n    ]\n\n    expect(pageFiles.length).toBeGreaterThan(1)\n\n    for (const pageFile of pageFiles) {\n      const content = await fs.readFile(\n        path.join(appDir, '.next', pageFile),\n        'utf8'\n      )\n      expect(content).not.toMatch('vercel-insights')\n    }\n  })","file":"integration/relay-analytics-disabled/test/index.test.js","skipped":false,"dir":"test"},{"name":"Relays the data to user code","suites":["Analytics relayer with exported method"],"updatePoint":{"line":33,"column":34},"line":33,"code":"  it('Relays the data to user code', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.waitForElementByCss('h1')\n\n    const h1Text = await browser.elementByCss('h1').text()\n    const data = parseFloat(\n      await browser.eval('localStorage.getItem(\"Next.js-hydration\")')\n    )\n    const firstByte = parseFloat(\n      await browser.eval('localStorage.getItem(\"TTFB\")')\n    )\n    const firstContentfulPaint = parseFloat(\n      await browser.eval('localStorage.getItem(\"FCP\")')\n    )\n    let largestContentfulPaint = await browser.eval(\n      'localStorage.getItem(\"LCP\")'\n    )\n    let cls = await browser.eval('localStorage.getItem(\"CLS\")')\n    expect(h1Text).toMatch(/Foo!/)\n    expect(data).not.toBeNaN()\n    expect(data).toBeGreaterThan(0)\n    expect(firstByte).not.toBeNaN()\n    expect(firstByte).toBeGreaterThan(0)\n    expect(firstContentfulPaint).not.toBeNaN()\n    expect(firstContentfulPaint).toBeGreaterThan(0)\n    expect(largestContentfulPaint).toBeNull()\n    expect(cls).toBeNull()\n\n    const beaconsCountBeforeCLS = await browser.eval('window.__BEACONS_COUNT')\n    expect(\n      Object.values(beaconsCountBeforeCLS).every((value) => value === 1)\n    ).toBe(true)\n\n    // Create an artificial layout shift\n    await browser.eval('document.querySelector(\"h1\").style.display = \"none\"')\n    await browser.refresh()\n    await browser.waitForElementByCss('h1')\n    largestContentfulPaint = parseFloat(\n      await browser.eval('localStorage.getItem(\"LCP\")')\n    )\n    cls = parseFloat(await browser.eval('localStorage.getItem(\"CLS\")'))\n    expect(cls).not.toBeNull()\n    expect(largestContentfulPaint).not.toBeNaN()\n    expect(largestContentfulPaint).toBeGreaterThan(0)\n\n    await check(async () => {\n      const numBeacons = await browser.eval('window.__BEACONS.length')\n      return numBeacons === 2\n        ? 'success'\n        : `invalid beacon count: ${numBeacons}`\n    }, 'success')\n\n    const beacons = (await browser.eval('window.__BEACONS')).map(([, value]) =>\n      Object.fromEntries(new URLSearchParams(value))\n    )\n\n    const beaconsCountAfterCLS = await browser.eval('window.__BEACONS_COUNT')\n    expect(\n      Object.values(beaconsCountAfterCLS).every((value) => value === 2)\n    ).toBe(true)\n\n    expect(beacons.length).toBe(2)\n\n    for (const beacon of beacons) {\n      expect(beacon.event_name === 'FCP' || beacon.event_name === 'TTFB').toBe(\n        true\n      )\n      expect(beacon.dsn).toBe('test')\n      expect(beacon.href.includes('http://')).toBe(true)\n      expect(beacon.id.includes('-')).toBe(true)\n      expect(beacon.page).toBe('/')\n      expect(beacon.speed).toBe('4g')\n      expect(isNaN(parseFloat(beacon.value))).toBe(false)\n    }\n\n    expect(stdout).toMatch('Next.js Analytics')\n    await browser.close()\n  })","file":"integration/relay-analytics/test/index.test.js","skipped":false,"dir":"test"},{"name":"reports INP metric","suites":["Analytics relayer with exported method"],"updatePoint":{"line":112,"column":24},"line":112,"code":"  it('reports INP metric', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.elementByCss('button').click()\n    await browser.waitForCondition(\n      'document.querySelector(\"button\").textContent === \"Press\"'\n    )\n    // INP metric is only reported on pagehide or visibilitychange event, so refresh the page\n    await browser.refresh()\n    await check(async () => {\n      const INP = parseInt(\n        await browser.eval('localStorage.getItem(\"INP\")'),\n        10\n      )\n      // We introduced a delay of 100ms, so INP duration should be >= 100\n      expect(INP).toBeGreaterThanOrEqual(100)\n      return 'success'\n    }, 'success')\n    await browser.close()\n  })","file":"integration/relay-analytics/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve index page correctly","suites":[],"updatePoint":{"line":19,"column":41},"line":19,"code":"  it('should resolve index page correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toContain(project)\n    expect(html).toContain(`Hello, World!`)\n  })","file":"integration/relay-graphql-swc-multi-project/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve index page correctly","suites":[],"updatePoint":{"line":18,"column":41},"line":18,"code":"  it('should resolve index page correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toContain('Hello, World!')\n  })","file":"integration/relay-graphql-swc-single-project/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render error page","suites":["Module Init Error"],"updatePoint":{"line":33,"column":30},"line":33,"code":"  it('should render error page', async () => {\n    const browser = await webdriver(appPort, '/')\n    try {\n      await waitFor(2000)\n      const text = await browser.elementByCss('#error-p').text()\n      expect(text).toBe('Error Rendered')\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/render-error-on-module-error/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render error page with getInitialProps","suites":["Top Level Error"],"updatePoint":{"line":28,"column":51},"line":28,"code":"  it('should render error page with getInitialProps', async () => {\n    const browser = await webdriver(appPort, '/')\n    try {\n      const text = await browser.waitForElementByCss('#error-p').text()\n      expect(text).toBe('Error Rendered with: top level error')\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/render-error-on-top-level-error/with-get-initial-props/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render error page","suites":["Top Level Error"],"updatePoint":{"line":28,"column":30},"line":28,"code":"  it('should render error page', async () => {\n    const browser = await webdriver(appPort, '/')\n    try {\n      const text = await browser.waitForElementByCss('#error-p').text()\n      expect(text).toBe('Error Rendered')\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/render-error-on-top-level-error/without-get-initial-props/test/index.test.js","skipped":false,"dir":"test"},{"name":"should normalize repeated slashes in redirects correctly","suites":[],"updatePoint":{"line":57,"column":64},"line":57,"code":"    it('should normalize repeated slashes in redirects correctly', async () => {\n      const res = await fetchViaHTTP(\n        appPort,\n        '/redirect-forward-slashes',\n        undefined,\n        {\n          redirect: 'manual',\n        }\n      )\n\n      expect(res.status).toBe(307)\n      const parsedUrl = url.parse(res.headers.get('location'), true)\n\n      expect(parsedUrl.hostname).toBe('localhost')\n      expect(parsedUrl.pathname).toBe('/test/google.com')\n      expect(parsedUrl.query).toEqual({})\n      expect(await res.text()).toBe('/test/google.com')\n\n      const res2 = await fetchViaHTTP(\n        appPort,\n        '/redirect-back-slashes',\n        undefined,\n        {\n          redirect: 'manual',\n        }\n      )\n\n      expect(res2.status).toBe(307)\n      const parsedUrl2 = url.parse(res2.headers.get('location'), true)\n\n      expect(parsedUrl2.hostname).toBe('localhost')\n      expect(parsedUrl2.pathname).toBe('/test/google.com')\n      expect(parsedUrl2.query).toEqual({})\n      expect(await res2.text()).toBe('/test/google.com')\n    })","file":"integration/repeated-slashes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle double slashes correctly","suites":[],"updatePoint":{"line":94,"column":44},"line":94,"code":"  it('should handle double slashes correctly', async () => {\n    if (!isExport) {\n      const res = await fetchViaHTTP(appPort, '//google.com', undefined, {\n        redirect: 'manual',\n      })\n      expect(res.status).toBe(308)\n\n      const parsedUrl = url.parse(res.headers.get('location'), true)\n      expect(parsedUrl.pathname).toBe('/google.com')\n      expect(parsedUrl.hostname).toBe('localhost')\n      expect(parsedUrl.query).toEqual({})\n    }\n\n    const browser = await webdriver(appPort, '//google.com')\n    await didNotReload(browser)\n    expect(await browser.eval('window.location.pathname')).toBe(\n      isExport ? '//google.com' : '/google.com'\n    )\n    expect(await browser.eval('window.location.search')).toBe('')\n    expect(await browser.eval('window.location.hash')).toBe('')\n    expect(await browser.eval('document.documentElement.innerHTML')).toContain(\n      notFoundContent\n    )\n  })","file":"integration/repeated-slashes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle double slashes correctly with query","suites":[],"updatePoint":{"line":119,"column":55},"line":119,"code":"  it('should handle double slashes correctly with query', async () => {\n    if (!isExport) {\n      const res = await fetchViaHTTP(\n        appPort,\n        '//google.com',\n        { h: '1' },\n        {\n          redirect: 'manual',\n        }\n      )\n      expect(res.status).toBe(308)\n      const parsedUrl = url.parse(res.headers.get('location'), true)\n      expect(parsedUrl.pathname).toBe('/google.com')\n      expect(parsedUrl.hostname).toBe('localhost')\n      expect(parsedUrl.query).toEqual({ h: '1' })\n    }\n\n    const browser = await webdriver(appPort, '//google.com?h=1')\n    await didNotReload(browser)\n    expect(await browser.eval('window.location.pathname')).toBe(\n      isExport ? '//google.com' : '/google.com'\n    )\n    expect(await browser.eval('window.location.search')).toBe('?h=1')\n    expect(await browser.eval('window.location.hash')).toBe('')\n    expect(await browser.eval('document.documentElement.innerHTML')).toContain(\n      notFoundContent\n    )\n  })","file":"integration/repeated-slashes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle double slashes correctly with hash","suites":[],"updatePoint":{"line":148,"column":54},"line":148,"code":"  it('should handle double slashes correctly with hash', async () => {\n    if (!isExport) {\n      const res = await fetchViaHTTP(appPort, '//google.com', undefined, {\n        redirect: 'manual',\n      })\n      expect(res.status).toBe(308)\n      const parsedUrl = url.parse(res.headers.get('location'), true)\n      expect(parsedUrl.pathname).toBe('/google.com')\n      expect(parsedUrl.hostname).toBe('localhost')\n      expect(parsedUrl.query).toEqual({})\n    }\n\n    const browser = await webdriver(appPort, '//google.com#hello')\n    await didNotReload(browser)\n    expect(await browser.eval('window.location.pathname')).toBe(\n      isExport ? '//google.com' : '/google.com'\n    )\n    expect(await browser.eval('window.location.hash')).toBe('#hello')\n    expect(await browser.eval('window.location.search')).toBe('')\n    expect(await browser.eval('document.documentElement.innerHTML')).toContain(\n      notFoundContent\n    )\n  })","file":"integration/repeated-slashes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle double slashes correctly with encoded","suites":[],"updatePoint":{"line":172,"column":57},"line":172,"code":"  it('should handle double slashes correctly with encoded', async () => {\n    if (!isExport) {\n      const res = await fetchViaHTTP(appPort, '/%2Fgoogle.com', undefined, {\n        redirect: 'manual',\n      })\n      expect(res.status).toBe(404)\n      expect(await res.text()).toContain(notFoundContent)\n    }\n\n    const browser = await webdriver(appPort, '/%2Fgoogle.com')\n    await didNotReload(browser)\n    expect(await browser.eval('window.location.pathname')).toBe(\n      '/%2Fgoogle.com'\n    )\n    expect(await browser.eval('document.documentElement.innerHTML')).toContain(\n      notFoundContent\n    )\n  })","file":"integration/repeated-slashes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle double slashes correctly with encoded and query","suites":[],"updatePoint":{"line":191,"column":67},"line":191,"code":"  it('should handle double slashes correctly with encoded and query', async () => {\n    if (!isExport) {\n      const res = await fetchViaHTTP(\n        appPort,\n        '/%2Fgoogle.com',\n        { hello: '1' },\n        {\n          redirect: 'manual',\n        }\n      )\n      expect(res.status).toBe(404)\n      expect(await res.text()).toContain(notFoundContent)\n    }\n\n    const browser = await webdriver(appPort, '/%2Fgoogle.com?hello=1')\n    await didNotReload(browser)\n    expect(await browser.eval('window.location.pathname')).toBe(\n      '/%2Fgoogle.com'\n    )\n    expect(await browser.eval('window.location.search')).toBe('?hello=1')\n    expect(await browser.eval('document.documentElement.innerHTML')).toContain(\n      notFoundContent\n    )\n  })","file":"integration/repeated-slashes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle double slashes correctly with encoded and hash","suites":[],"updatePoint":{"line":216,"column":66},"line":216,"code":"  it('should handle double slashes correctly with encoded and hash', async () => {\n    if (!isExport) {\n      const res = await fetchViaHTTP(appPort, '/%2Fgoogle.com', undefined, {\n        redirect: 'manual',\n      })\n      expect(res.status).toBe(404)\n      expect(await res.text()).toContain(notFoundContent)\n    }\n\n    const browser = await webdriver(appPort, '/%2Fgoogle.com#hello')\n    await didNotReload(browser)\n    expect(await browser.eval('window.location.pathname')).toBe(\n      '/%2Fgoogle.com'\n    )\n    expect(await browser.eval('window.location.hash')).toBe('#hello')\n    expect(await browser.eval('document.documentElement.innerHTML')).toContain(\n      notFoundContent\n    )\n  })","file":"integration/repeated-slashes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle backslashes correctly","suites":[],"updatePoint":{"line":236,"column":41},"line":236,"code":"  it('should handle backslashes correctly', async () => {\n    if (!isExport) {\n      const res = await fetchViaHTTP(appPort, '/\\\\google.com', undefined, {\n        redirect: 'manual',\n      })\n      expect(res.status).toBe(308)\n      const parsedUrl = url.parse(res.headers.get('location'), true)\n      expect(parsedUrl.pathname).toBe('/google.com')\n      expect(parsedUrl.hostname).toBe('localhost')\n      expect(parsedUrl.query).toEqual({})\n      expect(await res.text()).toBe('/google.com')\n    }\n\n    const browser = await webdriver(appPort, '/\\\\google.com')\n    await didNotReload(browser)\n    expect(await browser.eval('window.location.pathname')).toBe(\n      isExport ? '//google.com' : '/google.com'\n    )\n    expect(await browser.eval('window.location.hash')).toBe('')\n    expect(await browser.eval('window.location.search')).toBe('')\n    expect(await browser.eval('document.documentElement.innerHTML')).toContain(\n      notFoundContent\n    )\n  })","file":"integration/repeated-slashes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle mixed backslashes/forward slashes correctly","suites":[],"updatePoint":{"line":261,"column":63},"line":261,"code":"  it('should handle mixed backslashes/forward slashes correctly', async () => {\n    if (!isExport) {\n      const res = await fetchViaHTTP(appPort, '/\\\\/google.com', undefined, {\n        redirect: 'manual',\n      })\n      expect(res.status).toBe(308)\n      const parsedUrl = url.parse(res.headers.get('location'), true)\n      expect(parsedUrl.pathname).toBe(isExport ? '//google.com' : '/google.com')\n      expect(parsedUrl.hostname).toBe('localhost')\n      expect(parsedUrl.query).toEqual({})\n      expect(await res.text()).toBe('/google.com')\n    }\n\n    const browser = await webdriver(appPort, '/\\\\/google.com#hello')\n    await didNotReload(browser)\n    expect(await browser.eval('window.location.pathname')).toBe(\n      isExport ? '///google.com' : '/google.com'\n    )\n    expect(await browser.eval('window.location.hash')).toBe('#hello')\n    expect(await browser.eval('window.location.search')).toBe('')\n    expect(await browser.eval('document.documentElement.innerHTML')).toContain(\n      notFoundContent\n    )\n  })","file":"integration/repeated-slashes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle slashes in next/link correctly","suites":[],"updatePoint":{"line":286,"column":50},"line":286,"code":"  it('should handle slashes in next/link correctly', async () => {\n    const browser = await webdriver(\n      appPort,\n      `/invalid${isExport ? '.html' : ''}`\n    )\n    const invalidHrefs = [\n      '//google.com',\n      '//google.com?hello=1',\n      '//google.com#hello',\n      '\\\\/\\\\/google.com',\n      '\\\\/\\\\/google.com?hello=1',\n      '\\\\/\\\\/google.com#hello',\n    ]\n\n    for (const href of invalidHrefs) {\n      await check(\n        () =>\n          browser.eval(\n            'window.caughtErrors.map(err => typeof err !== \"string\" ? err.message : err).join(\", \")'\n          ),\n        new RegExp(escapeRegex(`Invalid href passed to next/router: ${href}`))\n      )\n    }\n  })","file":"integration/repeated-slashes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle slashes in router push correctly","suites":[],"updatePoint":{"line":311,"column":52},"line":311,"code":"  it('should handle slashes in router push correctly', async () => {\n    for (const item of [\n      {\n        page: '/another',\n        href: '/another',\n        as: '//google.com',\n        pathname: '/google.com',\n      },\n      {\n        page: isPages404 ? '/404' : '/_error',\n        href: '//google.com',\n        pathname: '/google.com',\n      },\n      {\n        page: isPages404 ? '/404' : '/_error',\n        href: '//google.com?hello=1',\n        pathname: '/google.com',\n        search: '?hello=1',\n      },\n      {\n        page: isPages404 ? '/404' : '/_error',\n        href: '//google.com#hello',\n        pathname: '/google.com',\n        hash: '#hello',\n      },\n    ]) {\n      const browser = await webdriver(appPort, '/')\n      await browser.eval(\n        `window.next.router.push(\"${item.href}\"${\n          item.as ? `, \"${item.as}\"` : ''\n        })`\n      )\n      expect(await browser.eval('window.location.pathname')).toBe(item.pathname)\n      expect(await browser.eval('window.location.search')).toBe(\n        item.search || ''\n      )\n      expect(await browser.eval('window.location.hash')).toBe(item.hash || '')\n      expect(await browser.eval('window.next.router.pathname')).toBe(item.page)\n    }\n  })","file":"integration/repeated-slashes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have no error from encoded slashes in router push","suites":[],"updatePoint":{"line":352,"column":62},"line":352,"code":"  it('should have no error from encoded slashes in router push', async () => {\n    for (const item of [\n      {\n        page: '/another',\n        href: '/another',\n        as: '/%2Fgoogle.com',\n        shouldHardNav: false,\n      },\n      {\n        page: isPages404 ? '/404' : '/_error',\n        href: '/%2Fgoogle.com',\n      },\n      {\n        page: isPages404 ? '/404' : '/_error',\n        href: '/%2F%2Fgoogle.com?hello=1',\n        pathname: '/%2F%2Fgoogle.com',\n        search: '?hello=1',\n      },\n      {\n        page: isPages404 ? '/404' : '/_error',\n        href: '/%5C%5C%2Fgoogle.com#hello',\n        pathname: '/%5C%5C%2Fgoogle.com',\n        hash: '#hello',\n      },\n    ]) {\n      const browser = await webdriver(appPort, '/')\n      await browser.eval(`(function() {\n        window.beforeNav = 1\n        window.next.router.push(\"${item.href}\"${\n        item.as ? `, \"${item.as}\"` : ''\n      })\n      })()`)\n\n      await check(\n        () => browser.eval('window.location.pathname'),\n        item.pathname || item.as || item.href\n      )\n\n      expect(await browser.eval('window.location.search')).toBe(\n        item.search || ''\n      )\n      expect(await browser.eval('window.location.hash')).toBe(item.hash || '')\n      expect(await browser.eval('window.next.router.pathname')).toBe(item.page)\n      expect(await browser.eval('window.next.router.asPath')).toBe(\n        item.as || item.href\n      )\n      if (item.shouldHardNav !== false) {\n        expect(await browser.eval('window.beforeNav')).toBeFalsy()\n      } else {\n        expect(await browser.eval('window.beforeNav')).toBe(1)\n      }\n    }\n  })","file":"integration/repeated-slashes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should output required-server-files manifest correctly","suites":["Required Server Files"],"updatePoint":{"line":80,"column":60},"line":80,"code":"  it('should output required-server-files manifest correctly', async () => {\n    expect(requiredFilesManifest.version).toBe(1)\n    expect(Array.isArray(requiredFilesManifest.files)).toBe(true)\n    expect(Array.isArray(requiredFilesManifest.ignore)).toBe(true)\n    expect(requiredFilesManifest.files.length).toBeGreaterThan(0)\n    expect(requiredFilesManifest.ignore.length).toBeGreaterThan(0)\n    expect(typeof requiredFilesManifest.config.configFile).toBe('undefined')\n    expect(typeof requiredFilesManifest.config.trailingSlash).toBe('boolean')\n    expect(typeof requiredFilesManifest.appDir).toBe('string')\n\n    for (const file of requiredFilesManifest.files) {\n      console.log('checking', file)\n      expect(await fs.exists(join(appDir, file))).toBe(true)\n    }\n\n    expect(await fs.exists(join(appDir, '.next/server'))).toBe(true)\n  })","file":"integration/required-server-files-ssr-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render SSR page correctly","suites":["Required Server Files"],"updatePoint":{"line":98,"column":38},"line":98,"code":"  it('should render SSR page correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#index').text()).toBe('index page')\n    expect(data.hello).toBe('world')\n\n    const html2 = await renderViaHTTP(appPort, '/')\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#index').text()).toBe('index page')\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n  })","file":"integration/required-server-files-ssr-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render dynamic SSR page correctly","suites":["Required Server Files"],"updatePoint":{"line":115,"column":46},"line":115,"code":"  it('should render dynamic SSR page correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/dynamic/first')\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#dynamic').text()).toBe('dynamic page')\n    expect($('#slug').text()).toBe('first')\n    expect(data.hello).toBe('world')\n\n    const html2 = await renderViaHTTP(appPort, '/dynamic/second')\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#dynamic').text()).toBe('dynamic page')\n    expect($2('#slug').text()).toBe('second')\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n  })","file":"integration/required-server-files-ssr-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render fallback page correctly","suites":["Required Server Files"],"updatePoint":{"line":134,"column":43},"line":134,"code":"  it('should render fallback page correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/fallback/first')\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#fallback').text()).toBe('fallback page')\n    expect($('#slug').text()).toBe('first')\n    expect(data.hello).toBe('world')\n\n    await waitFor(2000)\n    const html2 = await renderViaHTTP(appPort, '/fallback/first')\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#fallback').text()).toBe('fallback page')\n    expect($2('#slug').text()).toBe('first')\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n\n    const html3 = await renderViaHTTP(appPort, '/fallback/second')\n    const $3 = cheerio.load(html3)\n    const data3 = JSON.parse($3('#props').text())\n\n    expect($3('#fallback').text()).toBe('fallback page')\n    expect($3('#slug').text()).toBe('second')\n    expect(isNaN(data3.random)).toBe(false)\n\n    const { pageProps: data4 } = JSON.parse(\n      await renderViaHTTP(appPort, `/_next/data/${buildId}/fallback/third.json`)\n    )\n    expect(data4.hello).toBe('world')\n    expect(data4.slug).toBe('third')\n  })","file":"integration/required-server-files-ssr-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render SSR page correctly with x-matched-path","suites":["Required Server Files"],"updatePoint":{"line":168,"column":58},"line":168,"code":"  it('should render SSR page correctly with x-matched-path', async () => {\n    const html = await renderViaHTTP(appPort, '/some-other-path', undefined, {\n      headers: {\n        'x-matched-path': '/',\n      },\n    })\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#index').text()).toBe('index page')\n    expect(data.hello).toBe('world')\n\n    const html2 = await renderViaHTTP(appPort, '/some-other-path', undefined, {\n      headers: {\n        'x-matched-path': '/',\n      },\n    })\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#index').text()).toBe('index page')\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n  })","file":"integration/required-server-files-ssr-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render dynamic SSR page correctly with x-matched-path","suites":["Required Server Files"],"updatePoint":{"line":193,"column":66},"line":193,"code":"  it('should render dynamic SSR page correctly with x-matched-path', async () => {\n    const html = await renderViaHTTP(\n      appPort,\n      '/some-other-path?slug=first',\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/dynamic/[slug]',\n        },\n      }\n    )\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#dynamic').text()).toBe('dynamic page')\n    expect($('#slug').text()).toBe('first')\n    expect(data.hello).toBe('world')\n\n    const html2 = await renderViaHTTP(\n      appPort,\n      '/some-other-path?slug=second',\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/dynamic/[slug]',\n        },\n      }\n    )\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#dynamic').text()).toBe('dynamic page')\n    expect($2('#slug').text()).toBe('second')\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n  })","file":"integration/required-server-files-ssr-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render fallback page correctly with x-matched-path and routes-matches","suites":["Required Server Files"],"updatePoint":{"line":230,"column":82},"line":230,"code":"  it('should render fallback page correctly with x-matched-path and routes-matches', async () => {\n    const html = await renderViaHTTP(appPort, '/fallback/first', undefined, {\n      headers: {\n        'x-matched-path': '/fallback/first',\n        'x-now-route-matches': '1=first',\n      },\n    })\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#fallback').text()).toBe('fallback page')\n    expect($('#slug').text()).toBe('first')\n    expect(data.hello).toBe('world')\n\n    const html2 = await renderViaHTTP(appPort, `/fallback/[slug]`, undefined, {\n      headers: {\n        'x-matched-path': '/fallback/[slug]',\n        'x-now-route-matches': '1=second',\n      },\n    })\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#fallback').text()).toBe('fallback page')\n    expect($2('#slug').text()).toBe('second')\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n  })","file":"integration/required-server-files-ssr-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return data correctly with x-matched-path","suites":["Required Server Files"],"updatePoint":{"line":259,"column":54},"line":259,"code":"  it('should return data correctly with x-matched-path', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${buildId}/dynamic/first.json?slug=first`,\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/dynamic/[slug]',\n        },\n      }\n    )\n\n    const { pageProps: data } = await res.json()\n\n    expect(data.slug).toBe('first')\n    expect(data.hello).toBe('world')\n\n    const res2 = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${buildId}/fallback/[slug].json`,\n      undefined,\n      {\n        headers: {\n          'x-matched-path': `/_next/data/${buildId}/fallback/[slug].json`,\n          'x-now-route-matches': '1=second',\n        },\n      }\n    )\n\n    const { pageProps: data2 } = await res2.json()\n\n    expect(data2.slug).toBe('second')\n    expect(data2.hello).toBe('world')\n  })","file":"integration/required-server-files-ssr-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render fallback optional catch-all route correctly with x-matched-path and routes-matches","suites":["Required Server Files"],"updatePoint":{"line":294,"column":102},"line":294,"code":"  it('should render fallback optional catch-all route correctly with x-matched-path and routes-matches', async () => {\n    const html = await renderViaHTTP(\n      appPort,\n      '/catch-all/[[...rest]]',\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/catch-all/[[...rest]]',\n          'x-now-route-matches': '',\n        },\n      }\n    )\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#catch-all').text()).toBe('optional catch-all page')\n    expect(data.params).toEqual({})\n    expect(data.hello).toBe('world')\n\n    const html2 = await renderViaHTTP(\n      appPort,\n      '/catch-all/[[...rest]]',\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/catch-all/[[...rest]]',\n          'x-now-route-matches': '1=hello&catchAll=hello',\n        },\n      }\n    )\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#catch-all').text()).toBe('optional catch-all page')\n    expect(data2.params).toEqual({ rest: ['hello'] })\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n\n    const html3 = await renderViaHTTP(\n      appPort,\n      '/catch-all/[[..rest]]',\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/catch-all/[[...rest]]',\n          'x-now-route-matches': '1=hello/world&catchAll=hello/world',\n        },\n      }\n    )\n    const $3 = cheerio.load(html3)\n    const data3 = JSON.parse($3('#props').text())\n\n    expect($3('#catch-all').text()).toBe('optional catch-all page')\n    expect(data3.params).toEqual({ rest: ['hello', 'world'] })\n    expect(isNaN(data3.random)).toBe(false)\n    expect(data3.random).not.toBe(data.random)\n  })","file":"integration/required-server-files-ssr-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should return data correctly with x-matched-path for optional catch-all route","suites":["Required Server Files"],"updatePoint":{"line":352,"column":83},"line":352,"code":"  it('should return data correctly with x-matched-path for optional catch-all route', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${buildId}/catch-all.json`,\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/catch-all/[[...rest]]',\n        },\n      }\n    )\n\n    const { pageProps: data } = await res.json()\n\n    expect(data.params).toEqual({})\n    expect(data.hello).toBe('world')\n\n    const res2 = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${buildId}/catch-all/[[...rest]].json`,\n      undefined,\n      {\n        headers: {\n          'x-matched-path': `/_next/data/${buildId}/catch-all/[[...rest]].json`,\n          'x-now-route-matches': '1=hello&rest=hello',\n        },\n      }\n    )\n\n    const { pageProps: data2 } = await res2.json()\n\n    expect(data2.params).toEqual({ rest: ['hello'] })\n    expect(data2.hello).toBe('world')\n\n    const res3 = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${buildId}/catch-all/[[...rest]].json`,\n      undefined,\n      {\n        headers: {\n          'x-matched-path': `/_next/data/${buildId}/catch-all/[[...rest]].json`,\n          'x-now-route-matches': '1=hello/world&rest=hello/world',\n        },\n      }\n    )\n\n    const { pageProps: data3 } = await res3.json()\n\n    expect(data3.params).toEqual({ rest: ['hello', 'world'] })\n    expect(data3.hello).toBe('world')\n  })","file":"integration/required-server-files-ssr-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not apply trailingSlash redirect","suites":["Required Server Files"],"updatePoint":{"line":404,"column":45},"line":404,"code":"  it('should not apply trailingSlash redirect', async () => {\n    for (const path of [\n      '/',\n      '/dynamic/another/',\n      '/dynamic/another',\n      '/fallback/first/',\n      '/fallback/first',\n      '/fallback/another/',\n      '/fallback/another',\n    ]) {\n      const res = await fetchViaHTTP(appPort, path, undefined, {\n        redirect: 'manual',\n      })\n\n      expect(res.status).toBe(200)\n    }\n  })","file":"integration/required-server-files-ssr-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should normalize catch-all rewrite query values correctly","suites":["Required Server Files"],"updatePoint":{"line":422,"column":63},"line":422,"code":"  it('should normalize catch-all rewrite query values correctly', async () => {\n    const html = await renderViaHTTP(\n      appPort,\n      '/some-catch-all/hello/world',\n      {\n        path: 'hello/world',\n      },\n      {\n        headers: {\n          'x-matched-path': '/',\n        },\n      }\n    )\n    const $ = cheerio.load(html)\n    expect(JSON.parse($('#router').text()).query).toEqual({\n      path: ['hello', 'world'],\n    })\n  })","file":"integration/required-server-files-ssr-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should bubble error correctly for gip page","suites":["Required Server Files"],"updatePoint":{"line":441,"column":48},"line":441,"code":"  it('should bubble error correctly for gip page', async () => {\n    errors = []\n    const res = await fetchViaHTTP(appPort, '/errors/gip', { crash: '1' })\n    expect(res.status).toBe(500)\n    expect(await res.text()).toBe('error')\n    expect(errors.length).toBe(1)\n    expect(errors[0].message).toContain('gip hit an oops')\n  })","file":"integration/required-server-files-ssr-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should bubble error correctly for gssp page","suites":["Required Server Files"],"updatePoint":{"line":450,"column":49},"line":450,"code":"  it('should bubble error correctly for gssp page', async () => {\n    errors = []\n    const res = await fetchViaHTTP(appPort, '/errors/gssp', { crash: '1' })\n    expect(res.status).toBe(500)\n    expect(await res.text()).toBe('error')\n    expect(errors.length).toBe(1)\n    expect(errors[0].message).toContain('gssp hit an oops')\n  })","file":"integration/required-server-files-ssr-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should bubble error correctly for gsp page","suites":["Required Server Files"],"updatePoint":{"line":459,"column":48},"line":459,"code":"  it('should bubble error correctly for gsp page', async () => {\n    errors = []\n    const res = await fetchViaHTTP(appPort, '/errors/gsp/crash')\n    expect(res.status).toBe(500)\n    expect(await res.text()).toBe('error')\n    expect(errors.length).toBe(1)\n    expect(errors[0].message).toContain('gsp hit an oops')\n  })","file":"integration/required-server-files-ssr-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should normalize optional values correctly for SSP page","suites":["Required Server Files"],"updatePoint":{"line":468,"column":61},"line":468,"code":"  it('should normalize optional values correctly for SSP page', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/optional-ssp',\n      { rest: '', another: 'value' },\n      {\n        headers: {\n          'x-matched-path': '/optional-ssp/[[...rest]]',\n        },\n      }\n    )\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n    const props = JSON.parse($('#props').text())\n    expect(props.params).toEqual({})\n    expect(props.query).toEqual({ another: 'value' })\n  })","file":"integration/required-server-files-ssr-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should normalize optional values correctly for SSG page","suites":["Required Server Files"],"updatePoint":{"line":487,"column":61},"line":487,"code":"  it('should normalize optional values correctly for SSG page', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/optional-ssg',\n      { rest: '', another: 'value' },\n      {\n        headers: {\n          'x-matched-path': '/optional-ssg/[[...rest]]',\n        },\n      }\n    )\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n    const props = JSON.parse($('#props').text())\n    expect(props.params).toEqual({})\n  })","file":"integration/required-server-files-ssr-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should normalize optional values correctly for API page","suites":["Required Server Files"],"updatePoint":{"line":505,"column":61},"line":505,"code":"  it('should normalize optional values correctly for API page', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/api/optional',\n      { rest: '', another: 'value' },\n      {\n        headers: {\n          'x-matched-path': '/api/optional/[[...rest]]',\n        },\n      }\n    )\n\n    const json = await res.json()\n    expect(json.query).toEqual({ another: 'value' })\n    expect(json.url).toBe('/api/optional?another=value')\n  })","file":"integration/required-server-files-ssr-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match the index page correctly","suites":["Required Server Files"],"updatePoint":{"line":522,"column":43},"line":522,"code":"  it('should match the index page correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/', undefined, {\n      headers: {\n        'x-matched-path': '/index',\n      },\n      redirect: 'manual',\n    })\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n    expect($('#index').text()).toBe('index page')\n  })","file":"integration/required-server-files-ssr-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should match the root dynamic page correctly","suites":["Required Server Files"],"updatePoint":{"line":535,"column":50},"line":535,"code":"  it('should match the root dynamic page correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/slug-1', undefined, {\n      headers: {\n        'x-matched-path': '/[slug]',\n      },\n      redirect: 'manual',\n    })\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n    expect($('#slug-page').text()).toBe('[slug] page')\n  })","file":"integration/required-server-files-ssr-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle 404s properly","suites":["Required Server Files"],"updatePoint":{"line":548,"column":33},"line":548,"code":"  it('should handle 404s properly', async () => {\n    for (const pathname of [\n      '/_next/static/chunks/pages/index-abc123.js',\n      '/_next/static/some-file.js',\n      '/static/some-file.js',\n      '/non-existent',\n      '/404',\n    ]) {\n      const res = await fetchViaHTTP(appPort, pathname, undefined, {\n        headers: {\n          'x-matched-path': '/404',\n          redirect: 'manual',\n        },\n      })\n      expect(res.status).toBe(404)\n      expect(await res.text()).toContain('custom 404')\n    }\n  })","file":"integration/required-server-files-ssr-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render with correct asPath with /index requested","suites":[],"updatePoint":{"line":34,"column":63},"line":34,"code":"    it('should render with correct asPath with /index requested', async () => {\n      await checkAsPath('/index', '/')\n    })","file":"integration/revalidate-as-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render with correct asPath with /_next/data /index requested","suites":[],"updatePoint":{"line":39,"column":73},"line":39,"code":"  it('should render with correct asPath with /_next/data /index requested', async () => {\n    stdout = ''\n    const path = `/_next/data/${buildId}/index.json`\n    await renderViaHTTP(appPort, path)\n    await waitFor(1000)\n    const data = await renderViaHTTP(appPort, path)\n\n    expect(JSON.parse(data).pageProps).toEqual({\n      hello: 'world',\n    })\n\n    await check(() => stdout, /asPath/)\n    const asPath = stdout.split('asPath: ').pop().split('\\n').shift()\n    expect(asPath).toBe('/')\n  })","file":"integration/revalidate-as-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render with correct asPath with / requested","suites":[],"updatePoint":{"line":55,"column":56},"line":55,"code":"  it('should render with correct asPath with / requested', async () => {\n    await checkAsPath('/', '/')\n  })","file":"integration/revalidate-as-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render with correct asPath with /another/index requested","suites":[],"updatePoint":{"line":59,"column":69},"line":59,"code":"  it('should render with correct asPath with /another/index requested', async () => {\n    await checkAsPath('/another/index', '/another/index')\n  })","file":"integration/revalidate-as-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render with correct asPath with /_next/data /another/index requested","suites":[],"updatePoint":{"line":63,"column":81},"line":63,"code":"  it('should render with correct asPath with /_next/data /another/index requested', async () => {\n    stdout = ''\n    const path = `/_next/data/${buildId}/another/index.json`\n    await renderViaHTTP(appPort, path)\n    await waitFor(1000)\n    const data = await renderViaHTTP(appPort, path)\n\n    expect(JSON.parse(data).pageProps).toEqual({\n      hello: 'world',\n    })\n\n    await check(() => stdout, /asPath/)\n    const asPath = stdout.split('asPath: ').pop().split('\\n').shift()\n    expect(asPath).toBe('/another/index')\n  })","file":"integration/revalidate-as-path/test/index.test.js","skipped":false,"dir":"test"},{"name":"back-button should go back to rewritten path successfully","suites":[],"updatePoint":{"line":19,"column":63},"line":19,"code":"  it('back-button should go back to rewritten path successfully', async () => {\n    const browser = await webdriver(appPort, '/rewrite-me/path')\n\n    expect(await browser.elementByCss('#another').text()).toBe('another page')\n\n    await browser.eval('window.beforeNav = 1')\n\n    await browser\n      .elementByCss('#to-index')\n      .click()\n      .waitForElementByCss('#index')\n\n    await browser.back().waitForElementByCss('#another')\n\n    expect(await browser.waitForElementByCss('#another').text()).toBe(\n      'another page'\n    )\n\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n  })","file":"integration/rewrite-with-browser-history/test/index.test.js","skipped":false,"dir":"test"},{"name":"should break rewrites chain when dynamic route matches","suites":[],"updatePoint":{"line":18,"column":60},"line":18,"code":"  it('should break rewrites chain when dynamic route matches', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.elementByCss('#product-link').click()\n    await browser.waitForElementByCss('#product')\n\n    expect(await browser.elementByCss('#product').text()).toBe('product: first')\n  })","file":"integration/rewrites-client-resolving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should break rewrites chain when normal page matches","suites":[],"updatePoint":{"line":26,"column":58},"line":26,"code":"  it('should break rewrites chain when normal page matches', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.elementByCss('#products-link').click()\n    await browser.waitForElementByCss('#products')\n\n    expect(await browser.elementByCss('#products').text()).toBe('products')\n  })","file":"integration/rewrites-client-resolving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should break rewrites chain when dynamic catch-all route matches","suites":[],"updatePoint":{"line":34,"column":70},"line":34,"code":"  it('should break rewrites chain when dynamic catch-all route matches', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.elementByCss('#category-link').click()\n    await browser.waitForElementByCss('#category')\n\n    expect(await browser.elementByCss('#category').text()).toBe(\n      'category: first'\n    )\n  })","file":"integration/rewrites-client-resolving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should break rewrites chain when dynamic catch-all route multi-level matches","suites":[],"updatePoint":{"line":44,"column":82},"line":44,"code":"  it('should break rewrites chain when dynamic catch-all route multi-level matches', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.elementByCss('#category-link-again').click()\n    await browser.waitForElementByCss('#category')\n\n    expect(await browser.elementByCss('#category').text()).toBe(\n      'category: hello/world'\n    )\n  })","file":"integration/rewrites-client-resolving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should break rewrites chain after matching /category","suites":[],"updatePoint":{"line":54,"column":58},"line":54,"code":"  it('should break rewrites chain after matching /category', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.elementByCss('#categories-link').click()\n    await browser.waitForElementByCss('#categories')\n\n    expect(await browser.elementByCss('#categories').text()).toBe('categories')\n  })","file":"integration/rewrites-client-resolving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should contain all values passed in param as array","suites":[],"updatePoint":{"line":19,"column":56},"line":19,"code":"  it('should contain all values passed in param as array', async () => {\n    const browser = await webdriver(appPort, '/some-page')\n    expect(await browser.elementByCss('#items').text()).toBe('1,2')\n  })","file":"integration/rewrites-destination-query-array/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate to a simple rewrite without error","suites":[],"updatePoint":{"line":19,"column":55},"line":19,"code":"  it('should navigate to a simple rewrite without error', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.eval('window.beforeNav = 1')\n\n    await browser\n      .elementByCss('#to-simple')\n      .click()\n      .waitForElementByCss('#another')\n    expect(await browser.elementByCss('#pathname').text()).toBe('/another')\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({})\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n  })","file":"integration/rewrites-has-condition/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate to a has rewrite without error","suites":[],"updatePoint":{"line":32,"column":52},"line":32,"code":"  it('should navigate to a has rewrite without error', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.eval('window.beforeNav = 1')\n\n    await browser\n      .elementByCss('#to-has-rewrite')\n      .click()\n      .waitForElementByCss('#another')\n    expect(await browser.elementByCss('#pathname').text()).toBe('/another')\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      hasQuery: 'true',\n    })\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n  })","file":"integration/rewrites-has-condition/test/index.test.js","skipped":false,"dir":"test"},{"name":"should allow manual href/as on index page","suites":[],"updatePoint":{"line":20,"column":47},"line":20,"code":"  it('should allow manual href/as on index page', async () => {\n    const browser = await webdriver(appPort, '/')\n\n    expect(await browser.elementByCss('#index').text()).toBe('index page')\n    expect(await browser.hasElementByCssSelector('#modal')).toBeFalsy()\n    await browser.eval('window.beforeNav = 1')\n\n    await browser.elementByCss('#to-modal').click()\n\n    expect(await browser.elementByCss('#index').text()).toBe('index page')\n    expect(await browser.hasElementByCssSelector('#modal')).toBeTruthy()\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      imageId: '123',\n    })\n\n    await browser\n      .elementByCss('#to-preview')\n      .click()\n      .waitForElementByCss('#preview')\n\n    expect(await browser.elementByCss('#preview').text()).toBe('preview page')\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      slug: '123',\n    })\n\n    await browser.back()\n\n    await browser\n      .elementByCss('#to-another')\n      .click()\n      .waitForElementByCss('#another')\n\n    expect(await browser.elementByCss('#another').text()).toBe('another page')\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({})\n\n    await browser.back()\n\n    await browser.elementByCss('#to-rewrite-me').click()\n\n    expect(await browser.elementByCss('#another').text()).toBe('another page')\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({})\n\n    await browser.back()\n\n    await browser\n      .elementByCss('#to-index-as-rewrite')\n      .click()\n      .waitForElementByCss('#index')\n\n    expect(await browser.elementByCss('#index').text()).toBe('index page')\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({})\n  })","file":"integration/rewrites-manual-href-as/test/index.test.js","skipped":false,"dir":"test"},{"name":"should allow manual href/as on dynamic page","suites":[],"updatePoint":{"line":78,"column":49},"line":78,"code":"  it('should allow manual href/as on dynamic page', async () => {\n    const browser = await webdriver(appPort, '/preview/123')\n\n    expect(await browser.elementByCss('#preview').text()).toBe('preview page')\n    await browser.eval('window.beforeNav = 1')\n\n    await browser\n      .elementByCss('#to-modal')\n      .click()\n      .waitForElementByCss('#index')\n\n    expect(await browser.elementByCss('#index').text()).toBe('index page')\n    expect(await browser.hasElementByCssSelector('#modal')).toBeTruthy()\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      imageId: '123',\n    })\n\n    await browser\n      .elementByCss('#to-preview')\n      .click()\n      .waitForElementByCss('#preview')\n\n    expect(await browser.elementByCss('#preview').text()).toBe('preview page')\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      slug: '123',\n    })\n\n    await browser.elementByCss('#to-preview').click()\n\n    expect(await browser.elementByCss('#preview').text()).toBe('preview page')\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n    await check(\n      async () =>\n        JSON.parse(\n          await browser.eval('document.querySelector(\"#query\").innerHTML')\n        ).slug,\n      '321'\n    )\n\n    await browser\n      .elementByCss('#to-another')\n      .click()\n      .waitForElementByCss('#another')\n\n    expect(await browser.elementByCss('#another').text()).toBe('another page')\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({})\n\n    await browser.back().waitForElementByCss('#preview')\n    await browser.elementByCss('#to-rewrite-me').click()\n\n    expect(await browser.elementByCss('#another').text()).toBe('another page')\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({})\n\n    await browser.back().waitForElementByCss('#preview')\n\n    await browser\n      .elementByCss('#to-preview-as-rewrite')\n      .click()\n      .waitForElementByCss('#preview')\n\n    expect(await browser.elementByCss('#preview').text()).toBe('preview page')\n    expect(await browser.eval('window.beforeNav')).toBe(1)\n    expect(JSON.parse(await browser.elementByCss('#query').text())).toEqual({\n      slug: '321',\n    })\n  })","file":"integration/rewrites-manual-href-as/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render / correctly","suites":[],"updatePoint":{"line":28,"column":31},"line":28,"code":"  it('should render / correctly', async () => {\n    const props = await getProps('/')\n    expect(props.params).toEqual({})\n\n    await waitFor(1000)\n    await getProps('/')\n\n    const newProps = await getProps('/')\n    expect(newProps.params).toEqual({})\n    expect(props.random).not.toBe(newProps.random)\n  })","file":"integration/root-optional-revalidate/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render /index correctly","suites":[],"updatePoint":{"line":41,"column":38},"line":41,"code":"    it('should render /index correctly', async () => {\n      const props = await getProps('/index')\n      expect(props.params).toEqual({})\n\n      await waitFor(1000)\n      await getProps('/index')\n\n      const newProps = await getProps('/index')\n      expect(newProps.params).toEqual({})\n      expect(props.random).not.toBe(newProps.random)\n    })","file":"integration/root-optional-revalidate/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render /a correctly","suites":[],"updatePoint":{"line":54,"column":32},"line":54,"code":"  it('should render /a correctly', async () => {\n    const props = await getProps('/a')\n    expect(props.params).toEqual({ slug: ['a'] })\n\n    await waitFor(1000)\n    await getProps('/a')\n\n    const newProps = await getProps('/a')\n    expect(newProps.params).toEqual({ slug: ['a'] })\n    expect(props.random).not.toBe(newProps.random)\n  })","file":"integration/root-optional-revalidate/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render /hello/world correctly","suites":[],"updatePoint":{"line":66,"column":42},"line":66,"code":"  it('should render /hello/world correctly', async () => {\n    const props = await getProps('/hello/world')\n    expect(props.params).toEqual({ slug: ['hello', 'world'] })\n\n    await waitFor(1000)\n    await getProps('/hello/world')\n\n    const newProps = await getProps('/hello/world')\n    expect(newProps.params).toEqual({ slug: ['hello', 'world'] })\n    expect(props.random).not.toBe(newProps.random)\n  })","file":"integration/root-optional-revalidate/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle / correctly","suites":[],"updatePoint":{"line":18,"column":31},"line":18,"code":"  it('should handle / correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/')\n    expect(res.status).toBe(404)\n    expect(await res.text()).toContain('page could not be found')\n  })","file":"integration/route-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle /index correctly","suites":[],"updatePoint":{"line":24,"column":36},"line":24,"code":"  it('should handle /index correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/index')\n    expect(res.status).toBe(200)\n    expect(await res.text()).toContain('hello from index')\n  })","file":"integration/route-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle /index/index correctly","suites":[],"updatePoint":{"line":30,"column":42},"line":30,"code":"  it('should handle /index/index correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/index/index')\n    expect(res.status).toBe(404)\n    expect(await res.text()).toContain('page could not be found')\n  })","file":"integration/route-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle /index/?bar%60%3C%25%22%27%7B%24%2A%25%5C correctly","suites":[],"updatePoint":{"line":36,"column":71},"line":36,"code":"  it('should handle /index/?bar%60%3C%25%22%27%7B%24%2A%25%5C correctly', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/index/?bar%60%3C%25%22%27%7B%24%2A%25%5C'\n    )\n    expect(res.status).toBe(200)\n  })","file":"integration/route-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle /index?file%3A%5C correctly","suites":[],"updatePoint":{"line":44,"column":47},"line":44,"code":"  it('should handle /index?file%3A%5C correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/index?file%3A%5C')\n    expect(res.status).toBe(200)\n  })","file":"integration/route-index/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle / correctly","suites":[],"updatePoint":{"line":18,"column":31},"line":18,"code":"  it('should handle / correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/')\n    expect(res.status).toBe(200)\n    expect(await res.text()).toContain('hello from index')\n  })","file":"integration/route-indexes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle /index correctly","suites":[],"updatePoint":{"line":24,"column":36},"line":24,"code":"  it('should handle /index correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/index')\n    expect(res.status).toBe(404)\n    expect(await res.text()).toContain('page could not be found')\n  })","file":"integration/route-indexes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle /index/index correctly","suites":[],"updatePoint":{"line":30,"column":42},"line":30,"code":"  it('should handle /index/index correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/index/index')\n    expect(res.status).toBe(404)\n    expect(await res.text()).toContain('page could not be found')\n  })","file":"integration/route-indexes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle /nested-index correctly","suites":[],"updatePoint":{"line":36,"column":43},"line":36,"code":"  it('should handle /nested-index correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/nested-index')\n    expect(res.status).toBe(404)\n    expect(await res.text()).toContain('page could not be found')\n  })","file":"integration/route-indexes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle /nested-index/index correctly","suites":[],"updatePoint":{"line":42,"column":49},"line":42,"code":"  it('should handle /nested-index/index correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/nested-index/index')\n    expect(res.status).toBe(200)\n    expect(await res.text()).toContain('hello from nested index')\n  })","file":"integration/route-indexes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle /nested-index/index/index correctly","suites":[],"updatePoint":{"line":48,"column":55},"line":48,"code":"  it('should handle /nested-index/index/index correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/nested-index/index/index')\n    expect(res.status).toBe(404)\n    expect(await res.text()).toContain('page could not be found')\n  })","file":"integration/route-indexes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle /sub correctly","suites":[],"updatePoint":{"line":54,"column":34},"line":54,"code":"  it('should handle /sub correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/sub')\n    expect(res.status).toBe(200)\n    expect(await res.text()).toContain('hello from sub index')\n  })","file":"integration/route-indexes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle /sub/index correctly","suites":[],"updatePoint":{"line":60,"column":40},"line":60,"code":"  it('should handle /sub/index correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/sub/index')\n    expect(res.status).toBe(200)\n    expect(await res.text()).toContain('hello from sub id')\n  })","file":"integration/route-indexes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle /sub/index/index correctly","suites":[],"updatePoint":{"line":66,"column":46},"line":66,"code":"  it('should handle /sub/index/index correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/sub/index/index')\n    expect(res.status).toBe(404)\n    expect(await res.text()).toContain('page could not be found')\n  })","file":"integration/route-indexes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle /sub/another correctly","suites":[],"updatePoint":{"line":72,"column":42},"line":72,"code":"  it('should handle /sub/another correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/sub/another')\n    expect(res.status).toBe(200)\n    expect(await res.text()).toContain('hello from sub id')\n  })","file":"integration/route-indexes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle /sub/another/index correctly","suites":[],"updatePoint":{"line":78,"column":48},"line":78,"code":"  it('should handle /sub/another/index correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/sub/another/index')\n    expect(res.status).toBe(404)\n    expect(await res.text()).toContain('page could not be found')\n  })","file":"integration/route-indexes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle /api/sub correctly","suites":[],"updatePoint":{"line":84,"column":38},"line":84,"code":"  it('should handle /api/sub correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/sub')\n    expect(res.status).toBe(200)\n    expect(await res.text()).toContain('hi from sub index')\n  })","file":"integration/route-indexes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle /api/sub/index correctly","suites":[],"updatePoint":{"line":90,"column":44},"line":90,"code":"  it('should handle /api/sub/index correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/sub/index')\n    expect(res.status).toBe(200)\n    expect(await res.text()).toContain('hi from sub id')\n  })","file":"integration/route-indexes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle /api/sub/index/index correctly","suites":[],"updatePoint":{"line":96,"column":50},"line":96,"code":"  it('should handle /api/sub/index/index correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/sub/index/index')\n    expect(res.status).toBe(404)\n    expect(await res.text()).toContain('page could not be found')\n  })","file":"integration/route-indexes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle /api/sub/another correctly","suites":[],"updatePoint":{"line":102,"column":46},"line":102,"code":"  it('should handle /api/sub/another correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/sub/another')\n    expect(res.status).toBe(200)\n    expect(await res.text()).toContain('hi from sub id')\n  })","file":"integration/route-indexes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should handle /api/sub/another/index correctly","suites":[],"updatePoint":{"line":108,"column":52},"line":108,"code":"  it('should handle /api/sub/another/index correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/sub/another/index')\n    expect(res.status).toBe(404)\n    expect(await res.text()).toContain('page could not be found')\n  })","file":"integration/route-indexes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should cancel slow page loads on re-navigation","suites":[],"updatePoint":{"line":19,"column":52},"line":19,"code":"  it('should cancel slow page loads on re-navigation', async () => {\n    const browser = await webdriver(appPort, '/')\n\n    await browser.elementByCss('#link-1').click()\n    await waitFor(3000)\n    expect(await browser.hasElementByCssSelector('#page-text')).toBeFalsy()\n\n    await browser.elementByCss('#link-2').click()\n    await waitFor(3000)\n\n    const text2 = await browser.elementByCss('#page-text').text()\n    expect(text2).toMatch(/2/)\n    expect(await browser.eval('window.routeCancelled')).toBe('yes')\n  })","file":"integration/route-load-cancel-css/test/index.test.js","skipped":false,"dir":"test"},{"name":"should cancel slow page loads on re-navigation","suites":[],"updatePoint":{"line":22,"column":52},"line":22,"code":"  it('should cancel slow page loads on re-navigation', async () => {\n    const browser = await webdriver(appPort, '/')\n    await waitFor(5000)\n\n    await browser.elementByCss('#link-1').click()\n    await waitFor(1000)\n    await browser.elementByCss('#link-2').click()\n    await waitFor(1000)\n\n    const text = await browser.elementByCss('#page-text').text()\n    expect(text).toMatch(/2/)\n    expect(await browser.eval('window.routeCancelled')).toBe('yes')\n  })","file":"integration/route-load-cancel/test/index.test.js","skipped":false,"dir":"test"},{"name":"scrolls to top when href=\"/\" and url already contains a hash","suites":[],"updatePoint":{"line":18,"column":66},"line":18,"code":"  it('scrolls to top when href=\"/\" and url already contains a hash', async () => {\n    const browser = await webdriver(appPort, '/#section')\n    expect(await browser.eval(() => window.scrollY)).not.toBe(0)\n    await browser.elementByCss('#top-link').click()\n    expect(await browser.eval(() => window.scrollY)).toBe(0)\n    await browser.close()\n  })","file":"integration/router-hash-navigation/test/index.test.js","skipped":false,"dir":"test"},{"name":"isReady should be true immediately for pages without getStaticProps","suites":[],"updatePoint":{"line":30,"column":73},"line":30,"code":"  it('isReady should be true immediately for pages without getStaticProps', async () => {\n    const browser = await webdriver(appPort, '/appGip')\n    await checkIsReadyValues(browser, [true])\n  })","file":"integration/router-is-ready-app-gip/test/index.test.js","skipped":false,"dir":"test"},{"name":"isReady should be true immediately for pages without getStaticProps, with query","suites":[],"updatePoint":{"line":35,"column":85},"line":35,"code":"  it('isReady should be true immediately for pages without getStaticProps, with query', async () => {\n    const browser = await webdriver(appPort, '/appGip?hello=world')\n    await checkIsReadyValues(browser, [true])\n  })","file":"integration/router-is-ready-app-gip/test/index.test.js","skipped":false,"dir":"test"},{"name":"isReady should be true immediately for getStaticProps page without query","suites":[],"updatePoint":{"line":40,"column":78},"line":40,"code":"  it('isReady should be true immediately for getStaticProps page without query', async () => {\n    const browser = await webdriver(appPort, '/gsp')\n    await checkIsReadyValues(browser, [true])\n  })","file":"integration/router-is-ready-app-gip/test/index.test.js","skipped":false,"dir":"test"},{"name":"isReady should be true after query update for getStaticProps page with query","suites":[],"updatePoint":{"line":45,"column":82},"line":45,"code":"  it('isReady should be true after query update for getStaticProps page with query', async () => {\n    const browser = await webdriver(appPort, '/gsp?hello=world')\n    await checkIsReadyValues(browser, [false, true])\n  })","file":"integration/router-is-ready-app-gip/test/index.test.js","skipped":false,"dir":"test"},{"name":"isReady should be true immediately for getInitialProps page","suites":[],"updatePoint":{"line":30,"column":65},"line":30,"code":"  it('isReady should be true immediately for getInitialProps page', async () => {\n    const browser = await webdriver(appPort, '/gip')\n    await checkIsReadyValues(browser, [true])\n  })","file":"integration/router-is-ready/test/index.test.js","skipped":false,"dir":"test"},{"name":"isReady should be true immediately for getInitialProps page with query","suites":[],"updatePoint":{"line":35,"column":76},"line":35,"code":"  it('isReady should be true immediately for getInitialProps page with query', async () => {\n    const browser = await webdriver(appPort, '/gip?hello=world')\n    await checkIsReadyValues(browser, [true])\n  })","file":"integration/router-is-ready/test/index.test.js","skipped":false,"dir":"test"},{"name":"isReady should be true immediately for getServerSideProps page","suites":[],"updatePoint":{"line":40,"column":68},"line":40,"code":"  it('isReady should be true immediately for getServerSideProps page', async () => {\n    const browser = await webdriver(appPort, '/gssp')\n    await checkIsReadyValues(browser, [true])\n  })","file":"integration/router-is-ready/test/index.test.js","skipped":false,"dir":"test"},{"name":"isReady should be true immediately for getServerSideProps page with query","suites":[],"updatePoint":{"line":45,"column":79},"line":45,"code":"  it('isReady should be true immediately for getServerSideProps page with query', async () => {\n    const browser = await webdriver(appPort, '/gssp?hello=world')\n    await checkIsReadyValues(browser, [true])\n  })","file":"integration/router-is-ready/test/index.test.js","skipped":false,"dir":"test"},{"name":"isReady should be true immediately for auto-export page without query","suites":[],"updatePoint":{"line":50,"column":75},"line":50,"code":"  it('isReady should be true immediately for auto-export page without query', async () => {\n    const browser = await webdriver(appPort, '/auto-export')\n    await checkIsReadyValues(browser, [true])\n  })","file":"integration/router-is-ready/test/index.test.js","skipped":false,"dir":"test"},{"name":"isReady should be true after query update for auto-export page with query","suites":[],"updatePoint":{"line":55,"column":79},"line":55,"code":"  it('isReady should be true after query update for auto-export page with query', async () => {\n    const browser = await webdriver(appPort, '/auto-export?hello=world')\n    await checkIsReadyValues(browser, [false, true])\n  })","file":"integration/router-is-ready/test/index.test.js","skipped":false,"dir":"test"},{"name":"isReady should be true after query update for dynamic auto-export page without query","suites":[],"updatePoint":{"line":60,"column":90},"line":60,"code":"  it('isReady should be true after query update for dynamic auto-export page without query', async () => {\n    const browser = await webdriver(appPort, '/auto-export/first')\n    await checkIsReadyValues(browser, [false, true])\n  })","file":"integration/router-is-ready/test/index.test.js","skipped":false,"dir":"test"},{"name":"isReady should be true after query update for dynamic auto-export page with query","suites":[],"updatePoint":{"line":65,"column":87},"line":65,"code":"  it('isReady should be true after query update for dynamic auto-export page with query', async () => {\n    const browser = await webdriver(appPort, '/auto-export/first?hello=true')\n    await checkIsReadyValues(browser, [false, true])\n  })","file":"integration/router-is-ready/test/index.test.js","skipped":false,"dir":"test"},{"name":"isReady should be true after query update for getStaticProps page with query","suites":[],"updatePoint":{"line":70,"column":82},"line":70,"code":"  it('isReady should be true after query update for getStaticProps page with query', async () => {\n    const browser = await webdriver(appPort, '/gsp?hello=world')\n    await checkIsReadyValues(browser, [false, true])\n  })","file":"integration/router-is-ready/test/index.test.js","skipped":false,"dir":"test"},{"name":"isReady should be true immediately for getStaticProps page without query","suites":[],"updatePoint":{"line":75,"column":78},"line":75,"code":"  it('isReady should be true immediately for getStaticProps page without query', async () => {\n    const browser = await webdriver(appPort, '/gsp')\n    await checkIsReadyValues(browser, [true])\n  })","file":"integration/router-is-ready/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not prefetch","suites":["Router prefetch","dev mode"],"updatePoint":{"line":36,"column":27},"line":36,"code":"    it('should not prefetch', async () => {\n      const browser = await webdriver(appPort, '/')\n      const links = await browser\n        .elementByCss('#prefetch-button')\n        .click()\n        .elementsByCss('link[rel=prefetch]')\n\n      expect(links.length).toBe(0)\n      await browser.close()\n    })","file":"integration/router-prefetch/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve prefetch promise","suites":["Router prefetch","dev mode"],"updatePoint":{"line":47,"column":39},"line":47,"code":"    it('should resolve prefetch promise', async () => {\n      await didResolveAfterPrefetch()\n    })","file":"integration/router-prefetch/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve prefetch promise with invalid href","suites":["Router prefetch","production mode"],"updatePoint":{"line":60,"column":57},"line":60,"code":"    it('should resolve prefetch promise with invalid href', async () => {\n      await didResolveAfterPrefetch()\n    })","file":"integration/router-prefetch/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not trigger unncessary rerenders when middleware is used","suites":["with middleware"],"updatePoint":{"line":20,"column":71},"line":20,"code":"    it('should not trigger unncessary rerenders when middleware is used', async () => {\n      const browser = await webdriver(appPort, '/')\n      await new Promise((resolve) => setTimeout(resolve, 100))\n\n      expect(await browser.eval('window.__renders')).toEqual([undefined])\n    })","file":"integration/router-rerender/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not trigger unncessary rerenders when rewrites are used","suites":["with rewrites"],"line":30,"code":"    it.skip('should not trigger unncessary rerenders when rewrites are used', async () => {})","file":"integration/router-rerender/test/index.test.js","skipped":true,"dir":"test"},{"name":"should rerender with the correct query parameter if present with rewrites","suites":["with rewrites"],"line":31,"code":"    it.skip('should rerender with the correct query parameter if present with rewrites', async () => {})","file":"integration/router-rerender/test/index.test.js","skipped":true,"dir":"test"},{"name":"priority afterInteractive","suites":[],"updatePoint":{"line":26,"column":31},"line":26,"code":"  it('priority afterInteractive', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await waitFor(1000)\n\n      async function test(id) {\n        const script = await browser.elementById(id)\n        const dataAttr = await script.getAttribute('data-nscript')\n        const endScripts = await browser.elementsByCss(\n          `#__NEXT_DATA__ ~ #${id}`\n        )\n\n        // Renders script tag\n        expect(script).toBeDefined()\n        expect(dataAttr).toBeDefined()\n\n        // Script is inserted at the end\n        expect(endScripts.length).toBe(1)\n      }\n\n      // afterInteractive script in page\n      await test('scriptAfterInteractive')\n      // afterInteractive script in _document\n      await test('documentAfterInteractive')\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/script-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"scriptAfterInteractive","suites":[],"updatePoint":{"line":48,"column":40},"line":48,"code":"      await test('scriptAfterInteractive')","file":"integration/script-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"documentAfterInteractive","suites":[],"updatePoint":{"line":50,"column":42},"line":50,"code":"      await test('documentAfterInteractive')","file":"integration/script-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"priority lazyOnload","suites":[],"updatePoint":{"line":56,"column":25},"line":56,"code":"  it('priority lazyOnload', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/page3')\n\n      await browser.waitForElementByCss('#onload-div')\n      await waitFor(1000)\n\n      const logs = await browser.log('browser')\n      const filteredLogs = logs.filter(\n        (log) =>\n          !log.message.includes('Failed to load resource') &&\n          !log.message === 'error' &&\n          !log.message === 'Event'\n      )\n      expect(filteredLogs.length).toBe(0)\n\n      async function test(id) {\n        const script = await browser.elementById(id)\n        const dataAttr = await script.getAttribute('data-nscript')\n        const endScripts = await browser.elementsByCss(\n          `#__NEXT_DATA__ ~ #${id}`\n        )\n\n        // Renders script tag\n        expect(script).toBeDefined()\n        expect(dataAttr).toBeDefined()\n\n        // Script is inserted at the end\n        expect(endScripts.length).toBe(1)\n      }\n\n      // lazyOnload script in page\n      await test('scriptLazyOnload')\n      // lazyOnload script in _document\n      await test('documentLazyOnload')\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/script-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"scriptLazyOnload","suites":[],"updatePoint":{"line":89,"column":34},"line":89,"code":"      await test('scriptLazyOnload')","file":"integration/script-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"documentLazyOnload","suites":[],"updatePoint":{"line":91,"column":36},"line":91,"code":"      await test('documentLazyOnload')","file":"integration/script-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"priority beforeInteractive","suites":[],"updatePoint":{"line":98,"column":34},"line":98,"code":"    it('priority beforeInteractive', async () => {\n      const html = await renderViaHTTP(appPort, '/page1')\n      const $ = cheerio.load(html)\n\n      function test(id) {\n        const script = $(`#${id}`)\n\n        // Renders script tag\n        expect(script.length).toBe(1)\n        expect(script.attr('data-nscript')).toBeDefined()\n\n        // Script is inserted before NextScripts\n        expect(\n          $(`#${id} ~ script[src^=\"/_next/static/chunks/main\"]`).length\n        ).toBeGreaterThan(0)\n      }\n\n      test('scriptBeforeInteractive')\n    })","file":"integration/script-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"scriptBeforeInteractive","suites":[],"updatePoint":{"line":115,"column":35},"line":115,"code":"      test('scriptBeforeInteractive')","file":"integration/script-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"priority beforeInteractive - older version","suites":[],"updatePoint":{"line":119,"column":50},"line":119,"code":"    it('priority beforeInteractive - older version', async () => {\n      const html = await renderViaHTTP(appPort, '/page6')\n      const $ = cheerio.load(html)\n\n      function test(id) {\n        const script = $(`#${id}`)\n\n        // Renders script tag\n        expect(script.length).toBe(1)\n        expect(script.attr('data-nscript')).toBeDefined()\n\n        // Script is inserted before NextScripts\n        expect(\n          $(`#${id} ~ script[src^=\"/_next/static/chunks/main\"]`).length\n        ).toBeGreaterThan(0)\n      }\n\n      test('scriptBeforePageRenderOld')\n    })","file":"integration/script-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"scriptBeforePageRenderOld","suites":[],"updatePoint":{"line":136,"column":37},"line":136,"code":"      test('scriptBeforePageRenderOld')","file":"integration/script-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"priority beforeInteractive on navigate","suites":[],"updatePoint":{"line":139,"column":46},"line":139,"code":"    it('priority beforeInteractive on navigate', async () => {\n      let browser\n      try {\n        browser = await webdriver(appPort, '/')\n\n        // beforeInteractive scripts should load once\n        let documentBIScripts = await browser.elementsByCss(\n          '[src$=\"scriptBeforeInteractive\"]'\n        )\n        expect(documentBIScripts.length).toBe(2)\n\n        await browser.waitForElementByCss('[href=\"/page1\"]')\n        await browser.click('[href=\"/page1\"]')\n\n        await browser.waitForElementByCss('.container')\n\n        // Ensure beforeInteractive script isn't duplicated on navigation\n        documentBIScripts = await browser.elementsByCss(\n          '[src$=\"scriptBeforeInteractive\"]'\n        )\n        expect(documentBIScripts.length).toBe(2)\n      } finally {\n        if (browser) await browser.close()\n      }\n    })","file":"integration/script-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"onload fires correctly","suites":[],"updatePoint":{"line":167,"column":30},"line":167,"code":"    it('onload fires correctly', async () => {\n      let browser\n      try {\n        browser = await webdriver(appPort, '/page4')\n        await waitFor(3000)\n\n        const text = await browser.elementById('text').text()\n\n        expect(text).toBe('aaabbbccc')\n      } finally {\n        if (browser) await browser.close()\n      }\n    })","file":"integration/script-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"priority beforeInteractive with inline script","suites":[],"updatePoint":{"line":181,"column":53},"line":181,"code":"    it('priority beforeInteractive with inline script', async () => {\n      const html = await renderViaHTTP(appPort, '/page5')\n      const $ = cheerio.load(html)\n\n      const script = $('#inline-before')\n      expect(script.length).toBe(1)\n\n      // Script is inserted before CSS\n      expect(\n        $(`#inline-before ~ link[href^=\"/_next/static/css\"]`).length\n      ).toBeGreaterThan(0)\n    })","file":"integration/script-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"priority beforeInteractive with inline script should execute","suites":[],"updatePoint":{"line":194,"column":68},"line":194,"code":"    it('priority beforeInteractive with inline script should execute', async () => {\n      let browser\n      try {\n        browser = await webdriver(appPort, '/page7')\n        await waitFor(1000)\n\n        const logs = await browser.log()\n        expect(\n          logs.some((log) =>\n            log.message.includes('beforeInteractive inline script run')\n          )\n        ).toBe(true)\n      } finally {\n        if (browser) await browser.close()\n      }\n    })","file":"integration/script-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"Does not duplicate inline scripts","suites":[],"updatePoint":{"line":212,"column":39},"line":212,"code":"  it('Does not duplicate inline scripts', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n\n      // Navigate away and back to page\n      await browser.waitForElementByCss('[href=\"/page5\"]')\n      await browser.click('[href=\"/page5\"]')\n      await browser.waitForElementByCss('[href=\"/\"]')\n      await browser.click('[href=\"/\"]')\n      await browser.waitForElementByCss('[href=\"/page5\"]')\n      await browser.click('[href=\"/page5\"]')\n\n      await browser.waitForElementByCss('.container')\n      await waitFor(1000)\n\n      const text = await browser.elementById('text').text()\n\n      expect(text).toBe('abc')\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/script-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"Error message is shown if Partytown is not installed locally","suites":[],"updatePoint":{"line":236,"column":66},"line":236,"code":"  it('Error message is shown if Partytown is not installed locally', async () => {\n    const { stdout, stderr } = await nextBuild(appWithPartytownMissingDir, [], {\n      stdout: true,\n      stderr: true,\n    })\n    const output = stdout + stderr\n\n    expect(output.replace(/\\n|\\r/g, '')).toMatch(\n      /It looks like you're trying to use Partytown with next\\/script but do not have the required package\\(s\\) installed.Please install Partytown by running:.*?(npm|pnpm|yarn) (install|add) (--save-dev|--dev) @builder.io\\/partytownIf you are not trying to use Partytown, please disable the experimental \"nextScriptWorkers\" flag in next.config.js./\n    )\n  })","file":"integration/script-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"onReady fires after load event and then on every subsequent re-mount","suites":[],"updatePoint":{"line":248,"column":74},"line":248,"code":"  it('onReady fires after load event and then on every subsequent re-mount', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/page8')\n\n      const text = await browser.elementById('text').text()\n\n      expect(text).toBe('aaa')\n\n      // Navigate to different page and back\n      await browser.waitForElementByCss('[href=\"/page9\"]')\n      await browser.click('[href=\"/page9\"]')\n      await browser.waitForElementByCss('[href=\"/page8\"]')\n      await browser.click('[href=\"/page8\"]')\n\n      await browser.waitForElementByCss('.container')\n      const sameText = await browser.elementById('text').text()\n\n      expect(sameText).toBe('aaa') // onReady should fire again\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/script-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"onReady should only fires once after loaded (issue #39993)","suites":[],"updatePoint":{"line":273,"column":64},"line":273,"code":"  it('onReady should only fires once after loaded (issue #39993)', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/page10')\n\n      // wait for remote script to be loaded\n      await waitFor(1000)\n      expect(await browser.eval(`window.remoteScriptsOnReadyCalls`)).toBe(1)\n      expect(await browser.eval(`window.inlineScriptsOnReadyCalls`)).toBe(1)\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/script-loader/test/index.test.js","skipped":false,"dir":"test"},{"name":"should restore the scroll position on navigating back","suites":[],"updatePoint":{"line":19,"column":59},"line":19,"code":"  it('should restore the scroll position on navigating back', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.eval(() =>\n      document.querySelector('#to-another').scrollIntoView()\n    )\n    const scrollRestoration = await browser.eval(\n      () => window.history.scrollRestoration\n    )\n\n    expect(scrollRestoration).toBe('manual')\n\n    const scrollX = Math.floor(await browser.eval(() => window.scrollX))\n    const scrollY = Math.floor(await browser.eval(() => window.scrollY))\n\n    expect(scrollX).not.toBe(0)\n    expect(scrollY).not.toBe(0)\n\n    await browser.eval(() => window.next.router.push('/another'))\n\n    await check(\n      () => browser.eval(() => document.documentElement.innerHTML),\n      /hi from another/\n    )\n    await browser.eval(() => (window.didHydrate = false))\n\n    await browser.eval(() => window.history.back())\n    await check(() => browser.eval(() => window.didHydrate), {\n      test(content) {\n        return content\n      },\n    })\n\n    const newScrollX = Math.floor(await browser.eval(() => window.scrollX))\n    const newScrollY = Math.floor(await browser.eval(() => window.scrollY))\n\n    console.log({\n      scrollX,\n      scrollY,\n      newScrollX,\n      newScrollY,\n    })\n\n    expect(scrollX).toBe(newScrollX)\n    expect(scrollY).toBe(newScrollY)\n  })","file":"integration/scroll-back-restoration/test/index.test.js","skipped":false,"dir":"test"},{"name":"should restore the scroll position on navigating forward","suites":[],"updatePoint":{"line":19,"column":62},"line":19,"code":"  it('should restore the scroll position on navigating forward', async () => {\n    const browser = await webdriver(appPort, '/another')\n    await browser.elementByCss('#to-index').click()\n\n    await check(\n      () => browser.eval(() => document.documentElement.innerHTML),\n      /the end/\n    )\n\n    await browser.eval(() =>\n      document.querySelector('#to-another').scrollIntoView()\n    )\n    const scrollRestoration = await browser.eval(\n      () => window.history.scrollRestoration\n    )\n\n    expect(scrollRestoration).toBe('manual')\n\n    const scrollX = Math.floor(await browser.eval(() => window.scrollX))\n    const scrollY = Math.floor(await browser.eval(() => window.scrollY))\n\n    expect(scrollX).not.toBe(0)\n    expect(scrollY).not.toBe(0)\n\n    await browser.eval(() => window.history.back())\n\n    await check(\n      () => browser.eval(() => document.documentElement.innerHTML),\n      /hi from another/\n    )\n\n    await browser.eval(() => (window.didHydrate = false))\n    await browser.eval(() => window.history.forward())\n\n    await check(() => browser.eval(() => window.didHydrate), {\n      test(content) {\n        return content\n      },\n    })\n\n    const newScrollX = Math.floor(await browser.eval(() => window.scrollX))\n    const newScrollY = Math.floor(await browser.eval(() => window.scrollY))\n\n    console.log({\n      scrollX,\n      scrollY,\n      newScrollX,\n      newScrollY,\n    })\n\n    expect(scrollX).toBe(newScrollX)\n    expect(scrollY).toBe(newScrollY)\n  })","file":"integration/scroll-forward-restoration/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["Basic SCSS Module Support"],"updatePoint":{"line":39,"column":39},"line":39,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["Basic SCSS Module Support"],"updatePoint":{"line":44,"column":41},"line":44,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\".index_redText__WduQk{color:red}\"`\n    )\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've injected the CSS on server render","suites":["Basic SCSS Module Support"],"updatePoint":{"line":58,"column":49},"line":58,"code":"  it(`should've injected the CSS on server render`, async () => {\n    const content = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(content)\n\n    const cssPreload = $('link[rel=\"preload\"][as=\"style\"]')\n    expect(cssPreload.length).toBe(1)\n    expect(cssPreload.attr('href')).toMatch(/^\\/_next\\/static\\/css\\/.*\\.css$/)\n\n    const cssSheet = $('link[rel=\"stylesheet\"]')\n    expect(cssSheet.length).toBe(1)\n    expect(cssSheet.attr('href')).toMatch(/^\\/_next\\/static\\/css\\/.*\\.css$/)\n\n    expect($('#verify-red').attr('class')).toMatchInlineSnapshot(\n      `\"index_redText__WduQk\"`\n    )\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["3rd Party CSS Module Support"],"updatePoint":{"line":95,"column":39},"line":95,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["3rd Party CSS Module Support"],"updatePoint":{"line":100,"column":41},"line":100,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\".index_foo__gL0ty{position:relative}.index_foo__gL0ty .bar,.index_foo__gL0ty .baz{height:100%;overflow:hidden}.index_foo__gL0ty .lol,.index_foo__gL0ty>.lel{width:80%}\"`\n    )\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've injected the CSS on server render","suites":["3rd Party CSS Module Support"],"updatePoint":{"line":114,"column":49},"line":114,"code":"  it(`should've injected the CSS on server render`, async () => {\n    const content = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(content)\n\n    const cssPreload = $('link[rel=\"preload\"][as=\"style\"]')\n    expect(cssPreload.length).toBe(1)\n    expect(cssPreload.attr('href')).toMatch(/^\\/_next\\/static\\/css\\/.*\\.css$/)\n\n    const cssSheet = $('link[rel=\"stylesheet\"]')\n    expect(cssSheet.length).toBe(1)\n    expect(cssSheet.attr('href')).toMatch(/^\\/_next\\/static\\/css\\/.*\\.css$/)\n\n    expect($('#verify-div').attr('class')).toMatchInlineSnapshot(\n      `\"index_foo__gL0ty\"`\n    )\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have CSS for page","suites":["Has CSS Module in computed styles in Development"],"updatePoint":{"line":146,"column":30},"line":146,"code":"  it('should have CSS for page', async () => {\n    const browser = await webdriver(appPort, '/')\n\n    const currentColor = await browser.eval(\n      `window.getComputedStyle(document.querySelector('#verify-red')).color`\n    )\n    expect(currentColor).toMatchInlineSnapshot(`\"rgb(255, 0, 0)\"`)\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["Has CSS Module in computed styles in Production"],"updatePoint":{"line":175,"column":39},"line":175,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have CSS for page","suites":["Has CSS Module in computed styles in Production"],"updatePoint":{"line":180,"column":30},"line":180,"code":"  it('should have CSS for page', async () => {\n    const browser = await webdriver(appPort, '/')\n\n    const currentColor = await browser.eval(\n      `window.getComputedStyle(document.querySelector('#verify-red')).color`\n    )\n    expect(currentColor).toMatchInlineSnapshot(`\"rgb(255, 0, 0)\"`)\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should update CSS color without remounting <input>","suites":["Can hot reload CSS Module without losing state"],"updatePoint":{"line":204,"column":56},"line":204,"code":"  it('should update CSS color without remounting <input>', async () => {\n    const browser = await webdriver(appPort, '/')\n\n    const desiredText = 'hello world'\n    await browser.elementById('text-input').type(desiredText)\n    expect(await browser.elementById('text-input').getValue()).toBe(desiredText)\n\n    const currentColor = await browser.eval(\n      `window.getComputedStyle(document.querySelector('#verify-red')).color`\n    )\n    expect(currentColor).toMatchInlineSnapshot(`\"rgb(255, 0, 0)\"`)\n\n    const cssFile = new File(join(appDir, 'pages/index.module.scss'))\n    try {\n      cssFile.replace('$var: red', '$var: purple')\n      await waitFor(2000) // wait for HMR\n\n      const refreshedColor = await browser.eval(\n        `window.getComputedStyle(document.querySelector('#verify-red')).color`\n      )\n      expect(refreshedColor).toMatchInlineSnapshot(`\"rgb(128, 0, 128)\"`)\n\n      // ensure text remained\n      expect(await browser.elementById('text-input').getValue()).toBe(\n        desiredText\n      )\n    } finally {\n      cssFile.restore()\n    }\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail to build","suites":["Invalid CSS Module Usage in node_modules"],"updatePoint":{"line":243,"column":26},"line":243,"code":"  it('should fail to build', async () => {\n    const { code, stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n    })\n    expect(code).not.toBe(0)\n    expect(stderr).toContain('Failed to compile')\n    expect(stderr).toContain('node_modules/example/index.module.scss')\n    expect(stderr).toMatch(\n      /CSS Modules.*cannot.*be imported from within.*node_modules/\n    )\n    expect(stderr).toMatch(/Location:.*node_modules[\\\\/]example[\\\\/]index\\.mjs/)\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail to build","suites":["Invalid CSS Global Module Usage in node_modules"],"updatePoint":{"line":264,"column":26},"line":264,"code":"  it('should fail to build', async () => {\n    const { code, stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n    })\n    expect(code).not.toBe(0)\n    expect(stderr).toContain('Failed to compile')\n    expect(stderr).toContain('node_modules/example/index.scss')\n    expect(stderr).toMatch(\n      /Global CSS.*cannot.*be imported from within.*node_modules/\n    )\n    expect(stderr).toMatch(/Location:.*node_modules[\\\\/]example[\\\\/]index\\.mjs/)\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["Valid CSS Module Usage from within node_modules"],"updatePoint":{"line":301,"column":39},"line":301,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've prerendered with relevant data","suites":["Valid CSS Module Usage from within node_modules"],"updatePoint":{"line":306,"column":46},"line":306,"code":"  it(`should've prerendered with relevant data`, async () => {\n    const content = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(content)\n\n    const cssPreload = $('#nm-div')\n    expect(cssPreload.text()).toMatchInlineSnapshot(\n      `\"{\\\\\"message\\\\\":\\\\\"Why hello there\\\\\"} {\\\\\"redText\\\\\":\\\\\"example_redText__8_1ap\\\\\"}\"`\n    )\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["Valid CSS Module Usage from within node_modules"],"updatePoint":{"line":316,"column":41},"line":316,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\".example_redText__8_1ap{color:red}\"`\n    )\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["Valid Nested CSS Module Usage from within node_modules"],"updatePoint":{"line":354,"column":39},"line":354,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've prerendered with relevant data","suites":["Valid Nested CSS Module Usage from within node_modules"],"updatePoint":{"line":359,"column":46},"line":359,"code":"  it(`should've prerendered with relevant data`, async () => {\n    const content = await renderViaHTTP(appPort, '/')\n    const $ = cheerio.load(content)\n\n    const cssPreload = $('#nm-div')\n    expect(cssPreload.text()).toMatchInlineSnapshot(\n      `\"{\\\\\"message\\\\\":\\\\\"Why hello there\\\\\"} {\\\\\"other2\\\\\":\\\\\"example_other2__pD1TP\\\\\",\\\\\"subClass\\\\\":\\\\\"example_subClass___Qywg other_className__jR2X2\\\\\"}\"`\n    )\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["Valid Nested CSS Module Usage from within node_modules"],"updatePoint":{"line":369,"column":41},"line":369,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\".other_other3__QRKUk{color:violet}.other_className__jR2X2{background:red;color:#ff0}.example_other2__pD1TP{color:red}.example_subClass___Qywg{background:blue}\"`\n    )\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["CSS Module Composes Usage (Basic)"],"updatePoint":{"line":397,"column":39},"line":397,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["CSS Module Composes Usage (Basic)"],"updatePoint":{"line":402,"column":41},"line":402,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\".index_className__phGSl{background:red;color:#ff0}.index_subClass__fPp6w{background:blue}\"`\n    )\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["CSS Module Composes Usage (External)"],"updatePoint":{"line":430,"column":39},"line":430,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["CSS Module Composes Usage (External)"],"updatePoint":{"line":435,"column":41},"line":435,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\".other_className__e_JDW{background:red;color:#ff0}.index_subClass__fPp6w{background:blue}\"`\n    )\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["Dynamic Route CSS Module Usage"],"updatePoint":{"line":468,"column":39},"line":468,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["Dynamic Route CSS Module Usage"],"updatePoint":{"line":473,"column":41},"line":473,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\"._post__home__a9vTy{background:red}\"`\n    )\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply styles correctly","suites":["Dynamic Route CSS Module Usage"],"updatePoint":{"line":487,"column":35},"line":487,"code":"  it('should apply styles correctly', async () => {\n    const browser = await webdriver(appPort, '/post-1')\n\n    const background = await browser\n      .elementByCss('#my-div')\n      .getComputedCss('background-color')\n\n    expect(background).toMatch(/rgb(a|)\\(255, 0, 0/)\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["Catch-all Route CSS Module Usage"],"updatePoint":{"line":516,"column":39},"line":516,"code":"  it('should have compiled successfully', () => {\n    expect(code).toBe(0)\n    expect(stdout).toMatch(/Compiled successfully/)\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should apply styles correctly","suites":["Catch-all Route CSS Module Usage"],"updatePoint":{"line":521,"column":35},"line":521,"code":"  it('should apply styles correctly', async () => {\n    const browser = await webdriver(appPort, '/post-1')\n\n    const background = await browser\n      .elementByCss('#my-div')\n      .getComputedCss('background-color')\n\n    expect(background).toMatch(/rgb(a|)\\(255, 0, 0/)\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["Catch-all Route CSS Module Usage"],"updatePoint":{"line":531,"column":41},"line":531,"code":"  it(`should've emitted a single CSS file`, async () => {\n    const cssFolder = join(appDir, '.next/static/css')\n\n    const files = await readdir(cssFolder)\n    const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n    expect(cssFiles.length).toBe(1)\n    const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n    expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatchInlineSnapshot(\n      `\".___post__home__w1yuY{background:red}\"`\n    )\n  })","file":"integration/scss-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should be a friendly error successfully","suites":["SCSS Support","Friendly Webpack Error"],"updatePoint":{"line":32,"column":47},"line":32,"code":"    it('should be a friendly error successfully', async () => {\n      const { code, stderr } = await nextBuild(appDir, [], {\n        env: { NODE_OPTIONS: shellQuote([`--require`, mockFile]) },\n        stderr: true,\n      })\n      let cleanScssErrMsg =\n        '\\n\\n' +\n        './styles/global.scss\\n' +\n        \"To use Next.js' built-in Sass support, you first need to install `sass`.\\n\" +\n        'Run `npm i sass` or `yarn add sass` inside your workspace.\\n' +\n        '\\n' +\n        'Learn more: https://nextjs.org/docs/messages/install-sass\\n'\n\n      expect(code).toBe(1)\n      expect(stderr).toContain('Failed to compile.')\n      expect(stderr).toContain(cleanScssErrMsg)\n      expect(stderr).not.toContain('css-loader')\n      expect(stderr).not.toContain('sass-loader')\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["SCSS Support","Basic Global Support"],"updatePoint":{"line":60,"column":35},"line":60,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["SCSS Support","Basic Global Support"],"updatePoint":{"line":68,"column":43},"line":68,"code":"    it(`should've emitted a single CSS file`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      expect(await readFile(join(cssFolder, cssFiles[0]), 'utf8')).toContain(\n        'color:red'\n      )\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["SCSS Support","Basic Module Include Paths Support"],"updatePoint":{"line":88,"column":35},"line":88,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["SCSS Support","Basic Module Include Paths Support"],"updatePoint":{"line":96,"column":43},"line":96,"code":"    it(`should've emitted a single CSS file`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      expect(await readFile(join(cssFolder, cssFiles[0]), 'utf8')).toContain(\n        'color:red'\n      )\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["SCSS Support","Basic Module Prepend Data Support"],"updatePoint":{"line":116,"column":35},"line":116,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["SCSS Support","Basic Module Prepend Data Support"],"updatePoint":{"line":124,"column":43},"line":124,"code":"    it(`should've emitted a single CSS file`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      expect(await readFile(join(cssFolder, cssFiles[0]), 'utf8')).toContain(\n        'color:red'\n      )\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["SCSS Support","Basic Global Support with src/ dir"],"updatePoint":{"line":144,"column":35},"line":144,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["SCSS Support","Basic Global Support with src/ dir"],"updatePoint":{"line":152,"column":43},"line":152,"code":"    it(`should've emitted a single CSS file`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      expect(await readFile(join(cssFolder, cssFiles[0]), 'utf8')).toContain(\n        'color:red'\n      )\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["SCSS Support","Multi Global Support"],"updatePoint":{"line":172,"column":35},"line":172,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["SCSS Support","Multi Global Support"],"updatePoint":{"line":180,"column":43},"line":180,"code":"    it(`should've emitted a single CSS file`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(\n        cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()\n      ).toMatchInlineSnapshot(`\".red-text{color:red}.blue-text{color:blue}\"`)\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["SCSS Support","Nested @import() Global Support"],"updatePoint":{"line":201,"column":35},"line":201,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["SCSS Support","Nested @import() Global Support"],"updatePoint":{"line":209,"column":43},"line":209,"code":"    it(`should've emitted a single CSS file`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(\n        cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()\n      ).toMatchInlineSnapshot(\n        `\".red-text{color:purple;font-weight:bolder;color:red}.blue-text{color:orange;font-weight:bolder;color:blue}\"`\n      )\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["SCSS Support","CSS Compilation and Prefixing"],"updatePoint":{"line":232,"column":35},"line":232,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've compiled and prefixed","suites":["SCSS Support","CSS Compilation and Prefixing"],"updatePoint":{"line":240,"column":39},"line":240,"code":"    it(`should've compiled and prefixed`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(\n        cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()\n      ).toMatchInlineSnapshot(\n        `\".redText ::-moz-placeholder{color:red}.redText :-ms-input-placeholder{color:red}.redText ::placeholder{color:red}.flex-parsing{flex:0 0 calc(50% - var(--vertical-gutter))}\"`\n      )\n\n      // Contains a source map\n      expect(cssContent).toMatch(/\\/\\*#\\s*sourceMappingURL=(.+\\.map)\\s*\\*\\//)\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a source map","suites":["SCSS Support","CSS Compilation and Prefixing"],"updatePoint":{"line":258,"column":38},"line":258,"code":"    it(`should've emitted a source map`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssMapFiles = files.filter((f) => /\\.css\\.map$/.test(f))\n\n      expect(cssMapFiles.length).toBe(1)\n      const cssMapContent = (\n        await readFile(join(cssFolder, cssMapFiles[0]), 'utf8')\n      ).trim()\n\n      const { version, mappings, sourcesContent } = JSON.parse(cssMapContent)\n      expect({ version, mappings, sourcesContent }).toMatchInlineSnapshot(`\n        Object {\n          \"mappings\": \"AAEE,4BACE,SAHE,CAEJ,gCACE,SAHE,CAEJ,uBACE,SAHE,CAON,cACE,2CAAA\",\n          \"sourcesContent\": Array [\n            \"$var: red;\n        .redText {\n          ::placeholder {\n            color: $var;\n          }\n        }\n\n        .flex-parsing {\n          flex: 0 0 calc(50% - var(--vertical-gutter));\n        }\n        \",\n          ],\n          \"version\": 3,\n        }\n      `)\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["SCSS Support","Multi Global Support (reversed)"],"updatePoint":{"line":300,"column":35},"line":300,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["SCSS Support","Multi Global Support (reversed)"],"updatePoint":{"line":308,"column":43},"line":308,"code":"    it(`should've emitted a single CSS file`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(\n        cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()\n      ).toMatchInlineSnapshot(`\".blue-text{color:blue}.red-text{color:red}\"`)\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should fail to build","suites":["SCSS Support","Invalid CSS in _document"],"updatePoint":{"line":329,"column":28},"line":329,"code":"    it('should fail to build', async () => {\n      const { code, stderr } = await nextBuild(appDir, [], {\n        stderr: true,\n      })\n      expect(code).not.toBe(0)\n      expect(stderr).toContain('Failed to compile')\n      expect(stderr).toContain('styles.module.scss')\n      expect(stderr).toMatch(\n        /CSS.*cannot.*be imported within.*pages[\\\\/]_document\\.js/\n      )\n      expect(stderr).toMatch(/Location:.*pages[\\\\/]_document\\.js/)\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should fail to build","suites":["SCSS Support","Invalid Global CSS"],"updatePoint":{"line":350,"column":28},"line":350,"code":"    it('should fail to build', async () => {\n      const { code, stderr } = await nextBuild(appDir, [], {\n        stderr: true,\n      })\n      expect(code).not.toBe(0)\n      expect(stderr).toContain('Failed to compile')\n      expect(stderr).toContain('styles/global.scss')\n      expect(stderr).toMatch(\n        /Please move all first-party global CSS imports.*?pages(\\/|\\\\)_app/\n      )\n      expect(stderr).toMatch(/Location:.*pages[\\\\/]index\\.js/)\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should fail to build","suites":["SCSS Support","Invalid Global CSS with Custom App"],"updatePoint":{"line":371,"column":28},"line":371,"code":"    it('should fail to build', async () => {\n      const { code, stderr } = await nextBuild(appDir, [], {\n        stderr: true,\n      })\n      expect(code).not.toBe(0)\n      expect(stderr).toContain('Failed to compile')\n      expect(stderr).toContain('styles/global.scss')\n      expect(stderr).toMatch(\n        /Please move all first-party global CSS imports.*?pages(\\/|\\\\)_app/\n      )\n      expect(stderr).toMatch(/Location:.*pages[\\\\/]index\\.js/)\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should fail to build","suites":["SCSS Support","Valid and Invalid Global CSS with Custom App"],"updatePoint":{"line":392,"column":28},"line":392,"code":"    it('should fail to build', async () => {\n      const { code, stderr } = await nextBuild(appDir, [], {\n        stderr: true,\n      })\n      expect(code).not.toBe(0)\n      expect(stderr).toContain('Failed to compile')\n      expect(stderr).toContain('styles/global.scss')\n      expect(stderr).toContain('Please move all first-party global CSS imports')\n      expect(stderr).toMatch(/Location:.*pages[\\\\/]index\\.js/)\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should update CSS color without remounting <input>","suites":["SCSS Support","Can hot reload CSS without losing state"],"updatePoint":{"line":421,"column":58},"line":421,"code":"    it('should update CSS color without remounting <input>', async () => {\n      let browser\n      try {\n        browser = await webdriver(appPort, '/page1')\n\n        const desiredText = 'hello world'\n        await browser.elementById('text-input').type(desiredText)\n        expect(await browser.elementById('text-input').getValue()).toBe(\n          desiredText\n        )\n\n        const currentColor = await browser.eval(\n          `window.getComputedStyle(document.querySelector('.red-text')).color`\n        )\n        expect(currentColor).toMatchInlineSnapshot(`\"rgb(255, 0, 0)\"`)\n\n        const cssFile = new File(join(appDir, 'styles/global1.scss'))\n        try {\n          cssFile.replace('$var: red', '$var: purple')\n          await waitFor(2000) // wait for HMR\n\n          const refreshedColor = await browser.eval(\n            `window.getComputedStyle(document.querySelector('.red-text')).color`\n          )\n          expect(refreshedColor).toMatchInlineSnapshot(`\"rgb(128, 0, 128)\"`)\n\n          // ensure text remained\n          expect(await browser.elementById('text-input').getValue()).toBe(\n            desiredText\n          )\n        } finally {\n          cssFile.restore()\n        }\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should have CSS for page","suites":["SCSS Support","Has CSS in computed styles in Development"],"updatePoint":{"line":479,"column":32},"line":479,"code":"    it('should have CSS for page', async () => {\n      let browser\n      try {\n        browser = await webdriver(appPort, '/page2')\n\n        const currentColor = await browser.eval(\n          `window.getComputedStyle(document.querySelector('.blue-text')).color`\n        )\n        expect(currentColor).toMatchInlineSnapshot(`\"rgb(0, 0, 255)\"`)\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should have body visible","suites":["SCSS Support","Body is not hidden when unused in Development"],"updatePoint":{"line":513,"column":32},"line":513,"code":"    it('should have body visible', async () => {\n      let browser\n      try {\n        browser = await webdriver(appPort, '/')\n        const currentDisplay = await browser.eval(\n          `window.getComputedStyle(document.querySelector('body')).display`\n        )\n        expect(currentDisplay).toBe('block')\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should have body visible","suites":["SCSS Support","Body is not hidden when broken in Development"],"updatePoint":{"line":543,"column":32},"line":543,"code":"    it('should have body visible', async () => {\n      const pageFile = new File(join(appDir, 'pages/index.js'))\n      let browser\n      try {\n        pageFile.replace('<div />', '<div>')\n        await waitFor(2000) // wait for recompile\n\n        browser = await webdriver(appPort, '/')\n        const currentDisplay = await browser.eval(\n          `window.getComputedStyle(document.querySelector('body')).display`\n        )\n        expect(currentDisplay).toBe('block')\n      } finally {\n        pageFile.restore()\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["SCSS Support","Has CSS in computed styles in Production"],"updatePoint":{"line":583,"column":41},"line":583,"code":"    it('should have compiled successfully', () => {\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should have CSS for page","suites":["SCSS Support","Has CSS in computed styles in Production"],"updatePoint":{"line":588,"column":32},"line":588,"code":"    it('should have CSS for page', async () => {\n      const browser = await webdriver(appPort, '/page2')\n\n      const currentColor = await browser.eval(\n        `window.getComputedStyle(document.querySelector('.blue-text')).color`\n      )\n      expect(currentColor).toMatchInlineSnapshot(`\"rgb(0, 0, 255)\"`)\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should've preloaded the CSS file and injected it in <head>","suites":["SCSS Support","Has CSS in computed styles in Production"],"updatePoint":{"line":597,"column":66},"line":597,"code":"    it(`should've preloaded the CSS file and injected it in <head>`, async () => {\n      const content = await renderViaHTTP(appPort, '/page2')\n      const $ = cheerio.load(content)\n\n      const cssPreload = $('link[rel=\"preload\"][as=\"style\"]')\n      expect(cssPreload.length).toBe(1)\n      expect(cssPreload.attr('href')).toMatch(/^\\/_next\\/static\\/css\\/.*\\.css$/)\n\n      const cssSheet = $('link[rel=\"stylesheet\"]')\n      expect(cssSheet.length).toBe(1)\n      expect(cssSheet.attr('href')).toMatch(/^\\/_next\\/static\\/css\\/.*\\.css$/)\n\n      /* ensure CSS preloaded first */\n      const allPreloads = [].slice.call($('link[rel=\"preload\"]'))\n      const styleIndexes = allPreloads.flatMap((p, i) =>\n        p.attribs.as === 'style' ? i : []\n      )\n      expect(styleIndexes).toEqual([0])\n    })","file":"integration/scss/test/group-1.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["SCSS Support","CSS URL via `file-loader`"],"updatePoint":{"line":25,"column":35},"line":25,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should've emitted expected files","suites":["SCSS Support","CSS URL via `file-loader`"],"updatePoint":{"line":33,"column":40},"line":33,"code":"    it(`should've emitted expected files`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n      const mediaFolder = join(appDir, '.next/static/media')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatch(\n        /^\\.red-text\\{color:red;background-image:url\\(\\/_next\\/static\\/media\\/dark\\.[a-f0-9]{8}\\.svg\\) url\\(\\/_next\\/static\\/media\\/dark2\\.[a-f0-9]{8}\\.svg\\)\\}\\.blue-text\\{color:orange;font-weight:bolder;background-image:url\\(\\/_next\\/static\\/media\\/light\\.[a-f0-9]{8}\\.svg\\);color:blue\\}$/\n      )\n\n      const mediaFiles = await readdir(mediaFolder)\n      expect(mediaFiles.length).toBe(3)\n      expect(\n        mediaFiles\n          .map((fileName) =>\n            /^(.+?)\\..{8}\\.(.+?)$/.exec(fileName).slice(1).join('.')\n          )\n          .sort()\n      ).toMatchInlineSnapshot(`\n        Array [\n          \"dark.svg\",\n          \"dark2.svg\",\n          \"light.svg\",\n        ]\n      `)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["SCSS Support","CSS URL via file-loader sass partial"],"updatePoint":{"line":71,"column":35},"line":71,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should've emitted expected files","suites":["SCSS Support","CSS URL via file-loader sass partial"],"updatePoint":{"line":79,"column":40},"line":79,"code":"    it(`should've emitted expected files`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n      const mediaFolder = join(appDir, '.next/static/media')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(\n        cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()\n      ).toMatchInlineSnapshot(\n        '\".red-text{color:red;background-image:url(/_next/static/media/darka.6b01655b.svg),url(/_next/static/media/darkb.6b01655b.svg)}.blue-text{color:orange;font-weight:bolder;background-image:url(/_next/static/media/light.2da1d3d6.svg);color:blue}\"'\n      )\n\n      const mediaFiles = await readdir(mediaFolder)\n      expect(mediaFiles.length).toBe(3)\n      expect(\n        mediaFiles\n          .map((fileName) =>\n            /^(.+?)\\..{8}\\.(.+?)$/.exec(fileName).slice(1).join('.')\n          )\n          .sort()\n      ).toMatchInlineSnapshot(`\n        Array [\n          \"darka.svg\",\n          \"darkb.svg\",\n          \"light.svg\",\n        ]\n      `)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["SCSS Support","CSS URL via `file-loader` and asset prefix (1)"],"updatePoint":{"line":119,"column":35},"line":119,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should've emitted expected files","suites":["SCSS Support","CSS URL via `file-loader` and asset prefix (1)"],"updatePoint":{"line":127,"column":40},"line":127,"code":"    it(`should've emitted expected files`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n      const mediaFolder = join(appDir, '.next/static/media')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatch(\n        /^\\.red-text\\{color:red;background-image:url\\(\\/foo\\/_next\\/static\\/media\\/dark\\.[a-f0-9]{8}\\.svg\\) url\\(\\/foo\\/_next\\/static\\/media\\/dark2\\.[a-f0-9]{8}\\.svg\\)\\}\\.blue-text\\{color:orange;font-weight:bolder;background-image:url\\(\\/foo\\/_next\\/static\\/media\\/light\\.[a-f0-9]{8}\\.svg\\);color:blue\\}$/\n      )\n\n      const mediaFiles = await readdir(mediaFolder)\n      expect(mediaFiles.length).toBe(3)\n      expect(\n        mediaFiles\n          .map((fileName) =>\n            /^(.+?)\\..{8}\\.(.+?)$/.exec(fileName).slice(1).join('.')\n          )\n          .sort()\n      ).toMatchInlineSnapshot(`\n        Array [\n          \"dark.svg\",\n          \"dark2.svg\",\n          \"light.svg\",\n        ]\n      `)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["SCSS Support","CSS URL via `file-loader` and asset prefix (2)"],"updatePoint":{"line":165,"column":35},"line":165,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should've emitted expected files","suites":["SCSS Support","CSS URL via `file-loader` and asset prefix (2)"],"updatePoint":{"line":173,"column":40},"line":173,"code":"    it(`should've emitted expected files`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n      const mediaFolder = join(appDir, '.next/static/media')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatch(\n        /^\\.red-text\\{color:red;background-image:url\\(\\/foo\\/_next\\/static\\/media\\/dark\\.[a-f0-9]{8}\\.svg\\) url\\(\\/foo\\/_next\\/static\\/media\\/dark2\\.[a-f0-9]{8}\\.svg\\)\\}\\.blue-text\\{color:orange;font-weight:bolder;background-image:url\\(\\/foo\\/_next\\/static\\/media\\/light\\.[a-f0-9]{8}\\.svg\\);color:blue\\}$/\n      )\n\n      const mediaFiles = await readdir(mediaFolder)\n      expect(mediaFiles.length).toBe(3)\n      expect(\n        mediaFiles\n          .map((fileName) =>\n            /^(.+?)\\..{8}\\.(.+?)$/.exec(fileName).slice(1).join('.')\n          )\n          .sort()\n      ).toMatchInlineSnapshot(`\n        Array [\n          \"dark.svg\",\n          \"dark2.svg\",\n          \"light.svg\",\n        ]\n      `)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["SCSS Support","Data Urls"],"updatePoint":{"line":211,"column":35},"line":211,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should've emitted expected files","suites":["SCSS Support","Data Urls"],"updatePoint":{"line":219,"column":40},"line":219,"code":"    it(`should've emitted expected files`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatch(\n        /^\\.red-text\\{color:red;background-image:url\\(\"data:[^\"]+\"\\)\\}$/\n      )\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["SCSS Support","External imports"],"updatePoint":{"line":240,"column":35},"line":240,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should've emitted expected files","suites":["SCSS Support","External imports"],"updatePoint":{"line":248,"column":40},"line":248,"code":"    it(`should've emitted expected files`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatch(\n        /^@import\"https:\\/\\/fonts\\.googleapis\\.com\\/css2\\?family=Poppins:wght@400&display=swap\";\\.red-text\\{color:red;font-family:Poppins;font-style:normal;font-weight:400\\}$/\n      )\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["SCSS Support","Good CSS Import from node_modules"],"updatePoint":{"line":269,"column":35},"line":269,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["SCSS Support","Good CSS Import from node_modules"],"updatePoint":{"line":277,"column":43},"line":277,"code":"    it(`should've emitted a single CSS file`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatch(/nprogress/)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["SCSS Support","Good Nested CSS Import from node_modules"],"updatePoint":{"line":296,"column":35},"line":296,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a single CSS file","suites":["SCSS Support","Good Nested CSS Import from node_modules"],"updatePoint":{"line":304,"column":43},"line":304,"code":"    it(`should've emitted a single CSS file`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n      expect(\n        cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()\n      ).toMatchInlineSnapshot(`\".other{color:blue}.test{color:red}\"`)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should fail the build","suites":["SCSS Support","CSS Import from node_modules"],"updatePoint":{"line":325,"column":29},"line":325,"code":"    it('should fail the build', async () => {\n      const { code, stderr } = await nextBuild(appDir, [], { stderr: true })\n\n      expect(code).toBe(0)\n      expect(stderr).not.toMatch(/Can't resolve '[^']*?nprogress[^']*?'/)\n      expect(stderr).not.toMatch(/Build error occurred/)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["SCSS Support","Preprocessor loader order"],"updatePoint":{"line":341,"column":35},"line":341,"code":"    it('should compile successfully', async () => {\n      const { stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have the correct color (css ordering)","suites":["SCSS Support","Ordering with styled-jsx (dev)"],"updatePoint":{"line":363,"column":52},"line":363,"code":"    it('should have the correct color (css ordering)', async () => {\n      const browser = await webdriver(appPort, '/')\n\n      const currentColor = await browser.eval(\n        `window.getComputedStyle(document.querySelector('.my-text')).color`\n      )\n      expect(currentColor).toMatchInlineSnapshot(`\"rgb(0, 128, 0)\"`)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have compiled successfully","suites":["SCSS Support","Ordering with styled-jsx (prod)"],"updatePoint":{"line":392,"column":41},"line":392,"code":"    it('should have compiled successfully', () => {\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should have the correct color (css ordering)","suites":["SCSS Support","Ordering with styled-jsx (prod)"],"updatePoint":{"line":397,"column":52},"line":397,"code":"    it('should have the correct color (css ordering)', async () => {\n      const browser = await webdriver(appPort, '/')\n\n      const currentColor = await browser.eval(\n        `window.getComputedStyle(document.querySelector('.my-text')).color`\n      )\n      expect(currentColor).toMatchInlineSnapshot(`\"rgb(0, 128, 0)\"`)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["SCSS Support","Basic Tailwind CSS"],"updatePoint":{"line":414,"column":35},"line":414,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should've compiled and prefixed","suites":["SCSS Support","Basic Tailwind CSS"],"updatePoint":{"line":422,"column":39},"line":422,"code":"    it(`should've compiled and prefixed`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n      expect(cssContent).toMatch(/object-right-bottom/) // look for tailwind's CSS\n      expect(cssContent).not.toMatch(/tailwind/) // ensure @tailwind was removed\n\n      // Contains a source map\n      expect(cssContent).toMatch(/\\/\\*#\\s*sourceMappingURL=(.+\\.map)\\s*\\*\\//)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a source map","suites":["SCSS Support","Basic Tailwind CSS"],"updatePoint":{"line":438,"column":38},"line":438,"code":"    it(`should've emitted a source map`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssMapFiles = files.filter((f) => /\\.css\\.map$/.test(f))\n\n      expect(cssMapFiles.length).toBe(1)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should compile successfully","suites":["SCSS Support","Tailwind and Purge CSS"],"updatePoint":{"line":455,"column":35},"line":455,"code":"    it('should compile successfully', async () => {\n      const { code, stdout } = await nextBuild(appDir, [], {\n        stdout: true,\n      })\n      expect(code).toBe(0)\n      expect(stdout).toMatch(/Compiled successfully/)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should've compiled and prefixed","suites":["SCSS Support","Tailwind and Purge CSS"],"updatePoint":{"line":463,"column":39},"line":463,"code":"    it(`should've compiled and prefixed`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssFiles = files.filter((f) => /\\.css$/.test(f))\n\n      expect(cssFiles.length).toBe(1)\n      const cssContent = await readFile(join(cssFolder, cssFiles[0]), 'utf8')\n\n      expect(cssContent).not.toMatch(/object-right-bottom/) // this was unused and should be gone\n      expect(cssContent).toMatch(/text-blue-500/) // this was used\n      expect(cssContent).not.toMatch(/tailwind/) // ensure @tailwind was removed\n\n      // Contains a source map\n      expect(cssContent).toMatch(/\\/\\*#\\s*sourceMappingURL=(.+\\.map)\\s*\\*\\//)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should've emitted a source map","suites":["SCSS Support","Tailwind and Purge CSS"],"updatePoint":{"line":480,"column":38},"line":480,"code":"    it(`should've emitted a source map`, async () => {\n      const cssFolder = join(appDir, '.next/static/css')\n\n      const files = await readdir(cssFolder)\n      const cssMapFiles = files.filter((f) => /\\.css\\.map$/.test(f))\n\n      expect(cssMapFiles.length).toBe(1)\n    })","file":"integration/scss/test/group-2.test.js","skipped":false,"dir":"test"},{"name":"should enable reading local files in api routes","suites":[],"updatePoint":{"line":21,"column":53},"line":21,"code":"  it('should enable reading local files in api routes', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/test', null, {})\n    expect(res.status).toEqual(200)\n    const content = await res.json()\n    expect(content).toHaveProperty('message', 'hello world')\n  })","file":"integration/server-asset-modules/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show server-side error for gsp page correctly","suites":["server-side dev errors"],"updatePoint":{"line":41,"column":58},"line":41,"code":"  it('should show server-side error for gsp page correctly', async () => {\n    const content = await fs.readFile(gspPage, 'utf8')\n\n    try {\n      const stderrIdx = stderr.length\n      await fs.writeFile(\n        gspPage,\n        content.replace('return {', 'missingVar;return {')\n      )\n      const browser = await webdriver(appPort, '/gsp')\n\n      await check(async () => {\n        const err = stderr.slice(stderrIdx)\n\n        return err.includes('pages/gsp.js') &&\n          err.includes('6:2') &&\n          err.includes('getStaticProps') &&\n          err.includes('missingVar')\n          ? 'success'\n          : err\n      }, 'success')\n\n      expect(await hasRedbox(browser, true)).toBe(true)\n\n      expect(await getRedboxSource(browser)).toContain('missingVar')\n      await fs.writeFile(gspPage, content)\n      await hasRedbox(browser, false)\n    } finally {\n      await fs.writeFile(gspPage, content)\n    }\n  })","file":"integration/server-side-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show server-side error for gssp page correctly","suites":["server-side dev errors"],"updatePoint":{"line":73,"column":59},"line":73,"code":"  it('should show server-side error for gssp page correctly', async () => {\n    const content = await fs.readFile(gsspPage, 'utf8')\n\n    try {\n      const stderrIdx = stderr.length\n      await fs.writeFile(\n        gsspPage,\n        content.replace('return {', 'missingVar;return {')\n      )\n      const browser = await webdriver(appPort, '/gssp')\n\n      await check(async () => {\n        const err = stderr.slice(stderrIdx)\n\n        return err.includes('pages/gssp.js') &&\n          err.includes('6:2') &&\n          err.includes('getServerSideProps') &&\n          err.includes('missingVar')\n          ? 'success'\n          : err\n      }, 'success')\n\n      expect(await hasRedbox(browser, true)).toBe(true)\n\n      expect(await getRedboxSource(browser)).toContain('missingVar')\n      await fs.writeFile(gsspPage, content)\n      await hasRedbox(browser, false)\n    } finally {\n      await fs.writeFile(gsspPage, content)\n    }\n  })","file":"integration/server-side-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show server-side error for dynamic gssp page correctly","suites":["server-side dev errors"],"updatePoint":{"line":105,"column":67},"line":105,"code":"  it('should show server-side error for dynamic gssp page correctly', async () => {\n    const content = await fs.readFile(dynamicGsspPage, 'utf8')\n\n    try {\n      const stderrIdx = stderr.length\n      await fs.writeFile(\n        dynamicGsspPage,\n        content.replace('return {', 'missingVar;return {')\n      )\n      const browser = await webdriver(appPort, '/blog/first')\n\n      await check(async () => {\n        const err = stderr.slice(stderrIdx)\n\n        return err.includes('pages/blog/[slug].js') &&\n          err.includes('6:2') &&\n          err.includes('getServerSideProps') &&\n          err.includes('missingVar')\n          ? 'success'\n          : err\n      }, 'success')\n\n      expect(await hasRedbox(browser, true)).toBe(true)\n\n      expect(await getRedboxSource(browser)).toContain('missingVar')\n      await fs.writeFile(dynamicGsspPage, content)\n      await hasRedbox(browser, false)\n    } finally {\n      await fs.writeFile(dynamicGsspPage, content)\n    }\n  })","file":"integration/server-side-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show server-side error for api route correctly","suites":["server-side dev errors"],"updatePoint":{"line":137,"column":59},"line":137,"code":"  it('should show server-side error for api route correctly', async () => {\n    const content = await fs.readFile(apiPage, 'utf8')\n\n    try {\n      const stderrIdx = stderr.length\n      await fs.writeFile(\n        apiPage,\n        content.replace('res.status', 'missingVar;res.status')\n      )\n      const browser = await webdriver(appPort, '/api/hello')\n\n      await check(async () => {\n        const err = stderr.slice(stderrIdx)\n\n        return err.includes('pages/api/hello.js') &&\n          err.includes('2:2') &&\n          err.includes('default') &&\n          err.includes('missingVar')\n          ? 'success'\n          : err\n      }, 'success')\n\n      expect(await hasRedbox(browser, true)).toBe(true)\n\n      expect(await getRedboxSource(browser)).toContain('missingVar')\n      await fs.writeFile(apiPage, content)\n      await hasRedbox(browser, false)\n    } finally {\n      await fs.writeFile(apiPage, content)\n    }\n  })","file":"integration/server-side-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show server-side error for dynamic api route correctly","suites":["server-side dev errors"],"updatePoint":{"line":169,"column":67},"line":169,"code":"  it('should show server-side error for dynamic api route correctly', async () => {\n    const content = await fs.readFile(dynamicApiPage, 'utf8')\n\n    try {\n      const stderrIdx = stderr.length\n      await fs.writeFile(\n        dynamicApiPage,\n        content.replace('res.status', 'missingVar;res.status')\n      )\n      const browser = await webdriver(appPort, '/api/blog/first')\n\n      await check(async () => {\n        const err = stderr.slice(stderrIdx)\n\n        return err.includes('pages/api/blog/[slug].js') &&\n          err.includes('2:2') &&\n          err.includes('default') &&\n          err.includes('missingVar')\n          ? 'success'\n          : err\n      }, 'success')\n\n      expect(await hasRedbox(browser, true)).toBe(true)\n\n      expect(await getRedboxSource(browser)).toContain('missingVar')\n      await fs.writeFile(dynamicApiPage, content)\n      await hasRedbox(browser, false)\n    } finally {\n      await fs.writeFile(dynamicApiPage, content)\n    }\n  })","file":"integration/server-side-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show server-side error for uncaught rejection correctly","suites":["server-side dev errors"],"updatePoint":{"line":201,"column":68},"line":201,"code":"  it('should show server-side error for uncaught rejection correctly', async () => {\n    const stderrIdx = stderr.length\n    await webdriver(appPort, '/uncaught-rejection')\n\n    await check(async () => {\n      const err = stderr.slice(stderrIdx)\n\n      return err.includes('pages/uncaught-rejection.js') &&\n        err.includes('7:19') &&\n        err.includes('getServerSideProps') &&\n        err.includes('catch this rejection')\n        ? 'success'\n        : err\n    }, 'success')\n  })","file":"integration/server-side-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show server-side error for uncaught empty rejection correctly","suites":["server-side dev errors"],"updatePoint":{"line":217,"column":74},"line":217,"code":"  it('should show server-side error for uncaught empty rejection correctly', async () => {\n    const stderrIdx = stderr.length\n    await webdriver(appPort, '/uncaught-empty-rejection')\n\n    await check(async () => {\n      const cleanStderr = stripAnsi(stderr.slice(stderrIdx))\n\n      return cleanStderr.includes('pages/uncaught-empty-rejection.js') &&\n        cleanStderr.includes('7:19') &&\n        cleanStderr.includes('getServerSideProps') &&\n        cleanStderr.includes('new Error()')\n        ? 'success'\n        : cleanStderr\n    }, 'success')\n  })","file":"integration/server-side-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show server-side error for uncaught exception correctly","suites":["server-side dev errors"],"updatePoint":{"line":233,"column":68},"line":233,"code":"  it('should show server-side error for uncaught exception correctly', async () => {\n    const stderrIdx = stderr.length\n    await webdriver(appPort, '/uncaught-exception')\n\n    await check(async () => {\n      const err = stderr.slice(stderrIdx)\n\n      return err.includes('pages/uncaught-exception.js') &&\n        err.includes('7:10') &&\n        err.includes('getServerSideProps') &&\n        err.includes('catch this exception')\n        ? 'success'\n        : err\n    }, 'success')\n  })","file":"integration/server-side-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show server-side error for uncaught empty exception correctly","suites":["server-side dev errors"],"updatePoint":{"line":249,"column":74},"line":249,"code":"  it('should show server-side error for uncaught empty exception correctly', async () => {\n    const stderrIdx = stderr.length\n    await webdriver(appPort, '/uncaught-empty-exception')\n\n    await check(async () => {\n      const cleanStderr = stripAnsi(stderr.slice(stderrIdx))\n\n      return cleanStderr.includes('pages/uncaught-empty-exception.js') &&\n        cleanStderr.includes('7:10') &&\n        cleanStderr.includes('getServerSideProps') &&\n        cleanStderr.includes('new Error()')\n        ? 'success'\n        : cleanStderr\n    }, 'success')\n  })","file":"integration/server-side-dev-errors/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not error on usage of publicRuntimeConfig","suites":[],"updatePoint":{"line":38,"column":54},"line":38,"code":"  it('should not error on usage of publicRuntimeConfig', async () => {\n    await fs.writeFile(\n      nextConfigPath,\n      `module.exports = {\n      target: '${serverlessMode}',\n      publicRuntimeConfig: {\n        hello: 'world'\n      }\n    }`\n    )\n\n    const { stderr, code } = await nextBuild(appDir, undefined, {\n      stderr: true,\n    })\n    expect(code).toBe(0)\n    expect(stderr).not.toMatch(\n      /Cannot use publicRuntimeConfig or serverRuntimeConfig/\n    )\n  })","file":"integration/serverless-runtime-configs/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not error on usage of serverRuntimeConfig","suites":[],"updatePoint":{"line":58,"column":54},"line":58,"code":"  it('should not error on usage of serverRuntimeConfig', async () => {\n    await fs.writeFile(\n      nextConfigPath,\n      `module.exports = {\n      target: '${serverlessMode}',\n      serverRuntimeConfig: {\n        hello: 'world'\n      }\n    }`\n    )\n\n    const { stderr, code } = await nextBuild(appDir, undefined, {\n      stderr: true,\n    })\n    expect(code).toBe(0)\n    expect(stderr).not.toMatch(\n      /Cannot use publicRuntimeConfig or serverRuntimeConfig/\n    )\n  })","file":"integration/serverless-runtime-configs/test/index.test.js","skipped":false,"dir":"test"},{"name":"should support runtime configs in serverless mode (production)","suites":[],"updatePoint":{"line":129,"column":68},"line":129,"code":"  it('should support runtime configs in serverless mode (production)', async () => {\n    await fs.writeFile(\n      nextConfigPath,\n      `module.exports = {\n        target: '${serverlessMode}',\n        serverRuntimeConfig: {\n          hello: 'world'\n        },\n        publicRuntimeConfig: {\n          another: 'thing'\n        }\n      }`\n    )\n\n    await nextBuild(appDir, [], { stderr: true, stdout: true })\n    const appPort = await findPort()\n    const app = await nextStart(appDir, appPort)\n    await testRuntimeConfig(app, appPort)\n  })","file":"integration/serverless-runtime-configs/test/index.test.js","skipped":false,"dir":"test"},{"name":"should support runtime configs in serverless mode (dev)","suites":[],"updatePoint":{"line":149,"column":61},"line":149,"code":"  it('should support runtime configs in serverless mode (dev)', async () => {\n    await fs.writeFile(\n      nextConfigPath,\n      `module.exports = {\n        target: '${serverlessMode}',\n        serverRuntimeConfig: {\n          hello: 'world'\n        },\n        publicRuntimeConfig: {\n          another: 'thing'\n        }\n      }`\n    )\n\n    const appPort = await findPort()\n    const app = await launchApp(appDir, appPort)\n    await testRuntimeConfig(app, appPort)\n  })","file":"integration/serverless-runtime-configs/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have revalidate page in prerender-manifest with correct interval","suites":["Serverless Trace"],"updatePoint":{"line":39,"column":77},"line":39,"code":"  it('should have revalidate page in prerender-manifest with correct interval', async () => {\n    const data = await fs.readJSON(\n      join(appDir, '.next/prerender-manifest.json')\n    )\n    expect(data.routes['/revalidate']).toEqual({\n      initialRevalidateSeconds: 10,\n      dataRoute: `/_next/data/${buildId}/revalidate.json`,\n      srcRoute: null,\n    })\n  })","file":"integration/serverless-trace-revalidate/test/index.test.js","skipped":false,"dir":"test"},{"name":"should set correct Cache-Control header","suites":["Serverless Trace"],"updatePoint":{"line":50,"column":45},"line":50,"code":"  it('should set correct Cache-Control header', async () => {\n    const url = `http://localhost:${appPort}/revalidate`\n    const res = await fetch(url)\n    expect(res.headers.get('Cache-Control')).toMatch(\n      's-maxage=10, stale-while-revalidate'\n    )\n  })","file":"integration/serverless-trace-revalidate/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page","suites":["Serverless Trace"],"updatePoint":{"line":32,"column":28},"line":32,"code":"  it('should render the page', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toMatch(/Hello World/)\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should serve file from public folder","suites":["Serverless Trace"],"updatePoint":{"line":37,"column":42},"line":37,"code":"  it('should serve file from public folder', async () => {\n    const content = await renderViaHTTP(appPort, '/hello.txt')\n    expect(content.trim()).toBe('hello world')\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page with dynamic import","suites":["Serverless Trace"],"updatePoint":{"line":42,"column":48},"line":42,"code":"  it('should render the page with dynamic import', async () => {\n    const html = await renderViaHTTP(appPort, '/dynamic')\n    expect(html).toMatch(/Hello!/)\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page with same dynamic import","suites":["Serverless Trace"],"updatePoint":{"line":47,"column":53},"line":47,"code":"  it('should render the page with same dynamic import', async () => {\n    const html = await renderViaHTTP(appPort, '/dynamic-two')\n    expect(html).toMatch(/Hello!/)\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render 404","suites":["Serverless Trace"],"updatePoint":{"line":52,"column":23},"line":52,"code":"  it('should render 404', async () => {\n    const html = await renderViaHTTP(appPort, '/404')\n    expect(html).toMatch(/This page could not be found/)\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render 404 for /_next/static","suites":["Serverless Trace"],"updatePoint":{"line":57,"column":41},"line":57,"code":"  it('should render 404 for /_next/static', async () => {\n    const html = await renderViaHTTP(appPort, '/_next/static')\n    expect(html).toMatch(/This page could not be found/)\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render an AMP page","suites":["Serverless Trace"],"updatePoint":{"line":62,"column":31},"line":62,"code":"  it('should render an AMP page', async () => {\n    const html = await renderViaHTTP(appPort, '/some-amp?amp=1')\n    expect(html).toMatch(/Hi Im an AMP page/)\n    expect(html).toMatch(/ampproject\\.org/)\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct amphtml rel link","suites":["Serverless Trace"],"updatePoint":{"line":68,"column":42},"line":68,"code":"  it('should have correct amphtml rel link', async () => {\n    const html = await renderViaHTTP(appPort, '/some-amp')\n    expect(html).toMatch(/Hi Im an AMP page/)\n    expect(html).toMatch(/rel=\"amphtml\" href=\"\\/some-amp\\.amp\"/)\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct canonical link","suites":["Serverless Trace"],"updatePoint":{"line":74,"column":40},"line":74,"code":"  it('should have correct canonical link', async () => {\n    const html = await renderViaHTTP(appPort, '/some-amp?amp=1')\n    expect(html).toMatch(/rel=\"canonical\" href=\"\\/some-amp\"/)\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct canonical link (auto-export link)","suites":["Serverless Trace"],"updatePoint":{"line":79,"column":59},"line":79,"code":"  it('should have correct canonical link (auto-export link)', async () => {\n    const html = await renderViaHTTP(appPort, '/some-amp.amp')\n    expect(html).toMatch(/rel=\"canonical\" href=\"\\/some-amp\"/)\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render correctly when importing isomorphic-unfetch","suites":["Serverless Trace"],"updatePoint":{"line":84,"column":63},"line":84,"code":"  it('should render correctly when importing isomorphic-unfetch', async () => {\n    const url = `http://localhost:${appPort}/fetch`\n    const res = await fetch(url)\n    expect(res.status).toBe(200)\n    const text = await res.text()\n    expect(text.includes('failed')).toBe(false)\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render correctly when importing isomorphic-unfetch on the client side","suites":["Serverless Trace"],"updatePoint":{"line":92,"column":82},"line":92,"code":"  it('should render correctly when importing isomorphic-unfetch on the client side', async () => {\n    const browser = await webdriver(appPort, '/')\n    try {\n      const text = await browser\n        .elementByCss('a')\n        .click()\n        .waitForElementByCss('.fetch-page')\n        .elementByCss('#text')\n        .text()\n\n      expect(text).toMatch(/fetch page/)\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have combined client-side chunks","suites":["Serverless Trace"],"updatePoint":{"line":108,"column":49},"line":108,"code":"  it('should not have combined client-side chunks', () => {\n    expect(readdirSync(chunksDir).length).toBeGreaterThanOrEqual(2)\n    const contents = readNextBuildClientPageFile(appDir, '/dynamic')\n    expect(contents).not.toContain('Hello!')\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not output _app.js and _document.js to serverless build","suites":["Serverless Trace"],"updatePoint":{"line":114,"column":68},"line":114,"code":"  it('should not output _app.js and _document.js to serverless build', () => {\n    expect(existsSync(join(serverlessDir, '_app.js'))).toBeFalsy()\n    expect(existsSync(join(serverlessDir, '_document.js'))).toBeFalsy()\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should replace static pages with HTML files","suites":["Serverless Trace"],"updatePoint":{"line":119,"column":49},"line":119,"code":"  it('should replace static pages with HTML files', async () => {\n    const pages = ['/abc', '/dynamic', '/dynamic-two', '/some-amp']\n    for (const page of pages) {\n      const file = getPageFileFromPagesManifest(appDir, page)\n\n      expect(file.endsWith('.html')).toBe(true)\n    }\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not replace non-static pages with HTML files","suites":["Serverless Trace"],"updatePoint":{"line":128,"column":57},"line":128,"code":"  it('should not replace non-static pages with HTML files', async () => {\n    const pages = ['/fetch', '/_error']\n\n    for (const page of pages) {\n      const file = getPageFileFromPagesManifest(appDir, page)\n\n      expect(file.endsWith('.js')).toBe(true)\n    }\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reply on API request successfully","suites":["Serverless Trace"],"updatePoint":{"line":137,"column":46},"line":137,"code":"  it('should reply on API request successfully', async () => {\n    const content = await renderViaHTTP(appPort, '/api/hello')\n    expect(content).toMatch(/hello world/)\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reply on dynamic API request successfully","suites":["Serverless Trace"],"updatePoint":{"line":142,"column":54},"line":142,"code":"  it('should reply on dynamic API request successfully', async () => {\n    const result = await renderViaHTTP(appPort, '/api/posts/post-1')\n    const { id } = JSON.parse(result)\n    expect(id).toBe('post-1')\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reply on dynamic API request successfully with query parameters","suites":["Serverless Trace"],"updatePoint":{"line":148,"column":76},"line":148,"code":"  it('should reply on dynamic API request successfully with query parameters', async () => {\n    const result = await renderViaHTTP(appPort, '/api/posts/post-1?param=val')\n    const { id, param } = JSON.parse(result)\n    expect(id).toBe('post-1')\n    expect(param).toBe('val')\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reply on dynamic API index request successfully","suites":["Serverless Trace"],"updatePoint":{"line":155,"column":60},"line":155,"code":"  it('should reply on dynamic API index request successfully', async () => {\n    const result = await renderViaHTTP(appPort, '/api/dynamic/post-1')\n    const { path } = JSON.parse(result)\n    expect(path).toBe('post-1')\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reply on dynamic API index request successfully with query parameters","suites":["Serverless Trace"],"updatePoint":{"line":161,"column":82},"line":161,"code":"  it('should reply on dynamic API index request successfully with query parameters', async () => {\n    const result = await renderViaHTTP(appPort, '/api/dynamic/post-1?param=val')\n    const { path, param } = JSON.parse(result)\n    expect(path).toBe('post-1')\n    expect(param).toBe('val')\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reply with redirect on API request with trailing slash","suites":["Serverless Trace"],"updatePoint":{"line":168,"column":67},"line":168,"code":"  it('should reply with redirect on API request with trailing slash', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/api/hello/',\n      {},\n      { redirect: 'manual' }\n    )\n    expect(res.status).toBe(308)\n    expect(res.headers.get('location')).toBe(\n      `http://localhost:${appPort}/api/hello`\n    )\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reply on API request with trailing slassh successfully","suites":["Serverless Trace"],"updatePoint":{"line":181,"column":67},"line":181,"code":"  it('should reply on API request with trailing slassh successfully', async () => {\n    const content = await renderViaHTTP(appPort, '/api/hello/')\n    expect(content).toMatch(/hello world/)\n  })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should allow etag header support","suites":["Serverless Trace","With basic usage"],"updatePoint":{"line":187,"column":40},"line":187,"code":"    it('should allow etag header support', async () => {\n      const url = `http://localhost:${appPort}/`\n      const etag = (await fetch(url)).headers.get('ETag')\n\n      const headers = { 'If-None-Match': etag }\n      const res2 = await fetch(url, { headers })\n      expect(res2.status).toBe(304)\n    })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should set Content-Length header","suites":["Serverless Trace","With basic usage"],"updatePoint":{"line":196,"column":40},"line":196,"code":"    it('should set Content-Length header', async () => {\n      const url = `http://localhost:${appPort}`\n      const res = await fetch(url)\n      expect(res.headers.get('Content-Length')).toBeDefined()\n    })","file":"integration/serverless-trace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show target config deprecation warning","suites":["Serverless"],"updatePoint":{"line":46,"column":51},"line":46,"code":"  it('should show target config deprecation warning', () => {\n    expect(output).toContain(\n      'The `target` config is deprecated and will be removed in a future version'\n    )\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page","suites":["Serverless"],"updatePoint":{"line":52,"column":28},"line":52,"code":"  it('should render the page', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toMatch(/Hello World/)\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should add autoExport for auto pre-rendered pages","suites":["Serverless"],"updatePoint":{"line":57,"column":55},"line":57,"code":"  it('should add autoExport for auto pre-rendered pages', async () => {\n    for (const page of ['/', '/abc']) {\n      const html = await renderViaHTTP(appPort, page)\n      const $ = cheerio.load(html)\n      const data = JSON.parse($('#__NEXT_DATA__').html())\n      expect(data.autoExport).toBe(true)\n    }\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not add autoExport for non pre-rendered pages","suites":["Serverless"],"updatePoint":{"line":66,"column":58},"line":66,"code":"  it('should not add autoExport for non pre-rendered pages', async () => {\n    for (const page of ['/fetch']) {\n      const html = await renderViaHTTP(appPort, page)\n      const $ = cheerio.load(html)\n      const data = JSON.parse($('#__NEXT_DATA__').html())\n      expect(!!data.autoExport).toBe(false)\n    }\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should serve file from public folder","suites":["Serverless"],"updatePoint":{"line":75,"column":42},"line":75,"code":"  it('should serve file from public folder', async () => {\n    const content = await renderViaHTTP(appPort, '/hello.txt')\n    expect(content.trim()).toBe('hello world')\n\n    const legacy = await renderViaHTTP(appPort, '/static/legacy.txt')\n    expect(legacy).toMatch(`new static folder`)\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not infinity loop on a 404 static file","suites":["Serverless"],"updatePoint":{"line":83,"column":51},"line":83,"code":"  it('should not infinity loop on a 404 static file', async () => {\n    expect.assertions(2)\n\n    // ensure top-level static does not exist (important for test)\n    // we expect /public/static, though.\n    expect(existsSync(join(appDir, 'static'))).toBe(false)\n\n    const res = await fetchViaHTTP(appPort, '/static/404')\n    expect(res.status).toBe(404)\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page with dynamic import","suites":["Serverless"],"updatePoint":{"line":94,"column":48},"line":94,"code":"  it('should render the page with dynamic import', async () => {\n    const html = await renderViaHTTP(appPort, '/dynamic')\n    expect(html).toMatch(/Hello!/)\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page with same dynamic import","suites":["Serverless"],"updatePoint":{"line":99,"column":53},"line":99,"code":"  it('should render the page with same dynamic import', async () => {\n    const html = await renderViaHTTP(appPort, '/dynamic-two')\n    expect(html).toMatch(/Hello!/)\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render 404","suites":["Serverless"],"updatePoint":{"line":104,"column":23},"line":104,"code":"  it('should render 404', async () => {\n    const html = await renderViaHTTP(appPort, '/404')\n    expect(html).toMatch(/This page could not be found/)\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render 404 for /_next/static","suites":["Serverless"],"updatePoint":{"line":109,"column":41},"line":109,"code":"  it('should render 404 for /_next/static', async () => {\n    const html = await renderViaHTTP(appPort, '/_next/static')\n    expect(html).toMatch(/This page could not be found/)\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render an AMP page","suites":["Serverless"],"updatePoint":{"line":114,"column":31},"line":114,"code":"  it('should render an AMP page', async () => {\n    const html = await renderViaHTTP(appPort, '/some-amp?amp=1')\n    expect(html).toMatch(/Hi Im an AMP page/)\n    expect(html).toMatch(/ampproject\\.org/)\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct amphtml rel link","suites":["Serverless"],"updatePoint":{"line":120,"column":42},"line":120,"code":"  it('should have correct amphtml rel link', async () => {\n    const html = await renderViaHTTP(appPort, '/some-amp')\n    expect(html).toMatch(/Hi Im an AMP page/)\n    expect(html).toMatch(/rel=\"amphtml\" href=\"\\/some-amp\\.amp\"/)\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct canonical link","suites":["Serverless"],"updatePoint":{"line":126,"column":40},"line":126,"code":"  it('should have correct canonical link', async () => {\n    const html = await renderViaHTTP(appPort, '/some-amp?amp=1')\n    expect(html).toMatch(/rel=\"canonical\" href=\"\\/some-amp\"/)\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have correct canonical link (auto-export link)","suites":["Serverless"],"updatePoint":{"line":131,"column":59},"line":131,"code":"  it('should have correct canonical link (auto-export link)', async () => {\n    const html = await renderViaHTTP(appPort, '/some-amp.amp')\n    expect(html).toMatch(/rel=\"canonical\" href=\"\\/some-amp\"/)\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render correctly when importing isomorphic-unfetch","suites":["Serverless"],"updatePoint":{"line":136,"column":63},"line":136,"code":"  it('should render correctly when importing isomorphic-unfetch', async () => {\n    const url = `http://localhost:${appPort}/fetch`\n    const res = await fetch(url)\n    expect(res.status).toBe(200)\n    const text = await res.text()\n    expect(text.includes('failed')).toBe(false)\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render correctly when importing isomorphic-unfetch on the client side","suites":["Serverless"],"updatePoint":{"line":144,"column":82},"line":144,"code":"  it('should render correctly when importing isomorphic-unfetch on the client side', async () => {\n    const browser = await webdriver(appPort, '/')\n    try {\n      const text = await browser\n        .elementByCss('#fetchlink')\n        .click()\n        .waitForElementByCss('.fetch-page')\n        .elementByCss('#text')\n        .text()\n\n      expect(text).toMatch(/fetch page/)\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render correctly when importing isomorphic-unfetch CJS","suites":["Serverless"],"updatePoint":{"line":160,"column":67},"line":160,"code":"  it('should render correctly when importing isomorphic-unfetch CJS', async () => {\n    const url = `http://localhost:${appPort}/fetch-cjs`\n    const res = await fetch(url)\n    expect(res.status).toBe(200)\n    const text = await res.text()\n    expect(text.includes('failed')).toBe(false)\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render correctly when importing isomorphic-unfetch CJS on the client side","suites":["Serverless"],"updatePoint":{"line":168,"column":86},"line":168,"code":"  it('should render correctly when importing isomorphic-unfetch CJS on the client side', async () => {\n    const browser = await webdriver(appPort, '/')\n    try {\n      const text = await browser\n        .elementByCss('#fetchcjslink')\n        .click()\n        .waitForElementByCss('.fetch-cjs-page')\n        .elementByCss('#text')\n        .text()\n\n      expect(text).toMatch(/fetch page/)\n    } finally {\n      await browser.close()\n    }\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not have combined client-side chunks","suites":["Serverless"],"updatePoint":{"line":184,"column":49},"line":184,"code":"  it('should not have combined client-side chunks', () => {\n    expect(readdirSync(chunksDir).length).toBeGreaterThanOrEqual(2)\n\n    const pageFile = getPageFileFromBuildManifest(appDir, '/')\n\n    expect(\n      readFileSync(join(__dirname, '..', '.next', pageFile), 'utf8')\n    ).not.toContain('Hello!')\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not output _app.js and _document.js to serverless build","suites":["Serverless"],"updatePoint":{"line":194,"column":68},"line":194,"code":"  it('should not output _app.js and _document.js to serverless build', () => {\n    expect(existsSync(join(serverlessDir, '_app.js'))).toBeFalsy()\n    expect(existsSync(join(serverlessDir, '_document.js'))).toBeFalsy()\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should replace static pages with HTML files","suites":["Serverless"],"updatePoint":{"line":199,"column":49},"line":199,"code":"  it('should replace static pages with HTML files', async () => {\n    const pages = ['/abc', '/dynamic', '/dynamic-two', '/some-amp']\n    for (const page of pages) {\n      const file = getPageFileFromPagesManifest(appDir, page)\n\n      expect(file.endsWith('.html')).toBe(true)\n    }\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not replace non-static pages with HTML files","suites":["Serverless"],"updatePoint":{"line":208,"column":57},"line":208,"code":"  it('should not replace non-static pages with HTML files', async () => {\n    const pages = ['/fetch', '/_error']\n\n    for (const page of pages) {\n      const file = getPageFileFromPagesManifest(appDir, page)\n\n      expect(file.endsWith('.js')).toBe(true)\n    }\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reply on API request successfully","suites":["Serverless"],"updatePoint":{"line":218,"column":46},"line":218,"code":"  it('should reply on API request successfully', async () => {\n    const content = await renderViaHTTP(appPort, '/api/hello')\n    expect(content).toMatch(/hello world/)\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reply on dynamic API request successfully","suites":["Serverless"],"updatePoint":{"line":223,"column":54},"line":223,"code":"  it('should reply on dynamic API request successfully', async () => {\n    const result = await renderViaHTTP(appPort, '/api/posts/post-1')\n    const { id } = JSON.parse(result)\n    expect(id).toBe('post-1')\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reply on dynamic API request successfully with query parameters","suites":["Serverless"],"updatePoint":{"line":229,"column":76},"line":229,"code":"  it('should reply on dynamic API request successfully with query parameters', async () => {\n    const result = await renderViaHTTP(appPort, '/api/posts/post-1?param=val')\n    const { id, param } = JSON.parse(result)\n    expect(id).toBe('post-1')\n    expect(param).toBe('val')\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reply on dynamic API index request successfully","suites":["Serverless"],"updatePoint":{"line":236,"column":60},"line":236,"code":"  it('should reply on dynamic API index request successfully', async () => {\n    const result = await renderViaHTTP(appPort, '/api/dynamic/post-1')\n    const { path } = JSON.parse(result)\n    expect(path).toBe('post-1')\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reply on dynamic API index request successfully with query parameters","suites":["Serverless"],"updatePoint":{"line":242,"column":82},"line":242,"code":"  it('should reply on dynamic API index request successfully with query parameters', async () => {\n    const result = await renderViaHTTP(appPort, '/api/dynamic/post-1?param=val')\n    const { path, param } = JSON.parse(result)\n    expect(path).toBe('post-1')\n    expect(param).toBe('val')\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reply with redirect on API request with trailing slash","suites":["Serverless"],"updatePoint":{"line":249,"column":67},"line":249,"code":"  it('should reply with redirect on API request with trailing slash', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/api/hello/',\n      {},\n      { redirect: 'manual' }\n    )\n    expect(res.status).toBe(308)\n    expect(res.headers.get('location')).toBe(\n      `http://localhost:${appPort}/api/hello`\n    )\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should reply on API request with trailing slash successfully","suites":["Serverless"],"updatePoint":{"line":262,"column":66},"line":262,"code":"  it('should reply on API request with trailing slash successfully', async () => {\n    const content = await renderViaHTTP(appPort, '/api/hello/')\n    expect(content).toMatch(/hello world/)\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have the correct query string for a dynamic route","suites":["Serverless"],"updatePoint":{"line":267,"column":62},"line":267,"code":"  it('should have the correct query string for a dynamic route', async () => {\n    const paramRaw = 'test % 123'\n    const param = encodeURIComponent(paramRaw)\n\n    const html = await renderViaHTTP(appPort, `/dr/${param}`)\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#__NEXT_DATA__').html())\n\n    expect(data.query).toEqual({ slug: paramRaw })\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have the correct query string for a now route","suites":["Serverless"],"updatePoint":{"line":278,"column":58},"line":278,"code":"  it('should have the correct query string for a now route', async () => {\n    const paramRaw = 'test % 123'\n    const html = await fetchViaHTTP(appPort, `/dr/[slug]`, '', {\n      headers: {\n        'x-now-route-matches': qs.stringify({\n          1: encodeURIComponent(paramRaw),\n        }),\n      },\n    }).then((res) => res.text())\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#__NEXT_DATA__').html())\n\n    expect(data.query).toEqual({ slug: paramRaw })\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have the correct query string for a now route with invalid matches but correct path","suites":["Serverless"],"updatePoint":{"line":293,"column":96},"line":293,"code":"  it('should have the correct query string for a now route with invalid matches but correct path', async () => {\n    const paramRaw = 'dr/first'\n    const html = await fetchViaHTTP(appPort, `/dr/first`, '', {\n      headers: {\n        'x-now-route-matches': qs.stringify({\n          1: encodeURIComponent(paramRaw),\n        }),\n      },\n    }).then((res) => res.text())\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#__NEXT_DATA__').html())\n\n    expect(data.query).toEqual({ slug: 'first' })\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have the correct query string for a catch all now route","suites":["Serverless"],"updatePoint":{"line":308,"column":68},"line":308,"code":"  it('should have the correct query string for a catch all now route', async () => {\n    const paramRaw = ['nested % 1', 'nested/2']\n\n    const html = await fetchViaHTTP(appPort, `/catchall/[...slug]`, '', {\n      headers: {\n        'x-now-route-matches': qs.stringify({\n          1: paramRaw.map((e) => encodeURIComponent(e)).join('/'),\n        }),\n      },\n    }).then((res) => res.text())\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#__NEXT_DATA__').html())\n\n    expect(data.query).toEqual({ slug: paramRaw })\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should log error in API route correctly","suites":["Serverless"],"updatePoint":{"line":324,"column":45},"line":324,"code":"  it('should log error in API route correctly', async () => {\n    await renderViaHTTP(appPort, '/api/top-level-error')\n    await waitFor(1000)\n    expect(stderr).toContain('top-level-oops')\n  })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should allow etag header support","suites":["Serverless","With basic usage"],"updatePoint":{"line":331,"column":40},"line":331,"code":"    it('should allow etag header support', async () => {\n      const url = `http://localhost:${appPort}/`\n      const etag = (await fetch(url)).headers.get('ETag')\n\n      const headers = { 'If-None-Match': etag }\n      const res2 = await fetch(url, { headers })\n      expect(res2.status).toBe(304)\n    })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should set Content-Length header","suites":["Serverless","With basic usage"],"updatePoint":{"line":340,"column":40},"line":340,"code":"    it('should set Content-Length header', async () => {\n      const url = `http://localhost:${appPort}`\n      const res = await fetch(url)\n      expect(res.headers.get('Content-Length')).toBeDefined()\n    })","file":"integration/serverless/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render from pages","suites":[],"updatePoint":{"line":19,"column":30},"line":19,"code":"  it('should render from pages', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toMatch(/PAGES/)\n  })","file":"integration/src-dir-support-double-dir/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render not render from src/pages","suites":[],"updatePoint":{"line":24,"column":45},"line":24,"code":"  it('should render not render from src/pages', async () => {\n    const html = await renderViaHTTP(appPort, '/hello')\n    expect(html).toMatch(/404/)\n  })","file":"integration/src-dir-support-double-dir/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render normal route","suites":[],"updatePoint":{"line":20,"column":32},"line":20,"code":"  it('should render normal route', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toMatch(/my blog/i)\n  })","file":"integration/src-dir-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render another normal route","suites":[],"updatePoint":{"line":25,"column":40},"line":25,"code":"  it('should render another normal route', async () => {\n    const html = await renderViaHTTP(appPort, '/another')\n    expect(html).toMatch(/hello from another/)\n  })","file":"integration/src-dir-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render dynamic page","suites":[],"updatePoint":{"line":30,"column":32},"line":30,"code":"  it('should render dynamic page', async () => {\n    const html = await renderViaHTTP(appPort, '/post-1')\n    expect(html).toMatch(/this is.*?post-1/i)\n  })","file":"integration/src-dir-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should prioritize a non-dynamic page","suites":[],"updatePoint":{"line":35,"column":42},"line":35,"code":"  it('should prioritize a non-dynamic page', async () => {\n    const html = await renderViaHTTP(appPort, '/post-1/comments')\n    expect(html).toMatch(/show comments for.*post-1.*here/i)\n  })","file":"integration/src-dir-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render nested dynamic page","suites":[],"updatePoint":{"line":40,"column":39},"line":40,"code":"  it('should render nested dynamic page', async () => {\n    const html = await renderViaHTTP(appPort, '/post-1/comment-1')\n    expect(html).toMatch(/i am.*comment-1.*on.*post-1/i)\n  })","file":"integration/src-dir-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate to a dynamic page successfully","suites":[],"updatePoint":{"line":45,"column":52},"line":45,"code":"  it('should navigate to a dynamic page successfully', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.elementByCss('#view-post-1').click()\n      await browser.waitForElementByCss('p#post-1')\n\n      const text = await browser.elementByCss('p#post-1').text()\n      expect(text).toMatch(/this is.*?post-1/i)\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/src-dir-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate to a nested dynamic page successfully","suites":[],"updatePoint":{"line":59,"column":59},"line":59,"code":"  it('should navigate to a nested dynamic page successfully', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.elementByCss('#view-post-1-comment-1').click()\n      await browser.waitForElementByCss('p#comment-1')\n\n      const text = await browser.elementByCss('p#comment-1').text()\n      expect(text).toMatch(/i am.*comment-1.*on.*post-1/i)\n    } finally {\n      if (browser) await browser.close()\n    }\n  })","file":"integration/src-dir-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should pass params in getInitialProps during SSR","suites":[],"updatePoint":{"line":73,"column":54},"line":73,"code":"  it('should pass params in getInitialProps during SSR', async () => {\n    const html = await renderViaHTTP(appPort, '/post-1/cmnt-1')\n    expect(html).toMatch(/gip.*post-1/i)\n  })","file":"integration/src-dir-support/test/index.test.js","skipped":false,"dir":"test"},{"name":"should hard navigate when a new deployment occurs","suites":[],"updatePoint":{"line":24,"column":55},"line":24,"code":"  it('should hard navigate when a new deployment occurs', async () => {\n    const browser = await webdriver(proxyPort, '/')\n\n    await browser.eval('window.beforeNav = 1')\n    expect(await browser.elementByCss('#index').text()).toBe('Index page')\n\n    should404Data = true\n\n    await browser.eval(`(function() {\n      window.next.router.push('/gsp')\n    })()`)\n    await browser.waitForElementByCss('#gsp')\n\n    expect(await browser.eval('window.beforeNav')).toBeFalsy()\n\n    await browser.eval('window.beforeNav = 1')\n    await browser.eval(`(function() {\n      window.next.router.push('/gssp')\n    })()`)\n    await browser.waitForElementByCss('#gssp')\n\n    expect(await browser.eval('window.beforeNav')).toBeFalsy()\n  })","file":"integration/ssg-data-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should skip this suite on Windows","suites":["SSG data 404"],"updatePoint":{"line":51,"column":41},"line":51,"code":"    it('should skip this suite on Windows', () => {})","file":"integration/ssg-data-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should respond to a not existing page with 404","suites":[],"updatePoint":{"line":21,"column":52},"line":21,"code":"  it('should respond to a not existing page with 404', async () => {\n    const res = await fetchViaHTTP(appPort, '/post/2')\n    expect(res.status).toBe(404)\n    expect(await res.text()).toContain('custom 404 page')\n  })","file":"integration/ssg-dynamic-routes-404-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build successfully","suites":["Custom 404 Page for static site generation with dynamic routes","server mode"],"updatePoint":{"line":32,"column":33},"line":32,"code":"    it('should build successfully', async () => {\n      const { code } = await nextBuild(appDir, [], {\n        stderr: true,\n        stdout: true,\n      })\n\n      expect(code).toBe(0)\n\n      appPort = await findPort()\n\n      app = await nextStart(appDir, appPort)\n    })","file":"integration/ssg-dynamic-routes-404-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build successfully","suites":["Custom 404 Page for static site generation with dynamic routes","serverless mode"],"updatePoint":{"line":54,"column":33},"line":54,"code":"    it('should build successfully', async () => {\n      await fs.writeFile(\n        nextConfig,\n        `\n        module.exports = { target: 'experimental-serverless-trace' }\n      `\n      )\n      const { code } = await nextBuild(appDir, [], {\n        stderr: true,\n        stdout: true,\n      })\n\n      expect(code).toBe(0)\n\n      appPort = await findPort()\n      app = await nextStart(appDir, appPort)\n    })","file":"integration/ssg-dynamic-routes-404-page/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not externalize when used outside Next.js","suites":["SSR Prepass"],"updatePoint":{"line":24,"column":54},"line":24,"code":"  it('should not externalize when used outside Next.js', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toMatch(/hello.*?world/)\n  })","file":"integration/ssr-prepass/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export 404 page without custom _error","suites":["Static 404 page","With config enabled"],"updatePoint":{"line":29,"column":52},"line":29,"code":"    it('should export 404 page without custom _error', async () => {\n      await nextBuild(appDir)\n      appPort = await findPort()\n      app = await nextStart(appDir, appPort)\n      const html = await renderViaHTTP(appPort, '/non-existent')\n      await killApp(app)\n      expect(html).toContain('This page could not be found')\n    })","file":"integration/static-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should export 404 page without custom _error (serverless)","suites":["Static 404 page","With config enabled"],"updatePoint":{"line":38,"column":65},"line":38,"code":"    it('should export 404 page without custom _error (serverless)', async () => {\n      await fs.writeFile(\n        nextConfig,\n        `\n        module.exports = {\n          target: 'experimental-serverless-trace'\n        }\n      `\n      )\n      await nextBuild(appDir)\n      appPort = await findPort()\n      app = await nextStart(appDir, appPort)\n      const html = await renderViaHTTP(appPort, '/non-existent')\n      await killApp(app)\n      expect(html).toContain('This page could not be found')\n    })","file":"integration/static-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not export 404 page with custom _error GIP","suites":["Static 404 page","With config enabled"],"updatePoint":{"line":55,"column":57},"line":55,"code":"    it('should not export 404 page with custom _error GIP', async () => {\n      await fs.writeFile(\n        errorPage,\n        `\n        import Error from 'next/error'\n        export default class MyError extends Error {\n          static getInitialProps({ statusCode, req }) {\n            if (req.url === '/404' || req.url === '/404.html') {\n              throw new Error('exported 404 unexpectedly!!!')\n            }\n            return {\n              statusCode,\n            }\n          }\n        }\n      `\n      )\n      await nextBuild(appDir, undefined, { stderr: true, stdout: true })\n      await fs.remove(errorPage)\n    })","file":"integration/static-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not export 404 page with getInitialProps in _app","suites":["Static 404 page","With config enabled"],"updatePoint":{"line":76,"column":63},"line":76,"code":"    it('should not export 404 page with getInitialProps in _app', async () => {\n      await fs.writeFile(\n        appPage,\n        `\n        const Page = ({ Component, pageProps }) => {\n          return <Component {...pageProps} />\n        }\n        Page.getInitialProps = () => ({ hello: 'world', pageProps: {} })\n        export default Page\n      `\n      )\n      await nextBuild(appDir)\n      await fs.remove(appPage)\n    })","file":"integration/static-404/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page via SSR correctly","suites":[],"updatePoint":{"line":21,"column":46},"line":21,"code":"  it('should render the page via SSR correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/static')\n    expect(html).toMatch(/hello from static page/)\n  })","file":"integration/static-page-name/test/index.test.js","skipped":false,"dir":"test"},{"name":"should navigate to static page name correctly","suites":[],"updatePoint":{"line":26,"column":51},"line":26,"code":"  it('should navigate to static page name correctly', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.elementByCss('#to-static').click()\n    await browser.waitForElementByCss('#static')\n    const html = await browser.eval(`document.documentElement.innerHTML`)\n    expect(html).toMatch(/hello from static page/)\n  })","file":"integration/static-page-name/test/index.test.js","skipped":false,"dir":"test"},{"name":"should serve a page correctly","suites":[],"updatePoint":{"line":17,"column":35},"line":17,"code":"  it('should serve a page correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toContain('Hello World')\n  })","file":"integration/styled-jsx-plugin/test/index.test.js","skipped":false,"dir":"test"},{"name":"can print telemetry status","suites":["Telemetry CLI"],"updatePoint":{"line":18,"column":32},"line":18,"code":"  it('can print telemetry status', async () => {\n    const { stdout } = await runNextCommand(['telemetry'], {\n      stdout: true,\n    })\n    expect(stdout).toMatch(/Status: .*/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"can enable telemetry with flag","suites":["Telemetry CLI"],"updatePoint":{"line":25,"column":36},"line":25,"code":"  it('can enable telemetry with flag', async () => {\n    const { stdout } = await runNextCommand(['telemetry', '--enable'], {\n      stdout: true,\n    })\n    expect(stdout).toMatch(/Success/)\n    expect(stdout).toMatch(/Status: Enabled/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"can disable telemetry with flag","suites":["Telemetry CLI"],"updatePoint":{"line":33,"column":37},"line":33,"code":"  it('can disable telemetry with flag', async () => {\n    const { stdout } = await runNextCommand(['telemetry', '--disable'], {\n      stdout: true,\n    })\n    expect(stdout).toMatch(/Your preference has been saved/)\n    expect(stdout).toMatch(/Status: Disabled/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"can enable telemetry without flag","suites":["Telemetry CLI"],"updatePoint":{"line":41,"column":39},"line":41,"code":"  it('can enable telemetry without flag', async () => {\n    const { stdout } = await runNextCommand(['telemetry', 'enable'], {\n      stdout: true,\n    })\n    expect(stdout).toMatch(/Success/)\n    expect(stdout).toMatch(/Status: Enabled/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"can re-enable telemetry","suites":["Telemetry CLI"],"updatePoint":{"line":49,"column":29},"line":49,"code":"  it('can re-enable telemetry', async () => {\n    const { stdout } = await runNextCommand(['telemetry', 'enable'], {\n      stdout: true,\n    })\n    expect(stdout).toMatch(/Success/)\n    expect(stdout).toMatch(/Status: Enabled/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"can disable telemetry without flag","suites":["Telemetry CLI"],"updatePoint":{"line":57,"column":40},"line":57,"code":"  it('can disable telemetry without flag', async () => {\n    const { stdout } = await runNextCommand(['telemetry', 'disable'], {\n      stdout: true,\n    })\n    expect(stdout).toMatch(/Your preference has been saved/)\n    expect(stdout).toMatch(/Status: Disabled/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"can re-disable telemetry","suites":["Telemetry CLI"],"updatePoint":{"line":65,"column":30},"line":65,"code":"  it('can re-disable telemetry', async () => {\n    const { stdout } = await runNextCommand(['telemetry', 'disable'], {\n      stdout: true,\n    })\n    expect(stdout).toMatch(/already disabled/)\n    expect(stdout).toMatch(/Status: Disabled/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"detects isSrcDir dir correctly for `next build`","suites":["Telemetry CLI"],"updatePoint":{"line":73,"column":53},"line":73,"code":"  it('detects isSrcDir dir correctly for `next build`', async () => {\n    // must clear cache for GSSP imports to be detected correctly\n    await fs.remove(path.join(appDir, '.next'))\n    const { stderr } = await runNextCommand(['build', appDir], {\n      stderr: true,\n      env: {\n        NEXT_TELEMETRY_DEBUG: 1,\n      },\n    })\n\n    expect(stderr).toMatch(/isSrcDir.*?false/)\n    expect(stderr).toMatch(/package.*?\"fs\"/)\n    expect(stderr).toMatch(/package.*?\"path\"/)\n    expect(stderr).toMatch(/package.*?\"http\"/)\n    expect(stderr).toMatch(/NEXT_PACKAGE_USED_IN_GET_SERVER_SIDE_PROPS/)\n\n    await fs.move(path.join(appDir, 'pages'), path.join(appDir, 'src/pages'))\n    const { stderr: stderr2 } = await runNextCommand(['build', appDir], {\n      stderr: true,\n      env: {\n        NEXT_TELEMETRY_DEBUG: 1,\n      },\n    })\n    await fs.move(path.join(appDir, 'src/pages'), path.join(appDir, 'pages'))\n\n    expect(stderr2).toMatch(/isSrcDir.*?true/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"emits event when swc fails to load","suites":["Telemetry CLI"],"updatePoint":{"line":101,"column":40},"line":101,"code":"  it('emits event when swc fails to load', async () => {\n    await fs.remove(path.join(appDir, '.next'))\n    const { stderr } = await runNextCommand(['build', appDir], {\n      stderr: true,\n      env: {\n        // block swc from loading\n        NODE_OPTIONS: '--no-addons',\n        NEXT_TELEMETRY_DEBUG: 1,\n      },\n    })\n    expect(stderr).toMatch(/NEXT_SWC_LOAD_FAILURE/)\n    expect(stderr).toContain(\n      `\"nextVersion\": \"${require('next/package.json').version}\"`\n    )\n    expect(stderr).toContain(`\"arch\": \"${process.arch}\"`)\n    expect(stderr).toContain(`\"platform\": \"${process.platform}\"`)\n    expect(stderr).toContain(`\"nodeVersion\": \"${process.versions.node}\"`)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"logs completed `next build` with warnings","suites":["Telemetry CLI"],"updatePoint":{"line":120,"column":47},"line":120,"code":"  it('logs completed `next build` with warnings', async () => {\n    await fs.rename(\n      path.join(appDir, 'pages', 'warning.skip'),\n      path.join(appDir, 'pages', 'warning.js')\n    )\n    const { stderr } = await runNextCommand(['build', appDir], {\n      stderr: true,\n      env: {\n        NEXT_TELEMETRY_DEBUG: 1,\n      },\n    })\n    await fs.rename(\n      path.join(appDir, 'pages', 'warning.js'),\n      path.join(appDir, 'pages', 'warning.skip')\n    )\n\n    expect(stderr).toMatch(/Compiled with warnings/)\n    expect(stderr).toMatch(/NEXT_BUILD_COMPLETED/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"detects tests correctly for `next build`","suites":["Telemetry CLI"],"updatePoint":{"line":140,"column":46},"line":140,"code":"  it('detects tests correctly for `next build`', async () => {\n    await fs.rename(\n      path.join(appDir, 'pages', 'hello.test.skip'),\n      path.join(appDir, 'pages', 'hello.test.js')\n    )\n    const { stderr } = await runNextCommand(['build', appDir], {\n      stderr: true,\n      env: {\n        NEXT_TELEMETRY_DEBUG: 1,\n      },\n    })\n    await fs.rename(\n      path.join(appDir, 'pages', 'hello.test.js'),\n      path.join(appDir, 'pages', 'hello.test.skip')\n    )\n\n    const event1 = /NEXT_BUILD_COMPLETED[\\s\\S]+?{([\\s\\S]+?)}/.exec(stderr).pop()\n    expect(event1).toMatch(/hasDunderPages.*?true/)\n    expect(event1).toMatch(/hasTestPages.*?true/)\n\n    const event2 = /NEXT_BUILD_OPTIMIZED[\\s\\S]+?{([\\s\\S]+?)}/.exec(stderr).pop()\n    expect(event2).toMatch(/hasDunderPages.*?true/)\n    expect(event2).toMatch(/hasTestPages.*?true/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"detects correct cli session defaults","suites":["Telemetry CLI"],"updatePoint":{"line":165,"column":42},"line":165,"code":"  it('detects correct cli session defaults', async () => {\n    const { stderr } = await runNextCommand(['build', appDir], {\n      stderr: true,\n      env: {\n        NEXT_TELEMETRY_DEBUG: 1,\n      },\n    })\n\n    const event = /NEXT_CLI_SESSION_STARTED[\\s\\S]+?{([\\s\\S]+?)}/\n      .exec(stderr)\n      .pop()\n\n    expect(event).toMatch(/\"hasNextConfig\": false/)\n    expect(event).toMatch(/\"buildTarget\": \"default\"/)\n    expect(event).toMatch(/\"hasWebpackConfig\": false/)\n    expect(event).toMatch(/\"hasBabelConfig\": false/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"cli session: babel tooling config","suites":["Telemetry CLI"],"updatePoint":{"line":183,"column":39},"line":183,"code":"  it('cli session: babel tooling config', async () => {\n    await fs.rename(\n      path.join(appDir, '.babelrc.default'),\n      path.join(appDir, '.babelrc')\n    )\n    const { stderr } = await runNextCommand(['build', appDir], {\n      stderr: true,\n      env: {\n        NEXT_TELEMETRY_DEBUG: 1,\n      },\n    })\n    await fs.rename(\n      path.join(appDir, '.babelrc'),\n      path.join(appDir, '.babelrc.default')\n    )\n\n    const event = /NEXT_CLI_SESSION_STARTED[\\s\\S]+?{([\\s\\S]+?)}/\n      .exec(stderr)\n      .pop()\n\n    expect(event).toMatch(/\"hasNextConfig\": false/)\n    expect(event).toMatch(/\"buildTarget\": \"default\"/)\n    expect(event).toMatch(/\"hasWebpackConfig\": false/)\n    expect(event).toMatch(/\"hasBabelConfig\": false/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"cli session: custom babel config (plugin)","suites":["Telemetry CLI"],"updatePoint":{"line":209,"column":47},"line":209,"code":"  it('cli session: custom babel config (plugin)', async () => {\n    await fs.rename(\n      path.join(appDir, '.babelrc.plugin'),\n      path.join(appDir, '.babelrc')\n    )\n    const { stderr } = await runNextCommand(['build', appDir], {\n      stderr: true,\n      env: {\n        NEXT_TELEMETRY_DEBUG: 1,\n      },\n    })\n    await fs.rename(\n      path.join(appDir, '.babelrc'),\n      path.join(appDir, '.babelrc.plugin')\n    )\n\n    const event = /NEXT_CLI_SESSION_STARTED[\\s\\S]+?{([\\s\\S]+?)}/\n      .exec(stderr)\n      .pop()\n\n    expect(event).toMatch(/\"hasNextConfig\": false/)\n    expect(event).toMatch(/\"buildTarget\": \"default\"/)\n    expect(event).toMatch(/\"hasWebpackConfig\": false/)\n    expect(event).toMatch(/\"hasBabelConfig\": true/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"cli session: package.json custom babel config (plugin)","suites":["Telemetry CLI"],"updatePoint":{"line":235,"column":60},"line":235,"code":"  it('cli session: package.json custom babel config (plugin)', async () => {\n    await fs.rename(\n      path.join(appDir, 'package.babel'),\n      path.join(appDir, 'package.json')\n    )\n    const { stderr } = await runNextCommand(['build', appDir], {\n      stderr: true,\n      env: {\n        NEXT_TELEMETRY_DEBUG: 1,\n      },\n    })\n    await fs.rename(\n      path.join(appDir, 'package.json'),\n      path.join(appDir, 'package.babel')\n    )\n\n    const event = /NEXT_CLI_SESSION_STARTED[\\s\\S]+?{([\\s\\S]+?)}/\n      .exec(stderr)\n      .pop()\n\n    expect(event).toMatch(/\"hasNextConfig\": false/)\n    expect(event).toMatch(/\"buildTarget\": \"default\"/)\n    expect(event).toMatch(/\"hasWebpackConfig\": false/)\n    expect(event).toMatch(/\"hasBabelConfig\": true/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"cli session: custom babel config (preset)","suites":["Telemetry CLI"],"updatePoint":{"line":261,"column":47},"line":261,"code":"  it('cli session: custom babel config (preset)', async () => {\n    await fs.rename(\n      path.join(appDir, '.babelrc.preset'),\n      path.join(appDir, '.babelrc')\n    )\n    const { stderr } = await runNextCommand(['build', appDir], {\n      stderr: true,\n      env: {\n        NEXT_TELEMETRY_DEBUG: 1,\n      },\n    })\n    await fs.rename(\n      path.join(appDir, '.babelrc'),\n      path.join(appDir, '.babelrc.preset')\n    )\n\n    const event = /NEXT_CLI_SESSION_STARTED[\\s\\S]+?{([\\s\\S]+?)}/\n      .exec(stderr)\n      .pop()\n\n    expect(event).toMatch(/\"hasNextConfig\": false/)\n    expect(event).toMatch(/\"buildTarget\": \"default\"/)\n    expect(event).toMatch(/\"hasWebpackConfig\": false/)\n    expect(event).toMatch(/\"hasBabelConfig\": true/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"cli session: next config with target","suites":["Telemetry CLI"],"updatePoint":{"line":287,"column":42},"line":287,"code":"  it('cli session: next config with target', async () => {\n    await fs.rename(\n      path.join(appDir, 'next.config.target'),\n      path.join(appDir, 'next.config.js')\n    )\n    const { stderr } = await runNextCommand(['build', appDir], {\n      stderr: true,\n      env: {\n        NEXT_TELEMETRY_DEBUG: 1,\n      },\n    })\n    await fs.rename(\n      path.join(appDir, 'next.config.js'),\n      path.join(appDir, 'next.config.target')\n    )\n\n    const event = /NEXT_CLI_SESSION_STARTED[\\s\\S]+?{([\\s\\S]+?)}/\n      .exec(stderr)\n      .pop()\n\n    expect(event).toMatch(/\"hasNextConfig\": true/)\n    expect(event).toMatch(/\"buildTarget\": \"experimental-serverless-trace\"/)\n    expect(event).toMatch(/\"hasWebpackConfig\": false/)\n    expect(event).toMatch(/\"hasBabelConfig\": false/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"cli session: next config with webpack","suites":["Telemetry CLI"],"updatePoint":{"line":313,"column":43},"line":313,"code":"  it('cli session: next config with webpack', async () => {\n    await fs.rename(\n      path.join(appDir, 'next.config.webpack'),\n      path.join(appDir, 'next.config.js')\n    )\n    const { stderr } = await runNextCommand(['build', appDir], {\n      stderr: true,\n      env: {\n        NEXT_TELEMETRY_DEBUG: 1,\n      },\n    })\n    await fs.rename(\n      path.join(appDir, 'next.config.js'),\n      path.join(appDir, 'next.config.webpack')\n    )\n\n    const event = /NEXT_CLI_SESSION_STARTED[\\s\\S]+?{([\\s\\S]+?)}/\n      .exec(stderr)\n      .pop()\n\n    expect(event).toMatch(/\"hasNextConfig\": true/)\n    expect(event).toMatch(/\"buildTarget\": \"default\"/)\n    expect(event).toMatch(/\"hasWebpackConfig\": true/)\n    expect(event).toMatch(/\"hasBabelConfig\": false/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"detect static 404 correctly for `next build`","suites":["Telemetry CLI"],"updatePoint":{"line":339,"column":50},"line":339,"code":"  it('detect static 404 correctly for `next build`', async () => {\n    const { stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n      env: { NEXT_TELEMETRY_DEBUG: 1 },\n    })\n\n    const event1 = /NEXT_BUILD_OPTIMIZED[\\s\\S]+?{([\\s\\S]+?)}/.exec(stderr).pop()\n    expect(event1).toMatch(/hasStatic404.*?true/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"detect page counts correctly for `next build`","suites":["Telemetry CLI"],"updatePoint":{"line":349,"column":51},"line":349,"code":"  it('detect page counts correctly for `next build`', async () => {\n    const { stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n      env: { NEXT_TELEMETRY_DEBUG: 1 },\n    })\n\n    const event1 = /NEXT_BUILD_OPTIMIZED[\\s\\S]+?{([\\s\\S]+?)}/.exec(stderr).pop()\n    expect(event1).toMatch(/\"staticPropsPageCount\": 2/)\n    expect(event1).toMatch(/\"serverPropsPageCount\": 2/)\n    expect(event1).toMatch(/\"ssrPageCount\": 1/)\n    expect(event1).toMatch(/\"staticPageCount\": 4/)\n    expect(event1).toMatch(/\"totalPageCount\": 9/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"detects isSrcDir dir correctly for `next dev`","suites":["Telemetry CLI"],"updatePoint":{"line":363,"column":51},"line":363,"code":"  it('detects isSrcDir dir correctly for `next dev`', async () => {\n    let port = await findPort()\n    let stderr = ''\n\n    const handleStderr = (msg) => {\n      stderr += msg\n    }\n    let app = await launchApp(appDir, port, {\n      onStderr: handleStderr,\n      env: {\n        NEXT_TELEMETRY_DEBUG: 1,\n      },\n    })\n    await waitFor(1000)\n    await killApp(app)\n    expect(stderr).toMatch(/isSrcDir.*?false/)\n\n    await fs.move(path.join(appDir, 'pages'), path.join(appDir, 'src/pages'))\n    stderr = ''\n\n    port = await findPort()\n    app = await launchApp(appDir, port, {\n      onStderr: handleStderr,\n      env: {\n        NEXT_TELEMETRY_DEBUG: 1,\n      },\n    })\n    await waitFor(1000)\n    await killApp(app)\n    await fs.move(path.join(appDir, 'src/pages'), path.join(appDir, 'pages'))\n\n    expect(stderr).toMatch(/isSrcDir.*?true/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"detect reportWebVitals correctly for `next build`","suites":["Telemetry CLI"],"updatePoint":{"line":397,"column":55},"line":397,"code":"  it('detect reportWebVitals correctly for `next build`', async () => {\n    // Case 1: When _app.js does not exist.\n    let build = await nextBuild(appDir, [], {\n      stderr: true,\n      env: { NEXT_TELEMETRY_DEBUG: 1 },\n    })\n\n    let event1 = /NEXT_BUILD_OPTIMIZED[\\s\\S]+?{([\\s\\S]+?)}/\n      .exec(build.stderr)\n      .pop()\n    expect(event1).toMatch(/hasReportWebVitals.*?false/)\n\n    // Case 2: When _app.js exist with reportWebVitals function.\n    await fs.utimes(\n      path.join(appDir, 'pages', '_app_withreportwebvitals.empty'),\n      new Date(),\n      new Date()\n    )\n    await fs.rename(\n      path.join(appDir, 'pages', '_app_withreportwebvitals.empty'),\n      path.join(appDir, 'pages', '_app.js')\n    )\n\n    build = await nextBuild(appDir, [], {\n      stderr: true,\n      env: { NEXT_TELEMETRY_DEBUG: 1 },\n    })\n\n    await fs.rename(\n      path.join(appDir, 'pages', '_app.js'),\n      path.join(appDir, 'pages', '_app_withreportwebvitals.empty')\n    )\n\n    event1 = /NEXT_BUILD_OPTIMIZED[\\s\\S]+?{([\\s\\S]+?)}/.exec(build.stderr).pop()\n    expect(event1).toMatch(/hasReportWebVitals.*?true/)\n\n    // Case 3: When _app.js exist without reportWebVitals function.\n    await fs.utimes(\n      path.join(appDir, 'pages', '_app_withoutreportwebvitals.empty'),\n      new Date(),\n      new Date()\n    )\n    await fs.rename(\n      path.join(appDir, 'pages', '_app_withoutreportwebvitals.empty'),\n      path.join(appDir, 'pages', '_app.js')\n    )\n\n    build = await nextBuild(appDir, [], {\n      stderr: true,\n      env: { NEXT_TELEMETRY_DEBUG: 1 },\n    })\n\n    await fs.rename(\n      path.join(appDir, 'pages', '_app.js'),\n      path.join(appDir, 'pages', '_app_withoutreportwebvitals.empty')\n    )\n\n    event1 = /NEXT_BUILD_OPTIMIZED[\\s\\S]+?{([\\s\\S]+?)}/.exec(build.stderr).pop()\n    expect(event1).toMatch(/hasReportWebVitals.*?false/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"detects rewrites, headers, and redirects for next build","suites":["Telemetry CLI"],"updatePoint":{"line":458,"column":61},"line":458,"code":"  it('detects rewrites, headers, and redirects for next build', async () => {\n    await fs.rename(\n      path.join(appDir, 'next.config.custom-routes'),\n      path.join(appDir, 'next.config.js')\n    )\n\n    const { stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n      env: { NEXT_TELEMETRY_DEBUG: 1 },\n    })\n\n    await fs.rename(\n      path.join(appDir, 'next.config.js'),\n      path.join(appDir, 'next.config.custom-routes')\n    )\n\n    const event1 = /NEXT_BUILD_OPTIMIZED[\\s\\S]+?{([\\s\\S]+?)}/.exec(stderr).pop()\n    expect(event1).toMatch(/\"headersCount\": 1/)\n    expect(event1).toMatch(/\"rewritesCount\": 2/)\n    expect(event1).toMatch(/\"redirectsCount\": 1/)\n    expect(event1).toMatch(/\"middlewareCount\": 0/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"detects i18n and image configs for session start","suites":["Telemetry CLI"],"updatePoint":{"line":481,"column":54},"line":481,"code":"  it('detects i18n and image configs for session start', async () => {\n    await fs.rename(\n      path.join(appDir, 'next.config.i18n-images'),\n      path.join(appDir, 'next.config.js')\n    )\n\n    const { stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n      env: { NEXT_TELEMETRY_DEBUG: 1 },\n    })\n\n    await fs.rename(\n      path.join(appDir, 'next.config.js'),\n      path.join(appDir, 'next.config.i18n-images')\n    )\n\n    const event1 = /NEXT_CLI_SESSION_STARTED[\\s\\S]+?{([\\s\\S]+?)}/\n      .exec(stderr)\n      .pop()\n\n    expect(event1).toMatch(/\"i18nEnabled\": true/)\n    expect(event1).toMatch(/\"locales\": \"en,nl,fr\"/)\n    expect(event1).toMatch(/\"localeDomainsCount\": 2/)\n    expect(event1).toMatch(/\"localeDetectionEnabled\": true/)\n    expect(event1).toMatch(/\"imageEnabled\": true/)\n    expect(event1).toMatch(/\"imageFutureEnabled\": true/)\n    expect(event1).toMatch(/\"imageDomainsCount\": 2/)\n    expect(event1).toMatch(/\"imageRemotePatternsCount\": 1/)\n    expect(event1).toMatch(/\"imageSizes\": \"64,128,256,512,1024\"/)\n    expect(event1).toMatch(/\"imageFormats\": \"image\\/avif,image\\/webp\"/)\n    expect(event1).toMatch(/\"trailingSlashEnabled\": false/)\n    expect(event1).toMatch(/\"reactStrictMode\": false/)\n\n    await fs.rename(\n      path.join(appDir, 'next.config.i18n-images'),\n      path.join(appDir, 'next.config.js')\n    )\n\n    let stderr2 = ''\n\n    let app = await launchApp(appDir, await findPort(), {\n      onStderr(msg) {\n        stderr2 += msg || ''\n      },\n      env: {\n        NEXT_TELEMETRY_DEBUG: 1,\n      },\n    })\n    await waitFor(1000)\n    await killApp(app)\n\n    await fs.rename(\n      path.join(appDir, 'next.config.js'),\n      path.join(appDir, 'next.config.i18n-images')\n    )\n\n    const event2 = /NEXT_CLI_SESSION_STARTED[\\s\\S]+?{([\\s\\S]+?)}/\n      .exec(stderr2)\n      .pop()\n    expect(event2).toMatch(/\"i18nEnabled\": true/)\n    expect(event2).toMatch(/\"locales\": \"en,nl,fr\"/)\n    expect(event2).toMatch(/\"localeDomainsCount\": 2/)\n    expect(event2).toMatch(/\"localeDetectionEnabled\": true/)\n    expect(event2).toMatch(/\"imageDomainsCount\": 2/)\n    expect(event2).toMatch(/\"imageRemotePatternsCount\": 1/)\n    expect(event2).toMatch(/\"imageSizes\": \"64,128,256,512,1024\"/)\n    expect(event2).toMatch(/\"trailingSlashEnabled\": false/)\n    expect(event2).toMatch(/\"reactStrictMode\": false/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"emits telemetry for lint during build","suites":["Telemetry CLI"],"updatePoint":{"line":551,"column":43},"line":551,"code":"  it('emits telemetry for lint during build', async () => {\n    await fs.writeFile(\n      path.join(appDir, '.eslintrc'),\n      `{ \"root\": true, \"extends\": \"next\" }`\n    )\n    const { stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n      env: { NEXT_TELEMETRY_DEBUG: 1 },\n    })\n    await fs.remove(path.join(appDir, '.eslintrc'))\n\n    const event1 = /NEXT_LINT_CHECK_COMPLETED[\\s\\S]+?{([\\s\\S}]+?)^}/m\n      .exec(stderr)\n      .pop()\n\n    expect(event1).toMatch(/\"durationInSeconds\": [\\d]{1,}/)\n    expect(event1).toMatch(/\"eslintVersion\": \".*?\\..*?\\..*?\"/)\n    expect(event1).toMatch(/\"lintedFilesCount\": [\\d]{1,}/)\n    expect(event1).toMatch(/\"lintFix\": false/)\n    expect(event1).toMatch(/\"buildLint\": true/)\n    expect(event1).toMatch(/\"nextEslintPluginVersion\": \".*?\\..*?\\..*?\"/)\n    expect(event1).toMatch(/\"nextEslintPluginErrorsCount\": \\d{1,}/)\n    expect(event1).toMatch(/\"nextEslintPluginWarningsCount\": \\d{1,}/)\n    expect(event1).toMatch(`\"nextRulesEnabled\": {`)\n    expect(event1).toMatch(/\"@next\\/next\\/.+?\": \"(off|warn|error)\"/)\n\n    const featureUsageEvents = findAllEvents(stderr, 'NEXT_BUILD_FEATURE_USAGE')\n    expect(featureUsageEvents).toContainEqual({\n      featureName: 'build-lint',\n      invocationCount: 1,\n    })\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"emits telemetry for lint during build when '--no-lint' is specified","suites":["Telemetry CLI"],"updatePoint":{"line":584,"column":73},"line":584,"code":"  it(`emits telemetry for lint during build when '--no-lint' is specified`, async () => {\n    const { stderr } = await nextBuild(appDir, ['--no-lint'], {\n      stderr: true,\n      env: { NEXT_TELEMETRY_DEBUG: 1 },\n    })\n    const events = findAllEvents(stderr, 'NEXT_BUILD_FEATURE_USAGE')\n    expect(events).toContainEqual({\n      featureName: 'build-lint',\n      invocationCount: 0,\n    })\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"emits telemetry for lint during build when 'ignoreDuringBuilds' is specified","suites":["Telemetry CLI"],"updatePoint":{"line":596,"column":82},"line":596,"code":"  it(`emits telemetry for lint during build when 'ignoreDuringBuilds' is specified`, async () => {\n    const nextConfig = path.join(appDir, 'next.config.js')\n    await fs.writeFile(\n      nextConfig,\n      `module.exports = { eslint: { ignoreDuringBuilds: true } }`\n    )\n    const { stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n      env: { NEXT_TELEMETRY_DEBUG: 1 },\n    })\n    await fs.remove(nextConfig)\n\n    const events = findAllEvents(stderr, 'NEXT_BUILD_FEATURE_USAGE')\n    expect(events).toContainEqual({\n      featureName: 'build-lint',\n      invocationCount: 0,\n    })\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"emits telemetry for `next lint`","suites":["Telemetry CLI"],"updatePoint":{"line":615,"column":37},"line":615,"code":"  it('emits telemetry for `next lint`', async () => {\n    await fs.writeFile(\n      path.join(appDir, '.eslintrc'),\n      `{ \"root\": true, \"extends\": \"next\" }`\n    )\n    const { stderr } = await nextLint(appDir, [], {\n      stderr: true,\n      env: { NEXT_TELEMETRY_DEBUG: 1 },\n    })\n    await fs.remove(path.join(appDir, '.eslintrc'))\n\n    const event1 = /NEXT_LINT_CHECK_COMPLETED[\\s\\S]+?{([\\s\\S]+?)^}/m\n      .exec(stderr)\n      .pop()\n\n    expect(event1).toMatch(/\"durationInSeconds\": [\\d]{1,}/)\n    expect(event1).toMatch(/\"eslintVersion\": \".*?\\..*?\\..*?\"/)\n    expect(event1).toMatch(/\"lintedFilesCount\": [\\d]{1,}/)\n    expect(event1).toMatch(/\"lintFix\": false/)\n    expect(event1).toMatch(/\"buildLint\": false/)\n    expect(event1).toMatch(/\"nextEslintPluginVersion\": \".*?\\..*?\\..*?\"/)\n    expect(event1).toMatch(/\"nextEslintPluginErrorsCount\": \\d{1,}/)\n    expect(event1).toMatch(/\"nextEslintPluginWarningsCount\": \\d{1,}/)\n    expect(event1).toMatch(`\"nextRulesEnabled\": {`)\n    expect(event1).toMatch(/\"@next\\/next\\/.+?\": \"(off|warn|error)\"/)\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"emits telemery for usage of optimizeFonts, image, script & dynamic","suites":["Telemetry CLI"],"updatePoint":{"line":642,"column":72},"line":642,"code":"  it('emits telemery for usage of optimizeFonts, image, script & dynamic', async () => {\n    const { stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n      env: { NEXT_TELEMETRY_DEBUG: 1 },\n    })\n    const featureUsageEvents = findAllEvents(stderr, 'NEXT_BUILD_FEATURE_USAGE')\n    expect(featureUsageEvents).toEqual(\n      expect.arrayContaining([\n        {\n          featureName: 'optimizeFonts',\n          invocationCount: 1,\n        },\n        {\n          featureName: 'next/image',\n          invocationCount: 1,\n        },\n        {\n          featureName: 'next/script',\n          invocationCount: 1,\n        },\n        {\n          featureName: 'next/dynamic',\n          invocationCount: 1,\n        },\n      ])\n    )\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"emits telemetry for usage of swc","suites":["Telemetry CLI"],"updatePoint":{"line":670,"column":38},"line":670,"code":"  it('emits telemetry for usage of swc', async () => {\n    await fs.remove(path.join(appDir, 'next.config.js'))\n    await fs.remove(path.join(appDir, 'jsconfig.json'))\n    await fs.rename(\n      path.join(appDir, 'next.config.swc'),\n      path.join(appDir, 'next.config.js')\n    )\n    await fs.rename(\n      path.join(appDir, 'jsconfig.swc'),\n      path.join(appDir, 'jsconfig.json')\n    )\n    const { stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n      env: { NEXT_TELEMETRY_DEBUG: 1 },\n    })\n    await fs.remove(path.join(appDir, 'next.config.js'))\n    await fs.remove(path.join(appDir, 'jsconfig.json'))\n    const featureUsageEvents = findAllEvents(stderr, 'NEXT_BUILD_FEATURE_USAGE')\n    expect(featureUsageEvents).toEqual(\n      expect.arrayContaining([\n        {\n          featureName: 'swcLoader',\n          invocationCount: 1,\n        },\n        {\n          featureName: 'swcMinify',\n          invocationCount: 1,\n        },\n        {\n          featureName: 'swcRelay',\n          invocationCount: 1,\n        },\n        {\n          featureName: 'swcStyledComponents',\n          invocationCount: 1,\n        },\n        {\n          featureName: 'swcReactRemoveProperties',\n          invocationCount: 1,\n        },\n        {\n          featureName: 'swcExperimentalDecorators',\n          invocationCount: 1,\n        },\n        {\n          featureName: 'swcRemoveConsole',\n          invocationCount: 1,\n        },\n        {\n          featureName: 'swcImportSource',\n          invocationCount: 0,\n        },\n      ])\n    )\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"emits telemetry for usage of `optimizeCss`","suites":["Telemetry CLI"],"updatePoint":{"line":726,"column":48},"line":726,"code":"  it('emits telemetry for usage of `optimizeCss`', async () => {\n    await fs.rename(\n      path.join(appDir, 'next.config.optimize-css'),\n      path.join(appDir, 'next.config.js')\n    )\n\n    const { stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n      env: { NEXT_TELEMETRY_DEBUG: 1 },\n    })\n\n    await fs.rename(\n      path.join(appDir, 'next.config.js'),\n      path.join(appDir, 'next.config.optimize-css')\n    )\n\n    const events = findAllEvents(stderr, 'NEXT_BUILD_FEATURE_USAGE')\n    expect(events).toContainEqual({\n      featureName: 'experimental/optimizeCss',\n      invocationCount: 1,\n    })\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"emits telemetry for usage of `nextScriptWorkers`","suites":["Telemetry CLI"],"updatePoint":{"line":749,"column":54},"line":749,"code":"  it('emits telemetry for usage of `nextScriptWorkers`', async () => {\n    await fs.rename(\n      path.join(appDir, 'next.config.next-script-workers'),\n      path.join(appDir, 'next.config.js')\n    )\n\n    const { stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n      env: { NEXT_TELEMETRY_DEBUG: 1 },\n    })\n\n    await fs.rename(\n      path.join(appDir, 'next.config.js'),\n      path.join(appDir, 'next.config.next-script-workers')\n    )\n\n    const featureUsageEvents = findAllEvents(stderr, 'NEXT_BUILD_FEATURE_USAGE')\n    expect(featureUsageEvents).toContainEqual({\n      featureName: 'experimental/nextScriptWorkers',\n      invocationCount: 1,\n    })\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"emits telemetry for usage of middleware","suites":["Telemetry CLI"],"updatePoint":{"line":772,"column":45},"line":772,"code":"  it('emits telemetry for usage of middleware', async () => {\n    await fs.writeFile(\n      path.join(appDir, 'middleware.js'),\n      `export function middleware () { }`\n    )\n\n    const { stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n      env: { NEXT_TELEMETRY_DEBUG: 1 },\n    })\n\n    await fs.remove(path.join(appDir, 'middleware.js'))\n\n    const buildOptimizedEvents = findAllEvents(stderr, 'NEXT_BUILD_OPTIMIZED')\n    expect(buildOptimizedEvents).toContainEqual(\n      expect.objectContaining({\n        middlewareCount: 1,\n      })\n    )\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"emits telemetry for usage of swc plugins","suites":["Telemetry CLI"],"updatePoint":{"line":793,"column":46},"line":793,"code":"  it('emits telemetry for usage of swc plugins', async () => {\n    await fs.remove(path.join(appDir, 'next.config.js'))\n    await fs.remove(path.join(appDir, 'package.json'))\n\n    await fs.rename(\n      path.join(appDir, 'next.config.swc-plugins'),\n      path.join(appDir, 'next.config.js')\n    )\n\n    await fs.rename(\n      path.join(appDir, 'package.swc-plugins'),\n      path.join(appDir, 'package.json')\n    )\n\n    const { stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n      env: { NEXT_TELEMETRY_DEBUG: 1 },\n    })\n\n    await fs.rename(\n      path.join(appDir, 'next.config.js'),\n      path.join(appDir, 'next.config.swc-plugins')\n    )\n\n    await fs.rename(\n      path.join(appDir, 'package.json'),\n      path.join(appDir, 'package.swc-plugins')\n    )\n\n    const pluginDetectedEvents = findAllEvents(\n      stderr,\n      'NEXT_SWC_PLUGIN_DETECTED'\n    )\n    expect(pluginDetectedEvents).toEqual([\n      {\n        pluginName: 'swc-plugin-coverage-instrument',\n        pluginVersion: '0.0.6',\n      },\n      {\n        pluginName: '@swc/plugin-relay',\n        pluginVersion: '0.2.0',\n      },\n      {\n        pluginName: '/test/absolute_path/plugin.wasm',\n      },\n    ])\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"emits telemetry for usage of next/future/image","suites":["Telemetry CLI"],"updatePoint":{"line":841,"column":52},"line":841,"code":"  it('emits telemetry for usage of next/future/image', async () => {\n    const { stderr } = await nextBuild(appDir, [], {\n      stderr: true,\n      env: { NEXT_TELEMETRY_DEBUG: 1 },\n    })\n    const featureUsageEvents = findAllEvents(stderr, 'NEXT_BUILD_FEATURE_USAGE')\n    expect(featureUsageEvents).toContainEqual({\n      featureName: 'next/future/image',\n      invocationCount: 1,\n    })\n  })","file":"integration/telemetry/test/index.test.js","skipped":false,"dir":"test"},{"name":"supports trailing slash","suites":[],"updatePoint":{"line":19,"column":29},"line":19,"code":"  it('supports trailing slash', async () => {\n    // Make sure the page is built before getting the file\n    await renderViaHTTP(appPort, '/')\n    const file = getPageFileFromBuildManifest(appDir, '/')\n    const res = await fetchViaHTTP(appPort, join('/_next', file))\n\n    expect(res.status).toBe(200)\n  })","file":"integration/trailing-slash-dist/test/index.test.js","skipped":false,"dir":"test"},{"name":"should route to /blog/another/ correctly","suites":[],"updatePoint":{"line":19,"column":46},"line":19,"code":"  it('should route to /blog/another/ correctly', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.elementByCss('#to-blog-another').click()\n\n    await browser.waitForElementByCss('#another')\n    expect(await browser.elementByCss('#another').text()).toBe('blog another')\n  })","file":"integration/trailing-slashes-href-resolving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should route to /blog/first-post/ correctly","suites":[],"updatePoint":{"line":27,"column":49},"line":27,"code":"  it('should route to /blog/first-post/ correctly', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.elementByCss('#to-blog-post').click()\n\n    await browser.waitForElementByCss('#slug')\n    expect(await browser.elementByCss('#slug').text()).toBe(\n      'blog slug first-post'\n    )\n  })","file":"integration/trailing-slashes-href-resolving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should route to /catch-all/hello/world/ correctly","suites":[],"updatePoint":{"line":37,"column":55},"line":37,"code":"  it('should route to /catch-all/hello/world/ correctly', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.elementByCss('#to-catch-all-item').click()\n\n    await browser.waitForElementByCss('#slug')\n    expect(await browser.elementByCss('#slug').text()).toBe(\n      'catch-all slug hello/world'\n    )\n  })","file":"integration/trailing-slashes-href-resolving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should route to /catch-all/first/ correctly","suites":[],"updatePoint":{"line":47,"column":49},"line":47,"code":"  it('should route to /catch-all/first/ correctly', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.elementByCss('#to-catch-all-first').click()\n\n    await browser.waitForElementByCss('#first')\n    expect(await browser.elementByCss('#first').text()).toBe('catch-all first')\n  })","file":"integration/trailing-slashes-href-resolving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should route to /another/ correctly","suites":[],"updatePoint":{"line":55,"column":41},"line":55,"code":"  it('should route to /another/ correctly', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.elementByCss('#to-another').click()\n\n    await browser.waitForElementByCss('#another')\n    expect(await browser.elementByCss('#another').text()).toBe(\n      'top level another'\n    )\n  })","file":"integration/trailing-slashes-href-resolving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should route to /top-level-slug/ correctly","suites":[],"updatePoint":{"line":65,"column":48},"line":65,"code":"  it('should route to /top-level-slug/ correctly', async () => {\n    const browser = await webdriver(appPort, '/')\n    await browser.elementByCss('#to-slug').click()\n\n    await browser.waitForElementByCss('#slug')\n    expect(await browser.elementByCss('#slug').text()).toBe(\n      'top level slug top-level-slug'\n    )\n  })","file":"integration/trailing-slashes-href-resolving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should preload SSG routes correctly","suites":[],"updatePoint":{"line":76,"column":43},"line":76,"code":"    it('should preload SSG routes correctly', async () => {\n      const browser = await webdriver(appPort, '/')\n\n      await check(async () => {\n        const hrefs = await browser.eval(`Object.keys(window.next.router.sdc)`)\n        hrefs.sort()\n\n        assert.deepEqual(\n          hrefs.map((href) =>\n            new URL(href).pathname.replace(/^\\/_next\\/data\\/[^/]+/, '')\n          ),\n          ['/top-level-slug.json', '/world.json']\n        )\n        return 'yes'\n      }, 'yes')\n    })","file":"integration/trailing-slashes-href-resolving/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve index page correctly","suites":[],"updatePoint":{"line":22,"column":41},"line":22,"code":"  it('should resolve index page correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toContain('index page')\n  })","file":"integration/trailing-slashes-rewrite/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve products page correctly","suites":[],"updatePoint":{"line":27,"column":44},"line":27,"code":"  it('should resolve products page correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/products')\n    expect(html).toContain('some products')\n  })","file":"integration/trailing-slashes-rewrite/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve a dynamic page correctly","suites":[],"updatePoint":{"line":32,"column":45},"line":32,"code":"  it('should resolve a dynamic page correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/products/first')\n    expect(html).toContain('a product')\n  })","file":"integration/trailing-slashes-rewrite/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve a catch-all page correctly","suites":[],"updatePoint":{"line":37,"column":47},"line":37,"code":"  it('should resolve a catch-all page correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/catch-all/hello')\n    expect(html).toContain('catch-all')\n  })","file":"integration/trailing-slashes-rewrite/test/index.test.js","skipped":false,"dir":"test"},{"name":"should proxy non-existent page correctly","suites":[],"updatePoint":{"line":42,"column":46},"line":42,"code":"  it('should proxy non-existent page correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/non-existent')\n    expect(html).toBe('/non-existent')\n  })","file":"integration/trailing-slashes-rewrite/test/index.test.js","skipped":false,"dir":"test"},{"name":"%s should redirect to %s","suites":[],"line":25,"code":"  it.each(expectations)(\n    '%s should redirect to %s',\n    async (route, expectedLocation) => {\n      const res = await fetchViaHTTP(appPort, route, {}, { redirect: 'manual' })\n      expect(res.status).toBe(308)\n      const { pathname } = new URL(res.headers.get('location'))\n      expect(pathname).toBe(expectedLocation)\n    }\n  )","file":"integration/trailing-slashes/test/index.test.js","skipped":false,"dir":"test"},{"name":"%s should resolve to %s, with router path %s","suites":[],"line":37,"code":"  it.each(expectations)(\n    '%s should resolve to %s, with router path %s',\n    async (route, expectedPage, expectedRouterPath) => {\n      const res = await fetchViaHTTP(appPort, route, {}, { redirect: 'error' })\n      expect(res.status).toBe(200)\n      const $ = cheerio.load(await res.text())\n      expect($('#page-marker').text()).toBe(expectedPage)\n      expect($('#router-pathname').text()).toBe(expectedRouterPath)\n    }\n  )","file":"integration/trailing-slashes/test/index.test.js","skipped":false,"dir":"test"},{"name":"%s should client side render %s, with router path %s","suites":[],"line":48,"code":"  it.each(expectations)(\n    '%s should client side render %s, with router path %s',\n    async (route, expectedPage, expectedRouterPath) => {\n      let browser\n      try {\n        browser = await webdriver(appPort, route)\n\n        await browser.waitForElementByCss('#hydration-marker')\n        const text = await browser.elementByCss('#page-marker').text()\n        expect(text).toBe(expectedPage)\n        const routerPathname = await browser\n          .elementByCss('#router-pathname')\n          .text()\n        expect(routerPathname).toBe(expectedRouterPath)\n      } finally {\n        if (browser) await browser.close()\n      }\n    }\n  )","file":"integration/trailing-slashes/test/index.test.js","skipped":false,"dir":"test"},{"name":"%s should have href %s","suites":[],"line":70,"code":"  it.each(expectations)(\n    '%s should have href %s',\n    async (linkPage, expectedHref) => {\n      const content = await renderViaHTTP(appPort, linkPage)\n      const $ = cheerio.load(content)\n      expect($('#link').attr('href')).toBe(expectedHref)\n    }\n  )","file":"integration/trailing-slashes/test/index.test.js","skipped":false,"dir":"test"},{"name":"%s should have href %s","suites":[],"line":81,"code":"  it.each(expectations)(\n    '%s should have href %s',\n    async (linkPage, expectedHref) => {\n      const content = await renderViaHTTP(appPort, linkPage)\n      const $ = cheerio.load(content)\n      expect($('#link').attr('href')).toBe(expectedHref)\n    }\n  )","file":"integration/trailing-slashes/test/index.test.js","skipped":false,"dir":"test"},{"name":"%s should navigate to %s","suites":[],"line":90,"code":"  it.each(expectations)(\n    '%s should navigate to %s',\n    async (linkPage, expectedHref) => {\n      let browser\n      try {\n        browser = await webdriver(appPort, linkPage)\n        await browser.elementByCss('#link').click()\n\n        await browser.waitForElementByCss('#hydration-marker')\n        const url = new URL(await browser.eval('window.location.href'))\n        const pathname = url.href.slice(url.origin.length)\n        expect(pathname).toBe(expectedHref)\n      } finally {\n        if (browser) await browser.close()\n      }\n    }\n  )","file":"integration/trailing-slashes/test/index.test.js","skipped":false,"dir":"test"},{"name":"%s should push route to %s","suites":[],"line":108,"code":"  it.each(expectations)(\n    '%s should push route to %s',\n    async (linkPage, expectedHref) => {\n      let browser\n      try {\n        browser = await webdriver(appPort, linkPage)\n        await browser.elementByCss('#route-pusher').click()\n\n        await browser.waitForElementByCss('#hydration-marker')\n        const url = new URL(await browser.eval('window.location.href'))\n        const pathname = url.href.slice(url.origin.length)\n        expect(pathname).toBe(expectedHref)\n      } finally {\n        if (browser) await browser.close()\n      }\n    }\n  )","file":"integration/trailing-slashes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have a redirect in the routesmanifest","suites":["Trailing slashes","production mode, trailingSlash: false"],"updatePoint":{"line":252,"column":52},"line":252,"code":"    it('should have a redirect in the routesmanifest', async () => {\n      const manifest = await fs.readJSON(\n        join(appDir, '.next', 'routes-manifest.json')\n      )\n      expect(manifest).toEqual(\n        expect.objectContaining({\n          redirects: expect.arrayContaining([\n            expect.objectContaining({\n              source: '/:path+/',\n              destination: '/:path+',\n              statusCode: 308,\n            }),\n          ]),\n        })\n      )\n    })","file":"integration/trailing-slashes/test/index.test.js","skipped":false,"dir":"test"},{"name":"should have a redirect in the routesmanifest","suites":["Trailing slashes","production mode, trailingSlash: true"],"updatePoint":{"line":284,"column":52},"line":284,"code":"    it('should have a redirect in the routesmanifest', async () => {\n      const manifest = await fs.readJSON(\n        join(appDir, '.next', 'routes-manifest.json')\n      )\n      expect(manifest).toEqual(\n        expect.objectContaining({\n          redirects: expect.arrayContaining([\n            expect.objectContaining({\n              source:\n                '/:file((?!\\\\.well-known(?:/.*)?)(?:[^/]+/)*[^/]+\\\\.\\\\w+)/',\n              destination: '/:file',\n              statusCode: 308,\n            }),\n            expect.objectContaining({\n              source: '/:notfile((?!\\\\.well-known(?:/.*)?)(?:[^/]+/)*[^/\\\\.]+)',\n              destination: '/:notfile/',\n              statusCode: 308,\n            }),\n          ]),\n        })\n      )\n    })","file":"integration/trailing-slashes/test/index.test.js","skipped":false,"dir":"test"},{"name":"Creates a default tsconfig.json when one is missing","suites":["tsconfig.json verifier"],"updatePoint":{"line":22,"column":57},"line":22,"code":"  it('Creates a default tsconfig.json when one is missing', async () => {\n    expect(await exists(tsConfig)).toBe(false)\n    const { code } = await nextBuild(appDir)\n    expect(code).toBe(0)\n    expect(await readFile(tsConfig, 'utf8')).toMatchInlineSnapshot(`\n      \"{\n        \\\\\"compilerOptions\\\\\": {\n          \\\\\"target\\\\\": \\\\\"es5\\\\\",\n          \\\\\"lib\\\\\": [\n            \\\\\"dom\\\\\",\n            \\\\\"dom.iterable\\\\\",\n            \\\\\"esnext\\\\\"\n          ],\n          \\\\\"allowJs\\\\\": true,\n          \\\\\"skipLibCheck\\\\\": true,\n          \\\\\"strict\\\\\": false,\n          \\\\\"forceConsistentCasingInFileNames\\\\\": true,\n          \\\\\"noEmit\\\\\": true,\n          \\\\\"incremental\\\\\": true,\n          \\\\\"esModuleInterop\\\\\": true,\n          \\\\\"module\\\\\": \\\\\"esnext\\\\\",\n          \\\\\"moduleResolution\\\\\": \\\\\"node\\\\\",\n          \\\\\"resolveJsonModule\\\\\": true,\n          \\\\\"isolatedModules\\\\\": true,\n          \\\\\"jsx\\\\\": \\\\\"preserve\\\\\"\n        },\n        \\\\\"include\\\\\": [\n          \\\\\"next-env.d.ts\\\\\",\n          \\\\\"**/*.ts\\\\\",\n          \\\\\"**/*.tsx\\\\\"\n        ],\n        \\\\\"exclude\\\\\": [\n          \\\\\"node_modules\\\\\"\n        ]\n      }\n      \"\n    `)\n  })","file":"integration/tsconfig-verifier/test/index.test.js","skipped":false,"dir":"test"},{"name":"Works with an empty tsconfig.json (docs)","suites":["tsconfig.json verifier"],"updatePoint":{"line":61,"column":46},"line":61,"code":"  it('Works with an empty tsconfig.json (docs)', async () => {\n    expect(await exists(tsConfig)).toBe(false)\n\n    await createFile(tsConfig)\n    await new Promise((resolve) => setTimeout(resolve, 500))\n    expect(await readFile(tsConfig, 'utf8')).toBe('')\n\n    const { code, stderr, stdout } = await nextBuild(appDir, undefined, {\n      stderr: true,\n      stdout: true,\n    })\n    expect(stderr + stdout).not.toContain('moduleResolution')\n    expect(code).toBe(0)\n\n    expect(await readFile(tsConfig, 'utf8')).toMatchInlineSnapshot(`\n      \"{\n        \\\\\"compilerOptions\\\\\": {\n          \\\\\"target\\\\\": \\\\\"es5\\\\\",\n          \\\\\"lib\\\\\": [\n            \\\\\"dom\\\\\",\n            \\\\\"dom.iterable\\\\\",\n            \\\\\"esnext\\\\\"\n          ],\n          \\\\\"allowJs\\\\\": true,\n          \\\\\"skipLibCheck\\\\\": true,\n          \\\\\"strict\\\\\": false,\n          \\\\\"forceConsistentCasingInFileNames\\\\\": true,\n          \\\\\"noEmit\\\\\": true,\n          \\\\\"incremental\\\\\": true,\n          \\\\\"esModuleInterop\\\\\": true,\n          \\\\\"module\\\\\": \\\\\"esnext\\\\\",\n          \\\\\"moduleResolution\\\\\": \\\\\"node\\\\\",\n          \\\\\"resolveJsonModule\\\\\": true,\n          \\\\\"isolatedModules\\\\\": true,\n          \\\\\"jsx\\\\\": \\\\\"preserve\\\\\"\n        },\n        \\\\\"include\\\\\": [\n          \\\\\"next-env.d.ts\\\\\",\n          \\\\\"**/*.ts\\\\\",\n          \\\\\"**/*.tsx\\\\\"\n        ],\n        \\\\\"exclude\\\\\": [\n          \\\\\"node_modules\\\\\"\n        ]\n      }\n      \"\n    `)\n  })","file":"integration/tsconfig-verifier/test/index.test.js","skipped":false,"dir":"test"},{"name":"Updates an existing tsconfig.json without losing comments","suites":["tsconfig.json verifier"],"updatePoint":{"line":110,"column":63},"line":110,"code":"  it('Updates an existing tsconfig.json without losing comments', async () => {\n    expect(await exists(tsConfig)).toBe(false)\n\n    await writeFile(\n      tsConfig,\n      `\n      // top-level comment\n      {\n        // in-object comment 1\n        \"compilerOptions\": {\n          // in-object comment\n          \"esModuleInterop\": false, // this should be true\n          \"module\": \"umd\" // should not be umd\n          // end-object comment\n        }\n        // in-object comment 2\n      }\n      // end comment\n      `\n    )\n    await new Promise((resolve) => setTimeout(resolve, 500))\n    const { code } = await nextBuild(appDir)\n    expect(code).toBe(0)\n\n    // Weird comma placement until this issue is resolved:\n    // https://github.com/kaelzhang/node-comment-json/issues/21\n    expect(await readFile(tsConfig, 'utf8')).toMatchInlineSnapshot(`\n      \"// top-level comment\n      {\n        // in-object comment 1\n        \\\\\"compilerOptions\\\\\": {\n          // in-object comment\n          \\\\\"esModuleInterop\\\\\": true, // this should be true\n          \\\\\"module\\\\\": \\\\\"esnext\\\\\" // should not be umd\n          // end-object comment\n          ,\n          \\\\\"target\\\\\": \\\\\"es5\\\\\",\n          \\\\\"lib\\\\\": [\n            \\\\\"dom\\\\\",\n            \\\\\"dom.iterable\\\\\",\n            \\\\\"esnext\\\\\"\n          ],\n          \\\\\"allowJs\\\\\": true,\n          \\\\\"skipLibCheck\\\\\": true,\n          \\\\\"strict\\\\\": false,\n          \\\\\"forceConsistentCasingInFileNames\\\\\": true,\n          \\\\\"noEmit\\\\\": true,\n          \\\\\"incremental\\\\\": true,\n          \\\\\"moduleResolution\\\\\": \\\\\"node\\\\\",\n          \\\\\"resolveJsonModule\\\\\": true,\n          \\\\\"isolatedModules\\\\\": true,\n          \\\\\"jsx\\\\\": \\\\\"preserve\\\\\"\n        }\n        // in-object comment 2\n        ,\n        \\\\\"include\\\\\": [\n          \\\\\"next-env.d.ts\\\\\",\n          \\\\\"**/*.ts\\\\\",\n          \\\\\"**/*.tsx\\\\\"\n        ],\n        \\\\\"exclude\\\\\": [\n          \\\\\"node_modules\\\\\"\n        ]\n      }\n      // end comment\n      \"\n    `)\n  })","file":"integration/tsconfig-verifier/test/index.test.js","skipped":false,"dir":"test"},{"name":"allows you to set commonjs module mode","suites":["tsconfig.json verifier"],"updatePoint":{"line":179,"column":44},"line":179,"code":"  it('allows you to set commonjs module mode', async () => {\n    expect(await exists(tsConfig)).toBe(false)\n\n    await writeFile(\n      tsConfig,\n      `{ \"compilerOptions\": { \"esModuleInterop\": false, \"module\": \"commonjs\" } }`\n    )\n    await new Promise((resolve) => setTimeout(resolve, 500))\n    const { code } = await nextBuild(appDir)\n    expect(code).toBe(0)\n\n    expect(await readFile(tsConfig, 'utf8')).toMatchInlineSnapshot(`\n      \"{\n        \\\\\"compilerOptions\\\\\": {\n          \\\\\"esModuleInterop\\\\\": true,\n          \\\\\"module\\\\\": \\\\\"commonjs\\\\\",\n          \\\\\"target\\\\\": \\\\\"es5\\\\\",\n          \\\\\"lib\\\\\": [\n            \\\\\"dom\\\\\",\n            \\\\\"dom.iterable\\\\\",\n            \\\\\"esnext\\\\\"\n          ],\n          \\\\\"allowJs\\\\\": true,\n          \\\\\"skipLibCheck\\\\\": true,\n          \\\\\"strict\\\\\": false,\n          \\\\\"forceConsistentCasingInFileNames\\\\\": true,\n          \\\\\"noEmit\\\\\": true,\n          \\\\\"incremental\\\\\": true,\n          \\\\\"moduleResolution\\\\\": \\\\\"node\\\\\",\n          \\\\\"resolveJsonModule\\\\\": true,\n          \\\\\"isolatedModules\\\\\": true,\n          \\\\\"jsx\\\\\": \\\\\"preserve\\\\\"\n        },\n        \\\\\"include\\\\\": [\n          \\\\\"next-env.d.ts\\\\\",\n          \\\\\"**/*.ts\\\\\",\n          \\\\\"**/*.tsx\\\\\"\n        ],\n        \\\\\"exclude\\\\\": [\n          \\\\\"node_modules\\\\\"\n        ]\n      }\n      \"\n    `)\n  })","file":"integration/tsconfig-verifier/test/index.test.js","skipped":false,"dir":"test"},{"name":"allows you to set es2020 module mode","suites":["tsconfig.json verifier"],"updatePoint":{"line":225,"column":42},"line":225,"code":"  it('allows you to set es2020 module mode', async () => {\n    expect(await exists(tsConfig)).toBe(false)\n\n    await writeFile(\n      tsConfig,\n      `{ \"compilerOptions\": { \"esModuleInterop\": false, \"module\": \"es2020\" } }`\n    )\n    await new Promise((resolve) => setTimeout(resolve, 500))\n    const { code } = await nextBuild(appDir)\n    expect(code).toBe(0)\n\n    expect(await readFile(tsConfig, 'utf8')).toMatchInlineSnapshot(`\n      \"{\n        \\\\\"compilerOptions\\\\\": {\n          \\\\\"esModuleInterop\\\\\": true,\n          \\\\\"module\\\\\": \\\\\"es2020\\\\\",\n          \\\\\"target\\\\\": \\\\\"es5\\\\\",\n          \\\\\"lib\\\\\": [\n            \\\\\"dom\\\\\",\n            \\\\\"dom.iterable\\\\\",\n            \\\\\"esnext\\\\\"\n          ],\n          \\\\\"allowJs\\\\\": true,\n          \\\\\"skipLibCheck\\\\\": true,\n          \\\\\"strict\\\\\": false,\n          \\\\\"forceConsistentCasingInFileNames\\\\\": true,\n          \\\\\"noEmit\\\\\": true,\n          \\\\\"incremental\\\\\": true,\n          \\\\\"moduleResolution\\\\\": \\\\\"node\\\\\",\n          \\\\\"resolveJsonModule\\\\\": true,\n          \\\\\"isolatedModules\\\\\": true,\n          \\\\\"jsx\\\\\": \\\\\"preserve\\\\\"\n        },\n        \\\\\"include\\\\\": [\n          \\\\\"next-env.d.ts\\\\\",\n          \\\\\"**/*.ts\\\\\",\n          \\\\\"**/*.tsx\\\\\"\n        ],\n        \\\\\"exclude\\\\\": [\n          \\\\\"node_modules\\\\\"\n        ]\n      }\n      \"\n    `)\n  })","file":"integration/tsconfig-verifier/test/index.test.js","skipped":false,"dir":"test"},{"name":"allows you to set node16 moduleResolution mode","suites":["tsconfig.json verifier"],"updatePoint":{"line":271,"column":52},"line":271,"code":"  it('allows you to set node16 moduleResolution mode', async () => {\n    expect(await exists(tsConfig)).toBe(false)\n\n    await writeFile(\n      tsConfig,\n      `{ \"compilerOptions\": { \"esModuleInterop\": false, \"moduleResolution\": \"node16\" } }`\n    )\n    await new Promise((resolve) => setTimeout(resolve, 500))\n    const { code, stderr, stdout } = await nextBuild(appDir, undefined, {\n      stderr: true,\n      stdout: true,\n    })\n    expect(stderr + stdout).not.toContain('moduleResolution')\n    expect(code).toBe(0)\n\n    expect(await readFile(tsConfig, 'utf8')).toMatchInlineSnapshot(`\n      \"{\n        \\\\\"compilerOptions\\\\\": {\n          \\\\\"esModuleInterop\\\\\": true,\n          \\\\\"moduleResolution\\\\\": \\\\\"node16\\\\\",\n          \\\\\"target\\\\\": \\\\\"es5\\\\\",\n          \\\\\"lib\\\\\": [\n            \\\\\"dom\\\\\",\n            \\\\\"dom.iterable\\\\\",\n            \\\\\"esnext\\\\\"\n          ],\n          \\\\\"allowJs\\\\\": true,\n          \\\\\"skipLibCheck\\\\\": true,\n          \\\\\"strict\\\\\": false,\n          \\\\\"forceConsistentCasingInFileNames\\\\\": true,\n          \\\\\"noEmit\\\\\": true,\n          \\\\\"incremental\\\\\": true,\n          \\\\\"module\\\\\": \\\\\"esnext\\\\\",\n          \\\\\"resolveJsonModule\\\\\": true,\n          \\\\\"isolatedModules\\\\\": true,\n          \\\\\"jsx\\\\\": \\\\\"preserve\\\\\"\n        },\n        \\\\\"include\\\\\": [\n          \\\\\"next-env.d.ts\\\\\",\n          \\\\\"**/*.ts\\\\\",\n          \\\\\"**/*.tsx\\\\\"\n        ],\n        \\\\\"exclude\\\\\": [\n          \\\\\"node_modules\\\\\"\n        ]\n      }\n      \"\n    `)\n  })","file":"integration/tsconfig-verifier/test/index.test.js","skipped":false,"dir":"test"},{"name":"allows you to extend another configuration file","suites":["tsconfig.json verifier"],"updatePoint":{"line":321,"column":53},"line":321,"code":"  it('allows you to extend another configuration file', async () => {\n    expect(await exists(tsConfig)).toBe(false)\n    expect(await exists(tsConfigBase)).toBe(false)\n\n    await writeFile(\n      tsConfigBase,\n      `\n      {\n        \"compilerOptions\": {\n          \"target\": \"es5\",\n          \"lib\": [\n            \"dom\",\n            \"dom.iterable\",\n            \"esnext\"\n          ],\n          \"allowJs\": true,\n          \"skipLibCheck\": true,\n          \"strict\": false,\n          \"forceConsistentCasingInFileNames\": true,\n          \"noEmit\": true,\n          \"incremental\": true,\n          \"esModuleInterop\": true,\n          \"module\": \"esnext\",\n          \"moduleResolution\": \"node\",\n          \"resolveJsonModule\": true,\n          \"isolatedModules\": true,\n          \"jsx\": \"preserve\"\n        },\n        \"include\": [\n          \"next-env.d.ts\",\n          \"**/*.ts\",\n          \"**/*.tsx\"\n        ],\n        \"exclude\": [\n          \"node_modules\"\n        ]\n      }\n      `\n    )\n    await new Promise((resolve) => setTimeout(resolve, 500))\n\n    await writeFile(tsConfig, `{ \"extends\": \"./tsconfig.base.json\" }`)\n    await new Promise((resolve) => setTimeout(resolve, 500))\n\n    const { code, stderr, stdout } = await nextBuild(appDir, undefined, {\n      stderr: true,\n      stdout: true,\n    })\n    expect(stderr + stdout).not.toContain('moduleResolution')\n    expect(code).toBe(0)\n\n    expect(await readFile(tsConfig, 'utf8')).toMatchInlineSnapshot(\n      `\"{ \\\\\"extends\\\\\": \\\\\"./tsconfig.base.json\\\\\" }\"`\n    )\n  })","file":"integration/tsconfig-verifier/test/index.test.js","skipped":false,"dir":"test"},{"name":"creates compilerOptions when you extend another config","suites":["tsconfig.json verifier"],"updatePoint":{"line":377,"column":60},"line":377,"code":"  it('creates compilerOptions when you extend another config', async () => {\n    expect(await exists(tsConfig)).toBe(false)\n    expect(await exists(tsConfigBase)).toBe(false)\n\n    await writeFile(\n      tsConfigBase,\n      `\n      {\n        \"compilerOptions\": {\n          \"target\": \"es5\",\n          \"lib\": [\n            \"dom\",\n            \"dom.iterable\",\n            \"esnext\"\n          ],\n          \"allowJs\": true,\n          \"skipLibCheck\": true,\n          \"strict\": false,\n          \"forceConsistentCasingInFileNames\": true,\n          \"noEmit\": true,\n          \"esModuleInterop\": true,\n          \"module\": \"esnext\",\n          \"moduleResolution\": \"node\",\n          \"resolveJsonModule\": true,\n          \"isolatedModules\": true,\n          \"jsx\": \"preserve\"\n        },\n        \"include\": [\n          \"next-env.d.ts\",\n          \"**/*.ts\",\n          \"**/*.tsx\"\n        ],\n        \"exclude\": [\n          \"node_modules\"\n        ]\n      }\n      `\n    )\n    await new Promise((resolve) => setTimeout(resolve, 500))\n\n    await writeFile(tsConfig, `{ \"extends\": \"./tsconfig.base.json\" }`)\n    await new Promise((resolve) => setTimeout(resolve, 500))\n\n    const { code, stderr, stdout } = await nextBuild(appDir, undefined, {\n      stderr: true,\n      stdout: true,\n    })\n    expect(stderr + stdout).not.toContain('moduleResolution')\n    expect(code).toBe(0)\n\n    expect(await readFile(tsConfig, 'utf8')).toMatchInlineSnapshot(`\n      \"{\n        \\\\\"extends\\\\\": \\\\\"./tsconfig.base.json\\\\\",\n        \\\\\"compilerOptions\\\\\": {\n          \\\\\"incremental\\\\\": true\n        }\n      }\n      \"\n    `)\n  })","file":"integration/tsconfig-verifier/test/index.test.js","skipped":false,"dir":"test"},{"name":"Replaces `typeof window` with object for client code","suites":["typeof window replace"],"updatePoint":{"line":24,"column":58},"line":24,"code":"  it('Replaces `typeof window` with object for client code', async () => {\n    const pageFile = buildManifest.pages['/'].find(\n      (file) => file.endsWith('.js') && file.includes('pages/index')\n    )\n\n    const content = await fs.readFile(\n      path.join(appDir, '.next', pageFile),\n      'utf8'\n    )\n    expect(content).toMatch(/Hello.*?,.*?\\n?.*?(\"|')object(\"|')/)\n  })","file":"integration/typeof-window-replace/test/index.test.js","skipped":false,"dir":"test"},{"name":"Replaces `typeof window` with undefined for server code","suites":["typeof window replace"],"updatePoint":{"line":36,"column":61},"line":36,"code":"  it('Replaces `typeof window` with undefined for server code', async () => {\n    const pageFile = pagesManifest['/']\n\n    const content = await fs.readFile(\n      path.join(appDir, '.next', 'server', pageFile),\n      'utf8'\n    )\n\n    expect(content).toMatch(/Hello.*?,.*?\\n?.*?(\"|')undefined(\"|')/)\n  })","file":"integration/typeof-window-replace/test/index.test.js","skipped":false,"dir":"test"},{"name":"Does not replace `typeof window` for `node_modules` code","suites":["typeof window replace"],"updatePoint":{"line":47,"column":62},"line":47,"code":"  it('Does not replace `typeof window` for `node_modules` code', async () => {\n    const pageFile = buildManifest.pages['/'].find(\n      (file) => file.endsWith('.js') && file.includes('pages/index')\n    )\n\n    const content = await fs.readFile(\n      path.join(appDir, '.next', pageFile),\n      'utf8'\n    )\n    expect(content).toMatch(/MyComp:.*?,.*?typeof window/)\n  })","file":"integration/typeof-window-replace/test/index.test.js","skipped":false,"dir":"test"},{"name":"should write a new next-env.d.ts if none exist","suites":["TypeScript App Type Declarations"],"updatePoint":{"line":11,"column":52},"line":11,"code":"  it('should write a new next-env.d.ts if none exist', async () => {\n    const prevContent = await fs.readFile(appTypeDeclarations, 'utf8')\n    try {\n      await fs.unlink(appTypeDeclarations)\n      const appPort = await findPort()\n      let app\n      try {\n        app = await launchApp(appDir, appPort, {})\n        const content = await fs.readFile(appTypeDeclarations, 'utf8')\n        expect(content).toEqual(prevContent)\n      } finally {\n        await killApp(app)\n      }\n    } finally {\n      await fs.writeFile(appTypeDeclarations, prevContent)\n    }\n  })","file":"integration/typescript-app-type-declarations/test/index.test.js","skipped":false,"dir":"test"},{"name":"should overwrite next-env.d.ts if an incorrect one exists","suites":["TypeScript App Type Declarations"],"updatePoint":{"line":29,"column":63},"line":29,"code":"  it('should overwrite next-env.d.ts if an incorrect one exists', async () => {\n    const prevContent = await fs.readFile(appTypeDeclarations, 'utf8')\n    try {\n      await fs.writeFile(appTypeDeclarations, prevContent + 'modification')\n      const appPort = await findPort()\n      let app\n      try {\n        app = await launchApp(appDir, appPort, {})\n        const content = await fs.readFile(appTypeDeclarations, 'utf8')\n        expect(content).toEqual(prevContent)\n      } finally {\n        await killApp(app)\n      }\n    } finally {\n      await fs.writeFile(appTypeDeclarations, prevContent)\n    }\n  })","file":"integration/typescript-app-type-declarations/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not touch an existing correct next-env.d.ts","suites":["TypeScript App Type Declarations"],"updatePoint":{"line":47,"column":56},"line":47,"code":"  it('should not touch an existing correct next-env.d.ts', async () => {\n    const prevStat = await fs.stat(appTypeDeclarations)\n    const appPort = await findPort()\n    let app\n    try {\n      app = await launchApp(appDir, appPort, {})\n      const stat = await fs.stat(appTypeDeclarations)\n      expect(stat.mtime).toEqual(prevStat.mtime)\n    } finally {\n      await killApp(app)\n    }\n  })","file":"integration/typescript-app-type-declarations/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page","suites":["TypeScript Features","default behavior"],"updatePoint":{"line":24,"column":30},"line":24,"code":"    it('should render the page', async () => {\n      const $ = await get$('/hello')\n      expect($('body').text()).toMatch(/World/)\n    })","file":"integration/typescript-baseurl/test/index.test.js","skipped":false,"dir":"test"},{"name":"should warn when using custom typescript path","suites":["Custom TypeScript Config"],"updatePoint":{"line":11,"column":51},"line":11,"code":"  it('should warn when using custom typescript path', async () => {\n    const { stdout } = await nextBuild(appDir, [], {\n      stdout: true,\n    })\n\n    expect(stdout).toMatch(warnMessage)\n  })","file":"integration/typescript-custom-tsconfig/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page with external TS/TSX dependencies","suites":["TypeScript Features","default behavior"],"updatePoint":{"line":24,"column":64},"line":24,"code":"    it('should render the page with external TS/TSX dependencies', async () => {\n      const $ = await get$('/')\n      expect($('body').text()).toMatch(/Hello World!Counter: 0/)\n    })","file":"integration/typescript-external-dir/project/test/index.test.js","skipped":false,"dir":"test"},{"name":"should fail to build the app with a file named con*test*.js","suites":["TypeScript filtered files"],"updatePoint":{"line":8,"column":65},"line":8,"code":"  it('should fail to build the app with a file named con*test*.js', async () => {\n    const output = await nextBuild(appDir, [], { stdout: true, stderr: true })\n    expect(output.stdout).not.toMatch(/Compiled successfully/)\n    expect(output.code).toBe(1)\n    expect(output.stderr).toMatch(/Failed to compile/)\n    expect(output.stderr).toMatch(/is not assignable to type 'boolean'/)\n  })","file":"integration/typescript-filtered-files/test/index.test.js","skipped":false,"dir":"test"},{"name":"should detect the changes to typescript pages and display it","suites":["TypeScript HMR","delete a page and add it back"],"updatePoint":{"line":35,"column":68},"line":35,"code":"    it('should detect the changes to typescript pages and display it', async () => {\n      let browser\n      try {\n        browser = await webdriver(appPort, '/hello')\n        await check(() => getBrowserBodyText(browser), /Hello World/)\n\n        const pagePath = join(appDir, 'pages/hello.tsx')\n        const originalContent = await fs.readFile(pagePath, 'utf8')\n        const editedContent = originalContent.replace('Hello', 'COOL page')\n\n        // change the content\n        await fs.writeFile(pagePath, editedContent, 'utf8')\n        await check(() => getBrowserBodyText(browser), /COOL page/)\n\n        // add the original content\n        await fs.writeFile(pagePath, originalContent, 'utf8')\n        await check(() => getBrowserBodyText(browser), /Hello World/)\n      } finally {\n        if (browser) {\n          await browser.close()\n        }\n      }\n    })","file":"integration/typescript-hmr/test/index.test.js","skipped":false,"dir":"test"},{"name":"should recover from a type error","suites":["TypeScript HMR","delete a page and add it back"],"line":61,"code":"  it.skip('should recover from a type error', async () => {","file":"integration/typescript-hmr/test/index.test.js","skipped":true,"dir":"test"},{"name":"should ignore type errors in development","suites":["TypeScript HMR","delete a page and add it back"],"updatePoint":{"line":86,"column":46},"line":86,"code":"  it('should ignore type errors in development', async () => {\n    let browser\n    const pagePath = join(appDir, 'pages/type-error-recover.tsx')\n    const origContent = await fs.readFile(pagePath, 'utf8')\n    try {\n      browser = await webdriver(appPort, '/type-error-recover')\n      const errContent = origContent.replace(\n        '() => <p>Hello world</p>',\n        '(): boolean => <p>hello with error</p>'\n      )\n      await fs.writeFile(pagePath, errContent)\n      const res = await check(\n        async () => {\n          const html = await browser.eval(\n            'document.querySelector(\"p\").innerText'\n          )\n          return html.match(/hello with error/) ? 'success' : 'fail'\n        },\n        /success/,\n        false\n      )\n\n      expect(res).toBe(true)\n    } finally {\n      if (browser) browser.close()\n      await fs.writeFile(pagePath, origContent)\n    }\n  })","file":"integration/typescript-hmr/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render a normal page correctly","suites":[],"updatePoint":{"line":18,"column":43},"line":18,"code":"  it('should render a normal page correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/normal')\n    expect(html).toContain('A normal one')\n  })","file":"integration/typescript-only-remove-type-imports/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render a page with type import correctly","suites":[],"updatePoint":{"line":23,"column":53},"line":23,"code":"  it('should render a page with type import correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html).toContain('anton')\n    expect(html).toContain('berta')\n  })","file":"integration/typescript-only-remove-type-imports/test/index.test.js","skipped":false,"dir":"test"},{"name":"should alias components","suites":["default behavior"],"updatePoint":{"line":32,"column":31},"line":32,"code":"    it('should alias components', async () => {\n      const $ = await get$('/basic-alias')\n      expect($('body').text()).toMatch(/World/)\n    })","file":"integration/typescript-paths/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve the first item in the array first","suites":["default behavior"],"updatePoint":{"line":37,"column":56},"line":37,"code":"    it('should resolve the first item in the array first', async () => {\n      const $ = await get$('/resolve-order')\n      expect($('body').text()).toMatch(/Hello from a/)\n    })","file":"integration/typescript-paths/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve the second item in as a fallback","suites":["default behavior"],"updatePoint":{"line":42,"column":55},"line":42,"code":"    it('should resolve the second item in as a fallback', async () => {\n      const $ = await get$('/resolve-fallback')\n      expect($('body').text()).toMatch(/Hello from only b/)\n    })","file":"integration/typescript-paths/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve a single matching alias","suites":["default behavior"],"updatePoint":{"line":47,"column":46},"line":47,"code":"    it('should resolve a single matching alias', async () => {\n      const $ = await get$('/single-alias')\n      expect($('body').text()).toMatch(/Hello/)\n    })","file":"integration/typescript-paths/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not resolve to .d.ts files","suites":["default behavior"],"updatePoint":{"line":52,"column":41},"line":52,"code":"    it('should not resolve to .d.ts files', async () => {\n      const $ = await get$('/alias-to-d-ts')\n      expect($('body').text()).toMatch(/Not aliased to d\\.ts file/)\n    })","file":"integration/typescript-paths/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show warning during next build with old version","suites":["Minimum TypeScript Warning"],"updatePoint":{"line":10,"column":60},"line":10,"code":"  it('should show warning during next build with old version', async () => {\n    const res = await nextBuild(appDir, [], {\n      stderr: true,\n      stdout: true,\n    })\n    expect(res.stdout + res.stderr).toContain(\n      'Minimum recommended TypeScript version is'\n    )\n  })","file":"integration/typescript-version-warning/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show warning during next dev with old version","suites":["Minimum TypeScript Warning"],"updatePoint":{"line":20,"column":58},"line":20,"code":"  it('should show warning during next dev with old version', async () => {\n    let output = ''\n\n    const handleOutput = (msg) => {\n      output += msg\n    }\n    const app = await launchApp(appDir, await findPort(), {\n      onStdout: handleOutput,\n      onStderr: handleOutput,\n    })\n    await killApp(app)\n\n    expect(output).toContain('Minimum recommended TypeScript version is')\n  })","file":"integration/typescript-version-warning/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show warning during next build with new version","suites":["Minimum TypeScript Warning"],"updatePoint":{"line":35,"column":64},"line":35,"code":"  it('should not show warning during next build with new version', async () => {\n    const content = await fs.readFile(tsFile, 'utf8')\n    await fs.writeFile(tsFile, content.replace('3.8.3', '4.3.4'))\n    const res = await nextBuild(appDir, [], {\n      stderr: true,\n      stdout: true,\n    })\n    await fs.writeFile(tsFile, content)\n\n    expect(res.stdout + res.stderr).not.toContain(\n      'Minimum recommended TypeScript version is'\n    )\n  })","file":"integration/typescript-version-warning/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not show warning during next dev with new version","suites":["Minimum TypeScript Warning"],"updatePoint":{"line":49,"column":62},"line":49,"code":"  it('should not show warning during next dev with new version', async () => {\n    let output = ''\n\n    const handleOutput = (msg) => {\n      output += msg\n    }\n    const content = await fs.readFile(tsFile, 'utf8')\n    await fs.writeFile(tsFile, content.replace('3.8.3', '4.3.4'))\n    const app = await launchApp(appDir, await findPort(), {\n      onStdout: handleOutput,\n      onStderr: handleOutput,\n    })\n    await fs.writeFile(tsFile, content)\n    await killApp(app)\n\n    expect(output).not.toContain('Minimum recommended TypeScript version is')\n  })","file":"integration/typescript-version-warning/test/index.test.js","skipped":false,"dir":"test"},{"name":"should alias components","suites":["TypeScript Features","default behavior"],"updatePoint":{"line":24,"column":31},"line":24,"code":"    it('should alias components', async () => {\n      const $ = await get$('/basic-alias')\n      expect($('body').text()).toMatch(/World/)\n    })","file":"integration/typescript-workspaces-paths/packages/www/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve the first item in the array first","suites":["TypeScript Features","default behavior"],"updatePoint":{"line":29,"column":56},"line":29,"code":"    it('should resolve the first item in the array first', async () => {\n      const $ = await get$('/resolve-order')\n      expect($('body').text()).toMatch(/Hello from a/)\n    })","file":"integration/typescript-workspaces-paths/packages/www/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve the second item in as a fallback","suites":["TypeScript Features","default behavior"],"updatePoint":{"line":34,"column":55},"line":34,"code":"    it('should resolve the second item in as a fallback', async () => {\n      const $ = await get$('/resolve-fallback')\n      expect($('body').text()).toMatch(/Hello from only b/)\n    })","file":"integration/typescript-workspaces-paths/packages/www/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve a single matching alias","suites":["TypeScript Features","default behavior"],"updatePoint":{"line":39,"column":46},"line":39,"code":"    it('should resolve a single matching alias', async () => {\n      const $ = await get$('/single-alias')\n      expect($('body').text()).toMatch(/Hello/)\n    })","file":"integration/typescript-workspaces-paths/packages/www/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not resolve to .d.ts files","suites":["TypeScript Features","default behavior"],"updatePoint":{"line":44,"column":41},"line":44,"code":"    it('should not resolve to .d.ts files', async () => {\n      const $ = await get$('/alias-to-d-ts')\n      expect($('body').text()).toMatch(/Not aliased to d\\.ts file/)\n    })","file":"integration/typescript-workspaces-paths/packages/www/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the page","suites":["TypeScript Features","default behavior"],"updatePoint":{"line":41,"column":30},"line":41,"code":"    it('should render the page', async () => {\n      const $ = await get$('/hello')\n      expect($('body').text()).toMatch(/Hello World/)\n      expect($('body').text()).toMatch(/1000000000000/)\n    })","file":"integration/typescript/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the cookies page","suites":["TypeScript Features","default behavior"],"updatePoint":{"line":47,"column":38},"line":47,"code":"    it('should render the cookies page', async () => {\n      const $ = await get$('/ssr/cookies')\n      expect($('#cookies').text()).toBe('{}')\n    })","file":"integration/typescript/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the generics page","suites":["TypeScript Features","default behavior"],"updatePoint":{"line":52,"column":39},"line":52,"code":"    it('should render the generics page', async () => {\n      const $ = await get$('/generics')\n      expect($('#value').text()).toBe('Hello World from Generic')\n    })","file":"integration/typescript/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the angle bracket type assertions page","suites":["TypeScript Features","default behavior"],"updatePoint":{"line":57,"column":60},"line":57,"code":"    it('should render the angle bracket type assertions page', async () => {\n      const $ = await get$('/angle-bracket-type-assertions')\n      expect($('#value').text()).toBe('test')\n    })","file":"integration/typescript/test/index.test.js","skipped":false,"dir":"test"},{"name":"should resolve files in correct order","suites":["TypeScript Features","default behavior"],"updatePoint":{"line":62,"column":45},"line":62,"code":"    it('should resolve files in correct order', async () => {\n      const $ = await get$('/hello')\n      expect($('#imported-value').text()).toBe('OK')\n    })","file":"integration/typescript/test/index.test.js","skipped":false,"dir":"test"},{"name":"should report type checking to stdout","suites":["TypeScript Features","default behavior"],"line":68,"code":"    it.skip('should report type checking to stdout', async () => {","file":"integration/typescript/test/index.test.js","skipped":true,"dir":"test"},{"name":"should respond to sync API route correctly","suites":["TypeScript Features","default behavior"],"updatePoint":{"line":72,"column":50},"line":72,"code":"    it('should respond to sync API route correctly', async () => {\n      const data = JSON.parse(await renderViaHTTP(appPort, '/api/sync'))\n      expect(data).toEqual({ code: 'ok' })\n    })","file":"integration/typescript/test/index.test.js","skipped":false,"dir":"test"},{"name":"should respond to async API route correctly","suites":["TypeScript Features","default behavior"],"updatePoint":{"line":77,"column":51},"line":77,"code":"    it('should respond to async API route correctly', async () => {\n      const data = JSON.parse(await renderViaHTTP(appPort, '/api/async'))\n      expect(data).toEqual({ code: 'ok' })\n    })","file":"integration/typescript/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not fail to render when an inactive page has an error","suites":["TypeScript Features","default behavior"],"updatePoint":{"line":82,"column":68},"line":82,"code":"    it('should not fail to render when an inactive page has an error', async () => {\n      await killApp(app)\n      let evilFile = join(appDir, 'pages', 'evil.tsx')\n      try {\n        await writeFile(\n          evilFile,\n          `import React from 'react'\n\nexport default function EvilPage(): JSX.Element {\n  return <div notARealProp />\n}\n`\n        )\n        app = await launchApp(appDir, appPort)\n\n        const $ = await get$('/hello')\n        expect($('body').text()).toMatch(/Hello World/)\n      } finally {\n        await remove(evilFile)\n      }\n    })","file":"integration/typescript/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build the app","suites":["TypeScript Features","default behavior"],"updatePoint":{"line":105,"column":26},"line":105,"code":"  it('should build the app', async () => {\n    const output = await nextBuild(appDir, [], { stdout: true })\n    expect(output.stdout).toMatch(/Compiled successfully/)\n    expect(output.code).toBe(0)\n  })","file":"integration/typescript/test/index.test.js","skipped":false,"dir":"test"},{"name":"should build the app with functions in next.config.js","suites":["TypeScript Features","default behavior"],"updatePoint":{"line":111,"column":59},"line":111,"code":"  it('should build the app with functions in next.config.js', async () => {\n    const nextConfig = new File(join(appDir, 'next.config.js'))\n\n    nextConfig.write(`\n    module.exports = {\n      webpack(config) { return config },\n      onDemandEntries: {\n        // Make sure entries are not getting disposed.\n        maxInactiveAge: 1000 * 60 * 60,\n      },\n    }\n    `)\n\n    try {\n      const output = await nextBuild(appDir, [], { stdout: true })\n\n      expect(output.stdout).toMatch(/Compiled successfully/)\n      expect(output.code).toBe(0)\n    } finally {\n      nextConfig.restore()\n    }\n  })","file":"integration/typescript/test/index.test.js","skipped":false,"dir":"test"},{"name":"should not inform when using default tsconfig path","suites":["TypeScript Features","default behavior"],"updatePoint":{"line":134,"column":56},"line":134,"code":"  it('should not inform when using default tsconfig path', async () => {\n    const output = await nextBuild(appDir, [], { stdout: true })\n    expect(output.stdout).not.toMatch(/Using tsconfig file:/)\n  })","file":"integration/typescript/test/index.test.js","skipped":false,"dir":"test"},{"name":"should compile async getInitialProps for _error","suites":["TypeScript Features","should compile with different types"],"updatePoint":{"line":140,"column":55},"line":140,"code":"    it('should compile async getInitialProps for _error', async () => {\n      const errorPage = new File(join(appDir, 'pages/_error.tsx'))\n      try {\n        errorPage.replace('static ', 'static async ')\n        const output = await nextBuild(appDir, [], { stdout: true })\n        expect(output.stdout).toMatch(/Compiled successfully/)\n      } finally {\n        errorPage.restore()\n      }\n    })","file":"integration/typescript/test/index.test.js","skipped":false,"dir":"test"},{"name":"should compile sync getStaticPaths & getStaticProps","suites":["TypeScript Features","should compile with different types"],"updatePoint":{"line":151,"column":59},"line":151,"code":"    it('should compile sync getStaticPaths & getStaticProps', async () => {\n      const page = new File(join(appDir, 'pages/ssg/[slug].tsx'))\n      try {\n        page.replace(/async \\(/g, '(')\n        const output = await nextBuild(appDir, [], { stdout: true })\n        expect(output.stdout).toMatch(/Compiled successfully/)\n      } finally {\n        page.restore()\n      }\n    })","file":"integration/typescript/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show in production mode","suites":["undefined webpack config error"],"updatePoint":{"line":11,"column":36},"line":11,"code":"  it('should show in production mode', async () => {\n    const result = await nextBuild(appDir, [], {\n      stdout: true,\n      stderr: true,\n    })\n    expect(result.stderr || '' + result.stdout || '').toMatch(expectedErr)\n  })","file":"integration/undefined-webpack-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show in dev mode","suites":["undefined webpack config error"],"updatePoint":{"line":19,"column":29},"line":19,"code":"  it('should show in dev mode', async () => {\n    let output = ''\n\n    await launchApp(appDir, [], {\n      onStderr(msg) {\n        output += msg || ''\n      },\n      ontStdout(msg) {\n        output += msg || ''\n      },\n    })\n\n    expect(output).toMatch(expectedErr)\n  })","file":"integration/undefined-webpack-config/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the  page","suites":["Handle url imports"],"updatePoint":{"line":65,"column":42},"line":65,"code":"        it(`should render the ${page} page`, async () => {\n          const html = await renderViaHTTP(appPort, page)\n          expect(html).toMatch(expectedServer)\n        })","file":"integration/url-imports/test/index.test.js","skipped":false,"dir":"test"},{"name":"should client-render the  page","suites":["Handle url imports"],"updatePoint":{"line":70,"column":49},"line":70,"code":"        it(`should client-render the ${page} page`, async () => {\n          let browser\n          try {\n            browser = await webdriver(appPort, page)\n            await check(() => getBrowserBodyText(browser), expectedClient)\n          } finally {\n            await browser.close()\n          }\n        })","file":"integration/url-imports/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render a static url image import","suites":["Handle url imports"],"updatePoint":{"line":81,"column":49},"line":81,"code":"      it(`should render a static url image import`, async () => {\n        let browser\n        try {\n          browser = await webdriver(appPort, '/image')\n          await browser.waitForElementByCss('#static-image')\n          await check(\n            () => browser.elementByCss('#static-image').getAttribute('src'),\n            /^\\/_next\\/image\\?url=%2F_next%2Fstatic%2Fmedia%2Fvercel\\.[0-9a-f]{8}\\.png&/\n          )\n        } finally {\n          await browser.close()\n        }\n      })","file":"integration/url-imports/test/index.test.js","skipped":false,"dir":"test"},{"name":"should allow url import in css","suites":["Handle url imports"],"updatePoint":{"line":95,"column":40},"line":95,"code":"      it(`should allow url import in css`, async () => {\n        let browser\n        try {\n          browser = await webdriver(appPort, '/css')\n          await browser.waitForElementByCss('#static-css')\n          await check(\n            () =>\n              browser\n                .elementByCss('#static-css')\n                .getComputedCss('background-image'),\n            /^url\\(\"http:\\/\\/localhost:\\d+\\/_next\\/static\\/media\\/vercel\\.[0-9a-f]{8}\\.png\"\\)$/\n          )\n        } finally {\n          await browser.close()\n        }\n      })","file":"integration/url-imports/test/index.test.js","skipped":false,"dir":"test"},{"name":"should respond on value api","suites":["Handle url imports"],"updatePoint":{"line":112,"column":37},"line":112,"code":"      it('should respond on value api', async () => {\n        const data = await fetchViaHTTP(appPort, '/api/value').then(\n          (res) => res.ok && res.json()\n        )\n\n        expect(data).toEqual({ value: 42 })\n      })","file":"integration/url-imports/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the  page","suites":["Handle new URL asset references in next "],"updatePoint":{"line":48,"column":40},"line":48,"code":"      it(`should render the ${page} page`, async () => {\n        const html = await renderViaHTTP(appPort, page)\n        expect(html).toMatch(expectedServer)\n      })","file":"integration/url/test/index.test.js","skipped":false,"dir":"test"},{"name":"should client-render the  page","suites":["Handle new URL asset references in next "],"updatePoint":{"line":53,"column":47},"line":53,"code":"      it(`should client-render the ${page} page`, async () => {\n        let browser\n        try {\n          browser = await webdriver(appPort, page)\n          await check(() => getBrowserBodyText(browser), expectedClient)\n        } finally {\n          await browser.close()\n        }\n      })","file":"integration/url/test/index.test.js","skipped":false,"dir":"test"},{"name":"should respond on size api","suites":["Handle new URL asset references in next "],"updatePoint":{"line":64,"column":34},"line":64,"code":"    it('should respond on size api', async () => {\n      const data = await fetchViaHTTP(appPort, '/api/size').then(\n        (res) => res.ok && res.json()\n      )\n\n      expect(data).toEqual({ size: 30079 })\n    })","file":"integration/url/test/index.test.js","skipped":false,"dir":"test"},{"name":"should respond on basename api","suites":["Handle new URL asset references in next "],"updatePoint":{"line":72,"column":38},"line":72,"code":"    it('should respond on basename api', async () => {\n      const data = await fetchViaHTTP(appPort, '/api/basename').then(\n        (res) => res.ok && res.json()\n      )\n\n      expect(data).toEqual({\n        basename: expect.stringMatching(/^vercel\\.[0-9a-f]{8}\\.png$/),\n      })\n    })","file":"integration/url/test/index.test.js","skipped":false,"dir":"test"},{"name":"should run correctly with main.js customized","suites":["Customized webpack config with main.js"],"updatePoint":{"line":9,"column":50},"line":9,"code":"  it('should run correctly with main.js customized', async () => {\n    const { code } = await nextBuild(appDir, [], {})\n\n    expect(code).toBe(0)\n  })","file":"integration/webpack-config-mainjs/test/index.test.js","skipped":false,"dir":"test"},{"name":"Does not error during build","suites":["Handles Webpack Require Hook","build"],"updatePoint":{"line":17,"column":35},"line":17,"code":"    it('Does not error during build', async () => {\n      const { stdout, stderr } = await nextBuild(appDir, [], {\n        stdout: true,\n        stderr: true,\n      })\n      console.log(stderr)\n      expect(stderr.length).toStrictEqual(0)\n      expect(stdout).toMatch(/Initialized config/)\n    })","file":"integration/webpack-require-hook/test/index.test.js","skipped":false,"dir":"test"},{"name":"Applies and does not error during development","suites":["Handles Webpack Require Hook","dev mode"],"updatePoint":{"line":29,"column":53},"line":29,"code":"    it('Applies and does not error during development', async () => {\n      let output\n      const handleOutput = (msg) => {\n        output += msg\n      }\n      const appPort = await findPort()\n      const app = await launchApp(appDir, appPort, {\n        onStdout: handleOutput,\n        onStderr: handleOutput,\n      })\n      await renderViaHTTP(appPort, '/')\n      await killApp(app)\n      expect(output).toMatch(/Initialized config/)\n    })","file":"integration/webpack-require-hook/test/index.test.js","skipped":false,"dir":"test"},{"name":"app init","suites":["Parse Relative Url","File Protocol via Electron"],"updatePoint":{"line":44,"column":18},"line":44,"code":"      it('app init', async () => {\n        const count = await app.client.getWindowCount()\n        expect(count).toEqual(1)\n      })","file":"integration/with-electron/test/index.test.js","skipped":false,"dir":"test"},{"name":"should render the home page","suites":["Parse Relative Url","File Protocol via Electron"],"updatePoint":{"line":49,"column":37},"line":49,"code":"      it('should render the home page', async () => {\n        const text = await app.client.$('#home-page p').getText()\n        expect(text).toBe('This is the home page')\n      })","file":"integration/with-electron/test/index.test.js","skipped":false,"dir":"test"},{"name":"should do navigations via Link","suites":["Parse Relative Url","File Protocol via Electron"],"updatePoint":{"line":54,"column":40},"line":54,"code":"      it('should do navigations via Link', async () => {\n        await app.client.$('#about-via-link').click()\n        const text = await app.client.$('#about-page p').getText()\n\n        expect(text).toBe('This is the about page')\n      })","file":"integration/with-electron/test/index.test.js","skipped":false,"dir":"test"},{"name":"should do back to home page via Link","suites":["Parse Relative Url","File Protocol via Electron"],"updatePoint":{"line":61,"column":46},"line":61,"code":"      it('should do back to home page via Link', async () => {\n        await app.client.$('#about-page a').click()\n        const text = await app.client.$('#home-page p').getText()\n\n        expect(text).toBe('This is the home page')\n      })","file":"integration/with-electron/test/index.test.js","skipped":false,"dir":"test"},{"name":"should do navigations via Router","suites":["Parse Relative Url","File Protocol via Electron"],"updatePoint":{"line":68,"column":42},"line":68,"code":"      it('should do navigations via Router', async () => {\n        await app.client.$('#about-via-router').click()\n        const text = await app.client.$('#about-page p').getText()\n\n        expect(text).toBe('This is the about page')\n      })","file":"integration/with-electron/test/index.test.js","skipped":false,"dir":"test"},{"name":"Should skip testing electron without process.env.TEST_ELECTRON set","suites":["Parse Relative Url","File Protocol via Electron"],"updatePoint":{"line":77,"column":72},"line":77,"code":"  it('Should skip testing electron without process.env.TEST_ELECTRON set', () => {})","file":"integration/with-electron/test/index.test.js","skipped":false,"dir":"test"},{"name":"allows observation of navigation events using withRouter","suites":["withRouter"],"updatePoint":{"line":37,"column":62},"line":37,"code":"  it('allows observation of navigation events using withRouter', async () => {\n    const browser = await webdriver(appPort, '/a')\n    await browser.waitForElementByCss('#page-a')\n\n    let activePage = await browser.elementByCss('.active').text()\n    expect(activePage).toBe('Foo')\n\n    await browser.elementByCss('button').click()\n    await browser.waitForElementByCss('#page-b')\n\n    activePage = await browser.elementByCss('.active').text()\n    expect(activePage).toBe('Bar')\n\n    await browser.close()\n  })","file":"integration/with-router/test/index.test.js","skipped":false,"dir":"test"},{"name":"allows observation of navigation events using top level Router","suites":["withRouter"],"updatePoint":{"line":53,"column":68},"line":53,"code":"  it('allows observation of navigation events using top level Router', async () => {\n    const browser = await webdriver(appPort, '/a')\n    await browser.waitForElementByCss('#page-a')\n\n    let activePage = await browser\n      .elementByCss('.active-top-level-router')\n      .text()\n    expect(activePage).toBe('Foo')\n\n    await browser.elementByCss('button').click()\n    await browser.waitForElementByCss('#page-b')\n\n    activePage = await browser.elementByCss('.active-top-level-router').text()\n    expect(activePage).toBe('Bar')\n\n    await browser.close()\n  })","file":"integration/with-router/test/index.test.js","skipped":false,"dir":"test"},{"name":"allows observation of navigation events using top level Router deprecated behavior","suites":["withRouter"],"updatePoint":{"line":71,"column":88},"line":71,"code":"  it('allows observation of navigation events using top level Router deprecated behavior', async () => {\n    const browser = await webdriver(appPort, '/a')\n    await browser.waitForElementByCss('#page-a')\n\n    let activePage = await browser\n      .elementByCss('.active-top-level-router-deprecated-behavior')\n      .text()\n    expect(activePage).toBe('Foo')\n\n    await browser.elementByCss('button').click()\n    await browser.waitForElementByCss('#page-b')\n\n    activePage = await browser\n      .elementByCss('.active-top-level-router-deprecated-behavior')\n      .text()\n    expect(activePage).toBe('Bar')\n\n    await browser.close()\n  })","file":"integration/with-router/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show an error when trying to use router methods during SSR","suites":["withRouter SSR"],"updatePoint":{"line":106,"column":71},"line":106,"code":"  it('should show an error when trying to use router methods during SSR', async () => {\n    const browser = await webdriver(port, '/router-method-ssr')\n    expect(await hasRedbox(browser)).toBe(true)\n    expect(await getRedboxHeader(browser)).toMatch(\n      `No router instance found. you should only use \"next/router\" inside the client side of your app. https://`\n    )\n    await browser.close()\n  })","file":"integration/with-router/test/index.test.js","skipped":false,"dir":"test"},{"name":"should pass on both client and worker","suites":[],"updatePoint":{"line":19,"column":43},"line":19,"code":"  it('should pass on both client and worker', async () => {\n    let browser\n    try {\n      browser = await webdriver(appPort, '/')\n      await browser.waitForElementByCss('#web-status')\n      await check(() => browser.elementByCss('#web-status').text(), /PASS/i)\n      await browser.waitForElementByCss('#worker-status')\n      await check(() => browser.elementByCss('#worker-status').text(), /PASS/i)\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"integration/worker-webpack5/test/index.test.js","skipped":false,"dir":"test"},{"name":"should show missing TypeScript dependencies error in CI","suites":["ci-missing-typescript-deps"],"updatePoint":{"line":4,"column":61},"line":4,"code":"  it('should show missing TypeScript dependencies error in CI', async () => {\n    const next = await createNext({\n      files: {\n        'pages/index.tsx': `\n          export default function Page() {\n            return <p>hello world</p>\n          }\n        `,\n      },\n      env: {\n        CI: '1',\n      },\n      skipStart: true,\n    })\n    try {\n      let error\n      await next.start().catch((err) => {\n        error = err\n      })\n\n      expect(error).toBeDefined()\n      expect(next.cliOutput).toContain(\n        `It looks like you're trying to use TypeScript but do not have the required package(s) installed.`\n      )\n      expect(next.cliOutput).toContain(`Please install`)\n      expect(next.cliOutput).not.toContain('Call retries were exceeded')\n      expect(next.cliOutput).not.toContain('WorkerError')\n    } finally {\n      await next.destroy()\n    }\n  })","file":"production/ci-missing-typescript-deps/index.test.ts","skipped":false,"dir":"test"},{"name":"should correctly use pages/500 and call Error.getInitialProps","suites":["custom-error-500"],"updatePoint":{"line":53,"column":67},"line":53,"code":"  it('should correctly use pages/500 and call Error.getInitialProps', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toContain('pages/500')\n\n    await check(() => next.cliOutput, /called Error\\.getInitialProps true/)\n  })","file":"production/custom-error-500/index.test.ts","skipped":false,"dir":"test"},{"name":"should work correctly with pages/404 present","suites":["custom-error-500"],"updatePoint":{"line":60,"column":50},"line":60,"code":"  it('should work correctly with pages/404 present', async () => {\n    await next.stop()\n    await next.patchFile(\n      'pages/404.js',\n      `\n      export default function Page() {\n        return <p>custom 404 page</p>\n      }\n    `\n    )\n    await next.start()\n\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toContain('pages/500')\n\n    await check(() => next.cliOutput, /called Error\\.getInitialProps true/)\n  })","file":"production/custom-error-500/index.test.ts","skipped":false,"dir":"test"},{"name":"does not error from patching lockfile","suites":["dependencies can use env vars in middlewares"],"updatePoint":{"line":54,"column":43},"line":54,"code":"  it('does not error from patching lockfile', () => {\n    expect(next.cliOutput).not.toContain('patch-incorrect-lockfile')\n  })","file":"production/dependencies-can-use-env-vars-in-middlewares/index.test.ts","skipped":false,"dir":"test"},{"name":"parses the env vars correctly","suites":["dependencies can use env vars in middlewares"],"updatePoint":{"line":58,"column":35},"line":58,"code":"  it('parses the env vars correctly', async () => {\n    const testDir = next.testDir\n    const manifestPath = path.join(\n      testDir,\n      '.next/server/middleware-manifest.json'\n    )\n    const manifest = await readJson(manifestPath)\n    const envVars = manifest?.middleware?.['/']?.env\n\n    expect(envVars).toHaveLength(2)\n    expect(envVars).toContain('ENV_VAR_USED_IN_MIDDLEWARE')\n    expect(envVars).toContain('MY_CUSTOM_PACKAGE_ENV_VAR')\n  })","file":"production/dependencies-can-use-env-vars-in-middlewares/index.test.ts","skipped":false,"dir":"test"},{"name":"uses the environment variables","suites":["dependencies can use env vars in middlewares"],"updatePoint":{"line":72,"column":36},"line":72,"code":"  it('uses the environment variables', async () => {\n    const response = await fetchViaHTTP(next.url, '/api')\n    expect(JSON.parse(response.headers.get('data'))).toEqual({\n      string: 'a constant string',\n      hello: 'env-var-used-in-middleware',\n      customPackage: 'my-custom-package-env-var',\n    })\n  })","file":"production/dependencies-can-use-env-vars-in-middlewares/index.test.ts","skipped":false,"dir":"test"},{"name":"Fallback polyfills added by default","suites":["Disable fallback polyfills"],"updatePoint":{"line":28,"column":41},"line":28,"code":"  it('Fallback polyfills added by default', async () => {\n    const firstLoadJSSize = Number(\n      next.cliOutput.match(/○ \\/\\s{38}(\\d*) kB\\s{10}(?<firstLoad>\\d*) kB/)\n        .groups.firstLoad\n    )\n    expect(firstLoadJSSize).not.toBeLessThan(200)\n  })","file":"production/disable-fallback-polyfills/index.test.ts","skipped":false,"dir":"test"},{"name":"Build should fail, when fallback polyfilling is disabled","suites":["Disable fallback polyfills"],"updatePoint":{"line":36,"column":62},"line":36,"code":"  it('Build should fail, when fallback polyfilling is disabled', async () => {\n    await next.patchFile(\n      'next.config.js',\n      `module.exports = {\n        experimental: {\n          fallbackNodePolyfills: false\n        }\n      }`\n    )\n\n    await expect(next.start()).rejects.toThrow(/next build failed/)\n  })","file":"production/disable-fallback-polyfills/index.test.ts","skipped":false,"dir":"test"},{"name":"EdgeRuntime evaluates to a string","suites":["Edge Runtime is addressable"],"updatePoint":{"line":48,"column":41},"line":48,"code":"  test('EdgeRuntime evaluates to a string', async () => {\n    const resp = await fetchViaHTTP(next.url, '/')\n    expect(await resp.text()).toContain('hello world')\n    expect(Object.fromEntries(resp.headers)).toMatchObject({\n      'x-runtime-version': 'edge-runtime',\n      'x-runtime-version-dynamic': 'edge-runtime',\n    })\n  })","file":"production/edge-runtime-is-addressable/index.test.ts","skipped":false,"dir":"test"},{"name":"removes the undefined branch with dead code elimination","suites":["Edge Runtime is addressable"],"updatePoint":{"line":57,"column":63},"line":57,"code":"  test('removes the undefined branch with dead code elimination', async () => {\n    const compiledMiddlewareFile = await fs.readFile(\n      path.join(next.testDir, '.next/server/middleware.js'),\n      'utf8'\n    )\n\n    expect(compiledMiddlewareFile).toContain('EdgeRuntime is defined')\n    expect(compiledMiddlewareFile).not.toContain('EdgeRuntime is undefined')\n  })","file":"production/edge-runtime-is-addressable/index.test.ts","skipped":false,"dir":"test"},{"name":"EdgeRuntime evaluates to a string","suites":["Edge Runtime can be set to the production provider"],"updatePoint":{"line":82,"column":41},"line":82,"code":"  test('EdgeRuntime evaluates to a string', async () => {\n    const resp = await fetchViaHTTP(next.url, '/')\n    expect(await resp.text()).toContain('hello world')\n    expect(Object.fromEntries(resp.headers)).toMatchObject({\n      'x-runtime-version': 'vercel',\n      // We don't test for x-runtime-version-dynamic here\n      // because the tests are using edge-runtime and not Vercel\n      // as the provider.\n    })\n  })","file":"production/edge-runtime-is-addressable/index.test.ts","skipped":false,"dir":"test"},{"name":"should compile with emitDecoratorMetadata enabled","suites":["emitDecoratorMetadata SWC option"],"updatePoint":{"line":28,"column":55},"line":28,"code":"  it('should compile with emitDecoratorMetadata enabled', async () => {\n    let browser: BrowserInterface\n    try {\n      browser = await webdriver(next.appPort, '/')\n      const message = await browser.elementByCss('#message').text()\n\n      expect(message).toBe('Hello, world!')\n    } finally {\n      if (browser) {\n        await browser.close()\n      }\n    }\n  })","file":"production/emit-decorator-metadata/index.test.ts","skipped":false,"dir":"test"},{"name":"should compile with emitDecoratorMetadata enabled for API","suites":["emitDecoratorMetadata SWC option"],"updatePoint":{"line":42,"column":63},"line":42,"code":"  it('should compile with emitDecoratorMetadata enabled for API', async () => {\n    const res = await fetchViaHTTP(next.url, '/api/something')\n    expect(res.status).toBe(200)\n    expect(await res.json()).toEqual({ myParam: 'something' })\n  })","file":"production/emit-decorator-metadata/index.test.ts","skipped":false,"dir":"test"},{"name":"should show ENOENT error correctly","suites":["ENOENT during require"],"updatePoint":{"line":43,"column":40},"line":43,"code":"  it('should show ENOENT error correctly', async () => {\n    await check(async () => {\n      await renderViaHTTP(next.url, '/')\n      console.error(next.cliOutput)\n\n      return next.cliOutput.includes('non-existent-folder')\n        ? 'success'\n        : next.cliOutput\n    }, 'success')\n\n    expect(next.cliOutput).not.toContain('Cannot destructure property')\n  })","file":"production/enoent-during-require/index.test.ts","skipped":false,"dir":"test"},{"name":"should pass for ES5","suites":["ES Check default output"],"updatePoint":{"line":24,"column":25},"line":24,"code":"  it('should pass for ES5', async () => {\n    expect(next.cliOutput).toContain(\n      'info: ES-Check: there were no ES version matching errors!  🎉'\n    )\n  })","file":"production/escheck-output/index.test.ts","skipped":false,"dir":"test"},{"name":"should pass for ES5 with SWC minify","suites":["ES Check default output"],"updatePoint":{"line":30,"column":41},"line":30,"code":"  it('should pass for ES5 with SWC minify', async () => {\n    await next.stop()\n    await next.deleteFile('.next')\n    await next.patchFile(\n      'next.config.js',\n      `\n      module.exports = ${JSON.stringify({ swcMinify: true } as NextConfig)}\n    `\n    )\n    await next.start()\n\n    expect(next.cliOutput).toContain(\n      'info: ES-Check: there were no ES version matching errors!  🎉'\n    )\n  })","file":"production/escheck-output/index.test.ts","skipped":false,"dir":"test"},{"name":"should work","suites":["eslint plugin deps"],"updatePoint":{"line":112,"column":17},"line":112,"code":"  it('should work', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toContain('hello world')\n  })","file":"production/eslint-plugin-deps/index.test.ts","skipped":false,"dir":"test"},{"name":"fails to build on malformed input","suites":["Exported runtimes value validation"],"updatePoint":{"line":5,"column":41},"line":5,"code":"  test('fails to build on malformed input', async () => {\n    const result = await nextBuild(\n      path.resolve(__dirname, './invalid-runtime/app'),\n      undefined,\n      { stdout: true, stderr: true }\n    )\n    expect(result).toMatchObject({\n      code: 1,\n      stderr: expect.stringContaining(\n        `Provided runtime \"something-odd\" is not supported.`\n      ),\n    })\n  })","file":"production/exported-runtimes-value-validation/index.test.ts","skipped":false,"dir":"test"},{"name":"warns on unrecognized runtimes value","suites":["Exported runtimes value validation"],"updatePoint":{"line":19,"column":44},"line":19,"code":"  test('warns on unrecognized runtimes value', async () => {\n    const result = await nextBuild(\n      path.resolve(__dirname, './unsupported-syntax/app'),\n      undefined,\n      { stdout: true, stderr: true }\n    )\n\n    console.log(result.stderr, result.stdout)\n\n    // The build should still succeed with invalid config being ignored\n    expect(result.code).toBe(0)\n\n    // Template Literal with Expressions\n    expect(result.stderr).toEqual(\n      expect.stringContaining(\n        'Next.js can\\'t recognize the exported `config` field in route \"/template-literal-with-expressions\"'\n      )\n    )\n    expect(result.stderr).toEqual(\n      expect.stringContaining(\n        'Unsupported template literal with expressions at \"config.runtime\".'\n      )\n    )\n    // Binary Expression\n    expect(result.stderr).toEqual(\n      expect.stringContaining(\n        'Next.js can\\'t recognize the exported `config` field in route \"/binary-expression\"'\n      )\n    )\n    expect(result.stderr).toEqual(\n      expect.stringContaining(\n        'Unsupported node type \"BinaryExpression\" at \"config.runtime\"'\n      )\n    )\n    // Spread Operator within Object Expression\n    expect(result.stderr).toEqual(\n      expect.stringContaining(\n        'Next.js can\\'t recognize the exported `config` field in route \"/object-spread-operator\"'\n      )\n    )\n    expect(result.stderr).toEqual(\n      expect.stringContaining(\n        'Unsupported spread operator in the Object Expression at \"config.runtime\"'\n      )\n    )\n    // Spread Operator within Array Expression\n    expect(result.stderr).toEqual(\n      expect.stringContaining(\n        'Next.js can\\'t recognize the exported `config` field in route \"/array-spread-operator\"'\n      )\n    )\n    expect(result.stderr).toEqual(\n      expect.stringContaining(\n        'Unsupported spread operator in the Array Expression at \"config.runtime\"'\n      )\n    )\n    // Unknown Identifier\n    expect(result.stderr).toEqual(\n      expect.stringContaining(\n        'Next.js can\\'t recognize the exported `config` field in route \"/invalid-identifier\"'\n      )\n    )\n    expect(result.stderr).toEqual(\n      expect.stringContaining(\n        'Unknown identifier \"runtime\" at \"config.runtime\".'\n      )\n    )\n    // Unknown Expression Type\n    expect(result.stderr).toEqual(\n      expect.stringContaining(\n        'Next.js can\\'t recognize the exported `config` field in route \"/unsupported-value-type\"'\n      )\n    )\n    expect(result.stderr).toEqual(\n      expect.stringContaining(\n        'Unsupported node type \"CallExpression\" at \"config.runtime\"'\n      )\n    )\n    // Unknown Object Key\n    expect(result.stderr).toEqual(\n      expect.stringContaining(\n        'Next.js can\\'t recognize the exported `config` field in route \"/unsupported-object-key\"'\n      )\n    )\n    expect(result.stderr).toEqual(\n      expect.stringContaining(\n        'Unsupported key type \"Computed\" in the Object Expression at \"config.runtime\"'\n      )\n    )\n  })","file":"production/exported-runtimes-value-validation/index.test.ts","skipped":false,"dir":"test"},{"name":"should have built","suites":["fallback export error"],"updatePoint":{"line":18,"column":23},"line":18,"code":"  it('should have built', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toContain('index page')\n  })","file":"production/fallback-export-error/index.test.ts","skipped":false,"dir":"test"},{"name":"should not error with default exportPathMap","suites":["fallback export error"],"updatePoint":{"line":23,"column":49},"line":23,"code":"  it('should not error with default exportPathMap', async () => {\n    await next.stop()\n\n    const result = await next.export()\n    console.log(result.cliOutput)\n\n    expect(result.exitCode).toBe(0)\n    expect(result.cliOutput).not.toContain(\n      'Found pages with `fallback` enabled'\n    )\n  })","file":"production/fallback-export-error/index.test.ts","skipped":false,"dir":"test"},{"name":"should not error with valid exportPathMap","suites":["fallback export error"],"updatePoint":{"line":35,"column":47},"line":35,"code":"  it('should not error with valid exportPathMap', async () => {\n    await next.stop()\n    await next.patchFile(\n      'next.config.js',\n      `\n      module.exports = {\n        exportPathMap() {\n          return {\n            '/': { page: '/' },\n          }\n        }\n      }\n    `\n    )\n\n    try {\n      const result = await next.export()\n      console.log(result.cliOutput)\n\n      expect(result.exitCode).toBe(0)\n      expect(result.cliOutput).not.toContain(\n        'Found pages with `fallback` enabled'\n      )\n    } finally {\n      await next.deleteFile('next.config.js')\n    }\n  })","file":"production/fallback-export-error/index.test.ts","skipped":false,"dir":"test"},{"name":"should error with invalid exportPathMap","suites":["fallback export error"],"updatePoint":{"line":63,"column":45},"line":63,"code":"  it('should error with invalid exportPathMap', async () => {\n    await next.stop()\n    await next.patchFile(\n      'next.config.js',\n      `\n      module.exports = {\n        exportPathMap() {\n          return {\n            '/': { page: '/' },\n            '/second': { page: '/[...slug]' }\n          }\n        }\n      }\n    `\n    )\n\n    try {\n      const result = await next.export()\n      console.log(result.cliOutput)\n\n      expect(result.exitCode).toBe(1)\n      expect(result.cliOutput).toContain('Found pages with `fallback` enabled')\n    } finally {\n      await next.deleteFile('next.config.js')\n    }\n  })","file":"production/fallback-export-error/index.test.ts","skipped":false,"dir":"test"},{"name":"should render page without error correctly","suites":["fatal-render-errror"],"updatePoint":{"line":18,"column":48},"line":18,"code":"  it('should render page without error correctly', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toContain('index page')\n    expect(html).toContain('from _app')\n  })","file":"production/fatal-render-errror/index.test.ts","skipped":false,"dir":"test"},{"name":"should handle fatal error in _app and _error without loop on direct visit","suites":["fatal-render-errror"],"updatePoint":{"line":24,"column":79},"line":24,"code":"  it('should handle fatal error in _app and _error without loop on direct visit', async () => {\n    const browser = await webdriver(next.url, '/with-error')\n\n    // wait a bit to see if we are rendering multiple times unexpectedly\n    await waitFor(500)\n    expect(await browser.eval('window.renderAttempts')).toBeLessThan(10)\n\n    const html = await browser.eval('document.documentElement.innerHTML')\n    expect(html).not.toContain('from _app')\n    expect(html).toContain(\n      'Application error: a client-side exception has occurred'\n    )\n  })","file":"production/fatal-render-errror/index.test.ts","skipped":false,"dir":"test"},{"name":"should handle fatal error in _app and _error without loop on client-transition","suites":["fatal-render-errror"],"updatePoint":{"line":38,"column":84},"line":38,"code":"  it('should handle fatal error in _app and _error without loop on client-transition', async () => {\n    const browser = await webdriver(next.url, '/')\n    await browser.eval('window.renderAttempts = 0')\n\n    await browser.eval('window.next.router.push(\"/with-error\")')\n    await check(() => browser.eval('location.pathname'), '/with-error')\n\n    // wait a bit to see if we are rendering multiple times unexpectedly\n    await waitFor(500)\n    expect(await browser.eval('window.renderAttempts')).toBeLessThan(10)\n\n    const html = await browser.eval('document.documentElement.innerHTML')\n    expect(html).not.toContain('from _app')\n    expect(html).toContain(\n      'Application error: a client-side exception has occurred'\n    )\n  })","file":"production/fatal-render-errror/index.test.ts","skipped":false,"dir":"test"},{"name":"generates a source map for Middleware","suites":["Middleware source maps"],"updatePoint":{"line":32,"column":43},"line":32,"code":"  it('generates a source map for Middleware', async () => {\n    const middlewarePath = path.resolve(\n      next.testDir,\n      '.next/server/middleware.js'\n    )\n    expect(await fs.pathExists(middlewarePath)).toEqual(true)\n    expect(await fs.pathExists(`${middlewarePath}.map`)).toEqual(true)\n  })","file":"production/generate-middleware-source-maps/index.test.ts","skipped":false,"dir":"test"},{"name":"generates a source map for Edge API","suites":["Middleware source maps"],"updatePoint":{"line":41,"column":41},"line":41,"code":"  it('generates a source map for Edge API', async () => {\n    const edgePath = path.resolve(\n      next.testDir,\n      '.next/server/pages/api/edge.js'\n    )\n    expect(await fs.pathExists(edgePath)).toEqual(true)\n    expect(await fs.pathExists(`${edgePath}.map`)).toEqual(true)\n  })","file":"production/generate-middleware-source-maps/index.test.ts","skipped":false,"dir":"test"},{"name":"should bail on react v17","suites":["next/jest"],"updatePoint":{"line":10,"column":32},"line":10,"code":"    it('should bail on react v17', () => {})","file":"production/jest/index.test.ts","skipped":false,"dir":"test"},{"name":"should work","suites":["next/jest"],"updatePoint":{"line":146,"column":17},"line":146,"code":"  it('should work', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toContain('hello world')\n  })","file":"production/jest/index.test.ts","skipped":false,"dir":"test"},{"name":"should bail on react v17","suites":["next/jest"],"updatePoint":{"line":12,"column":32},"line":12,"code":"    it('should bail on react v17', () => {})","file":"production/jest/relay/relay-jest.test.ts","skipped":false,"dir":"test"},{"name":"should work","suites":["next/jest"],"updatePoint":{"line":80,"column":17},"line":80,"code":"  it('should work', async () => {\n    // Suite fails if `jest` fails during `build`\n    expect(typeof '').toBe('string')\n  })","file":"production/jest/relay/relay-jest.test.ts","skipped":false,"dir":"test"},{"name":"should bail on react v17","suites":["next/jest"],"updatePoint":{"line":13,"column":32},"line":13,"code":"    it('should bail on react v17', () => {})","file":"production/jest/remove-react-properties/remove-react-properties-jest.test.ts","skipped":false,"dir":"test"},{"name":"data-testid should be removed in production","suites":["next/jest"],"updatePoint":{"line":57,"column":49},"line":57,"code":"  it('data-testid should be removed in production', async () => {\n    const html = await renderViaHTTP(next.appPort, '/')\n\n    expect(html).not.toContain('data-testid')\n  })","file":"production/jest/remove-react-properties/remove-react-properties-jest.test.ts","skipped":false,"dir":"test"},{"name":"limits process.env to only contain env vars that are inferred from usage","suites":["middleware environment variables in node server reflect the usage inference"],"updatePoint":{"line":39,"column":78},"line":39,"code":"  it('limits process.env to only contain env vars that are inferred from usage', async () => {\n    const response = await fetchViaHTTP(next.url, '/test')\n    expect(JSON.parse(response.headers.get('data'))).toEqual({\n      canBeInferred: 'can-be-inferred',\n      rest: {\n        CAN_BE_INFERRED: 'can-be-inferred',\n        X_CUSTOM_HEADER: 'x-custom-header',\n        NEXT_RUNTIME: 'edge',\n      },\n    })\n  })","file":"production/middleware-environment-variables-in-node-server-reflect-the-usage-inference/index.test.ts","skipped":false,"dir":"test"},{"name":"fails to build","suites":["Middleware is not allowed when using serverless target"],"updatePoint":{"line":5,"column":20},"line":5,"code":"  it('fails to build', async () => {\n    const { code, stderr } = await nextBuild(\n      path.resolve(__dirname, './app'),\n      undefined,\n      { ignoreFail: true, stderr: true }\n    )\n    expect(code).toEqual(1)\n    expect(stderr).toContain('MiddlewareInServerlessTargetError')\n  })","file":"production/middleware-is-not-allowed-when-using-serverless-target/index.test.ts","skipped":false,"dir":"test"},{"name":"should have built and started","suites":["should set-up next"],"updatePoint":{"line":31,"column":35},"line":31,"code":"  it('should have built and started', async () => {\n    const response = await fetchViaHTTP(next.url, '/static')\n    expect(response.headers.get('data')).toEqual('hello from middleware')\n  })","file":"production/middleware-typescript/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should have correct responses","suites":["minimal-mode-response-cache"],"updatePoint":{"line":75,"column":35},"line":75,"code":"  it('should have correct responses', async () => {\n    const html = await renderViaHTTP(appPort, '/')\n    expect(html.length).toBeTruthy()\n\n    for (const { path, matchedPath, query, asPath, pathname } of [\n      { path: '/', asPath: '/' },\n      { path: '/', matchedPath: '/index', asPath: '/' },\n      { path: '/', matchedPath: '/index/', asPath: '/' },\n      { path: '/', matchedPath: '/', asPath: '/' },\n      {\n        path: '/news/',\n        matchedPath: '/news/',\n        asPath: '/news/',\n        pathname: '/news',\n      },\n      {\n        path: '/news/',\n        matchedPath: '/news',\n        asPath: '/news/',\n        pathname: '/news',\n      },\n      {\n        path: '/blog/first/',\n        matchedPath: '/blog/first/',\n        pathname: '/blog/[slug]',\n        asPath: '/blog/first/',\n        query: { slug: 'first' },\n      },\n      {\n        path: '/blog/second/',\n        matchedPath: '/blog/[slug]/',\n        pathname: '/blog/[slug]',\n        asPath: '/blog/second/',\n        query: { slug: 'second' },\n      },\n    ]) {\n      const html = await renderViaHTTP(appPort, path, undefined, {\n        headers: {\n          'x-matched-path': matchedPath || path,\n        },\n      })\n      const $ = cheerio.load(html)\n      expect($('#asPath').text()).toBe(asPath)\n      expect($('#pathname').text()).toBe(pathname || path)\n      expect(JSON.parse($('#query').text())).toEqual(query || {})\n    }\n  })","file":"production/minimal-mode-response-cache/index.test.ts","skipped":false,"dir":"test"},{"name":"should build with dependencies installed via pnpm","suites":["pnpm support"],"updatePoint":{"line":23,"column":55},"line":23,"code":"  it('should build with dependencies installed via pnpm', async () => {\n    next = await createNext({\n      files: {\n        pages: new FileRef(path.join(__dirname, '..', 'app/pages')),\n        'next.config.js': new FileRef(\n          path.join(__dirname, '..', 'app/next.config.js')\n        ),\n      },\n      packageJson: {\n        scripts: {\n          build: 'next build',\n          start: 'next start',\n        },\n      },\n      buildCommand: 'pnpm run build',\n    })\n\n    expect(await next.readFile('pnpm-lock.yaml')).toBeTruthy()\n\n    expect(next.cliOutput).toMatch(/Compiled successfully/)\n\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toContain('Hello World')\n  })","file":"production/pnpm-support/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should execute client-side JS on each page in output: \"standalone\"","suites":["pnpm support"],"updatePoint":{"line":48,"column":72},"line":48,"code":"  it('should execute client-side JS on each page in output: \"standalone\"', async () => {\n    next = await createNext({\n      files: {\n        pages: new FileRef(path.join(__dirname, '..', 'app-multi-page/pages')),\n        '.npmrc': new FileRef(\n          path.join(__dirname, '..', 'app-multi-page/.npmrc')\n        ),\n        'next.config.js': new FileRef(\n          path.join(__dirname, '..', 'app-multi-page/next.config.js')\n        ),\n      },\n      packageJson: {\n        scripts: {\n          dev: 'next dev',\n          build: 'next build',\n          start: 'next start',\n        },\n      },\n      buildCommand: 'pnpm run build',\n      installCommand: '',\n    })\n    await next.stop()\n    expect(next.cliOutput).toMatch(/Compiled successfully/)\n\n    let appPort\n    let server\n    let browser\n    try {\n      appPort = await findPort()\n      const standaloneDir = path.join(\n        next.testDir,\n        '.next/standalone/',\n        path.basename(next.testDir)\n      )\n\n      // simulate what happens in a Dockerfile\n      await fs.remove(path.join(next.testDir, 'node_modules'))\n      await fs.copy(\n        path.join(next.testDir, './.next/static'),\n        path.join(standaloneDir, './.next/static'),\n        { overwrite: true }\n      )\n      server = await initNextServerScript(\n        path.join(standaloneDir, 'server.js'),\n        /Listening/,\n        {\n          ...process.env,\n          PORT: appPort,\n        },\n        undefined,\n        {\n          cwd: standaloneDir,\n        }\n      )\n\n      await renderViaHTTP(appPort, '/')\n\n      browser = await webdriver(appPort, '/', {\n        waitHydration: false,\n      })\n      expect(await browser.waitForElementByCss('#world').text()).toBe('World')\n      await browser.close()\n\n      browser = await webdriver(appPort, '/about', {\n        waitHydration: false,\n      })\n      expect(await browser.waitForElementByCss('#world').text()).toBe('World')\n      await browser.close()\n    } finally {\n      if (server) {\n        await killApp(server)\n      }\n    }\n  })","file":"production/pnpm-support/test/index.test.ts","skipped":false,"dir":"test"},{"name":"should work","suites":["PostCSS plugin config as string"],"updatePoint":{"line":50,"column":17},"line":50,"code":"  it('should work', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toContain('hello world')\n  })","file":"production/postcss-plugin-config-as-string/index.test.ts","skipped":false,"dir":"test"},{"name":"should not revalidate during prefetching","suites":["Prerender prefetch"],"updatePoint":{"line":17,"column":48},"line":17,"code":"    it('should not revalidate during prefetching', async () => {\n      const reqs = {}\n\n      // get initial values\n      for (const path of ['/blog/first', '/blog/second']) {\n        const res = await fetchViaHTTP(next.url, path)\n        expect(res.status).toBe(200)\n\n        const $ = cheerio.load(await res.text())\n        const props = JSON.parse($('#props').text())\n        reqs[path] = props\n      }\n\n      const browser = await webdriver(next.url, '/')\n\n      // wait for prefetch to occur\n      await check(async () => {\n        const cache = await browser.eval(\n          'JSON.stringify(window.next.router.sdc)'\n        )\n        return cache.includes('/blog/first') && cache.includes('/blog/second')\n          ? 'success'\n          : cache\n      }, 'success')\n\n      await waitFor(3000)\n      await browser.refresh()\n\n      // reload after revalidate period and wait for prefetch again\n      await check(async () => {\n        const cache = await browser.eval(\n          'JSON.stringify(window.next.router.sdc)'\n        )\n        return cache.includes('/blog/first') && cache.includes('/blog/second')\n          ? 'success'\n          : cache\n      }, 'success')\n\n      // ensure revalidate did not occur from prefetch\n      for (const path of ['/blog/first', '/blog/second']) {\n        const res = await fetchViaHTTP(next.url, path)\n        expect(res.status).toBe(200)\n\n        const $ = cheerio.load(await res.text())\n        const props = JSON.parse($('#props').text())\n        expect(props).toEqual(reqs[path])\n      }\n    })","file":"production/prerender-prefetch/index.test.ts","skipped":false,"dir":"test"},{"name":"should trigger revalidation after navigation","suites":["Prerender prefetch"],"updatePoint":{"line":66,"column":52},"line":66,"code":"    it('should trigger revalidation after navigation', async () => {\n      const getData = () =>\n        fetchViaHTTP(\n          next.url,\n          `/_next/data/${next.buildId}/blog/first.json`,\n          undefined,\n          {\n            headers: {\n              purpose: 'prefetch',\n            },\n          }\n        )\n      const initialDataRes = await getData()\n      const initialData = await initialDataRes.json()\n      const browser = await webdriver(next.url, '/')\n\n      await browser.elementByCss('#to-blog-first').click()\n\n      await check(async () => {\n        const data = await getData()\n        assert.notDeepEqual(initialData, data)\n        return 'success'\n      }, 'success')\n    })","file":"production/prerender-prefetch/index.test.ts","skipped":false,"dir":"test"},{"name":"should update cache using prefetch with unstable_skipClientCache","suites":["Prerender prefetch"],"updatePoint":{"line":91,"column":72},"line":91,"code":"    it('should update cache using prefetch with unstable_skipClientCache', async () => {\n      const browser = await webdriver(next.url, '/')\n      const timeRes = await fetchViaHTTP(\n        next.url,\n        `/_next/data/${next.buildId}/blog/first.json`,\n        undefined,\n        {\n          headers: {\n            purpose: 'prefetch',\n          },\n        }\n      )\n      const startTime = (await timeRes.json()).pageProps.now\n\n      // ensure stale data is used by default\n      await browser.elementByCss('#to-blog-first').click()\n      const outputIndex = next.cliOutput.length\n\n      await check(() => browser.elementByCss('#page').text(), 'blog/[slug]')\n\n      expect(JSON.parse(await browser.elementByCss('#props').text()).now).toBe(\n        startTime\n      )\n      await browser.back().waitForElementByCss('#to-blog-first')\n\n      // trigger revalidation of /blog/first\n      await check(async () => {\n        await renderViaHTTP(next.url, '/blog/first')\n        return next.cliOutput.substring(outputIndex)\n      }, /revalidating \\/blog first/)\n\n      // now trigger cache update and navigate again\n      await browser.eval(\n        'next.router.prefetch(\"/blog/first\", undefined, { unstable_skipClientCache: true }).finally(() => { window.prefetchDone = \"yes\" })'\n      )\n      await check(() => browser.eval('window.prefetchDone'), 'yes')\n\n      await browser.elementByCss('#to-blog-first').click()\n      await check(() => browser.elementByCss('#page').text(), 'blog/[slug]')\n\n      const newTime = JSON.parse(\n        await browser.elementByCss('#props').text()\n      ).now\n      expect(newTime).not.toBe(startTime)\n      expect(isNaN(newTime)).toBe(false)\n    })","file":"production/prerender-prefetch/index.test.ts","skipped":false,"dir":"test"},{"name":"should attempt cache update on link hover/touch start","suites":["Prerender prefetch"],"updatePoint":{"line":139,"column":63},"line":139,"code":"      it('should attempt cache update on link hover/touch start', async () => {\n        const browser = await webdriver(next.url, '/')\n        const timeRes = await fetchViaHTTP(\n          next.url,\n          `/_next/data/${next.buildId}/blog/first.json`,\n          undefined,\n          {\n            headers: {\n              purpose: 'prefetch',\n            },\n          }\n        )\n        const startTime = (await timeRes.json()).pageProps.now\n\n        // ensure stale data is used by default\n        await browser.elementByCss('#to-blog-first').click()\n        await check(() => browser.elementByCss('#page').text(), 'blog/[slug]')\n\n        expect(\n          JSON.parse(await browser.elementByCss('#props').text()).now\n        ).toBe(startTime)\n        await browser.back().waitForElementByCss('#to-blog-first')\n        const requests = []\n\n        browser.on('request', (req) => {\n          requests.push(req.url())\n        })\n\n        // now trigger cache update and navigate again\n        await check(async () => {\n          if (process.env.DEVICE_NAME) {\n            await browser.elementByCss('#to-blog-second').touchStart()\n            await browser.elementByCss('#to-blog-first').touchStart()\n          } else {\n            await browser.elementByCss('#to-blog-second').moveTo()\n            await browser.elementByCss('#to-blog-first').moveTo()\n          }\n          return requests.some((url) => url.includes('/blog/first.json'))\n            ? 'success'\n            : requests\n        }, 'success')\n      })","file":"production/prerender-prefetch/index.test.ts","skipped":false,"dir":"test"},{"name":"should not attempt client cache update on link hover/touch start","suites":["Prerender prefetch"],"updatePoint":{"line":182,"column":74},"line":182,"code":"      it('should not attempt client cache update on link hover/touch start', async () => {\n        const browser = await webdriver(next.url, '/')\n        let requests = []\n\n        browser.on('request', (req) => {\n          requests.push(req.url())\n        })\n\n        await check(async () => {\n          const cacheKeys = await browser.eval(\n            'Object.keys(window.next.router.sdc)'\n          )\n          return cacheKeys.some((url) => url.includes('/blog/first')) &&\n            cacheKeys.some((url) => url.includes('/blog/second'))\n            ? 'success'\n            : JSON.stringify(requests, null, 2)\n        }, 'success')\n\n        requests = []\n\n        if (process.env.DEVICE_NAME) {\n          await browser.elementByCss('#to-blog-second').touchStart()\n          await browser.elementByCss('#to-blog-first').touchStart()\n        } else {\n          await browser.elementByCss('#to-blog-second').moveTo()\n          await browser.elementByCss('#to-blog-first').moveTo()\n        }\n\n        expect(requests.filter((url) => url.includes('.json'))).toEqual([])\n      })","file":"production/prerender-prefetch/index.test.ts","skipped":false,"dir":"test"},{"name":"should handle failed data fetch and empty cache correctly","suites":["Prerender prefetch"],"updatePoint":{"line":214,"column":65},"line":214,"code":"    it('should handle failed data fetch and empty cache correctly', async () => {\n      const browser = await webdriver(next.url, '/')\n      await browser.elementByCss('#to-blog-first').click()\n\n      // ensure we use the same port when restarting\n      const port = new URL(next.url).port\n      next.forcedPort = port\n\n      // trigger new build so buildId changes\n      await next.stop()\n      await next.start()\n\n      // clear router cache\n      await browser.eval('window.next.router.sdc = {}')\n      await browser.eval('window.beforeNav = 1')\n\n      await browser.back()\n      await browser.waitForElementByCss('#to-blog-first')\n      expect(await browser.eval('window.beforeNav')).toBeFalsy()\n    })","file":"production/prerender-prefetch/index.test.ts","skipped":false,"dir":"test"},{"name":"rejects with 400 for get requests","suites":["reading request body in middleware"],"updatePoint":{"line":54,"column":39},"line":54,"code":"  it('rejects with 400 for get requests', async () => {\n    const response = await fetchViaHTTP(next.url, '/')\n    expect(response.status).toEqual(400)\n  })","file":"production/reading-request-body-in-middleware/index.test.ts","skipped":false,"dir":"test"},{"name":"returns root: true for root calls","suites":["reading request body in middleware"],"updatePoint":{"line":59,"column":39},"line":59,"code":"  it('returns root: true for root calls', async () => {\n    const response = await fetchViaHTTP(\n      next.url,\n      '/',\n      {},\n      {\n        method: 'POST',\n        body: JSON.stringify({\n          foo: 'bar',\n        }),\n      }\n    )\n    expect(response.status).toEqual(200)\n    expect(JSON.parse(response.headers.get('data'))).toEqual({\n      foo: 'bar',\n      root: true,\n    })\n  })","file":"production/reading-request-body-in-middleware/index.test.ts","skipped":false,"dir":"test"},{"name":"passes the body to the api endpoint","suites":["reading request body in middleware"],"updatePoint":{"line":78,"column":41},"line":78,"code":"  it('passes the body to the api endpoint', async () => {\n    const response = await fetchViaHTTP(\n      next.url,\n      '/api/hi',\n      {\n        next: '1',\n      },\n      {\n        method: 'POST',\n        headers: {\n          'content-type': 'application/json',\n        },\n        body: JSON.stringify({\n          foo: 'bar',\n        }),\n      }\n    )\n    expect(response.status).toEqual(200)\n    expect(await response.json()).toEqual({\n      foo: 'bar',\n      api: true,\n    })\n    expect(response.headers.get('x-from-root-middleware')).toEqual('1')\n    expect(response.headers.has('data')).toBe(false)\n  })","file":"production/reading-request-body-in-middleware/index.test.ts","skipped":false,"dir":"test"},{"name":"passes the body to the api endpoint when no body is consumed on middleware","suites":["reading request body in middleware"],"updatePoint":{"line":104,"column":80},"line":104,"code":"  it('passes the body to the api endpoint when no body is consumed on middleware', async () => {\n    const response = await fetchViaHTTP(\n      next.url,\n      '/api/hi',\n      {\n        next: '1',\n        no_reading: '1',\n      },\n      {\n        method: 'POST',\n        headers: {\n          'content-type': 'application/json',\n        },\n        body: JSON.stringify({\n          foo: 'bar',\n        }),\n      }\n    )\n    expect(response.status).toEqual(200)\n    expect(await response.json()).toEqual({\n      foo: 'bar',\n      api: true,\n    })\n    expect(response.headers.get('x-from-root-middleware')).toEqual('1')\n    expect(response.headers.has('data')).toBe(false)\n  })","file":"production/reading-request-body-in-middleware/index.test.ts","skipped":false,"dir":"test"},{"name":"should not apply locale redirect in minimal mode","suites":["should set-up next"],"updatePoint":{"line":138,"column":54},"line":138,"code":"  it('should not apply locale redirect in minimal mode', async () => {\n    const res = await fetchViaHTTP(appPort, '/', undefined, {\n      redirect: 'manual',\n      headers: {\n        'accept-language': 'fr',\n      },\n    })\n    expect(res.status).toBe(200)\n    expect(await res.text()).toContain('index page')\n\n    const resCookie = await fetchViaHTTP(appPort, '/', undefined, {\n      redirect: 'manual',\n      headers: {\n        'accept-language': 'en',\n        cookie: 'NEXT_LOCALE=fr',\n      },\n    })\n    expect(resCookie.status).toBe(200)\n    expect(await resCookie.text()).toContain('index page')\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should output required-server-files manifest correctly","suites":["should set-up next"],"updatePoint":{"line":159,"column":60},"line":159,"code":"  it('should output required-server-files manifest correctly', async () => {\n    expect(requiredFilesManifest.version).toBe(1)\n    expect(Array.isArray(requiredFilesManifest.files)).toBe(true)\n    expect(Array.isArray(requiredFilesManifest.ignore)).toBe(true)\n    expect(requiredFilesManifest.files.length).toBeGreaterThan(0)\n    expect(requiredFilesManifest.ignore.length).toBeGreaterThan(0)\n    expect(typeof requiredFilesManifest.config.configFile).toBe('undefined')\n    expect(typeof requiredFilesManifest.config.trailingSlash).toBe('boolean')\n    expect(typeof requiredFilesManifest.appDir).toBe('string')\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should set correct SWR headers with notFound gsp","suites":["should set-up next"],"updatePoint":{"line":170,"column":54},"line":170,"code":"  it('should set correct SWR headers with notFound gsp', async () => {\n    await next.patchFile('standalone/data.txt', 'show')\n\n    const res = await fetchViaHTTP(appPort, '/gsp', undefined, {\n      redirect: 'manual',\n    })\n    expect(res.status).toBe(200)\n    expect(res.headers.get('cache-control')).toBe(\n      's-maxage=1, stale-while-revalidate'\n    )\n\n    await waitFor(2000)\n    await next.patchFile('standalone/data.txt', 'hide')\n\n    const res2 = await fetchViaHTTP(appPort, '/gsp', undefined, {\n      redirect: 'manual',\n    })\n    expect(res2.status).toBe(404)\n    expect(res2.headers.get('cache-control')).toBe(\n      's-maxage=1, stale-while-revalidate'\n    )\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should set correct SWR headers with notFound gssp","suites":["should set-up next"],"updatePoint":{"line":193,"column":55},"line":193,"code":"  it('should set correct SWR headers with notFound gssp', async () => {\n    await next.patchFile('standalone/data.txt', 'show')\n\n    const res = await fetchViaHTTP(appPort, '/gssp', undefined, {\n      redirect: 'manual',\n    })\n    expect(res.status).toBe(200)\n    expect(res.headers.get('cache-control')).toBe(\n      's-maxage=1, stale-while-revalidate'\n    )\n\n    await next.patchFile('standalone/data.txt', 'hide')\n\n    const res2 = await fetchViaHTTP(appPort, '/gssp', undefined, {\n      redirect: 'manual',\n    })\n    await next.patchFile('standalone/data.txt', 'show')\n\n    expect(res2.status).toBe(404)\n    expect(res2.headers.get('cache-control')).toBe(\n      's-maxage=1, stale-while-revalidate'\n    )\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should render SSR page correctly","suites":["should set-up next"],"updatePoint":{"line":217,"column":38},"line":217,"code":"  it('should render SSR page correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/gssp')\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#gssp').text()).toBe('getServerSideProps page')\n    expect(data.hello).toBe('world')\n\n    const html2 = await renderViaHTTP(appPort, '/gssp')\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#gssp').text()).toBe('getServerSideProps page')\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should render dynamic SSR page correctly","suites":["should set-up next"],"updatePoint":{"line":234,"column":46},"line":234,"code":"  it('should render dynamic SSR page correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/dynamic/first')\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#dynamic').text()).toBe('dynamic page')\n    expect($('#slug').text()).toBe('first')\n    expect(data.hello).toBe('world')\n\n    const html2 = await renderViaHTTP(appPort, '/dynamic/second')\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#dynamic').text()).toBe('dynamic page')\n    expect($2('#slug').text()).toBe('second')\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should render fallback page correctly","suites":["should set-up next"],"updatePoint":{"line":253,"column":43},"line":253,"code":"  it('should render fallback page correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/fallback/first')\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#fallback').text()).toBe('fallback page')\n    expect($('#slug').text()).toBe('first')\n    expect(data.hello).toBe('world')\n\n    await waitFor(2000)\n    const html2 = await renderViaHTTP(appPort, '/fallback/first')\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#fallback').text()).toBe('fallback page')\n    expect($2('#slug').text()).toBe('first')\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n\n    const html3 = await renderViaHTTP(appPort, '/fallback/second')\n    const $3 = cheerio.load(html3)\n    const data3 = JSON.parse($3('#props').text())\n\n    expect($3('#fallback').text()).toBe('fallback page')\n    expect($3('#slug').text()).toBe('second')\n    expect(isNaN(data3.random)).toBe(false)\n\n    const { pageProps: data4 } = JSON.parse(\n      await renderViaHTTP(\n        appPort,\n        `/_next/data/${next.buildId}/en/fallback/third.json`\n      )\n    )\n    expect(data4.hello).toBe('world')\n    expect(data4.slug).toBe('third')\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should render SSR page correctly with x-matched-path","suites":["should set-up next"],"updatePoint":{"line":290,"column":58},"line":290,"code":"  it('should render SSR page correctly with x-matched-path', async () => {\n    const html = await renderViaHTTP(appPort, '/some-other-path', undefined, {\n      headers: {\n        'x-matched-path': '/gssp',\n      },\n    })\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#gssp').text()).toBe('getServerSideProps page')\n    expect(data.hello).toBe('world')\n\n    const html2 = await renderViaHTTP(appPort, '/some-other-path', undefined, {\n      headers: {\n        'x-matched-path': '/gssp',\n      },\n    })\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#gssp').text()).toBe('getServerSideProps page')\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should render dynamic SSR page correctly with x-matched-path","suites":["should set-up next"],"updatePoint":{"line":315,"column":66},"line":315,"code":"  it('should render dynamic SSR page correctly with x-matched-path', async () => {\n    const html = await renderViaHTTP(\n      appPort,\n      '/some-other-path?slug=first',\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/dynamic/[slug]',\n        },\n      }\n    )\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#dynamic').text()).toBe('dynamic page')\n    expect($('#slug').text()).toBe('first')\n    expect(data.hello).toBe('world')\n\n    const html2 = await renderViaHTTP(\n      appPort,\n      '/some-other-path?slug=second',\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/dynamic/[slug]',\n        },\n      }\n    )\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#dynamic').text()).toBe('dynamic page')\n    expect($2('#slug').text()).toBe('second')\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n\n    const html3 = await renderViaHTTP(appPort, '/some-other-path', undefined, {\n      headers: {\n        'x-matched-path': '/dynamic/[slug]?slug=%5Bslug%5D.json',\n        'x-now-route-matches': '1=second&slug=second',\n      },\n    })\n    const $3 = cheerio.load(html3)\n    const data3 = JSON.parse($3('#props').text())\n\n    expect($3('#dynamic').text()).toBe('dynamic page')\n    expect($3('#slug').text()).toBe('second')\n    expect(isNaN(data3.random)).toBe(false)\n    expect(data3.random).not.toBe(data.random)\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should render fallback page correctly with x-matched-path and routes-matches","suites":["should set-up next"],"updatePoint":{"line":366,"column":82},"line":366,"code":"  it('should render fallback page correctly with x-matched-path and routes-matches', async () => {\n    const html = await renderViaHTTP(appPort, '/fallback/first', undefined, {\n      headers: {\n        'x-matched-path': '/fallback/first',\n        'x-now-route-matches': '1=first',\n      },\n    })\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#fallback').text()).toBe('fallback page')\n    expect($('#slug').text()).toBe('first')\n    expect(data.hello).toBe('world')\n\n    const html2 = await renderViaHTTP(appPort, `/fallback/[slug]`, undefined, {\n      headers: {\n        'x-matched-path': '/fallback/[slug]',\n        'x-now-route-matches': '1=second',\n      },\n    })\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#fallback').text()).toBe('fallback page')\n    expect($2('#slug').text()).toBe('second')\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should return data correctly with x-matched-path","suites":["should set-up next"],"updatePoint":{"line":395,"column":54},"line":395,"code":"  it('should return data correctly with x-matched-path', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${next.buildId}/en/dynamic/first.json?slug=first`,\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/dynamic/[slug]',\n        },\n      }\n    )\n\n    const { pageProps: data } = await res.json()\n\n    expect(data.slug).toBe('first')\n    expect(data.hello).toBe('world')\n\n    const res2 = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${next.buildId}/en/fallback/[slug].json`,\n      undefined,\n      {\n        headers: {\n          'x-matched-path': `/_next/data/${next.buildId}/en/fallback/[slug].json`,\n          'x-now-route-matches': '1=second',\n        },\n      }\n    )\n\n    const { pageProps: data2 } = await res2.json()\n\n    expect(data2.slug).toBe('second')\n    expect(data2.hello).toBe('world')\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should render fallback optional catch-all route correctly with x-matched-path and routes-matches","suites":["should set-up next"],"updatePoint":{"line":430,"column":102},"line":430,"code":"  it('should render fallback optional catch-all route correctly with x-matched-path and routes-matches', async () => {\n    const html = await renderViaHTTP(\n      appPort,\n      '/catch-all/[[...rest]]',\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/catch-all/[[...rest]]',\n          'x-now-route-matches': '',\n        },\n      }\n    )\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#catch-all').text()).toBe('optional catch-all page')\n    expect(data.params).toEqual({})\n    expect(data.hello).toBe('world')\n\n    const html2 = await renderViaHTTP(\n      appPort,\n      '/catch-all/[[...rest]]',\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/catch-all/[[...rest]]',\n          'x-now-route-matches': '1=hello&catchAll=hello',\n        },\n      }\n    )\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#catch-all').text()).toBe('optional catch-all page')\n    expect(data2.params).toEqual({ rest: ['hello'] })\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n\n    const html3 = await renderViaHTTP(\n      appPort,\n      '/catch-all/[[...rest]]',\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/catch-all/[[...rest]]',\n          'x-now-route-matches': '1=hello/world&catchAll=hello/world',\n        },\n      }\n    )\n    const $3 = cheerio.load(html3)\n    const data3 = JSON.parse($3('#props').text())\n\n    expect($3('#catch-all').text()).toBe('optional catch-all page')\n    expect(data3.params).toEqual({ rest: ['hello', 'world'] })\n    expect(isNaN(data3.random)).toBe(false)\n    expect(data3.random).not.toBe(data.random)\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should return data correctly with x-matched-path for optional catch-all route","suites":["should set-up next"],"updatePoint":{"line":488,"column":83},"line":488,"code":"  it('should return data correctly with x-matched-path for optional catch-all route', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${next.buildId}/en/catch-all.json`,\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/en/catch-all/[[...rest]]',\n        },\n      }\n    )\n\n    const { pageProps: data } = await res.json()\n\n    expect(data.params).toEqual({})\n    expect(data.hello).toBe('world')\n\n    const res2 = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${next.buildId}/en/catch-all/[[...rest]].json`,\n      undefined,\n      {\n        headers: {\n          'x-matched-path': `/_next/data/${next.buildId}/en/catch-all/[[...rest]].json`,\n          'x-now-route-matches': '1=hello&rest=hello',\n        },\n      }\n    )\n\n    const { pageProps: data2 } = await res2.json()\n\n    expect(data2.params).toEqual({ rest: ['hello'] })\n    expect(data2.hello).toBe('world')\n\n    const res3 = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${next.buildId}/en/catch-all/[[...rest]].json`,\n      undefined,\n      {\n        headers: {\n          'x-matched-path': `/_next/data/${next.buildId}/en/catch-all/[[...rest]].json`,\n          'x-now-route-matches': '1=hello/world&rest=hello/world',\n        },\n      }\n    )\n\n    const { pageProps: data3 } = await res3.json()\n\n    expect(data3.params).toEqual({ rest: ['hello', 'world'] })\n    expect(data3.hello).toBe('world')\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should not apply trailingSlash redirect","suites":["should set-up next"],"updatePoint":{"line":540,"column":45},"line":540,"code":"  it('should not apply trailingSlash redirect', async () => {\n    for (const path of [\n      '/',\n      '/dynamic/another/',\n      '/dynamic/another',\n      '/fallback/first/',\n      '/fallback/first',\n      '/fallback/another/',\n      '/fallback/another',\n    ]) {\n      const res = await fetchViaHTTP(appPort, path, undefined, {\n        redirect: 'manual',\n      })\n\n      expect(res.status).toBe(200)\n    }\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should normalize catch-all rewrite query values correctly","suites":["should set-up next"],"updatePoint":{"line":558,"column":63},"line":558,"code":"  it('should normalize catch-all rewrite query values correctly', async () => {\n    const html = await renderViaHTTP(\n      appPort,\n      '/some-catch-all/hello/world',\n      {\n        path: 'hello/world',\n      },\n      {\n        headers: {\n          'x-matched-path': '/gssp',\n        },\n      }\n    )\n    const $ = cheerio.load(html)\n    expect(JSON.parse($('#router').text()).query.path).toEqual([\n      'hello',\n      'world',\n    ])\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should handle bad request correctly with rewrite","suites":["should set-up next"],"updatePoint":{"line":578,"column":54},"line":578,"code":"  it('should handle bad request correctly with rewrite', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/to-dynamic/%c0.%c0.',\n      '?path=%c0.%c0.',\n      {\n        headers: {\n          'x-matched-path': '/dynamic/[slug]',\n        },\n      }\n    )\n    expect(res.status).toBe(400)\n    expect(await res.text()).toContain('Bad Request')\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should bubble error correctly for gip page","suites":["should set-up next"],"updatePoint":{"line":593,"column":48},"line":593,"code":"  it('should bubble error correctly for gip page', async () => {\n    errors = []\n    const res = await fetchViaHTTP(appPort, '/errors/gip', { crash: '1' })\n    expect(res.status).toBe(500)\n    expect(await res.text()).toBe('internal server error')\n\n    await check(\n      () => (errors[0].includes('gip hit an oops') ? 'success' : errors[0]),\n      'success'\n    )\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should bubble error correctly for gssp page","suites":["should set-up next"],"updatePoint":{"line":605,"column":49},"line":605,"code":"  it('should bubble error correctly for gssp page', async () => {\n    errors = []\n    const res = await fetchViaHTTP(appPort, '/errors/gssp', { crash: '1' })\n    expect(res.status).toBe(500)\n    expect(await res.text()).toBe('internal server error')\n    await check(\n      () => (errors[0].includes('gssp hit an oops') ? 'success' : errors[0]),\n      'success'\n    )\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should bubble error correctly for gsp page","suites":["should set-up next"],"updatePoint":{"line":616,"column":48},"line":616,"code":"  it('should bubble error correctly for gsp page', async () => {\n    errors = []\n    const res = await fetchViaHTTP(appPort, '/errors/gsp/crash')\n    expect(res.status).toBe(500)\n    expect(await res.text()).toBe('internal server error')\n    await check(\n      () => (errors[0].includes('gsp hit an oops') ? 'success' : errors[0]),\n      'success'\n    )\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should bubble error correctly for API page","suites":["should set-up next"],"updatePoint":{"line":627,"column":48},"line":627,"code":"  it('should bubble error correctly for API page', async () => {\n    errors = []\n    const res = await fetchViaHTTP(appPort, '/api/error')\n    expect(res.status).toBe(500)\n    expect(await res.text()).toBe('internal server error')\n    await check(\n      () =>\n        errors[0].includes('some error from /api/error')\n          ? 'success'\n          : errors[0],\n      'success'\n    )\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should normalize optional values correctly for SSP page","suites":["should set-up next"],"updatePoint":{"line":641,"column":61},"line":641,"code":"  it('should normalize optional values correctly for SSP page', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/optional-ssp',\n      { rest: '', another: 'value' },\n      {\n        headers: {\n          'x-matched-path': '/optional-ssp/[[...rest]]',\n        },\n      }\n    )\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n    const props = JSON.parse($('#props').text())\n    expect(props.params).toEqual({})\n    expect(props.query).toEqual({ another: 'value' })\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should normalize optional values correctly for SSG page","suites":["should set-up next"],"updatePoint":{"line":660,"column":61},"line":660,"code":"  it('should normalize optional values correctly for SSG page', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/en/optional-ssg/[[...rest]]',\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/en/optional-ssg/[[...rest]]',\n          'x-now-route-matches': 'nextLocale=en&1=en',\n        },\n      }\n    )\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n    const props = JSON.parse($('#props').text())\n    expect(props.params).toEqual({})\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should normalize optional values correctly for nested optional SSG page","suites":["should set-up next"],"updatePoint":{"line":679,"column":77},"line":679,"code":"  it('should normalize optional values correctly for nested optional SSG page', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/en/[slug]/social/[[...rest]]',\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/en/[slug]/social/[[...rest]]',\n          'x-now-route-matches': 'nextLocale=en&1=en&2=user-123&slug=user-123',\n        },\n      }\n    )\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n    const props = JSON.parse($('#props').text())\n    expect(props.params).toEqual({\n      slug: 'user-123',\n    })\n    expect($('#page').text()).toBe('/[slug]/social/[[...rest]]')\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should normalize optional values correctly for SSG page with encoded slash","suites":["should set-up next"],"updatePoint":{"line":701,"column":80},"line":701,"code":"  it('should normalize optional values correctly for SSG page with encoded slash', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/optional-ssg/[[...rest]]',\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/optional-ssg/[[...rest]]',\n          'x-now-route-matches':\n            '1=en%2Fes%2Fhello%252Fworld&rest=en%2Fes%2Fhello%252Fworld',\n        },\n      }\n    )\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n    const props = JSON.parse($('#props').text())\n    expect(props.params).toEqual({\n      rest: ['en', 'es', 'hello/world'],\n    })\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should normalize optional values correctly for API page","suites":["should set-up next"],"updatePoint":{"line":723,"column":61},"line":723,"code":"  it('should normalize optional values correctly for API page', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/api/optional',\n      { rest: '', another: 'value' },\n      {\n        headers: {\n          'x-matched-path': '/api/optional/[[...rest]]',\n        },\n      }\n    )\n\n    const json = await res.json()\n    expect(json.query).toEqual({ another: 'value' })\n    expect(json.url).toBe('/api/optional?another=value')\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should match the index page correctly","suites":["should set-up next"],"updatePoint":{"line":740,"column":43},"line":740,"code":"  it('should match the index page correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/', undefined, {\n      headers: {\n        'x-matched-path': '/index',\n      },\n      redirect: 'manual',\n    })\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n    expect($('#index').text()).toBe('index page')\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should match the root dyanmic page correctly","suites":["should set-up next"],"updatePoint":{"line":753,"column":50},"line":753,"code":"  it('should match the root dyanmic page correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/slug-1', undefined, {\n      headers: {\n        'x-matched-path': '/[slug]',\n      },\n      redirect: 'manual',\n    })\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n    expect($('#slug-page').text()).toBe('[slug] page')\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should have the correct asPath for fallback page","suites":["should set-up next"],"updatePoint":{"line":766,"column":54},"line":766,"code":"  it('should have the correct asPath for fallback page', async () => {\n    const res = await fetchViaHTTP(appPort, '/en/fallback/[slug]', undefined, {\n      headers: {\n        'x-matched-path': '/en/fallback/[slug]',\n        'x-now-route-matches': '2=another&slug=another&1=en&nextLocale=en',\n      },\n      redirect: 'manual',\n    })\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n    expect($('#fallback').text()).toBe('fallback page')\n    expect($('#slug').text()).toBe('another')\n    expect(JSON.parse($('#router').text()).asPath).toBe('/fallback/another')\n    expect(JSON.parse($('#router').text()).query.slug).toBe('another')\n    expect(JSON.parse($('#router').text()).locale).toBe('en')\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should have the correct asPath for fallback page locale","suites":["should set-up next"],"updatePoint":{"line":784,"column":61},"line":784,"code":"  it('should have the correct asPath for fallback page locale', async () => {\n    const res = await fetchViaHTTP(appPort, '/fr/fallback/[slug]', undefined, {\n      headers: {\n        'x-matched-path': '/fr/fallback/[slug]',\n        'x-now-route-matches': '2=another&slug=another&1=fr&nextLocale=fr',\n      },\n      redirect: 'manual',\n    })\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n    expect($('#fallback').text()).toBe('fallback page')\n    expect($('#slug').text()).toBe('another')\n    expect(JSON.parse($('#router').text()).asPath).toBe('/fallback/another')\n    expect(JSON.parse($('#router').text()).query.slug).toBe('another')\n    expect(JSON.parse($('#router').text()).locale).toBe('fr')\n  })","file":"production/required-server-files-i18n.test.ts","skipped":false,"dir":"test"},{"name":"should resolve correctly when a redirect is returned","suites":["should set-up next"],"updatePoint":{"line":141,"column":58},"line":141,"code":"  it('should resolve correctly when a redirect is returned', async () => {\n    const toRename = `standalone/.next/server/pages/route-resolving/[slug]/[project].html`\n    await next.renameFile(toRename, `${toRename}.bak`)\n    try {\n      const res = await fetchViaHTTP(\n        appPort,\n        '/route-resolving/import/first',\n        undefined,\n        {\n          redirect: 'manual',\n          headers: {\n            'x-matched-path': '/route-resolving/import/[slug]',\n          },\n        }\n      )\n      expect(res.status).toBe(307)\n      expect(new URL(res.headers.get('location'), 'http://n').pathname).toBe(\n        '/somewhere'\n      )\n\n      await waitFor(3000)\n      expect(stderr).not.toContain('ENOENT')\n    } finally {\n      await next.renameFile(`${toRename}.bak`, toRename)\n    }\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should show invariant when an automatic static page is requested","suites":["should set-up next"],"updatePoint":{"line":168,"column":70},"line":168,"code":"  it('should show invariant when an automatic static page is requested', async () => {\n    const toRename = `standalone/.next/server/pages/auto-static.html`\n    await next.renameFile(toRename, `${toRename}.bak`)\n\n    try {\n      const res = await fetchViaHTTP(appPort, '/auto-static', undefined, {\n        headers: {\n          'x-matched-path': '/auto-static',\n        },\n      })\n\n      expect(res.status).toBe(500)\n      await check(() => stderr, /Invariant: failed to load static page/)\n    } finally {\n      await next.renameFile(`${toRename}.bak`, toRename)\n    }\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should have correct cache-control for $case","suites":["should set-up next"],"line":186,"code":"  it.each([\n    {\n      case: 'redirect no revalidate',\n      path: '/optional-ssg/redirect-1',\n      dest: '/somewhere',\n      cacheControl: 's-maxage=31536000, stale-while-revalidate',\n    },\n    {\n      case: 'redirect with revalidate',\n      path: '/optional-ssg/redirect-2',\n      dest: '/somewhere-else',\n      cacheControl: 's-maxage=5, stale-while-revalidate',\n    },\n  ])(\n    `should have correct cache-control for $case`,\n    async ({ path, dest, cacheControl }) => {\n      const res = await fetchViaHTTP(appPort, path, undefined, {\n        redirect: 'manual',\n      })\n      expect(res.status).toBe(307)\n      expect(new URL(res.headers.get('location'), 'http://n').pathname).toBe(\n        dest\n      )\n      expect(res.headers.get('cache-control')).toBe(cacheControl)\n\n      const dataRes = await fetchViaHTTP(\n        appPort,\n        `/_next/data/${next.buildId}${path}.json`,\n        undefined,\n        {\n          redirect: 'manual',\n        }\n      )\n      expect(dataRes.headers.get('cache-control')).toBe(cacheControl)\n      expect((await dataRes.json()).pageProps).toEqual({\n        __N_REDIRECT: dest,\n        __N_REDIRECT_STATUS: 307,\n      })\n    }\n  )","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should have correct cache-control for $case","suites":["should set-up next"],"line":227,"code":"  it.each([\n    {\n      case: 'notFound no revalidate',\n      path: '/optional-ssg/not-found-1',\n      dest: '/somewhere',\n      cacheControl: 's-maxage=31536000, stale-while-revalidate',\n    },\n    {\n      case: 'notFound with revalidate',\n      path: '/optional-ssg/not-found-2',\n      dest: '/somewhere-else',\n      cacheControl: 's-maxage=5, stale-while-revalidate',\n    },\n  ])(\n    `should have correct cache-control for $case`,\n    async ({ path, dest, cacheControl }) => {\n      const res = await fetchViaHTTP(appPort, path, undefined, {\n        redirect: 'manual',\n      })\n      expect(res.status).toBe(404)\n      expect(res.headers.get('cache-control')).toBe(cacheControl)\n\n      const dataRes = await fetchViaHTTP(\n        appPort,\n        `/_next/data/${next.buildId}${path}.json`,\n        undefined,\n        {\n          redirect: 'manual',\n        }\n      )\n      expect(dataRes.headers.get('cache-control')).toBe(cacheControl)\n    }\n  )","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should have the correct cache-control for props with no revalidate","suites":["should set-up next"],"updatePoint":{"line":261,"column":72},"line":261,"code":"  it('should have the correct cache-control for props with no revalidate', async () => {\n    const res = await fetchViaHTTP(appPort, '/optional-ssg/props-no-revalidate')\n    expect(res.status).toBe(200)\n    expect(res.headers.get('cache-control')).toBe(\n      's-maxage=31536000, stale-while-revalidate'\n    )\n    const $ = cheerio.load(await res.text())\n    expect(JSON.parse($('#props').text()).params).toEqual({\n      rest: ['props-no-revalidate'],\n    })\n\n    const dataRes = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${next.buildId}/optional-ssg/props-no-revalidate.json`,\n      undefined\n    )\n    expect(dataRes.status).toBe(200)\n    expect(res.headers.get('cache-control')).toBe(\n      's-maxage=31536000, stale-while-revalidate'\n    )\n    expect((await dataRes.json()).pageProps.params).toEqual({\n      rest: ['props-no-revalidate'],\n    })\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should warn when \"next\" is imported directly","suites":["should set-up next"],"updatePoint":{"line":286,"column":50},"line":286,"code":"  it('should warn when \"next\" is imported directly', async () => {\n    await renderViaHTTP(appPort, '/gssp')\n    await check(\n      () => stderr,\n      /\"next\" should not be imported directly, imported in/\n    )\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"`compress` should be `true` by default","suites":["should set-up next"],"updatePoint":{"line":294,"column":44},"line":294,"code":"  it('`compress` should be `true` by default', async () => {\n    expect(\n      await fs.readFileSync(join(next.testDir, 'standalone/server.js'), 'utf8')\n    ).toContain('\"compress\":true')\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should output middleware correctly","suites":["should set-up next"],"updatePoint":{"line":300,"column":40},"line":300,"code":"  it('should output middleware correctly', async () => {\n    expect(\n      await fs.pathExists(\n        join(next.testDir, 'standalone/.next/server/edge-runtime-webpack.js')\n      )\n    ).toBe(true)\n    expect(\n      await fs.pathExists(\n        join(next.testDir, 'standalone/.next/server/middleware.js')\n      )\n    ).toBe(true)\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should output required-server-files manifest correctly","suites":["should set-up next"],"updatePoint":{"line":313,"column":60},"line":313,"code":"  it('should output required-server-files manifest correctly', async () => {\n    expect(requiredFilesManifest.version).toBe(1)\n    expect(Array.isArray(requiredFilesManifest.files)).toBe(true)\n    expect(Array.isArray(requiredFilesManifest.ignore)).toBe(true)\n    expect(requiredFilesManifest.files.length).toBeGreaterThan(0)\n    expect(requiredFilesManifest.ignore.length).toBeGreaterThan(0)\n    expect(typeof requiredFilesManifest.config.configFile).toBe('undefined')\n    expect(typeof requiredFilesManifest.config.trailingSlash).toBe('boolean')\n    expect(typeof requiredFilesManifest.appDir).toBe('string')\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should de-dupe HTML/data requests","suites":["should set-up next"],"updatePoint":{"line":324,"column":39},"line":324,"code":"  it('should de-dupe HTML/data requests', async () => {\n    const res = await fetchViaHTTP(appPort, '/gsp', undefined, {\n      redirect: 'manual',\n      headers: {\n        // ensure the nextjs-data header being present\n        // doesn't incorrectly return JSON for HTML path\n        // during prerendering\n        'x-nextjs-data': '1',\n      },\n    })\n    expect(res.status).toBe(200)\n    expect(res.headers.get('x-nextjs-cache')).toBeFalsy()\n    const $ = cheerio.load(await res.text())\n    const props = JSON.parse($('#props').text())\n    expect(props.gspCalls).toBeDefined()\n\n    const res2 = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${next.buildId}/gsp.json`,\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n    expect(res2.status).toBe(200)\n    expect(res2.headers.get('x-nextjs-cache')).toBeFalsy()\n    const { pageProps: props2 } = await res2.json()\n    expect(props2.gspCalls).toBe(props.gspCalls)\n\n    const res3 = await fetchViaHTTP(appPort, '/index', undefined, {\n      redirect: 'manual',\n      headers: {\n        'x-matched-path': '/index',\n      },\n    })\n    expect(res3.status).toBe(200)\n    const $2 = cheerio.load(await res3.text())\n    const props3 = JSON.parse($2('#props').text())\n    expect(props3.gspCalls).toBeDefined()\n\n    const res4 = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${next.buildId}/index.json`,\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n    expect(res4.status).toBe(200)\n    const { pageProps: props4 } = await res4.json()\n    expect(props4.gspCalls).toBe(props3.gspCalls)\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should cap de-dupe previousCacheItem expires time","suites":["should set-up next"],"updatePoint":{"line":377,"column":55},"line":377,"code":"  it('should cap de-dupe previousCacheItem expires time', async () => {\n    const res = await fetchViaHTTP(appPort, '/gsp-long-revalidate', undefined, {\n      redirect: 'manual',\n    })\n    expect(res.status).toBe(200)\n    const $ = cheerio.load(await res.text())\n    const props = JSON.parse($('#props').text())\n    expect(props.gspCalls).toBeDefined()\n\n    await waitFor(1000)\n\n    const res2 = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${next.buildId}/gsp-long-revalidate.json`,\n      undefined,\n      {\n        redirect: 'manual',\n      }\n    )\n    expect(res2.status).toBe(200)\n    const { pageProps: props2 } = await res2.json()\n    expect(props2.gspCalls).not.toBe(props.gspCalls)\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should not 404 for onlyGenerated manual revalidate in minimal mode","suites":["should set-up next"],"updatePoint":{"line":401,"column":72},"line":401,"code":"  it('should not 404 for onlyGenerated manual revalidate in minimal mode', async () => {\n    const previewProps = JSON.parse(\n      await next.readFile('standalone/.next/prerender-manifest.json')\n    ).preview\n\n    const res = await fetchViaHTTP(\n      appPort,\n      '/optional-ssg/only-generated-1',\n      undefined,\n      {\n        headers: {\n          'x-prerender-revalidate': previewProps.previewModeId,\n          'x-prerender-revalidate-if-generated': '1',\n        },\n      }\n    )\n    expect(res.status).toBe(200)\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should set correct SWR headers with notFound gsp","suites":["should set-up next"],"updatePoint":{"line":420,"column":54},"line":420,"code":"  it('should set correct SWR headers with notFound gsp', async () => {\n    await waitFor(2000)\n    await next.patchFile('standalone/data.txt', 'show')\n\n    const res = await fetchViaHTTP(appPort, '/gsp', undefined, {\n      redirect: 'manual',\n    })\n    expect(res.status).toBe(200)\n    expect(res.headers.get('cache-control')).toBe(\n      's-maxage=1, stale-while-revalidate'\n    )\n\n    await waitFor(2000)\n    await next.patchFile('standalone/data.txt', 'hide')\n\n    const res2 = await fetchViaHTTP(appPort, '/gsp', undefined, {\n      redirect: 'manual',\n    })\n    expect(res2.status).toBe(404)\n    expect(res2.headers.get('cache-control')).toBe(\n      's-maxage=1, stale-while-revalidate'\n    )\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should set correct SWR headers with notFound gssp","suites":["should set-up next"],"updatePoint":{"line":444,"column":55},"line":444,"code":"  it('should set correct SWR headers with notFound gssp', async () => {\n    await next.patchFile('standalone/data.txt', 'show')\n\n    const res = await fetchViaHTTP(appPort, '/gssp', undefined, {\n      redirect: 'manual',\n    })\n    expect(res.status).toBe(200)\n    expect(res.headers.get('cache-control')).toBe(\n      's-maxage=1, stale-while-revalidate'\n    )\n\n    await next.patchFile('standalone/data.txt', 'hide')\n\n    const res2 = await fetchViaHTTP(appPort, '/gssp', undefined, {\n      redirect: 'manual',\n    })\n    await next.patchFile('standalone/data.txt', 'show')\n\n    expect(res2.status).toBe(404)\n    expect(res2.headers.get('cache-control')).toBe(\n      's-maxage=1, stale-while-revalidate'\n    )\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should render SSR page correctly","suites":["should set-up next"],"updatePoint":{"line":468,"column":38},"line":468,"code":"  it('should render SSR page correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/gssp')\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#gssp').text()).toBe('getServerSideProps page')\n    expect(data.hello).toBe('world')\n\n    const html2 = await renderViaHTTP(appPort, '/gssp')\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#gssp').text()).toBe('getServerSideProps page')\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should render dynamic SSR page correctly","suites":["should set-up next"],"updatePoint":{"line":485,"column":46},"line":485,"code":"  it('should render dynamic SSR page correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/dynamic/first')\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#dynamic').text()).toBe('dynamic page')\n    expect($('#slug').text()).toBe('first')\n    expect(data.hello).toBe('world')\n\n    const html2 = await renderViaHTTP(appPort, '/dynamic/second')\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#dynamic').text()).toBe('dynamic page')\n    expect($2('#slug').text()).toBe('second')\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should render fallback page correctly","suites":["should set-up next"],"updatePoint":{"line":504,"column":43},"line":504,"code":"  it('should render fallback page correctly', async () => {\n    const html = await renderViaHTTP(appPort, '/fallback/first')\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#fallback').text()).toBe('fallback page')\n    expect($('#slug').text()).toBe('first')\n    expect(data.hello).toBe('world')\n\n    await waitFor(2000)\n    const html2 = await renderViaHTTP(appPort, '/fallback/first')\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#fallback').text()).toBe('fallback page')\n    expect($2('#slug').text()).toBe('first')\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n\n    const html3 = await renderViaHTTP(appPort, '/fallback/second')\n    const $3 = cheerio.load(html3)\n    const data3 = JSON.parse($3('#props').text())\n\n    expect($3('#fallback').text()).toBe('fallback page')\n    expect($3('#slug').text()).toBe('second')\n    expect(isNaN(data3.random)).toBe(false)\n\n    const { pageProps: data4 } = JSON.parse(\n      await renderViaHTTP(\n        appPort,\n        `/_next/data/${next.buildId}/fallback/third.json`\n      )\n    )\n    expect(data4.hello).toBe('world')\n    expect(data4.slug).toBe('third')\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should render SSR page correctly with x-matched-path","suites":["should set-up next"],"updatePoint":{"line":541,"column":58},"line":541,"code":"  it('should render SSR page correctly with x-matched-path', async () => {\n    const html = await renderViaHTTP(appPort, '/some-other-path', undefined, {\n      headers: {\n        'x-matched-path': '/gssp',\n      },\n    })\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#gssp').text()).toBe('getServerSideProps page')\n    expect(data.hello).toBe('world')\n\n    const html2 = await renderViaHTTP(appPort, '/some-other-path', undefined, {\n      headers: {\n        'x-matched-path': '/gssp',\n      },\n    })\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#gssp').text()).toBe('getServerSideProps page')\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should render dynamic SSR page correctly with x-matched-path","suites":["should set-up next"],"updatePoint":{"line":566,"column":66},"line":566,"code":"  it('should render dynamic SSR page correctly with x-matched-path', async () => {\n    const html = await renderViaHTTP(\n      appPort,\n      '/some-other-path?slug=first',\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/dynamic/[slug]',\n        },\n      }\n    )\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#dynamic').text()).toBe('dynamic page')\n    expect($('#slug').text()).toBe('first')\n    expect(data.hello).toBe('world')\n\n    const html2 = await renderViaHTTP(\n      appPort,\n      '/some-other-path?slug=second',\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/dynamic/[slug]',\n        },\n      }\n    )\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#dynamic').text()).toBe('dynamic page')\n    expect($2('#slug').text()).toBe('second')\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n\n    const html3 = await renderViaHTTP(appPort, '/some-other-path', undefined, {\n      headers: {\n        'x-matched-path': '/dynamic/[slug]',\n        'x-now-route-matches': '1=second&slug=second',\n      },\n    })\n    const $3 = cheerio.load(html3)\n    const data3 = JSON.parse($3('#props').text())\n\n    expect($3('#dynamic').text()).toBe('dynamic page')\n    expect($3('#slug').text()).toBe('second')\n    expect(isNaN(data3.random)).toBe(false)\n    expect(data3.random).not.toBe(data.random)\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should render fallback page correctly with x-matched-path and routes-matches","suites":["should set-up next"],"updatePoint":{"line":617,"column":82},"line":617,"code":"  it('should render fallback page correctly with x-matched-path and routes-matches', async () => {\n    const html = await renderViaHTTP(appPort, '/fallback/first', undefined, {\n      headers: {\n        'x-matched-path': '/fallback/first',\n        'x-now-route-matches': '1=first',\n      },\n    })\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#fallback').text()).toBe('fallback page')\n    expect($('#slug').text()).toBe('first')\n    expect(data.hello).toBe('world')\n\n    const html2 = await renderViaHTTP(appPort, `/fallback/[slug]`, undefined, {\n      headers: {\n        'x-matched-path': '/fallback/[slug]',\n        'x-now-route-matches': '1=second',\n      },\n    })\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#fallback').text()).toBe('fallback page')\n    expect($2('#slug').text()).toBe('second')\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should favor valid route params over routes-matches","suites":["should set-up next"],"updatePoint":{"line":646,"column":57},"line":646,"code":"  it('should favor valid route params over routes-matches', async () => {\n    const html = await renderViaHTTP(appPort, '/fallback/first', undefined, {\n      headers: {\n        'x-matched-path': '/fallback/first',\n        'x-now-route-matches': '1=fallback%2ffirst',\n      },\n    })\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#fallback').text()).toBe('fallback page')\n    expect($('#slug').text()).toBe('first')\n    expect(data.hello).toBe('world')\n\n    const html2 = await renderViaHTTP(appPort, `/fallback/second`, undefined, {\n      headers: {\n        'x-matched-path': '/fallback/[slug]',\n        'x-now-route-matches': '1=fallback%2fsecond',\n      },\n    })\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#fallback').text()).toBe('fallback page')\n    expect($2('#slug').text()).toBe('second')\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should favor valid route params over routes-matches optional","suites":["should set-up next"],"updatePoint":{"line":675,"column":66},"line":675,"code":"  it('should favor valid route params over routes-matches optional', async () => {\n    const html = await renderViaHTTP(appPort, '/optional-ssg', undefined, {\n      headers: {\n        'x-matched-path': '/optional-ssg',\n        'x-now-route-matches': '1=optional-ssg',\n      },\n    })\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n    expect(data.params).toEqual({})\n\n    const html2 = await renderViaHTTP(appPort, `/optional-ssg`, undefined, {\n      headers: {\n        'x-matched-path': '/optional-ssg',\n        'x-now-route-matches': '1=optional-ssg%2fanother',\n      },\n    })\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.params).toEqual({})\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should return data correctly with x-matched-path","suites":["should set-up next"],"updatePoint":{"line":699,"column":54},"line":699,"code":"  it('should return data correctly with x-matched-path', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${next.buildId}/dynamic/first.json?slug=first`,\n      undefined,\n      {\n        headers: {\n          'x-matched-path': `/dynamic/[slug]`,\n        },\n      }\n    )\n\n    const { pageProps: data } = await res.json()\n\n    expect(data.slug).toBe('first')\n    expect(data.hello).toBe('world')\n\n    const res2 = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${next.buildId}/fallback/[slug].json`,\n      undefined,\n      {\n        headers: {\n          'x-matched-path': `/_next/data/${next.buildId}/fallback/[slug].json`,\n          'x-now-route-matches': '1=second',\n        },\n      }\n    )\n\n    const { pageProps: data2 } = await res2.json()\n\n    expect(data2.slug).toBe('second')\n    expect(data2.hello).toBe('world')\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should render fallback optional catch-all route correctly with x-matched-path and routes-matches","suites":["should set-up next"],"updatePoint":{"line":734,"column":102},"line":734,"code":"  it('should render fallback optional catch-all route correctly with x-matched-path and routes-matches', async () => {\n    const html = await renderViaHTTP(\n      appPort,\n      '/catch-all/[[...rest]]',\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/catch-all/[[...rest]]',\n          'x-now-route-matches': '',\n        },\n      }\n    )\n    const $ = cheerio.load(html)\n    const data = JSON.parse($('#props').text())\n\n    expect($('#catch-all').text()).toBe('optional catch-all page')\n    expect(data.params).toEqual({})\n    expect(data.hello).toBe('world')\n\n    const html2 = await renderViaHTTP(\n      appPort,\n      '/catch-all/[[...rest]]',\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/catch-all/[[...rest]]',\n          'x-now-route-matches': '1=hello&catchAll=hello',\n        },\n      }\n    )\n    const $2 = cheerio.load(html2)\n    const data2 = JSON.parse($2('#props').text())\n\n    expect($2('#catch-all').text()).toBe('optional catch-all page')\n    expect(data2.params).toEqual({ rest: ['hello'] })\n    expect(isNaN(data2.random)).toBe(false)\n    expect(data2.random).not.toBe(data.random)\n\n    const html3 = await renderViaHTTP(\n      appPort,\n      '/catch-all/[[...rest]]',\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/catch-all/[[...rest]]',\n          'x-now-route-matches': '1=hello/world&catchAll=hello/world',\n        },\n      }\n    )\n    const $3 = cheerio.load(html3)\n    const data3 = JSON.parse($3('#props').text())\n\n    expect($3('#catch-all').text()).toBe('optional catch-all page')\n    expect(data3.params).toEqual({ rest: ['hello', 'world'] })\n    expect(isNaN(data3.random)).toBe(false)\n    expect(data3.random).not.toBe(data.random)\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should return data correctly with x-matched-path for optional catch-all route","suites":["should set-up next"],"updatePoint":{"line":792,"column":83},"line":792,"code":"  it('should return data correctly with x-matched-path for optional catch-all route', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${next.buildId}/catch-all.json`,\n\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/catch-all/[[...rest]]',\n        },\n      }\n    )\n\n    const { pageProps: data } = await res.json()\n\n    expect(data.params).toEqual({})\n    expect(data.hello).toBe('world')\n\n    const res2 = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${next.buildId}/catch-all/[[...rest]].json`,\n      undefined,\n      {\n        headers: {\n          'x-matched-path': `/_next/data/${next.buildId}/catch-all/[[...rest]].json`,\n          'x-now-route-matches': '1=hello&rest=hello',\n        },\n      }\n    )\n\n    const { pageProps: data2 } = await res2.json()\n\n    expect(data2.params).toEqual({ rest: ['hello'] })\n    expect(data2.hello).toBe('world')\n\n    const res3 = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${next.buildId}/catch-all/[[...rest]].json`,\n      undefined,\n      {\n        headers: {\n          'x-matched-path': `/_next/data/${next.buildId}/catch-all/[[...rest]].json`,\n          'x-now-route-matches': '1=hello/world&rest=hello/world',\n        },\n      }\n    )\n\n    const { pageProps: data3 } = await res3.json()\n\n    expect(data3.params).toEqual({ rest: ['hello', 'world'] })\n    expect(data3.hello).toBe('world')\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should not apply trailingSlash redirect","suites":["should set-up next"],"updatePoint":{"line":845,"column":45},"line":845,"code":"  it('should not apply trailingSlash redirect', async () => {\n    for (const path of [\n      '/',\n      '/dynamic/another/',\n      '/dynamic/another',\n      '/fallback/first/',\n      '/fallback/first',\n      '/fallback/another/',\n      '/fallback/another',\n    ]) {\n      const res = await fetchViaHTTP(appPort, path, undefined, {\n        redirect: 'manual',\n      })\n\n      expect(res.status).toBe(200)\n    }\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should normalize catch-all rewrite query values correctly","suites":["should set-up next"],"updatePoint":{"line":863,"column":63},"line":863,"code":"  it('should normalize catch-all rewrite query values correctly', async () => {\n    const html = await renderViaHTTP(\n      appPort,\n      '/some-catch-all/hello/world',\n      {\n        path: 'hello/world',\n      },\n      {\n        headers: {\n          'x-matched-path': '/gssp',\n        },\n      }\n    )\n    const $ = cheerio.load(html)\n    expect(JSON.parse($('#router').text()).query).toEqual({\n      path: ['hello', 'world'],\n    })\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should handle bad request correctly with rewrite","suites":["should set-up next"],"updatePoint":{"line":882,"column":54},"line":882,"code":"  it('should handle bad request correctly with rewrite', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/to-dynamic/%c0.%c0.',\n      '?path=%c0.%c0.',\n      {\n        headers: {\n          'x-matched-path': '/dynamic/[slug]',\n        },\n      }\n    )\n    expect(res.status).toBe(400)\n    expect(await res.text()).toContain('Bad Request')\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should have correct resolvedUrl from rewrite","suites":["should set-up next"],"updatePoint":{"line":897,"column":50},"line":897,"code":"  it('should have correct resolvedUrl from rewrite', async () => {\n    const res = await fetchViaHTTP(appPort, '/to-dynamic/post-1', undefined, {\n      headers: {\n        'x-matched-path': '/dynamic/[slug]',\n      },\n    })\n    expect(res.status).toBe(200)\n    const $ = cheerio.load(await res.text())\n    expect($('#resolved-url').text()).toBe('/dynamic/post-1')\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should have correct resolvedUrl from rewrite with added query","suites":["should set-up next"],"updatePoint":{"line":908,"column":67},"line":908,"code":"  it('should have correct resolvedUrl from rewrite with added query', async () => {\n    const res = await fetchViaHTTP(appPort, '/to-dynamic/post-2', undefined, {\n      headers: {\n        'x-matched-path': '/dynamic/[slug]',\n      },\n    })\n    expect(res.status).toBe(200)\n    const $ = cheerio.load(await res.text())\n    expect($('#resolved-url').text()).toBe('/dynamic/post-2')\n    expect(JSON.parse($('#router').text()).asPath).toBe('/to-dynamic/post-2')\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should have correct resolvedUrl from dynamic route","suites":["should set-up next"],"updatePoint":{"line":920,"column":56},"line":920,"code":"  it('should have correct resolvedUrl from dynamic route', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      `/_next/data/${next.buildId}/dynamic/post-2.json`,\n      { slug: 'post-2' },\n      {\n        headers: {\n          'x-matched-path': '/dynamic/[slug]',\n        },\n      }\n    )\n    expect(res.status).toBe(200)\n    const json = await res.json()\n    expect(json.pageProps.resolvedUrl).toBe('/dynamic/post-2')\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should bubble error correctly for gip page","suites":["should set-up next"],"updatePoint":{"line":936,"column":48},"line":936,"code":"  it('should bubble error correctly for gip page', async () => {\n    errors = []\n    const res = await fetchViaHTTP(appPort, '/errors/gip', { crash: '1' })\n    expect(res.status).toBe(500)\n    expect(await res.text()).toBe('internal server error')\n\n    await check(\n      () => (errors[0].includes('gip hit an oops') ? 'success' : errors[0]),\n      'success'\n    )\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should bubble error correctly for gssp page","suites":["should set-up next"],"updatePoint":{"line":948,"column":49},"line":948,"code":"  it('should bubble error correctly for gssp page', async () => {\n    errors = []\n    const res = await fetchViaHTTP(appPort, '/errors/gssp', { crash: '1' })\n    expect(res.status).toBe(500)\n    expect(await res.text()).toBe('internal server error')\n    await check(\n      () => (errors[0].includes('gssp hit an oops') ? 'success' : errors[0]),\n      'success'\n    )\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should bubble error correctly for gsp page","suites":["should set-up next"],"updatePoint":{"line":959,"column":48},"line":959,"code":"  it('should bubble error correctly for gsp page', async () => {\n    errors = []\n    const res = await fetchViaHTTP(appPort, '/errors/gsp/crash')\n    expect(res.status).toBe(500)\n    expect(await res.text()).toBe('internal server error')\n    await check(\n      () => (errors[0].includes('gsp hit an oops') ? 'success' : errors[0]),\n      'success'\n    )\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should bubble error correctly for API page","suites":["should set-up next"],"updatePoint":{"line":970,"column":48},"line":970,"code":"  it('should bubble error correctly for API page', async () => {\n    errors = []\n    const res = await fetchViaHTTP(appPort, '/api/error')\n    expect(res.status).toBe(500)\n    expect(await res.text()).toBe('internal server error')\n    await check(\n      () =>\n        errors[0].includes('some error from /api/error')\n          ? 'success'\n          : errors[0],\n      'success'\n    )\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should normalize optional values correctly for SSP page","suites":["should set-up next"],"updatePoint":{"line":984,"column":61},"line":984,"code":"  it('should normalize optional values correctly for SSP page', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/optional-ssp',\n      { rest: '', another: 'value' },\n      {\n        headers: {\n          'x-matched-path': '/optional-ssp/[[...rest]]',\n        },\n      }\n    )\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n    const props = JSON.parse($('#props').text())\n    expect(props.params).toEqual({})\n    expect(props.query).toEqual({ another: 'value' })\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should normalize optional values correctly for SSG page","suites":["should set-up next"],"updatePoint":{"line":1003,"column":61},"line":1003,"code":"  it('should normalize optional values correctly for SSG page', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/optional-ssg',\n      { rest: '', another: 'value' },\n      {\n        headers: {\n          'x-matched-path': '/optional-ssg/[[...rest]]',\n        },\n      }\n    )\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n    const props = JSON.parse($('#props').text())\n    expect(props.params).toEqual({})\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should normalize optional revalidations correctly for SSG page","suites":["should set-up next"],"updatePoint":{"line":1021,"column":68},"line":1021,"code":"  it('should normalize optional revalidations correctly for SSG page', async () => {\n    const reqs = [\n      {\n        path: `/_next/data/${next.buildId}/optional-ssg/[[...rest]].json`,\n        headers: {\n          'x-matched-path': `/_next/data/${next.buildId}/optional-ssg/[[...rest]].json`,\n        },\n      },\n      {\n        path: `/_next/data/${next.buildId}/optional-ssg.json`,\n        headers: {\n          'x-matched-path': `/_next/data/${next.buildId}/optional-ssg/[[...rest]].json`,\n        },\n      },\n      {\n        path: `/_next/data/${next.buildId}/optional-ssg.json`,\n        headers: {\n          'x-matched-path': `/_next/data/${next.buildId}/optional-ssg.json`,\n        },\n      },\n      {\n        path: `/_next/data/${next.buildId}/optional-ssg/[[...rest]].json`,\n        headers: {\n          'x-matched-path': `/_next/data/${next.buildId}/optional-ssg/[[...rest]].json`,\n        },\n        query: { rest: '' },\n      },\n      {\n        path: `/_next/data/${next.buildId}/optional-ssg/[[...rest]].json`,\n        headers: {\n          'x-matched-path': `/_next/data/${next.buildId}/optional-ssg/[[...rest]].json`,\n          'x-now-route-matches': '1=',\n        },\n      },\n      {\n        path: `/_next/data/${next.buildId}/optional-ssg/.json`,\n        headers: {\n          'x-matched-path': `/_next/data/${next.buildId}/optional-ssg/[[...rest]].json`,\n          'x-now-route-matches': '',\n          'x-vercel-id': 'cle1::',\n        },\n      },\n      {\n        path: `/optional-ssg/[[...rest]]`,\n        headers: {\n          'x-matched-path': `/_next/data/${next.buildId}/optional-ssg/[[...rest]].json`,\n          'x-now-route-matches': '',\n          'x-vercel-id': 'cle1::',\n        },\n      },\n      {\n        path: `/_next/data/${next.buildId}/optional-ssg/[[...rest]].json`,\n        headers: {\n          'x-matched-path': `/optional-ssg/[[...rest]]`,\n          'x-now-route-matches': '',\n          'x-vercel-id': 'cle1::',\n        },\n      },\n    ]\n\n    for (const req of reqs) {\n      console.error('checking', req)\n      const res = await fetchViaHTTP(appPort, req.path, req.query, {\n        headers: req.headers,\n      })\n\n      const content = await res.text()\n      let props\n\n      try {\n        const data = JSON.parse(content)\n        props = data.pageProps\n      } catch (_) {\n        props = JSON.parse(cheerio.load(content)('#__NEXT_DATA__').text()).props\n          .pageProps\n      }\n      expect(props.params).toEqual({})\n    }\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should normalize optional values correctly for SSG page with encoded slash","suites":["should set-up next"],"updatePoint":{"line":1101,"column":80},"line":1101,"code":"  it('should normalize optional values correctly for SSG page with encoded slash', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/optional-ssg/[[...rest]]',\n      undefined,\n      {\n        headers: {\n          'x-matched-path': '/optional-ssg/[[...rest]]',\n          'x-now-route-matches':\n            '1=en%2Fes%2Fhello%252Fworld&rest=en%2Fes%2Fhello%252Fworld',\n        },\n      }\n    )\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n    const props = JSON.parse($('#props').text())\n    expect(props.params).toEqual({\n      rest: ['en', 'es', 'hello/world'],\n    })\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should normalize optional values correctly for API page","suites":["should set-up next"],"updatePoint":{"line":1123,"column":61},"line":1123,"code":"  it('should normalize optional values correctly for API page', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/api/optional',\n      { rest: '', another: 'value' },\n      {\n        headers: {\n          'x-matched-path': '/api/optional/[[...rest]]',\n        },\n      }\n    )\n\n    const json = await res.json()\n    expect(json.query).toEqual({ another: 'value' })\n    expect(json.url).toBe('/api/optional?another=value')\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should normalize index optional values correctly for API page","suites":["should set-up next"],"updatePoint":{"line":1140,"column":67},"line":1140,"code":"  it('should normalize index optional values correctly for API page', async () => {\n    const res = await fetchViaHTTP(\n      appPort,\n      '/api/optional/index',\n      { rest: 'index', another: 'value' },\n      {\n        headers: {\n          'x-matched-path': '/api/optional/[[...rest]]',\n        },\n      }\n    )\n\n    const json = await res.json()\n    expect(json.query).toEqual({ another: 'value', rest: ['index'] })\n    expect(json.url).toBe('/api/optional/index?another=value')\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should match the index page correctly","suites":["should set-up next"],"updatePoint":{"line":1157,"column":43},"line":1157,"code":"  it('should match the index page correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/', undefined, {\n      headers: {\n        'x-matched-path': '/index',\n      },\n      redirect: 'manual',\n    })\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n    expect($('#index').text()).toBe('index page')\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should match the root dynamic page correctly","suites":["should set-up next"],"updatePoint":{"line":1170,"column":50},"line":1170,"code":"  it('should match the root dynamic page correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/slug-1', undefined, {\n      headers: {\n        'x-matched-path': '/[slug]',\n      },\n      redirect: 'manual',\n    })\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n    expect($('#slug-page').text()).toBe('[slug] page')\n    expect(JSON.parse($('#router').text()).query).toEqual({\n      slug: 'slug-1',\n    })\n\n    const res2 = await fetchViaHTTP(appPort, '/[slug]', undefined, {\n      headers: {\n        'x-matched-path': '/[slug]',\n      },\n      redirect: 'manual',\n    })\n\n    const html2 = await res2.text()\n    const $2 = cheerio.load(html2)\n    expect($2('#slug-page').text()).toBe('[slug] page')\n    expect(JSON.parse($2('#router').text()).query).toEqual({\n      slug: '[slug]',\n    })\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should have correct asPath on dynamic SSG page correctly","suites":["should set-up next"],"updatePoint":{"line":1200,"column":62},"line":1200,"code":"  it('should have correct asPath on dynamic SSG page correctly', async () => {\n    const res = await fetchViaHTTP(appPort, '/an-ssg-path', undefined, {\n      headers: {\n        'x-matched-path': '/[slug]',\n      },\n      redirect: 'manual',\n    })\n\n    const html = await res.text()\n    const $ = cheerio.load(html)\n    expect($('#slug-page').text()).toBe('[slug] page')\n    expect(JSON.parse($('#router').text()).asPath).toBe('/an-ssg-path')\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should have correct asPath on dynamic SSG page fallback correctly","suites":["should set-up next"],"updatePoint":{"line":1214,"column":71},"line":1214,"code":"  it('should have correct asPath on dynamic SSG page fallback correctly', async () => {\n    const toCheck = [\n      {\n        pathname: '/fallback-false/first',\n        matchedPath: '/fallback-false/first',\n      },\n      {\n        pathname: '/fallback-false/first',\n        matchedPath: `/_next/data/${next.buildId}/fallback-false/first.json`,\n      },\n    ]\n    for (const check of toCheck) {\n      console.warn('checking', check)\n      const res = await fetchViaHTTP(appPort, check.pathname, undefined, {\n        headers: {\n          'x-matched-path': check.matchedPath,\n        },\n        redirect: 'manual',\n      })\n\n      const html = await res.text()\n      const $ = cheerio.load(html)\n      expect($('#page').text()).toBe('blog slug')\n      expect($('#asPath').text()).toBe('/fallback-false/first')\n      expect($('#pathname').text()).toBe('/fallback-false/[slug]')\n      expect(JSON.parse($('#query').text())).toEqual({ slug: 'first' })\n    }\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should copy and read .env file","suites":["should set-up next"],"updatePoint":{"line":1243,"column":36},"line":1243,"code":"  it('should copy and read .env file', async () => {\n    const res = await fetchViaHTTP(appPort, '/api/env')\n\n    const envVariables = await res.json()\n\n    expect(envVariables.env).not.toBeUndefined()\n    expect(envVariables.envProd).not.toBeUndefined()\n    expect(envVariables.envLocal).toBeUndefined()\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should run middleware correctly without minimalMode","suites":["should set-up next"],"updatePoint":{"line":1253,"column":57},"line":1253,"code":"  it('should run middleware correctly without minimalMode', async () => {\n    await killApp(server)\n    const testServer = join(next.testDir, 'standalone/server.js')\n    await fs.writeFile(\n      testServer,\n      (\n        await fs.readFile(testServer, 'utf8')\n      ).replace('minimalMode: true', 'minimalMode: false')\n    )\n    appPort = await findPort()\n    server = await initNextServerScript(\n      testServer,\n      /Listening on/,\n      {\n        ...process.env,\n        PORT: appPort,\n      },\n      undefined,\n      {\n        cwd: next.testDir,\n        onStderr(msg) {\n          if (msg.includes('top-level')) {\n            errors.push(msg)\n          }\n          stderr += msg\n        },\n      }\n    )\n\n    const res = await fetchViaHTTP(appPort, '/')\n    expect(res.status).toBe(200)\n    expect(await res.text()).toContain('index page')\n  })","file":"production/required-server-files.test.ts","skipped":false,"dir":"test"},{"name":"should work","suites":["standalone mode and optimizeCss"],"updatePoint":{"line":38,"column":17},"line":38,"code":"  it('should work', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toContain('hello world')\n    expect(html).toContain('background:orange')\n  })","file":"production/standalone-mode-and-optimizecss/index.test.ts","skipped":false,"dir":"test"},{"name":"should not have eslint setup started","suites":["TypeScript basic"],"updatePoint":{"line":23,"column":42},"line":23,"code":"  it('should not have eslint setup started', async () => {\n    expect(next.cliOutput).not.toContain(\n      'How would you like to configure ESLint'\n    )\n  })","file":"production/typescript-basic/index.test.ts","skipped":false,"dir":"test"},{"name":"have built and started correctly","suites":["TypeScript basic"],"updatePoint":{"line":29,"column":38},"line":29,"code":"  it('have built and started correctly', async () => {\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toContain('hello world')\n  })","file":"production/typescript-basic/index.test.ts","skipped":false,"dir":"test"},{"name":"should work with babel","suites":["TypeScript basic"],"updatePoint":{"line":34,"column":28},"line":34,"code":"  it('should work with babel', async () => {\n    await next.stop()\n    await next.patchFile(\n      '.babelrc',\n      JSON.stringify({ presets: ['next/babel'] })\n    )\n    await next.start()\n\n    const html = await renderViaHTTP(next.url, '/')\n    expect(html).toContain('hello world')\n  })","file":"production/typescript-basic/index.test.ts","skipped":false,"dir":"test"},{"name":"parses the header","suites":["acceptLanguage"],"updatePoint":{"line":4,"column":23},"line":4,"code":"  it('parses the header', () => {\n    const language = acceptLanguage('da, en-GB, en')\n    expect(language).toEqual('da')\n  })","file":"unit/accept-headers.test.ts","skipped":false,"dir":"test"},{"name":"respects weights","suites":["acceptLanguage"],"updatePoint":{"line":9,"column":22},"line":9,"code":"  it('respects weights', () => {\n    const language = acceptLanguage('en;q=0.6, en-GB;q=0.8')\n    expect(language).toEqual('en-gb')\n  })","file":"unit/accept-headers.test.ts","skipped":false,"dir":"test"},{"name":"returns empty string with header is empty","suites":["acceptLanguage"],"updatePoint":{"line":14,"column":47},"line":14,"code":"  it('returns empty string with header is empty', () => {\n    const language = acceptLanguage('')\n    expect(language).toEqual('')\n  })","file":"unit/accept-headers.test.ts","skipped":false,"dir":"test"},{"name":"returns empty string if header is missing","suites":["acceptLanguage"],"updatePoint":{"line":19,"column":47},"line":19,"code":"  it('returns empty string if header is missing', () => {\n    const language = acceptLanguage()\n    expect(language).toEqual('')\n  })","file":"unit/accept-headers.test.ts","skipped":false,"dir":"test"},{"name":"ignores an empty preferences array","suites":["acceptLanguage"],"updatePoint":{"line":24,"column":40},"line":24,"code":"  it('ignores an empty preferences array', () => {\n    const language = acceptLanguage('da, en-GB, en', [])\n    expect(language).toEqual('da')\n  })","file":"unit/accept-headers.test.ts","skipped":false,"dir":"test"},{"name":"returns empty string if none of the preferences match","suites":["acceptLanguage"],"updatePoint":{"line":29,"column":59},"line":29,"code":"  it('returns empty string if none of the preferences match', () => {\n    const language = acceptLanguage('da, en-GB, en', ['es'])\n    expect(language).toEqual('')\n  })","file":"unit/accept-headers.test.ts","skipped":false,"dir":"test"},{"name":"returns first preference if header has * and is unmatched","suites":["acceptLanguage"],"updatePoint":{"line":34,"column":63},"line":34,"code":"  it('returns first preference if header has * and is unmatched', () => {\n    const language = acceptLanguage('da, en-GB, *', ['en-US'])\n    expect(language).toEqual('en-US')\n  })","file":"unit/accept-headers.test.ts","skipped":false,"dir":"test"},{"name":"returns first found preference that header includes","suites":["acceptLanguage"],"updatePoint":{"line":39,"column":57},"line":39,"code":"  it('returns first found preference that header includes', () => {\n    const language = acceptLanguage('da, en-GB, en', ['en-US', 'en-GB'])\n    expect(language).toEqual('en-US')\n  })","file":"unit/accept-headers.test.ts","skipped":false,"dir":"test"},{"name":"returns preference with highest order when equal weigths","suites":["acceptLanguage"],"updatePoint":{"line":44,"column":62},"line":44,"code":"  it('returns preference with highest order when equal weigths', () => {\n    expect(acceptLanguage('da, en, en-GB', ['en', 'en-GB'])).toEqual('en')\n    expect(acceptLanguage('da, en, en-GB', ['en-GB', 'en'])).toEqual('en-GB')\n    expect(acceptLanguage('en, en-GB, en-US')).toEqual('en')\n  })","file":"unit/accept-headers.test.ts","skipped":false,"dir":"test"},{"name":"return language with heighest weight","suites":["acceptLanguage"],"updatePoint":{"line":50,"column":42},"line":50,"code":"  it('return language with heighest weight', () => {\n    const language = acceptLanguage('da;q=0.5, en;q=1', ['da', 'en'])\n    expect(language).toEqual('en')\n  })","file":"unit/accept-headers.test.ts","skipped":false,"dir":"test"},{"name":"ignores preference case when matching","suites":["acceptLanguage"],"updatePoint":{"line":55,"column":43},"line":55,"code":"  it('ignores preference case when matching', () => {\n    const language = acceptLanguage('da, en-GB, en-us', ['en-gb', 'en-us']) // en-GB vs en-gb\n    expect(language).toEqual('en-gb')\n  })","file":"unit/accept-headers.test.ts","skipped":false,"dir":"test"},{"name":"returns language using range match","suites":["acceptLanguage"],"updatePoint":{"line":60,"column":40},"line":60,"code":"  it('returns language using range match', () => {\n    expect(acceptLanguage('da', ['da-DK'])).toEqual('da-DK')\n    expect(acceptLanguage('en-US, en', ['en-GB', 'en-US'])).toEqual('en-GB')\n    expect(acceptLanguage('da, en', ['da-DK', 'en-GB'])).toEqual('da-DK')\n    expect(acceptLanguage('en, da', ['da-DK', 'en-GB'])).toEqual('da-DK')\n    expect(acceptLanguage('en, da', ['en', 'en-GB'])).toEqual('en')\n    expect(acceptLanguage('da, en-GB', ['da-DK', 'en-GB'])).toEqual('da-DK')\n    expect(acceptLanguage('en, en-GB', ['en-US', 'en-GB', 'da-DK'])).toEqual(\n      'en-US'\n    )\n  })","file":"unit/accept-headers.test.ts","skipped":false,"dir":"test"},{"name":"explicit preference overrides range match","suites":["acceptLanguage"],"updatePoint":{"line":72,"column":47},"line":72,"code":"  it('explicit preference overrides range match', () => {\n    expect(acceptLanguage('da, en-GB', ['da-DK', 'en-GB', 'da'])).toEqual(\n      'en-GB'\n    )\n  })","file":"unit/accept-headers.test.ts","skipped":false,"dir":"test"},{"name":"export config with type annotation","suites":["babel plugin (next-page-config)"],"updatePoint":{"line":20,"column":42},"line":20,"code":"  test('export config with type annotation', () => {\n    const output = babel('export const config: PageConfig = {};')\n\n    expect(output).toMatch(`export const config={};`)\n  })","file":"unit/babel-plugin-next-page-config.test.ts","skipped":false,"dir":"test"},{"name":"export config with AsExpression","suites":["babel plugin (next-page-config)"],"updatePoint":{"line":26,"column":39},"line":26,"code":"  test('export config with AsExpression', () => {\n    const output = babel('export const config = {} as PageConfig;')\n\n    expect(output).toMatch('export const config={};')\n  })","file":"unit/babel-plugin-next-page-config.test.ts","skipped":false,"dir":"test"},{"name":"amp enabled","suites":["babel plugin (next-page-config)"],"updatePoint":{"line":32,"column":19},"line":32,"code":"  test('amp enabled', () => {\n    jest.spyOn(Date, 'now').mockReturnValue(1234)\n    const output = babel(`\n      export const config = { amp: true }\n\n      function About(props) {\n        return <h3>My AMP About Page!</h3>\n      }\n      \n      export default About`)\n\n    expect(output).toMatch(\n      'const __NEXT_DROP_CLIENT_FILE__=\"__NEXT_DROP_CLIENT_FILE__ 1234\";'\n    )\n  })","file":"unit/babel-plugin-next-page-config.test.ts","skipped":false,"dir":"test"},{"name":"amp hybrid enabled","suites":["babel plugin (next-page-config)"],"updatePoint":{"line":48,"column":26},"line":48,"code":"  test('amp hybrid enabled', () => {\n    const output = babel(`\n      export const config = { amp: 'hybrid' }\n\n      function About(props) {\n        return <h3>My AMP About Page!</h3>\n      }\n      \n      export default About`)\n\n    expect(output).toMatch(\n      \"export const config={amp:'hybrid'};function About(props){return<h3>My AMP About Page!</h3>;}export default About;\"\n    )\n  })","file":"unit/babel-plugin-next-page-config.test.ts","skipped":false,"dir":"test"},{"name":"should remove separate named export specifiers","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":29,"column":54},"line":29,"code":"    it('should remove separate named export specifiers', () => {\n      const output = babel(trim`\n        export { getStaticPaths } from '.'\n        export { a as getStaticProps } from '.'\n\n        export default function Test() {\n          return <div />\n        }\n      `)\n      expect(output).toMatchInlineSnapshot(\n        `\"export var __N_SSG=true;export default function Test(){return __jsx(\\\\\"div\\\\\",null);}\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"should remove combined named export specifiers","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":43,"column":54},"line":43,"code":"    it('should remove combined named export specifiers', () => {\n      const output = babel(trim`\n        export { getStaticPaths, a as getStaticProps } from '.'\n\n        export default function Test() {\n          return <div />\n        }\n      `)\n      expect(output).toMatchInlineSnapshot(\n        `\"export var __N_SSG=true;export default function Test(){return __jsx(\\\\\"div\\\\\",null);}\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"should retain extra named export specifiers","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":56,"column":51},"line":56,"code":"    it('should retain extra named export specifiers', () => {\n      const output = babel(trim`\n        export { getStaticPaths, a as getStaticProps, foo, bar as baz } from '.'\n\n        export default function Test() {\n          return <div />\n        }\n      `)\n      expect(output).toMatchInlineSnapshot(\n        `\"export var __N_SSG=true;export{foo,bar as baz}from'.';export default function Test(){return __jsx(\\\\\"div\\\\\",null);}\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"should remove named export function declarations","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":69,"column":56},"line":69,"code":"    it('should remove named export function declarations', () => {\n      const output = babel(trim`\n        export function getStaticPaths() {\n          return []\n        }\n\n        export function getStaticProps() {\n          return { props: {} }\n        }\n\n        export default function Test() {\n          return <div />\n        }\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"export var __N_SSG=true;export default function Test(){return __jsx(\\\\\"div\\\\\",null);}\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"should remove named export function declarations (async)","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":89,"column":64},"line":89,"code":"    it('should remove named export function declarations (async)', () => {\n      const output = babel(trim`\n        export async function getStaticPaths() {\n          return []\n        }\n\n        export async function getStaticProps() {\n          return { props: {} }\n        }\n\n        export default function Test() {\n          return <div />\n        }\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"export var __N_SSG=true;export default function Test(){return __jsx(\\\\\"div\\\\\",null);}\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"should not remove extra named export function declarations","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":109,"column":66},"line":109,"code":"    it('should not remove extra named export function declarations', () => {\n      const output = babel(trim`\n        export function getStaticProps() {\n          return { props: {} }\n        }\n\n        export function Noop() {}\n\n        export default function Test() {\n          return <div />\n        }\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"export var __N_SSG=true;export function Noop(){}export default function Test(){return __jsx(\\\\\"div\\\\\",null);}\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"should remove named export variable declarations","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":127,"column":56},"line":127,"code":"    it('should remove named export variable declarations', () => {\n      const output = babel(trim`\n        export const getStaticPaths = () => {\n          return []\n        }\n\n        export const getStaticProps = function() {\n          return { props: {} }\n        }\n\n        export default function Test() {\n          return <div />\n        }\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"export var __N_SSG=true;export default function Test(){return __jsx(\\\\\"div\\\\\",null);}\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"should remove named export variable declarations (async)","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":147,"column":64},"line":147,"code":"    it('should remove named export variable declarations (async)', () => {\n      const output = babel(trim`\n        export const getStaticPaths = async () => {\n          return []\n        }\n\n        export const getStaticProps = async function() {\n          return { props: {} }\n        }\n\n        export default function Test() {\n          return <div />\n        }\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"export var __N_SSG=true;export default function Test(){return __jsx(\\\\\"div\\\\\",null);}\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"should not remove extra named export variable declarations","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":167,"column":66},"line":167,"code":"    it('should not remove extra named export variable declarations', () => {\n      const output = babel(trim`\n        export const getStaticPaths = () => {\n          return []\n        }, foo = 2\n\n        export const getStaticProps = function() {\n          return { props: {} }\n        }\n\n        export default function Test() {\n          return <div />\n        }\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"export var __N_SSG=true;export const foo=2;export default function Test(){return __jsx(\\\\\"div\\\\\",null);}\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"should remove re-exported variable declarations","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":187,"column":55},"line":187,"code":"    it('should remove re-exported variable declarations', () => {\n      const output = babel(trim`\n        const getStaticPaths = () => {\n          return []\n        }\n\n        export { getStaticPaths }\n\n        export default function Test() {\n          return <div />\n        }\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"export var __N_SSG=true;export default function Test(){return __jsx(\\\\\"div\\\\\",null);}\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"should remove re-exported variable declarations (safe)","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":205,"column":62},"line":205,"code":"    it('should remove re-exported variable declarations (safe)', () => {\n      const output = babel(trim`\n        const getStaticPaths = () => {\n          return []\n        }, a = 2\n\n        export { getStaticPaths }\n\n        export default function Test() {\n          return <div />\n        }\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"const a=2;export var __N_SSG=true;export default function Test(){return __jsx(\\\\\"div\\\\\",null);}\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"should remove re-exported function declarations","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":223,"column":55},"line":223,"code":"    it('should remove re-exported function declarations', () => {\n      const output = babel(trim`\n        function getStaticPaths() {\n          return []\n        }\n\n        export { getStaticPaths }\n\n        export default function Test() {\n          return <div />\n        }\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"export var __N_SSG=true;export default function Test(){return __jsx(\\\\\"div\\\\\",null);}\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"should not crash for class declarations","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":241,"column":47},"line":241,"code":"    it('should not crash for class declarations', () => {\n      const output = babel(trim`\n        function getStaticPaths() {\n          return []\n        }\n\n        export { getStaticPaths }\n\n        export class MyClass {}\n\n        export default function Test() {\n          return <div />\n        }\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"export var __N_SSG=true;export class MyClass{}export default function Test(){return __jsx(\\\\\"div\\\\\",null);}\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"should remove re-exported function declarations' dependents (variables, functions, imports)","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":261,"column":99},"line":261,"code":"    it(`should remove re-exported function declarations' dependents (variables, functions, imports)`, () => {\n      const output = babel(trim`\n        import keep_me from 'hello'\n        import {keep_me2} from 'hello2'\n        import * as keep_me3 from 'hello3'\n\n        import drop_me from 'bla'\n        import { drop_me2 } from 'foo'\n        import { drop_me3, but_not_me } from 'bar'\n        import * as remove_mua from 'hehe'\n\n        var leave_me_alone = 1;\n        function dont_bug_me_either() {}\n\n        const inceptionVar = 'hahaa';\n        var var1 = 1;\n        let var2 = 2;\n        const var3 = inceptionVar + remove_mua;\n\n        function inception1() {var2;drop_me2;}\n\n        function abc() {}\n        const b = function() {var3;drop_me3;};\n        const b2 = function apples() {};\n        const bla = () => {inception1};\n\n        function getStaticProps() {\n          abc();\n          drop_me;\n          b;\n          b2;\n          bla();\n          return { props: {var1} }\n        }\n\n        export { getStaticProps }\n\n        export default function Test() {\n          return <div />\n        }\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"import keep_me from'hello';import{keep_me2}from'hello2';import*as keep_me3 from'hello3';import{but_not_me}from'bar';var leave_me_alone=1;function dont_bug_me_either(){}export var __N_SSG=true;export default function Test(){return __jsx(\\\\\"div\\\\\",null);}\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"should not mix up bindings","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":308,"column":34},"line":308,"code":"    it('should not mix up bindings', () => {\n      const output = babel(trim`\n        function Function1() {\n          return {\n            a: function bug(a) {\n              return 2;\n            }\n          };\n        }\n\n        function Function2() {\n          var bug = 1;\n          return { bug };\n        }\n\n        export { getStaticProps } from 'a'\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"function Function1(){return{a:function bug(a){return 2;}};}function Function2(){var bug=1;return{bug};}\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"should support class exports","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":331,"column":36},"line":331,"code":"    it('should support class exports', () => {\n      const output = babel(trim`\n        export function getStaticProps() {\n          return { props: {} }\n        }\n\n        export default class Test extends React.Component {\n          render() {\n            return <div />\n          }\n        }\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"export var __N_SSG=true;export default class Test extends React.Component{render(){return __jsx(\\\\\"div\\\\\",null);}}\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"should support class exports 2","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":349,"column":38},"line":349,"code":"    it('should support class exports 2', () => {\n      const output = babel(trim`\n        export function getStaticProps() {\n          return { props: {} }\n        }\n\n        class Test extends React.Component {\n          render() {\n            return <div />\n          }\n        }\n\n        export default Test;\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"class Test extends React.Component{render(){return __jsx(\\\\\"div\\\\\",null);}}export var __N_SSG=true;export default Test;\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"should support export { _ as default }","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":369,"column":46},"line":369,"code":"    it('should support export { _ as default }', () => {\n      const output = babel(trim`\n        export function getStaticProps() {\n          return { props: {} }\n        }\n\n        function El() {\n          return <div />\n        }\n\n        export { El as default }\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"function El(){return __jsx(\\\\\"div\\\\\",null);}export var __N_SSG=true;export{El as default};\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"should support export { _ as default } with other specifiers","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":387,"column":68},"line":387,"code":"    it('should support export { _ as default } with other specifiers', () => {\n      const output = babel(trim`\n        export function getStaticProps() {\n          return { props: {} }\n        }\n\n        function El() {\n          return <div />\n        }\n\n        const a = 5\n\n        export { El as default, a }\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"function El(){return __jsx(\\\\\"div\\\\\",null);}const a=5;export var __N_SSG=true;export{El as default,a};\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"should support export { _ as default } with a class","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":407,"column":59},"line":407,"code":"    it('should support export { _ as default } with a class', () => {\n      const output = babel(trim`\n        export function getStaticProps() {\n          return { props: {} }\n        }\n\n        class El extends React.Component {\n          render() {\n            return <div />\n          }\n        }\n\n        const a = 5\n\n        export { El as default, a }\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"class El extends React.Component{render(){return __jsx(\\\\\"div\\\\\",null);}}const a=5;export var __N_SSG=true;export{El as default,a};\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"should support full re-export","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":429,"column":37},"line":429,"code":"    it('should support full re-export', () => {\n      const output = babel(trim`\n        export { getStaticProps, default } from 'a'\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"export var __N_SSG=true;export{default}from'a';\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"should support babel-style memoized function","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":439,"column":52},"line":439,"code":"    it('should support babel-style memoized function', () => {\n      const output = babel(trim`\n        function fn() {\n          fn = function () {};\n          return fn.apply(this, arguments);\n        }\n        export function getStaticProps() {\n          fn;\n        }\n        export default function Home() { return <div />; }\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"export var __N_SSG=true;export default function Home(){return __jsx(\\\\\"div\\\\\",null);}\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"destructuring assignment (object)","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":456,"column":41},"line":456,"code":"    it('destructuring assignment (object)', () => {\n      const output = babel(trim`\n        import fs from 'fs';\n        import other from 'other';\n\n        const {readFile, readdir, access: foo} = fs.promises;\n        const {a,b, cat: bar,...rem} = other;\n\n        export async function getStaticProps() {\n          readFile;\n          readdir;\n          foo;\n          b;\n          cat;\n          rem;\n        }\n        export default function Home() { return <div />; }\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"import other from'other';const{a,cat:bar}=other;export var __N_SSG=true;export default function Home(){return __jsx(\\\\\"div\\\\\",null);}\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"destructuring assignment (array)","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":480,"column":40},"line":480,"code":"    it('destructuring assignment (array)', () => {\n      const output = babel(trim`\n        import fs from 'fs';\n        import other from 'other';\n\n        const [a, b, ...rest]= fs.promises;\n        const [foo, bar] = other;\n\n        export async function getStaticProps() {\n          a;\n          b;\n          rest;\n          bar;\n        }\n        export default function Home() { return <div />; }\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"import other from'other';const[foo]=other;export var __N_SSG=true;export default function Home(){return __jsx(\\\\\"div\\\\\",null);}\"`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"errors for incorrect mix of functions","suites":["babel plugin (next-ssg-transform)","getStaticProps support"],"updatePoint":{"line":502,"column":45},"line":502,"code":"    it('errors for incorrect mix of functions', () => {\n      expect(() =>\n        babel(trim`\n          export function getStaticProps() {}\n          export function getServerSideProps() {}\n        `)\n      ).toThrowError(\n        `You can not use getStaticProps or getStaticPaths with getServerSideProps. To use SSG, please remove getServerSideProps`\n      )\n\n      expect(() =>\n        babel(trim`\n          export function getServerSideProps() {}\n          export function getStaticProps() {}\n        `)\n      ).toThrowError(\n        `You can not use getStaticProps or getStaticPaths with getServerSideProps. To use SSG, please remove getServerSideProps`\n      )\n\n      expect(() =>\n        babel(trim`\n          export function getStaticPaths() {}\n          export function getServerSideProps() {}\n        `)\n      ).toThrowError(\n        `You can not use getStaticProps or getStaticPaths with getServerSideProps. To use SSG, please remove getServerSideProps`\n      )\n\n      expect(() =>\n        babel(trim`\n          export function getServerSideProps() {}\n          export function getStaticPaths() {}\n        `)\n      ).toThrowError(\n        `You can not use getStaticProps or getStaticPaths with getServerSideProps. To use SSG, please remove getServerSideProps`\n      )\n    })","file":"unit/babel-plugin-next-ssg-transform.test.ts","skipped":false,"dir":"test"},{"name":"--keepAliveTimeout changes server.keepAliveTimeout when passed","suites":["start"],"updatePoint":{"line":11,"column":70},"line":11,"code":"  test('--keepAliveTimeout changes server.keepAliveTimeout when passed', () => {\n    const server = {\n      on: () => {},\n      listen: () => {},\n    } as any as Server\n    ;(httpMock as any).createServer.mockReturnValue(server)\n\n    expect(server.keepAliveTimeout).toBe(undefined)\n    nextStart(['--keepAliveTimeout', '1234'])\n    expect(server.keepAliveTimeout).toBe(1234)\n  })","file":"unit/cli.test.ts","skipped":false,"dir":"test"},{"name":"--keepAliveTimeout doesn't change server.keepAliveTimeout when not passed","suites":["start"],"updatePoint":{"line":23,"column":81},"line":23,"code":"  test(\"--keepAliveTimeout doesn't change server.keepAliveTimeout when not passed\", () => {\n    const server = {\n      on: () => {},\n      listen: () => {},\n    } as any as Server\n    ;(httpMock as any).createServer.mockReturnValue(server)\n\n    expect(server.keepAliveTimeout).toBe(undefined)\n    nextStart([])\n    expect(server.keepAliveTimeout).toBe(undefined)\n  })","file":"unit/cli.test.ts","skipped":false,"dir":"test"},{"name":"should include all defined rules and no extra / undefined rules","suites":["@next/eslint-plugin-next index"],"updatePoint":{"line":11,"column":69},"line":11,"code":"  it('should include all defined rules and no extra / undefined rules', () => {\n    const rules = rulePaths.map((rulePath) => getRuleNameFromRulePath(rulePath))\n\n    expect(index.rules).toContainAllKeys(rules)\n  })","file":"unit/eslint-plugin-next/index.test.ts","skipped":false,"dir":"test"},{"name":": recommend should be \\`\\`","suites":["@next/eslint-plugin-next index"],"updatePoint":{"line":22,"column":59},"line":22,"code":"    it(`${ruleName}: recommend should be \\`${recommended}\\``, () => {\n      expect(`@next/next/${ruleName}` in index.configs.recommended.rules).toBe(\n        recommended\n      )\n    })","file":"unit/eslint-plugin-next/index.test.ts","skipped":false,"dir":"test"},{"name":"valid link element","suites":["no-html-link-for-pages"],"updatePoint":{"line":189,"column":24},"line":189,"code":"  it('valid link element', function () {\n    const report = linter.verify(validCode, linterConfig, {\n      filename: 'foo.js',\n    })\n    assert.deepEqual(report, [])\n  })","file":"unit/eslint-plugin-next/no-html-link-for-pages.test.ts","skipped":false,"dir":"test"},{"name":"valid link element with multiple directories","suites":["no-html-link-for-pages"],"updatePoint":{"line":196,"column":50},"line":196,"code":"  it('valid link element with multiple directories', function () {\n    const report = linter.verify(\n      validCode,\n      linterConfigWithMultipleDirectories,\n      {\n        filename: 'foo.js',\n      }\n    )\n    assert.deepEqual(report, [])\n  })","file":"unit/eslint-plugin-next/no-html-link-for-pages.test.ts","skipped":false,"dir":"test"},{"name":"valid anchor element","suites":["no-html-link-for-pages"],"updatePoint":{"line":207,"column":26},"line":207,"code":"  it('valid anchor element', function () {\n    const report = linter.verify(validAnchorCode, linterConfig, {\n      filename: 'foo.js',\n    })\n    assert.deepEqual(report, [])\n  })","file":"unit/eslint-plugin-next/no-html-link-for-pages.test.ts","skipped":false,"dir":"test"},{"name":"valid external link element","suites":["no-html-link-for-pages"],"updatePoint":{"line":214,"column":33},"line":214,"code":"  it('valid external link element', function () {\n    const report = linter.verify(validExternalLinkCode, linterConfig, {\n      filename: 'foo.js',\n    })\n    assert.deepEqual(report, [])\n  })","file":"unit/eslint-plugin-next/no-html-link-for-pages.test.ts","skipped":false,"dir":"test"},{"name":"valid download link element","suites":["no-html-link-for-pages"],"updatePoint":{"line":221,"column":33},"line":221,"code":"  it('valid download link element', function () {\n    const report = linter.verify(validDownloadLinkCode, linterConfig, {\n      filename: 'foo.js',\n    })\n    assert.deepEqual(report, [])\n  })","file":"unit/eslint-plugin-next/no-html-link-for-pages.test.ts","skipped":false,"dir":"test"},{"name":"valid target=\"_blank\" link element","suites":["no-html-link-for-pages"],"updatePoint":{"line":228,"column":40},"line":228,"code":"  it('valid target=\"_blank\" link element', function () {\n    const report = linter.verify(validTargetBlankLinkCode, linterConfig, {\n      filename: 'foo.js',\n    })\n    assert.deepEqual(report, [])\n  })","file":"unit/eslint-plugin-next/no-html-link-for-pages.test.ts","skipped":false,"dir":"test"},{"name":"valid public file link element","suites":["no-html-link-for-pages"],"updatePoint":{"line":235,"column":36},"line":235,"code":"  it('valid public file link element', function () {\n    const report = linter.verify(validPublicFile, linterConfig, {\n      filename: 'foo.js',\n    })\n    assert.deepEqual(report, [])\n  })","file":"unit/eslint-plugin-next/no-html-link-for-pages.test.ts","skipped":false,"dir":"test"},{"name":"invalid static route","suites":["no-html-link-for-pages"],"updatePoint":{"line":242,"column":26},"line":242,"code":"  it('invalid static route', function () {\n    const [report] = linter.verify(invalidStaticCode, linterConfig, {\n      filename: 'foo.js',\n    })\n    assert.notEqual(report, undefined, 'No lint errors found.')\n    assert.equal(\n      report.message,\n      'Do not use an `<a>` element to navigate to `/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages'\n    )\n  })","file":"unit/eslint-plugin-next/no-html-link-for-pages.test.ts","skipped":false,"dir":"test"},{"name":"invalid dynamic route","suites":["no-html-link-for-pages"],"updatePoint":{"line":253,"column":27},"line":253,"code":"  it('invalid dynamic route', function () {\n    const [report] = linter.verify(invalidDynamicCode, linterConfig, {\n      filename: 'foo.js',\n    })\n    assert.notEqual(report, undefined, 'No lint errors found.')\n    assert.equal(\n      report.message,\n      'Do not use an `<a>` element to navigate to `/list/foo/bar/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages'\n    )\n    const [secondReport] = linter.verify(\n      secondInvalidDynamicCode,\n      linterConfig,\n      {\n        filename: 'foo.js',\n      }\n    )\n    assert.notEqual(secondReport, undefined, 'No lint errors found.')\n    assert.equal(\n      secondReport.message,\n      'Do not use an `<a>` element to navigate to `/list/foo/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages'\n    )\n    const [thirdReport] = linter.verify(thirdInvalidDynamicCode, linterConfig, {\n      filename: 'foo.js',\n    })\n    assert.notEqual(thirdReport, undefined, 'No lint errors found.')\n    assert.equal(\n      thirdReport.message,\n      'Do not use an `<a>` element to navigate to `/list/lorem-ipsum/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages'\n    )\n  })","file":"unit/eslint-plugin-next/no-html-link-for-pages.test.ts","skipped":false,"dir":"test"},{"name":"should resolve rc.json","suites":["find config"],"updatePoint":{"line":8,"column":28},"line":8,"code":"  it('should resolve rc.json', async () => {\n    const config = await findConfig(join(fixtureDir, 'config-json'), 'test')\n    expect(config).toEqual({ foo: 'bar' })\n  })","file":"unit/find-config.test.ts","skipped":false,"dir":"test"},{"name":"should resolve rc.js","suites":["find config"],"updatePoint":{"line":13,"column":26},"line":13,"code":"  it('should resolve rc.js', async () => {\n    const config = await findConfig(join(fixtureDir, 'config-js'), 'test')\n    expect(config).toEqual({ foo: 'bar' })\n  })","file":"unit/find-config.test.ts","skipped":false,"dir":"test"},{"name":"should resolve .config.json","suites":["find config"],"updatePoint":{"line":18,"column":33},"line":18,"code":"  it('should resolve .config.json', async () => {\n    const config = await findConfig(\n      join(fixtureDir, 'config-long-json'),\n      'test'\n    )\n    expect(config).toEqual({ foo: 'bar' })\n  })","file":"unit/find-config.test.ts","skipped":false,"dir":"test"},{"name":"should resolve .config.js","suites":["find config"],"updatePoint":{"line":26,"column":31},"line":26,"code":"  it('should resolve .config.js', async () => {\n    const config = await findConfig(join(fixtureDir, 'config-long-js'), 'test')\n    expect(config).toEqual({ foo: 'bar' })\n  })","file":"unit/find-config.test.ts","skipped":false,"dir":"test"},{"name":"should resolve .config.cjs","suites":["find config"],"updatePoint":{"line":31,"column":32},"line":31,"code":"  it('should resolve .config.cjs', async () => {\n    const config = await findConfig(join(fixtureDir, 'config-long-cjs'), 'test')\n    expect(config).toEqual({ foo: 'bar' })\n  })","file":"unit/find-config.test.ts","skipped":false,"dir":"test"},{"name":"should resolve package.json","suites":["find config"],"updatePoint":{"line":36,"column":33},"line":36,"code":"  it('should resolve package.json', async () => {\n    const config = await findConfig(\n      join(fixtureDir, 'config-package-json'),\n      'test'\n    )\n    expect(config).toEqual({ foo: 'bar' })\n  })","file":"unit/find-config.test.ts","skipped":false,"dir":"test"},{"name":"should resolve down","suites":["find config"],"updatePoint":{"line":44,"column":25},"line":44,"code":"  it('should resolve down', async () => {\n    const config = await findConfig(\n      join(fixtureDir, 'config-down/one/two/three/'),\n      'test'\n    )\n    expect(config).toEqual({ foo: 'bar' })\n  })","file":"unit/find-config.test.ts","skipped":false,"dir":"test"},{"name":"should work","suites":["findPageFile"],"updatePoint":{"line":14,"column":17},"line":14,"code":"  it('should work', async () => {\n    const pagePath = normalizePagePath('/nav/about')\n    const result = await findPageFile(\n      dirWithPages,\n      pagePath,\n      ['jsx', 'js'],\n      false\n    )\n    expect(result).toMatch(/^[\\\\/]nav[\\\\/]about\\.js/)\n  })","file":"unit/find-page-file.test.ts","skipped":false,"dir":"test"},{"name":"should work with nested index.js","suites":["findPageFile"],"updatePoint":{"line":25,"column":38},"line":25,"code":"  it('should work with nested index.js', async () => {\n    const pagePath = normalizePagePath('/nested')\n    const result = await findPageFile(\n      dirWithPages,\n      pagePath,\n      ['jsx', 'js'],\n      false\n    )\n    expect(result).toMatch(/^[\\\\/]nested[\\\\/]index\\.js/)\n  })","file":"unit/find-page-file.test.ts","skipped":false,"dir":"test"},{"name":"should prefer prefered.js before preferred/index.js","suites":["findPageFile"],"updatePoint":{"line":36,"column":57},"line":36,"code":"  it('should prefer prefered.js before preferred/index.js', async () => {\n    const pagePath = normalizePagePath('/prefered')\n    const result = await findPageFile(\n      dirWithPages,\n      pagePath,\n      ['jsx', 'js'],\n      false\n    )\n    expect(result).toMatch(/^[\\\\/]prefered\\.js/)\n  })","file":"unit/find-page-file.test.ts","skipped":false,"dir":"test"},{"name":"should determine either server or client component page file as leaf node page","suites":["isLayoutsLeafPage"],"updatePoint":{"line":49,"column":84},"line":49,"code":"  it('should determine either server or client component page file as leaf node page', () => {\n    expect(isLayoutsLeafPage('page.js')).toBe(true)\n    expect(isLayoutsLeafPage('./page.server.js')).toBe(true)\n    expect(isLayoutsLeafPage('./page.server.jsx')).toBe(true)\n    expect(isLayoutsLeafPage('./page.client.ts')).toBe(true)\n    expect(isLayoutsLeafPage('./page.client.tsx')).toBe(true)\n  })","file":"unit/find-page-file.test.ts","skipped":false,"dir":"test"},{"name":"should determine other files under layout routes as non leaf node","suites":["isLayoutsLeafPage"],"updatePoint":{"line":57,"column":71},"line":57,"code":"  it('should determine other files under layout routes as non leaf node', () => {\n    expect(isLayoutsLeafPage('./page.component.jsx')).toBe(false)\n    expect(isLayoutsLeafPage('layout.js')).toBe(false)\n  })","file":"unit/find-page-file.test.ts","skipped":false,"dir":"test"},{"name":"removes --inspect option","suites":["getNodeOptionsWithoutInspect"],"updatePoint":{"line":11,"column":30},"line":11,"code":"  it('removes --inspect option', () => {\n    process.env.NODE_OPTIONS = '--other --inspect --additional'\n    const result = getNodeOptionsWithoutInspect()\n\n    expect(result).toBe('--other --additional')\n  })","file":"unit/get-node-options-without-inspect.test.ts","skipped":false,"dir":"test"},{"name":"removes --inspect option at end of line","suites":["getNodeOptionsWithoutInspect"],"updatePoint":{"line":18,"column":45},"line":18,"code":"  it('removes --inspect option at end of line', () => {\n    process.env.NODE_OPTIONS = '--other --inspect'\n    const result = getNodeOptionsWithoutInspect()\n\n    expect(result).toBe('--other ')\n  })","file":"unit/get-node-options-without-inspect.test.ts","skipped":false,"dir":"test"},{"name":"removes --inspect option with parameters","suites":["getNodeOptionsWithoutInspect"],"updatePoint":{"line":25,"column":46},"line":25,"code":"  it('removes --inspect option with parameters', () => {\n    process.env.NODE_OPTIONS = '--other --inspect=0.0.0.0:1234 --additional'\n    const result = getNodeOptionsWithoutInspect()\n\n    expect(result).toBe('--other --additional')\n  })","file":"unit/get-node-options-without-inspect.test.ts","skipped":false,"dir":"test"},{"name":"removes --inspect-brk option","suites":["getNodeOptionsWithoutInspect"],"updatePoint":{"line":32,"column":34},"line":32,"code":"  it('removes --inspect-brk option', () => {\n    process.env.NODE_OPTIONS = '--other --inspect-brk --additional'\n    const result = getNodeOptionsWithoutInspect()\n\n    expect(result).toBe('--other --additional')\n  })","file":"unit/get-node-options-without-inspect.test.ts","skipped":false,"dir":"test"},{"name":"removes --inspect-brk option with parameters","suites":["getNodeOptionsWithoutInspect"],"updatePoint":{"line":39,"column":50},"line":39,"code":"  it('removes --inspect-brk option with parameters', () => {\n    process.env.NODE_OPTIONS = '--other --inspect-brk=0.0.0.0:1234 --additional'\n    const result = getNodeOptionsWithoutInspect()\n\n    expect(result).toBe('--other --additional')\n  })","file":"unit/get-node-options-without-inspect.test.ts","skipped":false,"dir":"test"},{"name":"ignores unrelated options starting with --inspect-","suites":["getNodeOptionsWithoutInspect"],"updatePoint":{"line":46,"column":56},"line":46,"code":"  it('ignores unrelated options starting with --inspect-', () => {\n    process.env.NODE_OPTIONS =\n      '--other --inspect-port=0.0.0.0:1234 --additional'\n    const result = getNodeOptionsWithoutInspect()\n\n    expect(result).toBe('--other --inspect-port=0.0.0.0:1234 --additional')\n  })","file":"unit/get-node-options-without-inspect.test.ts","skipped":false,"dir":"test"},{"name":"should not start dev server on require","suites":["get-project-dir"],"updatePoint":{"line":2,"column":44},"line":2,"code":"  it('should not start dev server on require', async () => {\n    require('next/dist/lib/get-project-dir')\n  })","file":"unit/get-project-dir.test.ts","skipped":false,"dir":"test"},{"name":"gets the proper display name of a component","suites":["getDisplayName"],"updatePoint":{"line":6,"column":49},"line":6,"code":"  it('gets the proper display name of a component', () => {\n    class ComponentOne extends Component {\n      render() {\n        return null\n      }\n    }\n\n    class ComponentTwo extends Component {\n      static displayName = 'CustomDisplayName'\n      render() {\n        return null\n      }\n    }\n\n    function FunctionalComponent() {\n      return null\n    }\n\n    expect(getDisplayName(ComponentOne)).toBe('ComponentOne')\n    expect(getDisplayName(ComponentTwo)).toBe('CustomDisplayName')\n    expect(getDisplayName(FunctionalComponent)).toBe('FunctionalComponent')\n    expect(getDisplayName(() => null)).toBe('Unknown')\n    expect(getDisplayName('div' as any)).toBe('div')\n  })","file":"unit/getDisplayName.test.ts","skipped":false,"dir":"test"},{"name":"with angle brackets should escape","suites":["htmlescape"],"updatePoint":{"line":8,"column":41},"line":8,"code":"  test('with angle brackets should escape', () => {\n    const evilObj = { evil: '<script></script>' }\n    expect(htmlEscapeJsonString(JSON.stringify(evilObj))).toBe(\n      '{\"evil\":\"\\\\u003cscript\\\\u003e\\\\u003c/script\\\\u003e\"}'\n    )\n  })","file":"unit/htmlescape.test.ts","skipped":false,"dir":"test"},{"name":"with angle brackets should parse back","suites":["htmlescape"],"updatePoint":{"line":15,"column":45},"line":15,"code":"  test('with angle brackets should parse back', () => {\n    const evilObj = { evil: '<script></script>' }\n    expect(\n      JSON.parse(htmlEscapeJsonString(JSON.stringify(evilObj)))\n    ).toMatchObject(evilObj)\n  })","file":"unit/htmlescape.test.ts","skipped":false,"dir":"test"},{"name":"with ampersands should escape","suites":["htmlescape"],"updatePoint":{"line":22,"column":37},"line":22,"code":"  test('with ampersands should escape', () => {\n    const evilObj = { evil: '&' }\n    expect(htmlEscapeJsonString(JSON.stringify(evilObj))).toBe(\n      '{\"evil\":\"\\\\u0026\"}'\n    )\n  })","file":"unit/htmlescape.test.ts","skipped":false,"dir":"test"},{"name":"with ampersands should parse back","suites":["htmlescape"],"updatePoint":{"line":29,"column":41},"line":29,"code":"  test('with ampersands should parse back', () => {\n    const evilObj = { evil: '&' }\n    expect(\n      JSON.parse(htmlEscapeJsonString(JSON.stringify(evilObj)))\n    ).toMatchObject(evilObj)\n  })","file":"unit/htmlescape.test.ts","skipped":false,"dir":"test"},{"name":"with \"LINE SEPARATOR\" and \"PARAGRAPH SEPARATOR\" should escape","suites":["htmlescape"],"updatePoint":{"line":36,"column":69},"line":36,"code":"  test('with \"LINE SEPARATOR\" and \"PARAGRAPH SEPARATOR\" should escape', () => {\n    const evilObj = { evil: '\\u2028\\u2029' }\n    expect(htmlEscapeJsonString(JSON.stringify(evilObj))).toBe(\n      '{\"evil\":\"\\\\u2028\\\\u2029\"}'\n    )\n  })","file":"unit/htmlescape.test.ts","skipped":false,"dir":"test"},{"name":"with \"LINE SEPARATOR\" and \"PARAGRAPH SEPARATOR\" should parse back","suites":["htmlescape"],"updatePoint":{"line":43,"column":73},"line":43,"code":"  test('with \"LINE SEPARATOR\" and \"PARAGRAPH SEPARATOR\" should parse back', () => {\n    const evilObj = { evil: '\\u2028\\u2029' }\n    expect(\n      JSON.parse(htmlEscapeJsonString(JSON.stringify(evilObj)))\n    ).toMatchObject(evilObj)\n  })","file":"unit/htmlescape.test.ts","skipped":false,"dir":"test"},{"name":"escaped line terminators should work","suites":["htmlescape"],"updatePoint":{"line":50,"column":44},"line":50,"code":"  test('escaped line terminators should work', () => {\n    expect(() => {\n      vm.runInNewContext(\n        '(' +\n          htmlEscapeJsonString(JSON.stringify({ evil: '\\u2028\\u2029' })) +\n          ')'\n      )\n    }).not.toThrow()\n  })","file":"unit/htmlescape.test.ts","skipped":false,"dir":"test"},{"name":"should return jpg","suites":["detectContentType"],"updatePoint":{"line":9,"column":23},"line":9,"code":"  it('should return jpg', async () => {\n    const buffer = await getImage('./images/test.jpg')\n    expect(detectContentType(buffer)).toBe('image/jpeg')\n  })","file":"unit/image-optimizer/detect-content-type.test.ts","skipped":false,"dir":"test"},{"name":"should return png","suites":["detectContentType"],"updatePoint":{"line":13,"column":23},"line":13,"code":"  it('should return png', async () => {\n    const buffer = await getImage('./images/test.png')\n    expect(detectContentType(buffer)).toBe('image/png')\n  })","file":"unit/image-optimizer/detect-content-type.test.ts","skipped":false,"dir":"test"},{"name":"should return webp","suites":["detectContentType"],"updatePoint":{"line":17,"column":24},"line":17,"code":"  it('should return webp', async () => {\n    const buffer = await getImage('./images/animated.webp')\n    expect(detectContentType(buffer)).toBe('image/webp')\n  })","file":"unit/image-optimizer/detect-content-type.test.ts","skipped":false,"dir":"test"},{"name":"should return svg","suites":["detectContentType"],"updatePoint":{"line":21,"column":23},"line":21,"code":"  it('should return svg', async () => {\n    const buffer = await getImage('./images/test.svg')\n    expect(detectContentType(buffer)).toBe('image/svg+xml')\n  })","file":"unit/image-optimizer/detect-content-type.test.ts","skipped":false,"dir":"test"},{"name":"should return avif","suites":["detectContentType"],"updatePoint":{"line":25,"column":24},"line":25,"code":"  it('should return avif', async () => {\n    const buffer = await getImage('./images/test.avif')\n    expect(detectContentType(buffer)).toBe('image/avif')\n  })","file":"unit/image-optimizer/detect-content-type.test.ts","skipped":false,"dir":"test"},{"name":"should return 0 when no cache-control provided","suites":["getMaxAge"],"updatePoint":{"line":5,"column":52},"line":5,"code":"  it('should return 0 when no cache-control provided', () => {\n    expect(getMaxAge(undefined)).toBe(0)\n  })","file":"unit/image-optimizer/get-max-age.test.ts","skipped":false,"dir":"test"},{"name":"should return 0 when cache-control is null","suites":["getMaxAge"],"updatePoint":{"line":8,"column":48},"line":8,"code":"  it('should return 0 when cache-control is null', () => {\n    expect(getMaxAge(null)).toBe(0)\n  })","file":"unit/image-optimizer/get-max-age.test.ts","skipped":false,"dir":"test"},{"name":"should return 0 when cache-control is empty string","suites":["getMaxAge"],"updatePoint":{"line":11,"column":56},"line":11,"code":"  it('should return 0 when cache-control is empty string', () => {\n    expect(getMaxAge('')).toBe(0)\n  })","file":"unit/image-optimizer/get-max-age.test.ts","skipped":false,"dir":"test"},{"name":"should return 0 when cache-control max-age is not a number","suites":["getMaxAge"],"updatePoint":{"line":14,"column":64},"line":14,"code":"  it('should return 0 when cache-control max-age is not a number', () => {\n    expect(getMaxAge('max-age=foo')).toBe(0)\n  })","file":"unit/image-optimizer/get-max-age.test.ts","skipped":false,"dir":"test"},{"name":"should return 0 when cache-control is no-cache","suites":["getMaxAge"],"updatePoint":{"line":17,"column":52},"line":17,"code":"  it('should return 0 when cache-control is no-cache', () => {\n    expect(getMaxAge('no-cache')).toBe(0)\n  })","file":"unit/image-optimizer/get-max-age.test.ts","skipped":false,"dir":"test"},{"name":"should return cache-control max-age lowercase","suites":["getMaxAge"],"updatePoint":{"line":20,"column":51},"line":20,"code":"  it('should return cache-control max-age lowercase', () => {\n    expect(getMaxAge('max-age=9999')).toBe(9999)\n  })","file":"unit/image-optimizer/get-max-age.test.ts","skipped":false,"dir":"test"},{"name":"should return cache-control MAX-AGE uppercase","suites":["getMaxAge"],"updatePoint":{"line":23,"column":51},"line":23,"code":"  it('should return cache-control MAX-AGE uppercase', () => {\n    expect(getMaxAge('MAX-AGE=9999')).toBe(9999)\n  })","file":"unit/image-optimizer/get-max-age.test.ts","skipped":false,"dir":"test"},{"name":"should return cache-control s-maxage lowercase","suites":["getMaxAge"],"updatePoint":{"line":26,"column":52},"line":26,"code":"  it('should return cache-control s-maxage lowercase', () => {\n    expect(getMaxAge('s-maxage=9999')).toBe(9999)\n  })","file":"unit/image-optimizer/get-max-age.test.ts","skipped":false,"dir":"test"},{"name":"should return cache-control S-MAXAGE","suites":["getMaxAge"],"updatePoint":{"line":29,"column":42},"line":29,"code":"  it('should return cache-control S-MAXAGE', () => {\n    expect(getMaxAge('S-MAXAGE=9999')).toBe(9999)\n  })","file":"unit/image-optimizer/get-max-age.test.ts","skipped":false,"dir":"test"},{"name":"should return cache-control s-maxage with spaces","suites":["getMaxAge"],"updatePoint":{"line":32,"column":54},"line":32,"code":"  it('should return cache-control s-maxage with spaces', () => {\n    expect(getMaxAge('public, max-age=5555, s-maxage=9999')).toBe(9999)\n  })","file":"unit/image-optimizer/get-max-age.test.ts","skipped":false,"dir":"test"},{"name":"should return cache-control s-maxage without spaces","suites":["getMaxAge"],"updatePoint":{"line":35,"column":57},"line":35,"code":"  it('should return cache-control s-maxage without spaces', () => {\n    expect(getMaxAge('public,s-maxage=9999,max-age=5555')).toBe(9999)\n  })","file":"unit/image-optimizer/get-max-age.test.ts","skipped":false,"dir":"test"},{"name":"should return cache-control for a quoted value","suites":["getMaxAge"],"updatePoint":{"line":38,"column":52},"line":38,"code":"  it('should return cache-control for a quoted value', () => {\n    expect(getMaxAge('public, s-maxage=\"9999\", max-age=\"5555\"')).toBe(9999)\n  })","file":"unit/image-optimizer/get-max-age.test.ts","skipped":false,"dir":"test"},{"name":"should match literal hostname","suites":["matchRemotePattern"],"updatePoint":{"line":8,"column":35},"line":8,"code":"  it('should match literal hostname', () => {\n    const p = { hostname: 'example.com' } as const\n    expect(m(p, new URL('https://example.com'))).toBe(true)\n    expect(m(p, new URL('https://example.com.uk'))).toBe(false)\n    expect(m(p, new URL('https://example.net'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com'))).toBe(false)\n    expect(m(p, new URL('https://com'))).toBe(false)\n    expect(m(p, new URL('https://example.com/path'))).toBe(true)\n    expect(m(p, new URL('https://example.com/path/to'))).toBe(true)\n    expect(m(p, new URL('https://example.com/path/to/file'))).toBe(true)\n    expect(m(p, new URL('https://example.com:81/path/to/file'))).toBe(true)\n    expect(m(p, new URL('https://example.com:81/path/to/file?q=1'))).toBe(true)\n    expect(m(p, new URL('http://example.com:81/path/to/file'))).toBe(true)\n  })","file":"unit/image-optimizer/match-remote-pattern.test.ts","skipped":false,"dir":"test"},{"name":"should match literal protocol and hostname","suites":["matchRemotePattern"],"updatePoint":{"line":23,"column":48},"line":23,"code":"  it('should match literal protocol and hostname', () => {\n    const p = { protocol: 'https', hostname: 'example.com' } as const\n    expect(m(p, new URL('https://example.com'))).toBe(true)\n    expect(m(p, new URL('https://example.com.uk'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com'))).toBe(false)\n    expect(m(p, new URL('https://com'))).toBe(false)\n    expect(m(p, new URL('https://example.com/path/to'))).toBe(true)\n    expect(m(p, new URL('https://example.com/path/to/file'))).toBe(true)\n    expect(m(p, new URL('https://example.com/path/to/file'))).toBe(true)\n    expect(m(p, new URL('https://example.com:81/path/to/file'))).toBe(true)\n    expect(m(p, new URL('https://example.com:81/path/to/file?q=1'))).toBe(true)\n    expect(m(p, new URL('http://example.com:81/path/to/file'))).toBe(false)\n    expect(m(p, new URL('ftp://example.com:81/path/to/file'))).toBe(false)\n  })","file":"unit/image-optimizer/match-remote-pattern.test.ts","skipped":false,"dir":"test"},{"name":"should match literal protocol, hostname, no port","suites":["matchRemotePattern"],"updatePoint":{"line":38,"column":54},"line":38,"code":"  it('should match literal protocol, hostname, no port', () => {\n    const p = { protocol: 'https', hostname: 'example.com', port: '' } as const\n    expect(m(p, new URL('https://example.com'))).toBe(true)\n    expect(m(p, new URL('https://example.com.uk'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com'))).toBe(false)\n    expect(m(p, new URL('https://com'))).toBe(false)\n    expect(m(p, new URL('https://example.com/path/to/file'))).toBe(true)\n    expect(m(p, new URL('https://example.com/path/to/file?q=1'))).toBe(true)\n    expect(m(p, new URL('http://example.com/path/to/file'))).toBe(false)\n    expect(m(p, new URL('ftp://example.com/path/to/file'))).toBe(false)\n    expect(m(p, new URL('https://example.com:81/path/to/file'))).toBe(false)\n    expect(m(p, new URL('https://example.com:81/path/to/file?q=1'))).toBe(false)\n    expect(m(p, new URL('http://example.com:81/path/to/file'))).toBe(false)\n  })","file":"unit/image-optimizer/match-remote-pattern.test.ts","skipped":false,"dir":"test"},{"name":"should match literal protocol, hostname, port 42","suites":["matchRemotePattern"],"updatePoint":{"line":53,"column":54},"line":53,"code":"  it('should match literal protocol, hostname, port 42', () => {\n    const p = {\n      protocol: 'https',\n      hostname: 'example.com',\n      port: '42',\n    } as const\n    expect(m(p, new URL('https://example.com:42'))).toBe(true)\n    expect(m(p, new URL('https://example.com.uk:42'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com:42'))).toBe(false)\n    expect(m(p, new URL('https://com:42'))).toBe(false)\n    expect(m(p, new URL('https://example.com:42/path/to/file'))).toBe(true)\n    expect(m(p, new URL('https://example.com:42/path/to/file?q=1'))).toBe(true)\n    expect(m(p, new URL('http://example.com:42/path/to/file'))).toBe(false)\n    expect(m(p, new URL('ftp://example.com:42/path/to/file'))).toBe(false)\n    expect(m(p, new URL('https://example.com'))).toBe(false)\n    expect(m(p, new URL('https://example.com.uk'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com'))).toBe(false)\n    expect(m(p, new URL('https://com'))).toBe(false)\n    expect(m(p, new URL('https://example.com/path/to/file'))).toBe(false)\n    expect(m(p, new URL('https://example.com/path/to/file?q=1'))).toBe(false)\n    expect(m(p, new URL('http://example.com/path/to/file'))).toBe(false)\n    expect(m(p, new URL('ftp://example.com/path/to/file'))).toBe(false)\n  })","file":"unit/image-optimizer/match-remote-pattern.test.ts","skipped":false,"dir":"test"},{"name":"should match literal protocol, hostname, port, pathname","suites":["matchRemotePattern"],"updatePoint":{"line":77,"column":61},"line":77,"code":"  it('should match literal protocol, hostname, port, pathname', () => {\n    const p = {\n      protocol: 'https',\n      hostname: 'example.com',\n      port: '42',\n      pathname: '/path/to/file',\n    } as const\n    expect(m(p, new URL('https://example.com:42'))).toBe(false)\n    expect(m(p, new URL('https://example.com.uk:42'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com:42'))).toBe(false)\n    expect(m(p, new URL('https://example.com:42/path'))).toBe(false)\n    expect(m(p, new URL('https://example.com:42/path/to'))).toBe(false)\n    expect(m(p, new URL('https://example.com:42/file'))).toBe(false)\n    expect(m(p, new URL('https://example.com:42/path/to/file'))).toBe(true)\n    expect(m(p, new URL('https://example.com:42/path/to/file?q=1'))).toBe(true)\n    expect(m(p, new URL('http://example.com:42/path/to/file'))).toBe(false)\n    expect(m(p, new URL('ftp://example.com:42/path/to/file'))).toBe(false)\n    expect(m(p, new URL('https://example.com'))).toBe(false)\n    expect(m(p, new URL('https://example.com.uk'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com'))).toBe(false)\n    expect(m(p, new URL('https://example.com/path'))).toBe(false)\n    expect(m(p, new URL('https://example.com/path/to'))).toBe(false)\n    expect(m(p, new URL('https://example.com/path/to/file'))).toBe(false)\n    expect(m(p, new URL('https://example.com/path/to/file?q=1'))).toBe(false)\n    expect(m(p, new URL('http://example.com/path/to/file'))).toBe(false)\n    expect(m(p, new URL('ftp://example.com/path/to/file'))).toBe(false)\n  })","file":"unit/image-optimizer/match-remote-pattern.test.ts","skipped":false,"dir":"test"},{"name":"should match hostname pattern with single asterisk by itself","suites":["matchRemotePattern"],"updatePoint":{"line":105,"column":66},"line":105,"code":"  it('should match hostname pattern with single asterisk by itself', () => {\n    const p = { hostname: 'avatars.*.example.com' } as const\n    expect(m(p, new URL('https://com'))).toBe(false)\n    expect(m(p, new URL('https://example.com'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com'))).toBe(false)\n    expect(m(p, new URL('https://example.com.uk'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com.uk'))).toBe(false)\n    expect(m(p, new URL('https://avatars.example.com'))).toBe(false)\n    expect(m(p, new URL('https://avatars.sfo1.example.com'))).toBe(true)\n    expect(m(p, new URL('https://avatars.iad1.example.com'))).toBe(true)\n    expect(m(p, new URL('https://more.avatars.iad1.example.com'))).toBe(false)\n  })","file":"unit/image-optimizer/match-remote-pattern.test.ts","skipped":false,"dir":"test"},{"name":"should match hostname pattern with single asterisk at beginning","suites":["matchRemotePattern"],"updatePoint":{"line":118,"column":69},"line":118,"code":"  it('should match hostname pattern with single asterisk at beginning', () => {\n    const p = { hostname: 'avatars.*1.example.com' } as const\n    expect(m(p, new URL('https://com'))).toBe(false)\n    expect(m(p, new URL('https://example.com'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com'))).toBe(false)\n    expect(m(p, new URL('https://example.com.uk'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com.uk'))).toBe(false)\n    expect(m(p, new URL('https://avatars.example.com'))).toBe(false)\n    expect(m(p, new URL('https://avatars.sfo1.example.com'))).toBe(true)\n    expect(m(p, new URL('https://avatars.iad1.example.com'))).toBe(true)\n    expect(m(p, new URL('https://more.avatars.iad1.example.com'))).toBe(false)\n    expect(m(p, new URL('https://avatars.sfo2.example.com'))).toBe(false)\n    expect(m(p, new URL('https://avatars.iad2.example.com'))).toBe(false)\n    expect(m(p, new URL('https://avatars.1.example.com'))).toBe(true)\n  })","file":"unit/image-optimizer/match-remote-pattern.test.ts","skipped":false,"dir":"test"},{"name":"should match hostname pattern with single asterisk in middle","suites":["matchRemotePattern"],"updatePoint":{"line":134,"column":66},"line":134,"code":"  it('should match hostname pattern with single asterisk in middle', () => {\n    const p = { hostname: 'avatars.*a*.example.com' } as const\n    expect(m(p, new URL('https://com'))).toBe(false)\n    expect(m(p, new URL('https://example.com'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com'))).toBe(false)\n    expect(m(p, new URL('https://example.com.uk'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com.uk'))).toBe(false)\n    expect(m(p, new URL('https://avatars.example.com'))).toBe(false)\n    expect(m(p, new URL('https://avatars.sfo1.example.com'))).toBe(false)\n    expect(m(p, new URL('https://avatars.iad1.example.com'))).toBe(true)\n    expect(m(p, new URL('https://more.avatars.iad1.example.com'))).toBe(false)\n    expect(m(p, new URL('https://avatars.sfo2.example.com'))).toBe(false)\n    expect(m(p, new URL('https://avatars.iad2.example.com'))).toBe(true)\n    expect(m(p, new URL('https://avatars.a.example.com'))).toBe(true)\n  })","file":"unit/image-optimizer/match-remote-pattern.test.ts","skipped":false,"dir":"test"},{"name":"should match hostname pattern with single asterisk at end","suites":["matchRemotePattern"],"updatePoint":{"line":150,"column":63},"line":150,"code":"  it('should match hostname pattern with single asterisk at end', () => {\n    const p = { hostname: 'avatars.ia*.example.com' } as const\n    expect(m(p, new URL('https://com'))).toBe(false)\n    expect(m(p, new URL('https://example.com'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com'))).toBe(false)\n    expect(m(p, new URL('https://example.com.uk'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com.uk'))).toBe(false)\n    expect(m(p, new URL('https://avatars.example.com'))).toBe(false)\n    expect(m(p, new URL('https://avatars.sfo1.example.com'))).toBe(false)\n    expect(m(p, new URL('https://avatars.iad1.example.com'))).toBe(true)\n    expect(m(p, new URL('https://more.avatars.iad1.example.com'))).toBe(false)\n    expect(m(p, new URL('https://avatars.sfo2.example.com'))).toBe(false)\n    expect(m(p, new URL('https://avatars.iad2.example.com'))).toBe(true)\n    expect(m(p, new URL('https://avatars.ia.example.com'))).toBe(true)\n  })","file":"unit/image-optimizer/match-remote-pattern.test.ts","skipped":false,"dir":"test"},{"name":"should match hostname pattern with double asterisk","suites":["matchRemotePattern"],"updatePoint":{"line":166,"column":56},"line":166,"code":"  it('should match hostname pattern with double asterisk', () => {\n    const p = { hostname: '**.example.com' } as const\n    expect(m(p, new URL('https://com'))).toBe(false)\n    expect(m(p, new URL('https://example.com'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com'))).toBe(true)\n    expect(m(p, new URL('https://deep.sub.example.com'))).toBe(true)\n    expect(m(p, new URL('https://example.com.uk'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com.uk'))).toBe(false)\n    expect(m(p, new URL('https://avatars.example.com'))).toBe(true)\n    expect(m(p, new URL('https://avatars.sfo1.example.com'))).toBe(true)\n    expect(m(p, new URL('https://avatars.iad1.example.com'))).toBe(true)\n    expect(m(p, new URL('https://more.avatars.iad1.example.com'))).toBe(true)\n  })","file":"unit/image-optimizer/match-remote-pattern.test.ts","skipped":false,"dir":"test"},{"name":"should match pathname pattern with single asterisk by itself","suites":["matchRemotePattern"],"updatePoint":{"line":180,"column":66},"line":180,"code":"  it('should match pathname pattern with single asterisk by itself', () => {\n    const p = {\n      hostname: 'example.com',\n      pathname: '/act123/*/pic.jpg',\n    } as const\n    expect(m(p, new URL('https://com'))).toBe(false)\n    expect(m(p, new URL('https://example.com'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com'))).toBe(false)\n    expect(m(p, new URL('https://example.com.uk'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123/usr4'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123/usr4/pic'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123/usr4/picsjpg'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123/usr4/pic.jpg'))).toBe(true)\n    expect(m(p, new URL('https://example.com/act123/usr5/pic.jpg'))).toBe(true)\n    expect(m(p, new URL('https://example.com/act123/usr6/pic.jpg'))).toBe(true)\n    expect(m(p, new URL('https://example.com/act123/team/pic.jpg'))).toBe(true)\n    expect(m(p, new URL('https://example.com/act456/team/pic.jpg'))).toBe(false)\n    expect(m(p, new URL('https://example.com/team/pic.jpg'))).toBe(false)\n  })","file":"unit/image-optimizer/match-remote-pattern.test.ts","skipped":false,"dir":"test"},{"name":"should match pathname pattern with single asterisk at the beginning","suites":["matchRemotePattern"],"updatePoint":{"line":201,"column":73},"line":201,"code":"  it('should match pathname pattern with single asterisk at the beginning', () => {\n    const p = {\n      hostname: 'example.com',\n      pathname: '/act123/*4/pic.jpg',\n    } as const\n    expect(m(p, new URL('https://com'))).toBe(false)\n    expect(m(p, new URL('https://example.com'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com'))).toBe(false)\n    expect(m(p, new URL('https://example.com.uk'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123/usr4'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123/usr4/pic'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123/usr4/picsjpg'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123/usr4/pic.jpg'))).toBe(true)\n    expect(m(p, new URL('https://example.com/act123/usr5/pic.jpg'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123/team4/pic.jpg'))).toBe(true)\n    expect(m(p, new URL('https://example.com/act456/team5/pic.jpg'))).toBe(\n      false\n    )\n    expect(m(p, new URL('https://example.com/team/pic.jpg'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123/4/pic.jpg'))).toBe(true)\n  })","file":"unit/image-optimizer/match-remote-pattern.test.ts","skipped":false,"dir":"test"},{"name":"should match pathname pattern with single asterisk in the middle","suites":["matchRemotePattern"],"updatePoint":{"line":224,"column":70},"line":224,"code":"  it('should match pathname pattern with single asterisk in the middle', () => {\n    const p = {\n      hostname: 'example.com',\n      pathname: '/act123/*sr*/pic.jpg',\n    } as const\n    expect(m(p, new URL('https://com'))).toBe(false)\n    expect(m(p, new URL('https://example.com'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com'))).toBe(false)\n    expect(m(p, new URL('https://example.com.uk'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123/usr4'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123/usr4/pic'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123/usr4/picsjpg'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123/usr4/pic.jpg'))).toBe(true)\n    expect(m(p, new URL('https://example.com/act123/usr5/pic.jpg'))).toBe(true)\n    expect(m(p, new URL('https://example.com/act123/team4/pic.jpg'))).toBe(\n      false\n    )\n    expect(m(p, new URL('https://example.com/act123/team5/pic.jpg'))).toBe(\n      false\n    )\n    expect(m(p, new URL('https://example.com/team/pic.jpg'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123/sr/pic.jpg'))).toBe(true)\n  })","file":"unit/image-optimizer/match-remote-pattern.test.ts","skipped":false,"dir":"test"},{"name":"should match pathname pattern with single asterisk at the end","suites":["matchRemotePattern"],"updatePoint":{"line":249,"column":67},"line":249,"code":"  it('should match pathname pattern with single asterisk at the end', () => {\n    const p = {\n      hostname: 'example.com',\n      pathname: '/act123/usr*/pic.jpg',\n    } as const\n    expect(m(p, new URL('https://com'))).toBe(false)\n    expect(m(p, new URL('https://example.com'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com'))).toBe(false)\n    expect(m(p, new URL('https://example.com.uk'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123/usr4'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123/usr4/pic'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123/usr4/picsjpg'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123/usr4/pic.jpg'))).toBe(true)\n    expect(m(p, new URL('https://example.com/act123/usr5/pic.jpg'))).toBe(true)\n    expect(m(p, new URL('https://example.com/act123/usr/pic.jpg'))).toBe(true)\n    expect(m(p, new URL('https://example.com/act123/team4/pic.jpg'))).toBe(\n      false\n    )\n    expect(m(p, new URL('https://example.com/act456/team5/pic.jpg'))).toBe(\n      false\n    )\n    expect(m(p, new URL('https://example.com/team/pic.jpg'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com/act123/usr6/pic.jpg'))).toBe(\n      false\n    )\n  })","file":"unit/image-optimizer/match-remote-pattern.test.ts","skipped":false,"dir":"test"},{"name":"should match pathname pattern with double asterisk","suites":["matchRemotePattern"],"updatePoint":{"line":277,"column":56},"line":277,"code":"  it('should match pathname pattern with double asterisk', () => {\n    const p = { hostname: 'example.com', pathname: '/act123/**' } as const\n    expect(m(p, new URL('https://com'))).toBe(false)\n    expect(m(p, new URL('https://example.com'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com'))).toBe(false)\n    expect(m(p, new URL('https://example.com.uk'))).toBe(false)\n    expect(m(p, new URL('https://example.com/act123'))).toBe(true)\n    expect(m(p, new URL('https://example.com/act123/usr4'))).toBe(true)\n    expect(m(p, new URL('https://example.com/act123/usr4/pic'))).toBe(true)\n    expect(m(p, new URL('https://example.com/act123/usr4/picsjpg'))).toBe(true)\n    expect(m(p, new URL('https://example.com/act123/usr4/pic.jpg'))).toBe(true)\n    expect(m(p, new URL('https://example.com/act123/usr5/pic.jpg'))).toBe(true)\n    expect(m(p, new URL('https://example.com/act123/usr6/pic.jpg'))).toBe(true)\n    expect(m(p, new URL('https://example.com/act123/team/pic.jpg'))).toBe(true)\n    expect(m(p, new URL('https://example.com/act456/team/pic.jpg'))).toBe(false)\n    expect(m(p, new URL('https://example.com/team/pic.jpg'))).toBe(false)\n    expect(m(p, new URL('https://sub.example.com/act123/team/pic.jpg'))).toBe(\n      false\n    )\n  })","file":"unit/image-optimizer/match-remote-pattern.test.ts","skipped":false,"dir":"test"},{"name":"should throw when hostname is missing","suites":["matchRemotePattern"],"updatePoint":{"line":298,"column":43},"line":298,"code":"  it('should throw when hostname is missing', () => {\n    const p = { protocol: 'https' } as const\n    // @ts-ignore testing invalid input\n    expect(() => m(p, new URL('https://example.com'))).toThrow(\n      'Pattern should define hostname but found\\n{\"protocol\":\"https\"}'\n    )\n  })","file":"unit/image-optimizer/match-remote-pattern.test.ts","skipped":false,"dir":"test"},{"name":"should properly work with hasMatch","suites":["matchRemotePattern"],"updatePoint":{"line":306,"column":40},"line":306,"code":"  it('should properly work with hasMatch', () => {\n    const url = new URL('https://example.com')\n    expect(hasMatch([], [], url)).toBe(false)\n    expect(hasMatch(['foo.com'], [], url)).toBe(false)\n    expect(hasMatch(['example.com'], [], url)).toBe(true)\n    expect(hasMatch(['**.example.com'], [], url)).toBe(false)\n    expect(hasMatch(['*.example.com'], [], url)).toBe(false)\n    expect(hasMatch(['*.example.com'], [], url)).toBe(false)\n    expect(hasMatch([], [{ hostname: 'foo.com' }], url)).toBe(false)\n    expect(\n      hasMatch([], [{ hostname: 'foo.com' }, { hostname: 'example.com' }], url)\n    ).toBe(true)\n    expect(\n      hasMatch([], [{ hostname: 'example.com', pathname: '/act123/**' }], url)\n    ).toBe(false)\n    expect(\n      hasMatch(\n        ['example.com'],\n        [{ hostname: 'example.com', pathname: '/act123/**' }],\n        url\n      )\n    ).toBe(true)\n    expect(\n      hasMatch([], [{ protocol: 'https', hostname: 'example.com' }], url)\n    ).toBe(true)\n    expect(\n      hasMatch([], [{ protocol: 'http', hostname: 'example.com' }], url)\n    ).toBe(false)\n    expect(\n      hasMatch(\n        ['example.com'],\n        [{ protocol: 'http', hostname: 'example.com' }],\n        url\n      )\n    ).toBe(true)\n    expect(\n      hasMatch(\n        ['foo.com'],\n        [{ protocol: 'http', hostname: 'example.com' }],\n        url\n      )\n    ).toBe(false)\n  })","file":"unit/image-optimizer/match-remote-pattern.test.ts","skipped":false,"dir":"test"},{"name":"should render Image on its own","suites":["Image rendering"],"updatePoint":{"line":8,"column":36},"line":8,"code":"  it('should render Image on its own', async () => {\n    const element = React.createElement(Image, {\n      id: 'unit-image',\n      src: '/test.png',\n      width: 100,\n      height: 100,\n      loading: 'eager',\n    })\n    const html = ReactDOM.renderToString(element)\n    const $ = cheerio.load(html)\n    const img = $('#unit-image')\n    expect(img.attr('id')).toBe('unit-image')\n    expect(img.attr('src')).toContain('test.png')\n    expect(img.attr('srcset')).toContain('test.png')\n  })","file":"unit/image-rendering.test.ts","skipped":false,"dir":"test"},{"name":"should only render noscript element when lazy loading","suites":["Image rendering"],"updatePoint":{"line":24,"column":59},"line":24,"code":"  it('should only render noscript element when lazy loading', async () => {\n    const element = React.createElement(Image, {\n      src: '/test.png',\n      width: 100,\n      height: 100,\n      loading: 'eager',\n    })\n    const element2 = React.createElement(Image, {\n      src: '/test.png',\n      width: 100,\n      height: 100,\n      priority: true,\n    })\n    const elementLazy = React.createElement(Image, {\n      src: '/test.png',\n      width: 100,\n      height: 100,\n    })\n    const $ = cheerio.load(ReactDOM.renderToString(element))\n    const $2 = cheerio.load(ReactDOM.renderToString(element2))\n    const $lazy = cheerio.load(ReactDOM.renderToString(elementLazy))\n    expect($('noscript').length).toBe(0)\n    expect($2('noscript').length).toBe(0)\n    expect($lazy('noscript').length).toBe(1)\n  })","file":"unit/image-rendering.test.ts","skipped":false,"dir":"test"},{"name":"should render noscript element when placeholder=blur","suites":["Image rendering"],"updatePoint":{"line":50,"column":58},"line":50,"code":"  it('should render noscript element when placeholder=blur', async () => {\n    const element1 = React.createElement(Image, {\n      src: '/test.png',\n      width: 100,\n      height: 100,\n      loading: 'eager',\n      placeholder: 'blur',\n      blurDataURL: 'data:image/png;base64',\n    })\n    const element2 = React.createElement(Image, {\n      src: '/test.png',\n      width: 100,\n      height: 100,\n      placeholder: 'blur',\n      blurDataURL: 'data:image/png;base64',\n      loading: 'eager',\n    })\n    const element3 = React.createElement(Image, {\n      src: '/test.png',\n      width: 100,\n      height: 100,\n      placeholder: 'blur',\n      blurDataURL: 'data:image/png;base64',\n      priority: true,\n    })\n    const $1 = cheerio.load(ReactDOM.renderToString(element1))\n    const $2 = cheerio.load(ReactDOM.renderToString(element2))\n    const $3 = cheerio.load(ReactDOM.renderToString(element3))\n    expect($1('noscript').length).toBe(1)\n    expect($2('noscript').length).toBe(1)\n    expect($3('noscript').length).toBe(1)\n  })","file":"unit/image-rendering.test.ts","skipped":false,"dir":"test"},{"name":"should render the correct sizes passed when a noscript element is rendered","suites":["Image rendering"],"updatePoint":{"line":83,"column":80},"line":83,"code":"  it('should render the correct sizes passed when a noscript element is rendered', async () => {\n    const element = React.createElement(Image, {\n      src: '/test.png',\n      width: 100,\n      height: 100,\n      sizes: '50vw',\n    })\n    const $ = cheerio.load(ReactDOM.renderToString(element))\n    const noscriptImg = $('noscript img')\n    expect(noscriptImg.attr('sizes')).toBe('50vw')\n    expect(noscriptImg.attr('srcset')).toContain(\n      '/_next/image?url=%2Ftest.png&w=384&q=75 384w'\n    )\n  })","file":"unit/image-rendering.test.ts","skipped":false,"dir":"test"},{"name":"should equal itself","suites":["isEqualNode"],"updatePoint":{"line":14,"column":25},"line":14,"code":"  it('should equal itself', () => {\n    const el = createScriptElement()\n    expect(isEqualNode(el, el)).toBe(true)\n  })","file":"unit/is-equal-node.unit.test.ts","skipped":false,"dir":"test"},{"name":"should equal equivalent node that has no nonce","suites":["isEqualNode"],"updatePoint":{"line":19,"column":52},"line":19,"code":"  it('should equal equivalent node that has no nonce', () => {\n    const el1 = createScriptElement()\n    const el2 = createScriptElement()\n    expect(isEqualNode(el1, el2)).toBe(true)\n  })","file":"unit/is-equal-node.unit.test.ts","skipped":false,"dir":"test"},{"name":"should equal equivalent node that has same nonce property, even if the original node has no html nonce attribute value","suites":["isEqualNode"],"updatePoint":{"line":25,"column":124},"line":25,"code":"  it('should equal equivalent node that has same nonce property, even if the original node has no html nonce attribute value', () => {\n    const el1 = createScriptElement({ nonce: 'abc123' })\n    // Simulate Chrome/FF browser behavior of stripping off nonce value when adding element to the document\n    el1.setAttribute('nonce', '')\n    el1.nonce = 'abc123'\n    const el2 = createScriptElement({ nonce: 'abc123' })\n    expect(isEqualNode(el1, el2)).toBe(true)\n  })","file":"unit/is-equal-node.unit.test.ts","skipped":false,"dir":"test"},{"name":"should not equal node with different nonce value","suites":["isEqualNode"],"updatePoint":{"line":34,"column":54},"line":34,"code":"  it('should not equal node with different nonce value', () => {\n    const el1 = createScriptElement({ nonce: 'abc123' })\n    // Simulate Chrome/FF browser behavior of stripping off nonce value when adding element to the document\n    el1.setAttribute('nonce', '')\n    el1.nonce = 'abc123'\n    const el2 = createScriptElement({ nonce: 'xyz' })\n    expect(isEqualNode(el1, el2)).toBe(false)\n  })","file":"unit/is-equal-node.unit.test.ts","skipped":false,"dir":"test"},{"name":"should not equal node with different html attribute value","suites":["isEqualNode"],"updatePoint":{"line":43,"column":63},"line":43,"code":"  it('should not equal node with different html attribute value', () => {\n    const el1 = createScriptElement({ src: '1.js' })\n    const el2 = createScriptElement({ src: '2.js' })\n    expect(isEqualNode(el1, el2)).toBe(false)\n  })","file":"unit/is-equal-node.unit.test.ts","skipped":false,"dir":"test"},{"name":"handles null and undefined props","suites":["isSerializableProps"],"updatePoint":{"line":5,"column":38},"line":5,"code":"  it('handles null and undefined props', () => {\n    expect(() => isSerializableProps('/', 'test', null))\n      .toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing props returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: Props must be returned as a plain object from test: \\`{ props: { ... } }\\` (received: \\`[object Null]\\`).\"\n    `)\n\n    expect(() => isSerializableProps('/', 'test', undefined))\n      .toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing props returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: Props must be returned as a plain object from test: \\`{ props: { ... } }\\` (received: \\`[object Undefined]\\`).\"\n    `)\n  })","file":"unit/is-serializable-props.test.ts","skipped":false,"dir":"test"},{"name":"handles non-plain object props","suites":["isSerializableProps"],"updatePoint":{"line":19,"column":36},"line":19,"code":"  it('handles non-plain object props', () => {\n    expect(() => isSerializableProps('/', 'test', []))\n      .toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing props returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: Props must be returned as a plain object from test: \\`{ props: { ... } }\\` (received: \\`[object Array]\\`).\"\n    `)\n\n    expect(() => isSerializableProps('/', 'test', class Foobar {}))\n      .toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing props returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: Props must be returned as a plain object from test: \\`{ props: { ... } }\\` (received: \\`[object Function]\\`).\"\n    `)\n\n    expect(() => isSerializableProps('/', 'test', function Foobar() {}))\n      .toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing props returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: Props must be returned as a plain object from test: \\`{ props: { ... } }\\` (received: \\`[object Function]\\`).\"\n    `)\n  })","file":"unit/is-serializable-props.test.ts","skipped":false,"dir":"test"},{"name":"allows empty props","suites":["isSerializableProps"],"updatePoint":{"line":39,"column":24},"line":39,"code":"  it('allows empty props', () => {\n    expect(isSerializableProps('/', 'test', {})).toBe(true)\n  })","file":"unit/is-serializable-props.test.ts","skipped":false,"dir":"test"},{"name":"allows all different types of props","suites":["isSerializableProps"],"updatePoint":{"line":43,"column":41},"line":43,"code":"  it('allows all different types of props', () => {\n    expect(\n      isSerializableProps('/', 'test', {\n        str: 'foobar',\n        bool: true,\n        bool2: false,\n        num: 0,\n        numn1: -1,\n        num5: 5,\n        noop: null,\n        arr: [\n          'f',\n          true,\n          false,\n          -5,\n          -1,\n          0,\n          1,\n          5,\n          null,\n          {},\n          {\n            str: 'foobar',\n            bool: true,\n            bool2: false,\n            num: 0,\n            numn1: -1,\n            num5: 5,\n            noop: null,\n          },\n        ],\n        obj1: {\n          str: 'foobar',\n          bool: true,\n          bool2: false,\n          num: 0,\n          numn1: -1,\n          num5: 5,\n          noop: null,\n          arr: [\n            'f',\n            true,\n            false,\n            -5,\n            -1,\n            0,\n            1,\n            5,\n            null,\n            {},\n            {\n              str: 'foobar',\n              bool: true,\n              bool2: false,\n              num: 0,\n              numn1: -1,\n              num5: 5,\n              noop: null,\n            },\n          ],\n        },\n      })\n    ).toBe(true)\n  })","file":"unit/is-serializable-props.test.ts","skipped":false,"dir":"test"},{"name":"disallows top-level non-serializable types","suites":["isSerializableProps"],"updatePoint":{"line":108,"column":48},"line":108,"code":"  it('disallows top-level non-serializable types', () => {\n    expect(() => isSerializableProps('/', 'test', { toplevel: new Date() }))\n      .toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing \\`.toplevel\\` returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: \\`object\\` (\\\\\"[object Date]\\\\\") cannot be serialized as JSON. Please only return JSON serializable data types.\"\n    `)\n\n    expect(() => isSerializableProps('/', 'test', { toplevel: class A {} }))\n      .toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing \\`.toplevel\\` returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: \\`function\\` cannot be serialized as JSON. Please only return JSON serializable data types.\"\n    `)\n\n    expect(() => isSerializableProps('/', 'test', { toplevel: undefined }))\n      .toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing \\`.toplevel\\` returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: \\`undefined\\` cannot be serialized as JSON. Please use \\`null\\` or omit this value.\"\n    `)\n\n    expect(() =>\n      isSerializableProps('/', 'test', { toplevel: Symbol('FOOBAR') })\n    ).toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing \\`.toplevel\\` returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: \\`symbol\\` cannot be serialized as JSON. Please only return JSON serializable data types.\"\n    `)\n\n    expect(() => isSerializableProps('/', 'test', { toplevel: function () {} }))\n      .toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing \\`.toplevel\\` returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: \\`function\\` cannot be serialized as JSON. Please only return JSON serializable data types.\"\n    `)\n  })","file":"unit/is-serializable-props.test.ts","skipped":false,"dir":"test"},{"name":"diallows nested non-serializable types","suites":["isSerializableProps"],"updatePoint":{"line":141,"column":44},"line":141,"code":"  it('diallows nested non-serializable types', () => {\n    expect(() =>\n      isSerializableProps('/', 'test', { k: { a: [1, { n: new Date() }] } })\n    ).toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing \\`.k.a[1].n\\` returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: \\`object\\` (\\\\\"[object Date]\\\\\") cannot be serialized as JSON. Please only return JSON serializable data types.\"\n    `)\n\n    expect(() =>\n      isSerializableProps('/', 'test', { k: { a: [1, { n: class A {} }] } })\n    ).toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing \\`.k.a[1].n\\` returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: \\`function\\` cannot be serialized as JSON. Please only return JSON serializable data types.\"\n    `)\n\n    expect(() => isSerializableProps('/', 'test', { k: { a: [1, undefined] } }))\n      .toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing \\`.k.a[1]\\` returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: \\`undefined\\` cannot be serialized as JSON. Please use \\`null\\` or omit this value.\"\n    `)\n\n    expect(() =>\n      isSerializableProps('/', 'test', { k: { n: Symbol('FOOBAR') } })\n    ).toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing \\`.k.n\\` returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: \\`symbol\\` cannot be serialized as JSON. Please only return JSON serializable data types.\"\n    `)\n\n    expect(() =>\n      isSerializableProps('/', 'test', { k: { a: [function () {}] } })\n    ).toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing \\`.k.a[0]\\` returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: \\`function\\` cannot be serialized as JSON. Please only return JSON serializable data types.\"\n    `)\n  })","file":"unit/is-serializable-props.test.ts","skipped":false,"dir":"test"},{"name":"can handle obj circular refs","suites":["isSerializableProps"],"updatePoint":{"line":177,"column":34},"line":177,"code":"  it('can handle obj circular refs', () => {\n    const obj: any = { foo: 'bar', test: true }\n    obj.child = obj\n\n    expect(() => isSerializableProps('/', 'test', obj))\n      .toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing \\`.child\\` returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: Circular references cannot be expressed in JSON (references: \\`(self)\\`).\"\n    `)\n\n    expect(() => isSerializableProps('/', 'test', { k: [obj] }))\n      .toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing \\`.k[0].child\\` returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: Circular references cannot be expressed in JSON (references: \\`.k[0]\\`).\"\n    `)\n  })","file":"unit/is-serializable-props.test.ts","skipped":false,"dir":"test"},{"name":"can handle arr circular refs","suites":["isSerializableProps"],"updatePoint":{"line":194,"column":34},"line":194,"code":"  it('can handle arr circular refs', () => {\n    const arr: any = [{ foo: 'bar' }, true]\n    arr.push(arr)\n\n    expect(() => isSerializableProps('/', 'test', { arr }))\n      .toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing \\`.arr[2]\\` returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: Circular references cannot be expressed in JSON (references: \\`.arr\\`).\"\n    `)\n\n    expect(() => isSerializableProps('/', 'test', { k: [{ arr }] }))\n      .toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing \\`.k[0].arr[2]\\` returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: Circular references cannot be expressed in JSON (references: \\`.k[0].arr\\`).\"\n    `)\n  })","file":"unit/is-serializable-props.test.ts","skipped":false,"dir":"test"},{"name":"can handle deep obj circular refs","suites":["isSerializableProps"],"updatePoint":{"line":211,"column":39},"line":211,"code":"  it('can handle deep obj circular refs', () => {\n    const obj: any = { foo: 'bar', test: true, leve1: { level2: {} } }\n    obj.leve1.level2.child = obj\n\n    expect(() => isSerializableProps('/', 'test', obj))\n      .toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing \\`.leve1.level2.child\\` returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: Circular references cannot be expressed in JSON (references: \\`(self)\\`).\"\n    `)\n  })","file":"unit/is-serializable-props.test.ts","skipped":false,"dir":"test"},{"name":"can handle deep obj circular refs (with arrays)","suites":["isSerializableProps"],"updatePoint":{"line":222,"column":53},"line":222,"code":"  it('can handle deep obj circular refs (with arrays)', () => {\n    const obj: any = { foo: 'bar', test: true, leve1: { level2: {} } }\n    obj.leve1.level2.child = [{ another: [obj] }]\n\n    expect(() => isSerializableProps('/', 'test', obj))\n      .toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing \\`.leve1.level2.child[0].another[0]\\` returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: Circular references cannot be expressed in JSON (references: \\`(self)\\`).\"\n    `)\n  })","file":"unit/is-serializable-props.test.ts","skipped":false,"dir":"test"},{"name":"can handle deep arr circular refs","suites":["isSerializableProps"],"updatePoint":{"line":233,"column":39},"line":233,"code":"  it('can handle deep arr circular refs', () => {\n    const arr = [1, 2, []]\n    arr[3] = [false, [null, 0, arr]]\n\n    expect(() => isSerializableProps('/', 'test', { k: arr }))\n      .toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing \\`.k[3][1][2]\\` returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: Circular references cannot be expressed in JSON (references: \\`.k\\`).\"\n    `)\n  })","file":"unit/is-serializable-props.test.ts","skipped":false,"dir":"test"},{"name":"can handle deep arr circular refs (with objects)","suites":["isSerializableProps"],"updatePoint":{"line":244,"column":54},"line":244,"code":"  it('can handle deep arr circular refs (with objects)', () => {\n    const arr = [1, 2, []]\n    arr[3] = [false, { nested: [null, 0, arr] }]\n\n    expect(() => isSerializableProps('/', 'test', { k: arr }))\n      .toThrowErrorMatchingInlineSnapshot(`\n      \"Error serializing \\`.k[3][1].nested[2]\\` returned from \\`test\\` in \\\\\"/\\\\\".\n      Reason: Circular references cannot be expressed in JSON (references: \\`.k\\`).\"\n    `)\n  })","file":"unit/is-serializable-props.test.ts","skipped":false,"dir":"test"},{"name":"allows multi object refs","suites":["isSerializableProps"],"updatePoint":{"line":255,"column":30},"line":255,"code":"  it('allows multi object refs', () => {\n    const obj = { foo: 'bar', test: true }\n    expect(\n      isSerializableProps('/', 'test', {\n        obj1: obj,\n        obj2: obj,\n      })\n    ).toBe(true)\n  })","file":"unit/is-serializable-props.test.ts","skipped":false,"dir":"test"},{"name":"allows multi object refs nested","suites":["isSerializableProps"],"updatePoint":{"line":265,"column":37},"line":265,"code":"  it('allows multi object refs nested', () => {\n    const obj = { foo: 'bar', test: true }\n    expect(\n      isSerializableProps('/', 'test', {\n        obj1: obj,\n        obj2: obj,\n        anArray: [obj],\n        aKey: { obj },\n      })\n    ).toBe(true)\n  })","file":"unit/is-serializable-props.test.ts","skipped":false,"dir":"test"},{"name":"allows multi array refs","suites":["isSerializableProps"],"updatePoint":{"line":277,"column":29},"line":277,"code":"  it('allows multi array refs', () => {\n    const arr = [{ foo: 'bar' }, true]\n    expect(\n      isSerializableProps('/', 'test', {\n        arr1: arr,\n        arr2: arr,\n      })\n    ).toBe(true)\n  })","file":"unit/is-serializable-props.test.ts","skipped":false,"dir":"test"},{"name":"allows multi array refs nested","suites":["isSerializableProps"],"updatePoint":{"line":287,"column":36},"line":287,"code":"  it('allows multi array refs nested', () => {\n    const arr = [{ foo: 'bar' }, true]\n    expect(\n      isSerializableProps('/', 'test', {\n        arr1: arr,\n        arr2: arr,\n        arr3: [arr],\n        arr4: [1, [2, 3, arr]],\n      })\n    ).toBe(true)\n  })","file":"unit/is-serializable-props.test.ts","skipped":false,"dir":"test"},{"name":"allows identical object instances in an array","suites":["isSerializableProps"],"updatePoint":{"line":299,"column":51},"line":299,"code":"  it('allows identical object instances in an array', () => {\n    const obj = { foo: 'bar' }\n    const arr = [obj, obj]\n    const objWithArr = { deep: { arr } }\n\n    expect(isSerializableProps('/', 'test', { arr })).toBe(true)\n    expect(isSerializableProps('/', 'test', { objWithArr })).toBe(true)\n  })","file":"unit/is-serializable-props.test.ts","skipped":false,"dir":"test"},{"name":"allows identical object instances in an array deeply","suites":["isSerializableProps"],"updatePoint":{"line":308,"column":58},"line":308,"code":"  it('allows identical object instances in an array deeply', () => {\n    const obj = { foo: 'bar' }\n    const arr = [obj, [obj]]\n    const objWithArr = { deep: { arr } }\n\n    expect(isSerializableProps('/', 'test', { arr })).toBe(true)\n    expect(isSerializableProps('/', 'test', { objWithArr })).toBe(true)\n  })","file":"unit/is-serializable-props.test.ts","skipped":false,"dir":"test"},{"name":"Should get the configuration","suites":["config"],"updatePoint":{"line":14,"column":34},"line":14,"code":"  it('Should get the configuration', async () => {\n    const config = await loadConfig(PHASE_DEVELOPMENT_SERVER, pathToConfig)\n    expect(config.customConfig).toBe(true)\n  })","file":"unit/isolated/config.test.ts","skipped":false,"dir":"test"},{"name":"Should pass the phase correctly","suites":["config"],"updatePoint":{"line":19,"column":37},"line":19,"code":"  it('Should pass the phase correctly', async () => {\n    const config = await loadConfig(PHASE_DEVELOPMENT_SERVER, pathToConfigFn)\n    expect(config.phase).toBe(PHASE_DEVELOPMENT_SERVER)\n  })","file":"unit/isolated/config.test.ts","skipped":false,"dir":"test"},{"name":"Should pass the defaultConfig correctly","suites":["config"],"updatePoint":{"line":24,"column":45},"line":24,"code":"  it('Should pass the defaultConfig correctly', async () => {\n    const config = await loadConfig(PHASE_DEVELOPMENT_SERVER, pathToConfigFn)\n    expect(config.defaultConfig).toBeDefined()\n  })","file":"unit/isolated/config.test.ts","skipped":false,"dir":"test"},{"name":"Should assign object defaults deeply to user config","suites":["config"],"updatePoint":{"line":29,"column":57},"line":29,"code":"  it('Should assign object defaults deeply to user config', async () => {\n    const config = await loadConfig(PHASE_DEVELOPMENT_SERVER, pathToConfigFn)\n    expect(config.distDir).toEqual('.next')\n    expect(config.onDemandEntries.maxInactiveAge).toBeDefined()\n  })","file":"unit/isolated/config.test.ts","skipped":false,"dir":"test"},{"name":"Should pass the customConfig correctly","suites":["config"],"updatePoint":{"line":35,"column":44},"line":35,"code":"  it('Should pass the customConfig correctly', async () => {\n    const config = await loadConfig(PHASE_DEVELOPMENT_SERVER, null, {\n      customConfig: true,\n    })\n    expect(config.customConfig).toBe(true)\n  })","file":"unit/isolated/config.test.ts","skipped":false,"dir":"test"},{"name":"Should not pass the customConfig when it is null","suites":["config"],"updatePoint":{"line":42,"column":54},"line":42,"code":"  it('Should not pass the customConfig when it is null', async () => {\n    const config = await loadConfig(PHASE_DEVELOPMENT_SERVER, null, null)\n    expect(config.webpack).toBe(null)\n  })","file":"unit/isolated/config.test.ts","skipped":false,"dir":"test"},{"name":"Should assign object defaults deeply to customConfig","suites":["config"],"updatePoint":{"line":47,"column":58},"line":47,"code":"  it('Should assign object defaults deeply to customConfig', async () => {\n    const config = await loadConfig(PHASE_DEVELOPMENT_SERVER, null, {\n      customConfig: true,\n      onDemandEntries: { custom: true },\n    })\n    expect(config.customConfig).toBe(true)\n    expect(config.onDemandEntries.maxInactiveAge).toBeDefined()\n  })","file":"unit/isolated/config.test.ts","skipped":false,"dir":"test"},{"name":"Should allow setting objects which do not have defaults","suites":["config"],"updatePoint":{"line":56,"column":61},"line":56,"code":"  it('Should allow setting objects which do not have defaults', async () => {\n    const config = await loadConfig(PHASE_DEVELOPMENT_SERVER, null, {\n      bogusSetting: { custom: true },\n    })\n    expect(config.bogusSetting).toBeDefined()\n    expect(config.bogusSetting.custom).toBe(true)\n  })","file":"unit/isolated/config.test.ts","skipped":false,"dir":"test"},{"name":"Should override defaults for arrays from user arrays","suites":["config"],"updatePoint":{"line":64,"column":58},"line":64,"code":"  it('Should override defaults for arrays from user arrays', async () => {\n    const config = await loadConfig(PHASE_DEVELOPMENT_SERVER, null, {\n      pageExtensions: ['.bogus'],\n    })\n    expect(config.pageExtensions).toEqual(['.bogus'])\n  })","file":"unit/isolated/config.test.ts","skipped":false,"dir":"test"},{"name":"Should throw when an invalid target is provided","suites":["config"],"updatePoint":{"line":71,"column":53},"line":71,"code":"  it('Should throw when an invalid target is provided', async () => {\n    await expect(async () => {\n      await loadConfig(\n        PHASE_DEVELOPMENT_SERVER,\n        join(__dirname, '_resolvedata', 'invalid-target')\n      )\n    }).rejects.toThrow(/Specified target is invalid/)\n  })","file":"unit/isolated/config.test.ts","skipped":false,"dir":"test"},{"name":"Should pass when a valid target is provided","suites":["config"],"updatePoint":{"line":80,"column":49},"line":80,"code":"  it('Should pass when a valid target is provided', async () => {\n    const config = await loadConfig(\n      PHASE_DEVELOPMENT_SERVER,\n      join(__dirname, '_resolvedata', 'valid-target')\n    )\n    expect(config.target).toBe('serverless')\n  })","file":"unit/isolated/config.test.ts","skipped":false,"dir":"test"},{"name":"Should throw an error when next.config.js is not present","suites":["config"],"updatePoint":{"line":88,"column":62},"line":88,"code":"  it('Should throw an error when next.config.js is not present', async () => {\n    await expect(\n      async () =>\n        await loadConfig(\n          PHASE_DEVELOPMENT_SERVER,\n          join(__dirname, '_resolvedata', 'typescript-config')\n        )\n    ).rejects.toThrow(\n      /Configuring Next.js via .+ is not supported. Please replace the file with 'next.config.js'/\n    )\n  })","file":"unit/isolated/config.test.ts","skipped":false,"dir":"test"},{"name":"Should not throw an error when two versions of next.config.js are present","suites":["config"],"updatePoint":{"line":100,"column":79},"line":100,"code":"  it('Should not throw an error when two versions of next.config.js are present', async () => {\n    const config = await loadConfig(\n      PHASE_DEVELOPMENT_SERVER,\n      join(__dirname, '_resolvedata', 'js-ts-config')\n    )\n    expect(config.__test__ext).toBe('js')\n  })","file":"unit/isolated/config.test.ts","skipped":false,"dir":"test"},{"name":"Should ignore configs set to `undefined`","suites":["config"],"updatePoint":{"line":108,"column":46},"line":108,"code":"  it('Should ignore configs set to `undefined`', async () => {\n    const config = await loadConfig(PHASE_DEVELOPMENT_SERVER, null, {\n      target: undefined,\n    })\n    expect(config.target).toBe('server')\n  })","file":"unit/isolated/config.test.ts","skipped":false,"dir":"test"},{"name":"Should ignore configs set to `null`","suites":["config"],"updatePoint":{"line":115,"column":41},"line":115,"code":"  it('Should ignore configs set to `null`', async () => {\n    const config = await loadConfig(PHASE_DEVELOPMENT_SERVER, null, {\n      target: null,\n    })\n    expect(config.target).toBe('server')\n  })","file":"unit/isolated/config.test.ts","skipped":false,"dir":"test"},{"name":"Should throw error with ENOENT code","suites":["pageNotFoundError"],"updatePoint":{"line":20,"column":41},"line":20,"code":"  it('Should throw error with ENOENT code', () => {\n    expect.assertions(1)\n    try {\n      throw new PageNotFoundError('test')\n    } catch (err) {\n      // eslint-disable-next-line jest/no-try-expect\n      expect(err.code).toBe('ENOENT')\n    }\n  })","file":"unit/isolated/require-page.test.ts","skipped":false,"dir":"test"},{"name":"Should turn / into /index","suites":["normalizePagePath"],"updatePoint":{"line":32,"column":31},"line":32,"code":"  it('Should turn / into /index', () => {\n    expect(normalizePagePath('/')).toBe(`${sep}index`)\n  })","file":"unit/isolated/require-page.test.ts","skipped":false,"dir":"test"},{"name":"Should turn _error into /_error","suites":["normalizePagePath"],"updatePoint":{"line":36,"column":37},"line":36,"code":"  it('Should turn _error into /_error', () => {\n    expect(normalizePagePath('_error')).toBe(`${sep}_error`)\n  })","file":"unit/isolated/require-page.test.ts","skipped":false,"dir":"test"},{"name":"Should turn /abc into /abc","suites":["normalizePagePath"],"updatePoint":{"line":40,"column":32},"line":40,"code":"  it('Should turn /abc into /abc', () => {\n    expect(normalizePagePath('/abc')).toBe(`${sep}abc`)\n  })","file":"unit/isolated/require-page.test.ts","skipped":false,"dir":"test"},{"name":"Should turn /abc/def into /abc/def","suites":["normalizePagePath"],"updatePoint":{"line":44,"column":40},"line":44,"code":"  it('Should turn /abc/def into /abc/def', () => {\n    expect(normalizePagePath('/abc/def')).toBe(`${sep}abc${sep}def`)\n  })","file":"unit/isolated/require-page.test.ts","skipped":false,"dir":"test"},{"name":"Should throw on /../../test.js","suites":["normalizePagePath"],"updatePoint":{"line":48,"column":36},"line":48,"code":"  it('Should throw on /../../test.js', () => {\n    expect(() => normalizePagePath('/../../test.js')).toThrow()\n  })","file":"unit/isolated/require-page.test.ts","skipped":false,"dir":"test"},{"name":"Should not append /index to the / page","suites":["getPagePath"],"updatePoint":{"line":54,"column":44},"line":54,"code":"  it('Should not append /index to the / page', () => {\n    expect(() => getPagePath('/', distDir, false)).toThrow(\n      'Cannot find module for page: /'\n    )\n  })","file":"unit/isolated/require-page.test.ts","skipped":false,"dir":"test"},{"name":"Should prepend / when a page does not have it","suites":["getPagePath"],"updatePoint":{"line":60,"column":51},"line":60,"code":"  it('Should prepend / when a page does not have it', () => {\n    const pagePath = getPagePath('_error', distDir, false)\n    expect(pagePath).toBe(join(pathToBundles, `${sep}_error.js`))\n  })","file":"unit/isolated/require-page.test.ts","skipped":false,"dir":"test"},{"name":"Should throw with paths containing ../","suites":["getPagePath"],"updatePoint":{"line":65,"column":44},"line":65,"code":"  it('Should throw with paths containing ../', () => {\n    expect(() => getPagePath('/../../package.json', distDir, false)).toThrow()\n  })","file":"unit/isolated/require-page.test.ts","skipped":false,"dir":"test"},{"name":"Should not find page /index when using /","suites":["requirePage"],"updatePoint":{"line":71,"column":46},"line":71,"code":"  it('Should not find page /index when using /', async () => {\n    await expect(() => requirePage('/', distDir, false)).toThrow(\n      'Cannot find module for page: /'\n    )\n  })","file":"unit/isolated/require-page.test.ts","skipped":false,"dir":"test"},{"name":"Should require /index.js when using /index","suites":["requirePage"],"updatePoint":{"line":77,"column":48},"line":77,"code":"  it('Should require /index.js when using /index', async () => {\n    const page = await requirePage('/index', distDir, false)\n    expect(page.test).toBe('hello')\n  })","file":"unit/isolated/require-page.test.ts","skipped":false,"dir":"test"},{"name":"Should require /world.js when using /world","suites":["requirePage"],"updatePoint":{"line":82,"column":48},"line":82,"code":"  it('Should require /world.js when using /world', async () => {\n    const page = await requirePage('/world', distDir, false)\n    expect(page.test).toBe('world')\n  })","file":"unit/isolated/require-page.test.ts","skipped":false,"dir":"test"},{"name":"Should throw when using /../../test.js","suites":["requirePage"],"updatePoint":{"line":87,"column":44},"line":87,"code":"  it('Should throw when using /../../test.js', async () => {\n    expect.assertions(1)\n    try {\n      await requirePage('/../../test', distDir, false)\n    } catch (err) {\n      // eslint-disable-next-line jest/no-try-expect\n      expect(err.code).toBe('ENOENT')\n    }\n  })","file":"unit/isolated/require-page.test.ts","skipped":false,"dir":"test"},{"name":"Should throw when using non existent pages like /non-existent.js","suites":["requirePage"],"updatePoint":{"line":97,"column":70},"line":97,"code":"  it('Should throw when using non existent pages like /non-existent.js', async () => {\n    expect.assertions(1)\n    try {\n      await requirePage('/non-existent', distDir, false)\n    } catch (err) {\n      // eslint-disable-next-line jest/no-try-expect\n      expect(err.code).toBe('ENOENT')\n    }\n  })","file":"unit/isolated/require-page.test.ts","skipped":false,"dir":"test"},{"name":"Should bubble up errors in the child component","suites":["requirePage"],"updatePoint":{"line":107,"column":52},"line":107,"code":"  it('Should bubble up errors in the child component', async () => {\n    expect.assertions(1)\n    try {\n      await requirePage('/non-existent-child', distDir, false)\n    } catch (err) {\n      // eslint-disable-next-line jest/no-try-expect\n      expect(err.code).toBe('MODULE_NOT_FOUND')\n    }\n  })","file":"unit/isolated/require-page.test.ts","skipped":false,"dir":"test"},{"name":"should have correct env","suites":["jest next-swc preset"],"updatePoint":{"line":3,"column":29},"line":3,"code":"  it('should have correct env', async () => {\n    expect(process.env.NODE_ENV).toBe('test')\n  })","file":"unit/jest-next-swc.test.ts","skipped":false,"dir":"test"},{"name":"should render Link on its own","suites":["Link rendering"],"updatePoint":{"line":7,"column":35},"line":7,"code":"  it('should render Link on its own', async () => {\n    const element = React.createElement(\n      Link,\n      {\n        href: '/my-path',\n      },\n      React.createElement('a', {}, 'to another page')\n    )\n    const html = ReactDOM.renderToString(element)\n    expect(html).toMatchInlineSnapshot(\n      `\"<a href=\\\\\"/my-path\\\\\">to another page</a>\"`\n    )\n  })","file":"unit/link-rendering.test.ts","skipped":false,"dir":"test"},{"name":"should throw if getInitialProps is defined as an instance method","suites":["loadGetInitialProps"],"updatePoint":{"line":5,"column":70},"line":5,"code":"  it('should throw if getInitialProps is defined as an instance method', () => {\n    class TestComponent {\n      getInitialProps() {}\n    }\n    const rejectPromise = loadGetInitialProps(TestComponent as any, {})\n    const error = new Error(\n      '\"TestComponent.getInitialProps()\" is defined as an instance method - visit https://nextjs.org/docs/messages/get-initial-props-as-an-instance-method for more information.'\n    )\n    return expect(rejectPromise).rejects.toEqual(error)\n  })","file":"unit/loadGetInitialProps.test.ts","skipped":false,"dir":"test"},{"name":"should resolve to an empty object if getInitialProps is missing","suites":["loadGetInitialProps"],"updatePoint":{"line":16,"column":69},"line":16,"code":"  it('should resolve to an empty object if getInitialProps is missing', async () => {\n    const result = await loadGetInitialProps((() => {}) as any, {})\n    expect(result).toEqual({})\n  })","file":"unit/loadGetInitialProps.test.ts","skipped":false,"dir":"test"},{"name":"should resolve getInitialProps","suites":["loadGetInitialProps"],"updatePoint":{"line":21,"column":36},"line":21,"code":"  it('should resolve getInitialProps', async () => {\n    class TestComponent {\n      static async getInitialProps() {\n        return { foo: 1 }\n      }\n    }\n    const result = await loadGetInitialProps(TestComponent as any, {})\n    expect(result).toEqual({ foo: 1 })\n  })","file":"unit/loadGetInitialProps.test.ts","skipped":false,"dir":"test"},{"name":"should be able to return an invalid value if the request was already sent","suites":["loadGetInitialProps"],"updatePoint":{"line":31,"column":79},"line":31,"code":"  it('should be able to return an invalid value if the request was already sent', async () => {\n    class TestComponent {\n      static async getInitialProps() {\n        return 'invalidValue'\n      }\n    }\n    const ctx: any = {\n      res: {\n        finished: true,\n      },\n    }\n    const result = await loadGetInitialProps(TestComponent as any, ctx)\n    expect(result).toBe('invalidValue')\n  })","file":"unit/loadGetInitialProps.test.ts","skipped":false,"dir":"test"},{"name":"should throw if getInitialProps won't return an object ","suites":["loadGetInitialProps"],"updatePoint":{"line":46,"column":61},"line":46,"code":"  it(\"should throw if getInitialProps won't return an object \", () => {\n    class TestComponent {\n      static async getInitialProps() {}\n    }\n    const rejectPromise = loadGetInitialProps(TestComponent as any, {})\n    const error = new Error(\n      '\"TestComponent.getInitialProps()\" should resolve to an object. But found \"undefined\" instead.'\n    )\n    return expect(rejectPromise).rejects.toEqual(error)\n  })","file":"unit/loadGetInitialProps.test.ts","skipped":false,"dir":"test"},{"name":"should listen to a event","suites":["mitt","With listeners"],"updatePoint":{"line":6,"column":32},"line":6,"code":"    it('should listen to a event', () => {\n      return new Promise((resolve) => {\n        const ev = mitt()\n        ev.on('sample', resolve)\n        ev.emit('sample')\n      })\n    })","file":"unit/mitt.test.ts","skipped":false,"dir":"test"},{"name":"should listen to multiple listeners","suites":["mitt","With listeners"],"updatePoint":{"line":14,"column":43},"line":14,"code":"    it('should listen to multiple listeners', () => {\n      const ev = mitt()\n      let cnt = 0\n\n      ev.on('sample', () => {\n        cnt += 1\n      })\n      ev.on('sample', () => {\n        cnt += 1\n      })\n\n      ev.emit('sample')\n\n      expect(cnt).toBe(2)\n    })","file":"unit/mitt.test.ts","skipped":false,"dir":"test"},{"name":"should listen to multiple events","suites":["mitt","With listeners"],"updatePoint":{"line":30,"column":40},"line":30,"code":"    it('should listen to multiple events', () => {\n      const ev = mitt()\n      const data = []\n      const cb = (name) => {\n        data.push(name)\n      }\n\n      ev.on('sample1', cb)\n      ev.on('sample2', cb)\n\n      ev.emit('sample1', 'one')\n      ev.emit('sample2', 'two')\n\n      expect(data).toEqual(['one', 'two'])\n    })","file":"unit/mitt.test.ts","skipped":false,"dir":"test"},{"name":"should support multiple arguments","suites":["mitt","With listeners"],"updatePoint":{"line":46,"column":41},"line":46,"code":"    it('should support multiple arguments', () => {\n      const ev = mitt()\n      let data\n\n      ev.on('sample', (...args) => {\n        data = args\n      })\n      ev.emit('sample', 'one', 'two')\n\n      expect(data).toEqual(['one', 'two'])\n    })","file":"unit/mitt.test.ts","skipped":false,"dir":"test"},{"name":"should possible to stop listening an event","suites":["mitt","With listeners"],"updatePoint":{"line":58,"column":50},"line":58,"code":"    it('should possible to stop listening an event', () => {\n      const ev = mitt()\n      let cnt = 0\n      const cb = () => {\n        cnt += 1\n      }\n\n      ev.on('sample', cb)\n\n      ev.emit('sample')\n      expect(cnt).toBe(1)\n\n      ev.off('sample', cb)\n\n      ev.emit('sample')\n      expect(cnt).toBe(1)\n    })","file":"unit/mitt.test.ts","skipped":false,"dir":"test"},{"name":"should not fail to emit","suites":["mitt","Without a listener"],"updatePoint":{"line":78,"column":31},"line":78,"code":"    it('should not fail to emit', () => {\n      const ev = mitt()\n      ev.emit('aaaa', 10, 20)\n    })","file":"unit/mitt.test.ts","skipped":false,"dir":"test"},{"name":"should replace NODE_ENV on client (dev)","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":58,"column":47},"line":58,"code":"    it('should replace NODE_ENV on client (dev)', async () => {\n      const code = await babel(`process.env.NODE_ENV`, {\n        isServer: false,\n      })\n      expect(code).toMatchInlineSnapshot(`\"\\\\\"development\\\\\";\"`)\n    })","file":"unit/next-babel-loader-dev.test.ts","skipped":false,"dir":"test"},{"name":"should replace NODE_ENV in statement (dev)","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":65,"column":50},"line":65,"code":"    it('should replace NODE_ENV in statement (dev)', async () => {\n      const code = await babel(`if (process.env.NODE_ENV === 'development') {}`)\n      expect(code).toMatchInlineSnapshot(`\"if (true) {}\"`)\n    })","file":"unit/next-babel-loader-dev.test.ts","skipped":false,"dir":"test"},{"name":"should support 9.4 regression","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":70,"column":37},"line":70,"code":"    it('should support 9.4 regression', async () => {\n      const pageFile = path.resolve(dir, 'pages', 'index.js')\n      const output = await babel(\n        `\n          import React from \"react\";\n          import queryGraphql from \"../graphql/schema\";\n\n          const gql = String.raw;\n\n          export default function Home({ greeting }) {\n            return <h1>{greeting}</h1>;\n          }\n\n          export async function getStaticProps() {\n            const greeting = await getGreeting();\n\n            return {\n              props: {\n                greeting,\n              },\n            };\n          }\n\n          async function getGreeting() {\n            const result = await queryGraphql(\n              gql\\`\n                {\n                  query {\n                    greeting\n                  }\n                }\n              \\`\n            );\n\n            return result.data.greeting;\n          }\n        `,\n        { resourcePath: pageFile, isServer: false }\n      )\n\n      expect(output).toContain(\n        `var __jsx = React.createElement;import React from \"react\";export var __N_SSG = true;export default function Home(_ref) {  var greeting = _ref.greeting;  return __jsx(\"h1\", {    __self: this,    __source: {      fileName: _jsxFileName,      lineNumber: 8,      columnNumber: 20    }  }, greeting);}_c = Home;var _c;$RefreshReg$(_c, \"Home\");`\n      )\n    })","file":"unit/next-babel-loader-dev.test.ts","skipped":false,"dir":"test"},{"name":"should replace typeof window expression nested","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":59,"column":54},"line":59,"code":"    it('should replace typeof window expression nested', async () => {\n      const code = await babel('function a(){console.log(typeof window)}')\n      expect(code).toMatchInlineSnapshot(\n        `\"function a() {  console.log(\\\\\"object\\\\\");}\"`\n      )\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should replace typeof window expression top level (client)","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":66,"column":66},"line":66,"code":"    it('should replace typeof window expression top level (client)', async () => {\n      const code = await babel('typeof window;')\n      expect(code).toMatchInlineSnapshot(`\"\\\\\"object\\\\\";\"`)\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should replace typeof window expression top level (server)","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":71,"column":66},"line":71,"code":"    it('should replace typeof window expression top level (server)', async () => {\n      const code = await babel('typeof window;', { isServer: true })\n      expect(code).toMatchInlineSnapshot(`\"\\\\\"undefined\\\\\";\"`)\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should replace typeof window in === expression nested","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":76,"column":61},"line":76,"code":"    it('should replace typeof window in === expression nested', async () => {\n      const code = await babel(\n        `function a(){console.log(typeof window === 'undefined')}`\n      )\n      expect(code).toMatchInlineSnapshot(\n        `\"function a() {  console.log(false);}\"`\n      )\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should replace typeof window expression top level","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":85,"column":57},"line":85,"code":"    it('should replace typeof window expression top level', async () => {\n      const code = await babel(`typeof window === 'undefined';`)\n      expect(code).toMatchInlineSnapshot(`\"false;\"`)\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should replace typeof window in === expression top level","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":90,"column":64},"line":90,"code":"    it('should replace typeof window in === expression top level', async () => {\n      const code = await babel(`typeof window === 'object';`)\n      expect(code).toMatchInlineSnapshot(`\"true;\"`)\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should replace typeof window in !== expression top level","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":95,"column":64},"line":95,"code":"    it('should replace typeof window in !== expression top level', async () => {\n      const code = await babel(`typeof window !== 'undefined';`)\n      expect(code).toMatchInlineSnapshot(`\"true;\"`)\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should replace typeof window expression !== object top level","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":100,"column":68},"line":100,"code":"    it('should replace typeof window expression !== object top level', async () => {\n      const code = await babel(`typeof window !== 'object';`)\n      expect(code).toMatchInlineSnapshot(`\"false;\"`)\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should replace typeof window expression top level serverside","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":105,"column":68},"line":105,"code":"    it('should replace typeof window expression top level serverside', async () => {\n      const code = await babel(`typeof window !== 'undefined';`, {\n        isServer: true,\n      })\n      expect(code).toMatchInlineSnapshot(`\"false;\"`)\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should replace typeof window expression !== object top level serverside","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":112,"column":79},"line":112,"code":"    it('should replace typeof window expression !== object top level serverside', async () => {\n      const code = await babel(`typeof window !== 'object';`, {\n        isServer: true,\n      })\n      expect(code).toMatchInlineSnapshot(`\"true;\"`)\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should replace process.browser (1)","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":119,"column":42},"line":119,"code":"    it('should replace process.browser (1)', async () => {\n      const code = await babel(`process.browser`, {\n        isServer: false,\n      })\n      expect(code).toMatchInlineSnapshot(`\"true;\"`)\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should replace process.browser (2)","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":126,"column":42},"line":126,"code":"    it('should replace process.browser (2)', async () => {\n      const code = await babel(`process.browser`, {\n        isServer: true,\n      })\n      expect(code).toMatchInlineSnapshot(`\"false;\"`)\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should replace process.browser (3)","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":133,"column":42},"line":133,"code":"    it('should replace process.browser (3)', async () => {\n      const code = await babel(`process.browser == false`, {\n        isServer: true,\n      })\n      expect(code).toMatchInlineSnapshot(`\"true;\"`)\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should replace process.browser (4)","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":140,"column":42},"line":140,"code":"    it('should replace process.browser (4)', async () => {\n      const code = await babel(`if (process.browser === false) {}`, {\n        isServer: true,\n      })\n      expect(code).toMatchInlineSnapshot(`\"if (true) {}\"`)\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should replace process.browser (5)","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":147,"column":42},"line":147,"code":"    it('should replace process.browser (5)', async () => {\n      const code = await babel(`if (process.browser) {}`, {\n        isServer: true,\n      })\n      expect(code).toMatchInlineSnapshot(`\"if (false) {}\"`)\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should replace NODE_ENV on client (prod)","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":154,"column":48},"line":154,"code":"    it('should replace NODE_ENV on client (prod)', async () => {\n      const code = await babel(`process.env.NODE_ENV`, {\n        isServer: false,\n      })\n      expect(code).toMatchInlineSnapshot(`\"\\\\\"production\\\\\";\"`)\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should replace NODE_ENV on server","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":161,"column":41},"line":161,"code":"    it('should replace NODE_ENV on server', async () => {\n      const code = await babel(`process.env.NODE_ENV`, {\n        isServer: true,\n      })\n      expect(code).toMatchInlineSnapshot(`\"\\\\\"production\\\\\";\"`)\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should replace NODE_ENV in === statement (prod)","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":168,"column":55},"line":168,"code":"    it('should replace NODE_ENV in === statement (prod)', async () => {\n      const code = await babel(`if (process.env.NODE_ENV === 'production') {}`)\n      expect(code).toMatchInlineSnapshot(`\"if (true) {}\"`)\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should replace NODE_ENV in !== statement (prod)","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":173,"column":55},"line":173,"code":"    it('should replace NODE_ENV in !== statement (prod)', async () => {\n      const code = await babel(`if (process.env.NODE_ENV !== 'production') {}`)\n      expect(code).toMatchInlineSnapshot(`\"if (false) {}\"`)\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should handle no pagesDir","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":178,"column":33},"line":178,"code":"    it('should handle no pagesDir', async () => {\n      const code = await babel(\n        `\n        import dynamic from 'next/dynamic'\n        \n        const Comp = dynamic(() => import('comp'))\n        \n        export default function Page(props) {\n          return <Comp />\n        }\n      `,\n        {\n          pagesDir: undefined,\n        }\n      )\n      expect(\n        code.replace(/modules: \\[\".*?\"/, 'modules:[\"/path/to/page\"')\n      ).toMatchInlineSnapshot(\n        `\"var _jsxFileName = \\\\\"index.js\\\\\";import React from \\\\\"react\\\\\";var __jsx = React.createElement;import dynamic from 'next/dynamic';const Comp = dynamic(() => import('comp'), {  loadableGenerated: {    webpack: () => [require.resolveWeak('comp')]  }});export default function Page(props) {  return __jsx(Comp, {    __self: this,    __source: {      fileName: _jsxFileName,      lineNumber: 7,      columnNumber: 18    }  });}\"`\n      )\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should not drop unused exports by default","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":200,"column":49},"line":200,"code":"    it('should not drop unused exports by default', async () => {\n      const code = await babel(\n        // effectful\n        `import\"core-js\";` +\n          // basic\n          `import{foo,bar}from\"a\";import baz from\"b\";` +\n          // complex\n          `import * as React from \"react\";` +\n          `import baz2,{yeet}from\"c\";` +\n          `import baz3,{cats}from\"d\";` +\n          `import{c,d}from\"e\";` +\n          `import{e as ee,f as ff}from\"f\";`\n      )\n      expect(code).toMatchInlineSnapshot(\n        `\"import \\\\\"core-js\\\\\";import { foo, bar } from \\\\\"a\\\\\";import baz from \\\\\"b\\\\\";import * as React from \\\\\"react\\\\\";import baz2, { yeet } from \\\\\"c\\\\\";import baz3, { cats } from \\\\\"d\\\\\";import { c, d } from \\\\\"e\\\\\";import { e as ee, f as ff } from \\\\\"f\\\\\";\"`\n      )\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should not drop unused exports by default in a page","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":220,"column":59},"line":220,"code":"    it('should not drop unused exports by default in a page', async () => {\n      const code = await babel(\n        // effectful\n        `import\"core-js\";` +\n          // basic\n          `import{foo,bar}from\"a\";import baz from\"b\";` +\n          // complex\n          `import*as React from\"react\";` +\n          `import baz2,{yeet}from\"c\";` +\n          `import baz3,{cats}from\"d\";` +\n          `import{c,d}from\"e\";` +\n          `import{e as ee,f as ff}from\"f\";`,\n        { resourcePath: pageFile }\n      )\n      expect(code).toMatchInlineSnapshot(\n        `\"import \\\\\"core-js\\\\\";import { foo, bar } from \\\\\"a\\\\\";import baz from \\\\\"b\\\\\";import * as React from \\\\\"react\\\\\";import baz2, { yeet } from \\\\\"c\\\\\";import baz3, { cats } from \\\\\"d\\\\\";import { c, d } from \\\\\"e\\\\\";import { e as ee, f as ff } from \\\\\"f\\\\\";\"`\n      )\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should drop unused exports in a modern-apis page","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":239,"column":56},"line":239,"code":"    it('should drop unused exports in a modern-apis page', async () => {\n      const code = await babel(\n        // effectful\n        `import\"core-js\";` +\n          // basic\n          `import{foo,bar}from\"a\";import baz from\"b\";` +\n          // complex\n          `import*as React from\"react\";` +\n          `import baz2,{yeet}from\"c\";` +\n          `import baz3,{cats}from\"d\";` +\n          `import{c,d}from\"e\";` +\n          `import{e as ee,f as ff}from\"f\";` +\n          `` +\n          `export function getStaticProps() {foo;bar;baz;cats;baz2;ff; return { props: {} } }`,\n        { resourcePath: pageFile }\n      )\n      expect(code).toMatchInlineSnapshot(\n        `\"import \\\\\"core-js\\\\\";import * as React from \\\\\"react\\\\\";import { yeet } from \\\\\"c\\\\\";import baz3 from \\\\\"d\\\\\";import { c, d } from \\\\\"e\\\\\";import { e as ee } from \\\\\"f\\\\\";\"`\n      )\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should keep used exports in a modern-apis page (server)","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":260,"column":63},"line":260,"code":"    it('should keep used exports in a modern-apis page (server)', async () => {\n      const code = await babel(\n        // effectful\n        `import\"core-js\";` +\n          // basic\n          `import{foo,bar}from\"a\";import baz from\"b\";import ooo from\"ooo\";` +\n          // complex\n          `import*as React from\"react\";` +\n          `import baz2,{yeet}from\"c\";` +\n          `import baz3,{cats}from\"d\";` +\n          `import{c,d}from\"e\";` +\n          `import{e as ee,f as ff}from\"f\";` +\n          `` +\n          `export function getStaticProps() {foo();baz2();ff();ooo(); return { props: {} }}` +\n          `export default function () { return bar(); }`,\n        { resourcePath: pageFile, isServer: true }\n      )\n      expect(code).toMatchInlineSnapshot(\n        `\"import \\\\\"core-js\\\\\";import { foo, bar } from \\\\\"a\\\\\";import baz from \\\\\"b\\\\\";import ooo from \\\\\"ooo\\\\\";import * as React from \\\\\"react\\\\\";import baz2, { yeet } from \\\\\"c\\\\\";import baz3, { cats } from \\\\\"d\\\\\";import { c, d } from \\\\\"e\\\\\";import { e as ee, f as ff } from \\\\\"f\\\\\";export function getStaticProps() {  foo();  baz2();  ff();  ooo();  return {    props: {}  };}export default function () {  return bar();}\"`\n      )\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should keep used exports in a modern-apis page (client)","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":282,"column":63},"line":282,"code":"    it('should keep used exports in a modern-apis page (client)', async () => {\n      const code = await babel(\n        // effectful\n        `import\"core-js\";` +\n          // basic\n          `import{foo,bar}from\"a\";import baz from\"b\";import ooo from\"ooo\";` +\n          // complex\n          `import*as React from\"react\";` +\n          `import baz2,{yeet}from\"c\";` +\n          `import baz3,{cats}from\"d\";` +\n          `import{c,d}from\"e\";` +\n          `import{e as ee,f as ff}from\"f\";` +\n          `` +\n          `export function getStaticProps() {foo();baz2();ff();ooo();cats; return { props: {} }}` +\n          `export default function () { return cats + bar(); }`,\n        { resourcePath: pageFile, isServer: false }\n      )\n      expect(code).toMatchInlineSnapshot(\n        `\"import \\\\\"core-js\\\\\";import { bar } from \\\\\"a\\\\\";import baz from \\\\\"b\\\\\";import * as React from \\\\\"react\\\\\";import { yeet } from \\\\\"c\\\\\";import baz3, { cats } from \\\\\"d\\\\\";import { c, d } from \\\\\"e\\\\\";import { e as ee } from \\\\\"f\\\\\";export var __N_SSG = true;export default function () {  return cats + bar();}\"`\n      )\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should keep used exports and react in a modern-apis page with JSX (client)","suites":["next-babel-loader","replace constants"],"updatePoint":{"line":304,"column":82},"line":304,"code":"    it('should keep used exports and react in a modern-apis page with JSX (client)', async () => {\n      const code = await babel(\n        // effectful\n        `import\"core-js\";` +\n          // basic\n          `import{foo,bar}from\"a\";import baz from\"b\";import ooo from\"ooo\";` +\n          // complex\n          `import*as React from\"react\";` +\n          `import baz2,{yeet}from\"c\";` +\n          `import baz3,{cats}from\"d\";` +\n          `import{c,d}from\"e\";` +\n          `import{e as ee,f as ff}from\"f\";` +\n          `` +\n          `export function getStaticProps() {foo();baz2();ff();ooo(); return { props: {} }}` +\n          `export default function () { return <div>{cats + bar()}</div> }`,\n        { resourcePath: pageFile, isServer: false }\n      )\n      expect(code).toContain(\n        `var __jsx = React.createElement;import \"core-js\";import { bar } from \"a\";import baz from \"b\";import * as React from \"react\";import { yeet } from \"c\";import baz3, { cats } from \"d\";import { c, d } from \"e\";import { e as ee } from \"f\";export var __N_SSG = true;export default function () {  return __jsx(\"div\", {    __self: this,    __source: {      fileName: _jsxFileName,      lineNumber: 1,      columnNumber: 326    }  }, cats + bar());}`\n      )\n    })","file":"unit/next-babel-loader-prod.test.ts","skipped":false,"dir":"test"},{"name":"should transform JSX to use a local identifier in modern mode","suites":["next/babel","jsx-pragma"],"updatePoint":{"line":23,"column":69},"line":23,"code":"    it('should transform JSX to use a local identifier in modern mode', () => {\n      const output = babel(`const a = () => <a href=\"/\">home</a>;`, true)\n\n      // it should add a React import:\n      expect(output).toMatch(`import React from\"react\"`)\n      // it should hoist JSX factory to a module level variable:\n      expect(output).toMatch(`var __jsx=React.createElement`)\n      // it should use that factory for all JSX:\n      expect(output).toMatch(`__jsx(\"a\",{href:\"/\"`)\n\n      expect(\n        babel(`const a = ()=><a href=\"/\">home</a>`, true)\n      ).toMatchInlineSnapshot(\n        `\"import React from\\\\\"react\\\\\";var __jsx=React.createElement;var a=function a(){return __jsx(\\\\\"a\\\\\",{href:\\\\\"/\\\\\"},\\\\\"home\\\\\");};\"`\n      )\n    })","file":"unit/next-babel.test.ts","skipped":false,"dir":"test"},{"name":"should transform JSX to use a local identifier in CommonJS mode","suites":["next/babel","jsx-pragma"],"updatePoint":{"line":40,"column":71},"line":40,"code":"    it('should transform JSX to use a local identifier in CommonJS mode', () => {\n      const output = babel(trim`\n        const a = () => <React.Fragment><a href=\"/\">home</a></React.Fragment>;\n      `)\n\n      // Grab generated names from the compiled output.\n      // It looks something like this:\n      //   var _react = _interopRequireDefault(require(\"react\"));\n      //   var __jsx = _react[\"default\"].createElement;\n      // react: _react\n      // reactNamespace: _react[\"default\"]\n      const [, react, reactNamespace] = output.match(\n        /(([a-z0-9_]+)(\\[[^\\]]*?\\]|\\.[a-z0-9_]+)*?)\\.Fragment/i\n      )\n\n      expect(output).toMatch(`var ${reactNamespace}=`)\n      expect(output).toMatch(`require(\"react\")`)\n      expect(output).toMatch(`var __jsx=${react}.createElement`)\n      // Fragment should use the same React namespace import:\n      expect(output).toMatch(`__jsx(${react}.Fragment`)\n      expect(output).toMatch(`__jsx(\"a\",{href:\"/\"`)\n\n      expect(babel(`const a = ()=><a href=\"/\">home</a>`)).toMatchInlineSnapshot(\n        `\"\\\\\"use strict\\\\\";var _interopRequireDefault=require(\\\\\"@babel/runtime/helpers/interopRequireDefault\\\\\");var _react=_interopRequireDefault(require(\\\\\"react\\\\\"));var __jsx=_react[\\\\\"default\\\\\"].createElement;var a=function a(){return __jsx(\\\\\"a\\\\\",{href:\\\\\"/\\\\\"},\\\\\"home\\\\\");};\"`\n      )\n    })","file":"unit/next-babel.test.ts","skipped":false,"dir":"test"},{"name":"should support Fragment syntax","suites":["next/babel","jsx-pragma"],"updatePoint":{"line":67,"column":38},"line":67,"code":"    it('should support Fragment syntax', () => {\n      const output = babel(`const a = () => <>hello</>;`, true)\n\n      expect(output).toMatch(`React.Fragment`)\n\n      expect(babel(`const a = () => <>hello</>;`, true)).toMatchInlineSnapshot(\n        `\"import React from\\\\\"react\\\\\";var __jsx=React.createElement;var a=function a(){return __jsx(React.Fragment,null,\\\\\"hello\\\\\");};\"`\n      )\n    })","file":"unit/next-babel.test.ts","skipped":false,"dir":"test"},{"name":"should support commonjs","suites":["next/babel","jsx-pragma"],"updatePoint":{"line":77,"column":31},"line":77,"code":"    it('should support commonjs', () => {\n      const output = babel(\n        trim`\n        const React = require('react');\n        module.exports = () => <div>test2</div>;\n      `,\n        true\n      )\n\n      expect(output).toMatchInlineSnapshot(\n        `\"var React=require('react');var __jsx=React.createElement;module.exports=function(){return __jsx(\\\\\"div\\\\\",null,\\\\\"test2\\\\\");};\"`\n      )\n    })","file":"unit/next-babel.test.ts","skipped":false,"dir":"test"},{"name":"should transform Array-destructured hook return values use object destructuring","suites":["next/babel","optimize-hook-destructuring"],"updatePoint":{"line":93,"column":87},"line":93,"code":"    it('should transform Array-destructured hook return values use object destructuring', () => {\n      const output = babel(\n        trim`\n        import { useState } from 'react';\n        const [count, setCount] = useState(0);\n      `,\n        true\n      )\n\n      expect(output).toMatch(trim`\n        var _useState=useState(0),count=_useState[0],setCount=_useState[1];\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"import{useState}from'react';var _useState=useState(0),count=_useState[0],setCount=_useState[1];\"`\n      )\n    })","file":"unit/next-babel.test.ts","skipped":false,"dir":"test"},{"name":"should be able to ignore some Array-destructured hook return values","suites":["next/babel","optimize-hook-destructuring"],"updatePoint":{"line":111,"column":75},"line":111,"code":"    it('should be able to ignore some Array-destructured hook return values', () => {\n      const output = babel(\n        trim`\n        import { useState } from 'react';\n        const [, setCount] = useState(0);\n      `,\n        true\n      )\n\n      expect(output).toMatch(trim`\n        var _useState=useState(0),setCount=_useState[1];\n      `)\n\n      expect(output).toMatchInlineSnapshot(\n        `\"import{useState}from'react';var _useState=useState(0),setCount=_useState[1];\"`\n      )\n    })","file":"unit/next-babel.test.ts","skipped":false,"dir":"test"},{"name":"should not elide import","suites":["next/babel","@babel/preset-typescript","should allow passing options","when setting { onlyRemoveTypeImports: true }"],"updatePoint":{"line":151,"column":35},"line":151,"code":"        it('should not elide import', () => {\n          const output = compileMyCar({ onlyRemoveTypeImports: true })\n\n          expect(output).toContain('require(\"./car\")')\n        })","file":"unit/next-babel.test.ts","skipped":false,"dir":"test"},{"name":"should elide import","suites":["next/babel","@babel/preset-typescript","should allow passing options","when setting { onlyRemoveTypeImports: false }"],"updatePoint":{"line":159,"column":31},"line":159,"code":"        it('should elide import', () => {\n          const output = compileMyCar({ onlyRemoveTypeImports: false })\n\n          expect(output).not.toContain('require(\"./car\")')\n        })","file":"unit/next-babel.test.ts","skipped":false,"dir":"test"},{"name":"should allow forcing on automatic mode","suites":["next/babel","respect preset-react runtime"],"updatePoint":{"line":169,"column":46},"line":169,"code":"    it('should allow forcing on automatic mode', () => {\n      const code = trim`const a = ()=><a href=\"/\">home</a>`\n      const output = babel(code, true, {\n        'preset-react': {\n          runtime: 'automatic',\n        },\n      })\n\n      expect(output).toMatchInlineSnapshot(\n        `\"import{jsx as _jsx}from\\\\\"react/jsx-runtime\\\\\";var a=function a(){return/*#__PURE__*/_jsx(\\\\\"a\\\\\",{href:\\\\\"/\\\\\",children:\\\\\"home\\\\\"});};\"`\n      )\n    })","file":"unit/next-babel.test.ts","skipped":false,"dir":"test"},{"name":"should allow forcing on classic mode","suites":["next/babel","respect preset-react runtime"],"updatePoint":{"line":182,"column":44},"line":182,"code":"    it('should allow forcing on classic mode', () => {\n      const code = trim`const a = ()=><a href=\"/\">home</a>`\n      const output = babel(code, true, {\n        'preset-react': {\n          runtime: 'classic',\n        },\n      })\n\n      expect(output).toMatchInlineSnapshot(\n        `\"import React from\\\\\"react\\\\\";var __jsx=React.createElement;var a=function a(){return __jsx(\\\\\"a\\\\\",{href:\\\\\"/\\\\\"},\\\\\"home\\\\\");};\"`\n      )\n    })","file":"unit/next-babel.test.ts","skipped":false,"dir":"test"},{"name":"should render outside of Next.js without error","suites":["Rendering next/head"],"updatePoint":{"line":7,"column":52},"line":7,"code":"  it('should render outside of Next.js without error', () => {\n    const html = ReactDOM.renderToString(\n      React.createElement(\n        React.Fragment,\n        {},\n        React.createElement(Head),\n        React.createElement('p', {}, 'hello world')\n      )\n    )\n    expect(html).toContain('hello world')\n  })","file":"unit/next-head-rendering.test.ts","skipped":false,"dir":"test"},{"name":"should leave url unchanged when no apm parameter is present","suites":["cleanAmpPath"],"updatePoint":{"line":9,"column":65},"line":9,"code":"  it('should leave url unchanged when no apm parameter is present', () =>\n    check('/some/path?param=blah', '/some/path?param=blah'))","file":"unit/next-server-utils.test.ts","skipped":false,"dir":"test"},{"name":"should handle amp as the only parameter","suites":["cleanAmpPath"],"updatePoint":{"line":12,"column":45},"line":12,"code":"  it('should handle amp as the only parameter', () =>\n    check('/some/path?amp=1', '/some/path'))","file":"unit/next-server-utils.test.ts","skipped":false,"dir":"test"},{"name":"should handle amp as the first parameter","suites":["cleanAmpPath"],"updatePoint":{"line":15,"column":46},"line":15,"code":"  it('should handle amp as the first parameter', () =>\n    check('/some/path?amp=1&page=10', '/some/path?page=10'))","file":"unit/next-server-utils.test.ts","skipped":false,"dir":"test"},{"name":"should handle amp as the middle parameter","suites":["cleanAmpPath"],"updatePoint":{"line":18,"column":47},"line":18,"code":"  it('should handle amp as the middle parameter', () =>\n    check('/some/path?page=10&amp=1&last=here', '/some/path?page=10&last=here'))","file":"unit/next-server-utils.test.ts","skipped":false,"dir":"test"},{"name":"should handle amp as the last parameter","suites":["cleanAmpPath"],"updatePoint":{"line":21,"column":45},"line":21,"code":"  it('should handle amp as the last parameter', () =>\n    check('/some/path?page=10&amp=1', '/some/path?page=10'))","file":"unit/next-server-utils.test.ts","skipped":false,"dir":"test"},{"name":"should transform Array-destructured hook return values use object destructuring","suites":["next/swc","hook_optimizer"],"updatePoint":{"line":13,"column":87},"line":13,"code":"    it('should transform Array-destructured hook return values use object destructuring', async () => {\n      const output = await swc(\n        trim`\n        import { useState } from 'react';\n        const [count, setCount] = useState(0);\n      `\n      )\n\n      expect(output).toMatch(trim`\n        var ref = useState(0), count = ref[0], setCount = ref[1];\n      `)\n\n      expect(output).toMatchInlineSnapshot(`\n\"import { useState } from \\\\\"react\\\\\";\nvar ref = useState(0), count = ref[0], setCount = ref[1];\n\"\n`)\n    })","file":"unit/next-swc.test.ts","skipped":false,"dir":"test"},{"name":"should be able to ignore some Array-destructured hook return values","suites":["next/swc","hook_optimizer"],"updatePoint":{"line":32,"column":75},"line":32,"code":"    it('should be able to ignore some Array-destructured hook return values', async () => {\n      const output = await swc(\n        trim`\n        import { useState } from 'react';\n        const [, setCount] = useState(0);\n      `\n      )\n\n      expect(output).toMatch(trim`\n        var ref = useState(0), setCount = ref[1];\n      `)\n\n      expect(output).toMatchInlineSnapshot(`\n\"import { useState } from \\\\\"react\\\\\";\nvar ref = useState(0), setCount = ref[1];\n\"\n`)\n    })","file":"unit/next-swc.test.ts","skipped":false,"dir":"test"},{"name":"empty array","suites":["oxford-comma-list"],"updatePoint":{"line":5,"column":19},"line":5,"code":"  test('empty array', () => {\n    expect(getOxfordCommaList([])).toMatchInlineSnapshot(`\"\"`)\n  })","file":"unit/oxford-comma.test.ts","skipped":false,"dir":"test"},{"name":"single item array","suites":["oxford-comma-list"],"updatePoint":{"line":9,"column":25},"line":9,"code":"  test('single item array', () => {\n    expect(getOxfordCommaList(['apples'])).toMatchInlineSnapshot(`\"apples\"`)\n  })","file":"unit/oxford-comma.test.ts","skipped":false,"dir":"test"},{"name":"two item array","suites":["oxford-comma-list"],"updatePoint":{"line":13,"column":22},"line":13,"code":"  test('two item array', () => {\n    expect(\n      getOxfordCommaList(['apples', 'strawberries'])\n    ).toMatchInlineSnapshot(`\"apples and strawberries\"`)\n  })","file":"unit/oxford-comma.test.ts","skipped":false,"dir":"test"},{"name":"three item array","suites":["oxford-comma-list"],"updatePoint":{"line":19,"column":24},"line":19,"code":"  test('three item array', () => {\n    expect(\n      getOxfordCommaList(['apples', 'strawberries', 'blueberries'])\n    ).toMatchInlineSnapshot(`\"apples, strawberries, and blueberries\"`)\n  })","file":"unit/oxford-comma.test.ts","skipped":false,"dir":"test"},{"name":"four item array","suites":["oxford-comma-list"],"updatePoint":{"line":25,"column":23},"line":25,"code":"  test('four item array', () => {\n    expect(getOxfordCommaList(['1', '2', '3', '4'])).toMatchInlineSnapshot(\n      `\"1, 2, 3, and 4\"`\n    )\n  })","file":"unit/oxford-comma.test.ts","skipped":false,"dir":"test"},{"name":"five item array","suites":["oxford-comma-list"],"updatePoint":{"line":31,"column":23},"line":31,"code":"  test('five item array', () => {\n    expect(getOxfordCommaList(['1', '2', '3', '4', '5'])).toMatchInlineSnapshot(\n      `\"1, 2, 3, 4, and 5\"`\n    )\n  })","file":"unit/oxford-comma.test.ts","skipped":false,"dir":"test"},{"name":"does not add extra routes","suites":["getSortedRoutes"],"updatePoint":{"line":5,"column":31},"line":5,"code":"  it('does not add extra routes', () => {\n    expect(getSortedRoutes(['/posts'])).toEqual(['/posts'])\n\n    expect(getSortedRoutes(['/posts/[id]'])).toEqual(['/posts/[id]'])\n    expect(getSortedRoutes(['/posts/[id]/foo'])).toEqual(['/posts/[id]/foo'])\n\n    expect(getSortedRoutes(['/posts/[id]/[foo]/bar'])).toEqual([\n      '/posts/[id]/[foo]/bar',\n    ])\n    expect(getSortedRoutes(['/posts/[id]/baz/[foo]/bar'])).toEqual([\n      '/posts/[id]/baz/[foo]/bar',\n    ])\n  })","file":"unit/page-route-sorter.test.ts","skipped":false,"dir":"test"},{"name":"correctly sorts required slugs","suites":["getSortedRoutes"],"updatePoint":{"line":19,"column":36},"line":19,"code":"  it('correctly sorts required slugs', () => {\n    expect(\n      getSortedRoutes([\n        '/posts',\n        '/[root-slug]',\n        '/',\n        '/posts/[id]',\n        '/blog/[id]/comments/[cid]',\n        '/blog/abc/[id]',\n        '/[...rest]',\n        '/blog/abc/post',\n        '/blog/abc',\n        '/p1/[[...incl]]',\n        '/p/[...rest]',\n        '/p2/[...rest]',\n        '/p2/[id]',\n        '/p2/[id]/abc',\n        '/p3/[[...rest]]',\n        '/p3/[id]',\n        '/p3/[id]/abc',\n        '/blog/[id]',\n        '/foo/[d]/bar/baz/[f]',\n        '/apples/[ab]/[cd]/ef',\n      ])\n    ).toMatchInlineSnapshot(`\n      Array [\n        \"/\",\n        \"/apples/[ab]/[cd]/ef\",\n        \"/blog/abc\",\n        \"/blog/abc/post\",\n        \"/blog/abc/[id]\",\n        \"/blog/[id]\",\n        \"/blog/[id]/comments/[cid]\",\n        \"/foo/[d]/bar/baz/[f]\",\n        \"/p/[...rest]\",\n        \"/p1/[[...incl]]\",\n        \"/p2/[id]\",\n        \"/p2/[id]/abc\",\n        \"/p2/[...rest]\",\n        \"/p3/[id]\",\n        \"/p3/[id]/abc\",\n        \"/p3/[[...rest]]\",\n        \"/posts\",\n        \"/posts/[id]\",\n        \"/[root-slug]\",\n        \"/[...rest]\",\n      ]\n    `)\n  })","file":"unit/page-route-sorter.test.ts","skipped":false,"dir":"test"},{"name":"catches mismatched param names","suites":["getSortedRoutes"],"updatePoint":{"line":69,"column":36},"line":69,"code":"  it('catches mismatched param names', () => {\n    expect(() =>\n      getSortedRoutes([\n        '/',\n        '/blog',\n        '/blog/[id]',\n        '/blog/[id]/comments/[cid]',\n        '/blog/[cid]',\n      ])\n    ).toThrowError(/different slug names/)\n  })","file":"unit/page-route-sorter.test.ts","skipped":false,"dir":"test"},{"name":"catches reused param names","suites":["getSortedRoutes"],"updatePoint":{"line":81,"column":32},"line":81,"code":"  it('catches reused param names', () => {\n    expect(() =>\n      getSortedRoutes(['/', '/blog', '/blog/[id]/comments/[id]', '/blog/[id]'])\n    ).toThrowError(/the same slug name/)\n  })","file":"unit/page-route-sorter.test.ts","skipped":false,"dir":"test"},{"name":"catches reused param names with catch-all","suites":["getSortedRoutes"],"updatePoint":{"line":87,"column":47},"line":87,"code":"  it('catches reused param names with catch-all', () => {\n    expect(() =>\n      getSortedRoutes(['/blog/[id]', '/blog/[id]/[...id]'])\n    ).toThrowError(/the same slug name/)\n  })","file":"unit/page-route-sorter.test.ts","skipped":false,"dir":"test"},{"name":"catches middle catch-all with another catch-all","suites":["getSortedRoutes"],"updatePoint":{"line":93,"column":53},"line":93,"code":"  it('catches middle catch-all with another catch-all', () => {\n    expect(() =>\n      getSortedRoutes(['/blog/[...id]/[...id2]'])\n    ).toThrowErrorMatchingInlineSnapshot(\n      `\"Catch-all must be the last part of the URL.\"`\n    )\n  })","file":"unit/page-route-sorter.test.ts","skipped":false,"dir":"test"},{"name":"catches middle catch-all with fixed route","suites":["getSortedRoutes"],"updatePoint":{"line":101,"column":47},"line":101,"code":"  it('catches middle catch-all with fixed route', () => {\n    expect(() =>\n      getSortedRoutes(['/blog/[...id]/abc'])\n    ).toThrowErrorMatchingInlineSnapshot(\n      `\"Catch-all must be the last part of the URL.\"`\n    )\n  })","file":"unit/page-route-sorter.test.ts","skipped":false,"dir":"test"},{"name":"catches extra dots in catch-all","suites":["getSortedRoutes"],"updatePoint":{"line":109,"column":37},"line":109,"code":"  it('catches extra dots in catch-all', () => {\n    expect(() =>\n      getSortedRoutes(['/blog/[....id]/abc'])\n    ).toThrowErrorMatchingInlineSnapshot(\n      `\"Segment names may not start with erroneous periods ('.id').\"`\n    )\n  })","file":"unit/page-route-sorter.test.ts","skipped":false,"dir":"test"},{"name":"catches missing dots in catch-all","suites":["getSortedRoutes"],"updatePoint":{"line":117,"column":39},"line":117,"code":"  it('catches missing dots in catch-all', () => {\n    expect(() =>\n      getSortedRoutes(['/blog/[..id]/abc'])\n    ).toThrowErrorMatchingInlineSnapshot(\n      `\"Segment names may not start with erroneous periods ('..id').\"`\n    )\n  })","file":"unit/page-route-sorter.test.ts","skipped":false,"dir":"test"},{"name":"catches extra brackets for optional","suites":["getSortedRoutes"],"updatePoint":{"line":125,"column":41},"line":125,"code":"  it('catches extra brackets for optional', () => {\n    expect(() =>\n      getSortedRoutes(['/blog/[[...id]'])\n    ).toThrowErrorMatchingInlineSnapshot(\n      `\"Segment names may not start or end with extra brackets ('[...id').\"`\n    )\n    expect(() =>\n      getSortedRoutes(['/blog/[[[...id]]'])\n    ).toThrowErrorMatchingInlineSnapshot(\n      `\"Segment names may not start or end with extra brackets ('[...id').\"`\n    )\n    expect(() =>\n      getSortedRoutes(['/blog/[...id]]'])\n    ).toThrowErrorMatchingInlineSnapshot(\n      `\"Segment names may not start or end with extra brackets ('id]').\"`\n    )\n    expect(() =>\n      getSortedRoutes(['/blog/[[...id]]]'])\n    ).toThrowErrorMatchingInlineSnapshot(\n      `\"Segment names may not start or end with extra brackets ('id]').\"`\n    )\n    expect(() =>\n      getSortedRoutes(['/blog/[[[...id]]]'])\n    ).toThrowErrorMatchingInlineSnapshot(\n      `\"Segment names may not start or end with extra brackets ('[...id]').\"`\n    )\n  })","file":"unit/page-route-sorter.test.ts","skipped":false,"dir":"test"},{"name":"disallows optional params","suites":["getSortedRoutes"],"updatePoint":{"line":153,"column":31},"line":153,"code":"  it('disallows optional params', () => {\n    expect(() =>\n      getSortedRoutes(['/[[blog]]'])\n    ).toThrowErrorMatchingInlineSnapshot(\n      `\"Optional route parameters are not yet supported (\\\\\"[[blog]]\\\\\").\"`\n    )\n    expect(() =>\n      getSortedRoutes(['/abc/[[blog]]'])\n    ).toThrowErrorMatchingInlineSnapshot(\n      `\"Optional route parameters are not yet supported (\\\\\"[[blog]]\\\\\").\"`\n    )\n    expect(() =>\n      getSortedRoutes(['/abc/[[blog]]/def'])\n    ).toThrowErrorMatchingInlineSnapshot(\n      `\"Optional route parameters are not yet supported (\\\\\"[[blog]]\\\\\").\"`\n    )\n  })","file":"unit/page-route-sorter.test.ts","skipped":false,"dir":"test"},{"name":"disallows mixing required catch all and optional catch all","suites":["getSortedRoutes"],"updatePoint":{"line":171,"column":64},"line":171,"code":"  it('disallows mixing required catch all and optional catch all', () => {\n    expect(() =>\n      getSortedRoutes(['/[...one]', '/[[...one]]'])\n    ).toThrowErrorMatchingInlineSnapshot(\n      `\"You cannot use both an required and optional catch-all route at the same level (\\\\\"[...one]\\\\\" and \\\\\"[[...one]]\\\\\" ).\"`\n    )\n    expect(() =>\n      getSortedRoutes(['/[[...one]]', '/[...one]'])\n    ).toThrowErrorMatchingInlineSnapshot(\n      `\"You cannot use both an optional and required catch-all route at the same level (\\\\\"[[...one]]\\\\\" and \\\\\"[...one]\\\\\").\"`\n    )\n  })","file":"unit/page-route-sorter.test.ts","skipped":false,"dir":"test"},{"name":"disallows apex and optional catch all","suites":["getSortedRoutes"],"updatePoint":{"line":184,"column":43},"line":184,"code":"  it('disallows apex and optional catch all', () => {\n    expect(() =>\n      getSortedRoutes(['/', '/[[...all]]'])\n    ).toThrowErrorMatchingInlineSnapshot(\n      `\"You cannot define a route with the same specificity as a optional catch-all route (\\\\\"/\\\\\" and \\\\\"/[[...all]]\\\\\").\"`\n    )\n    expect(() =>\n      getSortedRoutes(['/[[...all]]', '/'])\n    ).toThrowErrorMatchingInlineSnapshot(\n      `\"You cannot define a route with the same specificity as a optional catch-all route (\\\\\"/\\\\\" and \\\\\"/[[...all]]\\\\\").\"`\n    )\n\n    expect(() =>\n      getSortedRoutes(['/sub', '/sub/[[...all]]'])\n    ).toThrowErrorMatchingInlineSnapshot(\n      `\"You cannot define a route with the same specificity as a optional catch-all route (\\\\\"/sub\\\\\" and \\\\\"/sub[[...all]]\\\\\").\"`\n    )\n    expect(() =>\n      getSortedRoutes(['/sub/[[...all]]', '/sub'])\n    ).toThrowErrorMatchingInlineSnapshot(\n      `\"You cannot define a route with the same specificity as a optional catch-all route (\\\\\"/sub\\\\\" and \\\\\"/sub[[...all]]\\\\\").\"`\n    )\n  })","file":"unit/page-route-sorter.test.ts","skipped":false,"dir":"test"},{"name":"catches param names differing only by non-word characters","suites":["getSortedRoutes"],"updatePoint":{"line":208,"column":63},"line":208,"code":"  it('catches param names differing only by non-word characters', () => {\n    expect(() =>\n      getSortedRoutes([\n        '/blog/[helloworld]',\n        '/blog/[helloworld]/[hello-world]',\n      ])\n    ).toThrowError(/differ only by non-word/)\n  })","file":"unit/page-route-sorter.test.ts","skipped":false,"dir":"test"},{"name":"should parse nodejs runtime correctly","suites":["parse page static info"],"updatePoint":{"line":13,"column":43},"line":13,"code":"  it('should parse nodejs runtime correctly', async () => {\n    const { runtime, ssr, ssg } = await getPageStaticInfo({\n      pageFilePath: join(fixtureDir, 'page-runtime/nodejs-ssr.js'),\n      nextConfig: createNextConfig(),\n    })\n    expect(runtime).toBe('nodejs')\n    expect(ssr).toBe(true)\n    expect(ssg).toBe(false)\n  })","file":"unit/parse-page-static-info.test.ts","skipped":false,"dir":"test"},{"name":"should parse static runtime correctly","suites":["parse page static info"],"updatePoint":{"line":23,"column":43},"line":23,"code":"  it('should parse static runtime correctly', async () => {\n    const { runtime, ssr, ssg } = await getPageStaticInfo({\n      pageFilePath: join(fixtureDir, 'page-runtime/nodejs.js'),\n      nextConfig: createNextConfig(),\n    })\n    expect(runtime).toBe(undefined)\n    expect(ssr).toBe(false)\n    expect(ssg).toBe(false)\n  })","file":"unit/parse-page-static-info.test.ts","skipped":false,"dir":"test"},{"name":"should parse edge runtime correctly","suites":["parse page static info"],"updatePoint":{"line":33,"column":41},"line":33,"code":"  it('should parse edge runtime correctly', async () => {\n    const { runtime } = await getPageStaticInfo({\n      pageFilePath: join(fixtureDir, 'page-runtime/edge.js'),\n      nextConfig: createNextConfig(),\n    })\n    expect(runtime).toBe('experimental-edge')\n  })","file":"unit/parse-page-static-info.test.ts","skipped":false,"dir":"test"},{"name":"should return undefined if no runtime is specified","suites":["parse page static info"],"updatePoint":{"line":41,"column":56},"line":41,"code":"  it('should return undefined if no runtime is specified', async () => {\n    const { runtime } = await getPageStaticInfo({\n      pageFilePath: join(fixtureDir, 'page-runtime/static.js'),\n      nextConfig: createNextConfig(),\n    })\n    expect(runtime).toBe(undefined)\n  })","file":"unit/parse-page-static-info.test.ts","skipped":false,"dir":"test"},{"name":"should parse ssr info with variable exported gSSP correctly","suites":["parse page static info"],"updatePoint":{"line":49,"column":65},"line":49,"code":"  it('should parse ssr info with variable exported gSSP correctly', async () => {\n    const { ssr, ssg } = await getPageStaticInfo({\n      pageFilePath: join(fixtureDir, 'page-runtime/ssr-variable-gssp.js'),\n      nextConfig: createNextConfig(),\n    })\n    expect(ssr).toBe(true)\n    expect(ssg).toBe(false)\n  })","file":"unit/parse-page-static-info.test.ts","skipped":false,"dir":"test"},{"name":"should fallback when gSP is defined and exported","suites":["fallback to the global runtime configuration"],"updatePoint":{"line":60,"column":54},"line":60,"code":"  it('should fallback when gSP is defined and exported', async () => {\n    const { runtime, ssr, ssg } = await getPageStaticInfo({\n      pageFilePath: join(fixtureDir, 'page-runtime/fallback-with-gsp.js'),\n      nextConfig: createNextConfig('experimental-edge'),\n    })\n    expect(runtime).toBe('experimental-edge')\n    expect(ssr).toBe(false)\n    expect(ssg).toBe(true)\n  })","file":"unit/parse-page-static-info.test.ts","skipped":false,"dir":"test"},{"name":"should fallback when gSP is re-exported from other module","suites":["fallback to the global runtime configuration"],"updatePoint":{"line":70,"column":63},"line":70,"code":"  it('should fallback when gSP is re-exported from other module', async () => {\n    const { runtime, ssr, ssg } = await getPageStaticInfo({\n      pageFilePath: join(fixtureDir, 'page-runtime/fallback-re-export-gsp.js'),\n      nextConfig: createNextConfig('experimental-edge'),\n    })\n    expect(runtime).toBe('experimental-edge')\n    expect(ssr).toBe(false)\n    expect(ssg).toBe(true)\n  })","file":"unit/parse-page-static-info.test.ts","skipped":false,"dir":"test"},{"name":"should parse relative url","suites":["parseRelativeUrl"],"updatePoint":{"line":29,"column":31},"line":29,"code":"  it('should parse relative url', () => {\n    check(\n      'http://example.com:3210/someA/pathB?fooC=barD#hashE',\n      '/someF/pathG?fooH=barI#hashJ',\n      {\n        pathname: '/someF/pathG',\n        search: '?fooH=barI',\n        hash: '#hashJ',\n      }\n    )\n  })","file":"unit/parse-relative-url.test.ts","skipped":false,"dir":"test"},{"name":"should parse relative url when start with dot","suites":["parseRelativeUrl"],"updatePoint":{"line":41,"column":51},"line":41,"code":"  it('should parse relative url when start with dot', () => {\n    check(\n      'http://example.com:3210/someA/pathB?fooC=barD#hashE',\n      './someF/pathG?fooH=barI#hashJ',\n      {\n        pathname: '/someA/someF/pathG',\n        search: '?fooH=barI',\n        hash: '#hashJ',\n      }\n    )\n    check(\n      'http://example.com:3210/someA/pathB',\n      '../someF/pathG?fooH=barI#hashJ',\n      {\n        pathname: '/someF/pathG',\n        search: '?fooH=barI',\n        hash: '#hashJ',\n      }\n    )\n    check(\n      'http://example.com:3210/someA/pathB',\n      '../../someF/pathG?fooH=barI#hashJ',\n      {\n        pathname: '/someF/pathG',\n        search: '?fooH=barI',\n        hash: '#hashJ',\n      }\n    )\n  })","file":"unit/parse-relative-url.test.ts","skipped":false,"dir":"test"},{"name":"should parse relative url on special protocol","suites":["parseRelativeUrl"],"updatePoint":{"line":71,"column":51},"line":71,"code":"  it('should parse relative url on special protocol', () => {\n    check(\n      'ionic://localhost/someA/pathB?fooC=barD#hashE',\n      '/someF/pathG?fooH=barI#hashJ',\n      {\n        pathname: '/someF/pathG',\n        search: '?fooH=barI',\n        hash: '#hashJ',\n      }\n    )\n    check(\n      'file:///someA/pathB?fooC=barD#hashE',\n      '/someF/pathG?fooH=barI#hashJ',\n      {\n        pathname: '/someF/pathG',\n        search: '?fooH=barI',\n        hash: '#hashJ',\n      }\n    )\n  })","file":"unit/parse-relative-url.test.ts","skipped":false,"dir":"test"},{"name":"should parse the full url with current origin","suites":["parseRelativeUrl"],"updatePoint":{"line":92,"column":51},"line":92,"code":"  it('should parse the full url with current origin', () => {\n    check(\n      'http://example.com:3210/someA/pathB?fooC=barD#hashE',\n      'http://example.com:3210/someF/pathG?fooH=barI#hashJ',\n      {\n        pathname: '/someF/pathG',\n        search: '?fooH=barI',\n        hash: '#hashJ',\n      }\n    )\n  })","file":"unit/parse-relative-url.test.ts","skipped":false,"dir":"test"},{"name":"should throw when parsing the full url with diff origin","suites":["parseRelativeUrl"],"updatePoint":{"line":104,"column":61},"line":104,"code":"  it('should throw when parsing the full url with diff origin', () => {\n    check(\n      'http://example.com:3210/someA/pathB?fooC=barD#hashE',\n      'http://google.com/someF/pathG?fooH=barI#hashJ',\n      'invariant: invalid relative URL'\n    )\n  })","file":"unit/parse-relative-url.test.ts","skipped":false,"dir":"test"},{"name":"should throw when parsing the special prefix","suites":["parseRelativeUrl"],"updatePoint":{"line":112,"column":50},"line":112,"code":"  it('should throw when parsing the special prefix', () => {\n    check(\n      'http://example.com:3210/someA/pathB?fooC=barD#hashE',\n      'mailto:foo@example.com',\n      'invariant: invalid relative URL'\n    )\n    check(\n      'http://example.com:3210/someA/pathB?fooC=barD#hashE',\n      'tel:+123456789',\n      'invariant: invalid relative URL'\n    )\n    check(\n      'http://example.com:3210/someA/pathB?fooC=barD#hashE',\n      'sms:+123456789',\n      'invariant: invalid relative URL'\n    )\n  })","file":"unit/parse-relative-url.test.ts","skipped":false,"dir":"test"},{"name":"should set phases correctly","suites":["phaseConstants"],"updatePoint":{"line":10,"column":33},"line":10,"code":"  it('should set phases correctly', () => {\n    expect(PHASE_EXPORT).toBe('phase-export')\n    expect(PHASE_PRODUCTION_BUILD).toBe('phase-production-build')\n    expect(PHASE_PRODUCTION_SERVER).toBe('phase-production-server')\n    expect(PHASE_DEVELOPMENT_SERVER).toBe('phase-development-server')\n  })","file":"unit/phaseConstants.test.ts","skipped":false,"dir":"test"},{"name":"should work","suites":["recursiveCopy"],"updatePoint":{"line":45,"column":17},"line":45,"code":"  it('should work', async () => {\n    await fs.remove(testDir)\n    await setupTestDir(6)\n\n    await recursiveCopy(srcDir, destDir, {\n      filter(path) {\n        return path !== '/folder1/file1'\n      },\n    })\n\n    expect(await fs.pathExists(join(destDir, '.hidden'))).toBe(true)\n    expect(await fs.pathExists(join(destDir, 'file'))).toBe(true)\n    expect(await fs.pathExists(join(destDir, 'link'))).toBe(true)\n    expect(await fs.pathExists(join(destDir, 'folder1', 'file1'))).toBe(false)\n    expect(await fs.pathExists(join(destDir, 'folder1', 'file2'))).toBe(true)\n    expect(await fs.pathExists(join(destDir, 'linkfolder', 'file1'))).toBe(true)\n    expect(await fs.pathExists(join(destDir, 'linkfolder', 'file2'))).toBe(true)\n\n    expect(readFileSync(join(destDir, 'file'), 'utf8')).toBe('file')\n    expect(readFileSync(join(destDir, 'link'), 'utf8')).toBe('file')\n    expect(readFileSync(join(destDir, 'linkfolder', 'file1'), 'utf8')).toBe(\n      'file1'\n    )\n  })","file":"unit/recursive-copy.test.ts","skipped":false,"dir":"test"},{"name":"should work with content existing in dest","suites":["recursiveCopy"],"updatePoint":{"line":70,"column":47},"line":70,"code":"  it('should work with content existing in dest', async () => {\n    await fs.remove(testDir)\n    const paths = await setupTestDir(25)\n    await recursiveCopy(srcDir, destDir)\n    await recursiveCopy(srcDir, destDir, { overwrite: true })\n\n    for (const path of paths) {\n      expect(await fs.pathExists(join(destDir, path))).toBe(true)\n    }\n  })","file":"unit/recursive-copy.test.ts","skipped":false,"dir":"test"},{"name":"should handle more files than concurrency","suites":["recursiveCopy"],"updatePoint":{"line":81,"column":47},"line":81,"code":"  it('should handle more files than concurrency', async () => {\n    await fs.remove(testDir)\n    const paths = await setupTestDir(100)\n    await recursiveCopy(srcDir, destDir, { concurrency: 50 })\n\n    for (const path of paths) {\n      expect(await fs.pathExists(join(destDir, path))).toBe(true)\n    }\n  })","file":"unit/recursive-copy.test.ts","skipped":false,"dir":"test"},{"name":"should work","suites":["recursiveDelete"],"updatePoint":{"line":13,"column":17},"line":13,"code":"  it('should work', async () => {\n    expect.assertions(1)\n    try {\n      await recursiveCopy(resolveDataDir, testResolveDataDir)\n      await fs.symlink('./aa', join(testResolveDataDir, 'symlink'))\n      await recursiveDelete(testResolveDataDir)\n      const result = await recursiveReadDir(testResolveDataDir, /.*/)\n      expect(result.length).toBe(0)\n    } finally {\n      await recursiveDelete(testResolveDataDir)\n    }\n  })","file":"unit/recursive-delete.test.ts","skipped":false,"dir":"test"},{"name":"should exclude","suites":["recursiveDelete"],"updatePoint":{"line":26,"column":20},"line":26,"code":"  it('should exclude', async () => {\n    expect.assertions(2)\n    try {\n      await recursiveCopy(resolveDataDir, testpreservefileDir, {\n        overwrite: true,\n      })\n      // preserve cache dir\n      await recursiveDelete(testpreservefileDir, /^cache/)\n\n      const result = await recursiveReadDir(testpreservefileDir, /.*/)\n      expect(result.length).toBe(1)\n    } finally {\n      // Ensure test cleanup\n      await recursiveDelete(testpreservefileDir)\n\n      const cleanupResult = await recursiveReadDir(testpreservefileDir, /.*/)\n      expect(cleanupResult.length).toBe(0)\n    }\n  })","file":"unit/recursive-delete.test.ts","skipped":false,"dir":"test"},{"name":"should work","suites":["recursiveReadDir"],"updatePoint":{"line":10,"column":17},"line":10,"code":"  it('should work', async () => {\n    const result = await recursiveReadDir(dirWithPages, /\\.js/)\n    const pages = [\n      /^[\\\\/]index\\.js/,\n      /^[\\\\/]prefered\\.js/,\n      /^[\\\\/]nav[\\\\/]about\\.js/,\n      /^[\\\\/]nav[\\\\/]index\\.js/,\n      /^[\\\\/]nested[\\\\/]index\\.js/,\n      /^[\\\\/]prefered[\\\\/]index\\.js/,\n      /^[\\\\/]nav[\\\\/]products[\\\\/]product\\.js/,\n    ]\n    expect(\n      result.filter((item) => {\n        for (const page of pages) {\n          if (page.test(item)) {\n            return false\n          }\n        }\n\n        return true\n      }).length\n    ).toBe(0)\n  })","file":"unit/recursive-readdir.test.ts","skipped":false,"dir":"test"},{"name":"should add basePath correctly when no basePath","suites":["router addBasePath"],"updatePoint":{"line":5,"column":52},"line":5,"code":"  it('should add basePath correctly when no basePath', () => {\n    const result = addBasePath('/hello')\n    expect(result).toBe('/hello')\n  })","file":"unit/router-add-base-path.test.ts","skipped":false,"dir":"test"},{"name":"should parse a plain value","suites":["splitCookiesString","with a single cookie"],"updatePoint":{"line":18,"column":34},"line":18,"code":"    it('should parse a plain value', () => {\n      const { joined, expected } = generateCookies({\n        name: 'foo',\n        value: 'bar',\n      })\n      const result = splitCookiesString(joined)\n      expect(result).toEqual(expected)\n    })","file":"unit/split-cookies-string.test.ts","skipped":false,"dir":"test"},{"name":"should parse expires","suites":["splitCookiesString","with a single cookie"],"updatePoint":{"line":27,"column":28},"line":27,"code":"    it('should parse expires', () => {\n      const { joined, expected } = generateCookies({\n        name: 'foo',\n        value: 'bar',\n        expires: new Date(),\n      })\n      const result = splitCookiesString(joined)\n      expect(result).toEqual(expected)\n    })","file":"unit/split-cookies-string.test.ts","skipped":false,"dir":"test"},{"name":"should parse max-age","suites":["splitCookiesString","with a single cookie"],"updatePoint":{"line":37,"column":28},"line":37,"code":"    it('should parse max-age', () => {\n      const { joined, expected } = generateCookies({\n        name: 'foo',\n        value: 'bar',\n        maxAge: 10,\n      })\n      const result = splitCookiesString(joined)\n      expect(result).toEqual(expected)\n    })","file":"unit/split-cookies-string.test.ts","skipped":false,"dir":"test"},{"name":"should parse path","suites":["splitCookiesString","with a single cookie"],"updatePoint":{"line":47,"column":25},"line":47,"code":"    it('should parse path', () => {\n      const { joined, expected } = generateCookies({\n        name: 'foo',\n        value: 'bar',\n        path: '/path',\n      })\n      const result = splitCookiesString(joined)\n      expect(result).toEqual(expected)\n    })","file":"unit/split-cookies-string.test.ts","skipped":false,"dir":"test"},{"name":"should parse with all the options","suites":["splitCookiesString","with a single cookie"],"updatePoint":{"line":57,"column":41},"line":57,"code":"    it('should parse with all the options', () => {\n      const { joined, expected } = generateCookies({\n        name: 'foo',\n        value: 'bar',\n        expires: new Date(Date.now() + 10 * 1000),\n        maxAge: 10,\n        domain: 'https://foo.bar',\n        httpOnly: true,\n        path: '/path',\n        sameSite: 'lax',\n        secure: true,\n      })\n      const result = splitCookiesString(joined)\n      expect(result).toEqual(expected)\n    })","file":"unit/split-cookies-string.test.ts","skipped":false,"dir":"test"},{"name":"should parse a plain value","suites":["splitCookiesString","with a multiple cookies"],"updatePoint":{"line":75,"column":34},"line":75,"code":"    it('should parse a plain value', () => {\n      const { joined, expected } = generateCookies(\n        {\n          name: 'foo',\n          value: 'bar',\n        },\n        {\n          name: 'x',\n          value: 'y',\n        }\n      )\n      const result = splitCookiesString(joined)\n      expect(result).toEqual(expected)\n    })","file":"unit/split-cookies-string.test.ts","skipped":false,"dir":"test"},{"name":"should parse expires","suites":["splitCookiesString","with a multiple cookies"],"updatePoint":{"line":90,"column":28},"line":90,"code":"    it('should parse expires', () => {\n      const { joined, expected } = generateCookies(\n        {\n          name: 'foo',\n          value: 'bar',\n          expires: new Date(),\n        },\n        {\n          name: 'x',\n          value: 'y',\n          expires: new Date(),\n        }\n      )\n      const result = splitCookiesString(joined)\n      expect(result).toEqual(expected)\n    })","file":"unit/split-cookies-string.test.ts","skipped":false,"dir":"test"},{"name":"should parse max-age","suites":["splitCookiesString","with a multiple cookies"],"updatePoint":{"line":107,"column":28},"line":107,"code":"    it('should parse max-age', () => {\n      const { joined, expected } = generateCookies(\n        {\n          name: 'foo',\n          value: 'bar',\n          maxAge: 10,\n        },\n        {\n          name: 'x',\n          value: 'y',\n          maxAge: 10,\n        }\n      )\n      const result = splitCookiesString(joined)\n      expect(result).toEqual(expected)\n    })","file":"unit/split-cookies-string.test.ts","skipped":false,"dir":"test"},{"name":"should parse path","suites":["splitCookiesString","with a multiple cookies"],"updatePoint":{"line":124,"column":25},"line":124,"code":"    it('should parse path', () => {\n      const { joined, expected } = generateCookies(\n        {\n          name: 'foo',\n          value: 'bar',\n          path: '/path',\n        },\n        {\n          name: 'x',\n          value: 'y',\n          path: '/path',\n        }\n      )\n      const result = splitCookiesString(joined)\n      expect(result).toEqual(expected)\n    })","file":"unit/split-cookies-string.test.ts","skipped":false,"dir":"test"},{"name":"should parse with all the options","suites":["splitCookiesString","with a multiple cookies"],"updatePoint":{"line":141,"column":41},"line":141,"code":"    it('should parse with all the options', () => {\n      const { joined, expected } = generateCookies(\n        {\n          name: 'foo',\n          value: 'bar',\n          expires: new Date(Date.now() + 10 * 1000),\n          maxAge: 10,\n          domain: 'https://foo.bar',\n          httpOnly: true,\n          path: '/path',\n          sameSite: 'lax',\n          secure: true,\n        },\n        {\n          name: 'x',\n          value: 'y',\n          expires: new Date(Date.now() + 20 * 1000),\n          maxAge: 20,\n          domain: 'https://x.y',\n          httpOnly: true,\n          path: '/path',\n          sameSite: 'strict',\n          secure: true,\n        }\n      )\n      const result = splitCookiesString(joined)\n      expect(result).toEqual(expected)\n    })","file":"unit/split-cookies-string.test.ts","skipped":false,"dir":"test"},{"name":"create a empty cookies bag","suites":[],"updatePoint":{"line":10,"column":30},"line":10,"code":"it('create a empty cookies bag', async () => {\n  const cookies = new Cookies()\n  expect(Object.entries(cookies)).toEqual([])\n})","file":"unit/web-runtime/cookies.test.ts","skipped":false,"dir":"test"},{"name":"create a cookies bag from string","suites":[],"updatePoint":{"line":15,"column":36},"line":15,"code":"it('create a cookies bag from string', async () => {\n  const cookies = new Cookies('foo=bar; equation=E%3Dmc%5E2')\n  expect(Array.from(cookies.entries())).toEqual([\n    ['foo', 'foo=bar; Path=/'],\n    ['equation', 'equation=E%3Dmc%5E2; Path=/'],\n  ])\n})","file":"unit/web-runtime/cookies.test.ts","skipped":false,"dir":"test"},{"name":".set","suites":[],"updatePoint":{"line":23,"column":8},"line":23,"code":"it('.set', async () => {\n  const cookies = new Cookies()\n  cookies.set('foo', 'bar')\n  expect(Array.from(cookies.entries())).toEqual([['foo', 'foo=bar; Path=/']])\n})","file":"unit/web-runtime/cookies.test.ts","skipped":false,"dir":"test"},{"name":".set with options","suites":[],"updatePoint":{"line":29,"column":21},"line":29,"code":"it('.set with options', async () => {\n  const cookies = new Cookies()\n\n  const options: CookieSerializeOptions = {\n    path: '/',\n    maxAge: 60 * 60 * 24 * 7,\n    httpOnly: true,\n    sameSite: 'strict',\n    domain: 'example.com',\n  }\n\n  cookies.set('foo', 'bar', options)\n\n  expect(options).toEqual({\n    path: '/',\n    maxAge: 60 * 60 * 24 * 7,\n    httpOnly: true,\n    sameSite: 'strict',\n    domain: 'example.com',\n  })\n\n  const [[key, value]] = Array.from(cookies.entries())\n  const values = value.split('; ')\n\n  expect(key).toBe('foo')\n\n  expect(values).toEqual([\n    'foo=bar',\n    'Max-Age=604800',\n    'Domain=example.com',\n    'Path=/',\n    expect.stringContaining('Expires='),\n    'HttpOnly',\n    'SameSite=Strict',\n  ])\n})","file":"unit/web-runtime/cookies.test.ts","skipped":false,"dir":"test"},{"name":".delete","suites":[],"updatePoint":{"line":66,"column":11},"line":66,"code":"it('.delete', async () => {\n  const cookies = new Cookies()\n  cookies.set('foo', 'bar')\n  cookies.delete('foo')\n  expect(Array.from(cookies.entries())).toEqual([])\n})","file":"unit/web-runtime/cookies.test.ts","skipped":false,"dir":"test"},{"name":".has","suites":[],"updatePoint":{"line":73,"column":8},"line":73,"code":"it('.has', async () => {\n  const cookies = new Cookies()\n  cookies.set('foo', 'bar')\n  expect(cookies.has('foo')).toBe(true)\n})","file":"unit/web-runtime/cookies.test.ts","skipped":false,"dir":"test"},{"name":"reflect .set into `set-cookie`","suites":[],"updatePoint":{"line":5,"column":34},"line":5,"code":"it('reflect .set into `set-cookie`', async () => {\n  const { NextResponse } = await import(\n    'next/dist/server/web/spec-extension/response'\n  )\n\n  const response = new NextResponse()\n\n  expect(response.cookies.get('foo')).toBe(undefined)\n  expect(response.cookies.getWithOptions('foo')).toEqual({\n    value: undefined,\n    options: {},\n  })\n\n  response.cookies\n    .set('foo', 'bar', { path: '/test' })\n    .set('fooz', 'barz', { path: '/test2' })\n\n  expect(response.cookies.get('foo')).toBe('bar')\n  expect(response.cookies.get('fooz')).toBe('barz')\n\n  expect(response.cookies.getWithOptions('foo')).toEqual({\n    value: 'bar',\n    options: { Path: '/test' },\n  })\n  expect(response.cookies.getWithOptions('fooz')).toEqual({\n    value: 'barz',\n    options: { Path: '/test2' },\n  })\n\n  expect(Object.fromEntries(response.headers.entries())['set-cookie']).toBe(\n    'foo=bar; Path=/test, fooz=barz; Path=/test2'\n  )\n})","file":"unit/web-runtime/next-cookies.test.ts","skipped":false,"dir":"test"},{"name":"reflect .delete into `set-cookie`","suites":[],"updatePoint":{"line":39,"column":37},"line":39,"code":"it('reflect .delete into `set-cookie`', async () => {\n  const { NextResponse } = await import(\n    'next/dist/server/web/spec-extension/response'\n  )\n\n  const response = new NextResponse()\n\n  response.cookies.set('foo', 'bar')\n  expect(Object.fromEntries(response.headers.entries())['set-cookie']).toBe(\n    'foo=bar; Path=/'\n  )\n\n  expect(response.cookies.get('foo')).toBe('bar')\n  expect(response.cookies.getWithOptions('foo')).toEqual({\n    value: 'bar',\n    options: { Path: '/' },\n  })\n\n  response.cookies.set('fooz', 'barz')\n  expect(Object.fromEntries(response.headers.entries())['set-cookie']).toBe(\n    'foo=bar; Path=/, fooz=barz; Path=/'\n  )\n\n  expect(response.cookies.get('fooz')).toBe('barz')\n  expect(response.cookies.getWithOptions('fooz')).toEqual({\n    value: 'barz',\n    options: { Path: '/' },\n  })\n\n  const firstDelete = response.cookies.delete('foo')\n  expect(firstDelete).toBe(true)\n  expect(Object.fromEntries(response.headers.entries())['set-cookie']).toBe(\n    'foo=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT, fooz=barz; Path=/'\n  )\n\n  expect(response.cookies.get('foo')).toBe(undefined)\n  expect(response.cookies.getWithOptions('foo')).toEqual({\n    value: undefined,\n    options: {},\n  })\n\n  const secondDelete = response.cookies.delete('fooz')\n  expect(secondDelete).toBe(true)\n\n  expect(Object.fromEntries(response.headers.entries())['set-cookie']).toBe(\n    'fooz=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT, foo=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT'\n  )\n\n  expect(response.cookies.get('fooz')).toBe(undefined)\n  expect(response.cookies.getWithOptions('fooz')).toEqual({\n    value: undefined,\n    options: {},\n  })\n  expect(response.cookies.size).toBe(0)\n})","file":"unit/web-runtime/next-cookies.test.ts","skipped":false,"dir":"test"},{"name":"reflect .clear into `set-cookie`","suites":[],"updatePoint":{"line":95,"column":36},"line":95,"code":"it('reflect .clear into `set-cookie`', async () => {\n  const { NextResponse } = await import(\n    'next/dist/server/web/spec-extension/response'\n  )\n\n  const response = new NextResponse()\n\n  response.cookies.clear()\n  expect(Object.fromEntries(response.headers.entries())['set-cookie']).toBe(\n    undefined\n  )\n\n  response.cookies.set('foo', 'bar')\n  expect(Object.fromEntries(response.headers.entries())['set-cookie']).toBe(\n    'foo=bar; Path=/'\n  )\n\n  expect(response.cookies.get('foo')).toBe('bar')\n  expect(response.cookies.getWithOptions('foo')).toEqual({\n    value: 'bar',\n    options: { Path: '/' },\n  })\n\n  response.cookies.set('fooz', 'barz')\n  expect(Object.fromEntries(response.headers.entries())['set-cookie']).toBe(\n    'foo=bar; Path=/, fooz=barz; Path=/'\n  )\n\n  response.cookies.clear()\n  expect(Object.fromEntries(response.headers.entries())['set-cookie']).toBe(\n    'foo=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT, fooz=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT'\n  )\n})","file":"unit/web-runtime/next-cookies.test.ts","skipped":false,"dir":"test"},{"name":"response.cookie does not modify options","suites":[],"updatePoint":{"line":129,"column":43},"line":129,"code":"it('response.cookie does not modify options', async () => {\n  const { NextResponse } = await import(\n    'next/dist/server/web/spec-extension/response'\n  )\n\n  const options = { maxAge: 10000 }\n  const response = new NextResponse(null, {\n    headers: { 'content-type': 'application/json' },\n  })\n  response.cookies.set('cookieName', 'cookieValue', options)\n  expect(options).toEqual({ maxAge: 10000 })\n})","file":"unit/web-runtime/next-cookies.test.ts","skipped":false,"dir":"test"},{"name":"automatically parses and formats JSON","suites":[],"updatePoint":{"line":13,"column":41},"line":13,"code":"it('automatically parses and formats JSON', async () => {\n  expect(await toJSON(NextResponse.json({ message: 'hello!' }))).toMatchObject({\n    contentType: 'application/json',\n    body: { message: 'hello!' },\n  })\n\n  expect(\n    await toJSON(NextResponse.json({ status: 'success' }, { status: 201 }))\n  ).toMatchObject({\n    contentType: 'application/json',\n    body: { status: 'success' },\n    status: 201,\n  })\n\n  expect(\n    await toJSON(\n      NextResponse.json({ error: { code: 'bad_request' } }, { status: 400 })\n    )\n  ).toMatchObject({\n    contentType: 'application/json',\n    body: { error: { code: 'bad_request' } },\n    status: 400,\n  })\n\n  expect(await toJSON(NextResponse.json(null))).toMatchObject({\n    contentType: 'application/json',\n    body: null,\n  })\n\n  expect(await toJSON(NextResponse.json(''))).toMatchObject({\n    contentType: 'application/json',\n    body: '',\n  })\n})","file":"unit/web-runtime/next-response.test.ts","skipped":false,"dir":"test"},{"name":"can be cloned","suites":[],"updatePoint":{"line":48,"column":17},"line":48,"code":"it('can be cloned', async () => {\n  const fetchResponse = await fetch('https://example.vercel.sh')\n  const newResponse = new NextResponse(fetchResponse.body, fetchResponse)\n  expect(await newResponse.text()).toContain('Example Domain')\n  expect(Object.fromEntries(newResponse.headers)).toMatchObject({\n    server: 'Vercel',\n  })\n})","file":"unit/web-runtime/next-response.test.ts","skipped":false,"dir":"test"},{"name":"can return JSON","suites":[],"updatePoint":{"line":57,"column":19},"line":57,"code":"it('can return JSON', async () => {\n  const response = NextResponse.json({ hello: 'world' })\n  expect(await response.json()).toEqual({ hello: 'world' })\n})","file":"unit/web-runtime/next-response.test.ts","skipped":false,"dir":"test"},{"name":"should be able to require next/server outside edge","suites":[],"updatePoint":{"line":3,"column":54},"line":3,"code":"it('should be able to require next/server outside edge', () => {\n  require('next/server')\n})","file":"unit/web-runtime/next-server-node.test.ts","skipped":false,"dir":"test"},{"name":"has the right shape and prototype","suites":[],"line":7,"code":"it.skip('has the right shape and prototype', () => {","file":"unit/web-runtime/next-url.test.ts","skipped":true,"dir":"test"},{"name":"allows to the pathname","suites":[],"updatePoint":{"line":12,"column":26},"line":12,"code":"it('allows to the pathname', async () => {\n  const parsed = new NextURL('/about?param1=value1', 'http://127.0.0.1:3000')\n  expect(parsed.basePath).toEqual('')\n  expect(parsed.hostname).toEqual('localhost')\n  expect(parsed.host).toEqual('localhost:3000')\n  expect(parsed.href).toEqual('http://localhost:3000/about?param1=value1')\n\n  parsed.pathname = '/hihi'\n  expect(parsed.href).toEqual('http://localhost:3000/hihi?param1=value1')\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"allows to change the host","suites":[],"updatePoint":{"line":23,"column":29},"line":23,"code":"it('allows to change the host', () => {\n  const parsed = new NextURL('/about?param1=value1', 'http://127.0.0.1')\n  expect(parsed.hostname).toEqual('localhost')\n  expect(parsed.host).toEqual('localhost')\n  expect(parsed.href).toEqual('http://localhost/about?param1=value1')\n\n  parsed.hostname = 'foo.com'\n  expect(parsed.hostname).toEqual('foo.com')\n  expect(parsed.host).toEqual('foo.com')\n  expect(parsed.href).toEqual('http://foo.com/about?param1=value1')\n  expect(parsed.toString()).toEqual('http://foo.com/about?param1=value1')\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"does noop changing to an invalid hostname","suites":[],"updatePoint":{"line":36,"column":45},"line":36,"code":"it('does noop changing to an invalid hostname', () => {\n  const url = new NextURL('https://foo.com/example')\n  url.hostname = ''\n  expect(url.toString()).toEqual('https://foo.com/example')\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"allows to change the whole href","suites":[],"updatePoint":{"line":42,"column":35},"line":42,"code":"it('allows to change the whole href', () => {\n  const url = new NextURL('https://localhost.com/foo')\n  expect(url.hostname).toEqual('localhost.com')\n  expect(url.protocol).toEqual('https:')\n  expect(url.host).toEqual('localhost.com')\n\n  url.href = 'http://foo.com/bar'\n  expect(url.hostname).toEqual('foo.com')\n  expect(url.protocol).toEqual('http:')\n  expect(url.host).toEqual('foo.com')\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"allows to update search params","suites":[],"updatePoint":{"line":54,"column":34},"line":54,"code":"it('allows to update search params', () => {\n  const url = new NextURL('/example', 'http://localhost.com')\n  url.searchParams.set('foo', 'bar')\n  expect(url.search).toEqual('?foo=bar')\n  expect(url.toString()).toEqual('http://localhost.com/example?foo=bar')\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"parses and formats the basePath","suites":[],"updatePoint":{"line":61,"column":35},"line":61,"code":"it('parses and formats the basePath', () => {\n  const url = new NextURL('/root/example', {\n    base: 'http://127.0.0.1',\n    nextConfig: { basePath: '/root' },\n  })\n\n  expect(url.basePath).toEqual('/root')\n  expect(url.pathname).toEqual('/example')\n  expect(url.toString()).toEqual('http://localhost/root/example')\n\n  const url2 = new NextURL('https://foo.com/root/bar', {\n    nextConfig: { basePath: '/root' },\n  })\n\n  expect(url2.basePath).toEqual('/root')\n  expect(url2.pathname).toEqual('/bar')\n  expect(url2.toString()).toEqual('https://foo.com/root/bar')\n\n  url2.basePath = '/test'\n  expect(url2.basePath).toEqual('/test')\n  expect(url2.pathname).toEqual('/bar')\n  expect(url2.toString()).toEqual('https://foo.com/test/bar')\n\n  const url3 = new NextURL('https://foo.com/example', {\n    nextConfig: { basePath: '/root' },\n  })\n\n  expect(url3.basePath).toEqual('')\n\n  url3.href = 'http://localhost.com/root/example'\n  expect(url3.basePath).toEqual('/root')\n  expect(url3.pathname).toEqual('/example')\n  expect(url3.toString()).toEqual('http://localhost.com/root/example')\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"allows to get empty locale when there is no locale","suites":[],"updatePoint":{"line":96,"column":54},"line":96,"code":"it('allows to get empty locale when there is no locale', () => {\n  const url = new NextURL('https://localhost:3000/foo')\n  expect(url.locale).toEqual('')\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"doesnt allow to set an unexisting locale","suites":[],"updatePoint":{"line":101,"column":44},"line":101,"code":"it('doesnt allow to set an unexisting locale', () => {\n  const url = new NextURL('https://localhost:3000/foo')\n  let error: Error | null = null\n  try {\n    url.locale = 'foo'\n  } catch (err) {\n    error = err\n  }\n\n  expect(error).toBeInstanceOf(TypeError)\n  expect(error.message).toEqual(\n    'The NextURL configuration includes no locale \"foo\"'\n  )\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"always get a default locale","suites":[],"updatePoint":{"line":116,"column":31},"line":116,"code":"it('always get a default locale', () => {\n  const url = new NextURL('/bar', {\n    base: 'http://127.0.0.1',\n    nextConfig: {\n      i18n: {\n        defaultLocale: 'en',\n        locales: ['en', 'es', 'fr'],\n      },\n    },\n  })\n\n  expect(url.locale).toEqual('en')\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"parses and formats the default locale","suites":[],"updatePoint":{"line":130,"column":41},"line":130,"code":"it('parses and formats the default locale', () => {\n  const url = new NextURL('/es/bar', {\n    base: 'http://127.0.0.1',\n    nextConfig: {\n      basePath: '/root',\n      i18n: {\n        defaultLocale: 'en',\n        locales: ['en', 'es', 'fr'],\n      },\n    },\n  })\n\n  expect(url.locale).toEqual('es')\n  expect(url.toString()).toEqual('http://localhost/es/bar')\n\n  url.basePath = '/root'\n  expect(url.locale).toEqual('es')\n  expect(url.toString()).toEqual('http://localhost/root/es/bar')\n\n  url.locale = 'en'\n  expect(url.locale).toEqual('en')\n  expect(url.toString()).toEqual('http://localhost/root/bar')\n\n  url.locale = 'fr'\n  expect(url.locale).toEqual('fr')\n  expect(url.toString()).toEqual('http://localhost/root/fr/bar')\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"parses and formats the default locale with forceLocale","suites":[],"updatePoint":{"line":158,"column":58},"line":158,"code":"it('parses and formats the default locale with forceLocale', () => {\n  const url = new NextURL('/es/bar', {\n    base: 'http://127.0.0.1',\n    forceLocale: true,\n    nextConfig: {\n      basePath: '/root',\n      i18n: {\n        defaultLocale: 'en',\n        locales: ['en', 'es', 'fr'],\n      },\n    },\n  })\n\n  expect(url.locale).toEqual('es')\n  expect(url.toString()).toEqual('http://localhost/es/bar')\n\n  url.basePath = '/root'\n  expect(url.locale).toEqual('es')\n  expect(url.toString()).toEqual('http://localhost/root/es/bar')\n\n  url.locale = 'en'\n  expect(url.locale).toEqual('en')\n  expect(url.toString()).toEqual('http://localhost/root/en/bar')\n\n  url.locale = 'fr'\n  expect(url.locale).toEqual('fr')\n  expect(url.toString()).toEqual('http://localhost/root/fr/bar')\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"consider 127.0.0.1 and variations as localhost","suites":[],"updatePoint":{"line":187,"column":50},"line":187,"code":"it('consider 127.0.0.1 and variations as localhost', () => {\n  const httpUrl = new NextURL('http://localhost:3000/hello')\n  expect(new NextURL('http://127.0.0.1:3000/hello')).toStrictEqual(httpUrl)\n  expect(new NextURL('http://127.0.1.0:3000/hello')).toStrictEqual(httpUrl)\n  expect(new NextURL('http://::1:3000/hello')).toStrictEqual(httpUrl)\n\n  const httpsUrl = new NextURL('https://localhost:3000/hello')\n  expect(new NextURL('https://127.0.0.1:3000/hello')).toStrictEqual(httpsUrl)\n  expect(new NextURL('https://127.0.1.0:3000/hello')).toStrictEqual(httpsUrl)\n  expect(new NextURL('https://::1:3000/hello')).toStrictEqual(httpsUrl)\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"allows to change the port","suites":[],"updatePoint":{"line":199,"column":29},"line":199,"code":"it('allows to change the port', () => {\n  const url = new NextURL('https://localhost:3000/foo')\n  url.port = '3001'\n  expect(url.href).toEqual('https://localhost:3001/foo')\n  url.port = '80'\n  expect(url.href).toEqual('https://localhost:80/foo')\n  url.port = ''\n  expect(url.href).toEqual('https://localhost/foo')\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"allows to clone a new copy","suites":[],"updatePoint":{"line":209,"column":30},"line":209,"code":"it('allows to clone a new copy', () => {\n  const url = new NextURL('/root/es/bar', {\n    base: 'http://127.0.0.1',\n    nextConfig: {\n      basePath: '/root',\n      i18n: {\n        defaultLocale: 'en',\n        locales: ['en', 'es', 'fr'],\n      },\n    },\n  })\n\n  const clone = url.clone()\n  clone.pathname = '/test'\n  clone.basePath = '/root-test'\n\n  expect(url.toString()).toEqual('http://localhost/root/es/bar')\n  expect(clone.toString()).toEqual('http://localhost/root-test/es/test')\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"does not add locale for api route","suites":[],"updatePoint":{"line":229,"column":37},"line":229,"code":"it('does not add locale for api route', () => {\n  const url = new NextURL('http:///localhost:3000/api', {\n    nextConfig: {\n      i18n: {\n        defaultLocale: 'en',\n        locales: ['en', 'es', 'fr'],\n      },\n    },\n  })\n  url.locale = 'fr'\n\n  let expected = 'http://localhost:3000/api'\n  expect(url.href).toEqual(expected)\n  expect(url.toString()).toEqual(expected)\n  expect(url.toJSON()).toEqual(expected)\n\n  url.pathname = '/api/hello'\n\n  expected = 'http://localhost:3000/api/hello'\n  expect(url.href).toEqual(expected)\n  expect(url.toString()).toEqual(expected)\n  expect(url.toJSON()).toEqual(expected)\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"correctly parses a prefetch url","suites":[],"updatePoint":{"line":253,"column":35},"line":253,"code":"it('correctly parses a prefetch url', async () => {\n  const url = new NextURL(\n    '/_next/data/1234/en/hello.json',\n    'http://127.0.0.1:3000'\n  )\n  expect(url.buildId).toEqual('1234')\n  expect(url.pathname).toEqual('/en/hello')\n  expect(url.locale).toEqual('')\n  expect(String(url)).toEqual(\n    'http://localhost:3000/_next/data/1234/en/hello.json'\n  )\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"correctly parses a prefetch index url","suites":[],"updatePoint":{"line":266,"column":41},"line":266,"code":"it('correctly parses a prefetch index url', async () => {\n  const url = new NextURL(\n    '/_next/data/development/index.json',\n    'http://127.0.0.1:3000'\n  )\n  expect(url.pathname).toEqual('/')\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"correctly parses a prefetch url with i18n","suites":[],"updatePoint":{"line":274,"column":45},"line":274,"code":"it('correctly parses a prefetch url with i18n', async () => {\n  const url = new NextURL(\n    '/_next/data/development/en/hello.json',\n    'http://127.0.0.1:3000',\n    {\n      nextConfig: {\n        i18n: {\n          defaultLocale: 'en',\n          locales: ['en', 'es', 'fr'],\n        },\n      },\n    }\n  )\n  expect(url.buildId).toEqual('development')\n  expect(url.pathname).toEqual('/hello')\n  expect(url.locale).toEqual('en')\n  expect(String(url)).toEqual(\n    'http://localhost:3000/_next/data/development/en/hello.json'\n  )\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"allows to update the pathname for a prefetch url","suites":[],"updatePoint":{"line":295,"column":52},"line":295,"code":"it('allows to update the pathname for a prefetch url', async () => {\n  const url = new NextURL(\n    '/_next/data/development/en/hello.json',\n    'http://127.0.0.1:3000',\n    {\n      nextConfig: {\n        i18n: {\n          defaultLocale: 'en',\n          locales: ['en', 'es', 'fr'],\n        },\n      },\n    }\n  )\n\n  url.pathname = '/foo'\n  expect(String(url)).toEqual(\n    'http://localhost:3000/_next/data/development/en/foo.json'\n  )\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"allows to update the pathname to the root path for a prefetch url","suites":[],"updatePoint":{"line":315,"column":69},"line":315,"code":"it('allows to update the pathname to the root path for a prefetch url', async () => {\n  const url = new NextURL(\n    '/_next/data/development/hello.json',\n    'http://127.0.0.1:3000'\n  )\n  url.pathname = '/'\n  expect(String(url)).toEqual(\n    'http://localhost:3000/_next/data/development/index.json'\n  )\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"preserves the trailingSlash","suites":[],"updatePoint":{"line":326,"column":31},"line":326,"code":"it('preserves the trailingSlash', async () => {\n  const url = new NextURL('/es/', {\n    base: 'http://127.0.0.1:3000',\n    nextConfig: {\n      i18n: {\n        defaultLocale: 'en',\n        locales: ['en', 'es', 'fr'],\n      },\n    },\n  })\n\n  expect(String(url)).toEqual('http://localhost:3000/es/')\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"formats correctly the trailingSlash for root pages","suites":[],"updatePoint":{"line":340,"column":54},"line":340,"code":"it('formats correctly the trailingSlash for root pages', async () => {\n  const url = new NextURL('/', {\n    base: 'http://127.0.0.1:3000',\n    nextConfig: {\n      trailingSlash: true,\n      i18n: {\n        defaultLocale: 'en',\n        locales: ['en', 'es', 'fr'],\n      },\n    },\n  })\n\n  url.locale = 'es'\n  expect(String(url)).toEqual('http://localhost:3000/es/')\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"keeps the trailingSlash format for non root pages","suites":[],"updatePoint":{"line":356,"column":53},"line":356,"code":"it('keeps the trailingSlash format for non root pages', async () => {\n  const url = new NextURL('/es', {\n    base: 'http://127.0.0.1:3000',\n    nextConfig: {\n      trailingSlash: true,\n      i18n: {\n        defaultLocale: 'en',\n        locales: ['en', 'es', 'fr'],\n      },\n    },\n  })\n\n  expect(String(url)).toEqual('http://localhost:3000/es')\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"allows to preserve a json request","suites":[],"updatePoint":{"line":371,"column":37},"line":371,"code":"it('allows to preserve a json request', async () => {\n  const url = new NextURL(\n    'http://localhost:3000/_next/static/development/_devMiddlewareManifest.json',\n    {\n      nextConfig: {\n        i18n: {\n          defaultLocale: 'en',\n          locales: ['en', 'es', 'fr'],\n        },\n      },\n    }\n  )\n\n  expect(String(url)).toEqual(\n    'http://localhost:3000/_next/static/development/_devMiddlewareManifest.json'\n  )\n})","file":"unit/web-runtime/next-url.test.ts","skipped":false,"dir":"test"},{"name":"parse an user agent","suites":[],"updatePoint":{"line":10,"column":23},"line":10,"code":"it('parse an user agent', () => {\n  const parser = userAgentFromString(UA_STRING)\n  expect(parser.ua).toBe(\n    'Mozilla/5.0 (Macintosh; Intel Mac OS X 11_2_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.90 Safari/537.36'\n  )\n  expect(parser.browser).toStrictEqual({\n    name: 'Chrome',\n    version: '89.0.4389.90',\n    major: '89',\n  })\n  expect(parser.engine).toStrictEqual({\n    name: 'Blink',\n    version: '89.0.4389.90',\n  })\n  expect(parser.os).toStrictEqual({ name: 'Mac OS', version: '11.2.3' })\n  expect(parser.cpu).toStrictEqual({ architecture: undefined })\n  expect(parser.isBot).toBe(false)\n})","file":"unit/web-runtime/user-agent.test.ts","skipped":false,"dir":"test"},{"name":"parse empty user agent","suites":[],"updatePoint":{"line":29,"column":26},"line":29,"code":"it('parse empty user agent', () => {\n  expect.assertions(3)\n  for (const input of [undefined, null, '']) {\n    expect(userAgentFromString(input)).toStrictEqual({\n      ua: '',\n      browser: { name: undefined, version: undefined, major: undefined },\n      engine: { name: undefined, version: undefined },\n      os: { name: undefined, version: undefined },\n      device: { vendor: undefined, model: undefined, type: undefined },\n      cpu: { architecture: undefined },\n      isBot: false,\n    })\n  }\n})","file":"unit/web-runtime/user-agent.test.ts","skipped":false,"dir":"test"},{"name":"parse user agent from a NextRequest instance","suites":[],"updatePoint":{"line":44,"column":48},"line":44,"code":"it('parse user agent from a NextRequest instance', () => {\n  const request = new NextRequest('https://vercel.com', {\n    headers: {\n      'user-agent': UA_STRING,\n    },\n  })\n\n  expect(userAgent(request)).toStrictEqual({\n    ua: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 11_2_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.90 Safari/537.36',\n    browser: { name: 'Chrome', version: '89.0.4389.90', major: '89' },\n    engine: { name: 'Blink', version: '89.0.4389.90' },\n    os: { name: 'Mac OS', version: '11.2.3' },\n    device: { vendor: undefined, model: undefined, type: undefined },\n    cpu: { architecture: undefined },\n    isBot: false,\n  })\n})","file":"unit/web-runtime/user-agent.test.ts","skipped":false,"dir":"test"},{"name":"should filter module rules correctly","suites":["next-plugin-storybook filterModuleRules"],"updatePoint":{"line":6,"column":42},"line":6,"code":"  it('should filter module rules correctly', async () => {\n    const input = {\n      module: { rules: [{ test: 'babel-loader' }, { test: /.*\\.css/ }] },\n    }\n    const expected = [{ test: 'babel-loader' }]\n\n    const output = storybookPlugin.filterModuleRules(input)\n    expect(output).toEqual(expected)\n  })","file":"unit/webpack-config-overrides.test.ts","skipped":false,"dir":"test"},{"name":"should skip adding when unrelated","suites":["webpack-config attachReactRefresh"],"updatePoint":{"line":18,"column":39},"line":18,"code":"  it('should skip adding when unrelated', () => {\n    const input = { module: { rules: [{ use: 'a' }] } }\n    const expected = { module: { rules: [{ use: 'a' }] } }\n\n    attachReactRefresh(input, 'rr')\n    expect(input).toEqual(expected)\n  })","file":"unit/webpack-config-overrides.test.ts","skipped":false,"dir":"test"},{"name":"should skip adding when existing (shorthand)","suites":["webpack-config attachReactRefresh"],"updatePoint":{"line":26,"column":50},"line":26,"code":"  it('should skip adding when existing (shorthand)', () => {\n    const input = {\n      module: {\n        rules: [\n          {\n            use: [\n              'next/dist/compiled/@next/react-refresh-utils/dist/loader',\n              'rr',\n            ],\n          },\n        ],\n      },\n    }\n    const expected = {\n      module: {\n        rules: [\n          {\n            use: [\n              'next/dist/compiled/@next/react-refresh-utils/dist/loader',\n              'rr',\n            ],\n          },\n        ],\n      },\n    }\n\n    attachReactRefresh(input, 'rr')\n    expect(input).toEqual(expected)\n  })","file":"unit/webpack-config-overrides.test.ts","skipped":false,"dir":"test"},{"name":"should skip adding when existing (longhand)","suites":["webpack-config attachReactRefresh"],"updatePoint":{"line":56,"column":49},"line":56,"code":"  it('should skip adding when existing (longhand)', () => {\n    const input = {\n      module: {\n        rules: [\n          {\n            use: [\n              require.resolve(\n                'next/dist/compiled/@next/react-refresh-utils/dist/loader'\n              ),\n              'rr',\n            ],\n          },\n        ],\n      },\n    }\n    const expected = {\n      module: {\n        rules: [\n          {\n            use: [\n              require.resolve(\n                'next/dist/compiled/@next/react-refresh-utils/dist/loader'\n              ),\n              'rr',\n            ],\n          },\n        ],\n      },\n    }\n\n    attachReactRefresh(input, 'rr')\n    expect(input).toEqual(expected)\n  })","file":"unit/webpack-config-overrides.test.ts","skipped":false,"dir":"test"},{"name":"should add when missing (single, non-array)","suites":["webpack-config attachReactRefresh"],"updatePoint":{"line":90,"column":49},"line":90,"code":"  it('should add when missing (single, non-array)', () => {\n    const input = {\n      module: {\n        rules: [{ use: 'rr' }],\n      },\n    }\n\n    attachReactRefresh(input, 'rr')\n    expect(input).toMatchObject({\n      module: {\n        rules: [\n          {\n            use: [\n              expect.stringMatching(\n                /react-refresh-utils[\\\\/]dist[\\\\/]loader\\.js/\n              ),\n              'rr',\n            ],\n          },\n        ],\n      },\n    })\n  })","file":"unit/webpack-config-overrides.test.ts","skipped":false,"dir":"test"},{"name":"should add when missing (single, array)","suites":["webpack-config attachReactRefresh"],"updatePoint":{"line":114,"column":45},"line":114,"code":"  it('should add when missing (single, array)', () => {\n    const input = {\n      module: {\n        rules: [{ use: ['rr'] }],\n      },\n    }\n\n    attachReactRefresh(input, 'rr')\n    expect(input).toMatchObject({\n      module: {\n        rules: [\n          {\n            use: [\n              expect.stringMatching(\n                /react-refresh-utils[\\\\/]dist[\\\\/]loader\\.js/\n              ),\n              'rr',\n            ],\n          },\n        ],\n      },\n    })\n  })","file":"unit/webpack-config-overrides.test.ts","skipped":false,"dir":"test"},{"name":"should add when missing (before, array)","suites":["webpack-config attachReactRefresh"],"updatePoint":{"line":138,"column":45},"line":138,"code":"  it('should add when missing (before, array)', () => {\n    const input = {\n      module: {\n        rules: [{ use: ['bla', 'rr'] }],\n      },\n    }\n\n    attachReactRefresh(input, 'rr')\n    expect(input).toMatchObject({\n      module: {\n        rules: [\n          {\n            use: [\n              'bla',\n              expect.stringMatching(\n                /react-refresh-utils[\\\\/]dist[\\\\/]loader\\.js/\n              ),\n              'rr',\n            ],\n          },\n        ],\n      },\n    })\n  })","file":"unit/webpack-config-overrides.test.ts","skipped":false,"dir":"test"},{"name":"should add when missing (after, array)","suites":["webpack-config attachReactRefresh"],"updatePoint":{"line":163,"column":44},"line":163,"code":"  it('should add when missing (after, array)', () => {\n    const input = {\n      module: {\n        rules: [{ use: ['rr', 'bla'] }],\n      },\n    }\n\n    attachReactRefresh(input, 'rr')\n    expect(input).toMatchObject({\n      module: {\n        rules: [\n          {\n            use: [\n              expect.stringMatching(\n                /react-refresh-utils[\\\\/]dist[\\\\/]loader\\.js/\n              ),\n              'rr',\n              'bla',\n            ],\n          },\n        ],\n      },\n    })\n  })","file":"unit/webpack-config-overrides.test.ts","skipped":false,"dir":"test"},{"name":"should add when missing (multi, array)","suites":["webpack-config attachReactRefresh"],"updatePoint":{"line":188,"column":44},"line":188,"code":"  it('should add when missing (multi, array)', () => {\n    const input = {\n      module: {\n        rules: [{ use: ['hehe', 'haha', 'rawr', 'rr', 'lol', 'bla'] }],\n      },\n    }\n\n    attachReactRefresh(input, 'rr')\n    expect(input).toMatchObject({\n      module: {\n        rules: [\n          {\n            use: [\n              'hehe',\n              'haha',\n              'rawr',\n              expect.stringMatching(\n                /react-refresh-utils[\\\\/]dist[\\\\/]loader\\.js/\n              ),\n              'rr',\n              'lol',\n              'bla',\n            ],\n          },\n        ],\n      },\n    })\n  })","file":"unit/webpack-config-overrides.test.ts","skipped":false,"dir":"test"},{"name":"should skip when present (multi, array)","suites":["webpack-config attachReactRefresh"],"updatePoint":{"line":217,"column":45},"line":217,"code":"  it('should skip when present (multi, array)', () => {\n    const input = {\n      module: {\n        rules: [\n          {\n            use: [\n              'hehe',\n              'haha',\n              'next/dist/compiled/@next/react-refresh-utils/dist/loader',\n              'rr',\n              'lol',\n              'bla',\n            ],\n          },\n        ],\n      },\n    }\n\n    attachReactRefresh(input, 'rr')\n    expect(input).toMatchObject({\n      module: {\n        rules: [\n          {\n            use: [\n              'hehe',\n              'haha',\n              'next/dist/compiled/@next/react-refresh-utils/dist/loader',\n              'rr',\n              'lol',\n              'bla',\n            ],\n          },\n        ],\n      },\n    })\n  })","file":"unit/webpack-config-overrides.test.ts","skipped":false,"dir":"test"},{"name":"should skip when present (multi, array, wrong order)","suites":["webpack-config attachReactRefresh"],"updatePoint":{"line":254,"column":58},"line":254,"code":"  it('should skip when present (multi, array, wrong order)', () => {\n    const input = {\n      module: {\n        rules: [\n          {\n            use: [\n              'hehe',\n              'haha',\n              'rr',\n              'lol',\n              'next/dist/compiled/@next/react-refresh-utils/dist/loader',\n              'bla',\n            ],\n          },\n        ],\n      },\n    }\n\n    attachReactRefresh(input, 'rr')\n    expect(input).toMatchObject({\n      module: {\n        rules: [\n          {\n            use: [\n              'hehe',\n              'haha',\n              'rr',\n              'lol',\n              'next/dist/compiled/@next/react-refresh-utils/dist/loader',\n              'bla',\n            ],\n          },\n        ],\n      },\n    })\n  })","file":"unit/webpack-config-overrides.test.ts","skipped":false,"dir":"test"},{"name":"should preserve CRLF EOL","suites":["find config"],"updatePoint":{"line":14,"column":30},"line":14,"code":"  it('should preserve CRLF EOL', async () => {\n    const eol = '\\r\\n'\n    const content =\n      '/// <reference types=\"next\" />' +\n      eol +\n      (imageImportsEnabled\n        ? '/// <reference types=\"next/image-types/global\" />' + eol\n        : '') +\n      eol +\n      '// NOTE: This file should not be edited' +\n      eol +\n      '// see https://nextjs.org/docs/basic-features/typescript for more information.' +\n      eol\n\n    await fs.ensureDir(fixtureDir)\n    await fs.writeFile(declarationFile, content)\n\n    await writeAppTypeDeclarations(fixtureDir, imageImportsEnabled)\n    expect(await fs.readFile(declarationFile, 'utf8')).toBe(content)\n  })","file":"unit/write-app-declarations.test.ts","skipped":false,"dir":"test"},{"name":"should preserve LF EOL","suites":["find config"],"updatePoint":{"line":35,"column":28},"line":35,"code":"  it('should preserve LF EOL', async () => {\n    const eol = '\\n'\n    const content =\n      '/// <reference types=\"next\" />' +\n      eol +\n      (imageImportsEnabled\n        ? '/// <reference types=\"next/image-types/global\" />' + eol\n        : '') +\n      eol +\n      '// NOTE: This file should not be edited' +\n      eol +\n      '// see https://nextjs.org/docs/basic-features/typescript for more information.' +\n      eol\n\n    await fs.ensureDir(fixtureDir)\n    await fs.writeFile(declarationFile, content)\n\n    await writeAppTypeDeclarations(fixtureDir, imageImportsEnabled)\n    expect(await fs.readFile(declarationFile, 'utf8')).toBe(content)\n  })","file":"unit/write-app-declarations.test.ts","skipped":false,"dir":"test"},{"name":"should use OS EOL by default","suites":["find config"],"updatePoint":{"line":56,"column":34},"line":56,"code":"  it('should use OS EOL by default', async () => {\n    const eol = os.EOL\n    const content =\n      '/// <reference types=\"next\" />' +\n      eol +\n      (imageImportsEnabled\n        ? '/// <reference types=\"next/image-types/global\" />' + eol\n        : '') +\n      eol +\n      '// NOTE: This file should not be edited' +\n      eol +\n      '// see https://nextjs.org/docs/basic-features/typescript for more information.' +\n      eol\n\n    await fs.ensureDir(fixtureDir)\n    await writeAppTypeDeclarations(fixtureDir, imageImportsEnabled)\n    expect(await fs.readFile(declarationFile, 'utf8')).toBe(content)\n  })","file":"unit/write-app-declarations.test.ts","skipped":false,"dir":"test"}]}